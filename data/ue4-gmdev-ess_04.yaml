- en: Chapter 4. Post Process
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第四章 后处理
- en: Post Process in Unreal Engine 4 allows you to create a variety of artistic effects
    and change the overall look and feel of the whole game. Post Process effects are
    activated using Post Process Volumes and can be used individually to affect only
    a specific area or the entire scene. You can have multiple Post Process Volumes
    overlapping and render their effects based on their priority. Post Process Volumes
    can be used to add or modify simple effects such as Bloom, Lens Flares, Eye Adaptation,
    Depth of Field, and so on and they can also be used to get advanced effects using
    Materials. Another great feature of Post Process Volume is **Look up Table** (**LUT**),
    which is used to store color transformations from image editing software, such
    as Adobe Photoshop or GIMP. They are very easy to set up and can yield very good
    results. We will get into LUT later in this chapter.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: Unreal Engine 4中的后处理允许你创建各种艺术效果，并改变整个游戏的整体外观和感觉。后处理效果通过后处理体积激活，可以单独使用以影响特定区域或整个场景。你可以有多个重叠的后处理体积，并根据它们的优先级渲染它们的效果。后处理体积可以用来添加或修改简单的效果，如光晕、镜头光晕、眼睛适应、景深等，它们也可以用来使用材质获取高级效果。后处理体积的另一个伟大功能是**查找表**（**LUT**），它用于存储来自图像编辑软件（如Adobe
    Photoshop或GIMP）的颜色转换。它们非常容易设置，并且可以产生非常好的效果。我们将在本章后面讨论LUT。
- en: 'When you first start a project without starter content, there will be no Post
    Process Volumes present in the scene, so Engine will use the default settings.
    You can change these settings per project under **Project Settings**:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 当你开始一个没有起始内容的项目时，场景中将不会出现后处理体积，因此引擎将使用默认设置。你可以在**项目设置**中按项目更改这些设置：
- en: Click on **Edit** in the menu bar.
  id: totrans-3
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在菜单栏中点击**编辑**。
- en: Click on **Project Settings**.
  id: totrans-4
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**项目设置**。
- en: Go to the **Rendering** section.
  id: totrans-5
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到**渲染**部分。
- en: Expand **Default Postprocessing Settings**:![Post Process](img/B03950_04_01.jpg)
  id: totrans-6
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 展开**默认后处理设置**：![后处理](img/B03950_04_01.jpg)
- en: Here, you will see the default settings for Unreal Engine when there is no Post
    Process Volume in your scene. You can modify these settings or add a Post Process
    Volume to override them independently.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，你会看到当场景中没有后处理体积时，Unreal Engine的默认设置。你可以修改这些设置或添加一个后处理体积来独立覆盖它们。
- en: Adding Post Process
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 添加后处理
- en: 'To use Post Process, you need a Post Process Volume in your scene:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用后处理，你需要在场景中有一个后处理体积：
- en: Go to the **Modes** tab (if you closed it, press *Shift* + *1*).
  id: totrans-10
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 转到**模式**标签（如果你已关闭它，请按*Shift* + *1*）。
- en: Select the **Volumes** tab.
  id: totrans-11
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**体积**标签。
- en: Drag and drop Post Process Volume into the scene:![Adding Post Process](img/B03950_04_02.jpg)
  id: totrans-12
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将后处理体积拖放到场景中：![添加后处理](img/B03950_04_02.jpg)
- en: 'You now have a Post Process Volume in your scene. However, it only shows the
    effects when the player is inside that volume. To make it affect the whole scene
    perform the following steps:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 你现在场景中有一个后处理体积。然而，它只显示当玩家在该体积内时的效果。要使其影响整个场景，请执行以下步骤：
- en: Select **Post Process Volume**
  id: totrans-14
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**后处理体积**
- en: In the **Details** panel, scroll down and expand the **Post Process Volume**
    section
  id: totrans-15
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**详细信息**面板中，向下滚动并展开**后处理体积**部分
- en: Enable **Unbound**
  id: totrans-16
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启用**未绑定**
- en: 'Enabling **Unbound** will ignore the bounds of this volume and affect the whole
    scene. Now, let''s take a quick look at these Post Process settings:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 启用**未绑定**将忽略此体积的边界并影响整个场景。现在，让我们快速查看这些后处理设置：
- en: '![Adding Post Process](img/B03950_04_03.jpg)'
  id: totrans-18
  prefs: []
  type: TYPE_IMG
  zh: '![添加后处理](img/B03950_04_03.jpg)'
- en: '**Priority**: If multiple volumes are overlapping each other, then the volume
    with higher priority overrides the lower one.'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**优先级**：如果有多个体积重叠，则优先级较高的体积将覆盖优先级较低的体积。'
- en: '**Blend Radius**: This is the radius of the volume used for blending. Generally,
    a value of `100` works best. This setting is ignored if you have **Unbound** enabled.'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**混合半径**：这是用于混合的体积的半径。通常，`100`的值效果最佳。如果你启用了**未绑定**，则此设置将被忽略。'
- en: '**Blend Weight**: This defines the influence of properties. `0` means no effect
    and `1` means full effect.'
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**混合权重**：这定义了属性的影响。`0`表示无效果，`1`表示全效果。'
- en: '**Enabled**: This enables or disables this volume.'
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**启用**：此选项启用或禁用此体积。'
- en: '**Unbound**: If enabled, then Post Process effects will ignore the bounds of
    this volume and will affect the whole scene.'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**未绑定**：如果启用，则后处理效果将忽略此体积的边界并影响整个场景。'
- en: LUT
  id: totrans-24
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: LUT
- en: 'LUTs are color neutral textures unwrapped to a 256 x 16 size texture. They
    are used to create unique artistic effects and are modified using image editing
    software such as Adobe Photoshop. If you are not familiar with Photoshop, you
    can use free and open source software such as GIMP. The following is an image
    of the default LUT texture:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: LUT 是颜色中性的纹理，展开到 256 x 16 大小的纹理。它们用于创建独特的艺术效果，并使用图像编辑软件（如 Adobe Photoshop）进行修改。如果你不熟悉
    Photoshop，可以使用免费和开源软件，如 GIMP。以下是一个默认 LUT 纹理的图像：
- en: '![LUT](img/B03950_04_04.jpg)'
  id: totrans-26
  prefs: []
  type: TYPE_IMG
  zh: '![LUT](img/B03950_04_04.jpg)'
- en: 'The procedure of LUT is as follows:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: LUT 的流程如下：
- en: First you take a screenshot of your world and bring it into Photoshop.
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，你拍摄你的世界的一张快照，并将其带入 Photoshop。
- en: On top of that screenshot, you insert the LUT texture.
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在上面的截图上，插入 LUT 纹理。
- en: 'Then on top of both, apply color manipulations (for example: adjustment layer).'
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后在两者之上应用色彩调整（例如：调整图层）。
- en: Now select the LUT texture and save it with your color manipulation as PNG or
    TGA.
  id: totrans-31
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在选择 LUT 纹理，并将其与你的色彩调整一起保存为 PNG 或 TGA。
- en: Finally, import your LUT into Unreal Engine.
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，将你的 LUT 导入 Unreal Engine。
- en: Note
  id: totrans-33
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Note that after you import your LUT into **Content Browser**, open it and set
    the **Texture Group** to **ColorLookupTable**. This is an important step and should
    not be skipped.
  id: totrans-34
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 注意，在你将 LUT 导入**内容浏览器**后，打开它并将**纹理组**设置为**色彩查找表**。这是一个重要的步骤，不应跳过。
- en: 'To apply the LUT, select the Post Process volume, and under the **Scene Color**
    section, you can enable **Color Grading** and set your LUT texture:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 要应用 LUT，选择后处理体积，然后在**场景颜色**部分，你可以启用**色彩分级**并设置你的 LUT 纹理：
- en: '![LUT](img/B03950_04_05.jpg)'
  id: totrans-36
  prefs: []
  type: TYPE_IMG
  zh: '![LUT](img/B03950_04_05.jpg)'
- en: With the **Color Grading Intensity** option, you can change the intensity of
    the effect.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 使用**色彩分级强度**选项，你可以改变效果强度。
- en: Post Process Materials
  id: totrans-38
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 后处理材料
- en: 'Post Process Materials help you create custom post processing with the help
    of Material Editor. You need to create a Material with your desired effect and
    assign it to **Blendables** in Post Process Volume. Click on the plus sign to
    add more slots:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 后处理材料帮助你通过材质编辑器创建自定义后处理。你需要创建一个具有你所需效果的材质，并将其分配给后处理体积中的**可混合项**。点击加号以添加更多插槽：
- en: '![Post Process Materials](img/B03950_04_06.jpg)'
  id: totrans-40
  prefs: []
  type: TYPE_IMG
  zh: '![后处理材料](img/B03950_04_06.jpg)'
- en: 'Before I explain about Post Process Materials, let''s take a quick look at
    one of the most important Post Process nodes in Material Editor:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 在我解释后处理材料之前，让我们快速看一下材质编辑器中最重要的一些后处理节点之一：
- en: '**Scene Texture**: This node has multiple selections that output different
    textures:![Post Process Materials](img/B03950_04_07.jpg)'
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**场景纹理**：此节点有多个选择，输出不同的纹理：![后处理材料](img/B03950_04_07.jpg)'
- en: '**UVs** (optional): This input tiles the texture. For UV operations on the
    **SceneTexture** node, it is good to use the **ScreenPosition** node instead of
    the regular **Texture Coordinate** node.'
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**UVs**（可选）：此输入平铺纹理。对于**场景纹理**节点的 UV 操作，使用**屏幕位置**节点而不是常规的**纹理坐标**节点是很好的。'
- en: '**Color**: This outputs the final texture as RGBA. If you want to multiply
    this with a color, you first need to use a component mask to extract R, G, and
    B and then multiply it by your color.'
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**颜色**：这输出最终的纹理作为 RGBA。如果你想将其与颜色相乘，首先需要使用组件遮罩提取 R、G 和 B，然后乘以你的颜色。'
- en: '**Size**: This outputs the size (width and height) of the texture.'
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**大小**：这输出纹理的大小（宽度和高度）。'
- en: '**InvSize**: This is the inverse of the **Size** output. (1/width and 1/height).'
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**InvSize**：这是**大小**输出的倒数。（1/宽度 和 1/高度）。'
- en: Note
  id: totrans-47
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: It is important to keep in mind that you should only use Post Process Materials
    when you really need them. For **Color Correction** and various other effects,
    you should stick with the settings from Post Process Volume since they are more
    efficient and optimized.
  id: totrans-48
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 需要记住的是，只有在你真正需要的时候才应该使用后处理材料。对于**色彩校正**和各种其他效果，你应该坚持使用后处理体积的设置，因为它们更高效且经过优化。
- en: Creating a Post Process Material
  id: totrans-49
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建后处理材料
- en: 'With Post Process Material, you can create your own custom Post Processing
    effects. Some examples are:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 使用后处理材料，你可以创建自己的自定义后处理效果。一些例子包括：
- en: Highlighting a specific object in your game
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在你的游戏中突出显示特定对象
- en: Rendering occluded objects
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 渲染遮挡对象
- en: Edge detection, and so on
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 边缘检测等
- en: In this quick example, we will see how to highlight an object in our world.
    To render a specific object separately, we need to put them to a custom depth
    buffer. The good thing is, it's as easy as clicking on a checkbox.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个快速示例中，我们将看到如何突出显示我们世界中的对象。要单独渲染特定对象，我们需要将它们放入自定义深度缓冲区。好事是，这就像点击一个复选框一样简单。
- en: 'Select your Static Mesh and under the **Rendering** section, expand the options
    and enable **Render Custom Depth**:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 选择你的静态网格，在**Rendering**部分下展开选项并启用**Render Custom Depth**：
- en: '![Creating a Post Process Material](img/B03950_04_08.jpg)'
  id: totrans-56
  prefs: []
  type: TYPE_IMG
  zh: '![创建后处理材质](img/B03950_04_08.jpg)'
- en: 'Now that the mesh is rendered in the `CustomDepth` buffer, we can use this
    information in Material Editor to mask out and render it separately. To do that:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 现在网格已渲染在`CustomDepth`缓冲区中，我们可以在材质编辑器中使用此信息来遮罩并单独渲染它。要这样做：
- en: Create a new Material and open it.
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个新的材质并打开它。
- en: First thing to do now is to set **Material Domain** to **Post Process**. This
    will disable all inputs except **Emissive Color**.
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在首先要做的是将**Material Domain**设置为**Post Process**。这将禁用所有输入，除了**Emissive Color**。
- en: Now, right-click on the graph and search for **SceneTexture** and select it.
    Set **Scene Texture Id** to **CustomDepth**.
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，右键单击图表并搜索**SceneTexture**并选择它。将**Scene Texture Id**设置为**CustomDepth**。
- en: '**CustomDepth** outputs a raw value so let''s divide it by the distance we
    want.'
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**CustomDepth**输出一个原始值，所以让我们将其除以我们想要的距离。'
- en: 'Add a new **Divide** node and connect **CustomDepth** to input *A*. Select
    the divide node and for *Const B* give a high value (for example: `100000000`).
    Remember, 1 Unreal Unit is equal to `1` cm so if you give a small value like `100`
    or `1000`, you need to go really close to the object to see the effect. This is
    why we use a very large value.'
  id: totrans-62
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加一个新的**Divide**节点并将**CustomDepth**连接到输入*A*。选择除法节点，并为*Const B*提供一个高值（例如：`100000000`）。记住，1
    Unreal Unit等于`1`厘米，所以如果你提供一个像`100`或`1000`这样的小值，你需要非常接近对象才能看到效果。这就是为什么我们使用一个非常大的值。
- en: Add a **Clamp** node and connect **Divide** to the first input of the **Clamp**
    node.
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加一个**Clamp**节点并将**Divide**连接到**Clamp**节点的第一个输入。
- en: Create a **Lerp** node and connect the output of **Clamp** to the *Alpha* input
    of **Lerp**. The **Lerp** node will blend input `A` and `B` based on the alpha
    value. If the alpha value is `1`, then input *A* is used. If it is `0` then input
    *B* is used.
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个**Lerp**节点并将**Clamp**的输出连接到**Lerp**的*Alpha*输入。**Lerp**节点将根据alpha值混合输入A和B。如果alpha值为`1`，则使用输入*A*。如果是`0`，则使用输入*B*。
- en: Create another **SceneTexture** node and set its *Scene Texture Id* to **PostProcessInput0**.
    **PostProcessInput0** outputs the final HDR color so make sure you use this. There's
    another output called **SceneColor**, which does the same but it outputs lower
    quality of the current scene.
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建另一个**SceneTexture**节点并将其*Scene Texture Id*设置为**PostProcessInput0**。**PostProcessInput0**输出最终HDR颜色，所以请确保使用它。还有一个名为**SceneColor**的输出，它做同样的事情，但输出当前场景的较低质量。
- en: Right-click on the graph again and search for the **Desaturation** node. Connect
    **PostProcessInput0** *Color* output to **Desaturation** input. We will use this
    to desaturate the whole scene except our mesh with **CustomDepth**.
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 再次右键单击图表并搜索**Desaturation**节点。将**PostProcessInput0**的*Color*输出连接到**Desaturation**输入。我们将使用它来降低除了带有**CustomDepth**的网格之外整个场景的饱和度。
- en: Connect the **Desaturation** output to *Lerp B* and **PostProcessInput0** to
    *Lerp A*, and finally, connect the **Lerp** to **Emissive Color**.
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将**Desaturation**输出连接到*Lerp B*和**PostProcessInput0**到*Lerp A*，最后将**Lerp**连接到**Emissive
    Color**。
- en: 'Here is the final screenshot of the whole graph:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 下面是整个图表的最终截图：
- en: '![Creating a Post Process Material](img/B03950_04_09.jpg)'
  id: totrans-69
  prefs: []
  type: TYPE_IMG
  zh: '![创建后处理材质](img/B03950_04_09.jpg)'
- en: 'And in this example scene, I''ve applied this Material to Post Process Blendables
    and you can see the effect:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个示例场景中，我已经将此材质应用于后处理混合体，你可以看到效果：
- en: '![Creating a Post Process Material](img/B03950_04_10.jpg)'
  id: totrans-71
  prefs: []
  type: TYPE_IMG
  zh: '![创建后处理材质](img/B03950_04_10.jpg)'
- en: Everything that is in color has Render Custom Depth enabled so the Post Process
    Material is masking them out and applying the desaturation to the entire scene.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 所有有颜色的内容都启用了Render Custom Depth，所以后处理材质正在遮罩它们并将去饱和度应用于整个场景。
- en: Summary
  id: totrans-73
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In next chapter, we will add lights and discuss Light Mobility, Lightmass, and
    Dynamic Lights.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将添加灯光并讨论光移动性、光照质量和动态灯光。
