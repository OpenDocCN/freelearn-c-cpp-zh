<html><head></head><body><div class="chapter" title="Chapter&#xA0;8.&#xA0;Inventory Population and Item Use"><div class="titlepage"><div><div><h1 class="title"><a id="ch08"/>Chapter 8. Inventory Population and Item Use</h1></div></div></div><p>In the previous chapter, we learned how to add a shop, which holds items. In this chapter, we will go a step further by allowing a user to buy items from the shop and use those bought items in their dynamically populated inventory screen. Once done, we will use similar ideas to equip items to party members that will be used to increase the stats of the wearer.</p><p>By the end of this chapter, we will learn how to create logic in our <span class="strong"><strong>Shop</strong></span> Widget Blueprint that populates the inventory Scroll Box in the <span class="strong"><strong>Shop</strong></span> Widget Blueprint with the buttons created through the <span class="strong"><strong>Item</strong></span> Data table from the <span class="strong"><strong>Item</strong></span> Widget Blueprint. Now that we have the logic set up, we need to allow the user to interact with the buttons by being able to buy any item that they click on in the shop, so long as they have enough money. Since the issuer interacts with the dynamically populating buttons, it is important that we have our logic executed when the user presses a button, which is located in the <span class="strong"><strong>Item</strong></span> Widget Blueprint.</p><p>If you have any other Blueprints in your <span class="strong"><strong>Event Graph</strong></span> that you may have put together earlier, you can ignore them since an interaction will allow us to start over using some different methodologies.</p><p>First, we must note that the <span class="strong"><strong>Item</strong></span> Blueprint will house logic that should happen anytime a button from that Blueprint is clicked. So, at the moment, we are planning to have the button populate the shop, but in the player's inventory, the logic would need to be different, depending on which screen we are on. This means that we will first need to find out which screen the player is on, and then fire off a series of actions based on the screen they are on. It would be easy to do this with Booleans from the <span class="strong"><strong>OnClicked</strong></span> event, which will check to see which menu the player is in and branch off different logic, depending on which menu the player is currently in. </p><p>Since we are concerned with the difference between the behavior of the buttons in the <span class="strong"><strong>Pause_Inventory</strong></span> screen versus the <span class="strong"><strong>Shop</strong></span> screen, we must first create a Boolean that will stay active throughout the life of the character. In this case, we will use the Field Player to hold our important item variables.</p><p>In this chapter, we will cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Creating the Field Player Booleans</li><li class="listitem" style="list-style-type: disc">Determining whether the inventory screen is on or off</li><li class="listitem" style="list-style-type: disc">Logical difference between inventory and shop items</li><li class="listitem" style="list-style-type: disc">Finishing the inventory screen</li><li class="listitem" style="list-style-type: disc">Using the items</li></ul></div><div class="section" title="Creating the FieldPlayer Booleans"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec53"/>Creating the FieldPlayer Booleans</h1></div></div></div><p>Go to the <a id="id469" class="indexterm"/>Field Player by navigating to <span class="strong"><strong>Content</strong></span> | <span class="strong"><strong>Blueprints</strong></span> | <span class="strong"><strong>Characters</strong></span>, and select <span class="strong"><strong>FieldPlayer</strong></span>. Open <span class="strong"><strong>FieldPlayer</strong></span> and navigate to <span class="strong"><strong>Event Graph</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_08_01.jpg" alt="Creating the FieldPlayer Booleans"/></div><p>Here, we create a new variable under the <span class="strong"><strong>Blueprint</strong></span> tab by navigating to <span class="strong"><strong>+Add New</strong></span> | <span class="strong"><strong>Variable</strong></span>. Next, we create a new <code class="literal">inventoryScreen</code> Boolean. Then, we need to make the variable public. This Boolean will be responsible for keeping true or false values, depending on whether the player is on the inventory screen. We may need more variables like these in the figure, but for now, we will just use this variable:</p><div class="mediaobject"><img src="graphics/B04548_08_59.jpg" alt="Creating the FieldPlayer Booleans"/></div><p>When you are finished creating the <code class="literal">inventoryScreen</code> variable, compile the Blueprint.</p></div></div>
<div class="section" title="Determining whether the inventory screen is on or off"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec54"/>Determining whether the inventory screen is on or off</h1></div></div></div><p>We will <a id="id470" class="indexterm"/>now set the <code class="literal">inventoryScreen</code> variable in its proper place. The best place to put this is when the inventory menu pops up. So, go to <span class="strong"><strong>Pause_Inventory</strong></span> by navigating to <span class="strong"><strong>Content</strong></span> | <span class="strong"><strong>Blueprints</strong></span> | <span class="strong"><strong>UI</strong></span>. In <span class="strong"><strong>Pause_Inventory</strong></span>, locate the <span class="strong"><strong>Event Construct</strong></span> in the Event Graph (if an <span class="strong"><strong>Event Construct</strong></span> does not exist yet, create one), and from here, get every actor from the Field Player class by creating <span class="strong"><strong>Get All Actors of Class</strong></span>, which is located under <span class="strong"><strong>Utilities</strong></span> in the <span class="strong"><strong>Actions</strong></span> menu:</p><div class="mediaobject"><img src="graphics/B04548_08_03.jpg" alt="Determining whether the inventory screen is on or off"/></div><p>Under <span class="strong"><strong>Actor Class</strong></span> in the <span class="strong"><strong>Get All Actors Of Class</strong></span> function, change the actor to <span class="strong"><strong>Field Player</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_08_04.jpg" alt="Determining whether the inventory screen is on or off"/></div><p>From the <span class="strong"><strong>Out Actors</strong></span> pin, in the <span class="strong"><strong>Get All Actors Of Class</strong></span> function, you will need to attach a <span class="strong"><strong>GET</strong></span> function. This <a id="id471" class="indexterm"/>will take an array of all actors in your Field Player class and allow access to individual members of the class:</p><div class="mediaobject"><img src="graphics/B04548_08_05.jpg" alt="Determining whether the inventory screen is on or off"/></div><p>Lastly, open your all possible actions and uncheck <span class="strong"><strong>Context Sensitive</strong></span>. Go to <span class="strong"><strong>Set Inventory Screen</strong></span> by navigating to <span class="strong"><strong>Class</strong></span> | <span class="strong"><strong>Field Player</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_08_06.jpg" alt="Determining whether the inventory screen is on or off"/></div><p>Once done, connect the <span class="strong"><strong>Target</strong></span> pin of your <span class="strong"><strong>Set Inventory Screen</strong></span> to the right-hand side pin of <span class="strong"><strong>GET</strong></span>. Also, make <a id="id472" class="indexterm"/>sure that the <span class="strong"><strong>Inventory Screen</strong></span> is checked, which means that we set the <span class="strong"><strong>Inventory Screen</strong></span> to true here. At this point, you can also link <span class="strong"><strong>Event Construct</strong></span> to fire off <span class="strong"><strong>Get All Actors Of Class</strong></span>, which will activate the <span class="strong"><strong>Set Inventory Screen</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_08_07.jpg" alt="Determining whether the inventory screen is on or off"/></div><p>We will also need to make sure that the Boolean is set to false when the player leaves the inventory screen, so clone another <span class="strong"><strong>Set Inventory Screen</strong></span> Boolean, and set it to false. Link the <span class="strong"><strong>Target</strong></span> pin back to the <span class="strong"><strong>GET</strong></span> from <span class="strong"><strong>Get All Actors Of Class</strong></span>, and activate it when the inventory window closes:</p><div class="mediaobject"><img src="graphics/B04548_08_08.jpg" alt="Determining whether the inventory screen is on or off"/></div><p>We will later come<a id="id473" class="indexterm"/> back to <span class="strong"><strong>Pause_Inventory</strong></span> to add the button population logic, similar to the shop in the previous chapter. However, now that we have our Booleans set, we will be able to tell whether the player is viewing the inventory or is navigating the shop (if the Boolean is false).</p></div>
<div class="section" title="Logical difference between the inventory and shop items"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec55"/>Logical difference between the inventory and shop items</h1></div></div></div><p>Let's now open<a id="id474" class="indexterm"/> the <span class="strong"><strong>Item</strong></span> Widget Blueprint by navigating to <span class="strong"><strong>Content</strong></span> | <span class="strong"><strong>Blueprints</strong></span> | <span class="strong"><strong>UI</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_08_09.jpg" alt="Logical difference between the inventory and shop items"/></div><p>At this point, we<a id="id475" class="indexterm"/> should not have any logic for the button, which is necessary because it gives us the actions that the button will perform in conjunction with the game. To add a functionality to the button, click on the button, navigate to <span class="strong"><strong>Details</strong></span> | <span class="strong"><strong>Events</strong></span> | <span class="strong"><strong>OnClicked</strong></span>, and then click on <span class="strong"><strong>+</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_08_10.jpg" alt="Logical difference between the inventory and shop items"/></div><p>Here, we will <a id="id476" class="indexterm"/>need to do a few things. Firstly, we know that this Blueprint will be responsible for all of the button mechanics regarding both the shops and the character's inventory and the mechanics will be different since the character buys items from the shop and uses items from the inventory. Since these different game screens provide different actions, it would be wise to first check whether a user is in the shop or in their inventory. To do this, we should first bring in the <span class="strong"><strong>Get All Actors Of Class</strong></span> function, and get all the actors from the Field Player class. Then, we need to link the <span class="strong"><strong>Out Actors</strong></span> pin to <span class="strong"><strong>GET</strong></span>. Finally, have the <span class="strong"><strong>OnClicked</strong></span> event fire off <span class="strong"><strong>Get All Actors Of Class</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_08_11.jpg" alt="Logical difference between the inventory and shop items"/></div><p>At this point, we <a id="id477" class="indexterm"/>can open our <span class="strong"><strong>Actions</strong></span> window, and go to the <span class="strong"><strong>Get Inventory Screen</strong></span> by navigating to <span class="strong"><strong>Class</strong></span> | <span class="strong"><strong>Field Player</strong></span>. You will need to uncheck <span class="strong"><strong>Context Sensitive</strong></span> to see this option:</p><div class="mediaobject"><img src="graphics/B04548_08_12.jpg" alt="Logical difference between the inventory and shop items"/></div><p>You will then link the <span class="strong"><strong>Target</strong></span> pin of the <span class="strong"><strong>Inventory Screen</strong></span> node to the blue <span class="strong"><strong>GET</strong></span> pin. This will allow us to access the <span class="strong"><strong>Inventory Screen</strong></span> Boolean from the Field Player class:</p><div class="mediaobject"><img src="graphics/B04548_08_13.jpg" alt="Logical difference between the inventory and shop items"/></div><p>It is now time to create a branching system that will perform logic, depending on whether the player is <a id="id478" class="indexterm"/>shopping or whether they are in their inventory. We will use our <span class="strong"><strong>Inventory Screen</strong></span> Boolean for this. Let's first bring in a branch by navigating to <span class="strong"><strong>Utilities</strong></span> | <span class="strong"><strong>Flow Control</strong></span> in the <span class="strong"><strong>Actions</strong></span> menu:</p><div class="mediaobject"><img src="graphics/B04548_08_14.jpg" alt="Logical difference between the inventory and shop items"/></div><p>Here, we link the condition of your branch to the <span class="strong"><strong>Inventory Screen</strong></span> condition. Then, have the <span class="strong"><strong>Get All Actions Of Class</strong></span> function activate the branch. At this point, when the player clicks on the button, we will check to see whether the <span class="strong"><strong>Inventory Screen</strong></span> is true (or if the player is on the inventory screen). If they are not on the inventory screen, then it means that the player is on some other screen; in our case, the shop:</p><div class="mediaobject"><img src="graphics/B04548_08_15.jpg" alt="Logical difference between the inventory and shop items"/></div><p>Before we continue with the rest of the <span class="strong"><strong>Item</strong></span> button logic, we need to think about our logical flow. If <a id="id479" class="indexterm"/>the user is in the shop, and the user clicks on an item to be purchased, then if that person has enough money to purchase the item, the item should be placed into some sort of a collection or array that can populate the user's inventory screen. Because of this mechanic, we will need to seek some sort of global array that will be able to hold an array of items that the player has purchased. To do this, go to the <span class="strong"><strong>FieldPlayer</strong></span> Event Graph and add a new text array named <span class="strong"><strong>arrayItem</strong></span>. Also, make sure that this variable is set to public and is editable:</p><div class="mediaobject"><img src="graphics/B04548_08_16.jpg" alt="Logical difference between the inventory and shop items"/></div></div>
<div class="section" title="Finishing the inventory screen"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec56"/>Finishing the inventory screen</h1></div></div></div><p>Navigate<a id="id480" class="indexterm"/> to the <span class="strong"><strong>Pause_Inventory</strong></span> Event Graph. While <span class="strong"><strong>Context Sensitive</strong></span> is off, bring in the <span class="strong"><strong>Get Array Item</strong></span> from the <span class="strong"><strong>Actions</strong></span> window by navigating to <span class="strong"><strong>Class</strong></span> | <span class="strong"><strong>Field Player</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_08_17.jpg" alt="Finishing the inventory screen"/></div><p>Once done, connect<a id="id481" class="indexterm"/> the <span class="strong"><strong>Target</strong></span> pin of <span class="strong"><strong>Array Item</strong></span> to <span class="strong"><strong>GET</strong></span> so that you can get every item that is sent to that array once we populate the array in the <span class="strong"><strong>Items</strong></span> Blueprint:</p><div class="mediaobject"><img src="graphics/B04548_08_18.jpg" alt="Finishing the inventory screen"/></div><p>Now that we have the array of items in the player's inventory, we will now loop through each element, and create an item from every element in the array. To do this, create a <span class="strong"><strong>ForEachLoop</strong></span> by navigating to <span class="strong"><strong>Utilities</strong></span> | <span class="strong"><strong>Array</strong></span>. Link <span class="strong"><strong>Array Item</strong></span> from your <span class="strong"><strong>arrayItem</strong></span> variable to the <span class="strong"><strong>Array</strong></span> tab in the <span class="strong"><strong>ForEachLoop</strong></span>. Then, have <span class="strong"><strong>SET Inventory Screen</strong></span> activate the <span class="strong"><strong>ForEachLoop</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_08_19.jpg" alt="Finishing the inventory screen"/></div><p>Just like what we did when populating the buttons for the shop, we would want this <code class="literal">for</code> loop to be responsible for adding buttons from the <span class="strong"><strong>Items</strong></span> Widget Blueprint. So, in the body of the <code class="literal">for</code> loop, we<a id="id482" class="indexterm"/> need to create the <span class="strong"><strong>Item</strong></span> widget by first navigating to <span class="strong"><strong>User Interface</strong></span> | <span class="strong"><strong>Create Widget</strong></span> in the <span class="strong"><strong>Actions</strong></span> window:</p><div class="mediaobject"><img src="graphics/B04548_08_20.jpg" alt="Finishing the inventory screen"/></div><p>Then, we need to change the <span class="strong"><strong>Class</strong></span> dropdown to <span class="strong"><strong>Item</strong></span>, and link it to <span class="strong"><strong>Loop Body</strong></span> in the <span class="strong"><strong>ForEachLoop</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_08_22.jpg" alt="Finishing the inventory screen"/></div><p>You will then need to set the text for each element in the array. So, open the <span class="strong"><strong>Actions</strong></span> window and with <span class="strong"><strong>Context Sensitive</strong></span> off, bring in <span class="strong"><strong>Set Item</strong></span> by navigating to <span class="strong"><strong>Class</strong></span> | <span class="strong"><strong>Item</strong></span>.</p><p>Link the <span class="strong"><strong>Item</strong></span> pin to the <span class="strong"><strong>Array Element</strong></span> pin from the <span class="strong"><strong>ForEachLoop</strong></span>. Then, set the <span class="strong"><strong>Target</strong></span> pin of <span class="strong"><strong>Set Item</strong></span> to the <span class="strong"><strong>Return Value</strong></span> of <span class="strong"><strong>Create Item Widget</strong></span> and have <span class="strong"><strong>Create Item Widget</strong></span> activate the <span class="strong"><strong>Set Item</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_08_23.jpg" alt="Finishing the inventory screen"/></div><p>Lastly, we will <a id="id483" class="indexterm"/>need to add the <span class="strong"><strong>Item</strong></span> widget to the Scroll Box that we created in <span class="strong"><strong>Pause_Inventory</strong></span>. Simply create an <span class="strong"><strong>Add Child</strong></span> node that is located at <span class="strong"><strong>Panels</strong></span> under <span class="strong"><strong>Widget</strong></span>. Then, link <span class="strong"><strong>ScrollBox_Inventory</strong></span> from your variables to the <span class="strong"><strong>Target</strong></span> pin of <span class="strong"><strong>Add Child</strong></span> (if you do not see <span class="strong"><strong>ScrollBox_Inventory </strong></span>as a default variable, make sure you go back into the Designer View of <span class="strong"><strong>Pause_Inventory</strong></span>, select the <span class="strong"><strong>ScrollBox_Inventory</strong></span>, and check <span class="strong"><strong>is variable</strong></span>, then have the <span class="strong"><strong>Content</strong></span> pin of <span class="strong"><strong>Add Child</strong></span> be the <span class="strong"><strong>Return Value</strong></span> of <span class="strong"><strong>Create Item Widget</strong></span>). Finally, have the <span class="strong"><strong>Set Item</strong></span> node start up the <span class="strong"><strong>Add Child</strong></span> node:</p><div class="mediaobject"><img src="graphics/B04548_08_24.jpg" alt="Finishing the inventory screen"/></div><p>When you are done, your <span class="strong"><strong>Pause_Inventory</strong></span> Blueprint will look like this:</p><div class="mediaobject"><img src="graphics/B04548_08_25.jpg" alt="Finishing the inventory screen"/></div></div>
<div class="section" title="Buying items"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec57"/>Buying items</h1></div></div></div><p>Head<a id="id484" class="indexterm"/> back into the <span class="strong"><strong>Item</strong></span> Blueprint. Where we left off before, we allowed that upon clicking a button, we would get all actors from the Field Player class. Here, we set up a branch that checks whether the <span class="strong"><strong>Inventory Screen</strong></span> Boolean is true or false (which means that we check whether the player is on the inventory screen; if they are not on the inventory screen, we will perform the buying logic in our shop).</p><p>Let's first bring in a <span class="strong"><strong>Get Data Table Row</strong></span> function located under <span class="strong"><strong>Utilities</strong></span> in the <span class="strong"><strong>Actions</strong></span> window:</p><div class="mediaobject"><img src="graphics/B04548_08_59.jpg" alt="Buying items"/></div><p>Then, set the Data Table to <span class="strong"><strong>Items_Shop</strong></span>. This will allow us to get every row from the <span class="strong"><strong>Items_Shop</strong></span> Data Table. Then, link the <span class="strong"><strong>False</strong></span> pin from the branch that we created to the execution of <span class="strong"><strong>Get Data Table Row</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_08_26.jpg" alt="Buying items"/></div><p>You may have noticed that we can select any row name from the Data Table. In this case, we just need to get<a id="id485" class="indexterm"/> the row name of the item that is currently selected. To do this, bring in <span class="strong"><strong>Get</strong></span> of the <span class="strong"><strong>Item</strong></span> text variable that you created in the previous chapter in this class. You need to link it to <span class="strong"><strong>Row Name</strong></span> in the <span class="strong"><strong>Get Data Table Row</strong></span> function, but these pins are not compatible. So, you need to first convert the text item to a string by left-clicking and dragging it from the <span class="strong"><strong>Item</strong></span> node and then navigating to <span class="strong"><strong>Utilities</strong></span> | <span class="strong"><strong>String</strong></span> | <span class="strong"><strong>To String (Text)</strong></span>. This will create the first conversion you need:</p><div class="mediaobject"><img src="graphics/B04548_08_27.jpg" alt="Buying items"/></div><p>Lastly, you can just link <a id="id486" class="indexterm"/>this converted string to the <span class="strong"><strong>Row Name</strong></span> pin in the <span class="strong"><strong>Get Data Table Row</strong></span> function:</p><div class="mediaobject"><img src="graphics/B04548_08_28.jpg" alt="Buying items"/></div><p>Once done, we have<a id="id487" class="indexterm"/> completed the logic for a specific item being selected in the shop. Now, we need to calculate the amount of gold that would be the <span class="emphasis"><em>value</em></span> of each item and subtract it from our total gold. To do this, we must first get the RPG instance of the game so that we can call the game gold. However, since we will need this instance for a number of other variables in this Blueprint, we may want the game instance to be called part of our constructor. Create an <span class="strong"><strong>Event Construct</strong></span> if you have not done so already. Next, link a <span class="strong"><strong>Cast To RPGGameInstance</strong></span> object located at <span class="strong"><strong>Casting</strong></span> under <span class="strong"><strong>Utilities</strong></span>. Then, link the <span class="strong"><strong>Get Game Instance</strong></span> object (located in the <span class="strong"><strong>Actions</strong></span> window under <span class="strong"><strong>Game</strong></span>) to the <span class="strong"><strong>Cast To RPGGameInstance</strong></span> object:</p><div class="mediaobject"><img src="graphics/B04548_08_29.jpg" alt="Buying items"/></div><p>Since we will eventually need to access character parameters, such as HP and MP, when applying our items to the <a id="id488" class="indexterm"/>player, we will need to get all the party members, and set a Character Target similar to what we did in previous chapters. To do this, create a new variable:</p><div class="mediaobject"><img src="graphics/B04548_08_30.jpg" alt="Buying items"/></div><p>Then, go to <span class="strong"><strong>Details</strong></span> | <span class="strong"><strong>Variable</strong></span>, call the <span class="strong"><strong>Character Target</strong></span> variable, and change its type to <span class="strong"><strong>Game Character</strong></span>, which will reference our game character within the party:</p><div class="mediaobject"><img src="graphics/B04548_08_31.jpg" alt="Buying items"/></div><p>Then, from<a id="id489" class="indexterm"/> the <span class="strong"><strong>As RPGGame Instance</strong></span> pin, drag out a line, and pick the <span class="strong"><strong>Get Party Members</strong></span> variable by navigating to <span class="strong"><strong>Variables</strong></span> | <span class="strong"><strong>Game Data</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_08_32.jpg" alt="Buying items"/></div><p>To <a id="id490" class="indexterm"/>the <span class="strong"><strong>Party Members</strong></span> array, link a <span class="strong"><strong>GET</strong></span> function. You need to link <span class="strong"><strong>GET</strong></span> to the Character Target. So, bring in a <span class="strong"><strong>SET</strong></span> version of the new Character Target variable that you created, and link the <span class="strong"><strong>GET</strong></span> function to the <span class="strong"><strong>Character Target</strong></span> pin in <span class="strong"><strong>SET Character Target</strong></span>. Lastly, have the <span class="strong"><strong>Cast To RPGGameInstance</strong></span> execute <span class="strong"><strong>SET Character Target</strong></span>. When you are finished setting up the reference to the game instance and game characters, your constructor will look like this:</p><div class="mediaobject"><img src="graphics/B04548_08_33.jpg" alt="Buying items"/></div><p>Now that we have set a reference to our current game instance, we can manipulate the gold. The next thing you need to do is navigate to your <span class="strong"><strong>Get Data Table Row</strong></span> function. Here, left-click and <a id="id491" class="indexterm"/>drag the <span class="strong"><strong>Out Row</strong></span> pin within the function, which will give you some limited options; one of these options is to create <span class="strong"><strong>Break ItemsData</strong></span>. This will allow you to access all of the data for each item. Once done, you will have a box that shows all of the data that we created in our <span class="strong"><strong>Items_Shop</strong></span> Data Table:</p><div class="mediaobject"><img src="graphics/B04548_08_34.jpg" alt="Buying items"/></div><p>The logic is very simple. Basically, if the user has enough money, allow them to purchase an item and subtract the cost of the item by their game gold. If they do not have enough money, do not let them purchase the item.</p><p>To do this, we will create a <span class="strong"><strong>Get Game Gold</strong></span> reference. This can be found by navigating to <span class="strong"><strong>Class</strong></span> | <span class="strong"><strong>RPGGame Instance</strong></span> if <span class="strong"><strong>Context Sensitive</strong></span> is unchecked:</p><div class="mediaobject"><img src="graphics/B04548_08_35.jpg" alt="Buying items"/></div><p>Once it is created, link the reference to <span class="strong"><strong>As RPGGame Instance</strong></span> in the <span class="strong"><strong>Cast To RPGGame Instance</strong></span>. You may also notice a <span class="strong"><strong>SET</strong></span> pin that sets <span class="strong"><strong>HP</strong></span> to <span class="strong"><strong>5</strong></span> in the following screenshot; you may add <a id="id492" class="indexterm"/>one or leave it alone. This will just indicate that the player starts with 5 HP; this is being done for testing purposes when we test the player consuming a potion; if you decide to use <span class="strong"><strong>Set HP</strong></span> for testing purposes, remember to remove it when you finish play testing:</p><div class="mediaobject"><img src="graphics/B04548_08_36.jpg" alt="Buying items"/></div><p>Now, we will subtract the game gold from the cost of the item being purchased. So, simply create a math function that subtracts an integer from an integer. This math function can be found by navigating to <span class="strong"><strong>Math</strong></span> | <span class="strong"><strong>Integer</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_08_37.jpg" alt="Buying items"/></div><p>To do the math correctly, we will need to link the game gold to the top pin of the minus function and the gold from <span class="strong"><strong>ItemsData</strong></span> to the lower pin. This will subtract our game gold from the cost of the item:</p><div class="mediaobject"><img src="graphics/B04548_08_38.jpg" alt="Buying items"/></div><p>Here, we need to<a id="id493" class="indexterm"/> check whether the player has enough money to purchase the item. So, we will check whether the final product is less than 0. If it is, we will not allow the player to make the purchase. To make this check, simply use another math function, named <span class="strong"><strong>Integer &lt; Integer</strong></span>, located at <span class="strong"><strong>Integer</strong></span> under <span class="strong"><strong>Math</strong></span>. You will then compare the final product of the subtraction with 0, as shown here:</p><div class="mediaobject"><img src="graphics/B04548_08_39.jpg" alt="Buying items"/></div><p>Next, create a branch by navigating to <span class="strong"><strong>Utilities</strong></span> | <span class="strong"><strong>Flow Control</strong></span>, and link the condition to the condition of the <span class="strong"><strong>Integer &lt; Integer</strong></span> function you just created. Then, link the <span class="strong"><strong>Row Found</strong></span> pin from the <span class="strong"><strong>Get Data Table Row</strong></span> to execute the branch so that if a row is found, the math can occur:</p><div class="mediaobject"><img src="graphics/B04548_08_40.jpg" alt="Buying items"/></div><p>If the final result is not<a id="id494" class="indexterm"/> less than 0, then we need to set the game gold to the subtraction product. To do this, bring in the <span class="strong"><strong>SET Game Gold</strong></span> function by navigating to <span class="strong"><strong>Class</strong></span> | <span class="strong"><strong>RPGGame Instance</strong></span> in the <span class="strong"><strong>Actions</strong></span> window with <span class="strong"><strong>Context Sensitive</strong></span> off:</p><div class="mediaobject"><img src="graphics/B04548_08_41.jpg" alt="Buying items"/></div><p>Link the <span class="strong"><strong>Target</strong></span> pin of <span class="strong"><strong>Set Game Gold</strong></span> to the <span class="strong"><strong>As RPGGame Instance</strong></span> pin from the <span class="strong"><strong>Cast to RPGGame Instance</strong></span> function. Then, link the <span class="strong"><strong>Game Gold</strong></span> pin to the final product of the subtraction operation to get the remaining game gold:</p><div class="mediaobject"><img src="graphics/B04548_08_42.jpg" alt="Buying items"/></div><p>The last thing we need<a id="id495" class="indexterm"/> to do is link everything correctly. The remaining link is from the branch; if the less than condition returns false, then it means that we have enough money to buy the product, and we can change the game gold. So, next, link the <span class="strong"><strong>False</strong></span> pin from the branch to execute <span class="strong"><strong>SET Game Gold</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_08_43.jpg" alt="Buying items"/></div><p>If you were to test <a id="id496" class="indexterm"/>this now, you would notice that items can be purchased flawlessly from the shop. However, the problem is that the items are never being populated from the shop to the player's inventory. This is a simple fix. Earlier in this chapter, we already set our inventory screen to be able to get an array that can be stored in the Field Player. We will simply use this array to add the items that we buy to the array, and then, retrieve these items when we open our inventory:</p><div class="mediaobject"><img src="graphics/B04548_08_44.jpg" alt="Buying items"/></div><p>Since we already have a way to gather variables from the Field Player, we will bring in the <span class="strong"><strong>Get Array Item</strong></span> variable by navigating to <span class="strong"><strong>Class</strong></span> | <span class="strong"><strong>Field Player</strong></span>.</p><p>We will link the <span class="strong"><strong>Target</strong></span> pin of <span class="strong"><strong>Array Item</strong></span> to the <span class="strong"><strong>GET</strong></span> of the <span class="strong"><strong>Get All Actors Of Class</strong></span> function so that we have full access over the <code class="literal">arrayItem</code> variable. We will then bring in an <span class="strong"><strong>Add</strong></span> function by navigating to <span class="strong"><strong>Utilities</strong></span> | <span class="strong"><strong>Array</strong></span> in the <span class="strong"><strong>Actions</strong></span> window:</p><div class="mediaobject"><img src="graphics/B04548_08_45.jpg" alt="Buying items"/></div><p>The <span class="strong"><strong>Add</strong></span> function will <a id="id497" class="indexterm"/>allow you to add elements to an array while dynamically increasing its size (such as a list). To use this, you will link the array that you want to populate; in this case, <span class="strong"><strong>Array Item</strong></span>. Then, you will need to link the item that you want to add to the array; in this case, <span class="strong"><strong>Item</strong></span>. Lastly, you will need to execute <span class="strong"><strong>Add</strong></span>. We will execute it after the <span class="strong"><strong>Gold</strong></span> value is set. In essence, after the player buys the item, the item will then be added to their inventory:</p><div class="mediaobject"><img src="graphics/B04548_08_46.jpg" alt="Buying items"/></div><p>Your buying mechanics <a id="id498" class="indexterm"/>are now complete, and you can now test your shop. You will notice that items can be purchased and these purchased items populate your inventory.</p></div>
<div class="section" title="Using items"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec58"/>Using items</h1></div></div></div><p>Now that <a id="id499" class="indexterm"/>you have allowed items to populate the inventory, it is now time to make these items work. At this moment, you should still have a branch at the beginning of your item's <span class="strong"><strong>onClicked</strong></span> button. So far, your branch just goes through a false routine because this routine indicates that the player is interacting with the buttons if they are in the shop. It is now time to create a routine for when the <span class="strong"><strong>Inventory Screen</strong></span> Boolean is true, which means that the player is on the inventory screen.</p><p>The initial steps between where we created a <span class="strong"><strong>Get Data Table Row</strong></span> function and set it to the <span class="strong"><strong>Item_Shop</strong></span> Data Table (which takes an item row name and breaks the items into item data) are identical to our previous steps. So, we can simply copy and paste those portions from our previous steps into an empty area in this Blueprint:</p><div class="mediaobject"><img src="graphics/B04548_08_47.jpg" alt="Using items"/></div><p>Next, we will<a id="id500" class="indexterm"/> link the <span class="strong"><strong>True</strong></span> pin from our initial branch (that is activated by the <span class="strong"><strong>Get All Actors Of Class</strong></span> function) to execute the <span class="strong"><strong>Get Data Table Row</strong></span> function:</p><div class="mediaobject"><img src="graphics/B04548_08_48.jpg" alt="Using items"/></div><p>We will implement logic that is very similar to the logic that we implemented when purchasing items; but this time, we want to make sure that the user gets the correct amount set to them <a id="id501" class="indexterm"/>when using an item. Let's first start with the potion. The potion only uses the HP data. So, what we will need to do is add the HP data from the potion to the character's current HP. To do this, we will first need a Character Target variable. So, bring in a <span class="strong"><strong>Get Character Target</strong></span> function from your <span class="strong"><strong>Variable</strong></span> list:</p><div class="mediaobject"><img src="graphics/B04548_08_49.jpg" alt="Using items"/></div><p>Once you do this, link the <span class="strong"><strong>Character Target</strong></span> variable to <span class="strong"><strong>Get HP</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_08_50.jpg" alt="Using items"/></div><p>Now that you have <a id="id502" class="indexterm"/>access to the current player's HP, you can bring in the <span class="strong"><strong>Integer + Integer</strong></span> function by navigating to <span class="strong"><strong>Math</strong></span> | <span class="strong"><strong>Integer</strong></span>. Simply link the <span class="strong"><strong>HP</strong></span> pin from the <span class="strong"><strong>Break ItemsData</strong></span> node to the top pin in the <span class="strong"><strong>Integer + Integer</strong></span> function, and link the character HP to the bottom pin of the <span class="strong"><strong>Integer + Integer</strong></span> node:</p><div class="mediaobject"><img src="graphics/B04548_08_51.jpg" alt="Using items"/></div><p>Here, we need to check whether the product of the addition is less than the character's maximum HP. If it is, we<a id="id503" class="indexterm"/> can use the potion. If it is not, we cannot use the potion. So, let's first bring in the <span class="strong"><strong>Get MHP</strong></span> variable from <span class="strong"><strong>Character Target</strong></span>, which shows what the character's maximum HP is like:</p><div class="mediaobject"><img src="graphics/B04548_08_52.jpg" alt="Using items"/></div><p>Now, we will need to bring in a condition that checks whether an integer is less than another integer. This <a id="id504" class="indexterm"/>can be found in the <span class="strong"><strong>Actions</strong></span> window by navigating to <span class="strong"><strong>Math</strong></span> | <span class="strong"><strong>Integer</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_08_53.jpg" alt="Using items"/></div><p>Next, link the final addition product to the upper pin of the <span class="strong"><strong>Integer &lt; Integer</strong></span> condition, and link <span class="strong"><strong>MHP</strong></span> to the lower pin:</p><div class="mediaobject"><img src="graphics/B04548_08_54.jpg" alt="Using items"/></div><p>We will now make a branch that checks our condition. This branch should be activated only if a row is found (or if the user clicks on an actual item):</p><div class="mediaobject"><img src="graphics/B04548_08_55.jpg" alt="Using items"/></div><p>If the total HP is less than the<a id="id505" class="indexterm"/> maximum HP, then this would mean that the condition is true, and we need to remove the item from the inventory using the <span class="strong"><strong>Remove from Parent</strong></span> function located under <span class="strong"><strong>Widget</strong></span>. Then, we need to use the <span class="strong"><strong>SET HP</strong></span> function by navigating to <span class="strong"><strong>Class</strong></span> | <span class="strong"><strong>Game Character</strong></span> and making it equal to the addition of the product item HP and character HP. We will also need to link the <span class="strong"><strong>Target</strong></span> pin of the <span class="strong"><strong>SET HP</strong></span> function to the reference to <span class="strong"><strong>Character Target</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_08_56.jpg" alt="Using items"/></div><p>If you test this now, the character will be able to use potions, and the potions will be removed on use, but the user won't be able to fully heal because we are only testing to see whether the product of our addition is more than the maximum HP, which only accounts for situations where a potion's healing properties are not fully used. Therefore, the character may never be able to be 100% recovered. To fix this, we will simply create a routine for the <span class="strong"><strong>False</strong></span> branch that will remove the item from the parent, and then, automatically set the HP to the maximum HP. This will solve our problem of not being able to heal<a id="id506" class="indexterm"/> our character all the way to their maximum health:</p><div class="mediaobject"><img src="graphics/B04548_08_57.jpg" alt="Using items"/></div><p>When you are done with this, your HP-based items' Blueprint will look like this:</p><div class="mediaobject"><img src="graphics/B04548_08_58.jpg" alt="Using items"/></div><p>If you test this now, you will notice that all of your potions work perfectly in your inventory. The last<a id="id507" class="indexterm"/> potion that we did not finish is the ether, but the ether logic is exactly the same as the potion logic, though instead of checking the effects of HP, you are checking the effects of MP. Note that this logic is not specific to any one item, it is dynamic to the point where any item that affects these stats will run using this logic. So, if later on you have a mega potion, you will not have to redo any logic or add new logic, the mega potion is still considered an item and will apply the correct amount of HP that was given to it through the Data Table.</p></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec59"/>Summary</h1></div></div></div><p>At this point, you now have your currency system that interacts with an NPC. You are able to buy items from the NPC and stock as many items as you want in your inventory, and then correctly use them. Using this knowledge, you should easily be able to create more items throughout the game using the same strategies that we covered in the last couple of chapters.</p><p>In the next chapter, we will dig deeper into useable items and work with equipping weapons and armor, which will temporarily change the stats of a player.</p></div></body></html>