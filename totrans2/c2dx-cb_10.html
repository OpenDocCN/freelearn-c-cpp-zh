<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch10"/>Chapter 10. Improving Games with Extra Features</h1></div></div></div><p>The following topics will be covered in this chapter:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Using Texture Packer</li><li class="listitem" style="list-style-type: disc">Using Tiled Map Editor</li><li class="listitem" style="list-style-type: disc">Getting the property of the object in the tiled map</li><li class="listitem" style="list-style-type: disc">Using Physics Editor</li><li class="listitem" style="list-style-type: disc">Using Glyph Designer</li></ul></div><div><div><div><div><h1 class="title"><a id="ch10lvl1sec78"/>Introduction</h1></div></div></div><p>For a long time, there have been a lot of tools available to you that help you in game development. Some of these tools can be used in Cocos2d-x. With the use of these tools, you can quickly and efficiently develop your game. You can, for example, use original fonts and create sprite sheets, a map like a role-playing game, complex physical objects, and so on. In this chapter, you will learn how to use these extra tools in your game development.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch10lvl1sec79"/>Using Texture Packer</h1></div></div></div><p>
<strong>Texture Packer</strong><a id="id362" class="indexterm"/> is a tool that can drag and drop images and publish. With the use of this tool, we can not only create sprite sheets, but also export multi sprite sheets. If there are a lot of sprites, then we need to use the command line tool when we create sprite sheets, encrypt them, and so on. In this recipe, you can use Texture Packer.</p><div><div><div><div><h2 class="title"><a id="ch10lvl2sec214"/>Getting ready</h2></div></div></div><p>Texture Packer<a id="id363" class="indexterm"/> is a paid application. However, you can use the free trial version. If you don't have it, you can download it by visiting <a class="ulink" href="https://www.codeandweb.com/texturepacker">https://www.codeandweb.com/texturepacker</a>
</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec215"/>How to do it...</h2></div></div></div><div><ol class="orderedlist arabic"><li class="listitem">You need to <a id="id364" class="indexterm"/>launch Texture Packer, after which you will see a blank window appear.<div><img src="img/B0561_10_01.jpg" alt="How to do it..."/></div></li><li class="listitem">In this recipe, we will use these sprites as shown in the following screenshot:<div><img src="img/B0561_10_02.jpg" alt="How to do it..."/></div></li><li class="listitem">You simply<a id="id365" class="indexterm"/> need to drag the images into the Texture Packer window and it will automatically read all the files and arrange them.<div><img src="img/B0561_10_03.jpg" alt="How to do it..."/></div></li><li class="listitem">And that's it. So let's publish the sprite sheet image and <code class="literal">plist</code> to click the <strong>publish</strong> button. That's how you can get the sprite sheet image and <code class="literal">plist</code>.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec216"/>How it works...</h2></div></div></div><p>You can get the <a id="id366" class="indexterm"/>sprite sheet image and <code class="literal">plist</code> file. In this part, we explain how to publish the sprite sheet for all devices with a single click.</p><div><ol class="orderedlist arabic"><li class="listitem">Click on the <strong>AutoSD</strong> button with the gear icon, and you will see an additional window appear, as shown in the following screenshot:<div><img src="img/B0561_10_04.jpg" alt="How it works..."/></div></li><li class="listitem">Select the <strong>cocos2d-x HDR/HD/SD</strong> and click the <strong>Apply</strong> button. After clicking it, setting the default scale, extension, size and so on like in the following image:<div><img src="img/B0561_10_05.jpg" alt="How it works..."/></div></li><li class="listitem">Next, you<a id="id367" class="indexterm"/> have to click the <strong>publish</strong> button, you will see the window to select the data file name. The important thing is to select the folder named <code class="literal">HDR</code> as in the following image:<div><img src="img/B0561_10_06.jpg" alt="How it works..."/></div></li><li class="listitem">Finally, you <a id="id368" class="indexterm"/>will get three size sprite sheets automatically as in the following image:<div><img src="img/B0561_10_07.jpg" alt="How it works..."/></div></li></ol></div><p>The sprite sheet <a id="id369" class="indexterm"/>in <code class="literal">HDR</code> folder is the largest size. The images that were dragged and dropped are HDR images. These images are good for resizing to HD or SD images.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec217"/>There's more…</h2></div></div></div><p>You can use the <a id="id370" class="indexterm"/>Texture Packer on the command like like this:</p><div><pre class="programlisting">texturepacker foo_*.png --format cocos2d --data hoge.plist --sheet hoge.png</pre></div><p>The preceding command is to make a sprite sheet named <code class="literal">hoge.plist</code> and <code class="literal">hoge.png</code> by using images named <code class="literal">foo_*.png</code>. For example, if there were <code class="literal">foo_1.png</code> to <code class="literal">foo_10.png</code> in a folder, then the sprite sheet is created from these 10 images.</p><p>In addition, the command has other options as in the following table:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Option</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">--help</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Display help text</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">--version</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Print version information</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">--max-size</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Set the maximum texture size</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">--format cocos2d</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Format to write, default is cocos2d</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">--data</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Name of the data file to write</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">--sheet</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Name of the sheet to write</p>
</td></tr></tbody></table></div><p>There are a lot of<a id="id371" class="indexterm"/> options other than that. You can see another options by using the following command:</p><div><pre class="programlisting">texturepacker --help</pre></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch10lvl1sec80"/>Using Tiled Map Editor</h1></div></div></div><p>A tiled map is a grid <a id="id372" class="indexterm"/>of cells where the value in the cell indicates what should be at the location. For example, (0,0) is a road, (0,1) is a grass, (0,2) is a river and so on. Tiled maps are very useful but they are pretty hard to create by hand. <strong>Tiled</strong> is a tool that can be used to just create tiled maps. Tiled is a free application. However, this application is a very powerful, useful and popular tool. There are various kinds of Tiled Map, for example, 2D maps such as Dragon Quest, Horizontal scrolling game map such as Super Mario and so on. In this recipe, you can basically use texture packer.</p><div><div><div><div><h2 class="title"><a id="ch10lvl2sec218"/>Getting ready</h2></div></div></div><p>If you don't have<a id="id373" class="indexterm"/> Tiled Map Editor, you can download it from <a class="ulink" href="https://www.mapeditor.org/">https://www.mapeditor.org/</a>.</p><p>And then, after downloading it, you will install the application and copy the <code class="literal">example</code> folder in the <code class="literal">dmg</code> file, into the working space of your computer.</p><p>Tiled Map Editor is free application. However, you can donate to this software if you like.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec219"/>How to do it...</h2></div></div></div><p>In this part, we explain how to create a new map from scratch with the Tiled tool.</p><div><ol class="orderedlist arabic"><li class="listitem">Launch Tiled and selecting <strong>File</strong> | <strong>New</strong> in the menu. Open the new additional window as in the following image:<div><img src="img/B0561_10_08.jpg" alt="How to do it..."/></div></li><li class="listitem">Select <a id="id374" class="indexterm"/>XML in <strong>Tile layer format</strong> and change <strong>Width</strong> and <strong>Height</strong> in <strong>Map size</strong> to 50 tiles. Finally, click <strong>OK</strong>. So you can see the Tiled's window as in the following image:<div><img src="img/B0561_10_09.jpg" alt="How to do it..."/></div></li><li class="listitem">Select <a id="id375" class="indexterm"/><strong>Map</strong> | <strong>New Tileset…</strong> in the menu. You can select the tileset window. Select the tileset image by clicking the <strong>Browse…</strong> button in the middle of the window. In this case, you will select <code class="literal">tmw_desert_spacing.png</code> file in Tiled's <code class="literal">example</code> folder. This tileset has tiles with a width and height of 32px and a margin and spacing of 1px. So you have to change these values as shown in the following screenshot:<div><img src="img/B0561_10_10.jpg" alt="How to do it..."/></div></li><li class="listitem">Finally, click<a id="id376" class="indexterm"/> on the <strong>OK</strong> button, and you will see the new editor window as shown in the following screenshot:<div><img src="img/B0561_10_11.jpg" alt="How to do it..."/></div></li><li class="listitem">Next, let's try<a id="id377" class="indexterm"/> to paint the ground layer using the tile that you selected. Select the tile from the right and lower panes, and select the bucket icon in the tool bar. Then, click on the map, and you will see the ground painted with the same tile.<div><img src="img/B0561_10_12.jpg" alt="How to do it..."/></div></li><li class="listitem">You can arrange <a id="id378" class="indexterm"/>the tiles on the map. Select the tile in the lower right pane and select the stamp icon in the tool bar. Then, click on the map. That's how you can put the tile on the map.<div><img src="img/B0561_10_13.jpg" alt="How to do it..."/></div></li><li class="listitem">After you have finished <a id="id379" class="indexterm"/>arranging the map, you need to save it as a new file. Go to <strong>File</strong> | <strong>Save as…</strong> in the menu and save the new file that you made. To use Cococs2d-x, you have to add the <code class="literal">tmx</code> file and tileset image file into the <code class="literal">Resources/res</code> folder in your project. In this recipe, we added <code class="literal">desert.tmx</code> and <code class="literal">tmw_desert_spacing.png</code> in Tiled's <code class="literal">example</code> folder.<div><img src="img/B0561_10_14.jpg" alt="How to do it..."/></div></li><li class="listitem">From now on, you <a id="id380" class="indexterm"/>have to work in Xcode. Edit the <code class="literal">HelloWorld::init</code> method as shown in the following code:<div><pre class="programlisting">bool HelloWorld::init()
{
    if ( !Layer::init() )
    {
        return false;
    }
    Vec2 origin = Director::getInstance()- &gt;getVisibleOrigin();
    _map = TMXTiledMap::create("res/desert.tmx");
    _map-&gt;setPosition(Vec2()+origin);
    this-&gt;addChild(_map);

    return true;
}</pre></div></li><li class="listitem">After building and running, you can see the following image on the simulator or devices:</li></ol></div><div><img src="img/B0561_10_15.jpg" alt="How to do it..."/></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec220"/>How it works...</h2></div></div></div><p>The files that Tiled map<a id="id381" class="indexterm"/> needs are the <code class="literal">tmx</code> file and tileset image file. That's why you have to add these files into your project. You can see the Tiled map object  using the <code class="literal">TMXTiledMap</code> class. You have to specify the <code class="literal">tmx</code> file path to the <code class="literal">TMXTiledMap::create</code> method. The <code class="literal">TMXTiledMap</code> object is Node. You can see the tiled map only when you add the <code class="literal">TMXTiledMap</code> object using the <code class="literal">addChild</code> method.</p><div><pre class="programlisting">_map = TMXTiledMap::create("res/desert.tmx");
_map-&gt;setPosition(Vec2()+origin);
this-&gt;addChild(_map);</pre></div><div><div><h3 class="title"><a id="tip17"/>Tip</h3><p>
<code class="literal">TMXTileMap</code> object's anchor position is <code class="literal">Vec2(0,0)</code>. The normal node's anchor position is <code class="literal">Vec2(0.5f, 0.5f)</code>.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec221"/>There's more…</h2></div></div></div><p>The tiled map is huge. So, we try to move the map by scrolling it. In this case, you touch the screen and scroll the map by the distance from the touching point to the center of the screen.</p><div><ol class="orderedlist arabic"><li class="listitem">Add the following code in the <code class="literal">HelloWorld::init</code> method:<div><pre class="programlisting">auto touchListener = EventListenerTouchOneByOne::create();
touchListener-&gt;onTouchBegan = CC_CALLBACK_2(HelloWorld::onTouchBegan, this);
touchListener-&gt;onTouchEnded = CC_CALLBACK_2(HelloWorld::onTouchEnded, this);
_eventDispatcher- &gt;addEventListenerWithSceneGraphPriority(touchListener, this);</pre></div></li><li class="listitem">Define the <code class="literal">touch</code> method and some properties in <code class="literal">HelloWorldScene.h</code> as shown in the following code:<div><pre class="programlisting">bool onTouchBegan(cocos2d::Touch* touch, cocos2d::Event* event);
void onTouchEnded(cocos2d::Touch* touch, cocos2d::Event* event);
void update(float dt);
cocos2d::Vec2 _location;
cocos2d::TMXTiledMap* _map;</pre></div></li><li class="listitem">Add the touch<a id="id382" class="indexterm"/> method in <code class="literal">HelloWorldScene.cpp</code> as shown in the following code:<div><pre class="programlisting">bool HelloWorld::onTouchBegan(Touch* touch, Event* event)
{
    return true;
}

void HelloWorld::onTouchEnded(Touch* touch, Event* event)
{
    auto size = Director::getInstance()-&gt;getVisibleSize();
    auto origin = Director::getInstance()- &gt;getVisibleOrigin();
    auto center = Vec2(size/2)+origin;
    _location = touch-&gt;getLocation() - center;
    _location.x = floorf(_location.x);
    _location.y = floorf(_location.y);
    this-&gt;scheduleUpdate();
}</pre></div></li><li class="listitem">Finally, add the <code class="literal">update</code> method in <code class="literal">HelloWorldScene.cpp</code> as shown in the following code:<div><pre class="programlisting">void HelloWorld::update(float dt)
{
    auto mapSize = _map-&gt;getContentSize();
    auto winSize = Director::getInstance()- &gt;getVisibleSize();
    auto origin = Director::getInstance()- &gt;getVisibleOrigin();

    auto currentLocation = _map-&gt;getPosition();
    if (_location.x &gt; 0) {
        currentLocation.x--;
        _location.x--;
    } else if (_location.x &lt; 0) {
        currentLocation.x++;
        _location.x++;
    }
    if (_location.y &gt; 0) {
        currentLocation.y--;
        _location.y--;
    } else if (_location.y &lt; 0) {
        currentLocation.y++;
        _location.y++;
    }

    if (currentLocation.x &gt; origin.x) {
        currentLocation.x = origin.x;
    } else if (currentLocation.x &lt; winSize.width + origin.x - mapSize.width) {
        currentLocation.x = winSize.width + origin.x - mapSize.width;}
    if (currentLocation.y &gt; origin.y) {
        currentLocation.y = origin.y;
    } else if (currentLocation.y &lt; winSize.height + origin.y - mapSize.height) {currentLocation.y = winSize.height + origin.y - mapSize.height;}

    _map-&gt;setPosition(currentLocation);
    if (fabsf(_location.x)&lt;1.0f &amp;&amp; fabsf(_location.y)&lt;1.0f) {
        this-&gt;unscheduleUpdate();
    }
}</pre></div></li></ol></div><p>After that, run this project and<a id="id383" class="indexterm"/> touch the screen. This is how you can move the map in the direction that you swipe.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch10lvl1sec81"/>Getting the property of the object in the tiled map</h1></div></div></div><p>Now, you can move the <a id="id384" class="indexterm"/>Tiled map. However, you might notice the object on the map. For example, if there is a wood or wall in the direction of movement, you can't move in that direction beyond that object. In this recipe, you will notice the object on the map by getting the property of it.</p><div><div><div><div><h2 class="title"><a id="ch10lvl2sec222"/>Getting ready</h2></div></div></div><p>In this recipe, you will make a new property of the tree object and set a value to it.</p><div><ol class="orderedlist arabic"><li class="listitem">Launch the Tiled application and reopen the <code class="literal">desert.tmx</code> file.</li><li class="listitem">Select the tree object in the <strong>Tilesets</strong> window.</li><li class="listitem">Add a new property by clicking on the plus icon in the lower left corner in the <strong>Properties</strong> window. Then, a window will pop up specifying the property's name. Enter <code class="literal">isTree</code> in the text area.</li><li class="listitem">After you name the new property, it will be shown in the properties list. However, you will find that its value is empty. So, you have to set the new value to it. In this case, you need to set a true value as shown in the following image:<div><img src="img/B0561_10_16.jpg" alt="Getting ready"/></div></li><li class="listitem">Save it and update <code class="literal">desert.tmx</code> in your project.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec223"/>How to do it...</h2></div></div></div><p>In this recipe, you will get <a id="id385" class="indexterm"/>the property of the object that you <a id="id386" class="indexterm"/>touched.</p><div><ol class="orderedlist arabic"><li class="listitem">Edit the <code class="literal">HelloWorld::init</code> method to show the tiled map and add the event listener for touching.<div><pre class="programlisting">bool HelloWorld::init()
{
    if ( !Layer::init() )
    {
        return false;
    }
    Vec2 origin = Director::getInstance()-&gt;getVisibleOrigin();
    _map = TMXTiledMap::create("res/desert.tmx");
    _map-&gt;setPosition(Vec2()+origin);
    this-&gt;addChild(_map);

    auto touchListener = EventListenerTouchOneByOne::create();
    touchListener-&gt;onTouchBegan = CC_CALLBACK_2(HelloWorld::onTouchBegan, this);
    _eventDispatcher- &gt;addEventListenerWithSceneGraphPriority(touchListener, this);

    return true;
}</pre></div></li><li class="listitem">Add the <code class="literal">HelloWorld::getTilePosition</code> method. You can get the tile's grid row/column position if you called this method by specifying the touch position.<div><pre class="programlisting">Vec2 HelloWorld::getTilePosition(Vec2 point)
{
    auto mapContentSize = _map-&gt;getContentSize();
    auto tilePoint = point - _map-&gt;getPosition();
    auto tileSize = _map-&gt;getTileSize();
    auto mapRowCol = _map-&gt;getMapSize();
    auto scale = mapContentSize.width / (mapRowCol.width * tileSize.width);
    tilePoint.x = floorf(tilePoint.x / (tileSize.width * scale));
    tilePoint.y = floorf((mapContentSize.height - tilePoint.y)/(tileSize.height*scale));
    return tilePoint;
}</pre></div></li><li class="listitem">Finally, you can get the properties of the object that you touch. Add the <code class="literal">HelloWorld::onTouchBegan</code> method as shown in the following code:<div><pre class="programlisting">bool HelloWorld::onTouchBegan(Touch* touch, Event* event)
{
    auto touchPoint = touch-&gt;getLocation();
    auto tilePoint = this-&gt;getTilePosition(touchPoint);
    TMXLayer* groundLayer = _map-&gt;getLayer("Ground");
    int gid = groundLayer-&gt;getTileGIDAt(tilePoint);
    if (gid!=0) {
        auto properties = _map- &gt;getPropertiesForGID(gid).asValueMap();
        if (properties.find("isTree")!=properties.end()) {
            if(properties.at("isTree").asBool()) {
                CCLOG("it's tree!");
            }
        }
    }
    return true;
}</pre></div></li></ol></div><p>Let's build and <a id="id387" class="indexterm"/>run this project. If you touched the tree to<a id="id388" class="indexterm"/> which you set the new <code class="literal">isTree</code> property, you can see <em>it's tree!</em> in the log.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec224"/>How it works...</h2></div></div></div><p>There are two points in this recipe. The first point is getting the tile's row/column position on the tiled map. The second point is getting the properties of the object on the tiled map.</p><p>Firstly, let's explain how to get the tiles' row/column position on the tiled map.</p><div><ol class="orderedlist arabic"><li class="listitem">Get the map size using the <code class="literal">TMXTiledMap::getContentSize</code> method.<div><pre class="programlisting">auto mapContentSize = _map-&gt;getContentSize();</pre></div></li><li class="listitem">Calculate the <code class="literal">point</code> on the map from the touching point and map position.<div><pre class="programlisting">auto tilePoint = point - _map-&gt;getPosition();</pre></div></li><li class="listitem">Get the tile size using the <code class="literal">TMXTiledMap::getTileSize</code> method.<div><pre class="programlisting">auto tileSize = _map-&gt;getTileSize();</pre></div></li><li class="listitem">Get the row/column of the tile in the map using the <code class="literal">TMXTiledMap::getMapSize</code> method.<div><pre class="programlisting">auto mapRowCol = _map-&gt;getMapSize();</pre></div></li><li class="listitem">Get the magnification display using the original size called <code class="literal">mapContentSize</code> and real size calculated by the column's width and tile's width.<div><pre class="programlisting">auto scale = mapContentSize.width / (mapRowCol.width * tileSize.width);</pre></div></li><li class="listitem">The origin<a id="id389" class="indexterm"/> of coordinates for the tiles is<a id="id390" class="indexterm"/> located in the upper left corner. That's why the tile's row/column position of the tile that you touched is calculated using the tile's size, the row, and magnification display as shown in the following code:<div><pre class="programlisting">tilePoint.x = floorf(tilePoint.x / (tileSize.width * scale));
tilePoint.y = floorf((mapContentSize.height - tilePoint.y)/(tileSize.height*scale));</pre></div><p>
<code class="literal">tilePoint.x</code> is the column position and <code class="literal">tilePoint.y</code> is row position.</p></li></ol></div><p>Next, let's take a look at how to get the properties of the object on the Tiled map.</p><div><ol class="orderedlist arabic"><li class="listitem">Get the row/column position of the tile that you touched using the touching point.<div><pre class="programlisting">auto touchPoint = touch-&gt;getLocation();
auto tilePoint = this-&gt;getTilePosition(touchPoint);</pre></div></li><li class="listitem">Get the layer called <code class="literal">"Ground"</code> from the tiled map.<div><pre class="programlisting">TMXLayer* groundLayer = _map-&gt;getLayer("Ground");</pre></div></li><li class="listitem">There are the objects on this layer called <code class="literal">Ground</code>. Get the <code class="literal">TileGID</code> from this layer using row/column of the tile.<div><pre class="programlisting">int gid = groundLayer-&gt;getTileGIDAt(tilePoint);</pre></div></li><li class="listitem">Finally, get the properties as <code class="literal">ValueMap</code> from the map using the <code class="literal">TMXTiledMap::getPropertiesForGID</code> method. Then, get the <code class="literal">isTree</code> property's value from them as shown in the following code:<div><pre class="programlisting">auto properties = _map-&gt;getPropertiesForGID(gid).asValueMap();
if (properties.find("isTree")!=properties.end()) {
    if(properties.at("isTree").asBool()) {
        CCLOG("it's tree!");
    }
}</pre></div></li></ol></div><p>In this recipe, we showed only the log. However, in your real game, you will add the point to the object, explosions and so on.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch10lvl1sec82"/>Using Physics Editor</h1></div></div></div><p>In <a class="link" href="ch09.html" title="Chapter 9. Controlling Physics">Chapter 9</a>, <em>Controlling Physics</em>, you learned about <a id="id391" class="indexterm"/>
<strong>Physics Engine</strong>. We can create physics bodies to use Cocos2d-x API. However, we can only create a circle shape or a box shape. Actually, you have to use complex shapes in real games. In this recipe, you will learn how to create a lot<a id="id392" class="indexterm"/> of shapes using <strong>Physics Editor</strong>.</p><div><div><div><div><h2 class="title"><a id="ch10lvl2sec225"/>Getting ready</h2></div></div></div><p>Physics Editor is created by the same company that created Texture Packer. Physics Editor is a paid application. But you can use a free trial version. If you don't have it, you can download it by<a id="id393" class="indexterm"/> visiting the <a class="ulink" href="https://www.codeandweb.com/physicseditor">https://www.codeandweb.com/physicseditor</a>
</p><p>Here, you prepare the image to use this tool. Here, we will use the following image that is similar to a gear. This image's name is <code class="literal">gear.png</code>.</p><div><img src="img/B0561_10_17.jpg" alt="Getting ready"/></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec226"/>How to do it...</h2></div></div></div><p>First of all, you will create a physics file to use Physics Editor.</p><div><ol class="orderedlist arabic"><li class="listitem">Launch Physics Editor. Then, drag the image <code class="literal">gear.png</code> to the left pane.<div><img src="img/B0561_10_18.jpg" alt="How to do it..."/></div></li><li class="listitem">Click on the <a id="id394" class="indexterm"/>shaper tracer icon that is the third icon from the left in the tool bar. The shaper tracer icon is shown in the following image:<div><img src="img/B0561_10_a1.jpg" alt="How to do it..."/></div></li><li class="listitem">After this, you can see the pop-up window as shown in the following image:<div><img src="img/B0561_10_19.jpg" alt="How to do it..."/></div><p>You can <a id="id395" class="indexterm"/>change the <strong>Tolerance</strong> value. If the <strong>Vertexes</strong> value is too big, the renderer is slow. So you set the suitable <strong>Vertexes</strong> value to change the <strong>Tolerance</strong> value. Finally, click on the <strong>OK</strong> button. You will see the following:</p><div><img src="img/B0561_10_20.jpg" alt="How to do it..."/></div></li><li class="listitem">Select <code class="literal">Cocos2d-x</code> in <a id="id396" class="indexterm"/><strong>Exporter</strong>. In this tool, the anchor point's default value is <code class="literal">Vec2(0,0)</code>. In Cocos2d-x, the anchor point's default is <code class="literal">Vec2(0.5f, 0.5f)</code>. So you should change the anchor point to the center as shown in the following screenshot:<div><img src="img/B0561_10_21.jpg" alt="How to do it..."/></div></li><li class="listitem">Check the <a id="id397" class="indexterm"/>checkboxes for <strong>Category</strong>, <strong>Collision</strong>, and <strong>Contact</strong>. You need to scroll down to see this window in the right pane. You can check all the checkboxes and click all buttons that are in the bottom of the right pane.</li><li class="listitem">Publish the <code class="literal">plist</code> file to use this shape in Cocos2d-x. Click on the <strong>Publish</strong> button and save as the previous name.</li><li class="listitem">You can see the <strong>Download loader code</strong> link under the <strong>Exporter</strong> selector. Click on the link. After this, open the browser and browse to the github page. Cocos2d-x cannot load Physics Editor's <code class="literal">plist</code>. However, the loader code is provided in github. So you have to clone this project and add the codes in the <code class="literal">Cocos2d-x</code> folder in the project.<div><img src="img/B0561_10_22.jpg" alt="How to do it..."/></div></li></ol></div><p>Next, you will write <a id="id398" class="indexterm"/>code to create the physics bodies by using the Physics Editor data. In this case, the gear object will appear at the touching point.</p><div><ol class="orderedlist arabic"><li class="listitem">Include the file <code class="literal">PhysicsShapeCache.h</code>.<div><pre class="programlisting">#include "PhysicsShapeCache.h"</pre></div></li><li class="listitem">Create a scene with the physics world as shown in the following code:<div><pre class="programlisting">Scene* HelloWorld::createScene()
{
    auto scene = Scene::createWithPhysics();
    auto layer = HelloWorld::create();
    PhysicsWorld* world = scene-&gt;getPhysicsWorld();
    world-&gt;setDebugDrawMask(PhysicsWorld::DEBUGDRAW_ALL);
    scene-&gt;addChild(layer);
    return scene;
}</pre></div></li><li class="listitem">Create a wall of the same screen size in the scene and add the touching event listener. Then, load the Physics Editor's data as shown in the following code:<div><pre class="programlisting">bool HelloWorld::init()
{
    if ( !Layer::init() )
    {
        return false;
    }

    Size visibleSize = Director::getInstance()-&gt;getVisibleSize();
    Vec2 origin = Director::getInstance()-&gt;getVisibleOrigin();

    auto wall = Node::create();
    auto wallBody = PhysicsBody::createEdgeBox(visibleSize, PhysicsMaterial(0.1f, 1.0f, 0.0f));
    wallBody-&gt;setContactTestBitmask(true);
    wall-&gt;setPhysicsBody(wallBody);
    wall-&gt;setPosition(Vec2(visibleSize/2)+origin);
    this-&gt;addChild(wall);

    auto touchListener = EventListenerTouchOneByOne::create();
    touchListener-&gt;onTouchBegan = CC_CALLBACK_2(HelloWorld::onTouchBegan, this);
    _eventDispatcher- &gt;addEventListenerWithSceneGraphPriority(touchListener, this);

    PhysicsShapeCache::getInstance()- &gt;addShapesWithFile("res/gear.plist");

    return true;
}</pre></div></li><li class="listitem">Make the gear<a id="id399" class="indexterm"/> objects perform when touching the screen as shown in the following code:<div><pre class="programlisting">bool HelloWorld::onTouchBegan(Touch* touch, Event* event)
{
    auto touchPoint = touch-&gt;getLocation();
    auto body = PhysicsShapeCache::getInstance()- &gt;createBodyWithName("gear");
    auto sprite = Sprite::create("res/gear.png");
    sprite-&gt;setPhysicsBody(body);
    sprite-&gt;setPosition(touchPoint);
    this-&gt;addChild(sprite);
    return true;
}</pre></div></li><li class="listitem">After this, build and run this project. After touching the screen, the gear objects appear at the touching point.<div><img src="img/B0561_10_23.jpg" alt="How to do it..."/></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec227"/>How it works...</h2></div></div></div><div><ol class="orderedlist arabic"><li class="listitem">Firstly, you <a id="id400" class="indexterm"/>have to add two files, <code class="literal">plist</code> and image. Physics body is defined in the <code class="literal">plist</code> file that you published with Physics Editor. However, you use the gear image to create a sprite. Therefore, you have to add the <code class="literal">plist</code> file and <code class="literal">gear.png</code> into your project.</li><li class="listitem">Cocos2d-x cannot read Physics Editor's data. Therefore, you have to add the loader class that is provided in github.</li><li class="listitem">To use the Physics Engine, you have to create a scene with Physics World and you should set the debug draw mode to easy, to better understand physics bodies.<div><pre class="programlisting">auto scene = Scene::createWithPhysics();
auto layer = HelloWorld::create();
PhysicsWorld* world = scene-&gt;getPhysicsWorld();
world-&gt;setDebugDrawMask(PhysicsWorld::DEBUGDRAW_ALL);</pre></div></li><li class="listitem">Without border or walls, the physics objects will drop out of the screen. So you have to put up a wall that is the same size as the screen.<div><pre class="programlisting">auto wall = Node::create();
auto wallBody = PhysicsBody::createEdgeBox(visibleSize, PhysicsMaterial(0.1f, 1.0f, 0.0f));
wallBody-&gt;setContactTestBitmask(true);
wall-&gt;setPhysicsBody(wallBody);
wall-&gt;setPosition(Vec2(visibleSize/2)+origin);
this-&gt;addChild(wall);</pre></div></li><li class="listitem">Load the physics data's <code class="literal">plist</code> that was created by Physics Editor. The <code class="literal">PhysicsShapeCache</code> will load the <code class="literal">plist</code> at once. After that, the physics data is cached in the <code class="literal">PhysicsShapeCache</code> class.<div><pre class="programlisting">PhysicsShapeCache::getInstance()- &gt;addShapesWithFile("res/gear.plist");</pre></div></li><li class="listitem">In the <code class="literal">HelloWorld::onTouchBegan</code> method, create the gear object at the touching <a id="id401" class="indexterm"/>point. You can create physics body using the <code class="literal">PhysicsShapeCache::createBodyWithName</code> method with physics object data.<div><pre class="programlisting">auto body = PhysicsShapeCache::getInstance()- &gt;createBodyWithName("gear");</pre></div></li></ol></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch10lvl1sec83"/>Using Glyph Designer</h1></div></div></div><p>In games, you have to use text frequently. In which case, if you used the system font to display the text, you will have some problems. That's why there are different fonts for each device. The bitmap fonts are faster to render than the TTF fonts. So, Cocos2d-x uses the bitmap font to display the fps information in the bottom-left corner. Therefore, you should add the bitmap font into your game to display the text. In this recipe, you will learn how to use<a id="id402" class="indexterm"/> <strong>Glyph Designer</strong> which is the tool to make the original bitmap font and how to use the bitmap font in Cocos2d-x.</p><div><div><div><div><h2 class="title"><a id="ch10lvl2sec228"/>Getting ready</h2></div></div></div><p>Glyph Designer is a paid application. But you can use a free trial version. If you don't have it, you can download it by<a id="id403" class="indexterm"/> visiting the following URL:</p><p>
<a class="ulink" href="https://71squared.com/glyphdesigner">https://71squared.com/glyphdesigner</a>
</p><p>Next, we will find a free font that fits your game's atmosphere. In this case, we will use the font called<a id="id404" class="indexterm"/> <code class="literal">Arcade</code> from the dafont site (<a class="ulink" href="http://www.dafont.com/arcade-ya.font">http://www.dafont.com/arcade-ya.font</a>). After downloading it, you need to install it to your computer.</p><p>On the dafont site, there are a lot of fonts. However, the font license is different for each font. If you used the font, you need to check its license.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec229"/>How to do it...</h2></div></div></div><p>In this section, you will <a id="id405" class="indexterm"/>learn how to use Glyph Designer.</p><div><ol class="orderedlist arabic"><li class="listitem">Launch Glyph Designer. In the left pane, there are all the fonts that are installed on your computer. You can choose the font that you want to use in your game from there. Here we will use <code class="literal">Arcade</code> font that you downloaded a short time ago. If you didn't install it yet, you can load it. To load the font, you have to click on the <strong>Load Font</strong> button in the tool bar.<div><img src="img/B0561_10_24.jpg" alt="How to do it..."/></div></li><li class="listitem">After selecting or loading the font, it is displayed in the center pane. If your game used a part of the font, you have to hold the characters that you need to save memory and the application capacity. To select the characters, you can use the <strong>Include Glyphs</strong> window in the right pane. You need to scroll down to see this window in the right pane.<div><img src="img/B0561_10_25.jpg" alt="How to do it..."/></div></li><li class="listitem">The others, you <a id="id406" class="indexterm"/>can specify the size, color, and shadow. In the <strong>font color</strong> option, you can set a gradient.</li><li class="listitem">Finally, you can create an original font by clicking on the <code class="literal">Export</code> icon on the right side of the tool bar.</li><li class="listitem">After exporting, you will have the two files that have the extension of <code class="literal">.fnt</code> and <code class="literal">.png</code>.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec230"/>How it works...</h2></div></div></div><p>The bitmap font has two files, <code class="literal">.fnt</code> and <code class="literal">.png</code>. These files are paired for use in the bitmap font. Now, you will learn how to use bitmap fonts in Cocos2d-x.</p><div><ol class="orderedlist arabic"><li class="listitem">You have to add the font that were created in Glyph Designer, into the <code class="literal">Resources/font</code> folder in your project.</li><li class="listitem">Add the following code to display "<code class="literal">Cocos2d-x</code>" in your game.<div><pre class="programlisting">auto label = Label::createWithBMFont("fonts/arcade.fnt", "Cocos2d-x");
label-&gt;setPosition(Vec2(visibleSize/2)+origin);
this-&gt;addChild(label);</pre></div></li><li class="listitem">After building and <a id="id407" class="indexterm"/>running your project, you will see the following:<div><img src="img/B0561_10_26.jpg" alt="How it works..."/></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec231"/>There's more…</h2></div></div></div><p>Some fonts aren't monospaced. The true type font is good enough for use in a word-processor. However, the monospaced font is more attractive. For example, the point character needs to use the monospaced font. When you want to make the monospaced font into a non-monospaced font, you can go through the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Check the checkbox named <strong>Fixed Width</strong> in <strong>Texture Atlas</strong> in right pane.</li><li class="listitem">Preview your font and click on the <strong>Preview</strong> icon in the tool bar. Then, you can check the characters that you want to check in the textbox.</li><li class="listitem">If you want to change the<a id="id408" class="indexterm"/> character spacing, then you need to change the number next to the checkbox of <strong>Fixed Width</strong>.<div><img src="img/B0561_10_27.jpg" alt="There's more…"/></div></li></ol></div></div></div></body></html>