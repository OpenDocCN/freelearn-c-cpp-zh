<html><head></head><body>
        <section>

            <header>
                <h1 class="header-title">Weather Station (IoT)</h1>
            </header>

            <article>
                
<p>In <a href="c225d705-919a-4442-adc8-7b22d33437fc.xhtml" target="_blank">Chapter 1</a>, <span><em>Setting up Intel Edison</em>,</span> we learned how to set up the Intel Edison and run some basic programs in various languages. In this chapter, we'll scale up things a bit and introduce the Internet to the picture of the IoTs. We will hear this term quite often, and there has been no exact definition of it. However, if we try to bring out the literal meaning of IoT, it means connecting devices to the Internet. It may also be referred to as <strong>connected devices</strong> or <strong>smart devices</strong>. It's an advanced form of <strong>machine to machine</strong> (<strong>M2M</strong>) communication. In this chapter, the main focus will be on the architecture of IoTs and how Intel Edison is the perfect choice for developing systems revolving around IoT. We'll also be dealing with various components of a typical IoT project and how things can be scaled up at the component level. By the end of this chapter, we'll have built a system using Intel Edison that will take in pollution data, temperature data, and sound data, and upload it to the Web and display it live on a dashboard.</p>
<p>In this chapter, we will cover the following topics:</p>
<ul>
<li>Architecture of a typical IoT system interfacing sensors with Intel Edison</li>
<li>Connecting the device and uploading data to the cloud deploying a mini weather station with Intel Edison</li>
</ul>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Overview of IoT and its usage</h1>
            </header>

            <article>
                
<p>IoT has lots of usage and can make normal things behave smartly. Starting from industries, where we deal with large machinery, such as industrial robots and assembly line industrial units, IoT has its roots embedded in many uses providing vital data to the cloud, or a local server, where we can monitor them remotely and provide remote functionality in every place that uses IoT. Now imagine a healthcare solution where we have an aged member of our family and we need to monitor them regularly.</p>
<p>Smart medical devices come to the picture, where the data collected from the human body is constantly pushed to the cloud and monitored at a local level for any signs of abnormality. Proper analytics is performed at cloud level where using machine learning algorithms, we can predict the health of the person. Considering the use case of home automation that will be covered in <a href="3bd53219-a287-4d8f-9a58-5a06c5b14062.xhtml" target="_blank">Chapter 3</a>, <em>Intel Edison and IoT (Home </em><em>Automation)</em>, we can deal with controlling devices and monitoring the usage of devices such as electrical load such as lights, fans, and AC, remotely from anywhere in the world.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Architecture of a typical IoT project</h1>
            </header>

            <article>
                
<p>When dealing with IoT projects, there are certain key factors that should be kept in mind, some of which are as follows:</p>
<ul>
<li>Choice of hardware</li>
<li>Choice of the networking protocol</li>
<li>Choice of the sensors</li>
<li>Choice of the IoT platform</li>
</ul>
<p>Beside the previously mentioned points, several other factors come into play that will be clear later in the chapter. When dealing with IoT, the first thing that comes to our mind is uploading data. Typically, what is involved in an IoT project is we take readings from sensors and upload them to the Web. In this process, several sub-processes, such as processing and filtering data, analytics, and machine learning, come to play.</p>
<p>The following diagram depicts a standard architecture:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" height="189" src="assets/6639_02_01.jpg" width="336"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">IoT architecture overview</div>
<p>As depicted in the preceding diagram, the typical IoT system may consist of these components:</p>
<ul>
<li>Sensors</li>
<li>Controller actuators</li>
<li>IoT platform or cloud</li>
<li>Dashboard and alerts</li>
</ul>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Sensors</h1>
            </header>

            <article>
                
<p>Sensors form a key role in the IoT space. These act as a kind of connection layer between the physical world and the digital world. The sensors coupled provide the entire system with the data that we want. Currently we aren't focused on industrial-grade sensors, but low-power sensors are suitable for small proof of concepts. When dealing with sensors, certain factors should be kept in mind:</p>
<ul>
<li>Power used by the sensor</li>
<li>Type of output provided (digital or analog)</li>
<li>Sensitivity of the sensor</li>
</ul>
<p>The sensor usually performs one-way communication with the controller. The data captured by the sensors is converted into digital values using an ADC, and we obtain the output through a controller. Let's consider a use case of a light sensor. In this case, the sensor returns a calibrated value of the resistance. Thus we get a resistance value based on the light intensity. It is similar for other sensors, where any physical component is read and converted to a digital component. Normally a sensor has three pins; Vcc, Gnd, and signal. The interfacing of sensors with the controller will be discussed later in the chapter.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Controllers</h1>
            </header>

            <article>
                
<p>These are the brain of an IoT system. Controllers perform most of the action in the IoT space. In industry, controllers may be referred as IoT gateways. From data acquisition to processing this data to uploading it to the cloud and control actuators, are all performed by the controller. Usually, controllers have the capabilities of networking and wireless communication. If some controllers don't have that capability, then usually they are stacked up with external networking devices. Arduino, Raspberry Pi, Intel Galileo, and Intel Edison are some of the most commonly used controllers. Controllers normally come with GPIO pins that interface with other devices. Most of the details of Intel Edison, the controller that we are using, were discussed in <a href="c225d705-919a-4442-adc8-7b22d33437fc.xhtml" target="_blank">Chapter 1</a>, <span><em>Setting up Intel Edison</em></span>.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Actuators</h1>
            </header>

            <article>
                
<p>Actuators consist of mainly electro-mechanical devices that provide us some action on the basis of controller signals. Based on signals sent by the controllers, actuators get activated or deactivated. Actuators are mainly motors; servos fall into this category as well. Controllers cannot directly control actuators because of the high power requirements or the nature of the current (AC or DC) of the actuators. The interfacing hardware component is called a driver circuit.</p>
<p>Controllers send control signals to the driver circuits and based on these control signals, the actuators gets activated. While dealing with the robotics module of this book, the actuators will be discussed in detail.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Cloud or IoT platform</h1>
            </header>

            <article>
                
<p>This is perhaps one of the most important parts of the entire IoT ecosystem because of the fact that at the end we need to upload the data so that it can be accessed from anywhere, which is the Internet part of IoTs. Normally we prefer to go for IoTs platforms. These platforms have their own SDKs and we just use those SDKs to pair up our device with the IoT platform and upload the data. Top-level players in the IoT platform include Microsoft Windows Azure, IBM Bluemix, and Amazon Web Services. There are other platforms that provide those services, such as Datonis, Dweet, Thingspeak, Thingworx, and many more. The choice of the IoT platform is very specific to the use case depending on certain factors, such as:</p>
<ul>
<li><strong>Protocols it supports</strong>: These are mainly REST, web sockets, and MQTT</li>
<li><strong>Dashboard capability</strong>: The platforms, own dashboards for visualization and the flexibility of development of custom dashboards</li>
<li><strong>Rule engines</strong>: These include the rules that are needed to be defined based on the incoming data</li>
<li><strong>Event-based services</strong>: These are the necessity of triggering of events based on the output of the rule engines</li>
</ul>
<p>In this chapter, we will be discussing the use of <kbd>dweet.io</kbd> for our project, a mini weather station.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Dashboards and alerts</h1>
            </header>

            <article>
                
<p>When we have data, the data should be viewed in the form of gauges, graphs, and so on. In most cases, the platform itself provides support, but sometimes there arises a requirement of building custom dashboard based on the data we get. Normally through REST API calls, we get the data from the IoT platform to our custom dashboards. These are also essential components of an IoT ecosystem. Dashboards must also be compatible with devices ranging from PCs to mobile devices. They also must be in real time. While dashboards deal with data visualizations, alerts on the other hand are responsible for notifying the user of any malfunctions or any abnormalities in the system. Normally the preferred mode of alerts is either some visualizations, push notifications, e-mails, text messages, and so on.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Interfacing sensors with Intel Edison</h1>
            </header>

            <article>
                
<p>Earlier in this chapter, we had a brief idea about sensors. Now we will see how to interface these sensors with the Intel Edison. Let us consider the use of the temperature sensor. As already mentioned, most of the sensors have a three or four-pin configuration:</p>
<ul>
<li>Vcc</li>
<li>Ground</li>
<li>Signal</li>
</ul>
<p>If you have a look at the Edison board, the board will have analog pins. Ideally, if the sensor returns an analog value, then it goes in the analog pin. It is similar for digital output: we prefer the use of digital pins. Let us look at the following example, where we will interface a temperature sensor. Normally, a typical temperature sensor has three pins. The configuration is the same as previously. However, sometimes due to board compatibility issues, it may come with a four-pin configuration, but in that case one of the pins is not used.</p>
<p>In this example, we are going to use a Grove temperature sensor module:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" height="183" src="assets/image_02_002.jpg" width="211"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Grove temperature sensor module</div>
<p>The preceding image is a temperature sensor. You may notice that it has four-pins, designated as <span class="packt_screen">Vcc</span>, <span class="packt_screen">Gnd</span>, <span class="packt_screen">Sig</span>, and <span class="packt_screen">NC</span>. In order to connect with your Edison, follow the following circuit diagram:</p>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" height="281" src="assets/image_02_003.jpg" width="498"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Circuit diagram for basic temperature data</div>
<p>In this circuit diagram, it is noticed that the NC pin is not connected. Thus, only three-pins, <span class="packt_screen">Vcc</span>, <span class="packt_screen">Gnd</span>, and <span class="packt_screen">Sig</span>, are connected. Now, once you are done with the connections, we need to write some algorithms for reading the data. The standard procedure is to search for the datasheet of the sensor. Normally, we also get mathematical equations for the sensor to obtain the desired parameters.</p>
<p>For the Grove temperature sensor module, our first target is to obtain some data from the manufacturer's website. Normally, these sensors calculate temperature based on the change in resistance:</p>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" height="332" src="assets/image_02_004.jpg" width="640"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Algorithm for temperature calculation. Picture credits: <a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">h</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">t</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">t</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">p</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">://w</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">i</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">k</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">i</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">.</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">s</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">e</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">e</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">e</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">d</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">.</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">c</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">c</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">/G</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">r</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">o</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">v</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">e</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">-</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">T</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">e</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">m</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">p</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">e</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">r</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">a</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">t</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">u</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">r</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">e</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">_</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">S</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">e</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">n</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">s</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">o</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">r</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">_</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">V</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">1.</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">2/</a></div>
<p>The final formulae will be as follows:</p>
<p><em>B=4275</em></p>
<p><em>R0=100000</em></p>
<p><em>R= 1023.0/a-1.0 R= 100000*R</em><br/></p>
<p>Final Temperature = <em>1.0/(log(R/100000.0)/B+1/298.15)-273.15</em></p>
<p>The preceding deduction was obtained from <a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">h</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">t</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">t</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">p</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">://w</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">i</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">k</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">i</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">.</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">s</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">e</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">e</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">e</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">d</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">.</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">c</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">c</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">/G</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">r</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">o</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">v</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">e</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">-</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">T</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">e</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">m</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">p</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">e</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">r</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">a</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">t</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">u</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">r</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">e</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">_</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">S</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">e</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">n</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">s</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">o</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">r</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">_</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">V</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">1.</a><a href="http://wiki.seeed.cc/Grove-Temperature_Sensor_V1.2/">2/</a>.</p>
<p>When converting the preceding deduction into code for the Arduino IDE to deploy into the Edison, the result will be as follows:</p>
<pre>
#include &lt;math.h&gt; <br/><br/><br/>constint B=4275; constint R0 = 100000; constint tempPin = A0; void setup() <br/><br/><br/>  { <br/><br/>    Serial.begin(9600); <br/><br/>  } <br/><br/>void loop() <br/><br/>  { <br/><br/>    int a = analogRead(tempPin ); float R = 1023.0/((float)a)-1.0; <br/>    R = 100000.0*R; <br/><br/>    float temperature=1.0/(log(R/100000.0)/B+1/298.15)-273.15;<br/>    Serial.print("temperature = "); Serial.println(temperature); <br/>    delay(500); <br/><br/>  } 
</pre>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Explanation of the code</h1>
            </header>

            <article>
                
<p>Let's discuss the steps that we need to follow:</p>
<ol>
<li>Initially we declare the values of <kbd>B</kbd> and <kbd>R0</kbd>. These values are obtained from the datasheet, as shown in the algorithm.</li>
</ol>
<ol start="2">
<li>Next, we declare the analog pin, <kbd>tempPin</kbd>, which will be used.</li>
</ol>
<ol start="3">
<li>In the <kbd>setup()</kbd> function, we just perform the <kbd>Serial.begin(9600)</kbd> operation. The thing is that we don't set the <kbd>tempPin</kbd> to be in input mode because of the fact that analog pins by default are in input mode.</li>
</ol>
<ol start="4">
<li>Next in the loop, we implement the calculations performed earlier in code and display it on the serial monitor.</li>
</ol>
<ol start="5">
<li>To access the serial monitor, press the top right corner button. After the serial windows opens, you will see your current room temperature:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" height="277" src="assets/image_02_005.png" width="320"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Serial window. Note the baud rate and the temperature readings</div>
<div class="packt_figref packt_infobox">From the preceding screenshot, you can note the temperature reading, which is pretty close to the original temperature. Depending on the sensitivity, the temperature may vary.</div>
<p>Now that we know how to access temperature sensor readings, we can move forward with the integration of other sensors for our weather station project.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Connecting the device and uploading to the cloud (dweet.io)</h1>
            </header>

            <article>
                
<p>Now that we know how to read the data from the sensors, our next target is to select an IoT platform where we'll upload data. We had a short discussion before about IoT platforms.</p>
<p>In this section, we will be dealing with <kbd>dweet.io</kbd>. This IoT platform is extremely simple to implement. We will be using the Node.js SDK for <kbd>dweet.io</kbd>. Before going into the details, let's have a look at the platform. Our target is to push the temperature data we obtained into the platform and display it on a dashboard.</p>
<p><kbd>dweet.io</kbd> is a simple publishing and subscribing service for machines (sensors, robots, devices, and so on). It's like Twitter, but for things. Each thing is assigned a unique name and through REST services, we access, and update them. One thing to be noted is that the things we create are public. In order to create a private thing, we need to pay. Here we'll cover only the public aspect of it:</p>
<div class="packt_infobox">For details on <kbd>dweet.io</kbd>, refer to the following link:<br/>
<a href="https://dweet.io/faq">https://dweet.io/faq</a></div>
<ol>
<li>This will be one of the first steps for our weather station, as temperature is an integral part of it:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" height="389" src="assets/image_02_008.jpg" width="750"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Dweet.io screenshot</div>
<ol start="2">
<li>Now click on the <span class="packt_screen">Play</span> tab to enter the creation area:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" height="464" src="assets/image_02_009.jpg" width="895"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Play—dweet.io</div>
<ol start="3">
<li>Next, we are going to provide a name to our thing:</li>
</ol>
<div class="CDPAlignCenter CDPAlign packt_figref"><img class=" image-border" height="455" src="assets/image_02_010.jpg" width="888"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref">dweet.io—Create a thing</div>
<ol start="4">
<li>Name your thing. The name has to be unique.</li>
<li>After clicking on the <span class="packt_screen">Try It Out!</span> button, you will be getting a request URL.</li>
<li>Now, click on <kbd>https://dweet.io/follow/EdisonTemperature</kbd> to browse to your public thing page. Once the Edison is connected, we'll receive data here. So, for now, let's connect a temperature sensor to the Edison and connect it to your PC.</li>
<li>In this mini project, we are going to write a Node.js program that will access the data from the sensor and upload it to here in the preceding link. Also, instead of writing the code to the Intel XDK, we'll write the code in Notepad++ and transfer it using the FileZilla client.</li>
</ol>
<ol start="8">
<li>But again, we don't have access to the libraries yet. So we need to add those libraries to our Edison device. For that, fire up your PuTTY Terminal and log in to your Edison:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" height="323" src="assets/image_02_011.png" width="505"/></div>
<ol start="9"/>
<div class="packt_figref CDPAlignCenter CDPAlign">PuTTY console-setup—1</div>
<ol start="9">
<li>Next, check whether your device is connected to your Wi-Fi network using the <kbd>ifconfig</kbd> command:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" height="272" src="assets/image_02_012.png" width="426"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">PuTTYconsole-setup—2</div>
<ol start="10">
<li>Next, we will install the Node.js sdk for <kbd>dweet.io</kbd> on our device. Execute the following command:</li>
</ol>
<pre>
<strong>      npm install node-dweetio -save</strong>
</pre>
<ol start="10"/>
<p style="padding-left: 90px">It may take some time for the modules to be installed depending on the speed of your Internet connection. The warnings may be ignored.</p>
<ol start="11">
<li>Once installed, we'll write the Node.js script for the Edison. Now open your editor and type in the following code:</li>
</ol>
<pre>
      function dweetSend()<br/>        {<br/>          vardweetClient = require("node-dweetio"); vardweetio =<br/>          newdweetClient();<br/>          var mraa= require('mraa'); var B=4275;<br/>          var R0=100000;<br/>          var tempPin=new mraa.Aio(0); var a=tempPin.read();<br/>          var R=1023/a-1; R=100000*R;<br/>          var temperature=1/(Math.log(R/100000)/B+1/298.15)-273.15;<br/>          temperature = +temperature.toFixed(2);<br/>          dweetio.dweet_for("WeatherStation",<br/>          {Temperature:temperature}, function(err, dweet)<br/>            {<br/>              console.log(temperature); console.log(dweet.thing); //<br/>              "my-thing"<br/>              console.log(dweet.content); // The content<br/>              of the dweet<br/>              console.log(dweet.created); // The create<br/>              date of the dweet<br/>            });<br/>          setTimeout(dweetSend,10000);<br/>        }<br/>      dweetSend();
</pre>
<ol start="11"/>
<p>To explain the code, let's break it into parts. As you can see, we have a main function named <kbd>dweetSend</kbd>, which repeats itself after every 10 seconds. Initially, we need to get data from the temperature sensor. We've connected the temperature sensor to Analog pin 3. If you have a close look at the code that was written in Arduino IDE, then you will find lots of similarities:</p>
<pre>
vardweetClient = require("node-dweetio");<br/>vardweetio = new dweetClient();
</pre>
<p>In these lines, we import the node - <kbd>dweetio</kbd> library. The next piece of code is similar to the Arduino IDE, where we read the raw value of the analog read and perform required calculations:</p>
<pre>
var mraa= require('mraa');<br/>var B=4275; varR0=100000;<br/>var tempPin=new mraa.Aio(0);<br/>var a=tempPin.read();<br/>var R=1023/a-1;<br/>R=100000*R;<br/>var temperature=1/(Math.log(R/100000)/B+1/298.15)-273.15; temperature = +temperature.toFixed(2);
</pre>
<p>As stated in the preceding code, we have also rounded the temperature value to two decimal places. Next, we push the value to the <kbd>dweet.io</kbd> thing channel. Here, we need to mention that our thing name <kbd>WeatherStation</kbd>, followed by the name of the parameter, <kbd>Temperature</kbd>, and the variable name, <kbd>temperature</kbd>:</p>
<pre>
dweetio.dweet_for("WeatherStation", {Temperature:temperature}, function(err, dweet)<br/>  {<br/>    console.log(temperature); console.log(dweet.thing); // "my-thing"<br/>    console.log(dweet.content); // The content of the dweet<br/>    console.log(dweet.created); // The create date of the dweet<br/>  });
</pre>
<p>That's how the entire workflow is. So to summarize:</p>
<ol>
<li>Import required libraries.</li>
<li>Based on the circuit, read the raw values from the used pin and process the value to get the desired output.</li>
<li>Push the value to <kbd>dweet.io</kbd>.</li>
</ol>
<p>Save this code with the name <kbd>dweetEdison.js</kbd> and to run this code, type in the following command:</p>
<pre>
<strong>node dweetEdison.js</strong>
</pre>
<p>Once you run the code by executing the preceding statement in the PuTTY Terminal, you will see the following output:</p>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" height="310" src="assets/image_02_013.png" width="491"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref">PuTTY console—output</div>
<div class="packt_infobox">Sometimes, the preceding code may throw an error while importing the <kbd>mraa</kbd> library. There are issues with reading analog pin values. This usually happens if you have the <kbd>mraa</kbd> library installed from multiple sources. In that case, reflash your device and follow all the steps.</div>
<p>Now, once you see this, then your code is running successfully. Now we will head on to the <kbd>dweet.io</kbd> page and see whether our data is really getting uploaded or not. We have named our thing <span class="packt_screen">WeatherStation</span>. Your thing name will obviously differ since it's unique.</p>
<p>Now browse to the following URL:</p>
<p><kbd>https://dweet.io/follow/YOUR_THING_NAME</kbd></p>
<p>You should have a plot or a visual like this:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" height="421" src="assets/image_02_015.png" width="821"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Temperature plot—dweet.io</div>
<p>The plot seems incomplete unless and until we have a gauge. There is something called <kbd>freeboard.io</kbd>. It's also free, but again it is public. So, browse to <kbd>freeboard.io</kbd> and log in or sign up if you don't have an account:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" height="352" src="assets/image_02_016.png" width="795"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">freeboard.io—account page</div>
<p>Provide a name and click on <span class="packt_screen">Create New</span>. Here we have provided <span class="packt_screen">WeatherStation</span>. Once you create the board, you will be automatically redirected to the board design page. Next, under <span class="packt_screen">DATASOURCES</span>, click on <span class="packt_screen">ADD</span>:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" height="300" src="assets/image_02_017.png" width="584"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Freeboard screenshot</div>
<p>Now, once you click on <span class="packt_screen">ADD</span>, you have to select a <span class="packt_screen">TYPE</span>. Select <span class="packt_screen">Dweet.io</span>. Under <span class="packt_screen">NAME</span>,<span class="packt_screen"> </span>provide any name. For simplicity, make the name and the thing name the same. Since your thing in <kbd>dweet.io</kbd> is public, we don't need to provide a key. Click on <span class="packt_screen">SAVE</span> to proceed:</p>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" height="304" src="assets/image_02_018.png" width="601"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Dweet.io datasource</div>
<p>Once done, we need to add a pane for our incoming data. For that, click on <span class="packt_screen">ADD PANE</span> and proceed to add a new gauge. Fill in the details as shown in the following screenshot. Note that under the value field, we've written <kbd>datasources["WeatherStation"]["Temperature"]</kbd>. So here, <kbd>WeatherStation</kbd> is your thing name, which is followed by the parameter name that we want to display. Similarly, the project that will be discussed in the upcoming section of this chapter will have other parameters too:</p>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" height="255" src="assets/image_02_019.png" width="584"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Freeboard</div>
<p>Click on <span class="packt_screen">SAVE</span> and you should have your gauge displayed on your board home page.</p>
<p>This gauge won't show any value as of now since your code is not running. So go back to your PuTTY console and run your Node.js code. Once your code is up and running, then the gauge should represent your incoming data, as shown in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" height="476" src="assets/image_02_020.jpg" width="847"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Gauge in working mode</div>
<p>Thus we have deployed a very simple use case of uploading data from the Edison to <kbd>dweet.io</kbd> and displaying it on <kbd>freeboard.io</kbd>. In the next section, we'll deal with a live IoT project where we'll deal with more than one parameter.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Live use case of an IoT project - mini weather station</h1>
            </header>

            <article>
                
<p>In the previous section, we have seen the use case of uploading temperature data only. Now, with mini weather station, we are going to deal with three parameters:</p>
<ul>
<li>Temperature</li>
<li>Pollution level</li>
<li>Sound level</li>
</ul>
<p>All three parameters will be uploaded to the cloud and displayed live on the dashboard. The project will be divided into parts, which will make it easier to understand, and we will also tackle other complex projects:</p>
<ul>
<li>Architecture of the system</li>
<li>Sensor and hardware components and detailed circuit diagram</li>
<li>Locally acquiring data and displaying it on the console</li>
<li>Uploading the data to the cloud</li>
<li>Visualizing the data</li>
</ul>
<p>Most details were shown previously using a temperature sensor, so we won't go into much depth, but we will cover all aspects.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Architecture of the system</h1>
            </header>

            <article>
                
<p>The architecture of the system will be very much similar to the generic architecture of the system discussed at the beginning of the chapter, with the components of actuators and alerts missing:</p>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" height="279" src="assets/image_02_021.jpg" width="496"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Architecture of the weather station</div>
<p>As you can see in the preceding figure, we have three sensors (temperature, smoke, and noise) that supply raw data to the controller, that is Intel Edison, and the controller processes the raw data to upload to the IoT platform of <kbd>dweet.io</kbd>, which is ultimately displayed on the dashboard on <kbd>freeboard.io</kbd>. For this project, we are not interested in alerts and actuators, so those aren't included.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Hardware components and detailed circuit diagram</h1>
            </header>

            <article>
                
<p>For the project to be realized, we will deal with the following hardware components:</p>
<ul>
<li>Grove temperature sensor</li>
<li>Grove sound sensor</li>
<li>MQ2 smoke sensor</li>
</ul>
<p>All of the preceding three sensors have more or less a similar configuration of pins, so connections are pretty simple. As already explained, we're going to use the analog pins on the Intel Edison for the input from the sensors.</p>
<div class="packt_infobox">The MQ2 sensor returns raw values. Here, we'll use the raw values and calibrate the sensor based on the level of smoke.</div>
<p><span>The following is the circuit diagram for the system. Please note that we've only mentioned the pins that will be used:</span></p>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" height="375" src="assets/6639_02_19.jpg" width="666"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Circuit diagram - weather station</div>
<p>We've made a common <strong>Vcc</strong> and <strong>Gnd</strong> connection where all the sensors are hooked up. Next, we need three analog pins. These pins are connected to the analog output pins of the sensors. It should be noted that some sensors may have two output pins, one of which one is analog out, while the other is digital out. Since we are interested in analog output, we will not be using the digital output pins. In this project, the MQ2 sensor (the smoke sensor) has such a configuration.</p>
<p>For calibrating the <strong>Smoke sensor</strong>, we need the presence of some smoke that the sensor is sensitive to. Although we'll be pushing raw values, for local alarms the thresholding technique may be used.</p>
<p>Connect your sensor and the Edison device based on the preceding circuit diagram. Once connected, you are good to go with the code.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Code for weather station stage 1, acquiring data from all the sensors and displaying it in the console</h1>
            </header>

            <article>
                
<p>Before moving on to the code, let's have a look at the algorithm first:</p>
<ol>
<li>Import libraries.</li>
<li>Initialize input pins.</li>
<li>Read raw values.</li>
<li>Process the values.</li>
<li>Display it to the console.</li>
</ol>
<p>This is similar to the earlier example, the only difference being that we're going to use three sensors. In this case, the code will be written in Node.js, since at a later stage we'll be pushing it to the cloud, that is, <kbd>dweet.io</kbd>:</p>
<pre>
functiondisplayRes() <br/><br/>{ <br/><br/>//Import mraa <br/><br/>var mraa= require('mraa'); var B=4275; <br/>var R0=100000; <br/><br/>//Temperature pin <br/><br/>var tempPin=new mraa.Aio(0); <br/><br/>//Sound pin <br/><br/>varsoundPin= new mraa.Aio(1); <br/><br/>//Smoke pin <br/><br/>varpolPin= new mraa.Aio(2); <br/><br/>//Processing of temperature var a=tempPin.read(); <br/>var R=1023/a-1; R=100000*R; <br/>var temperature=1/(Math.log(R/100000)/B+1/298.15)-273.15; temperature = +temperature.toFixed(2); <br/>//Smoke read <br/><br/>varsmokeValue= polPin.read(); <br/><br/><br/>//Sound read <br/><br/>varsndRead= soundPin.read(); <br/><br/><br/><br/>console.log("Temperature=  ",temperature);console.log("Soundlevel=   ",sndRead);console.log("Smoke level= ", smokeValue); setTimeout(displayRes,500); <br/>} <br/><br/>displayRes(); 
</pre>
<p>Before explaining the code, processing has only been performed on the temperature sensor. For the sound level, we'll send raw values because for conversion into decibels, which is a relative quantity<strong>,</strong> we need to access the sound pressure of two instances. So we will restrict ourselves to raw values. However, we can certainly find a threshold value of the raw readings and use the threshold to invoke an action, such as turning on an LED or sounding a buzzer.</p>
<p>Now, let's have a close look at the code. Most of the code is similar to that of the temperature module. We've added a few more lines for smoke and sound detection:</p>
<pre>
//Sound pin<br/>varsoundPin= new mraa.Aio(1);<br/>//Smoke pin<br/>varpolPin= new mraa.Aio(2);
</pre>
<p>In the preceding lines, we declared which analog pins are used for sound sensor input and smoke sensor input. In the following lines we will read the values:</p>
<pre>
//Smoke read<br/>varsmokeValue= polPin.read();<br/>//Sound read<br/>varsndRead= soundPin.read();
</pre>
<p>Ultimately, we display the captured values using the console.</p>
<div class="packt_infobox">When dealing with sensors such as smoke and sound  sensors, we may not get the standard unit values directly. In these cases, we need to manually calibrate the sensors to simulate an environment of known values. Suppose in case of a smoke sensor, we set up an environment where we know what the value is, then by varying the potentiometer we change the value of the variable resistance, thus calibrating the sensor. That's one of the many standard procedures available. Calibration will be dealt with in detail when we cover the robotics module.</div>
<p>When you run the preceding code in the console, you will get the output from all the sensors. Try to increase smoke around the smoke sensor or speak loudly in front of the sound sensor to increase the value, or keep the temperature sensor near your laptop vent to get a higher reading. The following is the screenshot of the values obtained from the sensors:</p>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" height="311" src="assets/image_02_025-1.png" width="490"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Sensor reading output</div>
<p>Once you obtain the readings, we can push them to the cloud and display them on the dashboard.</p>
<p>Here, if you notice that you are not getting correct readings, then you need to adjust the potentiometer available on the sensor to calibrate it manually. For uploading it to the cloud, we need to impart some changes in the code. Refer to the following code for pushing all the three data obtained to <kbd>dweet.io</kbd>:</p>
<pre>
function dweetSend()<br/>  {<br/>    vardweetClient = require("node-dweetio"); vardweetio = new<br/>    dweetClient();<br/>//Import mraa<br/>    var mraa= require('mraa'); var B=4275;<br/>    var R0=100000;<br/>//Temperature pin<br/>    var tempPin=new mraa.Aio(0);<br/>//Sound pin<br/>    varsoundPin= new mraa.Aio(1);<br/>//Smoke pin<br/>    varpolPin= new mraa.Aio(2);<br/>//Processing of temperature var a=tempPin.read();<br/>    var R=1023/a-1; R=100000*R;<br/>    var temperature=1/(Math.log(R/100000)/B+1/298.15)-273.15;<br/>    temperature = +temperature.toFixed(2);<br/>//Smoke read<br/>    varsmokeValue= polPin.read();<br/>//Sound read<br/>    varsndRead= soundPin.read();<br/>    dweetio.dweet_for("WeatherStation",<br/>      {Temperature:temperature, SmokeLevel:smokeValue,<br/>      SoundLevel:sndRead}, function(err, dweet)<br/>        {<br/>          console.log(dweet.thing); // "my-thing"<br/>          console.log(dweet.content); // The content<br/>          of the dweet<br/>          console.log(dweet.created); // The create<br/>          date of the dweet<br/>        });<br/>      setTimeout(dweetSend,10000);<br/>    }<br/>dweetSend();
</pre>
<p>In the preceding code, again you will find lots of similarities with the code for <kbd>temperature</kbd>. Here, we have performed three read operations and we've sent all the three values respective to the parameter it represents. It's evident from the following line:</p>
<pre>
dweetio.dweet_for("WeatherStation", {Temperature:temperature, SmokeLevel:smokeValue, SoundLevel:sndRead}, function(err, dweet)
</pre>
<p>Transfer the code by following a similar process that was discussed before, using FileZilla, and execute it using the <kbd>node</kbd> command:</p>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" height="323" src="assets/image_02_026-1.png" width="511"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">PuTTY Terminal</div>
<p>Having a look at the preceding screenshot, it's clear that values are being sent. Now, please note the sound and smoke values. Initially, music was being played, so we got sound values in the range of 20-70. For the smoke sensor, the standard value is around 250-300. In the last reading, I applied some smoke and it shot to <span class="packt_screen">374</span>. Now browse to your <kbd>dweet.io</kbd> portal and you will notice the values being updated live:</p>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" height="253" src="assets/image_02_027-1.png" width="525"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Dweet.io screenshot for live data</div>
<p>Once we have things set up on this side, we'll add two more gauges to <kbd>freeboard.io</kbd> for visualizations. Log on to <kbd>freeboard.io</kbd> and follow the method as explained before for addition of gauges. Be specific when matching the <span class="packt_screen">DATASOURCES</span> where you need to specify the parameter:</p>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" height="384" src="assets/image_02_028-1.png" width="812"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Freeboard.io ﬁnal layout</div>
<p>Once this is done, well, you will have your own weather station ready, and up and running. Once we understand the concepts, it's extremely easy to realize these mini projects.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Open-ended task for the reader</h1>
            </header>

            <article>
                
<p>Since you have got a fair idea of how to realize small IoT projects, we'll provide you a simple open-ended task for you to implement.</p>
<p>We've used <kbd>dweet.io</kbd> and <kbd>freeboard.io</kbd>. Besides this, there are several other IoT platforms, such as Azure, IBM Bluemix, and Thingspeak. Your task is to simulate a similar thing on other IoT platforms. Azure and IBM requires you to sign up by the use of debit or credit card, but for the first month it's free and it can be used for IoT, while, on the other hand, Thingspeak is totally free and it has support for Matlab.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Summary</h1>
            </header>

            <article>
                
<p>In this chapter, we've learned about the architecture of IoT systems, how to tackle problem statements, and we also learned about sensors and interfacing them. Then we moved on to the IoT platforms and visualized some temperature data. At the end, we built a mini weather station that measures temperature, sound level, and pollution level. We also covered a very brief discussion of the calibration of sensors.</p>
<p>In <a href="3bd53219-a287-4d8f-9a58-5a06c5b14062.xhtml" target="_blank">Chapter 3</a>, <em>Intel Edison and IoT (Home Automation)</em>, we'll be dealing with communication from a platform to the controller, that is, controlling devices using the Internet. Then we'll engage ourselves in a home automation project where we'll be controlling two devices using an Android and a WPF application.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    </body></html>