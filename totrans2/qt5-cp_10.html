<html><head></head><body><div id="sbo-rt-content" class="calibre1"><div class="calibre2" title="Chapter 10. Don't Panic When You Encounter These Issues"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title"><a id="ch10" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Chapter 10. Don't Panic When You Encounter These Issues</h1></div></div></div><p class="calibre9">During application development, you may get stuck with some issues. Qt is amazing, as always, since Qt Creator has an excellent <span class="strong"><strong class="calibre10">Debug</strong></span> mode that can save you time when debugging. You'll learn how to debug either Qt/C++ or Qt Quick/QML applications. The following topics will be covered in this chapter:</p><div class="calibre2"><ul class="itemizedlist"><li class="listitem">Commonly encountered issues</li><li class="listitem">Debugging Qt applications</li><li class="listitem">Debugging Qt Quick applications</li><li class="listitem">Useful resources</li></ul></div><div class="calibre2" title="Commonly encountered issues"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title2"><a id="ch10lvl1sec65" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Commonly encountered issues</h1></div></div></div><p class="calibre9">Errors, or more appropriately, unexpected results, are definitely unavoidable during application development. Besides, there could also be compiler errors, or even application crashes. Please<a id="id471" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> don't panic when you encounter these kinds of issues. To ease your pain and help you locate the problem, we have collected some commonly encountered and reproducible unexpected results and categorized them, as shown in the next sections.</p><div class="calibre2" title="C++ syntax mistakes"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title5"><a id="ch10lvl2sec07" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>C++ syntax mistakes</h2></div></div></div><p class="calibre9">For programming<a id="id472" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> beginners, or developers who are not familiar with C and C++, the syntax of C++ is not easy to remember. If there are any syntax mistakes, the compiler will abort with error messages. In fact, the editor will display tildes below problematic statements, as shown here:</p><div class="mediaobject"><img src="Images/4615OS_10_01.jpg" alt="C++ syntax mistakes" class="calibre89"/></div><p class="calibre9">Among all C++ syntax mistakes, the most common one is a missing semicolon (;). C++ needs a semicolon<a id="id473" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> to mark the end of a statement. Therefore, line 7 and line 8 are equivalent to the following line:</p><div class="calibre2"><pre class="programlisting">    MainWindow w w.show();</pre></div><p class="calibre9">This, in C++, is obviously written incorrectly. Not only will the editor highlight the error, the compiler will also give you a thorough error message. In this case, it'll display the following message:</p><p class="calibre9">
<code class="literal">C:\Users\Symeon\OneDrive\Book_Dev\4615OS\4615OS_07\project\Weather_Demo\main.cpp:8: error: C2146: syntax error : missing ';' before identifier 'w'</code>
</p><p class="calibre9">As you can tell, the compiler won't tell you that you should add a semicolon at the end of line 7. Instead, it reads <code class="literal">missing;</code> before the <code class="literal">w</code> identifier, which is in line 8. Anyway, in most cases the C++ syntax errors can be detected by the compiler, while most of them will first be detected by the editor. Thanks to the highlighting feature of Qt Creator, these types of mistakes should be avoided effectively.</p><p class="calibre9">It's recommended as a good habit that you add a semicolon before you press <span class="strong"><em class="calibre14">Enter</em></span>. This is because in some cases the syntax may seem correct for compilers and Qt Creator, but it's definitely wrongly coded and will cause unexpected behavior.</p></div><div class="calibre2" title="Pointer and memory"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title5"><a id="ch10lvl2sec08" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Pointer and memory</h2></div></div></div><p class="calibre9">Anyone familiar with C and its wild pointers understands how easy it is to make a mistake regarding<a id="id474" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> memory management. As we mentioned before, Qt has a superior memory management mechanism, which will release its child objects once the parent is deleted. This, unfortunately, may lead to a crash if the developer explicitly uses <code class="literal">delete</code> to release a child object.</p><p class="calibre9">The primary reason<a id="id475" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> behind this is that <code class="literal">delete</code> is not a thread-safe operation. It may cause a double delete, resulting in a segment fault. Therefore, to release memory in a thread-safe way, we use the <a id="id476" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/><code class="literal">deleteLater()</code> function defined in the <code class="literal">QObject</code> class, which means that this method is available for all classes inherited from <code class="literal">QObject</code>. As stated in the documentation, <code class="literal">deleteLater()</code> will schedule the object for deletion but the deletion won't happen immediately.</p><div class="sidebar" title="Note"><div class="inner"><h3 class="title6"><a id="note31" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Note</h3><p class="calibre15">It's completely safe to call <code class="literal">deleteLater()</code> multiple times. Once the first deferred deletion is completed, any pending deletions are removed from the event queue. There won't be any double deletes.</p></div></div><p class="calibre9">There is another class dealing with memory management in Qt, <code class="literal">QObjectCleanupHandler</code>. This<a id="id477" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> class watches the lifetime of multiple QObjects. You can treat it as a simple Qt garbage collector. For instance, there are a lot of <code class="literal">QTcpSocket</code> objects that need to be watched and deleted properly. These kinds of cases are not uncommon, especially for networking programs. An easy trick is to add all these objects to <code class="literal">QObjectCleanupHandler</code>. The following piece of code is a simple demonstration that adds <code class="literal">QObject</code> to <code class="literal">QObjectCleanupHandler ch</code>:</p><div class="calibre2"><pre class="programlisting">QTcpSocket *t = new QTcpSocket(this);
QObjectCleanupHandler ch;
ch.add(t);</pre></div><p class="calibre9">Adding the <code class="literal">t</code> object to <code class="literal">ch</code> won't change the parent object of <code class="literal">t</code> from this to <code class="literal">&amp;ch</code>. <code class="literal">QObjectCleanupHandler</code> is more like <code class="literal">QList</code> in this way. If <code class="literal">t</code> is deleted somewhere else, it'll get removed from the list of <code class="literal">ch</code> automatically. If there is no object left, the <code class="literal">isEmpty()</code> function will return <code class="literal">true</code>. All objects in <code class="literal">QObjectCleanupHandler</code> will be deleted when it's destroyed. You can also explicitly call <code class="literal">clear()</code> to delete all objects in <code class="literal">QObjectCleanupHandler</code> manually.</p></div><div class="calibre2" title="Incompatible shared libraries"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title5"><a id="ch10lvl2sec09" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Incompatible shared libraries</h2></div></div></div><p class="calibre9">This type of errors are<a id="id478" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> the so-called DLL Hell, which we discussed in the previous chapter. It results from incompatible shared libraries, which may lead to strange behavior or crashes.</p><p class="calibre9">In most cases, Qt libraries are backwards compatible, which means that you may replace all DLLs with newer ones and not need to recompile executables. Some certain modules or APIs may be deprecated and be deleted from a later version of Qt. For example, the <code class="literal">QGLWidget</code> class is replaced by a newly introduced <code class="literal">QOpenGLWidget</code> class in Qt 5.4. <code class="literal">QGLWidget</code> is still provided for now though.</p><p class="calibre9">In the reverse direction, things are getting pretty bad. If your application calls an API that is introduced since, for example, Qt 5.4, the application definitely will malfunction with an older version of Qt, such as Qt 5.2.</p><p class="calibre9">The following is a <a id="id479" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>simple program that makes use of <code class="literal">QSysInfo</code>, which is introduced in Qt 5.4. The <code class="literal">main.cpp</code> file of this simple <code class="literal">incompat_demo</code> project is shown here:</p><div class="calibre2"><pre class="programlisting">#include &lt;QDebug&gt;
#include &lt;QSysInfo&gt;
#include &lt;QCoreApplication&gt;

int main(int argc, char *argv[])
{
    QCoreApplication a(argc, argv);

    qDebug() &lt;&lt; "CPU:" &lt;&lt; QSysInfo::currentCpuArchitecture();

    return a.exec();
}</pre></div><p class="calibre9">
<code class="literal">QSysInfo::currentCpuArchitecture()</code> returns the architecture of the CPU that the application is running on as a <code class="literal">QString</code> object. If the version of Qt is high enough (greater than or equal to 5.4), it'll run as expected, as shown in the following screenshot:</p><div class="mediaobject"><img src="Images/4615OS_10_02.jpg" alt="Incompatible shared libraries" class="calibre90"/></div><p class="calibre9">As you can see, it <a id="id480" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>says we're running this application on a 64-bit x86 CPU machine. However, if we put the compiled executable with DLLs from Qt 5.2, it'll give an error as shown here and crash:</p><div class="mediaobject"><img src="Images/4615OS_10_03.jpg" alt="Incompatible shared libraries" class="calibre91"/></div><p class="calibre9">This situation is rare, of course. However, if this happens, you'll get an idea about what goes wrong. From the error dialog, we can see the error is because of the missing <code class="literal">QSysInfo::currentCpuArchitecture</code> line in the dynamic link library.</p><p class="calibre9">Another DLL Hell is more complex and may be ignored by beginners. All libraries must be built by the same compiler. You can't use the MSVC libraries with GCC, which holds true for other <a id="id481" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>compilers, such as ICC and Clang. Different compiler versions might cause incompatibility as well. You probably don't want to use a library compiled by GCC 4.3 in your development environment where the GCC version is 4.9. However, libraries compiled by GCC 4.9.1 should be compatible with those compiled by GCC 4.9.2.</p><p class="calibre9">In addition to compilers, different architectures are often incompatible. For example, 64-bit libraries won't work on 32-bit platforms. Similarly, x86 libraries and binaries can't be used on the non-x86 devices, such as ARM and MIPS.</p></div><div class="calibre2" title="Doesn't run on Android!"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h2 class="title5"><a id="ch10lvl2sec10" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Doesn't run on Android!</h2></div></div></div><p class="calibre9">Qt was ported to Android not too long ago. Hence, there is a possibility that it runs well on a desktop PC but not on Android. On one hand, Android hardware varies, not even speaking of thousands of customized ROMs. Therefore, it is reasonable that some Android devices may <a id="id482" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>encounter compatibility issues. On the other hand, the Qt application running on Android is a native C++ application with a Java wrapper, while binary executables are naturally more vulnerable to compatibility issues than scripts.</p><p class="calibre9">Anyway, here's the recipe:</p><div class="calibre2"><ol class="orderedlist"><li class="listitem1">Try to run your application on another Android handset or virtual Android device.</li><li class="listitem1">If it still doesn't work, it can be a potential bug of Qt on Android. We'll talk about how to report a bug to Qt at the end of this chapter.</li></ol></div></div></div></div></div>



  
<div id="sbo-rt-content" class="calibre1"><div class="calibre2" title="Debugging Qt applications"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title2"><a id="ch10lvl1sec66" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Debugging Qt applications</h1></div></div></div><p class="calibre9">To debug any Qt application, you need to ensure that you have installed the debug symbols of the Qt libraries. On Windows, they are installed together with release version DLLs. Meanwhile, on Linux, you may need to install debug symbols by the distribution's package manager.</p><p class="calibre9">Some developers tend<a id="id483" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> to use a function similar to <code class="literal">printf</code> to debug the application. Qt provides four global functions, which are shown in the following table, to print out debug, warnings, and error text:</p><div class="informaltable"><table border="1" class="calibre28"><colgroup class="calibre29"><col class="calibre30"/><col class="calibre30"/></colgroup><thead class="calibre31"><tr class="calibre32"><th valign="bottom" class="calibre33">
<p class="calibre34">Function</p>
</th><th valign="bottom" class="calibre33">
<p class="calibre34">Usage</p>
</th></tr></thead><tbody class="calibre35"><tr class="calibre36"><td class="calibre37">
<p class="calibre34">
<code class="literal">qDebug()</code>
</p>
</td><td class="calibre37">
<p class="calibre34">This function is<a id="id484" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> used for writing custom debug output.</p>
</td></tr><tr class="calibre38"><td class="calibre37">
<p class="calibre34">
<code class="literal">qWarning()</code>
</p>
</td><td class="calibre37">
<p class="calibre34">This<a id="id485" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> function is used for reporting warnings and recoverable errors.</p>
</td></tr><tr class="calibre36"><td class="calibre37">
<p class="calibre34">
<code class="literal">qCritical()</code>
</p>
</td><td class="calibre37">
<p class="calibre34">This function is used for<a id="id486" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> writing critical error messages and reporting system errors.</p>
</td></tr><tr class="calibre39"><td class="calibre37">
<p class="calibre34">
<code class="literal">qFatal()</code>
</p>
</td><td class="calibre37">
<p class="calibre34">This function is<a id="id487" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> used for printing fatal error messages shortly before exiting.</p>
</td></tr></tbody></table></div><p class="calibre9">Normally, you can just use a C-style method similar to <code class="literal">printf</code>.</p><div class="calibre2"><pre class="programlisting">qDebug("Hello %s", "World!");</pre></div><p class="calibre9">However, in most cases, we'll include the <code class="literal">&lt;QtDebug&gt;</code> header file so that we can use the stream operator (<code class="literal">&lt;&lt;</code>) as a more convenient way.</p><div class="calibre2"><pre class="programlisting">qDebug() &lt;&lt; "Hello World!"</pre></div><p class="calibre9">The most powerful place of these functions is that they can output the contents of some complex classes', <code class="literal">QList</code> and <code class="literal">QMap</code>. It's noted that these complex data types can only be printed through a stream operator (<code class="literal">&lt;&lt;</code>).</p><p class="calibre9">Both <code class="literal">qDebug()</code> and <code class="literal">qWarning()</code> are debugging tools, which mean that they can be disabled at compile time by defining <code class="literal">QT_NO_DEBUG_OUTPUT</code> and <code class="literal">QT_NO_WARNING_OUTPUT</code>, respectively.</p><p class="calibre9">In addition to these functions, Qt also provides the<a id="id488" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> <code class="literal">QObject::dumpObjectTree()</code> and <code class="literal">QObject::dumpObjectInfo()</code> functions which <a id="id489" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>are often useful, especially when an application looks strange. <code class="literal">QObject::dumpObjectTree()</code> dumps information about signal connections, which is really useful if you think there may be a problem in signal slot connections. Meanwhile, the latter dumps a tree of children to the debug output. Don't forget to build the application in <span class="strong"><strong class="calibre10">Debug</strong></span> mode, otherwise neither of them will print anything.</p><p class="calibre9">Apart from these useful debugging functions, Qt Creator has offered an intuitive way to debug your application. Ensure that you've installed Microsoft <a id="id490" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/><span class="strong"><strong class="calibre10">Console debugger</strong></span> (<span class="strong"><strong class="calibre10">CDB</strong></span>) if you're using an MSVC compiler. In other cases, the GDB debugger is bundled in a MinGW version.</p><div class="sidebar" title="Note"><div class="inner"><h3 class="title4"><a id="note32" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Note</h3><p class="calibre15">CDB is now a part<a id="id491" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> of <span class="strong"><strong class="calibre10">Windows Driver Kit</strong></span> (<span class="strong"><strong class="calibre10">WDK</strong></span>); visit <a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="http://msdn.microsoft.com/en-us/windows/hardware/hh852365">http://msdn.microsoft.com/en-us/windows/hardware/hh852365</a> to download it. Don't forget to check Debugging Tools for Windows during the installation.</p></div></div><p class="calibre9">Consider <code class="literal">Fancy_Clock</code> from <a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="ch02.xhtml" title="Chapter 2. Building a Beautiful Cross-platform Clock">Chapter 2</a>, <span class="strong"><em class="calibre14">Building a Beautiful Cross-platform Clock</em></span>, as an example. In the <code class="literal">MainWindow::setColour()</code> function, move the cursor to line 97, which is <code class="literal">switch (i) {</code>. Then, navigate to <span class="strong"><strong class="calibre10">Debug</strong></span> | <span class="strong"><strong class="calibre10">Toggle Breakpoint</strong></span> or just press <span class="strong"><em class="calibre14">F9</em></span> on the keyboard. This<a id="id492" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> will add a breakpoint on line 97, which will add a breakpoint marker (a red pause icon in front of a line number) as shown here:</p><div class="mediaobject"><img src="Images/4615OS_10_04.jpg" alt="Debugging Qt applications" class="calibre92"/></div><p class="calibre9">Now click on the <span class="strong"><strong class="calibre10">Start Debugging</strong></span> button on the pane, which has a bug on it, or navigate to <span class="strong"><strong class="calibre10">Debug</strong></span> | <span class="strong"><strong class="calibre10">Start Debugging</strong></span> | <span class="strong"><strong class="calibre10">Start Debugging</strong></span> on the menu bar, or press <span class="strong"><em class="calibre14">F5</em></span> on the keyboard. This will recompile the application, if needed, and start it in <span class="strong"><strong class="calibre10">Debug</strong></span> mode. At the same time, Qt Creator will automatically switch to <span class="strong"><strong class="calibre10">Debug</strong></span> mode.</p><div class="mediaobject"><img src="Images/4615OS_10_05.jpg" alt="Debugging Qt applications" class="calibre93"/></div><p class="calibre9">The application is interrupted because of the breakpoint we set. You can see a yellow arrow indicating which line the application is currently on, as shown in the preceding screenshot. By default, on the<a id="id493" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> right pane, you can see <span class="strong"><strong class="calibre10">Locals and Expressions</strong></span> where all the local variables along with their values and types are shown. To change the default settings, navigate to <span class="strong"><strong class="calibre10">Window</strong></span> | <span class="strong"><strong class="calibre10">Views</strong></span>, and then choose what to display or hide.</p><p class="calibre9">The panes in the <span class="strong"><strong class="calibre10">Debug</strong></span> mode are marked in blue text in this screenshot:</p><div class="mediaobject"><img src="Images/4615OS_10_06.jpg" alt="Debugging Qt applications" class="calibre48"/></div><p class="calibre9">Briefly said, you can monitor the variables in <span class="strong"><strong class="calibre10">Locals</strong></span> and expressions in <span class="strong"><strong class="calibre10">Expressions</strong></span>. <span class="strong"><strong class="calibre10">Stack</strong></span> displays the current stack and all breakpoints can be managed in the <span class="strong"><strong class="calibre10">Breakpoints</strong></span> pane.</p><p class="calibre9">On the bottom pane, there <a id="id494" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>are a series of buttons to control the debugging process. The first six buttons are <span class="strong"><strong class="calibre10">Continue</strong></span>, <span class="strong"><strong class="calibre10">Stop Debugger</strong></span>, <span class="strong"><strong class="calibre10">Step Over</strong></span>, <span class="strong"><strong class="calibre10">Step Into</strong></span>, <span class="strong"><strong class="calibre10">Step Out</strong></span>, and <span class="strong"><strong class="calibre10">Restart the debugging session</strong></span>, respectively. <span class="strong"><strong class="calibre10">Step Over</strong></span> is to execute a line of code as a whole. <span class="strong"><strong class="calibre10">Step Into</strong></span> will step into a function or a subfunction, while <span class="strong"><strong class="calibre10">Step Out</strong></span> can leave the current function or subfunction.</p><p class="calibre9">
<span class="strong"><strong class="calibre10">Breakpoints</strong></span> plays a crucial role in debugging, as you can tell whether a breakpoint represents a position or set of positions in the code that interrupts the application from being debugged and grants you control. Once it is interrupted, you can examine the state of the program or continue the execution, either line-by-line or continuously. Qt Creator shows breakpoints in the <span class="strong"><strong class="calibre10">Breakpoints</strong></span> view, which is located at the lower-right-hand side by default. You can add or delete breakpoints in the <span class="strong"><strong class="calibre10">Breakpoints</strong></span> view. To add a breakpoint, right-click on the <span class="strong"><strong class="calibre10">Breakpoints</strong></span> view and select <span class="strong"><strong class="calibre10">Add Breakpoint…</strong></span>; there will be an <span class="strong"><strong class="calibre10">Add Breakpoint</strong></span> dialog as shown here:</p><div class="mediaobject"><img src="Images/4615OS_10_07.jpg" alt="Debugging Qt applications" class="calibre94"/></div><p class="calibre9">In the <span class="strong"><strong class="calibre10">Breakpoint type</strong></span> field, select the location in the program code where you want the application to be interrupted. Other options are dependent on the selected type.</p><p class="calibre9">To move the<a id="id495" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> breakpoint, simply drag the breakpoint marker and drop it on the destination. It's not an often needed function, though.</p><p class="calibre9">There're many ways to delete <a id="id496" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>a breakpoint.</p><div class="calibre2"><ul class="itemizedlist"><li class="listitem">By clicking on the breakpoint marker in the editor, moving the cursor to the corresponding line, and navigating to <span class="strong"><strong class="calibre10">Debug</strong></span> | <span class="strong"><strong class="calibre10">Toggle Breakpoint</strong></span>, or by pressing <span class="strong"><em class="calibre14">F9</em></span></li><li class="listitem">By right-clicking on the breakpoint in the <span class="strong"><strong class="calibre10">Breakpoints</strong></span> view and selecting <span class="strong"><strong class="calibre10">Delete Breakpoint</strong></span></li><li class="listitem">By selecting the breakpoint in the <span class="strong"><strong class="calibre10">Breakpoints</strong></span> view and pressing the <span class="strong"><em class="calibre14">Delete</em></span> button on<a id="id497" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> the keyboard</li></ul></div><p class="calibre9">The most powerful place is the previously introduced <span class="strong"><strong class="calibre10">Locals and Expressions</strong></span> view. Every time the program stops under the control of the debugger, it retrieves information and displays it in the <span class="strong"><strong class="calibre10">Locals and Expressions</strong></span> view. The <span class="strong"><strong class="calibre10">Locals</strong></span> pane shows function parameters and local variables. There is a comprehensive display of data belonging to Qt's basic objects. In<a id="id498" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> this case, when the program is interrupted in <code class="literal">MainWindow::setColour()</code>, there is a pointer whose <span class="strong"><strong class="calibre10">Value</strong></span> is <code class="literal">"MainWindow"</code>. Instead of just memory address of this pointer, it can show you all the data and children that belong to this object:</p><div class="mediaobject"><img src="Images/4615OS_10_08.jpg" alt="Debugging Qt applications" class="calibre95"/></div><p class="calibre9">As you can see from preceding screenshot, this is a <code class="literal">MainWindow</code> instance, which is inherited from <code class="literal">QMainWindow</code>. It has three children items: <code class="literal">_layout</code>, <code class="literal">qt_rubberband</code>, and <code class="literal">centralWidget</code>. It's noted<a id="id499" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> that only slot functions are displayed in <code class="literal">[methods]</code>. Now you'll understand why the <span class="strong"><strong class="calibre10">Locals</strong></span> pane is the most important and commonly used view in the <span class="strong"><strong class="calibre10">Debug</strong></span> mode.</p><p class="calibre9">On the other hand, the <span class="strong"><strong class="calibre10">Expressions</strong></span> pane is even more powerful and can compute the values of arithmetic expressions or function calls. Right-click on the <span class="strong"><strong class="calibre10">Locals and Expressions</strong></span> view and select <span class="strong"><strong class="calibre10">Add New Expression Evaluator…</strong></span> in the context menu.</p><p class="calibre9">Note that the context menu entries are available only when the program is interrupted. In this case, <code class="literal">Fancy_Clock</code> is interrupted in the <code class="literal">MainWindow::setColour()</code> function where the local variable, <code class="literal">i</code>, can be used to perform some arithmetic operations. For example, we fill <code class="literal">i * 5</code> in the <span class="strong"><strong class="calibre10">New Evaluated Expression</strong></span> pop-up dialog.</p><div class="mediaobject"><img src="Images/4615OS_10_09.jpg" alt="Debugging Qt applications" class="calibre96"/></div><p class="calibre9">In addition to arithmetic operations, you can call a function to evaluate the return value. However, this function must be accessible to the debugger, which means it's either compiled into the <a id="id500" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>executable or can be invoked from a library.</p><p class="calibre9">The expression value will be re-evaluated after each step. After you click on the <span class="strong"><strong class="calibre10">OK</strong></span> button, the expression <code class="literal">i * 5</code>, is shown in the <span class="strong"><strong class="calibre10">Expressions</strong></span> pane as shown here:</p><div class="mediaobject"><img src="Images/4615OS_10_10.jpg" alt="Debugging Qt applications" class="calibre97"/></div><p class="calibre9">The value of <code class="literal">i</code> is now <code class="literal">3</code>. Therefore, the expression <code class="literal">i * 5</code> is evaluated as <code class="literal">15</code>.</p><div class="calibre2"><blockquote class="blockquote"><p class="calibre17"><span class="strong"><em class="calibre14">"Expression evaluators are powerful, but slow down debugger operation significantly. It is advisable not to use them excessively, and to remove unneeded expression evaluators as soon as possible."</em></span></p></blockquote></div><p class="calibre9">Even if functions<a id="id501" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> used in the expressions have side effects, they will be called each time the current frame changes. After all, the expression evaluator is powerful but bad for debugging speed.</p></div></div>



  
<div id="sbo-rt-content" class="calibre1"><div class="calibre2" title="Debugging Qt Quick applications"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title2"><a id="ch10lvl1sec67" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Debugging Qt Quick applications</h1></div></div></div><p class="calibre9">We will use the <code class="literal">Weather_QML</code> project from <a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="ch07.xhtml" title="Chapter 7. Parsing JSON and XML Documents to Use Online APIs">Chapter 7</a>, <span class="strong"><em class="calibre14">Parsing JSON and XML Documents to Use Online APIs</em></span>, as a demonstration <a id="id502" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>program to show how to debug a Qt Quick application.</p><p class="calibre9">First, we need to ensure that QML debugging is enabled. Open the <code class="literal">Weather_QML</code> project in Qt Creator. Then, perform the following steps:</p><div class="calibre2"><ol class="orderedlist"><li class="listitem1">Switch to the <span class="strong"><strong class="calibre10">Projects</strong></span> mode.</li><li class="listitem1">Expand the <span class="strong"><strong class="calibre10">qmake</strong></span> step in <span class="strong"><strong class="calibre10">Build Steps</strong></span>.</li><li class="listitem1">Check <span class="strong"><strong class="calibre10">Enable QML debugging</strong></span> if it's not checked.<div class="note" title="Note"><div class="inner"><h3 class="title4"><a id="tip13" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Tip</h3><p class="calibre98">Debugging QML will open a socket at a well-known port, which poses a security risk. Anyone on your network could connect to the debugging application and execute any JavaScript function. Therefore, you have to make sure there are appropriate firewall rules.</p></div></div></li></ol></div><p class="calibre9">The same procedure is used to start QML debugging, which is to navigate to <span class="strong"><strong class="calibre10">Debug</strong></span> | <span class="strong"><strong class="calibre10">Start Debugging</strong></span> | <span class="strong"><strong class="calibre10">Start Debugging</strong></span>, or click the <span class="strong"><strong class="calibre10">Debug</strong></span> button, or just press <span class="strong"><em class="calibre14">F5</em></span>. It may trigger a <span class="strong"><strong class="calibre10">Windows Security Alert</strong></span>, shown<a id="id503" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> in the following screenshot. Don't forget to click on the <span class="strong"><strong class="calibre10">Allow access</strong></span> button.</p><div class="mediaobject"><img src="Images/4615OS_10_11.jpg" alt="Debugging Qt Quick applications" class="calibre99"/></div><p class="calibre9">Once the application starts running, it behaves and performs as usual. However, you can perform some useful tasks in debugging mode. You can see all the elements and their properties in the <span class="strong"><strong class="calibre10">Locals</strong></span> pane as we did for the Qt/C++ applications.</p><p class="calibre9">In addition to just watching these variables, you can change them temporarily and see the changes at runtime immediately. To change a value, you can either directly change it in the <span class="strong"><strong class="calibre10">Locals</strong></span> pane or change it in <span class="strong"><strong class="calibre10">QML/JS Console</strong></span>.</p><p class="calibre9">For example, to change the <code class="literal">title</code> property of <code class="literal">ApplicationWindow</code>, perform the following steps:</p><div class="calibre2"><ol class="orderedlist"><li class="listitem1">Expand <span class="strong"><strong class="calibre10">ApplicationWindow</strong></span> | <span class="strong"><strong class="calibre10">Properties</strong></span> in the <span class="strong"><strong class="calibre10">Locals</strong></span> pane.</li><li class="listitem1">Double-click on the <code class="literal">title</code> entry.</li><li class="listitem1">Change the value from <code class="literal">Weather QML</code> to <code class="literal">Yahoo! Weather</code>.</li><li class="listitem1">Press the <span class="strong"><em class="calibre14">Enter</em></span> or <span class="strong"><em class="calibre14">Return</em></span> key on the keyboard to confirm.</li></ol></div><p class="calibre9">Alternatively, you can change it in <span class="strong"><strong class="calibre10">QML/JS Console</strong></span>. There is no need to expand <code class="literal">ApplicationWindow</code>; just click on <code class="literal">ApplicationWindow</code> in the <span class="strong"><strong class="calibre10">Locals</strong></span> pane. You'll notice <span class="strong"><strong class="calibre10">Context</strong></span> on the <span class="strong"><strong class="calibre10">QML/JS Console</strong></span> panel will become <code class="literal">ApplicationWindow</code>, as shown in the following<a id="id504" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> screenshot. Then, just input the <code class="literal">title="Yahoo! Weather"</code> command to change the title.</p><div class="mediaobject"><img src="Images/4615OS_10_12.jpg" alt="Debugging Qt Quick applications" class="calibre100"/></div><p class="calibre9">You'll notice the title in the application window is changed to <span class="strong"><strong class="calibre10">Yahoo! Weather</strong></span> immediately, as shown here:</p><div class="mediaobject"><img src="Images/4615OS_10_13.jpg" alt="Debugging Qt Quick applications" class="calibre72"/></div><p class="calibre9">Meanwhile, the source code is left intact. This feature is really handy when you want to test a better value for a property. Instead of changing it in the code and rerunning, you can change and test it on<a id="id505" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> the fly. In fact, you can also execute the JavaScript expressions in <span class="strong"><strong class="calibre10">QML/JS Console</strong></span>, not just change their values.</p></div></div>



  
<div id="sbo-rt-content" class="calibre1"><div class="calibre2" title="Useful resources"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title2"><a id="ch10lvl1sec68" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Useful resources</h1></div></div></div><p class="calibre9">Still getting stuck with an issue? In addition to online search engines, there are two online forums that could also be useful for you. The first one<a id="id506" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> is the forum in the Qt Project, whose URL is <a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="http://qt-project.org/forums">http://qt-project.org/forums</a>. The other one is maintained by<a id="id507" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> a community site, Qt Centre, and its URL is <a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="http://www.qtcentre.org/forum.php">http://www.qtcentre.org/forum.php</a>.</p><p class="calibre9">In most cases, you should be able to find similar or even identical problems on these websites. If not, you can post a new thread asking for help. Describe the problem as thoroughly as possible so that other users can get an idea of what's going wrong.</p><p class="calibre9">There is a possibility that you did everything correctly but still might be getting unexpected results, compiler errors, or crashes. In this case, it may be a Qt bug. If you believe that you've encountered a Qt bug, you are encouraged to report it. It's easy to report a bug since Qt has<a id="id508" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> a bug tracker, whose URL is <a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="https://bugreports.qt.io">https://bugreports.qt.io</a>.</p><div class="sidebar" title="Note"><div class="inner"><h3 class="title4"><a id="tip14" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Tip</h3><p class="calibre15">The quality of the bug report dramatically impacts how soon the bug will be fixed.</p></div></div><p class="calibre9">To produce a high-quality bug report, here is a<a id="id509" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> simple step-by-step manual:</p><div class="calibre2"><ol class="orderedlist"><li class="listitem1">Visit the Qt bug tracker website.</li><li class="listitem1">Log in. If it's your first time, you need to create a new account. Remember to supply a valid e-mail address as this is the only way for the Qt developers to contact you.</li><li class="listitem1">Use the <span class="strong"><strong class="calibre10">Search</strong></span> field on the upper-right side to find any similar, or even identical bugs.</li><li class="listitem1">If you find one, you can leave a comment with any additional information that you have. Besides, you can click on <span class="strong"><strong class="calibre10">Vote</strong></span> to vote for that bug. Lastly, you could add yourself as a watcher if you want to track the progress.</li><li class="listitem1">If not, click on <span class="strong"><strong class="calibre10">Create New Issues</strong></span> and fill in the fields.</li></ol></div><p class="calibre9">You should enter a brief descriptive text in <span class="strong"><strong class="calibre10">Summary</strong></span>. This is not only for a higher chance to get it fixed, but also good for other people searching for existing bugs. For other fields, you're always encouraged to provide as much information as you can.</p></div></div>



  
<div id="sbo-rt-content" class="calibre1"><div class="calibre2" title="Summary"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title2"><a id="ch10lvl1sec69" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Summary</h1></div></div></div><p class="calibre9">After having a read through this chapter, you can sort out the majority of Qt-based issues on your own. We started off with a few commonly encountered problems, followed by how to debug Qt and Qt Quick applications. At the end, there were a few useful links to help you crack down on the varied issues and errors. If you encounter any problem with a particular Qt bug, don't panic, just go to the bug tracker and report it.</p></div></div>



  </body></html>