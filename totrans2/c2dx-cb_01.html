<html><head></head><body><div class="chapter" title="Chapter&#xA0;1.&#xA0;Getting Started with Cocos2d-x"><div class="titlepage"><div><div><h1 class="title"><a id="ch01"/>Chapter 1. Getting Started with Cocos2d-x</h1></div></div></div><p>In this chapter, we're going to install Cocos2d-x and set up the development environment. The following topics will be covered in this chapter:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Setting up our Android environment</li><li class="listitem" style="list-style-type: disc">Installing Cocos2d-x</li><li class="listitem" style="list-style-type: disc">Using the Cocos command</li><li class="listitem" style="list-style-type: disc">Building the project using Xcode</li><li class="listitem" style="list-style-type: disc">Building the project using Eclipse</li><li class="listitem" style="list-style-type: disc">Implementing multi-resolution support</li><li class="listitem" style="list-style-type: disc">Preparing your original game</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec09"/>Introduction</h1></div></div></div><p>Cocos2d-x<a id="id0" class="indexterm"/> is an open source, cross-platform game engine, which is free and mature. It can publish games for mobile devices and desktops, including iPhone, iPad, Android, Kindle, Windows, and Mac. Cocos2d-x is written in C++, so it can build on any platform. Cocos2d-x is open source written in C++, so we can feel free to read the game framework. Cocos2d-x is not a black box, and this proves to be a big advantage for us when we use it. Cocos2d-x version 3, which supports C++11, was only recently released. It also supports 3D and has an improved rendering performance. This book focuses on using version 3.4, which is the latest version of Cocos2d-x that was available at the time of writing this book. This book also focuses on iOS and Android development, and we'll be using Mac because we need it to develop iOS applications. This chapter explains how to set up Cocos2d-x.</p></div></div>
<div class="section" title="Setting up our Android Environment"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec10"/>Setting up our Android Environment</h1></div></div></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec13"/>Getting ready</h2></div></div></div><p>We begin by setting up our <a id="id1" class="indexterm"/>Android environment. If you wish to build only on iOS, you can skip this step. To follow this recipe, you will need some files.</p><p>The following list provides the prerequisites that need to be downloaded to set up Android:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Eclipse ADT (Android Developer Tools) with the<a id="id2" class="indexterm"/> Android SDK:<p><a class="ulink" href="https://dl.google.com/android/adt/adt-bundle-mac-x86_64-20140702.zip">https://dl.google.com/android/adt/adt-bundle-mac-x86_64-20140702.zip</a></p><p>Eclipse ADT includes the Android SDK and Eclipse IDE. This is the Android development tool that is used to develop Android applications. Android Studio is an Android development IDE, but it is not supported to build NDK. The official site states that a version of Android Studio that supports NDK will be released soon. That's why we use Eclipse in this book.</p></li><li class="listitem" style="list-style-type: disc">Android <a id="id3" class="indexterm"/>NDK (Native Development Kit):<p><a class="ulink" href="https://dl.google.com/android/ndk/android-ndk-r10c-darwin-x86_64.bin">https://dl.google.com/android/ndk/android-ndk-r10c-darwin-x86_64.bin</a></p><p>The NDK is required to build an Android application. You have to use NDK r10c. This is because compiling and linking errors may occur when using NDK r9 or an earlier version.</p></li><li class="listitem" style="list-style-type: disc">Apache ANT:<p>You can download Apache ANT<a id="id4" class="indexterm"/> from <a class="ulink" href="http://ant.apache.org/bindownload.cgi">http://ant.apache.org/bindownload.cgi</a></p><p>This is a java library that aids in building software. At the time of writing this book, version 1.9.4 was the latest stable version available.</p></li></ul></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec14"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">You begin by installing Eclipse ADT with the Android SDK, and then continue to unzip the zip file to any working directory you are aware of. I recommend that you unzip it to the <code class="literal">Documents</code> folder (<code class="literal">~/adt-bundle-mac-x86_64-20140702</code>). ADT includes Android SDK and Eclipse. The SDK and Eclipse folders are located under the ADT folder. We call the SDK folder path that is located under the ADT folder <code class="literal">ANDROID_SDK_ROOT</code>. You have to remember it because you will use it the next recipe. Now, you can launch Eclipse from <code class="literal">~/adt-bundle-mac-x86_64-20140702/eclipse/Eclipse.app</code>.</li><li class="listitem">The next step is to<a id="id5" class="indexterm"/> update Android SDK:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Open Eclipse from the <code class="literal">eclipse</code> folder located in ADT.</li><li class="listitem" style="list-style-type: disc">Go to <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Android SDK Manager</strong></span>.</li><li class="listitem" style="list-style-type: disc">After opening <span class="strong"><strong>Android SDK Manager</strong></span>, check <span class="strong"><strong>Tools</strong></span> and the latest Android SDK (<code class="literal">API21</code>), <code class="literal">Android 2.3.3(API10)</code>, and any other SDK if necessary, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/B0561_01_1.jpg" alt="How to do it..."/></div></li><li class="listitem" style="list-style-type: disc">Click on<a id="id6" class="indexterm"/> <span class="strong"><strong>Install packages...</strong></span>.</li><li class="listitem" style="list-style-type: disc">Select each license and click on <span class="strong"><strong>Accept,</strong></span> as shown in the following screenshot:<div class="mediaobject"><img src="graphics/B0561_01_2.jpg" alt="How to do it..."/></div></li><li class="listitem" style="list-style-type: disc">After <a id="id7" class="indexterm"/>you accept all licenses, you will see that the <span class="strong"><strong>Install</strong></span> button is enabled. Click on it.</li><li class="listitem" style="list-style-type: disc">You have to wait for a long time to update and install the SDKs.</li></ul></div></li><li class="listitem">Installing NDK:<p>Open the <a id="id8" class="indexterm"/>terminal window and change the directory to the path from which you downloaded the package. Change the permission on the downloaded package and execute the package. For example:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ chmod 700 android-ndk-r10c-darwin-x86_64.bin</strong></span>
<span class="strong"><strong>$ ./android-ndk-r10c-darwin-x86_64.bin</strong></span>
</pre></div><p>Finally, you move the <code class="literal">NDK</code> folder to the <code class="literal">Documents</code> folder. We call the installation path for NDK <code class="literal">NDK_ROOT</code>. <code class="literal">NDK_ROOT</code> is the address of the folder that contains the files, it helps the Cocos2dx engine to locate the native files <a id="id9" class="indexterm"/>of Android. You have to remember <code class="literal">NDK_ROOT</code> because you will use it in the next recipe.</p></li><li class="listitem">Installing Apache ANT:<p>Unzip <a id="id10" class="indexterm"/>the file to the <code class="literal">Documents</code> folder. That's all. We call <code class="literal">ANT_ROOT</code> the installation path for ANT. You have<a id="id11" class="indexterm"/> to remember <code class="literal">ANT_ROOT</code>, as we'll be using it in the next recipe.</p></li><li class="listitem">Installing Java:<p>By entering the<a id="id12" class="indexterm"/> following command in the terminal, you can automatically install Java (if you haven't installed it earlier):</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ java --version</strong></span>
</pre></div><p>After installing it, you can check that it was successfully installed by entering the command again.</p></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec15"/>How it works...</h2></div></div></div><p>Let's take a look at what we did throughout the recipe:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Installing Eclipse: You can use Eclipse as an editor for Cocos2d-x</li><li class="listitem" style="list-style-type: disc">Installing ADT: You can develop Android applications on Eclipse</li><li class="listitem" style="list-style-type: disc">Installing NDK: You can build a C++ source code for Java</li><li class="listitem" style="list-style-type: disc">Installing ANT: You can use command line tools for Cocos2d-x</li></ul></div><p>Now you've finished setting up the Android development environment. At this point, you know how to install them and their path. In the next recipe, you will use them to build and execute Android applications. This will be very useful when you want to debug Android applications.</p></div></div>
<div class="section" title="Installing Cocos2d-x"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec11"/>Installing Cocos2d-x</h1></div></div></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec16"/>Getting ready</h2></div></div></div><p>To follow this recipe, you need to<a id="id13" class="indexterm"/> download the zip file from the official site of Cocos2d-x (<a class="ulink" href="http://www.cocos2d-x.org/download">http://www.cocos2d-x.org/download</a>).</p><p>At the time of writing this <a id="id14" class="indexterm"/>book, version 3.4 was the latest stable version that was <a id="id15" class="indexterm"/>available. This version will be used throughout this book.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec17"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Unzip your file to any folder. This time, we will install the user's home directory. For example, if the user name is <code class="literal">syuhari</code>, then the install path is <code class="literal">/Users/syuhari/cocos2d-x-3.4</code>. In this book, we call it <code class="literal">COCOS_ROOT</code>.</li><li class="listitem">The following steps will guide you through the process of setting up Cocos2d-x:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Open the terminal</li><li class="listitem" style="list-style-type: disc">Change the directory in terminal to <code class="literal">COCOS_ROOT</code>, using the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cd ~/cocos2d-x-v3.4</strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc">Run <code class="literal">setup.py</code>, using the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ ./setup.py</strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc">The terminal will ask you for <code class="literal">NDK_ROOT</code>. Enter into <code class="literal">NDK_ROOT</code> path.</li><li class="listitem" style="list-style-type: disc">The terminal will then ask you for <code class="literal">ANDROID_SDK_ROOT</code>. Enter the <code class="literal">ANDROID_SDK_ROOT</code> path.</li><li class="listitem" style="list-style-type: disc">Finally, the terminal will ask you for <code class="literal">ANT_ROOT</code>. Enter the <code class="literal">ANT_ROOT</code> path.</li><li class="listitem" style="list-style-type: disc">After the execution of the <code class="literal">setup.py</code> command, you need to execute the following command to add the system variables:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ source ~/.bash_profile</strong></span>
</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip02"/>Tip</h3><p>Open the <code class="literal">.bash_profile</code> file, and you will find that <code class="literal">setup.py</code> shows how to set each path in your system. You can view the <code class="literal">.bash_profile</code> file using the <code class="literal">cat</code> command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cat ~/.bash_profile</strong></span>
</pre></div></div></div></li></ul></div></li><li class="listitem">We now verify whether Cocos2d-x can be installed:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Open the<a id="id16" class="indexterm"/> terminal and run the <code class="literal">cocos</code> command without parameters:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cocos</strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc">If you can <a id="id17" class="indexterm"/>see a window like the following screenshot, you have successfully completed the Cocos2d-x install process:</li></ul></div><div class="mediaobject"><img src="graphics/B0561_01_4.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec18"/>How it works...</h2></div></div></div><p>Let's take a look <a id="id18" class="indexterm"/>at what we did throughout the above recipe. You can install<a id="id19" class="indexterm"/> Cocos2d-x by just unzipping it. You know <code class="literal">setup.py</code> is only setting up the <code class="literal">cocos</code> command and the path for Android build in the environment. Installing Cocos2d-x is very easy and simple. If you want to install a different version of Cocos2d-x, you can do that too. To do so, you need to follow the same steps that are given in this recipe, but they will be for a different version.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec19"/>There's more...</h2></div></div></div><p>Setting up the Android environment  is a bit tough. If you recently started to develop Cocos2d-x, you can skip the settings part of Android. and you can do it when you run on Android. In this case, you don't have to install Android SDK, NDK, and Apache ANT. Also, when you run <code class="literal">setup.py</code>, you only press <span class="emphasis"><em>Enter</em></span> without entering a path for each question.</p></div></div>
<div class="section" title="Using the Cocos command"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec12"/>Using the Cocos command</h1></div></div></div><p>The next step is using the<a id="id20" class="indexterm"/> <code class="literal">cocos</code> command. It is a cross-platform tool with which you can create a new project, build it, run it, and deploy it. The <code class="literal">cocos</code> command works for all Cocos2d-x supported platforms and you don't need to use an IDE if you don't want to. In this recipe, we take a look at this command and explain how to use it.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec20"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">You can use the <code class="literal">cocos</code> command help by executing it with the <code class="literal">--help</code> parameter, as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cocos --help</strong></span>
</pre></div></li><li class="listitem">We then move on to generating our new project:<p>First, we create a new Cocos2d-x project with the <code class="literal">cocos new</code> command, as shown here: </p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cocos new MyGame -p com.example.mygame -l cpp -d ~/Documents/</strong></span>
</pre></div><p>The result of this command is shown the following screenshot:</p><div class="mediaobject"><img src="graphics/B0561_01_5.jpg" alt="How to do it..."/></div><p>Behind <a id="id21" class="indexterm"/>the <code class="literal">new</code> parameter is the project name. The other parameters that are mentioned denote the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">MyGame</code> is the name of your project.</li><li class="listitem" style="list-style-type: disc"><code class="literal">-p</code> is the package name for Android. This is the application ID in the Google Play store. So, you should use the reverse domain name as the unique name.</li><li class="listitem" style="list-style-type: disc"><code class="literal">-l</code> is the programming language used for the project. You should use <code class="literal">cpp</code> because we will use C++ in this book.</li><li class="listitem" style="list-style-type: disc"><code class="literal">-d</code> is the location in which to generate the new project. This time, we generate it in the user's documents directory.</li></ul></div><p>You can look up these variables using the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cocos new —help</strong></span>
</pre></div><p>Congratulations, you can generate your new project. The next step is to build and run using the <code class="literal">cocos</code> command.</p></li><li class="listitem">Compiling the project:<p>If you want to build and run for iOS, you need to execute the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cocos run -s ~/Documents/MyGame -p ios</strong></span>
</pre></div><p>The <a id="id22" class="indexterm"/>parameters that are mentioned are explained as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">-s</code> is the directory of the project. This could be an absolute path or a relative path.</li><li class="listitem" style="list-style-type: disc"><code class="literal">-p</code> denotes which platform to run on. If you want to run on Android you use <code class="literal">-p android</code>. The available options are IOS, Android, Win32, Mac, and Linux.</li><li class="listitem" style="list-style-type: disc">You can run <code class="literal">cocos run –help</code> for more detailed information.</li></ul></div><p>The result of this command is shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/B0561_01_6.jpg" alt="How to do it..."/></div></li><li class="listitem">You can<a id="id23" class="indexterm"/> now build and run iOS applications on cocos2d-x. However, you have to wait for a long time if this is your first time building an iOS application. It takes a long time to build a Cocos2d-x library, depending on if it was a clean build or a first build.<div class="mediaobject"><img src="graphics/B0561_01_7.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec21"/>How it works...</h2></div></div></div><p>The <code class="literal">cocos</code> command <a id="id24" class="indexterm"/>can create a new project and build it. You should use the <code class="literal">cocos</code> command if you want to create a new project. Of course, you can build using Xcode or Eclipse. You can easily develop and debug using these tools.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec22"/>There's more...</h2></div></div></div><p>The cocos <code class="literal">run</code> command has other parameters. They are the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">--portrait</code> will<a id="id25" class="indexterm"/> set the project as a portrait. This command has no argument.</li><li class="listitem" style="list-style-type: disc"><code class="literal">--ios-bundleid</code> will set the<a id="id26" class="indexterm"/> bundle ID for the iOS project. However, it is not difficult to set it later.</li></ul></div><p>The <code class="literal">cocos</code> command also includes some other commands, which are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <code class="literal">compile</code> command: This <a id="id27" class="indexterm"/>command is used to build a project. The following patterns are useful parameters. You can see all parameters and options if you execute the <code class="literal">cocos compile [–h]</code> command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>cocos compile [-h] [-s SRC_DIR] [-q] [-p PLATFORM] [-m MODE]</strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc">The <code class="literal">deploy</code> command: This<a id="id28" class="indexterm"/> command only takes effect when the target platform is Android. It will re-install the specified project to the android device or simulator:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>cocos deploy [-h] [-s SRC_DIR] [-q] [-p PLATFORM] [-m MODE]</strong></span>
</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip03"/>Tip</h3><p>The <code class="literal">run</code> command continues to compile and deploy commands.</p></div></div></li></ul></div></div></div>
<div class="section" title="Building the project using Xcode"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec13"/>Building the project using Xcode</h1></div></div></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec23"/>Getting ready</h2></div></div></div><p>Before building the<a id="id29" class="indexterm"/> project using Xcode, you require Xcode with an iOS <a id="id30" class="indexterm"/>developer account to test it on a physical device. However, you can also test it on an iOS simulator. If you did not install Xcode, you can get it from the Mac App Store. Once you have installed it, get it activated.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec24"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open your project from Xcode:<p>You can open your project by double-clicking on the file placed at: <code class="literal">~/Documents/MyGame/proj.ios_mac/MyGame.xcodeproj</code>:</p><div class="mediaobject"><img src="graphics/B0561_01_8.jpg" alt="How to do it..."/></div></li><li class="listitem">Build and Run using Xcode:<p>You <a id="id31" class="indexterm"/>should select an iOS simulator or real device on which you want to run your project.</p></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec25"/>How it works...</h2></div></div></div><p>If this is your first time building, it will take a long time but continue to build with confidence as it's the first time. You can develop your game faster if you develop and debug it using Xcode rather than Eclipse.</p></div></div>
<div class="section" title="Building the project using Eclipse"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec14"/>Building the project using Eclipse</h1></div></div></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec26"/>Getting ready</h2></div></div></div><p>You must finish the first <a id="id32" class="indexterm"/>recipe before you begin this step. If you have not finished <a id="id33" class="indexterm"/>it yet, you will need to install Eclipse.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec27"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Setting up <code class="literal">NDK_ROOT</code>:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Open the preference of Eclipse</li><li class="listitem" style="list-style-type: disc">Open <span class="strong"><strong>C++</strong></span> | <span class="strong"><strong>Build</strong></span> | <span class="strong"><strong>Environment</strong></span><div class="mediaobject"><img src="graphics/B0561_01_9.jpg" alt="How to do it..."/></div></li></ul></div></li><li class="listitem">Click on <span class="strong"><strong>Add</strong></span> and set the new variable, the name is <code class="literal">NDK_ROOT</code>, and the value is <code class="literal">NDK_ROOT</code> path:<div class="mediaobject"><img src="graphics/B0561_01_10.jpg" alt="How to do it..."/></div></li><li class="listitem">Importing your <a id="id34" class="indexterm"/>project into Eclipse:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Open the <a id="id35" class="indexterm"/>file and click on <span class="strong"><strong>Import</strong></span></li><li class="listitem" style="list-style-type: disc">Go to <span class="strong"><strong>Android</strong></span> | <span class="strong"><strong>Existing Android Code into Workspace</strong></span></li><li class="listitem" style="list-style-type: disc">Click on <span class="strong"><strong>Next</strong></span></li></ul></div><div class="mediaobject"><img src="graphics/B0561_01_11.jpg" alt="How to do it..."/></div></li><li class="listitem">Import the project into Eclipse at <code class="literal">~/Documents/MyGame/proj.android</code>:<div class="mediaobject"><img src="graphics/B0561_01_12.jpg" alt="How to do it..."/></div></li><li class="listitem">Importing the <a id="id36" class="indexterm"/>Cocos2d-x library into Eclipse:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Perform<a id="id37" class="indexterm"/> the same steps from Step 3 to Step 4.</li><li class="listitem" style="list-style-type: disc">Import the project <code class="literal">cocos2d lib</code> at <code class="literal">~/Documents/MyGame/cocos2d/cocos/platform/android/java</code>, using the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>importing cocos2d lib</strong></span>
</pre></div></li></ul></div><div class="mediaobject"><img src="graphics/B0561_01_13.jpg" alt="How to do it..."/></div></li><li class="listitem">Build and<a id="id38" class="indexterm"/> Run:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Click<a id="id39" class="indexterm"/> on the <code class="literal">Run</code> icon</li><li class="listitem" style="list-style-type: disc">The first time, Eclipse will ask you to select a way to run your application. Select <span class="strong"><strong>Android Application</strong></span> and click on <span class="strong"><strong>OK</strong></span>, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/B0561_01_14.jpg" alt="How to do it..."/></div></li><li class="listitem" style="list-style-type: disc">If you <a id="id40" class="indexterm"/>connected to the Android <a id="id41" class="indexterm"/>device on your Mac, you can run your game on your real device or an emulator. The following screenshot shows that it is running on Nexus5:<div class="mediaobject"><img src="graphics/B0561_01_15.jpg" alt="How to do it..."/></div></li></ul></div></li><li class="listitem">If you added <code class="literal">cpp</code> files into your project, you have to modify the <code class="literal">Android.mk</code> file at <code class="literal">~/Documents/MyGame/proj.android/jni/Android.mk</code>. This file is needed to build the NDK. This fix is required to add files.</li><li class="listitem">The original <code class="literal">Android.mk</code> would look as follows:<div class="informalexample"><pre class="programlisting">LOCAL_SRC_FILES := hellocpp/main.cpp \
                   ../../Classes/AppDelegate.cpp \
                   ../../Classes/HelloWorldScene.cpp</pre></div></li><li class="listitem">If you added the <code class="literal">TitleScene.cpp</code> file, you have to modify it as shown in the following code:<div class="informalexample"><pre class="programlisting">LOCAL_SRC_FILES := hellocpp/main.cpp \
                   ../../Classes/AppDelegate.cpp \
                   ../../Classes/HelloWorldScene.cpp \
                   ../../Classes/TitleScene.cpp </pre></div></li></ol></div><p>The preceding example shows an instance of when you add the <code class="literal">TitleScene.cpp</code> file. However, if you are also adding other files, you need to add all the added files.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec28"/>How it works...</h2></div></div></div><p>You get lots of <a id="id42" class="indexterm"/>errors when importing your project into Eclipse, but <a id="id43" class="indexterm"/>don't panic. After importing the Cocos2d-x library, errors soon disappear. This allows us to set the path of the NDK, Eclipse could compile C++. After you have modified the C++ codes, run your project in Eclipse. Eclipse automatically compiles C++ codes, Java codes, and then runs.</p><p>It is a tedious task to fix <code class="literal">Android.mk</code> again to add the C++ files. The following code is the original <code class="literal">Android.mk</code>:</p><div class="informalexample"><pre class="programlisting">LOCAL_SRC_FILES := hellocpp/main.cpp \
                   ../../Classes/AppDelegate.cpp \
                   ../../Classes/HelloWorldScene.cpp

LOCAL_C_INCLUDES := $(LOCAL_PATH)/../../Classes</pre></div><p>The following code is the customized <code class="literal">Android.mk</code> that adds C++ files automatically:</p><div class="informalexample"><pre class="programlisting">CPP_FILES := $(shell find $(LOCAL_PATH)/../../Classes -name *.cpp)
LOCAL_SRC_FILES := hellocpp/main.cpp
LOCAL_SRC_FILES += $(CPP_FILES:$(LOCAL_PATH)/%=%)

LOCAL_C_INCLUDES := $(shell find $(LOCAL_PATH)/../../Classes -type d)</pre></div><p>The first line of the code gets C++ files to the <code class="literal">Classes</code> directory into the <code class="literal">CPP_FILES</code> variable. The second and third lines add C++ files into the <code class="literal">LOCAL_C_INCLUDES</code> variable. By doing so, C++ files will be automatically compiled in the NDK. If you need to compile a file other than the <a id="id44" class="indexterm"/>extension <code class="literal">.cpp</code> file, you will need to add it <a id="id45" class="indexterm"/>manually.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec29"/>There's more...</h2></div></div></div><p>If you want to<a id="id46" class="indexterm"/> manually build C++<a id="id47" class="indexterm"/> in NDK, you can use the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ ./build_native.py</strong></span>
</pre></div><p>This script is located in <code class="literal">~/Documents/MyGame/proj.android</code> . It uses <code class="literal">ANDROID_SDK_ROOT</code> and <code class="literal">NDK_ROOT</code> in it. If you want to see its options, run <code class="literal">./build_native.py –help</code>.</p></div></div>
<div class="section" title="Implementing multi-resolution support"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec15"/>Implementing multi-resolution support</h1></div></div></div><p>You may notice a <a id="id48" class="indexterm"/>difference in screen appearance on different devices. In some previous recipes, there is an iOS's screenshot and a Nexus 5's screenshot. It shows different image sizes. This image is <code class="literal">HelloWorld.png</code> located at <code class="literal">MyGame/Resources</code>. It is 480 x 320 pixels. In this recipe, we explain how to maintain the same size regardless of screen size.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec30"/>How to do it…</h2></div></div></div><p>Open <code class="literal">AppDelegate.cpp</code> through Xcode, and modify the <code class="literal">AppDelegate::applicationDidFinishLaunching()</code> method by adding the code after the <code class="literal">director-&gt;setAnimationInterval(1.0/60.0);</code> line, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">director-&gt;setAnimationInterval(1.0 / 60);
glview-&gt;setDesignResolutionSize(640, 960, ResolutionPolicy::NO_BORDER);</pre></div><p>In this book, we design the game with a screen size of iPhone's 3.5 inch screen. So, we set this screen size to the design resolution size by using the <code class="literal">setDesignResolutionSize</code> method. The last parameter is resolution policy. The following screenshot is the Nexus 5's screenshot after implementing multi-resolution:</p><div class="mediaobject"><img src="graphics/B0561_01_16.jpg" alt="How to do it…"/></div><p>The following<a id="id49" class="indexterm"/> screenshot is the iPhone 5 simulator's screenshot. You now know that both screenshots have the same appearance:</p><div class="mediaobject"><img src="graphics/B0561_01_17.jpg" alt="How to do it…"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec31"/>How it works…</h2></div></div></div><p>The resolution <a id="id50" class="indexterm"/>policy has <code class="literal">EXACT_FIT</code>, <code class="literal">NO_BORDER</code>, <code class="literal">SHOW_ALL</code>, <code class="literal">FIXED_HEIGHT,</code> and <code class="literal">FIXED_WIDTH</code>. These are explained as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">EXACT_FIT</code>: The entire<a id="id51" class="indexterm"/> application is visible in the specified area without trying to preserve the original aspect ratio.</li><li class="listitem" style="list-style-type: disc"><code class="literal">NO_BORDER</code>: The<a id="id52" class="indexterm"/> entire application fills the specified area, without distortion but possibly with some cropping, while maintaining the original aspect ratio of the application.</li><li class="listitem" style="list-style-type: disc"><code class="literal">SHOW_ALL</code>: The <a id="id53" class="indexterm"/>entire application is visible in the specified area without distortion, while maintaining the internal the aspect ratio of the application. Borders can appear on two sides of the application.</li><li class="listitem" style="list-style-type: disc"><code class="literal">FIXED_HEIGHT</code>: The <a id="id54" class="indexterm"/>application takes the height of the design resolution size and modifies the width of the internal canvas so that it fits the aspect ratio of the device. No distortion will occur, however, you must make sure your application works on different aspect ratios.</li><li class="listitem" style="list-style-type: disc"><code class="literal">FIXED_WIDTH</code>: The<a id="id55" class="indexterm"/> application takes the width of the design resolution size and modifies the height of the internal canvas so that it fits the aspect ratio of the device. No distortion will occur, however, you must make sure your application works on different aspect ratios.</li></ul></div><p>By implementing <a id="id56" class="indexterm"/>multi-resolution, regardless of screen size, you will maintain the image on the screen.</p></div></div>
<div class="section" title="Preparing your original game"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec16"/>Preparing your original game</h1></div></div></div><p>In the next chapter, we will<a id="id57" class="indexterm"/> start the original game. You know there are a lot of comments and codes in <code class="literal">HelloWorldScene.cpp</code> and the <code class="literal">HelloWorldScene.h</code> file. That's why we will remove unnecessary codes in the template project and get started with the original game right away.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec32"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">HelloWorldScene.h</code> and remove the <code class="literal">menuCloseCallback</code> method and unnecessary comments. Now <code class="literal">HelloWorldScene.h</code> should look like the following code:<div class="informalexample"><pre class="programlisting"> #ifndef __HELLOWORLD_SCENE_H__
   #define __HELLOWORLD_SCENE_H__
   #include "cocos2d.h" 

   class HelloWorld : public cocos2d::Layer
   { 
public:
    static cocos2d::Scene* createScene();
    virtual bool init();
    CREATE_FUNC(HelloWorld);
};
#endif // __HELLOWORLD_SCENE_H__</pre></div></li><li class="listitem">The next step is to open <code class="literal">HelloWorldScene.cpp</code> and remove unnecessary comments, codes, and methods. Now <code class="literal">HelloWorldScene.cpp</code> should look like the following code:<div class="informalexample"><pre class="programlisting">#include "HelloWorldScene.h"
USING_NS_CC; 
Scene* HelloWorld::createScene()
{
    auto scene = Scene::create();
    auto layer = HelloWorld::create();
    scene-&gt;addChild(layer);
    return scene;
} 
bool HelloWorld::init()
{
    if ( !Layer::init() )
    {
        return false;
    }
    return true;
}</pre></div></li><li class="listitem">The next step is to<a id="id58" class="indexterm"/> remove unnecessary images in <code class="literal">resources</code>. Remove <code class="literal">CloseNormal.png</code>, <code class="literal">CloseSelected.png</code> and <code class="literal">HelloWorld.png</code> from the <code class="literal">Resources</code> folder in Xcode:<div class="mediaobject"><img src="graphics/B0561_01_18.jpg" alt="How to do it…"/></div></li><li class="listitem">Finally, if you are developing only iOS and Android applications, you don't need files for other platforms such as  Linux, Windows, and Windows Phone. You should remove these files.<p>Before removing platform files, it should look like the following screenshot:</p><div class="mediaobject"><img src="graphics/B0561_01_19.jpg" alt="How to do it…"/></div><p>After removing<a id="id59" class="indexterm"/> platform files, it should look like the following screenshot:</p><div class="mediaobject"><img src="graphics/B0561_01_20.jpg" alt="How to do it…"/></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec33"/>How it works…</h2></div></div></div><p>With this recipe, you <a id="id60" class="indexterm"/>can get the simplest project ready before removing unnecessary comments, codes, and methods. Removing unnecessary platform codes and resources is important for reducing the size of your application. If you start building your original game from scratch, you will need to follow this recipe or chances are, you may get a black screen if you build and run this project. In the next chapter, you can start coding within this simple project.</p></div></div></body></html>