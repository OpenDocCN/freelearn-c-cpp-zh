<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Scripting and Data in Unreal</h1></div></div></div><p>Now that we've got a design to work from, we can begin to develop the game.</p><p>Before we can do that, however, we'll be exploring the variety of ways in which we can work with game code and game data in the Unreal game engine.</p><p>This chapter will walk you through the steps necessary to get Unreal and Visual Studio installed, and to create a new Unreal Engine project. Additionally, you will learn how to create new C++ game code, work with Blueprints and Blueprint graphs, and work with custom data for your game. In this chapter, we will cover the following topics:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Downloading Unreal</li><li class="listitem" style="list-style-type: disc">Setting up Visual Studio for use with Unreal</li><li class="listitem" style="list-style-type: disc">Setting up a new Unreal project</li><li class="listitem" style="list-style-type: disc">Creating new C++ classes</li><li class="listitem" style="list-style-type: disc">Creating Blueprints and Blueprint graphs</li><li class="listitem" style="list-style-type: disc">Using Data Tables to import spreadsheet data</li></ul></div><div><div><div><div><h1 class="title"><a id="ch02lvl1sec15"/>Downloading Unreal</h1></div></div></div><p>Before getting <a id="id59" class="indexterm"/>started, make sure that you have at least 18 GB of free disk space on your computer. You will need this disk space to hold the development environments for Unreal and also your project files.</p><p>We will now need to <a id="id60" class="indexterm"/>download Unreal. To do this, go to <a class="ulink" href="https://www.unrealengine.com">https://www.unrealengine.com</a> and click on the <strong>GET UNREAL</strong> button.</p><p>Before you can download Unreal, you'll need to make an Epic Games account. The <strong>GET UNREAL</strong> button will redirect you to an account creation form, so fill it out and submit it.</p><p>After you've signed in, you'll see the <strong>Download</strong> button. This will download the installer for the Epic Games Launcher (from this launcher, you can download Unreal version 4.12).</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec16"/>Downloading Visual Studio</h1></div></div></div><p>We will <a id="id61" class="indexterm"/>need to start programming soon, so if you haven't already, now is the time to download Visual Studio, which is the integrated development environment that we will need to program the framework for our engine and game logic in C++. Luckily, Microsoft provides Visual Studio Community for free.</p><p>To download Visual Studio Community, go <a id="id62" class="indexterm"/>to <a class="ulink" href="https://www.visualstudio.com/">https://www.visualstudio.com/</a> and download Community 2015. This will download the installer for Visual Studio. After it downloads, simply run the installer. Note that Visual Studio Community 2015 does not install C++ by default, so be sure that under <strong>Features</strong>, you are installing Visual C++, Common Tools for Visual C++ 2015, and Microsoft Foundation Classes for C++. If you do not have C++ installed, you will not be able to write or compile code written for UE4 in Visual Studio since UE4 is built on C++.</p></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec17"/>Setting up Visual Studio for Unreal</h1></div></div></div><p>After <a id="id63" class="indexterm"/>you've installed Visual Studio, there are some steps you can take to make it easier to work with C++ code in Unreal. These steps are not at all necessary, and can be safely skipped.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec32"/>Adding the Solution Platforms drop-down list</h2></div></div></div><p>On the <a id="id64" class="indexterm"/>right-hand side of the toolbar is a drop-down arrow, as shown in the following screenshot:</p><div><img src="img/B04548_02_01.jpg" alt="Adding the Solution Platforms drop-down list"/></div><p>Click on this button, hover over the <strong>Add</strong> or <strong>Remove</strong> buttons, and click on <strong>Solution Platforms</strong> to add the menu to the toolbar.</p><p>The <strong>Solution Platforms</strong> drop-down list allows you to switch the project between target platforms (for instance, Windows, Mac, and so on).</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec33"/>Disabling the Error List tab</h2></div></div></div><p>The <a id="id65" class="indexterm"/>error list in Visual Studio shows you the errors that it detects in your code before you even compile the project. While normally this is incredibly useful, in Unreal, it can frequently detect false positives and become more annoying than helpful.</p><p>To disable the error list, first close the <strong>Error List</strong> tab (you can find this in the bottom pane, as shown in the following screenshot):</p><div><img src="img/B04548_02_10.jpg" alt="Disabling the Error List tab"/></div><p>Then, navigate<a id="id66" class="indexterm"/> to <strong>Tools</strong> | <strong>Options</strong>, expand the <strong>Projects and Solutions</strong> group, and uncheck the <strong>Always show Error List if build finishes with errors</strong> option:</p><div><img src="img/B04548_02_11.jpg" alt="Disabling the Error List tab"/></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec18"/>Setting up a new Unreal project</h1></div></div></div><p>Now that <a id="id67" class="indexterm"/>you have both Unreal and Visual Studio downloaded and installed, we're going to create a project for our game.</p><p>Unreal comes with a variety of starter kits that you can use, but for our game, we'll be scripting everything from scratch.</p><p>After signing into Epic Games Launcher, you'll first want to download the Unreal Engine. This book uses version 4.12. You may use a later version, but depending on the version, some code and the navigation of the engine may slightly differ. The steps for creating a new project are as follows:</p><div><ol class="orderedlist arabic"><li class="listitem">Firstly, in the <strong>Unreal Engine</strong> tab, select <strong>Library</strong>. Then, under <strong>Engine Versions</strong>, click on <strong>Add Versions</strong> and select the version you'd like to download.</li><li class="listitem">After the engine has downloaded, click on the <strong>Launch</strong> button.</li><li class="listitem">Once the Unreal Engine has launched, click on the <strong>New Project</strong> tab. Then, click on the <strong>C++</strong> tab and select <strong>Basic Code</strong>.</li><li class="listitem">Finally, choose a location for your project and give it a name (in my case, I named the project <code class="literal">RPG</code>).</li></ol></div><p>In my case, after the project was created, it automatically closed the engine and opened Visual Studio. At this point, I've found it best to close Visual Studio, go back to Epic Games Launcher, and relaunch the engine. Then, open your new project from here. Finally, after the editor has launched, go to <strong>File</strong> | <strong>Open Visual Studio</strong>.</p><p>The reason for this is because, while you can launch the editor by compiling your Visual Studio project, in some rare cases you may have to close the editor any time you want to compile a new change. If, on the other hand, you launch Visual Studio from the editor (rather than the other way around), you can make a change in Visual Studio and then compile the code from within the editor.</p><p>At this point, you have an empty Unreal project and Visual Studio that are ready to go.</p></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec19"/>Creating a new C++ class</h1></div></div></div><p>We're now <a id="id68" class="indexterm"/>going to create a new C++ class with the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">To do this, from the Unreal editor, click on <strong>File</strong> | <strong>New C++ Class</strong>. We'll be creating an Actor class, so select <strong>Actor</strong> as the base class. Actors are the objects that are placed in the scene (anything from meshes, to lights, to sounds, and more).</li><li class="listitem">Next, enter a name for your new class, such as <code class="literal">MyNewActor</code>. Hit <strong>Create Class</strong>. After it adds the files to the project, open <code class="literal">MyNewActor.h</code> in Visual Studio. When you create a new class using this interface, it will generate both a header file and a source file for your class.</li><li class="listitem">Let's just <a id="id69" class="indexterm"/>make our actor print a message to the output log when we start our game. To do this, we'll use the <code class="literal">BeginPlay</code> event. <code class="literal">BeginPlay</code> is called once the game has started (in a multiplayer game, this might be called after an initial countdown, but in our case, it will be called immediately).</li><li class="listitem">The <code class="literal">MyNewActor.h</code> file (which should already be open at this point) should contain the following code after the <code class="literal">GENERATED_BODY()</code> line:<div><pre class="programlisting">public:   virtual void BeginPlay();</pre></div></li><li class="listitem">Then, in <code class="literal">MyNewActor.cpp</code>, add a log that prints <strong>Hello, world!</strong> in the <code class="literal">void AnyNewActor::BeginPlay()</code> function, which runs as soon as the game starts:<div><pre class="programlisting">void AnyNewActor::BeginPlay()
{
    Super::BeginPlay();
    
    GEngine-&gt;AddOnScreenDebugMessage(-1, 15.0f, FColor::Yellow, TEXT("Hello World!"));
}</pre></div></li><li class="listitem">Then, switch back to the editor and click on the <strong>Compile</strong> button in the main toolbar.</li><li class="listitem">Now that your actor class has compiled, we need to add it to the scene. To do this, navigate to the <strong>Content Browser</strong> tab located at the bottom of the screen. Search for <code class="literal">MyNewActor</code> (there's a search bar to help you find it) and drag it into the scene view, which is the level viewport. It's invisible, so you won't see it or be able to click on it. However, if you scroll the <strong>Scene/World Outliner</strong> pane (on the right-hand side) to the bottom, you should see the <strong>MyNewActor1</strong> actor has been added to the scene:<div><img src="img/B04548_02_02.jpg" alt="Creating a new C++ class"/></div></li><li class="listitem">To test your <a id="id70" class="indexterm"/>new actor class, click on the <strong>Play</strong> button. You should see a yellow <strong>Hello, world!</strong> message printed to the console, as shown in the following screenshot. This can be seen in the <strong>Output Log</strong> tab on the right-hand side of the <strong>Content Browser</strong> tab at the bottom of the screen:<div><img src="img/B04548_02_03.jpg" alt="Creating a new C++ class"/></div></li></ol></div><p>Congratulations, you <a id="id71" class="indexterm"/>have created your first actor class in Unreal.</p></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec20"/>Blueprints</h1></div></div></div><p>Blueprints in <a id="id72" class="indexterm"/>Unreal is a C++ based visual scripting language built proprietary to Unreal. Blueprints will allow us to create code without the need to touch a line of text in an IDE such as Visual Studio. Instead, Blueprints allows us to create code through the use of drag and drop visual nodes, and connect them together to create nearly any kind of functionality you desire. Those of you who have come from UDK may find some similarity between Kismet and Blueprints, but unlike Kismet, Blueprints allows you to have full control over the creation and modification of functions and variables. It also compiles, which is something Kismet did not do.</p><p>Blueprints can inherit from C++ classes, or from other Blueprints. So, for instance, you might have an <code class="literal">Enemy</code> class. An enemy might have a<a id="id73" class="indexterm"/> <strong>Health</strong> field, a <strong>Speed</strong> field, an <a id="id74" class="indexterm"/><strong>Attack</strong> field, and a <a id="id75" class="indexterm"/><strong>Mesh</strong> field. You can then create multiple enemy templates by <a id="id76" class="indexterm"/>creating Blueprints that inherit from your <code class="literal">Enemy</code> class and changing each type of enemy's Health, Speed, Attack, and Mesh.</p><p>You can also expose parts of your C++ code to Blueprint graphs so that your Blueprint graphs and your core game code can communicate and work with each other. As an example, your inventory code may be implemented in C++, and it might expose functions to Blueprints so that a Blueprint graph can give items to the player.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec34"/>Creating a new Blueprint</h2></div></div></div><p>The steps to<a id="id77" class="indexterm"/> create a new Blueprint are as follows:</p><div><ol class="orderedlist arabic"><li class="listitem">In the <strong>Content Browser</strong> pane, create a new Blueprint folder by clicking on the <strong>Add New</strong> drop-down list and selecting <strong>New Folder</strong>, then renaming the folder <code class="literal">Blueprint</code>. Inside this folder, right-click and select <strong>Blueprints</strong> | <strong>Blueprint Class</strong>. Select <strong>Actor</strong> as the parent class for the Blueprint.</li><li class="listitem">Next, give a name to your new Blueprint, such as <code class="literal">MyNewBlueprint</code>. To edit this Blueprint, double-click on its icon in the <strong>Content Browser</strong> tab.</li><li class="listitem">Next, switch to the <strong>Event Graph</strong> tab. </li><li class="listitem">If <strong>Event Begin Play</strong> is not already there, right-click on the graph and expand <strong>Add Event</strong>; then, click on <strong>Event Begin Play</strong>. If you ever need to move around nodes such as <strong>Event Begin Play</strong>, you can simply left-click on the node and drag it anywhere on the graph you want. You can also navigate through the graph by holding down the right-click mouse button and dragging across the screen:<div><img src="img/B04548_02_05.jpg" alt="Creating a new Blueprint"/></div><p>This will add a new event node to the graph.</p></li><li class="listitem">Next, right-click <a id="id78" class="indexterm"/>and begin typing <code class="literal">print</code> into the search bar. You should see the <strong>Print String</strong> option in the list. Click on it to add a new <strong>Print String</strong> node to your graph.</li><li class="listitem">Next, we want to have this node triggered when the <strong>Event Begin Play</strong> node is triggered. To do this, drag from the output arrow of the <strong>Event Begin Play</strong> node to the input arrow of the <strong>Print String</strong> node:<div><img src="img/B04548_02_06.jpg" alt="Creating a new Blueprint"/></div></li><li class="listitem">Now, the <strong>Print String</strong> node will be triggered when the game begins. However, let's take this one step further and add a variable to our Blueprint.</li><li class="listitem">On the left-hand <a id="id79" class="indexterm"/>side in the <strong>My Blueprint</strong> pane, click on the <strong>Variable</strong> button. Give a name to your variable (such as <code class="literal">MyPrintString</code>) and change the <strong>Variable Type</strong> drop-down list to <strong>String</strong>.</li><li class="listitem">To feed the value of this variable into our <strong>Print String</strong> node, right-click and search for <code class="literal">MyPrintString</code>. You should see a <strong>Get My Print String</strong> node available in the list. Click on this to add the node to your graph:<div><img src="img/B04548_02_07.jpg" alt="Creating a new Blueprint"/></div></li><li class="listitem">Next, just as you did to connect <strong>Event Begin Play</strong> and <strong>Print String</strong> together, drag from the output arrow of the <strong>Get My Print String</strong> node to the input pin of the <strong>Print String</strong> node that is right next to the <strong>In String</strong> label.</li><li class="listitem">Finally, switch <a id="id80" class="indexterm"/>over to the <strong>Defaults</strong> tab. At the very top, under the <strong>Defaults</strong> section, there should be a text field for editing the value of the <code class="literal">MyPrintString</code> variable. Enter whatever text you'd like into this field. Then, to save your Blueprint, first press the <strong>Compile</strong> button in the <strong>Blueprint</strong> window and then click on the <strong>Save</strong> button next to it.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec35"/>Adding a Blueprint to the scene</h2></div></div></div><p>Now that you've<a id="id81" class="indexterm"/> created the Blueprint, simply drag it from the <strong>Content Browser</strong> tab into the scene. Just as with our custom actor class, it will be invisible, but if you scroll <strong>Scene Outliner</strong> to the bottom, you'll see the <strong>MyNewBlueprint</strong> item in the list.</p><p>To test our new Blueprint, press the <strong>Play</strong> button. You should see that the text you entered is briefly printed to the screen (it will also show up in the <strong>Output Log</strong>, but it may be difficult to spot amidst the other output messages).</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec36"/>Blueprints for Actor classes</h2></div></div></div><p>You can <a id="id82" class="indexterm"/>choose other classes for a Blueprint to inherit from. For instance, let's create a new Blueprint to inherit from the custom <code class="literal">MyNewActor</code> class we created earlier:</p><div><ol class="orderedlist arabic"><li class="listitem">To do this, start creating a new Blueprint as before. Then, when choosing a parent class, search for <code class="literal">MyNewActor</code>. Click on the <strong>MyNewActor</strong> entry in the list:<div><img src="img/B04548_02_12.jpg" alt="Blueprints for Actor classes"/></div></li><li class="listitem">You can <a id="id83" class="indexterm"/>name this Actor whatever you want. Next, open the Blueprint and click on <strong>Save</strong>. Now, add the Blueprint to your scene and run the game. You should now have two <strong>Hello, world!</strong> messages logged to the console (one from our placed actor and the other from our new Blueprint).</li></ol></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec21"/>Using Data Tables to import spreadsheet data</h1></div></div></div><p>In Unreal, <strong>Data Tables</strong> are <a id="id84" class="indexterm"/>a method of importing and using custom game data exported from a spreadsheet application. To do this, you first ensure that your spreadsheet follows some guidelines for format; additionally, you write a C++ struct that contains the data for one row of the spreadsheet. Then, you export a CSV file and select your C++ struct as the data type for that file.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec37"/>The spreadsheet format</h2></div></div></div><p>Your <a id="id85" class="indexterm"/>spreadsheet must follow some simple rules in order to correctly export to Unreal.</p><p>The very first cell must remain blank. After this, the first row will contain the names of the fields. These will be the same as the variable names in your C++ struct later, so do not use spaces or other special characters.</p><p>The first column will contain the <a id="id86" class="indexterm"/><strong>lookup key</strong> for each entry. That is, if the first cell of the first item in this spreadsheet is 1, then in Unreal, you would use 1 to find that entry. This must be unique for every row.</p><p>Then, the following columns contain the values for each variable.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec38"/>A sample spreadsheet</h2></div></div></div><p>Let's create a <a id="id87" class="indexterm"/>simple spreadsheet to import into Unreal. It should look like this:</p><div><img src="img/B04548_02_08.jpg" alt="A sample spreadsheet"/></div><p>As mentioned in the previous section:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Column <strong>A</strong> contains the lookup keys for each row. The first cell is empty and the following cells have the lookup keys for each row.</li><li class="listitem" style="list-style-type: disc">Column <strong>B</strong> contains the values for the <code class="literal">SomeNumber</code> field. The first cell contains the field name (<code class="literal">SomeNumber</code>) and the following cells contain the values for that field.</li><li class="listitem" style="list-style-type: disc">Column <strong>C</strong> contains the values for the <code class="literal">SomeString</code> field. Just as with column <strong>B</strong>, the first cell contains the name of the field (<code class="literal">SomeString</code>) and the following cells contain the values for that field.</li></ul></div><p>I'm using <a id="id88" class="indexterm"/>Google Spreadsheets—with this, you would click on <strong>File</strong> | <strong>Download as</strong> | <strong>Comma-separated values (.csv, current sheet)</strong> to export this to CSV. Most spreadsheet applications have the ability to export to the CSV format.</p><p>At this point, you have a CSV file that can be imported into Unreal. However, do not import it yet. Before we do that, we'll need to create the C++ struct for it.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec39"/>The Data Table struct</h2></div></div></div><p>Just as<a id="id89" class="indexterm"/> you created the actor class earlier, let's create a new class. Choose <code class="literal">Actor</code> as the parent class and give it a name such as <code class="literal">TestCustomData</code>. Our class won't actually inherit from <code class="literal">Actor</code> (and, for that matter, it won't be a class), but doing this allows Unreal to generate some code in the background for us.</p><p>Next, open the <code class="literal">TestCustomData.h</code> file and replace the entire file with the following code:</p><div><pre class="programlisting">#pragma once

#include "TestCustomData.generated.h"

USTRUCT(BlueprintType)
struct FTestCustomData : public FTableRowBase
{
  GENERATED_USTRUCT_BODY()

  UPROPERTY( BlueprintReadOnly, Category = "TestCustomData" )
  int32 SomeNumber;

  UPROPERTY( BlueprintReadOnly, Category = "TestCustomData" )
  FString SomeString;
};</pre></div><p>Notice how the variable names are exactly the same as the header cells in the spreadsheet—this is important, as it shows how Unreal matches columns in the spreadsheet to the fields of this struct.</p><p>Next, remove everything from the <code class="literal">TestCustomData.cpp</code> file, with the exception of the <code class="literal">#include</code> statements.</p><p>Now, switch back to the editor and click on <strong>Compile</strong>. It should compile without any issues.</p><p>Now that you've <a id="id90" class="indexterm"/>created the struct, it's time to import your custom spreadsheet.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec40"/>Importing the spreadsheet</h2></div></div></div><p>Next, simply <a id="id91" class="indexterm"/>drag your CSV file into the <strong>Content Browser</strong> tab. This will show a pop-up window, asking you to pick how you want to import the data and also what type of data it is. Leave the first drop-down list to <strong>Data Table</strong> and expand the second drop-down list to pick <strong>TestCustomData</strong> (the struct you just created).</p><p>Click on <strong>OK</strong> and it will import the CSV file. If you double-click the asset in the <strong>Content Browser</strong> tab, you'll see a list of the items that were in the spreadsheet:</p><div><img src="img/B04548_02_09.jpg" alt="Importing the spreadsheet"/></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec41"/>Querying the spreadsheet</h2></div></div></div><p>You can<a id="id92" class="indexterm"/> query the spreadsheet in order to find particular rows by name.</p><p>We'll add this to our custom actor class, <code class="literal">MyNewActor</code>. The first thing we need to do is expose a field to a Blueprint, allowing us to assign a Data Table for our actor to use.</p><p>Firstly, add the following code just after the <code class="literal">GENERATED_BODY</code> line:</p><div><pre class="programlisting">public:
  UPROPERTY( BlueprintReadWrite, EditAnywhere, Category = "My New Actor")
  UDataTable* DataTable;</pre></div><p>The preceding <a id="id93" class="indexterm"/>code will expose the Data Table to Blueprint and allow it to be edited within Blueprint. Next, we'll fetch the first row and log its <code class="literal">SomeString</code> field. In the <code class="literal">MyNewActor.cpp</code> file, add this code to the end of the <code class="literal">BeginPlay</code> function:</p><div><pre class="programlisting">if( DataTable != NULL )
{
  FTestCustomData* row = DataTable-&gt;FindRow&lt;FTestCustomData&gt;( TEXT( "2" ), TEXT(" LookupTestCustomData"  ) );
  FString someString = row-&gt;SomeString;
  UE_LOG( LogTemp, Warning, TEXT( "%s" ), *someString );
}</pre></div><p>You will also need to add <code class="literal">#include TestCustomData.h</code> at the top of your <code class="literal">MyNewActor.cpp</code> file so that you can see the Data Table properties in it.</p><p>Compile the code in the editor. Next, open up the Blueprint you created from this actor class. Switch to the <strong>Class Defaults</strong> tab and find the <strong>My New Actor</strong> group (this should be at the very top). This should show a <strong>Data Table</strong> field that you can expand to pick the CSV file you imported.</p><p>Compile and save the Blueprint and then press <strong>Play</strong>. You should see the value of <code class="literal">SomeString</code> for the entry <code class="literal">2</code> logged to the console.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec22"/>Summary</h1></div></div></div><p>In this chapter, we set up Unreal and Visual Studio and created a new project. Additionally, we learned how to create new actor classes in C++, what a Blueprint is, and how to create and use Blueprint graphs for visual scripting. Finally, we learned how to import custom data from spreadsheet applications and query them from the game code.</p><p>In the next chapter, we'll start diving into some actual gameplay code and start prototyping our game.</p></div></body></html>