<html><head></head><body><div><div><div><div><div><h1 class="title"><a id="ch03" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Chapter 3. Cooking an RSS Reader with Qt Quick</h1></div></div></div><p class="calibre9">In this chapter, we will focus on developing applications with Qt Quick. For touchscreen-enabled devices, Qt Quick applications are much more responsive and easy to write. An RSS reader is used as a demonstration in this chapter. The following topics will enable you to build elegant Qt Quick applications:</p><div><ul class="itemizedlist"><li class="listitem">Understanding model and view</li><li class="listitem">Parsing RSS Feeds by <code class="literal">XmlListModel</code></li><li class="listitem">Tweaking the categories</li><li class="listitem">Utilizing <code class="literal">ScrollView</code></li><li class="listitem">Adding <code class="literal">BusyIndicator</code></li><li class="listitem">Making a frameless window</li><li class="listitem">Debugging QML</li></ul></div><div><div><div><div><h1 class="title2"><a id="ch03lvl1sec20" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Understanding model and view</h1></div></div></div><p class="calibre9">As mentioned before, Qt Quick applications are different from traditional Qt Widgets applications. You are going to write QML instead of C++ code. So, let's create a new project, a Qt Quick application named <code class="literal">RSS_Reader</code>. This time, we will use Qt Quick 2.3 as the component <a id="id108" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>set. Since we won't use the<a id="id109" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> widgets provided by Qt Quick Controls, we'll write our own widgets.</p><p class="calibre9">Before getting our <a id="id110" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>hands dirty, let's sketch out what this application looks like. According to the following diagram, there will be two sections. The left-hand panel provides some categories so that users can choose interesting categories. The right-hand panel is the main area, which displays news under the current category. This is a typical RSS news reader's user interface.</p><div><img src="img/4615OS_03_01.jpg" alt="Understanding model and view" class="calibre40"/></div><p class="calibre9">We can implement the<a id="id111" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> <strong class="calibre10">Categories</strong> panel by using <code class="literal">ListView</code>. This type (we say "type<a id="id112" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>" instead of "class" in QML) is used to display data from all sorts of list models. So let's<a id="id113" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> edit our <code class="literal">main.qml</code> to something similar to this:</p><div><pre class="programlisting">import QtQuick 2.3
import QtQuick.Window 2.2

Window {
  id: mainWindow
  visible: true
  width: 720
  height: 400

  ListView {
    id: categories

    width: 150
    height: parent.height
    orientation: ListView.Vertical
    anchors.top: parent.top
    spacing: 3
  }
}</pre></div><p class="calibre9">
<code class="literal">ListView</code> needs a model to get data from. In this case, we can utilize <code class="literal">ListModel</code> for its simplicity. To achieve this, let's create a new <code class="literal">Feeds.qml</code> file, which will contain a custom <code class="literal">ListModel</code> example:</p><div><ol class="orderedlist"><li class="listitem1">Right-click on the project.</li><li class="listitem1">Select <strong class="calibre10">Add New…</strong>.</li><li class="listitem1">Navigate to <strong class="calibre10">Qt</strong> | <strong class="calibre10">QML File (Qt Quick 2)</strong>.</li><li class="listitem1">Enter the <code class="literal">Feeds.qml</code> filename.</li></ol></div><p class="calibre9">Here is the content of <code class="literal">Feeds.qml</code>:</p><div><pre class="programlisting">import QtQuick 2.3

ListModel {
  ListElement { name: "Top Stories"; url: "http://feeds.bbci.co.uk/news/rss.xml" }
  ListElement { name: "World"; url: "http://feeds.bbci.co.uk/news/world/rss.xml" }
  ListElement { name: "UK"; url: "http://feeds.bbci.co.uk/news/uk/rss.xml" }
  ListElement { name: "Business"; url: "http://feeds.bbci.co.uk/news/business/rss.xml" }
  ListElement { name: "Politics"; url: "http://feeds.bbci.co.uk/news/politics/rss.xml" }
  ListElement { name: "Health"; url: "http://feeds.bbci.co.uk/news/health/rss.xml" }
  ListElement { name: "Education &amp; Family"; url: "http://feeds.bbci.co.uk/news/education/rss.xml" }
  ListElement { name: "Science &amp; Environment"; url: "http://feeds.bbci.co.uk/news/science_and_environment/rss.xml" }
  ListElement { name: "Technology"; url: "http://feeds.bbci.co.uk/news/technology/rss.xml" }
  ListElement { name: "Entertainment &amp; Arts"; url: "http://feeds.bbci.co.uk/news/entertainment_and_arts/rss.xml" }
}</pre></div><div><div><h3 class="title4"><a id="note10" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Note</h3><p class="calibre15">We use BBC News RSS as feeds, but you may wish to change it to another.</p></div></div><p class="calibre9">As you can see, the<a id="id114" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> preceding <code class="literal">ListModel</code> example has two roles, <code class="literal">name</code> and <code class="literal">url</code>. A "role" is basically a fancy way of saying the child item. These can be bound to by the <code class="literal">ListView</code> delegate that we are about to create. In this way, roles usually represent the properties of an<a id="id115" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> entity or columns of a table.</p><p class="calibre9">Let me explain the relation between view, model, and delegate, which is another important yet difficult concept in the world of Qt. This is <a id="id116" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>officially called <strong class="calibre10">model-view</strong> architecture. In addition to the traditional view, Qt decouples the view and controller so that the data can be rendered and edited in many customized ways. The latter is much more elegant and efficient. The following diagram helps you understand this concept:</p><div><img src="img/4615OS_03_02.jpg" alt="Understanding model and view" class="calibre41"/></div><p class="calibre9">Take <code class="literal">ListModel</code>, which is a model used to arrange data, as an example to elaborate the relationship. <code class="literal">CategoriesDelegate</code>, shown in the following code, is a delegate and is used to control how to display the roles from the model. Lastly, we use a view, which is <code class="literal">ListView</code> in this case, to render the delegate.</p><p class="calibre9">The communication<a id="id117" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> between the models, views, and delegates are based on the signals and slots mechanism. It'll take you some time to fully understand this concept. Hopefully, we can shorten this time by practicing this example. At this stage, we already have a view and<a id="id118" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> a model. We have to define a delegate, which is <code class="literal">CategoriesDelegate</code> as mentioned before, to control the data from the model and render it on the view. Add a new <code class="literal">CategoriesDelegate.qml</code> file, whose content is pasted in this way:</p><div><pre class="programlisting">import QtQuick 2.3

Rectangle {
  id: delegate
  property real itemWidth
  width: itemWidth
  height: 80
  Text {
    id: title
    anchors { left: parent.left; leftMargin: 10; right: parent.right; rightMargin: 10 }
    anchors.verticalCenter: delegate.verticalCenter
    text: name
    font { pointSize: 18; bold: true }
    verticalAlignment: Text.AlignVCenter
    wrapMode: Text.WordWrap
  }
}</pre></div><p class="calibre9">You should have some idea about the relation between the model, delegate, and view. Here, we use <code class="literal">Rectangle</code> as the delegate type. Inside the <code class="literal">Rectangle</code> type is a <code class="literal">Text</code> object that displays<a id="id119" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> the <code class="literal">name</code> from our <code class="literal">ListModel</code> example. As for the <code class="literal">font</code> property, here we use <code class="literal">pointSize</code> to specify the size of text, while you can use <code class="literal">pixelSize</code> as an <a id="id120" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>alternative.</p><p class="calibre9">To finish the model-view architecture, go back to the <code class="literal">main.qml</code> edit:</p><div><pre class="programlisting">import QtQuick 2.3
import QtQuick.Window 2.2
import "qrc:/"

Window {
  id: mainWindow
  visible: true
  width: 720
  height: 400

  Feeds {
    id: categoriesModel
  }

  ListView {
    id: categories

    width: 150
    height: parent.height
    orientation: ListView.Vertical
    anchors.top: parent.top
    spacing: 3
    model:categoriesModel
    delegate: CategoriesDelegate {
      id: categoriesDelegate
      width: categories.width
    }
  }
}</pre></div><p class="calibre9">Take note of the third line; it's crucial to import this directory into <code class="literal">qrc</code>. We use <code class="literal">"qrc:/"</code> because we need to put the QML files in the root directory. Modify it if you use a subdirectory to keep <code class="literal">Feeds.qml</code> and <code class="literal">CategoriesDelegate.qml</code>. In this example, these files are left unorganized. But it's highly recommended to keep them categorized as a different module. If you didn't import the directory, you won't be able to use these QML files.</p><p class="calibre9">Inside the <code class="literal">Window</code> item, we create <code class="literal">Feeds</code>, which is exactly an element of <code class="literal">ListModel</code> from <code class="literal">Feeds.qml</code>. Then, we<a id="id121" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> give this <code class="literal">Feeds</code> item a <code class="literal">categoriesModel</code> ID and use it as the model of <code class="literal">ListView</code>. Specifying the delegate is quite similar to specifying the model for views. Instead of declaring it outside <code class="literal">ListView</code>, we have to define it inside the <code class="literal">delegate</code> scope, otherwise the <code class="literal">delegate</code> item, <code class="literal">CategoriesDelegate</code>, won't be<a id="id122" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> able to get data from the model. As you can see, we can manipulate the <code class="literal">width</code> of <code class="literal">categoriesDelegate</code>. This is to ensure that the text won't lie outside the boundary of <code class="literal">ListView</code>.</p><p class="calibre9">If everything is done correctly, click on <strong class="calibre10">Run</strong> and you'll see it run like this:</p><div><img src="img/4615OS_03_03.jpg" alt="Understanding model and view" class="calibre42"/></div></div></div></div>



  
<div><div><div><div><div><h1 class="title2"><a id="ch03lvl1sec21" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Parsing RSS Feeds by XmlListModel</h1></div></div></div><p class="calibre9">It's true that we now have categories, but they don't seem to be involved with RSS at all. Also, if you dig deeper, you'll find<a id="id123" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> that the RSS feeds are in fact the XML documents. Qt already provides a useful type to help us parse them. We don't need to<a id="id124" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> reinvent the wheel. This powerful type is the so-called <code class="literal">XmlListModel</code> element and it uses <code class="literal">XmlRole</code> to query.</p><p class="calibre9">Firstly, we need to expose the <code class="literal">url</code> role of <code class="literal">categoriesModel</code> to the main scope. This is done by declaring the property storing the model's current element, <code class="literal">url</code>, inside <code class="literal">ListView</code>. Then, we can add an <code class="literal">XmlListModel</code> element and use that <code class="literal">url</code> element as its <code class="literal">source</code>. Accordingly, the modified <code class="literal">main.qml</code> file is pasted here:</p><div><pre class="programlisting">import QtQuick 2.3
import QtQuick.Window 2.2
import QtQuick.XmlListModel 2.0
import "qrc:/"

Window {
  id: mainWindow
  visible: true
  width: 720
  height: 400

  Feeds {
    id: categoriesModel
  }

  ListView {
    id: categories
    width: 150
    height: parent.height
    orientation: ListView.Vertical
    anchors.top: parent.top
    spacing: 3
    model:categoriesModel
    delegate: CategoriesDelegate {
      id: categoriesDelegate
      width: categories.width
    }
    property string currentUrl: categoriesModel.get(0).url
  }

  XmlListModel {
    id: newsModel

    source: categories.currentUrl
    namespaceDeclarations: "declare namespace media = 'http://search.yahoo.com/mrss/'; declare namespace atom = 'http://www.w3.org/2005/Atom';"
    query: "/rss/channel/item"

    XmlRole { name: "title"; query: "title/string()" }
    XmlRole { name: "description"; query: "description/string()" }
    XmlRole { name: "link"; query: "link/string()" }
    XmlRole { name: "pubDate"; query: "pubDate/string()" }
    //XPath starts from 1 not 0 and the second thumbnail is larger and more clear
    XmlRole { name: "thumbnail"; query: "media:thumbnail[2]/@url/string()" }
  }
}</pre></div><div><div><h3 class="title4"><a id="note11" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Note</h3><p class="calibre15">Objects' values are changed dynamically and updated implicitly in Qt Quick. You don't need to give new values explicitly.</p></div></div><p class="calibre9">In order to use<a id="id125" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> this element, you will need to import the module by adding an <code class="literal">import QtQuick.XmlListModel 2.0</code> line. Additionally, <code class="literal">XmlListModel</code> is a read-only model which means that you can't modify the data source through this model. This is completely acceptable since what we need is to retrieve the news data from the <a id="id126" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>RSS feeds. Take <code class="literal">Top Stories</code> as an example; the following code is a part of this XML document content:</p><div><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;?xml-stylesheet title="XSL_formatting" type="text/xsl" href="/shared/bsp/xsl/rss/nolsol.xsl"?&gt;

&lt;rss   version="2.0"&gt;  
&lt;channel&gt; 
&lt;title&gt;BBC News - Home&lt;/title&gt;  
&lt;link&gt;http://www.bbc.co.uk/news/#sa-ns_mchannel=rss&amp;amp;ns_source=PublicRSS20-sa&lt;/link&gt;  
&lt;description&gt;The latest stories from the Home section of the BBC News web site.&lt;/description&gt;  
&lt;language&gt;en-gb&lt;/language&gt;  
&lt;lastBuildDate&gt;Mon, 26 Jan 2015 23:19:42 GMT&lt;/lastBuildDate&gt;  
&lt;copyright&gt;Copyright: (C) British Broadcasting Corporation, see http://news.bbc.co.uk/2/hi/help/rss/4498287.stm for terms and conditions of reuse.&lt;/copyright&gt;  
&lt;image&gt; 
  &lt;url&gt;http://news.bbcimg.co.uk/nol/shared/img/bbc_news_120x60.gif&lt;/url&gt;  
  &lt;title&gt;BBC News - Home&lt;/title&gt;  
  &lt;link&gt;http://www.bbc.co.uk/news/#sa-ns_mchannel=rss&amp;amp;ns_source=PublicRSS20-sa&lt;/link&gt;  
  &lt;width&gt;120&lt;/width&gt;  
  &lt;height&gt;60&lt;/height&gt; 
&lt;/image&gt;  
&lt;ttl&gt;15&lt;/ttl&gt;  
&lt;atom:link href="http://feeds.bbci.co.uk/news/rss.xml" rel="self" type="application/rss+xml"/&gt;  
&lt;item&gt; 
  &lt;title&gt;Germany warns Greece over debts&lt;/title&gt;  
  &lt;description&gt;The German government warns Greece that it must meet its commitments to lenders, after the election win of the Greek anti-austerity Syriza party.&lt;/description&gt;  
  &lt;link&gt;http://www.bbc.co.uk/news/business-30977714#sa-ns_mchannel=rss&amp;amp;ns_source=PublicRSS20-sa&lt;/link&gt;  
  &lt;guid isPermaLink="false"&gt;http://www.bbc.co.uk/news/business-30977714&lt;/guid&gt;  
  &lt;pubDate&gt;Mon, 26 Jan 2015 20:15:56 GMT&lt;/pubDate&gt;  
  &lt;media:thumbnail width="66" height="49" url="http://news.bbcimg.co.uk/media/images/80536000/jpg/_80536447_025585607-1.jpg"/&gt;  
  &lt;media:thumbnail width="144" height="81" url="http://news.bbcimg.co.uk/media/images/80536000/jpg/_80536448_025585607-1.jpg"/&gt; 
&lt;/item&gt;
……</pre></div><p class="calibre9">The <code class="literal">namespaceDeclarations</code> property needs to be set because the XML document has the XML namespaces.</p><div><pre class="programlisting">&lt;rss   version="2.0"&gt;</pre></div><p class="calibre9">Here, <code class="literal">xmlns</code> stands for the<a id="id127" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> XML namespace, so we <a id="id128" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>declare the namespace accordingly.</p><div><pre class="programlisting">namespaceDeclarations: "declare namespace media = 'http://search.yahoo.com/mrss/'; declare namespace atom = 'http://www.w3.org/2005/Atom';"</pre></div><p class="calibre9">In fact, you can just declare a <code class="literal">media</code> namespace and safely ignore an <code class="literal">atom</code> namespace. However, if you didn't declare the <code class="literal">media</code> namespace, the application would end up failing to parse the XML document. Hence, go back to see the XML document and you'll find it has a hierarchy to order data. What we want here are these items. Take the top-level as root, <code class="literal">/</code>, so the path of <code class="literal">item</code> can be written as <code class="literal">/rss/channel/item</code>. This is exactly what we put in <code class="literal">query</code>.</p><p class="calibre9">All the <code class="literal">XmlRole</code> elements are created using <code class="literal">query</code> as the base. For <code class="literal">XmlRole</code>, <code class="literal">name</code> defines its name, which doesn't need to be the same as in the XML document. It's similar to <code class="literal">id</code> for the regular Qt Quick items. However, the query of <code class="literal">XmlRole</code> must use a relative path to the query of <code class="literal">XmlListModel</code>. Although it's a <code class="literal">string()</code> type in most cases, it still must be declared explicitly. If there are elements sharing the same keys, it'd be an array where the element listed <a id="id129" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>first has the first index.</p><div><div><h3 class="title4"><a id="note12" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Note</h3><p class="calibre15">The first index in XPath is <code class="literal">1</code> instead of <code class="literal">0</code>.</p></div></div><p class="calibre9">Sometimes, we need to get an attribute <code class="literal">thumbnail</code>. This is the <code class="literal">url</code> attribute of the <code class="literal">media:thumbnail</code> tag. In this case, it's the <code class="literal">@</code> symbol that will do all the magic we need.</p><p class="calibre9">Similar to these <a id="id130" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>categories, we have to write a delegate for the <code class="literal">XmlListModel</code> element to render the view. The new QML <code class="literal">NewsDelegate.qml</code> file is shown here:</p><div><pre class="programlisting">import QtQuick 2.3

Column {
  id: news
  spacing: 8

  //used to separate news item
  Item { height: news.spacing; width: news.width }

  Row {
    width: parent.width
    height: children.height
    spacing: news.spacing

    Image {
      id: titleImage
      source: thumbnail
    }

    Text {
      width: parent.width - titleImage.width
      wrapMode: Text.WordWrap
      font.pointSize: 20
      font.bold: true
      text: title
    }
  }

  Text {
    width: parent.width
    font.pointSize: 9
    font.italic: true
    text: pubDate + " (&lt;a href=\"" + link + "\"&gt;Details&lt;/a&gt;)"
    onLinkActivated: {
      Qt.openUrlExternally(link)
    }
  }

  Text {
    width: parent.width
    wrapMode: Text.WordWrap
    font.pointSize: 10.5
    horizontalAlignment: Qt.AlignLeft
    text: description
  }
}</pre></div><p class="calibre9">The difference<a id="id131" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> is that this time we use <code class="literal">Column</code> to organize the<a id="id132" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> news data and represent it in an intuitive way. The relevant diagram is sketched as follows:</p><div><img src="img/4615OS_03_04.jpg" alt="Parsing RSS Feeds by XmlListModel" class="calibre43"/></div><p class="calibre9">So, this is why we use <code class="literal">Row</code> inside <code class="literal">Column</code> to box <a id="id133" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/><strong class="calibre10">Thumbnail</strong> and <strong class="calibre10">Title</strong> together. Thus, we<a id="id134" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> need to put an empty <code class="literal">item</code> element in front to separate each news delegate. Apart from these self-explanatory<a id="id135" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> lines, there is a tip for dealing with links. You need to specify the slot for the <code class="literal">onLinkActivated</code> signal, which is <code class="literal">Qt.openUrlExternally(link)</code> in this case. Otherwise, nothing will happen when you click on the link.</p><p class="calibre9">After all this, it's<a id="id136" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> time to write a view in <code class="literal">main.qml</code> to display our news:</p><div><pre class="programlisting">import QtQuick 2.3
import QtQuick.Window 2.2
import QtQuick.XmlListModel 2.0
import "qrc:/"

Window {
  id: mainWindow
  visible: true
  width: 720
  height: 400

  Feeds {
    id: categoriesModel
  }

  ListView {
    id: categories

    width: 150
    height: parent.height
    orientation: ListView.Vertical
    anchors.top: parent.top
    spacing: 3
    model:categoriesModel
    delegate: CategoriesDelegate {
      id: categoriesDelegate
      width: categories.width
    }
    property string currentUrl: categoriesModel.get(0).url
  }

  XmlListModel {
    id: newsModel

    source: categories.currentUrl
    namespaceDeclarations: "declare namespace media = 'http://search.yahoo.com/mrss/'; declare namespace atom = 'http://www.w3.org/2005/Atom';"
    query: "/rss/channel/item"

    XmlRole { name: "title"; query: "title/string()" }
    XmlRole { name: "description"; query: "description/string()" }
    XmlRole { name: "link"; query: "link/string()" }
    XmlRole { name: "pubDate"; query: "pubDate/string()" }
    //XPath starts from 1 not 0 and the second thumbnail is larger and more clear
    XmlRole { name: "thumbnail"; query: "media:thumbnail[2]/@url/string()" }
  }

  ListView {
    id: newsList

    anchors { left: categories.right; leftMargin: 10; right: parent.right; rightMargin: 4; top: parent.top; bottom: parent.bottom; }
    model: newsModel
    delegate: NewsDelegate {
      width: newsList.width
    }
  }
}</pre></div><p class="calibre9">Remember to<a id="id137" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> define the <code class="literal">width</code> of <code class="literal">NewsDelegate</code> in case<a id="id138" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> it displays abnormally. Click on <strong class="calibre10">Run</strong>; the application will look like the following screenshot:</p><div><img src="img/4615OS_03_05.jpg" alt="Parsing RSS Feeds by XmlListModel" class="calibre42"/></div></div></div>



  
<div><div><div><div><div><h1 class="title2"><a id="ch03lvl1sec22" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Tweaking the categories</h1></div></div></div><p class="calibre9">This application is still incomplete. For example, the news view won't change at all after you click on<a id="id139" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> the other categories. In this stage, we're going to work this out and make it more beautiful.</p><p class="calibre9">What we need to do is add <code class="literal">MouseArea</code> to <code class="literal">CategoriesDelegate</code>. This element is used to deal with a variety of mouse interactions, including clicking. The new <code class="literal">CategoriesDelegate.qml</code> file's code is pasted here:</p><div><pre class="programlisting">import QtQuick 2.3

Rectangle {
  id: delegate
  height: 80

  Text {
    id: title
    anchors { left: parent.left; leftMargin: 10; right: parent.right; rightMargin: 10 }
    anchors.verticalCenter: delegate.verticalCenter
    text: name
    font { pointSize: 18; bold: true }
    verticalAlignment: Text.AlignVCenter
    wrapMode: Text.WordWrap
  }

  MouseArea {
    anchors.fill: delegate
    onClicked: {
      categories.currentIndex = index
      if(categories.currentUrl == url)
      newsModel.reload()
      else
      categories.currentUrl = url
    }
  }
}</pre></div><p class="calibre9">As you can see, once a delegate gets clicked on, it'll change <code class="literal">categories.currentIndex</code> and <code class="literal">currentUrl</code> if necessary<a id="id140" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>, or simply let <code class="literal">newsModel</code> reload. As mentioned before, QML is a dynamic language, which changes <code class="literal">categories.currentUrl</code>, the <code class="literal">source</code> property of <code class="literal">newsModel</code>, and would automatically cause <code class="literal">newsModel</code> to reload.</p><p class="calibre9">To help users distinguish a currently-selected category from others, we may wish to change its size and scale. There are some attached properties, which are attached to each instance of a delegate or are simply shared among them. The <code class="literal">.isCurrentItem</code> property is the one that would so us a favor. It's a Boolean value that holds whether this delegate is the current item or not. However, only the root item of a delegate can access these attached properties directly. In order to code in a clean way, we add a line to <code class="literal">Rectangle</code> of <code class="literal">CategoriesDelegate</code> to hold this property:</p><div><pre class="programlisting">property bool selected: ListView.isCurrentItem</pre></div><p class="calibre9">Now, we can utilize <code class="literal">selected</code> in <code class="literal">Text</code> by adding the following lines to the <code class="literal">Text</code> item:</p><div><pre class="programlisting">scale: selected ? 1.0 : 0.8
color: selected ? "#000" : "#AAA"</pre></div><p class="calibre9">
<code class="literal">Text</code> will be scaled to <code class="literal">0.8</code> if it's not selected and will behave as usual when it's active. A similar condition is in place for its color. The <code class="literal">#AAA</code> color code is an extremely light gray color, which makes the active black text stand out more. However, there is no animation for these changes. While we want these transitions to be more natural, Qt Quick provides <strong class="calibre10">Behavior with State</strong> to<a id="id141" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> make these transitions happen. By adding these lines to the <code class="literal">Text</code> item, we get the following code:</p><div><pre class="programlisting">Behavior on color { ColorAnimation { duration: 300 } }
Behavior on scale { PropertyAnimation { duration: 300 } }</pre></div><p class="calibre9">Animations are expected to present when you change the current delegate, which results in changes in the color and scale. If you're not sure whether you've performed the correct modification, the following<a id="id142" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> code shows you the newly modified <code class="literal">CategoriesDelegate.qml</code> file:</p><div><pre class="programlisting">import QtQuick 2.3

Rectangle {
  id: delegate
  height: 80

  property bool selected: ListView.isCurrentItem

  Text {
    id: title
    anchors { left: parent.left; leftMargin: 10; right: parent.right; rightMargin: 10 }
    anchors.verticalCenter: delegate.verticalCenter
    text: name
    font { pointSize: 18; bold: true }
    verticalAlignment: Text.AlignVCenter
    wrapMode: Text.WordWrap
    scale: selected ? 1.0 : 0.8
    color: selected ? "#000" : "#AAA"
    Behavior on color { ColorAnimation { duration: 300 } }
    Behavior on scale { PropertyAnimation { duration: 300 } }
  }

  MouseArea {
    anchors.fill: delegate
    onClicked: {
      categories.currentIndex = index
      if(categories.currentUrl == url)
      newsModel.reload()
      else
      categories.currentUrl = url
    }
  }
}</pre></div><p class="calibre9">There is room to improve the categories, including the background image which is simply an <code class="literal">Image</code> element, and could form part of your exercises. However, it won't be covered in this chapter. Here, what we do next is to change the displaying fonts on the Windows platform. We're going to change the font to <code class="literal">Times New Roman</code> by adding a few lines in <code class="literal">main.cpp</code> (not <code class="literal">main.qml</code>).</p><div><pre class="programlisting">#include &lt;QGuiApplication&gt;
#include &lt;QQmlApplicationEngine&gt;
#include &lt;QFont&gt;

int main(int argc, char *argv[])
{
  QGuiApplication app(argc, argv);

  #ifdef Q_OS_WIN
  app.setFont(QFont(QString("Times New Roman")));
  #endif

  QQmlApplicationEngine engine;
  engine.load(QUrl(QStringLiteral("qrc:/main.qml")));

  return app.exec();
}</pre></div><p class="calibre9">Here, we use a predefined macro to limit this change for the Windows platforms. By setting the font of <code class="literal">app</code> <a id="id143" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>whose type is <code class="literal">QGuiApplication</code>, all the children widgets, including <code class="literal">engine</code>, are subjected to this change. Now run the application again; you should expect a new RSS reader with this newspaper-like font:</p><div><img src="img/4615OS_03_06.jpg" alt="Tweaking the categories" class="calibre42"/></div></div></div>



  
<div><div><div><div><div><h1 class="title2"><a id="ch03lvl1sec23" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Utilizing ScrollView</h1></div></div></div><p class="calibre9">Our RSS news reader is shaping up now. From now on, let's focus on the unpleasant details. The first thing we're going to add is a scroll bar. To be more specific, <code class="literal">ScrollView</code> is about to be<a id="id144" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> added.</p><p class="calibre9">Back in the Qt 4 era, you had to write your own <code class="literal">ScrollView</code> component to gain this small yet very nice feature. Although you can utilize KDE Plasma Components' <code class="literal">ScrollArea</code> on X11 Platforms, there are no Qt bundled modules for this purpose, which means you can't use these on Windows and Mac OS X. Thanks to the open governance of the Qt project, a lot of community code gets merged, especially from the KDE community. From Qt 5.1 onwards, we have the <code class="literal">QtQuick.Controls</code> module, which has many built-in desktop components, including <code class="literal">ScrollView</code>.</p><p class="calibre9">It's a very easy to use element that provides scroll bars and content frames for its child item. There can be only one direct <code class="literal">Item</code> child, and this child is implicitly anchored to fill the <code class="literal">ScrollView</code> component. This means that we only need to anchor the <code class="literal">ScrollView</code> component.</p><p class="calibre9">There are two ways to specify the child item. The first one is to declare the child item inside the <code class="literal">ScrollView</code> component's scope, and the item which is inside will implicitly become the child of the <code class="literal">ScrollView</code> component. Another<a id="id145" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> way is to set the <code class="literal">contentItem</code> property, which is an<a id="id146" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> explicit method. In this chapter's example, both ways are demonstrated for you. The content of <code class="literal">main.qml</code> is shown here:</p><div><pre class="programlisting">import QtQuick 2.3
import QtQuick.Window 2.2
import QtQuick.XmlListModel 2.0
import QtQuick.Controls 1.2
import QtQuick.Controls.Styles 1.2
import "qrc:/"

Window {
  id: mainWindow
  visible: true
  width: 720
  height: 400

  Feeds {
    id: categoriesModel
  }

  ListView {
    id: categories

    orientation: ListView.Vertical
    spacing: 3
    model:categoriesModel
    delegate: CategoriesDelegate {
      id: categoriesDelegate
      width: categories.width
    }
    property string currentUrl: categoriesModel.get(0).url
  }

  ScrollView {
    id: categoriesView
    contentItem: categories
    anchors { left: parent.left; top: parent.top; bottom: parent.bottom; }
    width: 0.2 * parent.width
    style: ScrollViewStyle {
      transientScrollBars: true
    }
  }

  XmlListModel {
  id: newsModel

  source: categories.currentUrl
  namespaceDeclarations: "declare namespace media = 'http://search.yahoo.com/mrss/'; declare namespace atom = 'http://www.w3.org/2005/Atom';"
  query: "/rss/channel/item"

  XmlRole { name: "title"; query: "title/string()" }
  XmlRole { name: "description"; query: "description/string()" }
  XmlRole { name: "link"; query: "link/string()" }
  XmlRole { name: "pubDate"; query: "pubDate/string()" }
  //XPath starts from 1 not 0 and the second thumbnail is larger and more clear
  XmlRole { name: "thumbnail"; query: "media:thumbnail[2]/@url/string()" }
  }

  ScrollView {
    id: newsView
    anchors { left: categoriesView.right; leftMargin: 10; right: parent.right; top: parent.top; bottom: parent.bottom }
    style: ScrollViewStyle {
      transientScrollBars: true
    }
    ListView {
      id: newsList
      model: newsModel
      delegate: NewsDelegate {
        width: newsList.width
      }
    }
  }
}</pre></div><p class="calibre9">Since the child item is automatically filled with <code class="literal">anchors</code>, some lines inside <code class="literal">ListView</code> are deleted. Most of them <a id="id147" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>are just moved to <code class="literal">ScrollView</code> though. You can see that we use the explicit way for <code class="literal">categories</code> and the implicit way for <code class="literal">newsList</code>.</p><p class="calibre9">Looking into <code class="literal">ScrollView</code>, we defined a custom <code class="literal">style</code> element by forcing <code class="literal">transientScrollBars</code> to <code class="literal">true</code>. It's noted that the default value of <code class="literal">transientScrollBars</code> is platform dependent. The transient scroll bars only appear when the content is scrolled and then disappear when they are no longer needed. Anyway, it's <code class="literal">false</code> by default on Windows, so we turn it on explicitly, resulting in a better visual style shown<a id="id148" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> as follows:</p><div><img src="img/4615OS_03_07.jpg" alt="Utilizing ScrollView" class="calibre42"/></div></div></div>



  
<div><div><div><div><div><h1 class="title2"><a id="ch03lvl1sec24" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Adding BusyIndicator</h1></div></div></div><p class="calibre9">The absence of a busy indicator <a id="id149" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>makes people uncomfortable as well. No matter how short or long indicator it is, it takes time to download data and parse XML. I'm pretty sure you'd like to add such an indicator, which tells users to calm down and wait. Luckily, <code class="literal">BusyIndicator</code>, which is simply a running circle, is an element of <code class="literal">QtQuick.Controls</code>. This does exactly what we want.</p><p class="calibre9">What you need to do is to add these lines to <code class="literal">main.qml</code> inside the <code class="literal">Window</code> item:</p><div><pre class="programlisting">BusyIndicator {
  anchors.centerIn: newsView
  running: newsModel.status == XmlListModel.Loading
}</pre></div><p class="calibre9">Note that we don't need to change the <code class="literal">visible</code> property of <code class="literal">BusyIndicator</code>, because <code class="literal">BusyIndicator</code> is only visible when the <code class="literal">running</code> property is set to <code class="literal">true</code>. In this case, we set <code class="literal">running</code> to <code class="literal">true</code><a id="id150" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> when the <code class="literal">newsModel</code> status is <code class="literal">Loading</code>.</p></div></div>



  
<div><div><div><div><div><h1 class="title2"><a id="ch03lvl1sec25" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Making a frameless window</h1></div></div></div><p class="calibre9">Similar to what we did in the previous chapter, here we don't want the borders of the system window to<a id="id151" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> decorate our Qt Quick application. This is partly because it looks like a web application, which makes it seems odd with native window decorations. This job is even easier in QML than in C++. We can add the following line to <code class="literal">Window</code> in <code class="literal">main.qml</code>:</p><div><pre class="programlisting">flags: Qt.Window | Qt.FramelessWindowHint</pre></div><p class="calibre9">Although our RSS reader runs in a frameless style, there is no way to move it and it's difficult to close it, just like the situation in the previous chapter. Since our mouse has many duties for the categories and news <code class="literal">ListView</code> along with <code class="literal">ScrollView</code>, we can't simply use a new <code class="literal">MouseArea</code> element to fill the <code class="literal">Window</code> root. Therefore, what we're going to do is to draw our own title bar and, of course, the exit button.</p><p class="calibre9">To add the exit button image to the <code class="literal">qrc</code> file, right-click on <code class="literal">qml.qrc</code>, select <strong class="calibre10">Open in Editor</strong>, navigate to <strong class="calibre10">Add</strong> | <strong class="calibre10">Add Files</strong>, and then select <code class="literal">close.png</code>.</p><div><div><h3 class="title4"><a id="tip06" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Tip</h3><p class="calibre15">It'd be better to use different resource files (<code class="literal">qrc</code>) for different types of files, which make it more organized. We'll talk more about resource files in <a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="ch08.xhtml" title="Chapter 8. Enabling Your Qt Application to Support Other Languages">Chapter 8</a>, <em class="calibre14">Enabling Your Qt Application to Support Other Languages</em>.</p></div></div><p class="calibre9">Now, add a new QML <code class="literal">TitleBar.qml</code> file whose content is pasted here:</p><div><pre class="programlisting">import QtQuick 2.3

Row {
  id: titlebar
  width: parent.width
  height: 22
  layoutDirection: Qt.RightToLeft

  property point mPos: Qt.point(0,0)

  Image {
    id: closebutton
    width: 22
    height: 22
    fillMode: Image.PreserveAspectFit
    source: "qrc:/close.png"

    MouseArea {
      anchors.fill: parent
      onClicked: {
        Qt.quit()
      }
    }
  }

  Rectangle {
    width: titlebar.width - closebutton.width
    height: titlebar.height
    color: "#000"

    MouseArea {
      anchors.fill: parent
      onPressed: {
        mPos = Qt.point(mouseX, mouseY)
      }
      onPositionChanged: {
        mainWindow.setX(mainWindow.x + mouseX - mPos.x)
        mainWindow.setY(mainWindow.y + mouseY - mPos.y)
      }
    }
  }
}</pre></div><p class="calibre9">Here, we use a <code class="literal">QPoint</code> object, <code class="literal">mPos</code>, to store the position when the mouse button is clicked.</p><div><div><h3 class="title4"><a id="note13" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Note</h3><p class="calibre15">Although we may have<a id="id152" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> declared it as <code class="literal">var</code> or <code class="literal">variant</code> in the past, for maximum performance you should avoid the use of <code class="literal">var</code>. Also note that <code class="literal">variant</code> is deprecated now, so it shouldn't be used under any circumstances.</p></div></div><p class="calibre9">The <code class="literal">MouseArea</code> element, which is used for moving, is located inside the <code class="literal">Rectangle</code> element. There are lots of predefined signals and slots for <code class="literal">MouseArea</code>. Note that we use the <code class="literal">onPressed</code> slot instead of <code class="literal">onClicked</code> here to get the mouse position. This is because the <code class="literal">clicked</code> signal is only emitted when the mouse button is pressed and then released, which makes it unsuitable for moving the window.</p><p class="calibre9">The <code class="literal">positionChanged</code> signal is emitted when the mouse button is pressed and then moved. In addition to this, there is a property called <code class="literal">hoverEnabled</code>, which is <code class="literal">false</code> by default. If you set it to <code class="literal">true</code>, all the mouse events will be handled even when no mouse button is clicked. In other words, the <code class="literal">positionChanged</code> signal will be emitted when the mouse is moving, regardless of whether it's clicked or not. Therefore, we don't set <code class="literal">hoverEnabled</code> to <code class="literal">true</code> in this example.</p><p class="calibre9">Now let's go back and check the <code class="literal">Image</code> item. The <code class="literal">fillMode</code> element determines how an image should be<a id="id153" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> adjusted. By default, it'll be stretched despite the ratio. Here, we set it to preserve the ratio while we fit the <code class="literal">Image</code>. The <code class="literal">source</code> property holds the image file path. In this case, it's the <code class="literal">close.png</code> file that is in the <code class="literal">Resources</code> file, <code class="literal">qml.qrc</code>. Here we go; this is another <code class="literal">MouseArea</code>, which simply makes <code class="literal">Image</code> into a closed button.</p><p class="calibre9">At last, it's time to add <code class="literal">TitleBar</code> to <code class="literal">main.qml</code> as follows:</p><div><pre class="programlisting">import QtQuick 2.3
import QtQuick.Window 2.2
import QtQuick.XmlListModel 2.0
import QtQuick.Controls 1.2
import QtQuick.Controls.Styles 1.2
import "qrc:/"

Window {
  id: mainWindow
  visible: true
  width: 720
  height: 400
  flags: Qt.Window | Qt.FramelessWindowHint

  TitleBar {
    id: titleBar
  }

  Text {
    id: windowTitle
    anchors { left: titleBar.left; leftMargin: 10; verticalCenter: titleBar.verticalCenter }
    text: "BBC News Reader"
    color: "#FFF"
    font.pointSize: 10
  }

  Feeds {
    id: categoriesModel
  }

  ListView {
    id: categories

    orientation: ListView.Vertical
    spacing: 3
    model:categoriesModel
    delegate: CategoriesDelegate {
      id: categoriesDelegate
      width: categories.width
    }
    property string currentUrl: categoriesModel.get(0).url
  }

  ScrollView {
    id: categoriesView
    contentItem: categories
    anchors { left: parent.left; top: titleBar.bottom; bottom: parent.bottom; }
    width: 0.2 * parent.width
    style: ScrollViewStyle {
      transientScrollBars: true
    }
  }

  XmlListModel {
    id: newsModel

    source: categories.currentUrl
    namespaceDeclarations: "declare namespace media = 'http://search.yahoo.com/mrss/'; declare namespace atom = 'http://www.w3.org/2005/Atom';"
    query: "/rss/channel/item"

    XmlRole { name: "title"; query: "title/string()" }
    XmlRole { name: "description"; query: "description/string()" }
    XmlRole { name: "link"; query: "link/string()" }
    XmlRole { name: "pubDate"; query: "pubDate/string()" }
    //XPath starts from 1 not 0 and the second thumbnail is larger and more clear
    XmlRole { name: "thumbnail"; query: "media:thumbnail[2]/@url/string()" }
  }

  ScrollView {
    id: newsView
    anchors { left: categoriesView.right; leftMargin: 10; right: parent.right; top: titleBar.bottom; bottom: parent.bottom }
    style: ScrollViewStyle {
      transientScrollBars: true
    }
    ListView {
      id: newsList
      model: newsModel
      delegate: NewsDelegate {
        width: newsList.width
      }
    }
  }

  BusyIndicator {
    anchors.centerIn: newsView
    running: newsModel.status == XmlListModel.Loading
  }
}</pre></div><p class="calibre9">We also use a <code class="literal">Text</code> element, <code class="literal">windowTitle</code>, to display the window title in <code class="literal">titleBar</code>. Since we retrieve <a id="id154" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>data from BBC News, it's not a bad idea to call it <code class="literal">BBC News Reader</code> or just name it whatever you like.</p><p class="calibre9">Apart from the addition of the title bar, some code needs to be modified to spare room for it. Both the <code class="literal">ScrollView</code> component's anchored <code class="literal">top</code> should be changed to <code class="literal">titleBar.bottom</code> instead of <code class="literal">parent.top</code>, otherwise the title bar will be placed partially on top of these two scroll views.</p><p class="calibre9">Give the application a run; it should deliver a new visual style. Although it looks more like a web application, the whole interface is clean and integrated. Another benefit of this change is a unified UI across all platforms.</p><div><img src="img/4615OS_03_08.jpg" alt="Making a frameless window" class="calibre44"/></div></div></div>



  
<div><div><div><div><div><h1 class="title2"><a id="ch03lvl1sec26" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Debugging QML</h1></div></div></div><p class="calibre9">The most common<a id="id155" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> practice to debug QML is the use of the API console. JavaScript developers should be familiar with this because of the console support in QML. The relationships between the <code class="literal">console</code> functions and the Qt/C++ <code class="literal">QDebug</code> functions are given as follows:</p><div><table border="1" class="calibre28"><colgroup class="calibre29"><col class="calibre30"/><col class="calibre30"/></colgroup><thead class="calibre31"><tr class="calibre32"><th valign="bottom" class="calibre33">
<p class="calibre34">QML</p>
</th><th valign="bottom" class="calibre33">
<p class="calibre34">Qt/C++</p>
</th></tr></thead><tbody class="calibre35"><tr class="calibre36"><td class="calibre37">
<p class="calibre34">
<code class="literal">console.log()</code>
</p>
</td><td class="calibre37">
<p class="calibre34">
<code class="literal">qDebug()</code>
</p>
</td></tr><tr class="calibre38"><td class="calibre37">
<p class="calibre34">
<code class="literal">console.debug()</code>
</p>
</td><td class="calibre37">
<p class="calibre34">
<code class="literal">qDebug()</code>
</p>
</td></tr><tr class="calibre36"><td class="calibre37">
<p class="calibre34">
<code class="literal">console.info()</code>
</p>
</td><td class="calibre37">
<p class="calibre34">
<code class="literal">qDebug()</code>
</p>
</td></tr><tr class="calibre38"><td class="calibre37">
<p class="calibre34">
<code class="literal">console.warn()</code>
</p>
</td><td class="calibre37">
<p class="calibre34">
<code class="literal">qWarning()</code>
</p>
</td></tr><tr class="calibre45"><td class="calibre37">
<p class="calibre34">
<code class="literal">console.error()</code>
</p>
</td><td class="calibre37">
<p class="calibre34">
<code class="literal">qCritical()</code>
</p>
</td></tr></tbody></table></div><p class="calibre9">With the preceding supports present, QML is just like JavaScript programming. At the same time, the following functions are also introduced in QML:</p><div><table border="1" class="calibre28"><colgroup class="calibre29"><col class="calibre30"/><col class="calibre30"/></colgroup><thead class="calibre31"><tr class="calibre32"><th valign="bottom" class="calibre33">
<p class="calibre34">Functions</p>
</th><th valign="bottom" class="calibre33">
<p class="calibre34">Description</p>
</th></tr></thead><tbody class="calibre35"><tr class="calibre36"><td class="calibre37">
<p class="calibre34">
<code class="literal">console.assert()</code>
</p>
</td><td class="calibre37">
<p class="calibre34">This function<a id="id156" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> tests whether the expression is true. If not, it will write an optional message to the console and print the stack trace.</p>
</td></tr><tr class="calibre38"><td class="calibre37">
<p class="calibre34">
<code class="literal">console.exception()</code>
</p>
</td><td class="calibre37">
<p class="calibre34">This function <a id="id157" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>prints an error message together with the stack trace of the JavaScript execution at the point it is called.</p>
</td></tr><tr class="calibre36"><td class="calibre37">
<p class="calibre34">
<code class="literal">console.trace()</code>
</p>
</td><td class="calibre37">
<p class="calibre34">This function<a id="id158" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> prints the stack trace of the JavaScript execution at the point it is called.</p>
</td></tr><tr class="calibre38"><td class="calibre37">
<p class="calibre34">
<code class="literal">console.count()</code>
</p>
</td><td class="calibre37">
<p class="calibre34">This function<a id="id159" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> prints the current number of times a particular piece of code has been executed, along with a message.</p>
</td></tr><tr class="calibre36"><td class="calibre37">
<p class="calibre34">
<code class="literal">console.time()</code>
</p>
<p class="calibre34">
<code class="literal">console.timeEnd()</code>
</p>
</td><td class="calibre37">
<p class="calibre34">This pair of functions<a id="id160" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> will print the time that a <a id="id161" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>particular piece of code between them takes in milliseconds.</p>
</td></tr><tr class="calibre39"><td class="calibre37">
<p class="calibre34">
<code class="literal">console.profile()</code>
</p>
<p class="calibre34">
<code class="literal">console.profileEnd()</code>
</p>
</td><td class="calibre37">
<p class="calibre34">This pair<a id="id162" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> of functions profiles both the state of <a id="id163" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/><code class="literal">QDeclarativeEngine</code> as well as the V8 call methods. However, you need to attach the QML Profiler tool to the application before <code class="literal">console.profileEnd()</code> is called.</p>
</td></tr></tbody></table></div><p class="calibre9">In addition to the preceding useful functions, the common <strong class="calibre10">Debug</strong> mode in Qt Creator is available for QML as well. The operations are almost identical to C++ debugging. You can set the<a id="id164" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> breakpoints, observe values, and so on. However, there is one more thing provided for QML. It's the <strong class="calibre10">QML/JS Console</strong>! Qt Creator doesn't show the <strong class="calibre10">QML/JS Console</strong> by default, you have to turn it on manually. Just click on the small button (the red circle in the following screenshot), and then tick <strong class="calibre10">QML/JS Console</strong>:</p><div><img src="img/4615OS_03_09.jpg" alt="Debugging QML" class="calibre46"/></div><div><div><h3 class="title4"><a id="tip07" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Tip</h3><p class="calibre15">When the application is interrupted by a breakpoint, you can use the <strong class="calibre10">QML/JS Console</strong> to execute the JavaScript expressions in the current context. You can change the property values temporarily, without editing the source, and view the results in the running application.</p></div></div><p class="calibre9">The <strong class="calibre10">QML/JS Console</strong> tab shows the debug output, both the Qt debug messages and JavaScript console messages, in an appealing way. It <a id="id165" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>provides a button group to help you filter information, warnings, and errors. Therefore, just use this <strong class="calibre10">QML/JS Console</strong> tab to replace <strong class="calibre10">Application Output</strong> when you debug Qt Quick applications.</p></div></div>



  
<div><div><div><div><div><h1 class="title2"><a id="ch03lvl1sec27" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Summary</h1></div></div></div><p class="calibre9">In this chapter, we went through a thorough introduction to Qt Quick. We also covered model-view programming, which is a vital concept in both Qt/C++ and Qt Quick/QML. You may also find that QML is in some way an extensible version of JavaScript. This is an additional bonus for JavaScript developers. However, it's not difficult to start if you've never written a script before. Once you start, you'll get to explore the fascinating qualities of Qt Quick. We're going to show you how to access camera devices using Qt in the next chapter.</p></div></div>



  </body></html>