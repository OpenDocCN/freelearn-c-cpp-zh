<html><head></head><body><div id="sbo-rt-content" class="calibre1"><div class="calibre2" title="Chapter 9. Deploying Applications on Other Devices"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title"><a id="ch09" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Chapter 9. Deploying Applications on Other Devices</h1></div></div></div><p class="calibre9">After development, it's time to distribute your application. We'll use an example application, <code class="literal">Internationalization</code>, from the previous chapter to demonstrate how to spread your Qt application to Windows, Linux, and Android. The following topics will be covered in this chapter:</p><div class="calibre2"><ul class="itemizedlist"><li class="listitem">Releasing Qt applications on Windows</li><li class="listitem">Creating an installer</li><li class="listitem">Packaging Qt applications on Linux</li><li class="listitem">Deploying Qt applications on Android</li></ul></div><div class="calibre2" title="Releasing Qt applications on Windows"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title2"><a id="ch09lvl1sec60" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Releasing Qt applications on Windows</h1></div></div></div><p class="calibre9">After <a id="id406" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>the development stage, you can build your<a id="id407" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> application using <code class="literal">release</code> as the build configuration. In the <code class="literal">release</code> configuration, your compiler will optimize the code and won't produce debug symbols, which in turn reduces the size. Please ensure that the project is in the <code class="literal">release</code> configuration.</p><p class="calibre9">Before we jump into the packaging procedure, I'd like to talk about the difference between static and dynamic linking. You have probably been using dynamic linking of Qt libraries throughout this book. This can be confirmed if you download the <span class="strong"><strong class="calibre10">Community Edition</strong></span> from the Qt website.</p><p class="calibre9">So, what does dynamic linking mean? Well, it means that when an executable file gets executed, the operating system will load and link the necessary shared libraries at runtime. In other words, you'll see a lot of <code class="literal">.dll</code> files on Windows and <code class="literal">.so</code> files on the Unix platforms. This technique allows developers to update these shared libraries and the executable separately, which means that you don't need to rebuild the executable file if you change shared libraries, so long as their ABIs are compatible. Although this method is <a id="id408" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>more flexible, developers are warned to take care to avoid <span class="strong"><strong class="calibre10">DLL Hell</strong></span>.</p><p class="calibre9">The most commonly used solution to DLL Hell on Windows is to choose static linking instead. By contrast, static linking will resolve all the function calls and variables at compile time <a id="id409" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>and copy them into the target to produce <a id="id410" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>a standalone executable. The advantages are obvious. Firstly, you don't need to ship all necessary and shared libraries. There won't be DLL Hell in this situation. On Windows, static libraries may get <code class="literal">.lib</code> or <code class="literal">.a</code> as extensions depending on the compiler you use, whereas they usually get <code class="literal">.a</code> on the Unix platforms.</p><p class="calibre9">To<a id="id411" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> make a clear comparison, a table is made for <a id="id412" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>you to see the differences between the dynamic and static linking:</p><div class="informaltable"><table border="1" class="calibre28"><colgroup class="calibre29"><col class="calibre30"/><col class="calibre30"/><col class="calibre30"/></colgroup><thead class="calibre31"><tr class="calibre32"><th valign="bottom" class="calibre33"> </th><th valign="bottom" class="calibre33">
<p class="calibre34">Dynamic Linking</p>
</th><th valign="bottom" class="calibre33">
<p class="calibre34">Static Linking</p>
</th></tr></thead><tbody class="calibre35"><tr class="calibre36"><td class="calibre37">
<p class="calibre34">
<span class="strong"><strong class="calibre10">Library types</strong></span>
</p>
</td><td class="calibre37">
<p class="calibre34">Shared libraries</p>
</td><td class="calibre37">
<p class="calibre34">Static libraries</p>
</td></tr><tr class="calibre38"><td class="calibre37">
<p class="calibre34">
<span class="strong"><strong class="calibre10">Executable size</strong></span>
</p>
</td><td class="calibre37">
<p class="calibre34">Considerably smaller</p>
</td><td class="calibre37">
<p class="calibre34">Greater than dynamically linked</p>
</td></tr><tr class="calibre36"><td class="calibre37">
<p class="calibre34">
<span class="strong"><strong class="calibre10">Library updates</strong></span>
</p>
</td><td class="calibre37">
<p class="calibre34">Only libraries themselves</p>
</td><td class="calibre37">
<p class="calibre34">Executable file needs to be rebuilt</p>
</td></tr><tr class="calibre39"><td class="calibre37">
<p class="calibre34">
<span class="strong"><strong class="calibre10">Incompatible libraries</strong></span>
</p>
</td><td class="calibre37">
<p class="calibre34">Need to take care to avoid this</p>
</td><td class="calibre37">
<p class="calibre34">Won't happen</p>
</td></tr></tbody></table></div><p class="calibre9">However, if the shared libraries shipped with dynamically linked executable files are counted as part of the package, the dynamic style package will be larger than the statically linked standalone executable files.</p><p class="calibre9">Now, back to the topic! Since there is no standard Qt runtime library installer for Windows, the best routine is to produce a statically linked target because the package to be released will be smaller, and the executable is immune to DLL Hell.</p><p class="calibre9">However, as mentioned previously, the Qt libraries you downloaded can only be used for dynamic linking applications because they are shared libraries. It is viable to compile Qt as static libraries. However, before you proceed, you need to know the licenses of Qt.</p><p class="calibre9">Currently, in addition to the Qt Open Source License, there is also the Qt Commercial License. For open source licenses, most of the Qt libraries are licensed under <span class="strong"><strong class="calibre10">The GNU Lesser General Public License</strong></span> (<span class="strong"><strong class="calibre10">LPGL</strong></span>). In this case, if you build your application statically linked with the Qt libraries, your application is subject to provide users the source code of your application under LGPL. Your application may stay proprietary and closed source if it's dynamically linked with the Qt libraries. In other words, if you want to link an application statically and keep it proprietary, you have to purchase the Qt commercial license. For details <a id="id413" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>about Qt licensing, refer to <a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="http://www.qt.io/licensing/">http://www.qt.io/licensing/</a>.</p><p class="calibre9">If you decide to use static linking, you might have to compile the Qt libraries statically before building your application. In this case, the executable target is the only thing that needs to be packaged and released. Don't forget the QM files if your application has multi-language support, as mentioned previously.</p><p class="calibre9">On the other hand, if you want to go the dynamic way, it'd need some extra effort. Firstly, there are some core DLLs that have to exist and the list is different depending on the compiler. The following table includes both MSVC and MinGW/GCC scenarios:</p><div class="informaltable"><table border="1" class="calibre28"><colgroup class="calibre29"><col class="calibre30"/><col class="calibre30"/></colgroup><thead class="calibre31"><tr class="calibre32"><th valign="bottom" class="calibre33">
<p class="calibre34">MSVC 2013</p>
</th><th valign="bottom" class="calibre33">
<p class="calibre34">MinGW/GCC</p>
</th></tr></thead><tbody class="calibre35"><tr class="calibre36"><td class="calibre37">
<p class="calibre34">
<code class="literal">msvcp120.dll</code>
</p>
</td><td class="calibre37">
<p class="calibre34">
<code class="literal">libgcc_s_dw2-1.dll</code>
</p>
</td></tr><tr class="calibre38"><td class="calibre37">
<p class="calibre34">
<code class="literal">msvcr120.dll</code>
</p>
</td><td class="calibre37">
<p class="calibre34">
<code class="literal">libstdc++-6.dll</code>
</p>
</td></tr><tr class="calibre45"><td class="calibre37"> </td><td class="calibre37">
<p class="calibre34">
<code class="literal">libwinpthread-1.dll</code>
</p>
</td></tr></tbody></table></div><p class="calibre9">There <a id="id414" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>are common DLLs that need to be included, such<a id="id415" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> as <code class="literal">icudt53.dll</code>, <code class="literal">icuin53.dll</code>, and <code class="literal">icuuc53.dll</code>. You can find these files in the Qt libraries directory. Take MinGW/GCC as an example; they're located in <code class="literal">QT_DIR\5.4\mingw491_32\bin</code> where <code class="literal">QT_DIR</code> is the Qt installation path, such as <code class="literal">D:\Qt</code>. Note that the later versions of Qt may have slightly different filenames.</p><p class="calibre9">Besides, there is no need to ship <code class="literal">msvcp120.dll</code> and <code class="literal">msvcr120.dll</code> if the target users have <a id="id416" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>installed <span class="strong"><strong class="calibre10">Visual C++ Redistributable Packages</strong></span> for Visual Studio 2013, which can be downloaded from <a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="http://www.microsoft.com/en-ie/download/details.aspx?id=40784">http://www.microsoft.com/en-ie/download/details.aspx?id=40784</a>.</p><p class="calibre9">After this, you may want to check other DLLs you'll need by looking into the project file. Take the <code class="literal">Internationalization</code> project as an example. Its project file, <code class="literal">Internationalization.pro</code>, gives us a clue. There are two lines related to the QT configuration, shown as follows:</p><div class="calibre2"><pre class="programlisting">QT       += core gui

greaterThan(QT_MAJOR_VERSION, 4): QT += widgets</pre></div><p class="calibre9">The <code class="literal">QT</code> variable includes the <code class="literal">core gui</code> widgets. In fact, all the Qt applications will include <code class="literal">core</code> at least, while others are dependent. In this case, we have to ship <code class="literal">Qt5Core.dll</code>, <code class="literal">Qt5Gui.dll</code>, and <code class="literal">Qt5Widgets.dll</code> along with the executable target.</p><p class="calibre9">Now, build the <code class="literal">Internationalization</code> project with MinGW/GCC. The executable target, <code class="literal">Internationalization.exe</code>, should be located inside the <code class="literal">release</code> folder of the build directory, which can be read from the <span class="strong"><strong class="calibre10">Projects</strong></span> mode. Next, we create a new folder named <code class="literal">package</code> and copy the executable file there. Then, we copy the needed DLLs to <code class="literal">package</code> as well. Now, this folder should have all the necessary DLLs as shown here:</p><div class="mediaobject"><img src="Images/4615OS_09_01.jpg" alt="Releasing Qt applications on Windows" class="calibre82"/></div><p class="calibre9">In <a id="id417" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>most cases, if a required library is missing, the <a id="id418" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>application won't run while the operating system will prompt the missing library name. For instance, if <code class="literal">Qt5Widgets.dll</code> is missing, the following system error dialog will show up when you try to run <code class="literal">Internationalizationi.exe</code>:</p><div class="mediaobject"><img src="Images/4615OS_09_02.jpg" alt="Releasing Qt applications on Windows" class="calibre83"/></div><p class="calibre9">Basically, the routine is to copy the missing libraries to the same folder that the application is in. Besides, you can use some tools such as <code class="literal">Dependency Walker</code> to get the library dependencies.</p><p class="calibre9">Please don't use DLLs from the <code class="literal">Qt Editor</code> folder. This version is often different from Qt Libraries you've used. In addition to these libraries, you may have to include all the resources that your application is going to use. For example, the QM files used for translation, that is, to copy the <code class="literal">Internationalization_de.qm</code> file in order to load the German translation.</p><p class="calibre9">The file list is as follows:</p><div class="calibre2"><ul class="itemizedlist"><li class="listitem"><code class="literal">icudt53.dll</code></li><li class="listitem"><code class="literal">icuin53.dll</code></li><li class="listitem"><code class="literal">icuuc53.dll</code></li><li class="listitem"><code class="literal">Internationalization.exe</code></li><li class="listitem"><code class="literal">Internationalization_de.qm</code></li><li class="listitem"><code class="literal">libgcc_s_dw2-1.dll</code></li><li class="listitem"><code class="literal">libstdc++-6.dll</code></li><li class="listitem"><code class="literal">libwinpthread-1.dll</code></li><li class="listitem"><code class="literal">Qt5Core.dll</code></li><li class="listitem"><code class="literal">Qt5Gui.dll</code></li><li class="listitem"><code class="literal">Qt5Widgets.dll</code></li></ul></div><p class="calibre9">Don't forget, this<a id="id419" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> is the case for MinGW/GCC in Qt 5.4.0, while different versions and compilers might have a slightly different list, as we discussed before.</p><p class="calibre9">After<a id="id420" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> this first-time preparation, to some extent this list is fixed. You only need to change the executable target and the QM file if it's changed. An easy way to do this is to compress all of them in <code class="literal">tarball</code>.</p></div></div></div>



  
<div id="sbo-rt-content" class="calibre1"><div class="calibre2" title="Creating an installer"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title2"><a id="ch09lvl1sec61" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Creating an installer</h1></div></div></div><p class="calibre9">Although it's<a id="id421" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> quick to use an archive file to distribute your application, it <a id="id422" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>seems more professional if you provide users with an installer. Qt offers <span class="strong"><strong class="calibre10">Qt Installer Framework</strong></span> whose latest open source version, 1.5.0 for <a id="id423" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>now, can be obtained from <a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="http://download.qt.io/official_releases/qt-installer-framework/1.5.0/">http://download.qt.io/official_releases/qt-installer-framework/1.5.0/</a>.</p><p class="calibre9">For the sake of convenience, let's create a folder named <code class="literal">dist</code> under the Qt Installer Framework installation path, <code class="literal">D:\Qt\QtIFW-1.5.0</code>. This folder is used to store all the application projects that need to be packaged.</p><p class="calibre9">Then, create a folder named <code class="literal">internationalization</code> under <code class="literal">dist</code>. Inside <code class="literal">internationalization</code>, create two folders, <code class="literal">config</code> and <code class="literal">packages</code>.</p><p class="calibre9">The name of the directory inside the <code class="literal">packages</code> directory acts as a domain-like, or say Java-style, identifier. In this example, we have two packages, one is the application while the other one is a translation. Therefore, it adds to the two folders in the packages directory, <code class="literal">com.demo.internationalization</code>, and <code class="literal">com.demo.internationalization.translation</code>, respectively. There will be <code class="literal">meta</code> and <code class="literal">data</code> directories<a id="id424" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> present inside each of them, so the overall directory structure is sketched as follows:</p><div class="mediaobject"><img src="Images/4615OS_09_03.jpg" alt="Creating an installer" class="calibre84"/></div><p class="calibre9">Let's edit the global configuration file, <code class="literal">config.xml</code>, which is first inside the <code class="literal">config</code> directory. You need to create one file named <code class="literal">config.xml</code>.</p><div class="sidebar" title="Note"><div class="inner"><h3 class="title4"><a id="note29" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Note</h3><p class="calibre15">Always remember not to use the Windows built-in Notepad to edit this file, or in fact any file. You may either use Qt Creator or other advanced editors, such as Notepad++, to edit it. This is simply because Notepad lacks of a lot of features as a code editor.</p></div></div><p class="calibre9">In this<a id="id425" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> example, the <code class="literal">config.xml</code> file's content is pasted here:</p><div class="calibre2"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Installer&gt;
  &lt;Name&gt;Internationalization&lt;/Name&gt;
  &lt;Version&gt;1.0.0&lt;/Version&gt;
  &lt;Title&gt;Internationalization Installer&lt;/Title&gt;
  &lt;Publisher&gt;Packt&lt;/Publisher&gt;
  &lt;TargetDir&gt;@homeDir@/Internationalization&lt;/TargetDir&gt;
  &lt;AdminTargetDir&gt;@rootDir@/Internationalization&lt;/AdminTargetDir&gt;
&lt;/Installer&gt;</pre></div><p class="calibre9">For a minimum <code class="literal">config.xml</code> file, the elements <code class="literal">&lt;Name&gt;</code> and <code class="literal">&lt;Version&gt;</code> must exist in <code class="literal">&lt;Installer&gt;</code>. All other elements are optional, but you should specify them if there is a need. Meanwhile, <code class="literal">&lt;TargetDir&gt;</code> and <code class="literal">&lt;AdminTargetDir&gt;</code> may be a bit confusing. They both specify the default installation path, where <code class="literal">&lt;AdminTargetDir&gt;</code> is to specify the installation path when it gained administrative rights. The other elements are pretty much self-explanatory. There are other elements that you can set to customize the installer. For more details, refer to <a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="http://doc.qt.io/qtinstallerframework/ifw-globalconfig.html">http://doc.qt.io/qtinstallerframework/ifw-globalconfig.html</a>.</p><p class="calibre9">Let's navigate into the <code class="literal">meta</code> folder inside <code class="literal">com.demo.internationalization</code>. This directory contains the files that specify the settings for deployment and installation. All the files in this directory, except for licenses, won't be extracted by the installer, and neither will they be installed. There must be at least a package information file, such as <code class="literal">package.xml</code>. The following example, <code class="literal">package.xml</code>, in <code class="literal">com.demo.internationalization/meta</code> is shown here:</p><div class="calibre2"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Package&gt;
  &lt;DisplayName&gt;Core Application&lt;/DisplayName&gt;
  &lt;Description&gt;Essential part of Internationalization&lt;/Description&gt;
  &lt;Version&gt;1.0.0&lt;/Version&gt;
  &lt;ReleaseDate&gt;2014-12-27&lt;/ReleaseDate&gt;
  &lt;Name&gt;com.demo.internationalization&lt;/Name&gt;
  &lt;Licenses&gt;
    &lt;License name="License Agreement" file="license.txt" /&gt;
  &lt;/Licenses&gt;
  &lt;Default&gt;true&lt;/Default&gt;
  &lt;ForcedInstallation&gt;true&lt;/ForcedInstallation&gt;
&lt;/Package&gt;</pre></div><p class="calibre9">The <code class="literal">&lt;Default&gt;</code> element specifies whether this package should be selected by default. At the same <a id="id426" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>time, we set <code class="literal">&lt;ForcedInstallation&gt;</code> to <code class="literal">true</code>, indicating that the end users can't deselect this package. While the <code class="literal">&lt;Licenses&gt;</code> element can have multiple children <code class="literal">&lt;License&gt;</code>, in this case we only have one. We have to provide the <code class="literal">license.txt</code> file, whose content is just a single line demonstration, as shown here:</p><div class="calibre2"><pre class="programlisting">This is the content of license.txt.</pre></div><p class="calibre9">The following <code class="literal">package.xml</code> file, which is located in <code class="literal">com.demo.internationalization.translation/meta</code>, has fewer lines:</p><div class="calibre2"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Package&gt;
  &lt;DisplayName&gt;German Translation&lt;/DisplayName&gt;
  &lt;Description&gt;German translation file&lt;/Description&gt;
  &lt;Version&gt;1.0.0&lt;/Version&gt;
  &lt;ReleaseDate&gt;2014-12-27&lt;/ReleaseDate&gt;
  &lt;Name&gt;com.demo.internationalization.translation&lt;/Name&gt;
  &lt;Default&gt;false&lt;/Default&gt;
&lt;/Package&gt;</pre></div><p class="calibre9">The difference between <code class="literal">&lt;DisplayName&gt;</code> and <code class="literal">&lt;Description&gt;</code> is demonstrated by the following screenshot:</p><div class="mediaobject"><img src="Images/4615OS_09_04.jpg" alt="Creating an installer" class="calibre85"/></div><p class="calibre9">The <code class="literal">&lt;Description&gt;</code> element is the text that displays on the right-hand side when the package<a id="id427" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> gets selected. It's also the text that pops up as the tooltip when the mouse hovers over the entry. You can also see the relationship between these two packages. As the name <code class="literal">com.demo.internationalization.translation</code> suggests, it is a subpackage of <code class="literal">com.demo.internationalization</code>.</p><p class="calibre9">The licenses will be displayed after this step and are shown in the following screenshot. If you set multiple licenses, the dialog will have a panel to view those licenses separately, similar to the one you see when you install Qt itself.</p><div class="mediaobject"><img src="Images/4615OS_09_05.jpg" alt="Creating an installer" class="calibre85"/></div><p class="calibre9">For <a id="id428" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>more settings in the <code class="literal">package.xml</code> file, refer to <a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="http://doc.qt.io/qtinstallerframework/ifw-component-description.html#package-information-file-syntax">http://doc.qt.io/qtinstallerframework/ifw-component-description.html#package-information-file-syntax</a>.</p><p class="calibre9">By contrast, the <code class="literal">data</code> directories store all the files that need to be installed. In this example, we keep all files prepared previously in the <code class="literal">data</code> folder of <code class="literal">com.demo.internationalization</code>, except for the QM file. The QM file, <code class="literal">Internationalization_de.qm</code>, is kept in the <code class="literal">data</code> folder inside <code class="literal">com.demo.internationalization.translation</code>.</p><p class="calibre9">After all the initial preparation, we come to the final step to generate the installer application of this project. Depending on your operating system, open <span class="strong"><strong class="calibre10">Command Prompt</strong></span> or <span class="strong"><strong class="calibre10">Terminal</strong></span>, changing the current directory to <code class="literal">dist/internationalization</code>. In this case, it's <code class="literal">D:\Qt\QtIFW-1.5.0\dist\internationalization</code>. Then, execute the following command to generate the <code class="literal">internationalization_installer.exe</code> installer file:</p><div class="calibre2"><pre class="programlisting">
<span class="strong"><strong class="calibre10">..\..\bin\binarycreator.exe -c config\config.xml -p packages internationalization_installer.exe</strong></span>
</pre></div><div class="sidebar" title="Note"><div class="inner"><h3 class="title4"><a id="note30" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Note</h3><p class="calibre15">On Unix platforms, including Linux and Mac OS X, you'll have to use a slash (/) instead of anti-slash (\), and drop the <code class="literal">.exe</code> suffix, which makes the command slightly different, as shown here:</p><div class="calibre2"><pre class="programlisting1">../../bin/binarycreator -c config/config.xml -p packages internationalization_installer</pre></div></div></div><p class="calibre9">You need<a id="id429" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> to wait for a while because the <code class="literal">binarycreator</code> tool will package files in the <code class="literal">data</code> directories into the <code class="literal">7zip</code> archives, which is a time consuming process. After this, you should expect to see <code class="literal">internationalization_installer.exe</code> (or without <code class="literal">.exe</code>) in the current directory.</p><p class="calibre9">The installer is much more convenient, especially for a big application project that has several optional packages. Besides, it'll register and let the end users uninstall through <span class="strong"><strong class="calibre10">Control Panel</strong></span>.</p></div></div>



  
<div id="sbo-rt-content" class="calibre1"><div class="calibre2" title="Packaging Qt applications on Linux"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title2"><a id="ch09lvl1sec62" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Packaging Qt applications on Linux</h1></div></div></div><p class="calibre9">Things<a id="id430" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> are more complicated on Linux than on <a id="id431" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>Windows. There are two popular package formats: <span class="strong"><strong class="calibre10">RPM Package Manager</strong></span> (<span class="strong"><strong class="calibre10">RPM</strong></span>) and <span class="strong"><strong class="calibre10">Debian Binary Package </strong></span>(<span class="strong"><strong class="calibre10">DEB</strong></span>). RPM was originally developed <a id="id432" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>for <span class="strong"><strong class="calibre10">Red Hat Linux</strong></span> and it's the baseline<a id="id433" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> package <a id="id434" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>format of <span class="strong"><strong class="calibre10">Linux Standard Base</strong></span>. It's mainly used on<a id="id435" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> <span class="strong"><strong class="calibre10">Fedora</strong></span>, <span class="strong"><strong class="calibre10">OpenSUSE</strong></span>, <span class="strong"><strong class="calibre10">Red Hat Enterprise Linux</strong></span>, and its derivatives; while the latter is famous for <a id="id436" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>being <a id="id437" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>used in <span class="strong"><strong class="calibre10">Debian</strong></span> and its well-known and<a id="id438" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> popular derivative, <span class="strong"><strong class="calibre10">Ubuntu</strong></span>.</p><p class="calibre9">In addition to<a id="id439" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> these formats, there are other Linux distributions using different <a id="id440" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>package formats, such as <span class="strong"><strong class="calibre10">Arch Linux</strong></span> and <span class="strong"><strong class="calibre10">Gentoo</strong></span>. It will take extra time to package your applications for different Linux distributions.</p><p class="calibre9">However, it won't be too time consuming, especially for open-source applications. If your application is open source, you can refer to the documentation to write a formatted script to compile and package <a id="id441" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>your application. For details on creating an RPM package, refer to <a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="https://fedoraproject.org/wiki/How_to_create_an_RPM_package">https://fedoraproject.org/wiki/How_to_create_an_RPM_package</a>, whereas for DEB packaging, refer to <a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="https://www.debian.org/doc/manuals/maint-guide/index.en.html">https://www.debian.org/doc/manuals/maint-guide/index.en.html</a>. There is an example later that demonstrates how to package DEB.</p><p class="calibre9">Although it's feasible to pack proprietary applications, such as the RPM and DEB packages, they won't get into the official repository. In this case, you may want to set up a repository on your server or just release the packages via a file host.</p><p class="calibre9">Alternatively, you can archive your applications, similar to what we do on Windows, and write a shell script for installation and uninstallation. In this way, you can use one tarball or Qt Installer Framework to cook an installer for various distributions. But, don't ever forget to address the dependencies appropriately. The incompatible shared library issue is even worse on Linux, because almost all the libraries and applications are linked dynamically. The worst part is the incompatibility between different distributions, since they may use different library versions. Therefore, either take care of these pitfalls, or go the static linking way.</p><p class="calibre9">As we<a id="id442" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> mentioned previously, statically linked<a id="id443" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> software must be open source unless you have purchased the Qt commercial license. This dilemma makes the statically linked open source application pointless. This is not only because dynamic linking is the standard way, but also because statically linked Qt applications won't be able to use the system theme and can't benefit from system upgrades, which is not okay when security updates are involved. Anyway, you can compile your application using static linking if your application is proprietary and you get a commercial license. In this case, just like static linking on Windows, you only need to release the target executable files with the necessary resources, such as icons and translations. It's noteworthy that even if you build statically linked Qt applications, it's still impossible to run them on any Linux distributions.</p><p class="calibre9">Therefore, the recommended way is to install several mainstream Linux distributions on virtual machines, and then use these virtual machines to package your dynamically linked application as their own package formats. The binary package doesn't contain source code, and it's also a common practice to strip the symbols from the binary package. In this way, your source code for proprietary software won't be leaked through these packages.</p><p class="calibre9">We still use <code class="literal">Internationalization</code> as an example here. Let's see how to create a DEB package. The <a id="id444" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>following operations were tested on the latest <span class="strong"><strong class="calibre10">Debian Wheezy</strong></span>; later versions or different Linux distributions might be slightly different.</p><p class="calibre9">Before we package the application, we have to edit the project file, <code class="literal">Internationalization.pro</code>, to make it installable as follows:</p><div class="calibre2"><pre class="programlisting">QT       += core gui

greaterThan(QT_MAJOR_VERSION, 4): QT += widgets

TARGET = Internationalization
TEMPLATE = app


SOURCES += main.cpp \
           mainwindow.cpp

HEADERS  += mainwindow.h

FORMS    += mainwindow.ui

TRANSLATIONS = Internationalization_de.ts

<span class="strong"><strong class="calibre10">unix: {</strong></span>
<span class="strong"><strong class="calibre10">    target.path  = /opt/internationalization_demo</strong></span>
<span class="strong"><strong class="calibre10">    qmfile.path  = $$target.path</strong></span>
<span class="strong"><strong class="calibre10">    qmfile.files = Internationalization_de.qm</strong></span>

<span class="strong"><strong class="calibre10">    INSTALLS += target \</strong></span>
<span class="strong"><strong class="calibre10">                qmfile</strong></span>
<span class="strong"><strong class="calibre10">}</strong></span>
</pre></div><p class="calibre9">There is<a id="id445" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> a concept in <code class="literal">qmake</code> called <span class="strong"><strong class="calibre10">install set</strong></span>. Each <a id="id446" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>install set has three members: <code class="literal">path</code>, <code class="literal">files</code>, and <code class="literal">extra</code>. The <code class="literal">path</code> member<a id="id447" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> defines the destination location, while <code class="literal">files</code> tells <code class="literal">qmake</code> what files should be copied. You can specify some commands that need to be executed before other instructions in <code class="literal">extra</code>.</p><p class="calibre9">
<code class="literal">TARGET</code> is a bit special. Firstly, it's the target executable (or library), while on the other hand, it also implies <code class="literal">target.files</code>. Therefore, we only need to specify the path of <code class="literal">target</code>. We also use the same path for <code class="literal">qmfile</code>, which includes the QM file. Don't forget to use a double dollar sign, <code class="literal">$$</code>, to use a variable. Lastly, we set the <code class="literal">INSTALLS</code> variable, which defines what is to be installed when <code class="literal">make install</code> is called. The <code class="literal">unix</code> brackets are used to limit the lines only read by <code class="literal">qmake</code> on the Unix platforms.</p><p class="calibre9">Now, we can get into the DEB packaging part by performing the following steps:</p><div class="calibre2"><ol class="orderedlist"><li class="listitem1">Change your working directory (current directory) to the root of the project, that is, <code class="literal">~/Internationalization</code>.</li><li class="listitem1">Create a new folder named <code class="literal">debian</code>.</li><li class="listitem1">Create the four required files in the <code class="literal">debian</code> folder: <code class="literal">control</code>, <code class="literal">copyright</code>, <code class="literal">changelog</code>, and <code class="literal">rules</code>, respectively. Then, create an optional <code class="literal">compat</code> file in the <code class="literal">debian</code> folder as well.</li></ol></div><p class="calibre9">The <code class="literal">control</code> file defines the most basic yet most critical things. This file is all about the source package and the binary package(s). The <code class="literal">control</code> file of our example is pasted here:</p><div class="calibre2"><pre class="programlisting">Source: internationalization
Section: misc
Priority: extra
Maintainer: Symeon Huang &lt;hzwhuang@gmail.com&gt;
Build-Depends: debhelper (&gt;=9),
               qt5-qmake,
               qtbase5-dev,
               qtbase5-private-dev
Standards-Version: 3.9.6

Package: internationalization
Architecture: any
Depends: ${shlibs:Depends}, ${misc:Depends}
Description: An example of Qt5 Blueprints</pre></div><p class="calibre9">The <a id="id448" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>first paragraph is to control information for a<a id="id449" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> source, whereas each of the following sets describe a binary package that the source tree builds. In other words, one source package may build several binary packages. In this case, we build only one binary package whose name is the same as <code class="literal">Source</code> and <code class="literal">internationalization</code>.</p><p class="calibre9">In the <code class="literal">Source</code> paragraph, <code class="literal">Source</code> and <code class="literal">Maintainer</code> are mandatory while <code class="literal">Section</code>, <code class="literal">Priority</code>, and <code class="literal">Standards-Version</code> are recommended. <code class="literal">Source</code> identifies the source package name, which can't include uppercase letters. Meanwhile, <code class="literal">Maintainer</code> contains the maintainer package's name and the e-mail address in the RFC822 format. The <code class="literal">Section</code> field specifies an application area in which the package has been classified. <code class="literal">Priority</code> is a self-explanatory field, indicating how important this package is. Lastly, <code class="literal">Standards-Version</code> describes the most recent version of the standards with which the package complies. In most cases, you should use the latest standard version, 3.9.6 for now. There are other fields that may be useful but optional. For more details, refer to <a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="https://www.debian.org/doc/debian-policy/ch-controlfields.html">https://www.debian.org/doc/debian-policy/ch-controlfields.html</a>.</p><p class="calibre9">You can specify certain packages needed for building in <code class="literal">Build-Depends</code>, similar to <code class="literal">qt5-qmake</code> and <code class="literal">qtbase5-dev</code> in our example. They're only defined for building processes and won't be included in the dependencies of binary packages.</p><p class="calibre9">The binary paragraphs are similar to the source except that there is no <code class="literal">Maintainer</code>, but <code class="literal">Architecture</code> and <code class="literal">Description</code> are mandatory now. For binary packages, <code class="literal">Architecture</code> can be any particular architecture or simply <code class="literal">any</code> or <code class="literal">all</code>. Specifying <code class="literal">any</code> indicates that the source package isn't dependent on any particular architecture and hence can be built on any architecture. In contrast to this, <code class="literal">all</code> means that the source package will produce only architecture-independent packages, such as documentations and scripts.</p><p class="calibre9">In <code class="literal">Depends</code> of the binary paragraph, we put <code class="literal">${shlibs:Depends}, ${misc:Depends}</code> instead of particular packages. The <code class="literal">${shlibs:Depends}</code> line can be used to let <code class="literal">dpkg-shlibdeps</code> generate shared library dependencies automatically. On the other hand, according to <code class="literal">debhepler</code>, you're encouraged to put <code class="literal">${misc:Depends}</code> in the field to supplement <code class="literal">${shlibs:Depends}</code>. In this way, we don't need to specify the dependencies manually, which is a relief for packagers.</p><p class="calibre9">The second required file, <code class="literal">copyright</code>, is to describe the licenses of the source as well as the DEB packages. In the <code class="literal">copyright</code> file, the format field is required while the others are optional. For more details about the formats of copyright, refer to <a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="https://www.debian.org/doc/packaging-manuals/copyright-format/1.0/">https://www.debian.org/doc/packaging-manuals/copyright-format/1.0/</a>. The <code class="literal">copyright</code> file in this example is shown as follows:</p><div class="calibre2"><pre class="programlisting">Format: http://www.debian.org/doc/packaging-manuals/copyright-format/1.0/
Upstream-Contact: Symeon Huang &lt;hzwhuang@gmail.com&gt;

File: *
Copyright: 2014, 2015 Symeon Huang
License: Packt

License: Packt
  This package is released under Packt license.</pre></div><p class="calibre9">The<a id="id450" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> first paragraph is called <span class="strong"><strong class="calibre10">Header paragraph</strong></span>, which <a id="id451" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>is needed once and only once. The <code class="literal">Format</code> line<a id="id452" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> is the only mandatory field in this paragraph, and in most cases, this line is the same. The syntax of the <code class="literal">Upstream-Contact</code> field is the same as <code class="literal">Maintainer</code> in the <code class="literal">control</code> file.</p><p class="calibre9">The second <a id="id453" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>paragraph in this file is <span class="strong"><strong class="calibre10">Files paragraph</strong></span>, which is mandatory and repeatable. In these paragraphs, <code class="literal">File</code>, <code class="literal">Copyright</code>, and <code class="literal">License</code> are required. We use an asterisk sign (<code class="literal">*</code>) indicating that this paragraph applies to all files. The <code class="literal">Copyright</code> field may contain the original statement copied from files or a shortened text. The <code class="literal">License</code> field in a <code class="literal">Files</code> paragraph describes the licensing terms for the files defined by <code class="literal">File</code>.</p><p class="calibre9">Following the Files paragraph, the <span class="strong"><strong class="calibre10">Stand-alone license paragraph</strong></span> is optional and repeatable. We<a id="id454" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> have to provide the full license text if the license is not provided by Debian. Generally speaking, only commonly-seen open-source licenses are provided. The first line must be a single license short name, which is then followed by a license text. For a license text, there must be a two space indentation in each line's head.</p><p class="calibre9">Don't be misled by the <code class="literal">changelog</code> filename. This file also has a special format and is used by <code class="literal">dpkg</code> to obtain the version number, revision, distribution, and urgency of your package. It's a good practice to document all the changes you have made in this file. However, you can just list the most important ones if you have a version control system. The <code class="literal">changelog</code> file in our example has the following contents:</p><div class="calibre2"><pre class="programlisting">internationalization (1.0.0-1) unstable; urgency=low

  * Initial release

 -- Symeon Huang &lt;hzwhuang@gmail.com&gt;  Mon, 29 Dec 2014 18:45:31 +0000</pre></div><p class="calibre9">The first line is the package name, version, distribution, and urgency. The name must match the source package name. In this example, <code class="literal">internationalization</code> is the name, <code class="literal">1.0.0-1</code> is the version, <code class="literal">unstable</code> stands for the distribution, and <code class="literal">urgency</code> is <code class="literal">low</code>. Then, use an empty line to separate the first line and log entries. In the log entries, all the changes that you want to document should be listed. For each entry, there are two spaces and an asterisk sign (<code class="literal">*</code>) in the header. The last part of a paragraph is a maintainer line that begins with a space. For more details about this file and its format, refer to <a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="https://www.debian.org/doc/debian-policy/ch-source.html#s-dpkgchangelog">https://www.debian.org/doc/debian-policy/ch-source.html#s-dpkgchangelog</a>.</p><p class="calibre9">Now, we<a id="id455" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> need to take a look at what <code class="literal">dpkg-buildpackage</code> will<a id="id456" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> do to create the package. This process is controlled by the <code class="literal">rules</code> file; the example is pasted here:</p><div class="calibre2"><pre class="programlisting">#!/usr/bin/make -f

export QT_SELECT := qt5

%:
  dh $@

override_dh_auto_configure:
  qmake</pre></div><p class="calibre9">This file, similar to <code class="literal">Makefile</code>, consists of several rules. Also, each rule begins with its target declaration, while the recipes are the following lines beginning with the TAB code (not four spaces). We explicitly set Qt 5 as the Qt version, which can avoid some issues when Qt 5 coexists with Qt 4. The percentage sign (<code class="literal">%</code>) is a special target and means any targets, which just calls the <code class="literal">dh</code> program with the target name, while <code class="literal">dh</code> is just a wrapper script, which runs appropriate programs depending on its argument, the real target.</p><p class="calibre9">The rest of the lines are customizations for the <code class="literal">dh</code> command. For instance, <code class="literal">dh_auto_configure</code> will call <code class="literal">./configure</code> by default. In our case, we use <code class="literal">qmake</code> to generate <code class="literal">Makefile</code> instead of a configure script. Therefore, we override <code class="literal">dh_auto_configure</code> by adding the <code class="literal">override_dh_auto_configure</code> target with <code class="literal">qmake</code> as the recipe.</p><p class="calibre9">Although the <code class="literal">compat</code> file is optional, you'll get bombarded with warnings if you don't specify it. Currently, you should set its content to <code class="literal">9</code>, which can be done by the following single-line command:</p><div class="calibre2"><pre class="programlisting">
<span class="strong"><strong class="calibre10">echo 9 &gt; debian/compat</strong></span>
</pre></div><p class="calibre9">We can generate the binary DEB package now. The <code class="literal">-uc</code> argument stands for uncheck while <code class="literal">-us</code> stands for unsign. If you have a PKG key, you may need to sign the package so that users can trust the packages you've released. We don't need source packages, so the last argument, <code class="literal">-b</code>, indicates that only the binary packages will be built.</p><div class="calibre2"><pre class="programlisting">
<span class="strong"><strong class="calibre10">dpkg-buildpackage -uc -us -b</strong></span>
</pre></div><p class="calibre9">The automatically detected dependencies can be viewed in the <code class="literal">debian/</code> file, <code class="literal">internationalization.substvars</code>. This file's contents are pasted here:</p><div class="calibre2"><pre class="programlisting">shlibs:Depends=libc6 (&gt;= 2.13-28), libc6 (&gt;= 2.4), libgcc1 (&gt;= 1:4.4.0), libqt5core5a (&gt;= 5.0.2), libqt5gui5 (&gt;= 5.0.2), libqt5widgets5 (&gt;= 5.0.2), libstdc++6 (&gt;= 4.3.0)
misc:Depends=</pre></div><p class="calibre9">As we discussed earlier, the dependencies are generated by <code class="literal">shlibs</code> and <code class="literal">misc</code>. The biggest advantage is that these generated version numbers tend to be the smallest, which means the maximum backwards compatibility. As you can see, our <code class="literal">Internationalization</code> example can run on Qt 5.0.2.</p><p class="calibre9">If everything<a id="id457" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> goes well, you'd expect a DEB file in<a id="id458" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> an upper-level directory. However, you can only build the current architecture's binary package, <code class="literal">amd64</code>. If you want to build for <code class="literal">i386</code> natively, you need to install a 32-bit x86 Debian. For cross-compilation, refer to <a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="https://wiki.debian.org/CrossBuildPackagingGuidelines">https://wiki.debian.org/CrossBuildPackagingGuidelines</a> and <a class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2" href="https://wiki.ubuntu.com/CrossBuilding">https://wiki.ubuntu.com/CrossBuilding</a>.</p><p class="calibre9">Installing a local DEB file is easily done with the following single-line command:</p><div class="calibre2"><pre class="programlisting">
<span class="strong"><strong class="calibre10">sudo dpkg -i internationalization_1.0.0-1_amd64.deb</strong></span>
</pre></div><p class="calibre9">After installation, we can run our application by running <code class="literal">/opt/internationalization_demo/Internationalization</code>. It should run as expected and behave exactly the same as on Windows, as shown in the following screenshot:</p><div class="mediaobject"><img src="Images/4615OS_09_06.jpg" alt="Packaging Qt applications on Linux" class="calibre86"/></div></div></div>



  
<div id="sbo-rt-content" class="calibre1"><div class="calibre2" title="Deploying Qt applications on Android"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title2"><a id="ch09lvl1sec63" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Deploying Qt applications on Android</h1></div></div></div><p class="calibre9">The <code class="literal">internationalization</code> application requires a QM file to be loaded correctly. On Windows <a id="id459" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>and Linux, we choose to install them<a id="id460" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> alongside the target executable. However, this is not always a good approach, especially on Android. The path is more complicated than the desktop operating systems. Besides, we're building a Qt application instead of the Java application. Localization is definitely different from a plain Java application, as stated in the Android documentation. Hence, we're going to bundle all the resources into the <code class="literal">qrc</code> file, which will be built into the binary target:</p><div class="calibre2"><ol class="orderedlist"><li class="listitem1">Add a new file to project by right-clicking on the project, and then select <span class="strong"><strong class="calibre10">Add New…</strong></span>.</li><li class="listitem1">Navigate to <span class="strong"><strong class="calibre10">Qt</strong></span> | <span class="strong"><strong class="calibre10">Qt Resource File</strong></span> in the <span class="strong"><strong class="calibre10">New File</strong></span> dialog.</li><li class="listitem1">Name it <code class="literal">res</code> and click on <span class="strong"><strong class="calibre10">OK</strong></span>; Qt Creator will redirect you to edit <code class="literal">res.qrc</code>.</li><li class="listitem1">Navigate to <span class="strong"><strong class="calibre10">Add</strong></span> | <span class="strong"><strong class="calibre10">Add Prefix</strong></span> and change <span class="strong"><strong class="calibre10">Prefix</strong></span> to <code class="literal">/</code>.</li><li class="listitem1">Navigate to <span class="strong"><strong class="calibre10">Add</strong></span> | <span class="strong"><strong class="calibre10">Add Files</strong></span> and select the .<code class="literal">Internationalization_de.qm</code> file in the dialog.</li></ol></div><p class="calibre9">Now, we need to edit <code class="literal">mainwindow.cpp</code> to make it load the translation file from <code class="literal">Resources</code>. We only need to change the constructor of <code class="literal">MainWindow</code> where we load the translation, as shown here:</p><div class="calibre2"><pre class="programlisting">MainWindow::MainWindow(QWidget *parent) :
  QMainWindow(parent),
  ui(new Ui::MainWindow)
{
  ui-&gt;setupUi(this);

  deTranslator = new QTranslator(this);
<span class="strong"><strong class="calibre10">  deTranslator-&gt;load(QLocale::German, "Internationalization", "_", ":/");</strong></span>
  deLoaded = false;

  connect(ui-&gt;openButton, &amp;QPushButton::clicked, this, &amp;MainWindow::onOpenButtonClicked);
  connect(ui-&gt;loadButton, &amp;QPushButton::clicked, this, &amp;MainWindow::onLoadButtonClicked);
}</pre></div><p class="calibre9">The <a id="id461" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>preceding code is to specify the directory for the <code class="literal">QTranslator::load</code> function. As we mentioned in the previous chapter, <code class="literal">:/</code> indicates <a id="id462" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>that it's a <code class="literal">qrc</code> path. Don't add a <code class="literal">qrc</code> prefix unless it's a <code class="literal">QUrl</code> object.</p><p class="calibre9">We can remove the <code class="literal">qmfile</code> install set from the project file now, because we've already bundled the QM file. In other words, after this change, you don't need to ship the QM file on Windows or Linux anymore. Edit the project file, <code class="literal">Internationalization.pro</code>, as shown in the following code:</p><div class="calibre2"><pre class="programlisting">QT       += core gui

greaterThan(QT_MAJOR_VERSION, 4): QT += widgets

TARGET = Internationalization
TEMPLATE = app


SOURCES += main.cpp \
           mainwindow.cpp

HEADERS  += mainwindow.h

FORMS    += mainwindow.ui

TRANSLATIONS = Internationalization_de.ts

unix: {
    target.path  = /opt/internationalization_demo

    INSTALLS += target
}

RESOURCES += \
    res.qrc</pre></div><p class="calibre9">Now, switch<a id="id463" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> to <span class="strong"><strong class="calibre10">Projects</strong></span> mode and add the <span class="strong"><strong class="calibre10">Android</strong></span> kit. Don't<a id="id464" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> forget to switch the build to <code class="literal">release</code>. In <span class="strong"><strong class="calibre10">Projects</strong></span> mode, you can modify how Qt Creator should build the Android APK package. There is an entry in <span class="strong"><strong class="calibre10">Build Steps</strong></span> called <span class="strong"><strong class="calibre10">Build Android APK</strong></span>, as shown in the following screenshot:</p><div class="mediaobject"><img src="Images/4615OS_09_07.jpg" alt="Deploying Qt applications on Android" class="calibre87"/></div><p class="calibre9">Here, you can specify the Android API level and your certificate. By default, <span class="strong"><strong class="calibre10">Qt Deployment</strong></span> is set to <span class="strong"><strong class="calibre10">Bundle Qt libraries in APK</strong></span>, which creates a redistributable APK file. Let's click on the <span class="strong"><strong class="calibre10">Create Templates</strong></span> button to generate a manifest file, <code class="literal">AndroidManifest.xml</code>. Normally, you just click on the <span class="strong"><strong class="calibre10">Finish</strong></span> button on the pop-up dialog, and then Qt Creator will redirect you back to the <span class="strong"><strong class="calibre10">Edit</strong></span> mode with <code class="literal">AndroidManifest.xml</code> open in the editing area, as shown here:</p><div class="mediaobject"><img src="Images/4615OS_09_08.jpg" alt="Deploying Qt applications on Android" class="calibre88"/></div><p class="calibre9">Let's make <a id="id465" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>a few changes to this manifest file by<a id="id466" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> performing the following steps:</p><div class="calibre2"><ol class="orderedlist"><li class="listitem1">Change <span class="strong"><strong class="calibre10">Package name</strong></span> to <code class="literal">com.demo.internationalization</code>.</li><li class="listitem1">Change <span class="strong"><strong class="calibre10">Minimum required SDK</strong></span> to <code class="literal">API 14: Android 4.0, 4.0.1, 4.0.2</code>.</li><li class="listitem1">Change <span class="strong"><strong class="calibre10">Target SDK</strong></span> to <code class="literal">API 19: Android 4.4</code>.</li><li class="listitem1">Save the changes.</li></ol></div><p class="calibre9">Different API levels have an impact on compatibility and the UI; you have to decide the levels carefully. In this case, we require at least Android 4.0 to run this application, which we're going to it for Android 4.4. Generally speaking, the higher the API level, the better the overall performance is. The <code class="literal">Internationalization.pro</code> project file is automatically changed as well.</p><div class="calibre2"><pre class="programlisting">QT       += core gui

greaterThan(QT_MAJOR_VERSION, 4): QT += widgets

TARGET = Internationalization
TEMPLATE = app


SOURCES += main.cpp \
           mainwindow.cpp

HEADERS  += mainwindow.h

FORMS    += mainwindow.ui

TRANSLATIONS = Internationalization_de.ts

unix: {
    target.path  = /opt/internationalization_demo

    INSTALLS += target
}

RESOURCES += \
res.qrc

<span class="strong"><strong class="calibre10">DISTFILES += \</strong></span>
<span class="strong"><strong class="calibre10">    android/gradle/wrapper/gradle-wrapper.jar \</strong></span>
<span class="strong"><strong class="calibre10">    android/AndroidManifest.xml \</strong></span>
<span class="strong"><strong class="calibre10">    android/res/values/libs.xml \</strong></span>
<span class="strong"><strong class="calibre10">    android/build.gradle \</strong></span>
<span class="strong"><strong class="calibre10">    android/gradle/wrapper/gradle-wrapper.properties \</strong></span>
<span class="strong"><strong class="calibre10">    android/gradlew \</strong></span>
<span class="strong"><strong class="calibre10">    android/gradlew.bat</strong></span>

<span class="strong"><strong class="calibre10">ANDROID_PACKAGE_SOURCE_DIR = $$PWD/android</strong></span>
</pre></div><p class="calibre9">Now, build <a id="id467" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>a <code class="literal">release</code> build. The APK file is created<a id="id468" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/> in <code class="literal">android-build/bin</code> inside the project build directory. The APK filename is <code class="literal">QtApp-release.apk</code> or <code class="literal">QtApp-debug.apk</code> if you don't set your certificate. If you're going to submit your application to Google Play or any other Android markets, you have to set your certificate and upload <code class="literal">QtApp-release.apk</code> instead of <code class="literal">QtApp-debug.apk</code>. Meanwhile, <code class="literal">QtApp-debug.apk</code> can be used on your own devices to test the functionality of your application.</p><p class="calibre9">The screenshot of <code class="literal">Internationalization</code> running on HTC One is shown as follows:</p><div class="mediaobject"><img src="Images/4615OS_09_09.jpg" alt="Deploying Qt applications on Android" class="calibre71"/></div><p class="calibre9">As you <a id="id469" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>can see, the German translation is loaded <a id="id470" class="calibre4 pcalibre3 pcalibre pcalibre1 pcalibre2"/>as expected, while the pop-up dialog has a native look and feel.</p></div></div>



  
<div id="sbo-rt-content" class="calibre1"><div class="calibre2" title="Summary"><div class="titlepage"><div class="calibre2"><div class="calibre2"><h1 class="title2"><a id="ch09lvl1sec64" class="calibre7 pcalibre pcalibre3 pcalibre2 pcalibre1"/>Summary</h1></div></div></div><p class="calibre9">In this chapter, we compared the advantages and disadvantages of static and dynamic linking. Later on, we used an example application, showing you how to create an installer on Windows and how to package it as a DEB package on Debian Linux. Last but not least, we also learned how to create a redistributable APK file for Android. The slogan, <span class="strong"><em class="calibre14">code less, create more, deploy everywhere</em></span> is now fulfilled.</p><p class="calibre9">In the next chapter, which is also the last chapter of this book, in addition to how to debug applications, we're also going to look at some common issues and solutions to them.</p></div></div>



  </body></html>