<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch06"/>Chapter 6. NPCs and Dialog</h1></div></div></div><p>By now, you already have a player character by default that interacts with battles on the field, but the game is in dire need of <a id="id347" class="indexterm"/><strong>non-player characters</strong> (<strong>NPCs</strong>).</p><p>In this chapter, you will create an NPC that will act as an information hub and shop owner. Since we have not yet given useable items and equipment to the character, or a reason for the character to have gold, the next logical step is to create a shop owner who will play the role of an NPC by talking to the player and offering the player business transactions when the player decides to interact with the NPC.</p><p>We will cover the following topics in this chapter:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Creating the NPC Character Blueprint</li><li class="listitem" style="list-style-type: disc">Interacting with the NPC</li><li class="listitem" style="list-style-type: disc">Dialog box setup</li><li class="listitem" style="list-style-type: disc">Creating an NPC welcome box</li><li class="listitem" style="list-style-type: disc">Adding an NPC talk box</li></ul></div><div><div><div><div><h1 class="title"><a id="ch06lvl1sec41"/>Creating the NPC Character Blueprint</h1></div></div></div><p>To get started, we <a id="id348" class="indexterm"/>will need to create a new Character Blueprint class. Since we already have a location for characters, navigate to the <code class="literal">character</code> folder located in your <strong>Content Browser</strong> under <strong>Content</strong> | <strong>Blueprints</strong> | <strong>Characters</strong> (create a new <code class="literal">character</code> folder in <code class="literal">content/blueprints</code> if one is not there already, just to stay more organized; you can even drag your <strong>FieldPlayer</strong> Blueprint into the <code class="literal">character</code> folder if you'd like), and add a new character by clicking on <strong>Add New</strong> | <strong>Blueprint Class</strong>:</p><div><img src="img/B04548_06_01.jpg" alt="Creating the NPC Character Blueprint"/></div><p>The <strong>Pick Parent Class</strong> window <a id="id349" class="indexterm"/>will pop up. This will allow you to pick a common parent class for your Blueprint class or create your own class:</p><div><img src="img/B04548_06_02.jpg" alt="Creating the NPC Character Blueprint"/></div><p>UE4 has a lot of <a id="id350" class="indexterm"/>common classes built in, which have a lot of the frameworks of several different types of classes already built for us. One of those classes is <strong>Character</strong> which allows us to work with a common character framework for use with any type of character pawn we want. So, from this window, select <strong>Character</strong>.</p><p>Once you have selected <strong>Character</strong>, a new Character Blueprint should now be in <strong>Content</strong> | <strong>Blueprints</strong> | <strong>Characters</strong>. Rename the character as <strong>NPC_ShopOwner</strong> since we will be using this character as the shop owner:</p><div><img src="img/B04548_06_03.jpg" alt="Creating the NPC Character Blueprint"/></div><p>From here, open <strong>NPC_ShopOwner</strong> to <a id="id351" class="indexterm"/>enter the viewport of your new character:</p><div><img src="img/B04548_06_04.jpg" alt="Creating the NPC Character Blueprint"/></div><p>You should see that, as mentioned earlier, this class inherits <code class="literal">Character.h</code> which already has a framework for a lot of components. This will now make it easy for us to make a visible NPC. Within the <strong>Components</strong> panel, you will see <strong>CapsuleComponent</strong>, which holds inherited data such as <strong>ArrowComponent</strong> that determines which way the object is pointing, and <strong>Mesh</strong>, which holds an instance of a skeletal mesh.</p><p>Let us first apply a <a id="id352" class="indexterm"/>mesh and animations to our <strong>Mesh</strong> component. Since we are not creating character models and animations in this book, we can simply use built-in assets. First, click on <strong>Mesh</strong> within <strong>Components</strong> | <strong>CapsuleComponent</strong>:</p><div><img src="img/B04548_06_05.jpg" alt="Creating the NPC Character Blueprint"/></div><p>From here, you will notice that your <strong>Details</strong> panel changes in order to display the <strong>Mesh</strong> variable and its components. For now, we will want to keep most of the defaults here since the character has everything we would want out of an NPC. However, the character does not have a mesh, so let's give it one by navigating to <strong>Details</strong> | <strong>Mesh</strong> and, in <strong>Skeletal Mesh</strong>, selecting the <strong>None</strong> drop-down menu that would house a skeletal mesh. Then, you should see all the skeletal meshes available in our project. In our game, there is a skeletal mesh called <strong>SK_Mannequin</strong>, we will select this as our skeletal mesh:</p><div><img src="img/B04548_06_06.jpg" alt="Creating the NPC Character Blueprint"/></div><p>Now that we have <a id="id353" class="indexterm"/>selected a skeletal mesh, you should see it displayed in your viewport. At this point, you may notice that your skeletal mesh is much higher than the bottom of the capsule because the skeletal mesh's origin is at its feet and is attached to the origin of the capsule that is located in the middle of the capsule. There are a lot of ways to fix this problem, but the quickest way would be to reposition the character manually by bringing the character down on the <em>Z</em> axis. A value of <strong>-90</strong> for <strong>Z Location</strong> seems to work perfectly in this example:</p><div><img src="img/B04548_06_07.jpg" alt="Creating the NPC Character Blueprint"/></div><p>You will also want the<a id="id354" class="indexterm"/> character to be facing the right way. You can see that the character is faced the wrong way because the arrow component is pointing perpendicular to the way the character is facing. Simply adjust the character rotation on the <em>Z</em> axis. A value of <strong>-90</strong> for <strong>Z Rotation</strong> seems to do the trick:</p><div><img src="img/B04548_06_08.jpg" alt="Creating the NPC Character Blueprint"/></div><p>Lastly, we need to <a id="id355" class="indexterm"/>get the character out of the relaxed pose. So navigate to <strong>Details</strong> | <strong>Animation</strong> and select the <strong>Anim Class</strong> drop-down menu. In this drop-down menu, select <strong>ThirdPerson_AnimBP</strong>, which is the animation class for the character we selected. If you are using another character with a different animation class, be sure to select the animation class that is built for your character:</p><div><img src="img/B04548_06_09.jpg" alt="Creating the NPC Character Blueprint"/></div><p>We also need a way <a id="id356" class="indexterm"/>to interact with this character. For this, we are going to create a volume that expands a certain distance in front of the character; this will be the area in which the player is able to interact with the NPC. To do this, we will need to add another component to <strong>CapsuleComponent</strong>. Navigate to the <strong>Components</strong> panel and select <strong>Add Component</strong> | <strong>Collision</strong> | <strong>Box Collision</strong>:</p><div><img src="img/B04548_06_10.jpg" alt="Creating the NPC Character Blueprint"/></div><p>This creates a box <a id="id357" class="indexterm"/>collision at the character's origin:</p><div><img src="img/B04548_06_11.jpg" alt="Creating the NPC Character Blueprint"/></div><p>We are going to use <a id="id358" class="indexterm"/>this collision by calculating whether the player is inside the box or outside the box. If they are in the box, the player will be able to interact with the NPC; if the player is outside the box, the player will not be able to interact with the NPC. Since we want to make this as realistic as possible, the player should only interact with the NPC if the character is standing in front of the NPC. So adjust the location and scale of the box until it is in front of the character and sized such that the player can easily walk a forgivable distance in front of the NPC to interact with it. </p><p>For this character, I will edit the <strong>Location X</strong> value to be <strong>60</strong>, <strong>Scale X</strong> value to be <strong>2</strong>, <strong>Scale Y</strong> value to be <strong>2</strong>, and <strong>Scale Z</strong> value to be <strong>3</strong>:</p><div><img src="img/B04548_06_12.jpg" alt="Creating the NPC Character Blueprint"/></div><p>Finally, we want to <a id="id359" class="indexterm"/>give the collision box a type that does not block the player, but allows the player to enter the collision box. Navigate to <strong>Details</strong> | <strong>Collision</strong> and under <strong>Collision Presets</strong>, select <strong>Trigger</strong>:</p><div><img src="img/B04548_06_13.jpg" alt="Creating the NPC Character Blueprint"/></div><p>This will essentially turn the collision box into a trigger volume that can be used to trigger events such <a id="id360" class="indexterm"/>as dialog and shop menus.</p><p>At this point, you can drag and drop your <strong>NPC_ShopOwner</strong> into your level:</p><div><img src="img/B04548_06_14.jpg" alt="Creating the NPC Character Blueprint"/></div><p>If you playtest this, you should notice that you will collide with the skeletal mesh, but you will not collide with the trigger volume. You are now ready to create Blueprints to make this NPC interactive.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec42"/>Interacting with the NPC</h1></div></div></div><p>Now that <a id="id361" class="indexterm"/>you have made the NPC and volume that will trigger interaction with the NPC, it is time to program interaction with the NPC by using the trigger volume.</p><p>Let us first think about the logic. What we will want to do is only allow the player to interact with the NPC if the player is within the NPC's line of sight (in this case, the trigger volume). If the player is not within the trigger volume, we do not want to allow the player to interact with the NPC. In this case, we will need some sort of Boolean that will return <em>true</em> if the player is in the trigger volume and <em>false</em> if the character is not within the trigger volume. We also want to allow the player to press a key to interact with the NPC, but only when the Boolean we create is set to true, since the Boolean we create to keep track of the NPC trigger volume may span across multiple classes. Just like in the previous chapters, let's declare that global variable in <code class="literal">RPGGameInstance.h</code>. We will put the variable in the same <code class="literal">Game Data</code> category that our other global variables are in, but this time, instead of only allowing the Blueprint to read the variable, we need to allow Blueprint to write the variable since we will be switching the variable between true and false. We will add a Boolean called <code class="literal">TalkShop</code> as one of our public variables:</p><div><pre class="programlisting">UPROPERTY( EditDefaultsOnly, BlueprintReadWrite, Category = "Game Data" )
bool TalkShop;</pre></div><p>When you are finished editing <code class="literal">RPGGameInstance.h</code>, your header file should now look like the following:</p><div><pre class="programlisting">#pragma once

#include "Engine/GameInstance.h"
#include "GameCharacter.h"

#include "RPGGameInstance.generated.h"

/**
 * 
 */
UCLASS()
class RPG_API URPGGameInstance : public UGameInstance
{
  GENERATED_BODY()

  URPGGameInstance( const class FObjectInitializer&amp; ObjectInitializer );

public:
  UPROPERTY( EditDefaultsOnly, BlueprintReadOnly, Category = "Game Data" )
  TArray&lt;UGameCharacter*&gt; PartyMembers;

  UPROPERTY( EditDefaultsOnly, BlueprintReadWrite, Category = "Game Data" )
  bool TalkShop;

protected:
  bool isInitialized;

public:
  void Init();
  void PrepareReset();
};</pre></div><p>Compile the code <a id="id362" class="indexterm"/>and then head into the <strong>NPC_ShopOwner</strong> Character Blueprint. Select the <strong>Box</strong> component in the <strong>Components</strong> panel, and within the <strong>Details</strong> panel, scroll down to <strong>Events</strong>. You will notice that there are many different types of events that can be created here based around how the box is interacted with:</p><div><img src="img/B04548_06_15.jpg" alt="Interacting with the NPC"/></div><p>We are most<a id="id363" class="indexterm"/> interested in <strong>On Component Begin Overlap</strong> and <strong>On Component End Overlap</strong> because these are the events that will trigger if something either intersects the box or does not intersect the box. Let us first work on triggering an event if the player intersects the box. So, within <strong>Details</strong> | <strong>Events</strong> | <strong>On Component Begin Overlap</strong>, select <strong>+</strong>. This will automatically open <strong>Event Graph</strong> and create an <strong>OnComponentBeginOverlap</strong> event:</p><div><img src="img/B04548_06_16.jpg" alt="Interacting with the NPC"/></div><p>All we will need <a id="id364" class="indexterm"/>to do here is simply set the <code class="literal">TalkShop</code> Boolean that we created previously to <code class="literal">true</code> if the player intersects the box. To do so, first cast to the <strong>FieldPlayer</strong> using <strong>Cast To FieldPlayer</strong> located under <strong>Utilities</strong> | <strong>Casting</strong> and set the interaction component to the <strong>FieldPlayer</strong> object by linking the <strong>OtherActor</strong> pin within <strong>OnComponentBeginOverlap</strong> to the <strong>Object</strong> pin within the <strong>Cast To FieldPlayer</strong> node:</p><div><img src="img/B04548_06_17.jpg" alt="Interacting with the NPC"/></div><p>From here, we <a id="id365" class="indexterm"/>have <strong>FieldPlayer</strong> triggering a cast to <strong>RPGGameInstance</strong> using the <strong>Cast To RPGGameInstance</strong> node located under <strong>Utilities</strong> | <strong>Casting</strong>, whose <strong>Object</strong> pin is <strong>Get Game Instance</strong> since the <code class="literal">TalkShop</code> variable is located within <strong>RPGGameInstance</strong>:</p><div><img src="img/B04548_06_18.jpg" alt="Interacting with the NPC"/></div><p>Lastly, create a <strong>Set Talk Shop</strong> action <a id="id366" class="indexterm"/>by unchecking <strong>Context Sensitive</strong>, navigating to <strong>Class</strong> | <strong>RPGGameInstance</strong>, and selecting <strong>Set Talk Shop</strong>:</p><div><img src="img/B04548_06_19.jpg" alt="Interacting with the NPC"/></div><p>Have <strong>Cast To RPGGameInstance</strong> trigger the <strong>Set Talk Shop</strong> action and be sure that we are referencing the <code class="literal">TalkShop</code> variable within <strong>RPGGameInstance</strong> by linking the <strong>As RPGGameInstance</strong> pin from <strong>Cast To RPGGameInstance</strong> to the <strong>Target</strong> pin from <strong>Set Talk Shop</strong>. Also, be sure to set the <code class="literal">TalkShop</code> variable to <code class="literal">true</code> by checking the <strong>Talk Shop</strong> Boolean within the <strong>Set Talk Shop</strong> node. When you are finished, your Blueprint should look like the following screenshot:</p><div><img src="img/B04548_06_20.jpg" alt="Interacting with the NPC"/></div><p>Now that we are <a id="id367" class="indexterm"/>finished creating the <strong>Begin Overlap</strong> event, let us create our player/key interaction and check whether or not the <strong>Talk Shop</strong> Boolean is true or false. Since the player controller won't have direct access to <strong>NPC_ShopOwner</strong>, we will need to create the key interaction either within the Field Player class or the Level Blueprint class. Because the NPC is specifically part of this particular level and different levels will most likely house different NPCs, it would make the most sense for the key and Boolean check to be located within the Level Blueprint. So at this point, navigate to <strong>Blueprints</strong> | <strong>Open Level Blueprint</strong> to enter the Level Blueprint.</p><p>Within the Level Blueprint, we will create a key event to the letter <em>E</em> by navigating to <strong>Input</strong> | <strong>Key Events</strong> | <strong>E</strong>. Then, upon release of the <em>E</em> key (because we want the player to commit to the key press), trigger <strong>Cast To RPGGameInstance</strong> whose object is <strong>Get Game Instance</strong> because upon the key press, we will want to check the status of the <code class="literal">TalkShop</code> variable that is located within <strong>RPGGameInstance</strong>:</p><div><img src="img/B04548_06_21.jpg" alt="Interacting with the NPC"/></div><p>Reference <a id="id368" class="indexterm"/>the <code class="literal">TalkShop</code> variable by dragging out the <strong>As RPGGameInstance</strong> pin within <strong>Cast To RPGGameInstance</strong>, navigate to <strong>Variables</strong> | <strong>Game Data</strong> and then select <strong>Get Talk Shop</strong>, since we will be checking <strong>Talk Shop</strong>:</p><div><img src="img/B04548_06_22.jpg" alt="Interacting with the NPC"/></div><p>Now that we are referencing the <code class="literal">TalkShop</code> variable, we can check the condition of <strong>Talk Shop</strong> by creating a <strong>Branch</strong> statement located under <strong>Utilities</strong> | <strong>Flow Control</strong>:</p><div><img src="img/B04548_06_23.jpg" alt="Interacting with the NPC"/></div><p>Link <a id="id369" class="indexterm"/>the <strong>Talk Shop</strong> pin to the <strong>Condition</strong> pin within the <strong>Branch</strong> node to check the condition of <code class="literal">TalkShop</code>, and have the <strong>Cast To RPGGameInstance</strong> activate <strong>Branch</strong>:</p><div><img src="img/B04548_06_24.jpg" alt="Interacting with the NPC"/></div><p>Now that we have this framework set up, we can do something if the <code class="literal">TalkShop</code> condition is true or false. For now, we will just run a test by printing some text to the screen by navigating to <strong>Utilities</strong> | <strong>Text</strong> | <strong>Print Text</strong>, which will create a <strong>Print Text</strong> function. Link the <strong>True</strong> pin from the <strong>Branch</strong> node to the <strong>In</strong> pin of <strong>Print Text</strong>. When you are finished, your Level Blueprint should look like the following screenshot:</p><div><img src="img/B04548_06_25.jpg" alt="Interacting with the NPC"/></div><p>If you <a id="id370" class="indexterm"/>test this now, you should notice that if the player presses the <em>E</em> key outside the NPC trigger volume, nothing will happen; however, if the player presses <em>E</em> when they are within the trigger volume, text will appear on the screen. However, if we exit the volume and continue to press <em>E</em>, the text will continue to appear on the screen. This is because we are never setting the <code class="literal">TalkShop</code> Boolean back to <code class="literal">false</code>. Doing this is very simple. Navigate back to <strong>NPC_ShopOwner</strong> and select <strong>+</strong> under <strong>Details</strong> | <strong>On Component End Overlap</strong> to create an <strong>OnComponentEndOverlap</strong> event:</p><div><img src="img/B04548_06_26.jpg" alt="Interacting with the NPC"/></div><p>Since we have<a id="id371" class="indexterm"/> already created a reference to <strong>Talk Shop</strong> when creating the <strong>OnComponentBeginOverlap</strong> event, and set that reference to true, we can simply make the <strong>OnComponentEndOverlap</strong> event that does the exact same thing as the <strong>OnComponentBeginOverlap</strong>; however, instead of setting <code class="literal">TalkShop</code> to <code class="literal">true</code>, set <code class="literal">TalkShop</code> to <code class="literal">false</code> by <a id="id372" class="indexterm"/>making sure the <strong>Talk Shop</strong> pin within the <strong>Set Talk Shop</strong> node is unchecked. Your <strong>OnComponentEndOverlap</strong> event should now look like the following screenshot:</p><div><img src="img/B04548_06_27.jpg" alt="Interacting with the NPC"/></div><p>When you test this now, interaction with the NPC via the <em>E</em> key should only work if the player is intersecting the NPC's trigger volume as intended.</p></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec43"/>Dialog box setup</h1></div></div></div><p>We are <a id="id373" class="indexterm"/>now ready to create dialog that our NPC will state to the character. To do this, we will first create a Widget Blueprint that will be responsible for <a id="id374" class="indexterm"/>housing all parent variables of the NPC, such as the dialog in the game, so that we can simply pull dialog anytime we need it by calling the dialog variable within the function. This process will be better than the hardcoding text in UMG because it will allow us to need only a single dialog UMG that we will dynamically place text into.</p><p>So let's first create a new Widget Blueprint by navigating to <strong>Content Browser</strong> | <strong>Content</strong> | <strong>Blueprints</strong> | <strong>UI</strong> and then selecting <strong>Add New</strong> | <strong>User Interface</strong> | <strong>Widget Blueprint</strong>. Then, name it <strong>NPC_Parent</strong>:</p><div><img src="img/B04548_06_28.jpg" alt="Dialog box setup"/></div><p>Once<a id="id375" class="indexterm"/> created, open<a id="id376" class="indexterm"/> the new Widget Blueprint and then navigate to the graph. From here, head to the <strong>My Blueprint</strong> panel and select <strong>+</strong> to the right of <strong>Variables</strong>; this will create a new variable. Name this variable <strong>NPCDialog</strong> and make it public by clicking the eye to the right of the variable name:</p><div><img src="img/B04548_06_29.jpg" alt="Dialog box setup"/></div><p>In the <strong>Details</strong> panel, change <strong>Variable Type</strong> to <strong>Text</strong> since we will be using text to display dialog. Also, click on the square icon to the right of <strong>Variable Type</strong> to make the variable a text array:</p><div><img src="img/B04548_06_30.jpg" alt="Dialog box setup"/></div><p>Next, scroll <a id="id377" class="indexterm"/>down <a id="id378" class="indexterm"/>to the <strong>Default Value</strong> tab within the <strong>Details</strong> panel to the area that contains elements of an array. By default, it does not have elements:</p><div><img src="img/B04548_06_31.jpg" alt="Dialog box setup"/></div><p>In <strong>Details</strong> | <strong>Default Value</strong>, click on <strong>+</strong> next to <strong>elements</strong> to add an element that will create a text box next <a id="id379" class="indexterm"/>to the element <strong>0</strong>. Put a value in this element by writing some text. You can write any form <a id="id380" class="indexterm"/>of text you want here; since at one point I plan to have the NPC give the player information, I will make the dialog say <em>You can check out your Character Status by pressing P when you are outside of battle</em>:</p><div><img src="img/B04548_06_32.jpg" alt="Dialog box setup"/></div><p>Since our NPC is <a id="id381" class="indexterm"/>a shop owner, they can greet us, for example, by saying <em>Greetings. I am Roy, the shop owner, what can I do for you?</em> You can add this text as a second element in the <strong>NPCDialog</strong> array:</p><div><img src="img/B04548_06_33.jpg" alt="Dialog box setup"/></div><p>Whenever we need<a id="id382" class="indexterm"/> a new NPC variable that we may not want hardcoded, we can go back to this Widget Blueprint and add dialog like we did just now. Next, we can<a id="id383" class="indexterm"/> create the actual dialog for our NPC by navigating back to our <strong>Content Browser</strong>. Since we may end up having many different characters using the same dialog box just with different text in it, we may want to create another Widget Blueprint that just has a basic window and a button to exit the dialog box. In <strong>Content Browser</strong>, navigate to <strong>Content</strong> | <strong>Blueprints</strong> | <strong>UI</strong> and then select <strong>Add New</strong> | <strong>User Interface</strong> | <strong>Widget Blueprint</strong>. Then, name it <strong>DialogBox</strong>:</p><div><img src="img/B04548_06_34.jpg" alt="Dialog box setup"/></div><p>Open the new <a id="id384" class="indexterm"/>Widget Blueprint. From here, navigate to <strong>File</strong> | <strong>Reparent Blueprint</strong> and reparent it to <strong>NPC_Parent</strong>, which holds all our variables:</p><div><img src="img/B04548_06_35.jpg" alt="Dialog box setup"/></div><p>Since dialog boxes<a id="id385" class="indexterm"/> are rarely the size of the entire screen, we are going to create a Canvas Panel within our default Canvas Panel by navigating to <strong>Panel</strong> | <strong>Canvas Panel</strong> and dragging the new Canvas Panel within the parent Canvas Panel:</p><div><img src="img/B04548_06_36.jpg" alt="Dialog box setup"/></div><p>Rename<a id="id386" class="indexterm"/> this <a id="id387" class="indexterm"/>new Canvas Panel <strong>CanvasPanel_DialogBox</strong>. Also, anchor this Canvas Panel to the middle of the screen:</p><div><img src="img/B04548_06_37.jpg" alt="Dialog box setup"/></div><p>You may <a id="id388" class="indexterm"/>also <a id="id389" class="indexterm"/>want to resize the text box to hold a decent amount of text. I will resize this text box to have a <strong>Size X</strong> value of <strong>1024</strong> and <strong>Size Y</strong> value of <strong>512</strong>. You should also center the box by setting <strong>Position X</strong> to -1024/2 which is equal to <strong>-512</strong>, and <strong>Position Y</strong> to -512/2 which is equal to <strong>-256</strong>:</p><div><img src="img/B04548_06_38.jpg" alt="Dialog box setup"/></div><p>Within <strong>CanvasPanel_DialogBox</strong>, add an image from <strong>Palette</strong> | <strong>Common</strong> | <strong>Image</strong> that we can use to add a background color in a similar way to what we did for the pause menu:</p><div><img src="img/B04548_06_39.jpg" alt="Dialog box setup"/></div><p>In <a id="id390" class="indexterm"/>the <strong>Details</strong> panel, rename<a id="id391" class="indexterm"/> this image <strong>BGColor</strong> and position and resize it so that it is in the middle of the screen. This can easily be done by choosing a center anchor:</p><div><img src="img/B04548_06_40.jpg" alt="Dialog box setup"/></div><p>Resize and <a id="id392" class="indexterm"/>position <a id="id393" class="indexterm"/>this to be the same as the Canvas Panel, that is, the <strong>Size X</strong> value as <strong>1024</strong>, <strong>Size Y</strong> value as <strong>512</strong>, <strong>Position X</strong> value as <strong>-512</strong>, and <strong>Position Y</strong> value as <strong>256</strong>:</p><div><img src="img/B04548_06_41.jpg" alt="Dialog box setup"/></div><p>Lastly, under <strong>Details</strong> | <strong>Appearance</strong> | <strong>Color and Opacity</strong>, adjust <a id="id394" class="indexterm"/>the color to be the same as the other <a id="id395" class="indexterm"/>menus. In this case, we can select the color picker and pass in the linear hex value of <strong>267FFFFF</strong>:</p><div><img src="img/B04548_06_42.jpg" alt="Dialog box setup"/></div><p>Next, let us<a id="id396" class="indexterm"/> insert <a id="id397" class="indexterm"/>an exit button to leave this menu by selecting and dragging a button from <strong>Palette</strong> | <strong>Common</strong> | <strong>Button</strong> into <strong>CanvasPanel_DialogBox</strong>:</p><div><img src="img/B04548_06_43.jpg" alt="Dialog box setup"/></div><p>Rename this <a id="id398" class="indexterm"/>button <strong>Button_Exit</strong> and position it towards the right-hand side of your Canvas Panel by first changing the size of your button to match <a id="id399" class="indexterm"/>the size of the pause menu buttons, which have the <strong>Size X</strong> value as <strong>300</strong> and the <strong>Size Y</strong> value as <strong>100</strong>. Then, position the button in the bottom-right of the Canvas Panel, by changing the anchor to bottom-right aligned. Then, use simple positions such as the one that gives 20 pixels of padding, that is, <strong>Position X</strong> as <strong>-320</strong> and <strong>Position Y</strong> as <strong>-120</strong>. You will also notice that the button is behind <strong>BGColor</strong>; simply change the <strong>ZOrder</strong> value to <strong>1</strong>:</p><div><img src="img/B04548_06_44.jpg" alt="Dialog box setup"/></div><div><img src="img/B04548_06_45.jpg" alt="Dialog box setup"/></div><p>Now that you <a id="id400" class="indexterm"/>have a button <a id="id401" class="indexterm"/>created and positioned, add a Text Block to it. Rename the <a id="id402" class="indexterm"/>text <a id="id403" class="indexterm"/><strong>TextBlock_Exit</strong> and under <strong>Details</strong> | <strong>Appearance</strong> | <strong>Font</strong>, change the font size to <strong>48</strong>. Also, change the content of the Text Block to <strong>Exit</strong>:</p><div><img src="img/B04548_06_46.jpg" alt="Dialog box setup"/></div><p>Program <a id="id404" class="indexterm"/>the button<a id="id405" class="indexterm"/> to exit as well, just like you did in the previous menu creations, by selecting the button, scrolling down to <strong>OnClicked</strong> in <strong>Details</strong> | <strong>Events</strong>, and then clicking on the <strong>+</strong> button. This will open up <strong>Event Graph</strong> and populate the <strong>OnClicked</strong> event for the exit button. Drag out the <strong>Out</strong> pin from the <strong>OnClicked</strong> event and select <strong>Remove from Parent</strong> located under <strong>Widget</strong>:</p><div><img src="img/B04548_06_47.jpg" alt="Dialog box setup"/></div><p>Navigate <a id="id406" class="indexterm"/>back to <a id="id407" class="indexterm"/>the <strong>Designer</strong> view and add a Text Block to <strong>CanvasPanel_DialogBox</strong>, name it <strong>TextBlock_Dialog</strong>, and have it take up most of the Canvas Panel. For this, we can position the Text Block to have a padding of 20 pixels by giving <strong>Position X</strong> a value of <strong>20</strong> and <strong>Position Y</strong> a value of <strong>20</strong>. We can also set the size of the Text Block giving <strong>Size X</strong> a value of <strong>986</strong> and <strong>Size Y</strong> a value of <strong>300</strong>. Lastly, set the <strong>ZOrder</strong> value to <strong>1</strong>:</p><div><img src="img/B04548_06_48.jpg" alt="Dialog box setup"/></div><p>At this point, we<a id="id408" class="indexterm"/> are <a id="id409" class="indexterm"/>finished with creating the dialog box template. We can now move on to creating dialog boxes for our NPC.</p></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec44"/>Creating an NPC welcome box</h1></div></div></div><p>Now that we <a id="id410" class="indexterm"/>have a template for our dialog boxes, let's use them by creating custom dialog boxes for our NPC that are based on what we just created. To stay organized, we should make a separate folder for NPCs since we will most likely have a lot more UMG and opportunities to use our dialog box outside of the NPC creation. So within <strong>Content Browser</strong>, navigate to <strong>Content</strong> | <strong>Blueprints</strong> | <strong>UI</strong> and create a new folder under <strong>Add New</strong>. Name this folder <code class="literal">NPC</code> and then navigate into the folder. Create a duplicate of the <strong>DialogBox</strong> Widget Blueprint that you made in the previous section and move it into the <code class="literal">NPC</code> folder. Name the duplicated widget <strong>Shop_Welcome</strong>:</p><div><img src="img/B04548_06_50.jpg" alt="Creating an NPC welcome box"/></div><p>Open the <strong>Shop_Welcome</strong> widget <a id="id411" class="indexterm"/>and select the <strong>TextBlock_Dialog</strong> Text Block. In <strong>Details</strong> | <strong>Content</strong>, create a new text binding that will then open up the graph:</p><div><img src="img/B04548_06_51.jpg" alt="Creating an NPC welcome box"/></div><p>At this point, you can right click to find <strong>All Actions for this Blueprint</strong>, and under <strong>Variables</strong> | <strong>Default</strong>, you should find the <strong>Get NPCDialog</strong> variable which you can use:</p><div><img src="img/B04548_06_52.jpg" alt="Creating an NPC welcome box"/></div><p>From here, drag <a id="id412" class="indexterm"/>out the <strong>NPCDialog</strong> array pin and select the <strong>Get</strong> function under <strong>Utilities</strong> | <strong>Array</strong>:</p><div><img src="img/B04548_06_53.jpg" alt="Creating an NPC welcome box"/></div><p>From here, you <a id="id413" class="indexterm"/>can select any of the text that is in <strong>NPCDialog</strong> by choosing the right element. Since the welcome text is in element 1, change the <strong>0</strong> in the <strong>Get</strong> function to <strong>1</strong>. To have this text return to the Text Block, link <strong>GET</strong> to <strong>Return Value</strong> of <strong>ReturnNode</strong>:</p><div><img src="img/B04548_06_54.jpg" alt="Creating an NPC welcome box"/></div><p>Since this is the <a id="id414" class="indexterm"/>welcome dialog box, we will still allow the player to exit, but we should also allow them to get general details from the NPC or visit their shop. So let's copy the <strong>Exit</strong> button and put place holders for both talking and shopping. Navigate back to the <strong>Designer</strong> view and make two more buttons on the left-hand side of the <strong>Exit</strong> button, one that says <strong>Shop</strong> and one that says <strong>Talk</strong>. You don't have to program these buttons yet since we do not have a shop or talk UMG yet:</p><div><img src="img/B04548_06_55.jpg" alt="Creating an NPC welcome box"/></div><p>Next, make this <a id="id415" class="indexterm"/>screen appear at the proper time by opening the Level Blueprint that you started at the beginning of this chapter. Instead of printing text to the screen when the <strong>Talk Shop</strong> condition is true, link <strong>Create Widget</strong> under <strong>User Interface</strong> to <strong>True</strong>:</p><div><img src="img/B04548_06_56.jpg" alt="Creating an NPC welcome box"/></div><p>For the <a id="id416" class="indexterm"/>class, select <strong>Shop_Welcome</strong>:</p><div><img src="img/B04548_06_57.jpg" alt="Creating an NPC welcome box"/></div><p>Lastly, display this to<a id="id417" class="indexterm"/> the screen by linking the Return Value pin of <strong>Create Shop_Welcome Widget</strong> to <strong>Add to Viewport</strong>, which is located under <strong>User Interface</strong> | <strong>Viewport</strong>:</p><div><img src="img/B04548_06_58.jpg" alt="Creating an NPC welcome box"/></div><p>Also, give the player <a id="id418" class="indexterm"/>access to a mouse cursor by creating a <strong>Get Player Controller</strong> function under <strong>Game</strong> and linking its <strong>Return Value</strong> to <strong>Set Show Mouse Cursor</strong> located under <strong>Class</strong> | <strong>Player Controller</strong>. Finally, link the <strong>Add to Viewport</strong> node to the <strong>Set Show Mouse Cursor</strong> node and check <strong>Show Mouse Cursor</strong>. When you are finished, your Level Blueprint should look like the following screenshot:</p><div><img src="img/B04548_06_59.jpg" alt="Creating an NPC welcome box"/></div><p>If you playtest this now, you should be able to still go up to the NPC and press <em>E</em> to interact with him, but this time a dialog box will appear:</p><div><img src="img/B04548_06_60.jpg" alt="Creating an NPC welcome box"/></div><p>Congratulations, you <a id="id419" class="indexterm"/>have created your first dialog box. Now let us move on to making navigation buttons that open up other interactive widgets.</p></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec45"/>Adding an NPC talk box</h1></div></div></div><p>Now that you have<a id="id420" class="indexterm"/> already created a dialog box that pops up when the player interacts with the NPC, you can easily add dialog for the player to see when they click on the <strong>Talk</strong> button. Simply duplicate the <strong>DialogBox</strong> Widget Blueprint that you made previously and place it in the <code class="literal">NPC</code> folder under<strong> Content Browser</strong> located in <strong>Content</strong> | <strong>Blueprints</strong> | <strong>UI</strong>. Rename the duplicated Widget Blueprint <strong>Shop_Talk</strong>.</p><p>We will now add some proper dialog to this menu by opening the <strong>Shop_Talk</strong> Widget Blueprint. Then, within the <strong>Designer</strong> viewport, select the Text Block that is already placed into your Canvas Panel.</p><p>Once selected, navigate to <strong>Details</strong> | <strong>Content</strong> and, within <strong>Text</strong>, select <strong>Bind</strong> | <strong>+ Create Binding</strong>.</p><p>As always, this <a id="id421" class="indexterm"/>action will automatically bring you to the Graph Editor and set the <strong>Get Text</strong> function to return a null value from a <strong>Return</strong> node. The next steps are identical to the steps that you did when calling dialog from the <strong>NPCDialog</strong> variable in the previous sections. You must navigate to the <strong>My Blueprint</strong> tab and use the <strong>GET</strong> version of the <strong>NPCDialog</strong> variable.</p><p>Then, drag out the <strong>NPCDialog</strong> array pin and select the <strong>Get</strong> function under <strong>Utilities</strong> | <strong>Array</strong>. Lastly, have the <strong>GET</strong> function select the correct element of the <strong>NPCDialog</strong> array. In this case, we would keep element 0 selected since we set our dialog in element 0 earlier in this chapter. Once the proper dialog is chosen, link <strong>GET</strong> to <strong>Return Value</strong> of the <strong>ReturnNode</strong>. At this point, your Graph Editor should look like the following screenshot:</p><p> </p><div><img src="img/B04548_06_64.jpg" alt="Adding an NPC talk box"/></div><p>
</p><p>You are now finished with the <strong>Shop_Talk</strong> Widget Blueprint. You need to now bind it to the <strong>Talk</strong> button in the <strong>Shop_Welcome</strong> Widget Blueprint, so open the <strong>Designer</strong> view in <strong>Shop_Welcome</strong> and select the <strong>Talk</strong> button. In the <strong>Details</strong> panel, navigate to <strong>Events</strong> and press the <strong>+</strong> button next to <strong>OnClicked</strong>:</p><div><img src="img/B04548_06_65.jpg" alt="Adding an NPC talk box"/></div><p>This should now <a id="id422" class="indexterm"/>create an <strong>OnClicked</strong> event bound to your <strong>Talk</strong> button and the Event Graph should now have automatically opened. From here, what we need to do is upon the button being clicked, we need to close the <strong>Shop_Welcome</strong> Widget Blueprint and open the <strong>Shop_Talk</strong> Widget Blueprint. These steps should be very similar to what you did many times previously when you opened and closed Widget Blueprints after button presses. Link the <strong>OnClicked</strong> event to <strong>Remove from Parent</strong> located under <strong>Widget</strong>, which will close your current Widget Blueprint. Then, link the <strong>Create Widget</strong> node to <strong>Remove from Parent</strong>, which is located under <strong>User Interface</strong>. Change the class of <strong>Create Widget</strong> to <strong>Shop_Talk</strong> so that your <strong>Shop_Talk</strong> Widget Blueprint is generated. From here, link <strong>Add to Viewport</strong> to <strong>Return Value</strong> of the <strong>Create Shop_Talk Widget</strong> node that is located under <strong>User Interface</strong> | <strong>Viewport</strong>. Also, be sure <strong>Add to Viewport</strong> is linked to the out pin of <strong>Create Shop_Talk Widget</strong> so that the Widget Blueprint is displayed in the player's view only after the <strong>Shop_Talk</strong> widget is created. When you are finished, your <strong>EventGraph</strong> for your <strong>Talk</strong> button should look like the following screenshot:</p><div><img src="img/B04548_06_66.jpg" alt="Adding an NPC talk box"/></div><p>You may have <a id="id423" class="indexterm"/>noticed that the <strong>Talk</strong> button now works perfectly, but the text will get cut off:</p><div><img src="img/B04548_06_67.jpg" alt="Adding an NPC talk box"/></div><p>This is because we are not wrapping the text. To wrap the text, go back into the <strong>Shop_Talk</strong> Widget <a id="id424" class="indexterm"/>Blueprint and, in the <strong>Designer</strong> view, select the <strong>Dialog</strong> Text Block. Then, in the <strong>Details</strong> panel, navigate to <strong>Appearance</strong> and check <strong>Auto Text Wrap</strong>. This will ensure that the text is always wrapped around the content, which in this case will move the text to a new line when it hits the border of the Text Block. If you test the <strong>Talk</strong> button, the words should now wrap like this:</p><div><img src="img/B04548_06_68.jpg" alt="Adding an NPC talk box"/></div><p>At this point, you should have the interaction working perfectly between the player and the NPC with all buttons working properly, with the exception of the <strong>Shop</strong> button.</p></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec46"/>Summary</h1></div></div></div><p>In this chapter, we created an NPC that can communicate with the player through the use of a trigger volume and key binding. Now, we can display dialog from an array of strings at any point in our game. In the next chapter, we will transform our NPC into a shop owner and allow the player to purchase equipment from the shop.</p></div></body></html>