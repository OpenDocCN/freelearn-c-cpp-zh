<html><head></head><body><div class="chapter" title="Chapter&#xA0;5.&#xA0;Bridging Character Statistics"><div class="titlepage"><div><div><h1 class="title"><a id="ch05"/>Chapter 5. Bridging Character Statistics</h1></div></div></div><p>Now that we have a basic framework set up for our pause menu, we will now focus on the programming aspect of the pause menu.</p><p>In this chapter, you will learn how to link character statistics to the pause menu, as discussed in <a class="link" href="ch04.html" title="Chapter 4. Pause Menu Framework">Chapter 4</a>, <span class="emphasis"><em>Pause Menu Framework</em></span>. By the end of this chapter, you will be able to link any other game statistics you would like to a UMG menu or submenu. We will cover the following topics in this chapter:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Getting character data</li><li class="listitem" style="list-style-type: disc">Getting player instances</li><li class="listitem" style="list-style-type: disc">Displaying stats</li></ul></div><div class="section" title="Getting character data"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec37"/>Getting character data</h1></div></div></div><p>At this point, the <a id="id320" class="indexterm"/>pause menu is fully designed and ready for data integration. In <a class="link" href="ch03.html" title="Chapter 3. Exploration and Combat">Chapter 3</a>, <span class="emphasis"><em>Exploration and Combat</em></span>, we had developed means to display some player parameters, such as the player's name, HP, and MP into CombatUI through binding Text Blocks with the <span class="strong"><strong>Game Character</strong></span> variable in order to access character stat values held within <span class="strong"><strong>Character Info</strong></span>. We will do this in a very similar fashion, as we did in the previous chapter, by first opening the <span class="strong"><strong>Pause_Main</strong></span> widget and clicking on the Text Block that we will update with a value. </p><p>In this case, we have already designated locations for all our stat values, so we will start with the HP stat that we named <span class="strong"><strong>Editable_Soldier_HP</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_05_01.jpg" alt="Getting character data"/></div><p>Navigate<a id="id321" class="indexterm"/> to <span class="strong"><strong>Content</strong></span> | <span class="strong"><strong>Text</strong></span>, and click on the drop-down menu of <span class="strong"><strong>Bind</strong></span> next to the dropbox. Click on <span class="strong"><strong>Create Binding</strong></span> under the drop-down menu:</p><div class="mediaobject"><img src="graphics/B04548_05_02.jpg" alt="Getting character data"/></div><p>Once you <a id="id322" class="indexterm"/>have completed this process, a new function called <code class="literal">Get_Editable_Soldier_HP_Text_0</code> will be created, and you will automatically be pulled into the graph of the new function. Like in previous binds, the new function will also automatically have <span class="strong"><strong>FunctionEntry</strong></span> with its labeled return:</p><div class="mediaobject"><img src="graphics/B04548_05_03.jpg" alt="Getting character data"/></div><p>We can<a id="id323" class="indexterm"/> now create a new <span class="strong"><strong>Game Character</strong></span> reference variable that we will again name <span class="strong"><strong>Character Target</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_05_04.jpg" alt="Getting character data"/></div><p>Then, we<a id="id324" class="indexterm"/> will drag our <span class="strong"><strong>Character Target</strong></span> variable into the <code class="literal">Get_Editable_Soldier_HP_Text_0</code> graph and set it to <span class="strong"><strong>Get</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_05_05.jpg" alt="Getting character data"/></div><p>Next, we <a id="id325" class="indexterm"/>will create a new node named <span class="strong"><strong>Get HP</strong></span>, which is located under <span class="strong"><strong>Variables</strong></span> | <span class="strong"><strong>Character Info</strong></span>, and link its <span class="strong"><strong>Target</strong></span> pin to the <span class="strong"><strong>Character Target</strong></span> variable pin:</p><div class="mediaobject"><img src="graphics/B04548_05_06.jpg" alt="Getting character data"/></div><p>Lastly, link the HP stat in the <span class="strong"><strong>Get Editable Soldier HP Text 0</strong></span> node to the <span class="strong"><strong>Return Value</strong></span> pin of the <span class="strong"><strong>ReturnNode</strong></span>. This will automatically create a <span class="strong"><strong>To Text (Int)</strong></span> conversion node, which is <a id="id326" class="indexterm"/>responsible for converting any integer into a string. When you are finished, your <code class="literal">Get_Editable_Soldier_HP_Text_0</code> function should look like this:</p><div class="mediaobject"><img src="graphics/B04548_05_07.jpg" alt="Getting character data"/></div></div></div>
<div class="section" title="Getting player instances"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec38"/>Getting player instances</h1></div></div></div><p>If you<a id="id327" class="indexterm"/> were to test this now, you would see that a value gets created in our pause menu, but the value is <span class="strong"><strong>0</strong></span>. This is not correct because our character is supposed to start with 100 HP according to the character's current stats:</p><div class="mediaobject"><img src="graphics/B04548_05_08.jpg" alt="Getting player instances"/></div><p>The problem <a id="id328" class="indexterm"/>occurs because the <span class="strong"><strong>Field Player</strong></span> that accesses the pause menu never assigns any of our character data to <span class="strong"><strong>Character Target</strong></span>. We can easily set the proper character target in Blueprint, but we won't be able to assign any of the character data without exposing our added party members to Blueprint. So, we must first head into <code class="literal">RPGGameInstance.h</code> and allow the exposure of our current game data to a <span class="strong"><strong>Game Data</strong></span> category of Blueprint in the <code class="literal">UProperty</code> parameters:</p><div class="informalexample"><pre class="programlisting">UPROPERTY( EditDefaultsOnly, BlueprintReadOnly, Category = "Game Data" )</pre></div><p>Your <code class="literal">RPGGameInstance</code>.<code class="literal">h</code> file should now look like this:</p><div class="informalexample"><pre class="programlisting">#pragma once

#include "Engine/GameInstance.h"
#include "GameCharacter.h"

#include "RPGGameInstance.generated.h"

/**
 * 
 */
UCLASS()
class RPG_API URPGGameInstance : public UGameInstance
{
  GENERATED_BODY()

  URPGGameInstance( const class FObjectInitializer&amp; ObjectInitializer );

public:
  UPROPERTY( EditDefaultsOnly, BlueprintReadOnly, Category = "Game Data" )
  TArray&lt;UGameCharacter*&gt; PartyMembers;

protected:
  bool isInitialized;

public:
  void Init();
  void PrepareReset();
};</pre></div><p>Once you <a id="id329" class="indexterm"/>have saved and compiled your code, you should be able to properly call any created and added party members in Blueprint, and so we should have read access via the <span class="strong"><strong>Field Player</strong></span> Blueprint.</p><p>Now, you can navigate back to the <span class="strong"><strong>Field Player</strong></span> Blueprint and have it get <span class="strong"><strong>RPGGameInstance</strong></span> by creating the <span class="strong"><strong>Get Game Instance</strong></span> function node located under <span class="strong"><strong>Game</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_05_09.jpg" alt="Getting player instances"/></div><p>Have <a id="id330" class="indexterm"/>the <span class="strong"><strong>Return Value</strong></span> of <span class="strong"><strong>Get Game Instance</strong></span> cast to <span class="strong"><strong>RPGGameInstance</strong></span>, which is located under <span class="strong"><strong>Utilities</strong></span> | <span class="strong"><strong>Casting</strong></span> | <span class="strong"><strong>RPGGameInstance</strong></span>. Now that you've got an instance of the <span class="strong"><strong>RPGGameInstance</strong></span> class, you can have the instance refer to the <code class="literal">TArray</code> of <span class="strong"><strong>Party Members</strong></span>, which holds all your party members, by navigating to the category that you have created for it in <span class="strong"><strong>GameData </strong></span>under<span class="strong"><strong> Variables</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_05_11.jpg" alt="Getting player instances"/></div><p>Here, we will <a id="id331" class="indexterm"/>need to point to the element of the array that holds our soldier character's stats, which is our first element or <code class="literal">0</code> index of the array, by linking the <span class="strong"><strong>Party Members</strong></span> array to a <span class="strong"><strong>GET</strong></span> function, which can be found by going to <span class="strong"><strong>Utilities</strong></span> | <span class="strong"><strong>Array</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_05_12.jpg" alt="Getting player instances"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note02"/>Note</h3><p>For additional characters, you will need to link another <span class="strong"><strong>GET</strong></span> function to <span class="strong"><strong>Party Members</strong></span> and have the <span class="strong"><strong>GET</strong></span> function point to the element of the array that will point to any other characters (for instance, if you had a healer that is in index 1, your second <span class="strong"><strong>GET</strong></span> function would simply list its index as 1 instead of 0 to pull from the healer's stats). For now, we are just going to focus on the soldier's stats, but you will want to get stats for every character in your party.</p></div></div><p>Lastly, once <a id="id332" class="indexterm"/>we have finished casting <span class="strong"><strong>RPGGameInstance</strong></span>, we will need to set the <span class="strong"><strong>Character Target</strong></span>, which we created in the pause menu, to our <span class="strong"><strong>Party Members</strong></span>. To do this, right-click on your <span class="strong"><strong>Event Graph</strong></span> to create a new action, but uncheck <span class="strong"><strong>Context Sensitive</strong></span> because we are looking for variables that have been declared in a different class (<code class="literal">Pause_Main</code>). If you navigate to <span class="strong"><strong>Class</strong></span> | <span class="strong"><strong>Pause Main</strong></span>, you will find <span class="strong"><strong>Set Character Target</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_05_13.jpg" alt="Getting player instances"/></div><p>Here, simply link <span class="strong"><strong>Character Target</strong></span> to the out pin of your <span class="strong"><strong>GET</strong></span> function:</p><div class="mediaobject"><img src="graphics/B04548_05_14.jpg" alt="Getting player instances"/></div><p>Then, set <span class="strong"><strong>Character Target</strong></span> so <a id="id333" class="indexterm"/>that it is triggered after <span class="strong"><strong>RPGGameInstance</strong></span> is cast:</p><div class="mediaobject"><img src="graphics/B04548_05_15.jpg" alt="Getting player instances"/></div></div>
<div class="section" title="Displaying stats"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec39"/>Displaying stats</h1></div></div></div><p>Now, we <a id="id334" class="indexterm"/>will need to pick a good spot to cast <span class="strong"><strong>RPGGameInstance</strong></span>. It would be best to cast <span class="strong"><strong>RPGGameInstance</strong></span> after the pause menu has been created, so link the out pin of the <span class="strong"><strong>Set Show MouseCursor</strong></span> node to the in pin of the <span class="strong"><strong>Cast To RPGGameInstance</strong></span>. Then, link the <span class="strong"><strong>Return Value</strong></span> of the <span class="strong"><strong>Create Pause_Main Widget</strong></span> to the <span class="strong"><strong>Target</strong></span> of <span class="strong"><strong>Set Character Target</strong></span>. When you are finished, your <span class="strong"><strong>EventGraph</strong></span> under <span class="strong"><strong>FieldPlayer</strong></span> will look like this:</p><div class="mediaobject"><img src="graphics/B04548_05_16.jpg" alt="Displaying stats"/></div><p>When you <a id="id335" class="indexterm"/>are finished, you will see that the HP of the soldier is displayed correctly as the current HP:</p><div class="mediaobject"><img src="graphics/B04548_05_17.jpg" alt="Displaying stats"/></div><p>You can now <a id="id336" class="indexterm"/>add the remaining soldier stats to Text Blocks in <span class="strong"><strong>Pause_Main</strong></span> from the pause menu by binding functions and then have these functions return values, such as the character target's MP and name. When you are finished with your soldier character, your <span class="strong"><strong>Pause_Main</strong></span> should look something like this:</p><div class="mediaobject"><img src="graphics/B04548_05_18.jpg" alt="Displaying stats"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note03"/>Note</h3><p>We do not yet have levels or experience, we will cover levels and experience in a later chapter.</p><p>If you have any other characters, make sure that you add them as well. As mentioned earlier, if you have additional characters in your party, you will need to go back to your <span class="strong"><strong>FieldPlayer</strong></span> Event Graph and create another <span class="strong"><strong>GET</strong></span> function that will get the indexes of your other party members and assign them to new <span class="strong"><strong>Character Targets</strong></span>.</p></div></div><p>Let's now <a id="id337" class="indexterm"/>head back into the <span class="strong"><strong>Pause_Inventory</strong></span> widget and bind character stats to their corresponding Text Blocks. Just like in <span class="strong"><strong>Pause_Main</strong></span>, select a Text Block that you want to bind; in this case, we will grab the <span class="strong"><strong>Text Block</strong></span> to the right of <span class="strong"><strong>HP</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_05_19.jpg" alt="Displaying stats"/></div><p>Then, simply<a id="id338" class="indexterm"/> create a binding for the Text Block, as you did for other Text Blocks. This will, of course, create a binding for a new function that we will return the HP status of the <span class="strong"><strong>Character Target</strong></span>. The issue is that the <span class="strong"><strong>Character Target</strong></span> that we created in <span class="strong"><strong>Pause_Main</strong></span> is a <span class="strong"><strong>Game Character</strong></span> variable local to <span class="strong"><strong>Pause_Main</strong></span>, so we will have to recreate the <span class="strong"><strong>Character Target</strong></span> variable in <span class="strong"><strong>Pause_Inventory</strong></span>. Luckily, the steps are the same as they were; we just need to add a new variable and name it <span class="strong"><strong>Character Target</strong></span>, and then make its type an object reference to <span class="strong"><strong>Game Character</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_05_20.jpg" alt="Displaying stats"/></div><p>When you <a id="id339" class="indexterm"/>are finished, add the <span class="strong"><strong>Character Target</strong></span> variable as a getter, link the <span class="strong"><strong>Character Target</strong></span> variable to get the HP of your character, and link that value to <span class="strong"><strong>Return Value</strong></span> of your <span class="strong"><strong>ReturnNode</strong></span>, just like you did previously. You should have an Event Graph that looks pretty similar to the following screenshot:</p><div class="mediaobject"><img src="graphics/B04548_05_21.jpg" alt="Displaying stats"/></div><p>If you were to<a id="id340" class="indexterm"/> test the inventory screen at this point, you would see that the HP value would be 0, but do not panic, you don't need to do much critical thinking to correct the value now that <span class="strong"><strong>FieldPlayer</strong></span> has a general framework for our characters. If you remember, when we cast <span class="strong"><strong>RPGGameInstance</strong></span> after creating the <span class="strong"><strong>Pause_Main</strong></span> widget in the <span class="strong"><strong>FieldPlayer</strong></span> class, we pulled our added party members from our game instance and set it to <span class="strong"><strong>Character Target</strong></span> in <span class="strong"><strong>Pause_Main</strong></span>. We need to perform steps similar to these, but instead of beginning the retrieval of party members in <span class="strong"><strong>FieldPlayer</strong></span>, we must do it in the class in which we created the <span class="strong"><strong>Pause_Inventory</strong></span>, which was created in <span class="strong"><strong>Pause_Main</strong></span>. So, navigate to the Event Graph of the <span class="strong"><strong>Pause_Main</strong></span> widget:</p><div class="mediaobject"><img src="graphics/B04548_05_22.jpg" alt="Displaying stats"/></div><p>In the preceding screenshot, we see that we are creating both the <span class="strong"><strong>Pause_Inventory</strong></span> and <span class="strong"><strong>Pause_Equipment</strong></span> widgets by clicking on their respective buttons. When the screens are created, we remove the current viewport. This is a perfect spot to create our <span class="strong"><strong>RPGGameInstance</strong></span>. So, as mentioned in the previous steps, create a <span class="strong"><strong>Get Game Instance</strong></span>, which is located under <span class="strong"><strong>Game</strong></span>. Then, set the return value to <span class="strong"><strong>Cast to RPGGameInstance</strong></span> by going to <span class="strong"><strong>Utilities</strong></span> | <span class="strong"><strong>Casting</strong></span>, which will then reference the <span class="strong"><strong>Party Members</strong></span> array located at <span class="strong"><strong>Game Data</strong></span> under <span class="strong"><strong>Variables</strong></span>. Here, you will use the <span class="strong"><strong>Get</strong></span> function by going to <span class="strong"><strong>Utilities</strong></span> | <span class="strong"><strong>Array</strong></span>, and link it to the <span class="strong"><strong>Party Members</strong></span> array, pulling index 0. This is what you should have done, and so far, the steps are identical to what you did in the <span class="strong"><strong>FieldPlayer</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_05_23.jpg" alt="Displaying stats"/></div><p>The differences <a id="id341" class="indexterm"/>set in when you set the <span class="strong"><strong>Character Target</strong></span>. As mentioned earlier, we will set the <span class="strong"><strong>Character Target</strong></span> variable of our newly created <span class="strong"><strong>Character Target</strong></span> variable to <span class="strong"><strong>Pause_Inventory</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_05_24.jpg" alt="Displaying stats"/></div><p>Once this is done, link the out pin of <span class="strong"><strong>Cast To RPGGameInstance</strong></span> to the in pin of <span class="strong"><strong>Set Character Target</strong></span>. Also, link <span class="strong"><strong>Get</strong></span> to <span class="strong"><strong>Character Target</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_05_25.jpg" alt="Displaying stats"/></div><p>Lastly, link the <a id="id342" class="indexterm"/>out pin of <span class="strong"><strong>Add to Viewport</strong></span> coming from <span class="strong"><strong>Pause_Inventory</strong></span> to the in pin of <span class="strong"><strong>Cast To RPGGameInstance</strong></span> to trigger the retrieval of the character stats, and link the <span class="strong"><strong>Return Value</strong></span> of the <span class="strong"><strong>Create Pause_Inventory Widget</strong></span> to <span class="strong"><strong>Target</strong></span> of <span class="strong"><strong>Set Character Target</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_05_26.jpg" alt="Displaying stats"/></div><p>At this point, if you test the inventory screen, you will notice that the HP value is being displayed properly:</p><div class="mediaobject"><img src="graphics/B04548_05_28.jpg" alt="Displaying stats"/></div><p>Now that you <a id="id343" class="indexterm"/>know how to create references to party members from <span class="strong"><strong>Pause_Main</strong></span>, you can follow the same steps to set each party member as a character target in <span class="strong"><strong>Pause_Inventory</strong></span>. But first, we need to complete all of the stat value displays in <span class="strong"><strong>Pause_Inventory</strong></span> by creating bindings in each stat's respective Text Block and setting the <span class="strong"><strong>Return Value</strong></span> of each Text Block to the value retrieved from <span class="strong"><strong>Character Target</strong></span>.</p><p>Once you are finished with the soldier in your <span class="strong"><strong>Pause_Inventory</strong></span>, you will see something that looks like this:</p><div class="mediaobject"><img src="graphics/B04548_05_29.jpg" alt="Displaying stats"/></div><p>At this point, you<a id="id344" class="indexterm"/> can easily navigate back to <span class="strong"><strong>Pause_Equipment</strong></span>, create a new <span class="strong"><strong>Character Target</strong></span> variable, then set a <span class="strong"><strong>Party Members</strong></span> to the <span class="strong"><strong>Character Target</strong></span> variable on displaying <span class="strong"><strong>Pause_Equipment</strong></span> in <span class="strong"><strong>Pause_Main</strong></span>, just like you did in <span class="strong"><strong>Pause_Inventory</strong></span>. The <span class="strong"><strong>Inventory</strong></span> and <span class="strong"><strong>Equipment</strong></span> buttons in the <span class="strong"><strong>Pause_Main</strong></span> Event Graph should look something like this when you are done:</p><div class="mediaobject"><img src="graphics/B04548_05_30.jpg" alt="Displaying stats"/></div><p>In <a id="id345" class="indexterm"/>the <span class="strong"><strong>Pause_Equipment</strong></span> widget, we can only bind the <span class="strong"><strong>AP</strong></span>, <span class="strong"><strong>DP</strong></span>, <span class="strong"><strong>Lk</strong></span>, and <span class="strong"><strong>Name</strong></span> Text Blocks, as we will be leaving the weapons for later. If you bind these Text Blocks with the newly created <span class="strong"><strong>Character Target</strong></span> in exactly the same way you bound the <span class="strong"><strong>Pause_Inventory</strong></span> Text Blocks, your <span class="strong"><strong>Equipment</strong></span> screen will look like this on testing:</p><div class="mediaobject"><img src="graphics/B04548_05_31.jpg" alt="Displaying stats"/></div><p>At this point, we <a id="id346" class="indexterm"/>have finished binding character stats to our pause menu screens for now.</p></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec40"/>Summary</h1></div></div></div><p>In this chapter, we added the current character stats to the pause menu. Now that we are comfortable with UMG, we will be moving on to communicating with NPCs via dialog boxes, along with adding a shop to the game.</p></div></body></html>