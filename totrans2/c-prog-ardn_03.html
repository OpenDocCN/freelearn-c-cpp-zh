<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch03"/>Chapter 3. C Basics – Making You Stronger</h1></div></div></div><p>C programming isn't that hard. But it requires enough work at the beginning. Fortunately, I'm with you and we have a very good friend since three chapters – our Arduino board. We will now go deep into the C language, and I'll do my best to be more concrete and not abstract.</p><p>This chapter and the next one are truly C language-oriented because the Arduino program design requires knowledge in programming logic statements. After these two chapters, you'll be able to read any code in this book; these strong basics will also help you in further projects, even those not related to Arduino.</p><p>I will also progressively introduce new concepts that we will use later, such as functions. Don't be afraid if you don't understand it that well, I like my students to hear some words progressively sometimes even without a proper definition at first, because it helps further explanation.</p><p>So if I don't define it but talk about it, just relax, explanations are going to come further. Let's dive in.</p><div><div><div><div><h1 class="title"><a id="ch03lvl1sec23"/>Approaching variables and types of data</h1></div></div></div><p>We already used variables in the previous chapters' examples. Now, let's understand this concept better.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec31"/>What is a variable?</h2></div></div></div><p>A <strong>variable</strong>
<a id="id210" class="indexterm"/> is a memory storage location bounded to a symbolic name. This reserved memory area can be filled or left empty. Basically, it is used to store different types of values. We used the variable <code class="literal">ledPin</code> in our previous examples, with the keyword <code class="literal">int</code>.</p><p>Something very useful with variables is the fact that we can change their content (the value) at runtime; this is also why they are called variables, compared to constants that also store values, but that cannot be changed while the program is running.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec32"/>What is a type?</h2></div></div></div><p>Variables (and constants) are associated with a type. A type, also called <a id="id211" class="indexterm"/>
<strong>data type</strong>, defines the possible nature of data. It also offers a nice way to directly reserve a space with a defined size in memory. C has around 10 main types of data that can be extended as we are going to see here.</p><p>I'm deliberately only explaining the types we'll use a lot in Arduino programming. This fits with approximately 80 percent of other usual C data types and will be more than enough here.</p><p>Basically, we are using a type when we declare a variable as shown here:</p><div><pre class="programlisting">int ledPin; // declare a variable of the type int and named "ledPin"</pre></div><p>A space of a particular size (the size related to the <code class="literal">int</code> type) is reserved in memory, and, as you can see, if you only write that line, there is still no data stored in that variable. But keep in mind that a memory space is reserved, ready to be used to store values.</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Type</p>
</th><th style="text-align: left" valign="bottom">
<p>Definition</p>
</th><th style="text-align: left" valign="bottom">
<p>Size in memory</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">void</code>
<a id="id212" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This particular type is used only in <em>function</em> declarations and while defining pointers with unknown types. We'll see that in the next <a id="id213" class="indexterm"/>chapter.</p>
</td><td style="text-align: left" valign="top"> </td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">boolean</code>
<a id="id214" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>It <a id="id215" class="indexterm"/>stores <code class="literal">false</code> or <code class="literal">true</code>.</p>
</td><td style="text-align: left" valign="top">
<p>1 byte (8 bit)</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">char</code>
<a id="id216" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>It stores<a id="id217" class="indexterm"/> single-quoted characters such as <code class="literal">'a'</code> as <em>numbers</em>, following the ASCII chart (<a class="ulink" href="http://en.wikipedia.org/wiki/ASCII_chart">http://en.wikipedia.org/wiki/ASCII_chart</a>).</p>
<p>It is a <em>signed</em> type and stores numbers from -128 to 127; it can be unsigned and then stores numbers from 0 to 255.</p>
</td><td style="text-align: left" valign="top">
<p>1 byte</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">byte</code>
<a id="id218" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>It stores numbers<a id="id219" class="indexterm"/> as <em>8-bit unsigned</em> data that means from 0 to 255.</p>
</td><td style="text-align: left" valign="top">
<p>8 bits</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">int</code>
<a id="id220" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>It stores numbers<a id="id221" class="indexterm"/> as <em>2-bytes signed</em> data which means from -32,768 to 32,767 it can also be unsigned and then store numbers from 0 to 65,535.</p>
</td><td style="text-align: left" valign="top">
<p>2 bytes (16 bit)</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">word</code>
<a id="id222" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>It stores numbers<a id="id223" class="indexterm"/> as <em>2-bytes unsigned</em> data exactly as <em>unsigned</em> <code class="literal">int</code> does.</p>
</td><td style="text-align: left" valign="top">
<p>2 bytes (16 bit)</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">long</code>
<a id="id224" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>It stores numbers<a id="id225" class="indexterm"/> as <em>4-bytes signed</em> data, which means from -2,147,483,648 to 2,147,483,647 and can be unsigned and then stores numbers from 0 to 4,294,967,295.</p>
</td><td style="text-align: left" valign="top">
<p>4 bytes (32 bit)</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">float</code>
<a id="id226" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>It basically stores<a id="id227" class="indexterm"/> numbers with a decimal point from -3.4028235E + 38 to 3.4028235E + 38 as <em>4-bytes signed</em> data.</p>
<p>Be careful of the required precision; they only have six to seven decimal digits and can give strange rounding results sometimes.</p>
</td><td style="text-align: left" valign="top">
<p>4 bytes (32 bit)</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">double</code>
<a id="id228" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>It generally <a id="id229" class="indexterm"/>stores <code class="literal">float</code> values with a precision two times greater than the <code class="literal">float</code> value.</p>
<p>Be careful, in the Arduino IDE and the board, the <code class="literal">double</code> implementation is exactly the same as <code class="literal">float</code>; that means with only six to seven decimal digits of precision.</p>
</td><td style="text-align: left" valign="top">
<p>4 bytes (32 bit)</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Array<a id="id230" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>Array is an ordered<a id="id231" class="indexterm"/> structure of consecutive elements of the same type that can each be accessed with an index number.</p>
</td><td style="text-align: left" valign="top">
<p>number of elements x size of elements' type</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">string</code>
<a id="id232" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>It stores text strings in an <a id="id233" class="indexterm"/>array of <code class="literal">char</code> where the last element is <code class="literal">null</code> that is a particular character (ASCII code 0). Be careful of the "s" in lower case at the beginning of <code class="literal">string</code>.</p>
</td><td style="text-align: left" valign="top">
<p>number of elements * 1 byte</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">String</code>
<a id="id234" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>It is a particular<a id="id235" class="indexterm"/> structure of data, namely a class, that provides a nice way to use and work with strings of text.</p>
<p>It comes with methods/functions to easily concatenate strings, split strings, and much more. Be careful of the capital "S" at the beginning of <code class="literal">String</code>.</p>
</td><td style="text-align: left" valign="top">
<p>available every time with the <code class="literal">length()</code> method</p>
</td></tr></tbody></table></div><div><div><div><div><h3 class="title"><a id="ch03lvl3sec09"/>The roll over/wrap concept</h3></div></div></div><p>If you go beyond the possible <a id="id236" class="indexterm"/>bounds of a type, the variable rolls over to the other side of the boundary.</p><p>The following is an example:</p><div><pre class="programlisting">int myInt = 32767; //the maximum int value
myInt = myInt + 1; // myInt is now -32768</pre></div><p>It happens in both directions, subtracting <code class="literal">1</code> from an <code class="literal">int</code> variable storing <code class="literal">-32768</code> results in <code class="literal">32767</code>. Keep that<a id="id237" class="indexterm"/> in mind.</p></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec33"/>Declaring and defining variables</h2></div></div></div><p>We are going to describe how to declare then define variables and learn how to do both at the same time.</p><div><div><div><div><h3 class="title"><a id="ch03lvl3sec10"/>Declaring variables</h3></div></div></div><p>Declaration of a <a id="id238" class="indexterm"/>variable is a statement in which you specify an <em>identifier</em>, a <em>type</em>, and eventually the variable's dimensions.</p><p>An identifier<a id="id239" class="indexterm"/> is what we call the <em>name of the variable</em>. You know what the type is too. The dimensions are useful for arrays, for instance, but also for <code class="literal">String</code> (which are processed as arrays internally).</p><p>In C and all other strongly-typed languages such as Java and Python, we <em>must</em> declare variables before using them. Anyway, the compiler will complain in case you forget the declaration.</p></div><div><div><div><div><h3 class="title"><a id="ch03lvl3sec11"/>Defining variables</h3></div></div></div><p>The following <a id="id240" class="indexterm"/>table contains some examples of variable definition:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Type</p>
</th><th style="text-align: left" valign="bottom">
<p>Example</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">boolean</code>
</p>
</td><td style="text-align: left" valign="top"><p>
</p><div><pre class="programlisting">bool myVariable; // declaration of the variable
myVariable = true; // definition of the variable by assigning it a value
bool myOtherVariable = false; // declaration and definition inside the same statement !</pre></div><p>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">char</code>
</p>
</td><td style="text-align: left" valign="top"><p>
</p><div><pre class="programlisting">char myChar = 'U'; // declaration and definition using the ASCII value of 'U' (i.e 85)
char myOtherChar = 85; // equals the previous statement

char myDefaultChar = 128; // this gives an ERROR because char are signed from -128 to 127
unsigned char myUnsignedChar = 128; // this is correct !</pre></div><p>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">byte</code>
</p>
</td><td style="text-align: left" valign="top"><p>
</p><div><pre class="programlisting">byte myByte = B10111; // 23 in binary notation with the B notation
byte myOtherByte = 23; // equals the previous statement</pre></div><p>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">int</code>
</p>
</td><td style="text-align: left" valign="top"><p>
</p><div><pre class="programlisting">int ledPin = 8; // classic for us, now :) 
unsigned myUint = 32768; // very okay with the prefix unsigned !</pre></div><p>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">word</code>
</p>
</td><td style="text-align: left" valign="top"><p>
</p><div><pre class="programlisting">word myWord = 12345;</pre></div><p>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">long</code>
</p>
</td><td style="text-align: left" valign="top"><p>
</p><div><pre class="programlisting">long myLong = -123; // don't forget that we can use negative numbers too!
long myOtherLong = 345;
unsigned myUlong = 2147483648; // correct because of the unsigned prefix</pre></div>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">float</code>
</p>
</td><td style="text-align: left" valign="top"><p>
</p><div><pre class="programlisting">float myFloat = -123456.1; // they can be negative.
float myOtherFloat = 1.234567; //
float myNoDecimalPointedFloat = 1234; // they can have a decimal part equaling zero</pre></div><p>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">double</code>
</p>
</td><td style="text-align: left" valign="top"><p>
</p><div><pre class="programlisting">double myDouble  = 1.234567; // Arduino implementation of double is same as float</pre></div><p>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Array<a id="id241" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top"><p>
</p><div><pre class="programlisting">int myIntTable[5]; // declaration of a table that can contain 5 integers
boolean myOtherTab[] = { false, true, true}; // declaration and definition of a 3 boolean arrays

myIntTable[5]; // considering the previous definition, this gives an array bound ERROR (index starts from 0 and thus the last one here is myIntTable[4])
myOtherTab[1]; // this elements can be manipulated as a boolean, it IS a boolean with the value true</pre></div><p>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">string</code>
</p>
</td><td style="text-align: left" valign="top"><p>
</p><div><pre class="programlisting">char mystring[3]; // a string of 3 characters
char mystring2[4] = {'b','y','t','e'}; // declaration &amp; definition
char mystring3[4] = "byte"; // equals to mystring2;
char mystring4[ ] = "byte"; // equals to mystring3;</pre></div><p>
</p>
</td></tr></tbody></table></div><p>Defining a variable is the act of assigning a value to the memory area previously reserved for that variable.</p><p>Let's declare and define some variables of each type. I have put some explanations in the code's comments.</p><p>Here are some examples you can use, but you'll see in each piece of code given in this book that different types of declaration and definition are used. You'll be okay with that as soon as we'll wire the board. </p><p>Let's dig a bit more into the <code class="literal">String</code> type. </p></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec24"/>String</h1></div></div></div><p>The <code class="literal">String</code> type<a id="id242" class="indexterm"/> deserves a entire subchapter because it is a bit more than a type. Indeed, it is an object (in the sense of object-oriented programming).</p><p>Objects come with special properties and functions. Properties and functions are available natively because <code class="literal">String</code> is now a part of the Arduino core and can be seen as a pre-existing entity even if your IDE contains no line.</p><p>Again, the framework takes care of things for you, providing you a type/object with powerful and already coded functions that are directly usable.</p><p>Check out <a class="ulink" href="http://arduino.cc/en/Reference/StringObject">http://arduino.cc/en/Reference/StringObject</a> in the Arduino website.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec34"/>String definition is a construction</h2></div></div></div><p>We talked about definition for <a id="id243" class="indexterm"/>variables, but objects have a similar concept called <a id="id244" class="indexterm"/>
<strong>construction</strong>.</p><p>For <code class="literal">String</code> objects, I'm talking about <em>construction</em> instead of <em>definition</em> here but you can consider both terms equal. Declaring a <code class="literal">String</code> type in Arduino core involves an object constructor, which is an object-oriented programming concept; we don't have to handle it, fortunately, at this point.</p><div><pre class="programlisting">String myString01 = "Hello my friend"; // usual constant string to construct it
String myString02 = String('U'); // convert U char into a String object

// concatenating 2 String together and put the result into another
String myString03 = String(myString01 + ", we are trying to play with String(s));

// converting the current value of integer into a String object
int myNiceInt = 8; // define an integer
String myString04 = String(myNiceInt); // convert to a String object

// converting the current value of an integer w/ a base into a String object
int myNiceInt = 47; // define an integer
String myString05 = String(myNiceInt, DEC);
String myString06 = String(myNiceInt, HEX);
String myString07 = String(myNiceInt, BIN);</pre></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec35"/>Using indexes and search inside String</h2></div></div></div><p>
<code class="literal">Strings</code> are arrays<a id="id245" class="indexterm"/> of <code class="literal">char</code> elements. This means we can access any <a id="id246" class="indexterm"/>element <a id="id247" class="indexterm"/>of a <code class="literal">String</code> type<a id="id248" class="indexterm"/> through their indexes.</p><p>Keep in mind that indexes start at <code class="literal">0</code> and not at <code class="literal">1</code>. The <code class="literal">String</code> objects implement some functions for this particular purpose.</p><div><div><div><div><h3 class="title"><a id="ch03lvl3sec12"/>charAt()</h3></div></div></div><p>Considering a <code class="literal">String</code> type is declared and defined as follows:</p><div><pre class="programlisting">String myString = "Hello World !!";</pre></div><p>The <a id="id249" class="indexterm"/>statement <code class="literal">myString.charAt(3)</code> returns the fourth element of the string that is: <code class="literal">l</code>. Notice the specific notation used here: we have the name of the <code class="literal">String</code> variable, a dot, then the name of the function (which is a method of the <code class="literal">String</code> object), and the parameter <code class="literal">3</code> which is passed to the function.</p><div><div><h3 class="title"><a id="note05"/>Note</h3><p>The <code class="literal">charAt()</code> function returns a<a id="id250" class="indexterm"/> character at a particular position inside a string.</p><p>
<strong>Syntax</strong>: <code class="literal">string.charAt(int);</code>
</p><p>
<code class="literal">int</code> is an integer representing an index of the <code class="literal">String</code> value.</p><p>
<strong>Returns type</strong>: <code class="literal">char</code>
</p></div></div><p>Let's learn about other similar functions. You'll use them very often because, as we have already seen, communicating at a very low-level point of view includes parsing and processing data, which can very often be strings.</p></div><div><div><div><div><h3 class="title"><a id="ch03lvl3sec13"/>indexOf() and lastIndexOf()</h3></div></div></div><p>Let's consider the same declaration/definition:</p><div><pre class="programlisting">String myString = "Hello World !!";</pre></div><p>
<code class="literal">myString.indexOf('r')</code> equals <code class="literal">8</code>. Indeed, <code class="literal">r</code> is at<a id="id251" class="indexterm"/> the ninth place of the value of the string<em> </em>
<code class="literal">myString</code>. <code class="literal">indexOf(val)</code> and <a id="id252" class="indexterm"/>looks for the first occurrence of the value <code class="literal">val</code>.</p><p>If you want to begin your search from a particular point, you can specify a start point like that: <code class="literal">indexOf(val,start</code>), where <code class="literal">start</code> is the index from where the function begins to search for the character <code class="literal">val</code> in the string. As you have probably understood, the second argument of this function (<code class="literal">start</code>) can be omitted, the search starts from the first element of the string by default, <a id="id253" class="indexterm"/>which is <code class="literal">0</code>.</p><div><div><h3 class="title"><a id="note06"/>Note</h3><p>The <code class="literal">indexOf()</code> function<a id="id254" class="indexterm"/> returns the first occurrence of a string or character inside a string.</p><p>
<strong>Syntax</strong>: <code class="literal">string.indexOf(val, from);</code>
</p><p>
<code class="literal">val</code> is the value to search for which can be a string or a character. <code class="literal">from</code> is the index to start the search from, which is an <code class="literal">int</code> type. This argument can be omitted. The search goes forward.</p><p>
<strong>Returns type</strong>: <code class="literal">int</code>
</p></div></div><p>Similarly, <code class="literal">lastIndexOf(val,start)</code> looks for the last occurrence of <code class="literal">val</code>, searching <strong>backwards</strong> from <code class="literal">start</code>, or from the last element if you omit <code class="literal">start</code>.</p><p>The <code class="literal">lastIndexOf()</code> function<a id="id255" class="indexterm"/> returns the last occurrence of a string or character inside a string.</p><div><div><h3 class="title"><a id="note07"/>Note</h3><p>
<strong>Syntax</strong>: <code class="literal">string.lastIndexOf(val, from);</code>
</p><p>
<code class="literal">val</code> is the <a id="id256" class="indexterm"/>value to search for which is a string or a character. <code class="literal">from</code> is the index to start the search from which is an <code class="literal">int</code> type. This argument can be omitted. The search goes backwards.</p><p>
<strong>Returns type</strong>: <code class="literal">int</code>
</p></div></div></div><div><div><div><div><h3 class="title"><a id="ch03lvl3sec14"/>startsWith() and endsWith()</h3></div></div></div><p>The <code class="literal">startsWith()</code> <a id="id257" class="indexterm"/>and <code class="literal">endsWith()</code> function<a id="id258" class="indexterm"/>s check whether a string starts or ends with, respectively, another string passed as an argument to the function.</p><div><pre class="programlisting">String myString = "Hello World !!";
String anotherString ="Hell" ;
myString.startsWith(anotherString); // this returns true
myString.startsWith("World"); // this returns false</pre></div><div><div><h3 class="title"><a id="note08"/>Note</h3><p>The <code class="literal">startsWith()</code> function returns <code class="literal">true</code> if a string starts with the same characters as another string.</p><p>
<strong>Syntax</strong>: <code class="literal">string.startsWith(string2);</code>
</p><p>
<code class="literal">string2</code> is the string <a id="id259" class="indexterm"/>pattern with which you want to test the string.</p><p>
<strong>Returns type</strong>: <code class="literal">boolean</code>
</p></div></div><p>I guess, you have begun to understand right now. <code class="literal">endsWith()</code> works like that too, but compares the string pattern with the end of the string tested.</p><div><div><h3 class="title"><a id="note09"/>Note</h3><p>The <code class="literal">endsWith()</code> function returns <code class="literal">true</code> if a string ends with the same characters as another string.</p><p>
<strong>Syntax</strong>: <code class="literal">string.endsWith(string2);</code>
</p><p>
<code class="literal">string2</code> is the <a id="id260" class="indexterm"/>string pattern with which you want to test the string.</p><p>
<strong>Returns type</strong>: <code class="literal">boolean</code>
</p></div></div></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec36"/>Concatenation, extraction, and replacement</h2></div></div></div><p>The preceding operations also introduce new C operators. I'm using them here with strings but you'll learn a bit more about them in a more global context further.</p><div><div><div><div><h3 class="title"><a id="ch03lvl3sec15"/>Concatenation</h3></div></div></div><p>Concatenation<a id="id261" class="indexterm"/> of strings is an operation in which you take two strings<a id="id262" class="indexterm"/> and you glue them together. It results in a new string composed of the previous two strings. The order is important; you have to manage which string you want appended to the end of the other.</p><div><div><div><div><h4 class="title"><a id="ch03lvl4sec04"/>Concat()</h4></div></div></div><p>Arduino core comes with the <code class="literal">string.concat()</code> function, which is especially designed for this purpose.</p><div><pre class="programlisting">String firstString = "Hello ";
String secondString ="World!";

// appending the second to the first and put the result in the first
firstString.concat(secondString);</pre></div><div><div><h3 class="title"><a id="note10"/>Note</h3><p>The <code class="literal">concat()</code> function<a id="id263" class="indexterm"/> appends one string to another (that is concatenate in a defined order).</p><p>
<strong>Syntax</strong>: <code class="literal">string.concat(string2);</code>
</p><p>
<code class="literal">string2</code> is a <a id="id264" class="indexterm"/>string and is appended to the end of string. Remember that, the previous content of the string is overwritten as a result of the concatenation.</p><p>
<strong>Returns type</strong>: <code class="literal">int</code> (the function returns <code class="literal">1</code> if the concatenation happens correctly).</p></div></div></div><div><div><div><div><h4 class="title"><a id="ch03lvl4sec05"/>Using the + operator on strings</h4></div></div></div><p>There is another <a id="id265" class="indexterm"/>way to <a id="id266" class="indexterm"/>concatenate two strings. That one doesn't use a function but an operator: <code class="literal">+</code>.</p><div><pre class="programlisting">String firstString = "Hello ";
String secondString ="World!";

// appending the second to the first and putting the result in the first
firstString = firstString + secondString;</pre></div><p>This code is the same as the previous one. <code class="literal">+</code> is an operator that I'll describe better a bit later. I'm giving you something more here: a condensed notation for the <code class="literal">+</code> operator:</p><div><pre class="programlisting">firstString = firstString + secondString;</pre></div><p>This can also be written as:</p><div><pre class="programlisting">firstString += secondString;</pre></div><p>Try it. You'll understand.</p></div></div><div><div><div><div><h3 class="title"><a id="ch03lvl3sec16"/>Extract and replace</h3></div></div></div><p>String <a id="id267" class="indexterm"/>manipulation and alteration can be done using some very useful functions extracting and replacing elements in the string.</p><div><div><div><div><h4 class="title"><a id="ch03lvl4sec06"/>substring() is the extractor</h4></div></div></div><p>You want to extract a part of a <a id="id268" class="indexterm"/>string. Imagine if the Arduino board sends messages with a specific and defined communication protocol:</p><p>
<code class="literal">&lt;output number&gt;.&lt;value&gt;</code>
</p><p>The output number is coded with two characters every time, and the value with three (45 has to be written as 045). I often work like that and pop out these kind of messages from the serial port of my computer via the USB when I need to; for instance, send a command to light up a particular LED with a particular intensity. If I want to light the LED on the fourth output at 100/127, I send:</p><div><pre class="programlisting">04.100</pre></div><p>Arduino <em>needs</em> to understand this message. Without going further with the communication protocol design, as that will be covered in <a class="link" href="ch07.html" title="Chapter 7. Talking over Serial">Chapter 7</a>, <em>Talking Over Serial</em>, I want to <a id="id269" class="indexterm"/>introduce you to a new feature—splitting strings.</p><div><pre class="programlisting">String receivedMessage = "04.100";
String currentOutputNumber;
String currentValueNumber;

// extracting a part of receivedMessage from index 0 (included) to 1 (excluded)
currentOutputNumber = receivedMessage.substring(0,2);

// extracting a part of receivedMessage from index 3 (included) to the end
currentValueNumber = receivedMessage.substring(3);</pre></div><p>This piece of code splits the message received by Arduino into two parts.</p><div><div><h3 class="title"><a id="note11"/>Note</h3><p>The <code class="literal">substring()</code> function extracts a part of a string from a start index (included) to<a id="id270" class="indexterm"/> another (not included).</p><p>
<strong>Syntax</strong>: <code class="literal">string.substring(from, to);</code>
</p><p>
<code class="literal">from</code> is the start index. The result includes the content of the <code class="literal">from</code> string element. <code class="literal">to</code> is the end index. The result doesn't include the content of the <code class="literal">end</code> string element, it can be omitted.</p><p>
<strong>Returns type</strong>: <code class="literal">String</code>
</p></div></div><p>Let's push the concept of string extract and split it a bit further.</p></div><div><div><div><div><h4 class="title"><a id="ch03lvl4sec07"/>Splitting a string using a separator</h4></div></div></div><p>Let's challenge <a id="id271" class="indexterm"/>ourselves a bit. Imagine I don't know or I'm not sure <a id="id272" class="indexterm"/>about the message format (two characters, a dot, and three characters, that we have just seen). This is a real life case; while learning to make things, we often meet strange cases where those <em>things</em> don't behave as expected.</p><p>Imagine I want to use the dot as a separator, because I'm very sure about it. How can I do that using the things that we have already learned? I'd need to extract characters. OK, I know <code class="literal">substring()</code> now!</p><p>But I also need an index to extract the content at a particular place. I also know how to find the index of an occurrence of a character in a string, using<a id="id273" class="indexterm"/> <code class="literal">indexOf()</code>.</p><p>Here is how we do that:</p><div><pre class="programlisting">String receivedMessage = "04.100";
String currentOutputNumber;
String currentValueNumber;
int splitPointIndex; 

// storing the index of the separator in the String 
splitPointIndex = receivedMessage.indexOf('.');

// extracting my two elements
currentOutputNumber = receivedMessage.substring(0, splitPointIndex);
currentValueNumber = receivedMessage.substring(splitPointIndex + 1);</pre></div><p>Firstly, I find the<a id="id274" class="indexterm"/> split point index (the place in the string where the dot sits). Secondly, I <a id="id275" class="indexterm"/>use this result as the last element of my extracted substring. Don't worry, the last element isn't included, which means <code class="literal">currentOutputNumber</code> doesn't contain the dot.</p><p>At last, I'm using <code class="literal">splitPointIndex</code> one more time as the start of the second part of the string that I need to extract. And what? I add the integer <code class="literal">1</code> to it because, as you master <code class="literal">substring()</code> now and know, the element corresponding to the start index is always included by the <code class="literal">substring()</code> operation. We don't want that dot because it is only a separator. Right?</p><p>Don't worry if you are a bit lost. Things will become clearer in the next subchapters and especially when we'll make Arduino process things, which will come a bit later in the book.</p></div><div><div><div><div><h4 class="title"><a id="ch03lvl4sec08"/>Replacement</h4></div></div></div><p>Replacements<a id="id276" class="indexterm"/> are often used when we want to convert a communication protocol to another. For instance, we need to replace a part of a string by another to prepare a further process.</p><p>Let's take our previous example. We now want to replace the dot by another character because we want to send the result to another process that only understands the space character as a separator.</p><div><pre class="programlisting">String receivedMessage = "04.100";
String originalMessage;

// keeping a trace of the previous message by putting it into another variable
originalMessage = receivedMessage;

// replacing dot by space character in receivedMessage
receivedMessage.replace('.',' ');</pre></div><p>Firstly, I put the content<a id="id277" class="indexterm"/> of the <code class="literal">receivedMessage</code> variable into another variable named <code class="literal">originalMessage</code> because I know the <code class="literal">replace()</code> function will definitely modify the processed string. Then I process <code class="literal">receivedMessage</code> with the <code class="literal">replace()</code> function.</p><div><div><h3 class="title"><a id="note12"/>Note</h3><p>The <code class="literal">replace()</code> function<a id="id278" class="indexterm"/> replaces a part of a string with another string.</p><p>
<strong>Syntax</strong>: <code class="literal">string.replace(substringToReplace, replacingSubstring);</code>
</p><p>
<code class="literal">from</code> is the start index. The <a id="id279" class="indexterm"/>result includes the content of a <code class="literal">from</code> string element. <code class="literal">to</code> is the end index. The result doesn't include the content of an <code class="literal">end</code> string element, it can be omitted. Remember that, the previous content of the string is overwritten as a result of the replacement (copy it to another string variable if you want to keep it).</p><p>
<strong>Returns type</strong>: <code class="literal">int</code> (the function returns <code class="literal">1</code> if the concatenation happens correctly).</p></div></div><p>This function can, obviously, replace a character by another character of course. A string is an array of characters. It is not strange that one character can be processed as a string with only one element. Let's think about it a bit.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec37"/>Other string functions</h2></div></div></div><p>There are some other string processing functions I'd like to quickly quote here.</p><div><div><div><div><h3 class="title"><a id="ch03lvl3sec17"/>toCharArray()</h3></div></div></div><p>This function <a id="id280" class="indexterm"/>copies all the string's characters into a "real" character array, also named, for internal reasons, a buffer. You can check <a class="ulink" href="http://arduino.cc/en/Reference/StringToCharArray">http://arduino.cc/en/Reference/StringToCharArray</a>.</p></div><div><div><div><div><h3 class="title"><a id="ch03lvl3sec18"/>toLowerCase() and toUpperCase()</h3></div></div></div><p>These functions <a id="id281" class="indexterm"/>replace the strings processed by them by the same string but with all <a id="id282" class="indexterm"/>characters in lowercase and uppercase respectively. You can check <a class="ulink" href="http://arduino.cc/en/Reference/StringToLower">http://arduino.cc/en/Reference/StringToLower</a> and <a class="ulink" href="http://arduino.cc/en/Reference/StringToUpperCase">http://arduino.cc/en/Reference/StringToUpperCase</a>. Be careful, as it overwrites the string processed with the result of this process.</p></div><div><div><div><div><h3 class="title"><a id="ch03lvl3sec19"/>trim()</h3></div></div></div><p>This<a id="id283" class="indexterm"/> function removes all whitespace in your string. You can check <a class="ulink" href="http://arduino.cc/en/Reference/StringTrim">http://arduino.cc/en/Reference/StringTrim</a>. Again, be careful, as it overwrites the strings processed with the result of this process.</p></div><div><div><div><div><h3 class="title"><a id="ch03lvl3sec20"/>length()</h3></div></div></div><p>I wanted to end <a id="id284" class="indexterm"/>with this functioin. This is the one you'll use a lot. It provides the length of a string as an integer. You can check <a class="ulink" href="http://arduino.cc/en/Reference/StringLength">http://arduino.cc/en/Reference/StringLength</a>.</p></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec38"/>Testing variables on the board</h2></div></div></div><p>The following is a<a id="id285" class="indexterm"/> piece of code that you can also find in the folder <code class="literal">Chapter03/VariablesVariations/</code>:</p><div><pre class="programlisting">/*
  Variables Variations Program
 This firmware pops out messages over Serial to better understand variables' use.
 Switch on the Serial Monitoring window and reset the board after that.
 Observe and check the code :)
 
 Written by Julien Bayle, this example code is under Creative Commons CC-BY-SA
 */


// declaring variables before having fun !
boolean myBoolean;
char myChar;
int myInt;
float myFloat;
String myString;


void setup(){
  Serial.begin(9600);
  myBoolean = false;
  myChar = 'A';
  myInt = 1;
  myFloat = 5.6789 ;
  myString = "Hello Human!!";
}

void loop(){

  // checking the boolean
  if (myBoolean) {
    Serial.println("myBoolean is true");
  }
  else {
    Serial.println("myBoolean is false");
  }


  // playing with char &amp; int
  Serial.print("myChar is currently ");
  Serial.write(myChar);
  Serial.println();

  Serial.print("myInt is currently ");
  Serial.print(myInt);
  Serial.println();

  Serial.print("Then, here is myChar + myInt : ");
  Serial.write(myChar + myInt);
  Serial.println();


  // playing with float &amp; int
  Serial.print("myFloat is : ");
  Serial.print(myFloat);
  Serial.println();

  // putting the content of myFloat into myInt
  myInt = myFloat;
  Serial.print("I put myFloat into myInt, and here is myInt now : ");
  Serial.println(myInt);


  // playing with String
  Serial.print("myString is currently: ");
  Serial.println(myString);
  
  myString += myChar; // concatening myString with myChar
  Serial.print("myString has a length of ");
  Serial.print(myString.length());// printing the myString length
  Serial.print(" and equals now: ");
  Serial.println(myString);

 // myString becomes too long, more than 15, removing the last 3 elements
  if (myString.length() &gt;= 15){
    Serial.println("myString too long ... come on, let's clean it up! ");
    myInt = myString.lastIndexOf('!'); // finding the place of the '!' 
    myString = myString.substring(0,myInt+1);  // removing characters 
    
    Serial.print("myString is now cleaner: ");
    Serial.println(myString);
    
    // putting true into myBoolean
  }
  else {
    myBoolean = false;     // resetting myBoolean to false
  }
  

  delay(5000);     // let's make a pause
  
  // let's put 2 blank lines to have a clear read
  Serial.println();
  Serial.println();
}</pre></div><p>Upload this <a id="id286" class="indexterm"/>code to your board, then switch on the serial monitor. At last, reset the board by pushing the reset button and observe. The board writes directly to your serial monitor as shown in the following screenshot:</p><div><img src="img/7584_03_002.jpg" alt="Testing variables on the board"/><div><p>The serial monitor showing you what your board is saying</p></div></div><div><div><div><div><h3 class="title"><a id="ch03lvl3sec21"/>Some explanations</h3></div></div></div><p>All explanations will come progressively, but here is a small summary of what is happening right now.</p><p>I first declare my variables and then define some in <code class="literal">setup()</code>. I could have declared and defined them at the same time.</p><p>Refreshing your memory, <code class="literal">setup()</code> is executed only one time at the board startup. Then, the <code class="literal">loop()</code> function is executed infinitely, sequentially running each row of statement.</p><p>In <code class="literal">loop()</code>, I'm first testing <code class="literal">myBoolean</code>, introducing the <code class="literal">if()</code> conditional statement. We'll learn this in this chapter too.</p><p>Then, I'll play a bit with the <code class="literal">char</code>, <code class="literal">int</code>, and <code class="literal">String</code> types, printing some variables, then modifying them and reprinting them.</p><p>The main point to note here is the <code class="literal">if()</code> and <code class="literal">else</code> structure. Look at it, then relax, answers will come very soon.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec25"/>The scope concept</h1></div></div></div><p>The scope<a id="id287" class="indexterm"/> can be defined as a particular property of a variable (and functions, as we'll see further). Considering the source code, the scope of a variable is that part of the code where this variable is visible and usable.</p><p>A variable can be <em>global</em> and then is visible and usable everywhere in the source code. But a variable can also be <em>local</em>, declared inside a function, for instance, and that is visible only inside this particular function.</p><p>The scope property is <em>implicitly</em> set by the place of the variable's declaration in the code. You probably just understood that every variable could be declared globally. Usually, I follow my own <em>digital haiku</em>.</p><div><div><h3 class="title"><a id="note13"/>Note</h3><p>Let each part of your code know only variables that it has to know, no more.</p></div></div><p>Trying to <a id="id288" class="indexterm"/>minimize the scope of the variables is definitely a winning way. Check out the following example:</p><div><pre class="programlisting">// this variable is declared at the highest level, making it visible everywhere
int globalString;

void setup(){
  // … some code
}
void loop(){
  int a; // a is visible inside the loop function only
  anotherFunction(); // calling the global function anotherFunction

// … some other code
}

void anotherFunction() {
  // … yet another code
  int veryLocalVar; // veryLocalVar is visible only in anotherFunction function
}</pre></div><p>We could represent the code's scope as a box more or less imbricated.</p><div><img src="img/7584_03_03.jpg" alt="The scope concept"/><div><p>Code's scope seen as boxes</p></div></div><p>The <a id="id289" class="indexterm"/>external box represents the source code's highest level of scope. Everything declared at this level is visible and usable by all functions; it is the global level.</p><p>Every other box represents a particular scope in itself. Every variable declared in one scope cannot be seen and used in higher scopes neither in the same level ones.</p><p>This representation is very useful to my students who always need more visuals. We'll also use this metaphor while we talk about <em>libraries</em>, especially. What is declared in libraries can be used in our code if we include some specific headers at the beginning of the code, of course.</p></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec26"/>static, volatile, and const qualifiers</h1></div></div></div><p>
<strong>Qualifiers</strong> <a id="id290" class="indexterm"/>are the keywords that are used to change the processor's behavior considering the <em>qualified</em> variable. In reality, the compiler will use these qualifiers to change characteristics of the considered variables in the binary firmware produced. We are going to learn about three qualifiers: <code class="literal">static</code>, <code class="literal">volatile</code>, and <code class="literal">const</code>.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec39"/>static</h2></div></div></div><p>When you use the<a id="id291" class="indexterm"/> <code class="literal">static</code> qualifier<a id="id292" class="indexterm"/> for a variable inside a function, this makes the variable persistent between two calls of the function. Declaring a variable inside a function makes the variable, implicitly, local to the function as we just learned. It means only the function can know and use the variable. For instance:</p><div><pre class="programlisting">int myGlobalVariable;

void setup(){
}

void loop(){
  myFunction(digitalPinValue);
}

void myFunction(argument){
int aLocalVariable;
aLocalVariable = aLocalVariable + argument;
  // playing with aLocalVariable
}</pre></div><p>This variable is seen in the <code class="literal">myFunction</code> function only. But what happens after the first loop? The previous value is lost and as soon as <code class="literal">int aLocalVariable;</code> is executed, a new variable is set up, with a value of zero. Check out this new piece of code:</p><div><pre class="programlisting">int myGlobalVariable;
void setup(){
}

void loop(){
  myFunction(digitalPinValue);
}

void myFunction(argument){
static int aStaticVariable;
aStaticVariable = aStaticVariable + argument;
  // playing with aStaticVariable
}</pre></div><p>This variable is seen in the <code class="literal">myFunction</code> function only and, after adding an argument has modified it, we can play with its new value.</p><p>In this case, the variable is qualified as <code class="literal">static</code>. It means the variable is declared <em>only</em> the first time. This provides a useful way to keep trace of something and, at the same time, make the variable, containing this trace, local.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec40"/>volatile</h2></div></div></div><p>When you use the<a id="id293" class="indexterm"/> <code class="literal">volatile</code> qualifier<a id="id294" class="indexterm"/> in a variable declaration statement, this variable is loaded from the RAM instead of the storage register memory space of the board. The difference is subtle and this qualifier is used in specific cases where your code itself doesn't have the control of something else executed on the processor. One example, among others, is the use of interrupts. We'll see that a bit later.</p><p>Basically, your code runs normally, and some instructions are triggered not by this code, but by another process such as an external event. Indeed, our code doesn't know when and what <strong>Interrupt Service Routine</strong> (<strong>ISR</strong>)<a id="id295" class="indexterm"/> does, but it stops when something like that occurs, letting the CPU run ISR, then it continues. Loading the variable from the RAM prevents some possible inconsistencies of variable value.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec41"/>const</h2></div></div></div><p>The<a id="id296" class="indexterm"/> <code class="literal">const</code> qualifier<a id="id297" class="indexterm"/> means constant. Qualifying a variable with <code class="literal">const</code> makes it unvariable, which can sound weird.</p><p>If you try to write a value to a <code class="literal">const</code> variable after its declaration/definition statement, the compiler gives an error. The scope's concept applies here too; we can qualify a variable declared inside a function, or globally. This statement defines and declares the <code class="literal">masterMidiChannel</code> variable as a constant:</p><div><pre class="programlisting">const int masterMidiChannel = 10;</pre></div><p>This is equivalent to:</p><div><pre class="programlisting">#define masterMidiChannel 10</pre></div><div><div><h3 class="title"><a id="note14"/>Note</h3><p>There is <em>no</em> semicolon after a <code class="literal">#define</code> statement.</p></div></div><p>
<code class="literal">#define</code> seems a bit less used as <code class="literal">const</code>, probably because it cannot be used for constant arrays. Whatever the case, <code class="literal">const</code> can always be used. Now, let's move on and learn some new operators.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec27"/>Operators, operator structures, and precedence</h1></div></div></div><p>We have already met a lot of <a id="id298" class="indexterm"/>operators. Let's first check the arithmetic operators.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec42"/>Arithmetic operators and types</h2></div></div></div><p>Arithmetic <a id="id299" class="indexterm"/>operators<a id="id300" class="indexterm"/> are:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">+</code> (plus sign)</li><li class="listitem" style="list-style-type: disc"><code class="literal">-</code> (minus)</li><li class="listitem" style="list-style-type: disc"><code class="literal">*</code> (asterisk)</li><li class="listitem" style="list-style-type: disc"><code class="literal">/</code> (slash)</li><li class="listitem" style="list-style-type: disc"><code class="literal">%</code> (percent)</li><li class="listitem" style="list-style-type: disc"><code class="literal">=</code> (equal)</li></ul></div><p>I'm beginning with the last one: <code class="literal">=</code>
<strong>.</strong> It is the <a id="id301" class="indexterm"/>
<strong>assignment</strong> operator. We have already used it a lot to define a variable, which just means to assign a value to it. For instance:</p><div><pre class="programlisting">int oscillatorFrequency = 440;</pre></div><p>For the other operators, I'm going to distinguish two different cases in the following: character types, which include <code class="literal">char</code> and <code class="literal">String</code>, and numerical types. Operators can change their effect a bit according to the types of variables.</p><div><div><div><div><h3 class="title"><a id="ch03lvl3sec22"/>Character types</h3></div></div></div><p>
<code class="literal">char</code> and <code class="literal">String</code> can only be <a id="id302" class="indexterm"/>processed by <code class="literal">+</code>. As you may have guessed, <code class="literal">+</code> is<a id="id303" class="indexterm"/> the concatenation operator:</p><div><pre class="programlisting">String myString = "Hello ";
String myString2 = "World";

String myResultString = myString + myString2;
myString.concat(myString2);</pre></div><p>In this code, concatenation of <code class="literal">myResultString</code> and <code class="literal">myString</code> results in the <code class="literal">Hello World</code> string.</p></div><div><div><div><div><h3 class="title"><a id="ch03lvl3sec23"/>Numerical types</h3></div></div></div><p>With all <a id="id304" class="indexterm"/>numerical types (<code class="literal">int</code>, <code class="literal">word</code>, <code class="literal">long</code>, <code class="literal">float</code>, <code class="literal">double</code>), you can <a id="id305" class="indexterm"/>use the following operators:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">+</code> (addition)</li><li class="listitem" style="list-style-type: disc"><code class="literal">-</code> (subtraction)</li><li class="listitem" style="list-style-type: disc"><code class="literal">*</code> (multiplication)</li><li class="listitem" style="list-style-type: disc"><code class="literal">/</code> (division)</li><li class="listitem" style="list-style-type: disc"><code class="literal">%</code> (modulo)</li></ul></div><p>A basic <a id="id306" class="indexterm"/>example of <a id="id307" class="indexterm"/>multiplication is shown as follows:</p><div><pre class="programlisting">float OutputOscillatorAmplitude = 5.5;
int multiplier = 3;
OutputOscillatorAmplitude = OutputOscillatorAmplitude * multiplier</pre></div><div><div><h3 class="title"><a id="note15"/>Note</h3><p>As soon as you use a <code class="literal">float</code> or <code class="literal">double</code> type as one of the operand, the floating point calculation process will be used.</p></div></div><p>In the previous code, the result of <code class="literal">OutputOscillatorAmplitude * multiplier</code> is a <code class="literal">float</code> value. Of course, division by zero is <em>prohibited</em>; the reason is math instead of C or Arduino.</p><p>
<strong>Modulo</strong>
<a id="id308" class="indexterm"/> is simply the remainder of the division of one integer by another one. We'll use it a lot to keep variables into a controlled and chosen range. If you make a variable grow to infinite but manipulate its modulo by 7 for instance, the result will always be between 0 (when the growing variable will be a multiple of 7) and 6, constraining the growing variable.</p></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec43"/>Condensed notations and precedence</h2></div></div></div><p>As you may have noticed, there is a<a id="id309" class="indexterm"/> condensed way of writing an operation <a id="id310" class="indexterm"/>with these <a id="id311" class="indexterm"/>previously explained operators. Let's see two<a id="id312" class="indexterm"/> equivalent notations and explain this.</p><p>Example 1:</p><div><pre class="programlisting">int myInt1 = 1;
int myInt2 = 2;

myInt1 = myInt1 + myInt2;</pre></div><p>Example 2:</p><div><pre class="programlisting">int myInt1 = 1;
int myInt2 = 2;

myInt1 += myInt2;</pre></div><p>These two pieces of code are equivalent. The first one teaches you about the precedence of operators. There is a table given in <em>Appendix B, Operator Precedence in C and C++</em> with all precedencies. Let's learn some right now.</p><p>
<code class="literal">+</code>, <code class="literal">-</code>, <code class="literal">*</code>, <code class="literal">/</code>, and <code class="literal">%</code> have a greater precedence over <code class="literal">=</code>. That means <code class="literal">myInt1 + myInt2</code> is calculated before the assignment operator, then, the result is assigned to <code class="literal">myInt1</code>.</p><p>The second <a id="id313" class="indexterm"/>one is the condensed version. It is equivalent to the first <a id="id314" class="indexterm"/>version and thus, precedence applies here too. A little tricky<a id="id315" class="indexterm"/> example<a id="id316" class="indexterm"/> is shown as follows:</p><div><pre class="programlisting">int myInt1 = 1;
int myInt2 = 2;

myInt1 += myInt2 + myInt2;</pre></div><p>You need to know that <code class="literal">+</code> has a higher precedence over <code class="literal">+=</code>. It means the order of operations is: first, <code class="literal">myInt2 + myInt2</code> then <code class="literal">myInt1 +</code> the result of the freshly made calculation <code class="literal">myInt2 + myInt2</code>. Then, the result of the second is assigned to <code class="literal">myInt1</code>. This means it is equivalent to:</p><div><pre class="programlisting">int myInt1 = 1;
int myInt2 = 2;

myInt1 = myInt1 + myInt2 + myInt2;</pre></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec44"/>Increment and decrement operators</h2></div></div></div><p>I want to point you to <a id="id317" class="indexterm"/>another <a id="id318" class="indexterm"/>condensed <a id="id319" class="indexterm"/>notation <a id="id320" class="indexterm"/>you'll meet often: the double operator.</p><div><pre class="programlisting">int myInt1 = 1;

myInt++;	// myInt1 now contains 2
myInt--;	// myInt1 now contains 1</pre></div><p>
<code class="literal">++</code> is equivalent to <code class="literal">+=1</code>, <code class="literal">--</code> is equivalent to <code class="literal">-=1</code>. These are called <em>suffix increment</em> (<code class="literal">++</code>) and <em>suffix decrement</em> (<code class="literal">--</code>). They can also be used as <em>prefix</em>. <code class="literal">++</code> and <code class="literal">--</code> as prefixes have lower precedencies than their equivalent used as suffix but in both cases, the precedence is very much higher than <code class="literal">+</code>, <code class="literal">-</code>, <code class="literal">/</code>, <code class="literal">*</code>, and even <code class="literal">=</code> and <code class="literal">+=</code>.</p><p>The following is a condensed table I can give you with the most used cases. In each group, the operators have the same precedence. It drives the expression <code class="literal">myInt++ + 3</code> to be ambiguous. Here, the use of parenthesis helps to define which calculation will be made first.</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Precedencies groups</p>
</th><th style="text-align: left" valign="bottom">
<p>Operators</p>
</th><th style="text-align: left" valign="bottom">
<p>Names</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>2</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">++</code>
</p>
<p>
<code class="literal">--</code>
</p>
<p>
<code class="literal">()</code>
</p>
<p>
<code class="literal">[]</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Suffix increment</p>
<p>Suffix decrement</p>
<p>Function call</p>
<p>Array element access</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>3</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">++</code>
</p>
<p>
<code class="literal">--</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Prefix increment</p>
<p>Prefix decrement</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>5</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">*</code>
</p>
<p>
<code class="literal">/</code>
</p>
<p>
<code class="literal">%</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Multiplication</p>
<p>Division</p>
<p>Modulo</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>6</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">+</code>
</p>
<p>
<code class="literal">-</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Addition</p>
<p>Subtraction</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>16</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">=</code>
</p>
<p>
<code class="literal">+=</code>
</p>
<p>
<code class="literal">-=</code>
</p>
<p>
<code class="literal">*=</code>
</p>
<p>
<code class="literal">/=</code>
</p>
<p>
<code class="literal">%=</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Assignment</p>
<p>Assignment by sum</p>
<p>Assignment by difference</p>
<p>Assignment by product</p>
<p>Assignment by quotient</p>
<p>Assignment by remainder</p>
</td></tr></tbody></table></div><p>I guess you begin to feel a bit better with operators, right? Let's continue with a very important step: types conversion.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec28"/>Types manipulations</h1></div></div></div><p>When you design a <a id="id321" class="indexterm"/>program, there is an important step consisting of choosing the right type for each variable.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec45"/>Choosing the right type</h2></div></div></div><p>Sometimes, the choice is constrained by <a id="id322" class="indexterm"/>external factors. This happens when, for instance, you use the Arduino with an external sensor able to send data coded as integers in 10 bits (210 = 1024 steps of resolution). Would you choose <code class="literal">byte</code> type knowing it only provides a way to store number from 0 to 255? Probably not! You'll choose <code class="literal">int</code>.</p><p>Sometimes you have to choose it yourself. Imagine you have data coming to the board from a Max 6 framework patch on the computer via your serial connection (using USB). Because it is the most convenient, since you designed it like that, the patch pops out <code class="literal">float</code> numbers encapsulated into string messages to the board. After having parsed, cut those messages into pieces to extract the information you need (which is the <code class="literal">float</code> part), would you choose to store it into <code class="literal">int</code>?</p><p>That one is a bit more difficult to answer. It involves a <em>conversion</em> process.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec46"/>Implicit and explicit types conversions</h2></div></div></div><p>Type conversion is the process that changes an entity data type into another. Please <a id="id323" class="indexterm"/>notice I didn't talk about variable, but entity.</p><p>It is a consequence of C design that we can convert only the values stored in variables, others keep their type until their lives end, which is when the program's execution ends.</p><p>Type conversion can be <em>implicitly</em> done or <em>explicitly</em> made. To be sure everyone is with me here, I'll state that <em>implicitly means not visibly and consciously written</em>, compared to <em>explicitly that means specifically written in code</em>, here.</p><div><div><div><div><h3 class="title"><a id="ch03lvl3sec24"/>Implicit type conversion</h3></div></div></div><p>Sometimes, it is also called <em>coercion</em>. This happens<a id="id324" class="indexterm"/> when you don't specify anything for the compiler that has to make an automatic conversion following its own basic (but often smart enough) rules. The classic example is the conversion of a <code class="literal">float</code> value into an <code class="literal">int</code> value.</p><div><pre class="programlisting">float myFloat = 12345.6789 ;
int myInt;
myInt = myFloat;

println(myInt); // displays 12345</pre></div><p>I'm using the assignment operator (<code class="literal">=</code>) to put the content of <code class="literal">myFloat</code> into <code class="literal">myInt</code>. It causes <strong>truncation</strong>
<a id="id325" class="indexterm"/> of the <code class="literal">float</code> value, that is, the <em>removal of the decimal part</em>. You have definitely lost something if you continue to work only with the <code class="literal">myInt</code> variable instead of <code class="literal">myFloat</code>. It can be okay, but you have to keep it in mind.</p><p>Another less classic example is the implicit conversion of <code class="literal">int</code> type to <code class="literal">float</code>. <code class="literal">int</code> doesn't have a decimal part. The implicit conversion to <code class="literal">float</code> won't produce something other than a decimal part that equals zero. This is the easy part.</p><p>But be careful, you could be surprised by the implicit conversion of <code class="literal">int</code> to <code class="literal">float</code>. Integers are encoded over 32 bits, but <code class="literal">float</code>, even if they are 32 bits, have a <em>significand</em> (also called mantissa) encoded over 23 bits. If you don't remember this precisely, it is okay. But I want you to remember this example:</p><div><pre class="programlisting">float myFloat;
long int myInt = 123456789;
void setup(){
  Serial.begin(9600);
  myFloat = myInt;
}

void loop(){
  Serial.println(myFloat); // displays a very strange result
}</pre></div><p>The<a id="id326" class="indexterm"/> output of the code is shown as follows:</p><div><img src="img/7584_03_004.jpg" alt="Implicit type conversion"/><div><p>Strange results from int to float implicit conversion</p></div></div><p>I stored <code class="literal">123456789</code> into a <code class="literal">long int</code> type, which is totally legal (<code class="literal">long int</code> are 32-bits signed integers that are able to store integers<code class="literal"> </code>from <code class="literal">-2147483648</code> to <code class="literal">2147483647</code>). After the assignment, I'm displaying the result that is: <strong>123456792.00</strong>. We expected <code class="literal">123456789.00</code> of course.</p><div><div><h3 class="title"><a id="note16"/>Note</h3><p>Implicit types conversions rules: </p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">long int</code> to <code class="literal">float</code> can cause wrong results</li><li class="listitem" style="list-style-type: disc"><code class="literal">float</code> to <code class="literal">int</code> removes the decimal part</li><li class="listitem" style="list-style-type: disc"><code class="literal">double</code> to <code class="literal">float</code> rounds digit of double</li><li class="listitem" style="list-style-type: disc"><code class="literal">long int</code> to <code class="literal">int</code> drops the encoded higher bits</li></ul></div></div></div></div><div><div><div><div><h3 class="title"><a id="ch03lvl3sec25"/>Explicit type conversion</h3></div></div></div><p>If you want to have predictable <a id="id327" class="indexterm"/>results, every time you can convert types explicitly. There are six conversion functions included in the Arduino core:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">char()</li><li class="listitem" style="list-style-type: disc">int()</li><li class="listitem" style="list-style-type: disc">float()</li><li class="listitem" style="list-style-type: disc">word()</li><li class="listitem" style="list-style-type: disc">byte()</li><li class="listitem" style="list-style-type: disc">long()</li></ul></div><p>We can use them by passing the variable you want to convert as an argument of the function. For instance, <code class="literal">myFloat = float(myInt)</code>; where <code class="literal">myFloat</code> is a <code class="literal">float</code> type and <code class="literal">myInt</code> is an <code class="literal">int</code> type. Don't <a id="id328" class="indexterm"/>worry about the use, we'll use them a bit later in our firmware.</p><div><div><h3 class="title"><a id="note17"/>Note</h3><p>My rule about conversion: Take care of each type conversion you make. None should be obvious for you and it can cause an error in your logic, even if the syntax is totally correct.</p></div></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec29"/>Comparing values and Boolean operators</h1></div></div></div><p>We now know how to store entities into variables, convert values, and choose the right conversion method. We are now going to learn how to compare variable values.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec47"/>Comparison expressions</h2></div></div></div><p>There are six <a id="id329" class="indexterm"/>comparison operators:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">==</code> (equal)</li><li class="listitem" style="list-style-type: disc"><code class="literal">!=</code> (not equal)</li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;</code> (less than)</li><li class="listitem" style="list-style-type: disc"><code class="literal">&gt;</code> (greater than)</li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;=</code> (less than or equal to)</li><li class="listitem" style="list-style-type: disc"><code class="literal">&gt;=</code> (greater than or equal to)</li></ul></div><p>The following is a comparison expression in code:</p><div><pre class="programlisting">int myInt1 = 4;
float myFloat = 5.76;
(myInt1 &gt; myFloat) ;</pre></div><p>An expression like that does nothing, but it is legal. Comparing two elements produces a result and in this small example, it isn't used to trigger or make anything. <code class="literal">myInt1 &gt; myFloat</code> is a comparison expression. The result is, obviously, <code class="literal">true</code> or <code class="literal">false</code>, I mean it is a <code class="literal">boolean</code> value. Here it is <code class="literal">false</code> because <code class="literal">4</code> is not greater than <code class="literal">5.76</code>. We can also combine comparison expressions together to create more complex expressions.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec48"/>Combining comparisons with Boolean operators</h2></div></div></div><p>There are three <a id="id330" class="indexterm"/>Boolean <a id="id331" class="indexterm"/>operators:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">&amp;&amp;</code> (and)</li><li class="listitem" style="list-style-type: disc"><code class="literal">||</code> (or)</li><li class="listitem" style="list-style-type: disc"><code class="literal">!</code> (not)</li></ul></div><p>It is time to remember some logic operations using three small tables. You can read those tables like column element + comparison operator + row element; the result of the operation is at the intersection of the column and the row.</p><p>The binary operator AND, also written as <code class="literal">&amp;&amp;</code>:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">&amp;&amp;</code>
</p>
</td><td style="text-align: left" valign="top">
<p>true</p>
</td><td style="text-align: left" valign="top">
<p>false</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>true</p>
</td><td style="text-align: left" valign="top">
<p>true</p>
</td><td style="text-align: left" valign="top">
<p>false</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>false</p>
</td><td style="text-align: left" valign="top">
<p>false</p>
</td><td style="text-align: left" valign="top">
<p>false</p>
</td></tr></tbody></table></div><p>Then the binary operator OR, also written as ||:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">||</code>
</p>
</td><td style="text-align: left" valign="top">
<p>true</p>
</td><td style="text-align: left" valign="top">
<p>false</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>true</p>
</td><td style="text-align: left" valign="top">
<p>true</p>
</td><td style="text-align: left" valign="top">
<p>true</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>false</p>
</td><td style="text-align: left" valign="top">
<p>true</p>
</td><td style="text-align: left" valign="top">
<p>false</p>
</td></tr></tbody></table></div><p>Lastly, the unary operator NOT, also written as <code class="literal">!</code>:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><tbody><tr><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top">
<p>true</p>
</td><td style="text-align: left" valign="top">
<p>false</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">!</code>
</p>
</td><td style="text-align: left" valign="top">
<p>false</p>
</td><td style="text-align: left" valign="top">
<p>true</p>
</td></tr></tbody></table></div><p>For instance, true <code class="literal">&amp;&amp;</code> false = false, false <code class="literal">||</code> true = true. <code class="literal">&amp;&amp;</code> and <code class="literal">||</code> are <em>binary operators</em>, they can <em>compare</em> two expressions.</p><p>
<code class="literal">!</code> is a <em>unary operator</em> and can only work with one expression, negating it logically. <code class="literal">&amp;&amp;</code> is the logical AND. It is true when both expressions compared are true, false in all other cases. <code class="literal">||</code> is the logic OR. It is true when one expression at least is true, false when they are both false. It is the inclusive OR. <code class="literal">!</code> is the negation operator, the NOT. It basically inverts false and true into true and false.</p><p>These different operations are really useful and necessary when you want to carry out some tests in your code. For instance, if you want to compare a variable to a specific value.</p><div><div><div><div><h3 class="title"><a id="ch03lvl3sec26"/>Combining negation and comparisons</h3></div></div></div><p>Considering two<a id="id332" class="indexterm"/> expressions <a id="id333" class="indexterm"/>A and B:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">NOT(A <code class="literal">&amp;&amp;</code> B) = (NOT A <code class="literal">||</code> NOT B)</li><li class="listitem" style="list-style-type: disc">NOT (A <code class="literal">||</code> B) = (NOT A <code class="literal">&amp;&amp;</code> NOT B)</li></ul></div><p>This can be more than useful when you'll create conditions in your code. For instance, let's consider two expressions with four variables a, b, c, and d:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">a <code class="literal">&lt;</code> b</li><li class="listitem" style="list-style-type: disc">c <code class="literal">&gt;=</code> d</li></ul></div><p>What is the meaning of <code class="literal">!</code>(a <code class="literal">&lt;</code> b)? It is the negation of the expression, where:</p><p>
<code class="literal">!</code>(a <code class="literal">&lt;</code> b) equals (a <code class="literal">&gt;=</code> b)</p><p>The opposite of <em>a strictly smaller than b</em> is <em>a greater than or equal to b</em>. In the same way:</p><p>
<code class="literal">!</code>(c <code class="literal">&gt;=</code> d) equals (c <code class="literal">&lt;</code> d)</p><p>Now, let's combine a bit. Let's negate the global expression:</p><p>(a <code class="literal">&lt;</code> b) <code class="literal">&amp;&amp;</code> (c <code class="literal">&gt;=</code> d) and <code class="literal">!</code>((a <code class="literal">&lt;</code> b) <code class="literal">&amp;&amp;</code> (c <code class="literal">&gt;=</code> d)) equals (<code class="literal">!</code>(a <code class="literal">&lt;</code> b) <code class="literal">||</code> <code class="literal">!</code>(c <code class="literal">&gt;=</code> d)) equals (a <code class="literal">&gt;=</code> b) <code class="literal">||</code> (c <code class="literal">&lt;</code> d)</p><p>Here is another example of combination introducing the <em>operators precedence</em> concept:</p><div><pre class="programlisting">int myInt1 = 4;
float myFloat = 5.76;
int myInt2 = 16;
(myInt1 &gt; myFloat &amp;&amp; myInt2 &lt; myFloat) ;
( (myInt1 &gt; myFloat) &amp;&amp; (myInt2 &lt; myFloat) ) ;</pre></div><p>Both of my statements are equivalent. Precedence occurs here and we can now add these operators to the previous precedencies table (check <em>Appendix B, Operator Precedence in C and C++</em>). I'm adding the comparison operator:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Precedencies groups</p>
</th><th style="text-align: left" valign="bottom">
<p>Operators</p>
</th><th style="text-align: left" valign="bottom">
<p>Names</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>2</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">++</code>
</p>
<p>
<code class="literal">--</code>
</p>
<p>
<code class="literal">()</code>
</p>
<p>
<code class="literal">[]</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Suffix increment</p>
<p>Suffix decrement</p>
<p>Function call</p>
<p>Array element access</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>3</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">++</code>
</p>
<p>
<code class="literal">--</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Prefix increment</p>
<p>Prefix decrement</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>5</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">*</code>
</p>
<p>
<code class="literal">/</code>
</p>
<p>
<code class="literal">%</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Multiplication</p>
<p>Division</p>
<p>Modulo</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>6</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">+</code>
</p>
<p>
<code class="literal">-</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Addition</p>
<p>Subtraction</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>8</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">&lt;</code>
</p>
<p>
<code class="literal">&lt;=</code>
</p>
<p>
<code class="literal">&gt;</code>
</p>
<p>
<code class="literal">&gt;=</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Less than</p>
<p>Less than or equal to</p>
<p>Greater than</p>
<p>Greater than or equal to</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>9</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">==</code>
</p>
<p>
<code class="literal">!=</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Equal to</p>
<p>Not equal to</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>13</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">&amp;&amp;</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Logical AND</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>14</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">||</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Logical OR</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>15</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">?:</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Ternary conditional</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>16</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">=</code>
</p>
<p>
<code class="literal">+=</code>
</p>
<p>
<code class="literal">-=</code>
</p>
<p>
<code class="literal">*=</code>
</p>
<p>
<code class="literal">/=</code>
</p>
<p>
<code class="literal">%=</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Assignment</p>
<p>Assignment by sum</p>
<p>Assignment by difference</p>
<p>Assignment by product</p>
<p>Assignment by quotient</p>
<p>Assignment by remainder</p>
</td></tr></tbody></table></div><p>As usual, I <a id="id334" class="indexterm"/>cheated a bit and added the <a id="id335" class="indexterm"/>precedence group 15 that contains a unique operator, the ternary conditional operator that we will see a bit later. Let's move to conditional structures.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec30"/>Adding conditions in the code</h1></div></div></div><p>Because I studied <a id="id336" class="indexterm"/>Biology and have a Master's diploma, I'm familiar<a id="id337" class="indexterm"/> with organic and living behaviors. I like to tell my students that the code, especially in interaction design fields of work, has to be alive. With Arduino, we often build machines that are able to "feel" the real world and interact with it by <em>acting</em> on it. This couldn't be done without <em>condition</em> statements. This type of statement is called a control structure. We used one conditional structure while we tested our big code including variables display and more.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec49"/>if and else conditional structure</h2></div></div></div><p>This is the one we used <a id="id338" class="indexterm"/>without explaining. You just learned patience and zen. Things begin to come, right? Now, let's explain it. This structure is very intuitive because it is very similar to any conditional pseudo code. Here is one:</p><p>If the value of the variable <code class="literal">a</code> is smaller than the value of variable <code class="literal">b</code>, switch on the LED. Else switch it off.</p><p>Now the real C code, where I simplify the part about the LED by giving a state of 1 or 0 depending on what I want to further do in the code:</p><div><pre class="programlisting">int a;
int b;
int ledState;
if (a &lt; b) {
ledState = 1; 
}
else {
ledState = 0; 
}</pre></div><p>I guess it is clear enough. Here is the general syntax of this structure:</p><div><pre class="programlisting">If (expression) {
// code executed only if expression is true
}
else {
// code executed only if expression is false
}</pre></div><p>Expression evaluation generally results in a Boolean value. But numerical values as a result of an expression in this structure can be okay too, even if a bit less explicit, which I, personally, don't like. An expression resulting in the numerical value <code class="literal">0</code> equals <code class="literal">false</code> in C in Arduino core, and equals <code class="literal">true</code> for any other values.</p><div><div><h3 class="title"><a id="note18"/>Note</h3><p>Being implicit often means making your code shorter and cuter. In my humble opinion, it also means to be very unhappy when you have to support and maintain a code several months later when it includes a bunch of implicit things without any comments.</p><p>I push my students to be explicit and verbose. We are not here to code things to a too small amount of memory, believe me. We are not talking about reducing a 3 megabytes code to 500 kilobytes but more about reducing a 200 kilobytes code to 198 kilobytes.</p></div></div><div><div><div><div><h3 class="title"><a id="ch03lvl4sec09"/>Chaining an if…else structure to another if…else structure</h3></div></div></div><p>The following is the<a id="id339" class="indexterm"/> modified example:</p><div><pre class="programlisting">int a;
int b;
int ledState;
if (a &lt; b) {
ledState = 1; 
}
else if (b &gt; 0) {
ledState = 0; 
}
else {
ledState = 1; 
}</pre></div><p>The first <code class="literal">if</code> test is: if <code class="literal">a</code> is smaller than <code class="literal">b</code>. If it is <code class="literal">true</code>, we put the value <code class="literal">1</code> inside the variable <code class="literal">ledState</code>. If it is <code class="literal">false</code>, we go to the next statement <code class="literal">else</code>.</p><p>This <code class="literal">else</code> contains another test on <code class="literal">b</code>: is <code class="literal">b</code> greater than <code class="literal">0</code>? If it is, we put the value <code class="literal">0</code> inside the variable <code class="literal">ledState</code>. If it is <code class="literal">false</code>, we can go to the last case, the last <code class="literal">else</code>, and we put the value <code class="literal">1</code> inside the variable <code class="literal">ledState</code>.</p><div><div><h3 class="title"><a id="tip05"/>Tip</h3><p>
<strong>One frequent error – missing some cases</strong>
</p><p>Sometimes, the <code class="literal">if</code>… <code class="literal">else</code> chain is so complicated and long that we may miss some case and no case is verified. Be clear and try to check the whole universe of cases and to code the conditions according to it.</p></div></div><p>A nice tip is to try to put all cases on paper and try to find the <em>holes</em>. I mean, where the part of the variable values are not matched by tests.</p></div><div><div><div><div><h3 class="title"><a id="ch03lvl4sec10"/>if…else structure with combined comparisons expressions</h3></div></div></div><p>The following is the <a id="id340" class="indexterm"/>previous example where I commented a bit more:</p><div><pre class="programlisting">int a;
int b;
int ledState;
if (a &lt; b) {     // a &lt; b

ledState = 1; 
}
else if (b &gt; 0) {   // a &gt;= b and b &gt; 0
ledState = 0; 
}
else {       // a &gt;= b and b &lt; 0
ledState = 1; 
}</pre></div><p>We can also write it in the following way considering the comment I wrote previously in the code:</p><div><pre class="programlisting">int a;
int b;
int ledState;
if (a &lt; b || (a &gt;= b &amp;&amp; b &lt; 0) ) {
ledState = 1; 
}
else if (a &gt;= b &amp;&amp; b &gt; 0) {
ledState = 0; 
}</pre></div><p>It could be considered <a id="id341" class="indexterm"/>as a more condensed version where you have all statements for the switch on the LED in one place, same for switching it off.</p></div><div><div><div><div><h3 class="title"><a id="ch03lvl4sec11"/>Finding all cases for a conditional structure</h3></div></div></div><p>Suppose you want to test a <a id="id342" class="indexterm"/>temperature value. You have two specific <a id="id343" class="indexterm"/>limits/points at which you want the Arduino to react and, for instance, alert you by lighting an LED or whatever event to interact with the real world. For instance, the two limits are: 15-degree Celsius and 30-degree Celsius. How to be sure I have all my cases? The best way is to use a pen, a paper, and to draw a bit.</p><div><img src="img/7584_03_05.jpg" alt="Finding all cases for a conditional structure"/><div><p>Checking all possible T values</p></div></div><p>We have three parts:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">T &lt; 15</li><li class="listitem" style="list-style-type: disc">T &gt; 15 but T &lt;30</li><li class="listitem" style="list-style-type: disc">T &gt; 30</li></ul></div><p>So we have three cases:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">T&lt; 15</li><li class="listitem" style="list-style-type: disc">T &gt;15 and T &lt; 30</li><li class="listitem" style="list-style-type: disc">T &gt; 30</li></ul></div><p>What happens when<a id="id344" class="indexterm"/> T = 30 or T = 15? These are holes in our<a id="id345" class="indexterm"/> logic. Depending on how we designed our code, it could happen. Matching all cases would mean: include T = 15 and T = 30 cases too. We can do that as follows:</p><div><pre class="programlisting">float T ; // my temperature variable

if (T &lt; 15) {
colorizeLed(blue);
}
else if (T &gt;= 15 &amp;&amp; T &lt; 30) {
colorizeLed(white);
}
else if (T &gt;= 30) {
colorizeLed(red);
}</pre></div><p>I included these two cases into my comparisons. 15-degree Celsius is included in the second temperature interval and 30-degree Celsius in the last one. This is an example of how we can do it.</p><p>I'd like you to remember to use a pen and a paper in this kind of cases. This will help you to design and especially make some breaks from the IDE that is, in designing steps, really good. Let's now explore a new conditional structure.</p></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec50"/>switch…case…break conditional structure</h2></div></div></div><p>Here, we are going to see a new <a id="id346" class="indexterm"/>conditional structure. The standard syntax is shown as follows:</p><div><pre class="programlisting">switch (var) {
  case label:
  // statements
  break;
  case label:
  // statements
  break;
  default:
  // statements
}</pre></div><p>
<code class="literal">var</code> is compared for equality to each case label. If <code class="literal">var</code> equals a particular <code class="literal">label</code> value, the statements in this case are executed until the next <code class="literal">break</code>. If there is no match and you have used the optional <code class="literal">default:</code> case, the statements of this case are executed. Without the <code class="literal">default:</code> case, nothing is done. <code class="literal">label</code> must be a value, not a character, not string. Let's take a more concrete example:</p><div><pre class="programlisting">float midiCCMessage;
switch (midiCCMessage) {
  case 7:
  changeVolume();
  break;
  case 10:
  changePan();
  break;
  default:
  LedOff();
}</pre></div><p>This <a id="id347" class="indexterm"/>code is equivalent to:</p><div><pre class="programlisting">float midiCCMessage;
if (midiCCMessage == 7) changeVolume();
else if (midiCCMessage == 10) changePan ();
else LedOff();</pre></div><p>Are you okay?</p><div><div><h3 class="title"><a id="note19"/>Note</h3><p>What I want to say is, when you want to compare a variable to many unique values, use <code class="literal">switch</code>…<code class="literal">case</code>…<code class="literal">break</code>, else use <code class="literal">if</code>…<code class="literal">else</code>.</p></div></div><p>When you have comparison intervals, <code class="literal">if</code>…<code class="literal">else</code> is more convenient because you can use <code class="literal">&lt;</code> and <code class="literal">&gt;</code> whereas in <code class="literal">switch</code>…<code class="literal">case</code>…<code class="literal">break</code> you cannot. Of course, we could combine both. But remember to keep your code as simple as you can.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec51"/>Ternary operator</h2></div></div></div><p>This strange notation is often <a id="id348" class="indexterm"/>totally unknown to my students. I used to say, "Hey! This is more C than Arduino" when they answer "That is why we have forgotten about it". Naughty students! This ternary operator takes three elements as input. The syntax is<code class="literal"> (expression) ? val1 : val2</code>.</p><p>The expression is tested. If it is <code class="literal">true</code>, this whole statement returns (or equals) <code class="literal">val1</code>, if it is <code class="literal">false</code>, it equals <code class="literal">val2</code>.</p><p>Again imagine our Arduino, the temperature sensor, and only one limit which is 20 degree Celsius. I want to turn the LED blue if <code class="literal">T</code> is smaller than the limit, and red if <code class="literal">T</code> is greater or equal to 20 degree <a id="id349" class="indexterm"/>Celsius. Here is how we would use the two ternary operators:</p><div><pre class="programlisting">Int T;
Int ledColor; // 0 means blue, 1 means red
ledColor = (T &lt; 20) ? 0 : 1;</pre></div><p>It can be a nice notation, especially if you don't need statement execution in each case but only variable assignments.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec31"/>Making smart loops for repetitive tasks</h1></div></div></div><p>A <strong>loop</strong>
<a id="id350" class="indexterm"/> is a series of events repeating themselves in time. Basically, computers have been designed, at first, to make a lot of calculations repeatedly to save human's time. Designing a loop to <a id="id351" class="indexterm"/>repeat tasks that have to be repeated seems a <a id="id352" class="indexterm"/>natural idea. C natively implements some ways to design loops. Arduino core naturally includes three loop structures:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">for</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">while</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">do</code>…<code class="literal">while</code></li></ul></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec52"/>for loop structure</h2></div></div></div><p>The <code class="literal">for</code> loop <a id="id353" class="indexterm"/>statement is<a id="id354" class="indexterm"/> quite easy to use. It is based on, at least, one counter starting from a particular value you define, and increments or decrements it until another defined value. The syntax is:</p><div><pre class="programlisting">for (declaration &amp; definition ; condition ; increment) {
// statements
}</pre></div><p>The counter is also named <code class="literal">index</code>. I'm showing you a real example here:</p><div><pre class="programlisting">for (int i = 0 ; i &lt; 100 ; i++) {
println(i);
}</pre></div><p>This basic example defines a loop that prints all integers from <code class="literal">0</code> to <code class="literal">99</code>. The declaration/definition of the integer type variable <code class="literal">i</code> is the first element of the <code class="literal">for</code> structure. Then, the condition describes in which case the statements included in this loop have to be executed. At last, the <code class="literal">i++</code> increment occurs.</p><p>Pay attention to the increment element. It is defined with the increment as a suffix. It means here that the increment occurs after the end of the execution of the statements for a considered <code class="literal">i</code> value.</p><p>Let's break the loop for the first two and last two <code class="literal">i</code> values and see what happens. Declaration of the integer variable <code class="literal">i</code> for the first and second iteration is shown as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">i = 0</code>, is <code class="literal">i</code> smaller than <code class="literal">100</code>? yes, <code class="literal">println(0)</code>, increment <code class="literal">i</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">i = 1</code>, is <code class="literal">i</code> smaller than <code class="literal">100</code>? yes, <code class="literal">println(1)</code>, increment <code class="literal">i</code></li></ul></div><p>For the last two iterations the value of <code class="literal">i</code> is shown as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">i = 99</code>, is <code class="literal">i</code> smaller than <code class="literal">100</code>? yes, <code class="literal">println(99)</code>, increment <code class="literal">i</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">i = 100</code>, is <code class="literal">i</code> smaller than <code class="literal">100</code>? no, stop the loop</li></ul></div><p>Of course, the <a id="id355" class="indexterm"/>index could be declared before the <code class="literal">for</code> structure, and only defined inside the <code class="literal">for</code> structure. We could also have declared and defined the variable before and we would have:</p><div><pre class="programlisting">int i = 0;
for ( ; i &lt; 100 ; i++) {
println(i);
}</pre></div><p>This seems a bit strange, but totally legal in C and for the Arduino core too.</p><div><div><h3 class="title"><a id="tip06"/>Tip</h3><p>
<strong>The scope of index</strong>
</p><p>If the index has been declared inside the <code class="literal">for</code> loop parenthesis, its scope is only the <code class="literal">for</code> loop. This means that this variable is <em>not</em> known or <em>not</em> usable outside of the loop.</p></div></div><p>It normally works like that for any variable declared inside the statements of a <code class="literal">for</code> loop. This isn't something to do, even if it is totally legal in C. Why not? Because it would mean you'd declare a variable each time the loop runs, which isn't really smart. It is better to declare it outside of the loop, one time, then to use it inside of it, whatever the purpose (index, or variable to work with inside statements).</p><div><div><div><div><h3 class="title"><a id="ch03lvl3sec28"/>Playing with increment</h3></div></div></div><p>Increment can be something more complex than only using the increment operator.</p><div><div><div><div><h4 class="title"><a id="ch03lvl4sec12"/>More complex increments</h4></div></div></div><p>First, instead of<a id="id356" class="indexterm"/> writing <code class="literal">i++</code>, we could have written <code class="literal">i = i + 1</code>. We can also use other kind of operations like subtraction, multiplication, division, modulo, or combinations. Imagine that you want to print only odd numbers. Odd numbers are all of the form 2n + 1 where <em>n</em> is an integer. Here is the code to print odd numbers from 1 to 99:</p><div><pre class="programlisting">for (int i = 0 ; i &lt; 50 ; i = 2 * i + 1) {
println(i);
}</pre></div><p>First values of <code class="literal">i</code> are: <code class="literal">1</code>, <code class="literal">3</code>, <code class="literal">5</code>, and so on.</p></div><div><div><div><div><h4 class="title"><a id="ch03lvl4sec13"/>Decrements are negative increments</h4></div></div></div><p>I just want to remix<a id="id357" class="indexterm"/> the previous code into something else in order to shake your mind a bit around increments and decrements. Here is another code making the same thing but printing odd numbers from <code class="literal">99</code> to <code class="literal">1</code>:</p><div><pre class="programlisting">for (int i = 50 ; i &gt; 0 ; i = 2 * i - 1) {
println(i);
}</pre></div><p>All right? Let's complicate things a bit.</p></div></div><div><div><div><div><h3 class="title"><a id="ch03lvl3sec29"/>Using imbricated for loops or two indexes</h3></div></div></div><p>It is also possible to use <a id="id358" class="indexterm"/>more than one index in a <code class="literal">for</code> structure. Imagine we want to<a id="id359" class="indexterm"/> calculate a multiplication table until 10 x 10. We have to define two integer variables from 1 to 10 (0 being trivial). These two indexes have to vary from 1 to 10. We can begin by one loop with the index <code class="literal">x</code>:</p><div><pre class="programlisting">for (int x = 1 ; x &lt;= 10 ; x++) {

}</pre></div><p>This is for the first index. The second one is totally similar:</p><div><pre class="programlisting">for (int y = 1 ; y &lt;= 10 ; y++) {

}</pre></div><p>How can I mix those? The answer is the same as the answer to the question: what is a multiplication table? I have to keep one index constant, and multiply it by the other one going from 1 to 10. Then, I have to increment the first one and continue doing the same with the other and so on. Here is how to we do it:</p><div><pre class="programlisting">for (int x = 1 ; x &lt;= 10 ; x++) {

  for (int y = 1 ; y &lt;= 10 ; y++) {
    
    println(x*y);
}
}</pre></div><p>This code<a id="id360" class="indexterm"/> prints all results of <code class="literal">x*y</code> where <code class="literal">x</code> and <code class="literal">y</code> are integers from 1 to 10, one result on each line. Here are the first few steps:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">x = 1</code>, <code class="literal">y = 1</code>… print the result</li><li class="listitem" style="list-style-type: disc"><code class="literal">x = 1</code>, <code class="literal">y = 2</code>… print the result</li><li class="listitem" style="list-style-type: disc"><code class="literal">x = 1</code>, <code class="literal">y = 3</code>… print the result</li></ul></div><p>
<code class="literal">x</code> is<a id="id361" class="indexterm"/> incremented to <code class="literal">2</code> each time the inside <code class="literal">for</code> loop (the one with <code class="literal">y</code>) ends, then <code class="literal">x</code> is fixed to <code class="literal">2</code> and <code class="literal">y</code> grows until <code class="literal">x = 10</code> and <code class="literal">y = 10</code> where the <code class="literal">for</code> loop ends.</p><p>Let's improve it a bit, only for aesthetic purposes. It is also a pretext to tweak and play with the code to make you more comfortable with it. Often, multiplication tables are drawn as follows:</p><div><img src="img/7584_03_006.jpg" alt="Using imbricated for loops or two indexes"/><div><p>Classic view of a multiplication table</p></div></div><p>We need to go to the next line each time one of the index (and only one) reaches the limit which is the value <code class="literal">10</code>.</p><div><pre class="programlisting">for (int x = 1 ; x &lt;= 10 ; x++) {

  for (int y = 1 ; y &lt;= 10 ; y++) {
 
    print(x*y);
}
println(); // add a carriage return &amp; a new line

}</pre></div><p>Check the code, each time <code class="literal">y</code> reaches <code class="literal">10</code>, a new line is created. The <code class="literal">for</code> loop is a powerful structure to repeat tasks. Let's check another structure.</p></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec53"/>while loop structure</h2></div></div></div><p>The<a id="id362" class="indexterm"/> <code class="literal">while</code> loop structure is a bit simpler. Here is the syntax:</p><div><pre class="programlisting">While (expression) {
// statements
}</pre></div><p>The expression<a id="id363" class="indexterm"/> is evaluated as a Boolean, <code class="literal">true</code> or <code class="literal">false</code>. While the expression is <code class="literal">true</code>, statements are executed, then as soon as it will be <code class="literal">false</code>, the loop will end. It obviously, often, requires declaration and definition outside of the <code class="literal">while</code> structure. Here is an example doing the same results than our first <code class="literal">for</code> loop printing all integers from 0 to 99:</p><div><pre class="programlisting">int i = 0;
while (i &lt; 100) {
println(i);
i++;
}</pre></div><p>Indeed, you <em>have</em> to take care of the increment or decrement explicitly inside your statements; I'll say a few words on infinite loops a bit later. We could have condensed the code a bit more by doing that:</p><div><pre class="programlisting">int i = 0;
while (i &lt; 100) {
println(i++); // print the current I value, then increment i
}</pre></div><p>The <code class="literal">while</code> loop structure tests the expression before doing even executing the first statement. Let's check a similar structure doing that differently.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec54"/>do…while loop structure</h2></div></div></div><p>The <code class="literal">do</code>…<code class="literal">while</code> loop <a id="id364" class="indexterm"/>structure<a id="id365" class="indexterm"/> is very similar to the <code class="literal">while</code> structure, but makes its expression evaluation at the end of the loop, which means after the statements execution. Here is the syntax:</p><div><pre class="programlisting">do {
// statements
} while (expression);</pre></div><p>Here is an example on the same model:</p><div><pre class="programlisting">int i = 0;
do {
println(i);
i++;
} while (i &lt; 100);</pre></div><p>It means that even if the first result of the expression evaluation is <code class="literal">false</code>, the statements will be executed on time. This is not the case with the <code class="literal">while</code> structure.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec55"/>Breaking the loops</h2></div></div></div><p>We learned how to <a id="id366" class="indexterm"/>create loops driven by indexes that define precisely how these loops will live. But how can we stop a loop when an <em>external</em> event occurs? External is taken in the sense of external to the loop itself including its indexes. In that case, the loop's condition itself wouldn't include the external element.</p><p>Imagine that we have a process running 100 times in <em>normal</em> conditions. But we want to interrupt it, or modify it according to another variable that has a greater scope (declared outside of the loop, at least).</p><p>Thanks to the <code class="literal">break</code> statement for making that possible for us. <code class="literal">break;</code> is the basic syntax. When <code class="literal">break</code> is executed, it exits the current loop, whatever it is, based on: <code class="literal">do</code>, <code class="literal">for</code>, and <code class="literal">while</code>. You already saw <code class="literal">break</code> when we talked about the <code class="literal">switch</code> conditional structure. Let's illustrate that.</p><p>Imagine a LED. We want its intensity to grow from 0 to 100 percent then to go back to 0, every time. But we also want to use a nice distance sensor that resets this loop each time the distance between a user and the sensor is greater than a value.</p><div><div><h3 class="title"><a id="note20"/>Note</h3><p>It is based on a real installation I made for a museum where a system has to make a LED blink smoothly when the user was far and to switch off the LED when the user was near, like a living system calling for users to meet it.</p></div></div><p>I designed it very simply as follows:</p><div><pre class="programlisting">for ( intensity = 0 ; intensity &lt; 100 ; intensity++ ){
  ledIntensity (intensity);
  if (distance &gt; maxDistance) { // if the user is far
    intensity = 0;    // switch off the LED
    break;      // exits the loop
  }
}</pre></div><p>This whole loop was included inside the global <code class="literal">loop()</code> function<a id="id367" class="indexterm"/> in the Arduino board and the complete test about the distance was executed each time the <code class="literal">loop()</code> function occurs, waiting for users.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec56"/>Infinite loops are not your friends</h2></div></div></div><p>Be careful of <a id="id368" class="indexterm"/>infinite loops. The problem isn't really the infinite state of loops, but the fact that a system, whatever it is including Arduino, which is running an infinite loop does only that! Nothing that is after the loop can be executed because the program won't go outside the loop.</p><p>If you understand me correctly, <code class="literal">loop()</code>—the basic Arduino core function—is an infinite loop. But it is a controlled loop well designed and Arduino core based. It can (and is) interrupted when functions are called or other special events occur, letting us, users, design what we need inside of this loop. I used to call "the event's driver and listener" because it is the place where our main program runs.</p><p>There are many ways to create infinitely looped processes. You can define a variable in <code class="literal">setup()</code>, making it grow in <code class="literal">loop()</code> and test it each time <code class="literal">loop()</code> runs in order to reset it to the initial value, for instance. It takes benefits of the already existing <code class="literal">loop()</code> loop. Here is this example in C for Arduino:</p><div><pre class="programlisting">int i;

void setup(){
  i = 0;
}

void loop(){
if (i &lt; threshold) i +=1 ;
else i = 0;
// some statements	
}</pre></div><p>This <code class="literal">i</code> grows from <code class="literal">0</code> to <code class="literal">threshold – 1</code> then goes back to <code class="literal">0</code>, grows again, infinitely, taking benefits of <code class="literal">loop()</code>.</p><p>There are also other ways to run loops infinitely in a controlled manner that we'll see a bit later in the more advanced part of the book, but you have been warned: take care of those infinite loops.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec32"/>Summary</h1></div></div></div><p>We learned a lot of abstract things in this important chapter. From type to operator's precedencies, to conditional structure, now we are going to learn new structures and syntaxes that will help us make more efficient blocks of code and, especially, more reusable ones. We can now learn about functions. Let's dive into the next C/C++ knowledge chapters and we will be able to test our Arduino after that.</p></div></body></html>