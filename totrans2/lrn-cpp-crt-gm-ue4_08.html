<html><head></head><body>
<div class="book" title="Chapter&#xA0;8.&#xA0;Actors and Pawns" id="1LCVG1-dd4a3f777fc247568443d5ffb917736d"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch08" class="calibre1"/>Chapter 8. Actors and Pawns</h1></div></div></div><p class="calibre9">Now we will really delve into <a id="id309" class="calibre1"/>UE4 code. At first, it is going to look daunting. The UE4 class framework is massive, but don't worry. The framework is massive, so your code doesn't have to be. You will find that you can get a lot done and a lot onto the screen using relatively less code. This is because the UE4 engine code is so extensive and well programmed that they have made it possible to get almost any game-related task done easily. Just call the right functions, and voila, what you want to see will appear on the screen. The entire notion of a framework is that it is designed to let you get the gameplay you want, without having to spend a lot of time in sweating out the details.</p></div>

<div class="book" title="Chapter&#xA0;8.&#xA0;Actors and Pawns" id="1LCVG1-dd4a3f777fc247568443d5ffb917736d">
<div class="book" title="Actors versus pawns"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_1"><a id="ch08lvl1sec54" class="calibre1"/>Actors versus pawns</h1></div></div></div><p class="calibre9">In this chapter, we <a id="id310" class="calibre1"/>will discuss actors and pawns. Although it sounds as if pawns will be a more basic class than actors, it is actually the other way around. A UE4 actor (the <code class="email">Actor</code> class) object is the basic type of the things that can be placed in the UE4 game world. In order to place anything in the UE4 world, you must derive from the <code class="email">Actor</code> class.</p><p class="calibre9">A <code class="email">Pawn</code> is <a id="id311" class="calibre1"/>an<a id="id312" class="calibre1"/> object that represents something that you or the computer's <span class="strong"><strong class="calibre2">Artificial Intelligence</strong></span> (<span class="strong"><strong class="calibre2">AI</strong></span>)<a id="id313" class="calibre1"/> can control on the screen. The <code class="email">Pawn</code> class derives from the <code class="email">Actor</code> class, with the additional ability to be controlled by the player directly or by an AI script. When a pawn or actor is controlled by a controller or AI, it is said to be possessed by that controller or AI.</p><p class="calibre9">Think of the <code class="email">Actor</code> class as a character in a play. Your game world is going to be composed of a bunch of <span class="strong"><em class="calibre10">actors</em></span>, all acting together to make the gameplay work. The game characters, <span class="strong"><strong class="calibre2">Non-player Characters</strong></span> (<span class="strong"><strong class="calibre2">NPC</strong></span>s), and<a id="id314" class="calibre1"/> even treasure chests will be actors.</p></div></div>
<div class="book" title="Creating a world to put your actors in"><div class="book" id="1MBG22-dd4a3f777fc247568443d5ffb917736d"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch08lvl1sec55" class="calibre1"/>Creating a world to put your actors in</h1></div></div></div><p class="calibre9">Here, we will start from scratch and create a basic level into which we can put our game characters.</p><p class="calibre9">The UE4 team has<a id="id315" class="calibre1"/> already done a great job of presenting how the world editor can be used to create a world in UE4. I want you to take a moment to create your own world.</p><p class="calibre9">First, create a new, blank UE4 project to get started. To do this, in the Unreal Launcher, click on the <span class="strong"><strong class="calibre2">Launch</strong></span> button beside your most recent engine installation, as shown in the following screenshot:</p><div class="mediaobject"><img src="../images/00075.jpeg" alt="Creating a world to put your actors in" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">That will launch the Unreal Editor. The Unreal Editor is used to visually edit your game world. You're going to spend a lot of time in the Unreal Editor, so please take your time to experiment and play around with it.</p><p class="calibre9">I will only cover <a id="id316" class="calibre1"/>the basics of how to work with the UE4 editor. You will need to let your creative juices flow, however, and invest some time in order to become familiar with the editor.</p><div class="note" title="Note"><h3 class="title2"><a id="tip46" class="calibre1"/>Tip</h3><p class="calibre9">To learn more about the <a id="id317" class="calibre1"/>UE4 editor, take a look at the <span class="strong"><em class="calibre10">Getting Started: Introduction to the UE4 Editor</em></span> playlist, which is available at <a class="calibre1" href="https://www.youtube.com/playlist?list=PLZlv_N0_O1gasd4IcOe9Cx9wHoBB7rxFl">https://www.youtube.com/playlist?list=PLZlv_N0_O1gasd4IcOe9Cx9wHoBB7rxFl</a>.</p></div><p class="calibre9">Once you've launched the UE4 editor, you will be presented with the <span class="strong"><strong class="calibre2">Projects</strong></span> dialog. The following screenshot shows the steps to be performed with numbers corresponding to the order in which they need to be performed:</p><div class="mediaobject"><img src="../images/00076.jpeg" alt="Creating a world to put your actors in" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Perform the following steps to create a project:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Select the <span class="strong"><strong class="calibre2">New Project</strong></span> tab at the top of the screen.</li><li class="listitem" value="2">Click on the <span class="strong"><strong class="calibre2">C++</strong></span> tab (the second subtab).</li><li class="listitem" value="3">Then select <span class="strong"><strong class="calibre2">Basic Code</strong></span> from the available projects listing.</li><li class="listitem" value="4">Set the directory where your project is located (mine is <span class="strong"><strong class="calibre2">Y:\Unreal Projects\</strong></span>). Choose a hard disk location with a lot of space (the final project will be around 1.5 GB).</li><li class="listitem" value="5">Name your project. I called mine <span class="strong"><strong class="calibre2">GoldenEgg</strong></span>.</li><li class="listitem" value="6">Click on <span class="strong"><strong class="calibre2">Create Project</strong></span> to finalize project creation.</li></ol><div class="calibre14"/></div><p class="calibre9">Once you've done this, the<a id="id318" class="calibre1"/> UE4 launcher will launch Visual Studio. There will only be a couple of source files in Visual Studio, but we're not going to touch those now. Make sure that <span class="strong"><strong class="calibre2">Development Editor</strong></span> is selected from the <span class="strong"><strong class="calibre2">Configuration Manager</strong></span> dropdown at the top of the screen, as shown in the following screenshot:</p><div class="mediaobject"><img src="../images/00077.jpeg" alt="Creating a world to put your actors in" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Now launch your project by pressing <span class="strong"><em class="calibre10">Ctrl</em></span> + <span class="strong"><em class="calibre10">F5</em></span> in Visual Studio. You will find yourself in the Unreal Engine 4 editor, as shown in the following screenshot:</p><div class="mediaobject"><img src="../images/00078.jpeg" alt="Creating a world to put your actors in" class="calibre11"/></div><p class="calibre12"> </p></div>

<div class="book" title="The UE4 editor" id="1NA0K1-dd4a3f777fc247568443d5ffb917736d"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch08lvl1sec56" class="calibre1"/>The UE4 editor</h1></div></div></div><p class="calibre9">We will <a id="id319" class="calibre1"/>explore the UE4 editor here. We'll start with the controls since it is important to know how to navigate in Unreal.</p></div>

<div class="book" title="The UE4 editor" id="1NA0K1-dd4a3f777fc247568443d5ffb917736d">
<div class="book" title="Editor controls"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch08lvl2sec85" class="calibre1"/>Editor controls</h2></div></div></div><p class="calibre9">If you've<a id="id320" class="calibre1"/> never used a 3D editor before, the controls can be quite hard to learn. These are the basic navigation controls while in edit mode:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Use the arrow keys to move around in the scene</li><li class="listitem">Press <span class="strong"><em class="calibre10">Page Up</em></span> or <span class="strong"><em class="calibre10">Page Down</em></span> to go up and down vertically</li><li class="listitem">Left mouse click + drag it left or right to change the direction you are facing</li><li class="listitem">Left mouse click + drag it up or down to <span class="strong"><em class="calibre10">dolly</em></span> (move the camera forward and backward, same as pressing up/down arrow keys)</li><li class="listitem">Right mouse click + drag to change the direction you are facing</li><li class="listitem">Middle mouse click + drag to pan the view</li><li class="listitem">Right mouse click and the <span class="strong"><em class="calibre10">W</em></span>, <span class="strong"><em class="calibre10">A</em></span>, <span class="strong"><em class="calibre10">S</em></span>, and <span class="strong"><em class="calibre10">D</em></span> keys to move around the scene</li></ul></div></div></div>

<div class="book" title="The UE4 editor" id="1NA0K1-dd4a3f777fc247568443d5ffb917736d">
<div class="book" title="Play mode controls"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch08lvl2sec86" class="calibre1"/>Play mode controls</h2></div></div></div><p class="calibre9">Click <a id="id321" class="calibre1"/>on the <span class="strong"><strong class="calibre2">Play</strong></span> button in the bar at the top, as shown in the following screenshot. This will launch the play mode.</p><div class="mediaobject"><img src="../images/00079.jpeg" alt="Play mode controls" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Once you click <a id="id322" class="calibre1"/>on the <span class="strong"><strong class="calibre2">Play</strong></span> button, the controls change. In play mode, the controls are as follows:</p><div class="book"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><em class="calibre10">W</em></span>, <span class="strong"><em class="calibre10">A</em></span>, <span class="strong"><em class="calibre10">S</em></span>, and <span class="strong"><em class="calibre10">D</em></span> keys for movement</li><li class="listitem">The left or right arrow keys to look toward the left and right, respectively</li><li class="listitem">The mouse's motion to change the direction in which you look</li><li class="listitem">The <span class="strong"><em class="calibre10">Esc</em></span> key to exit play mode and return to edit mode</li></ul></div><p class="calibre9">What I suggest you do at this point is try to add a bunch of shapes and objects into the scene and try to color them with different <span class="strong"><em class="calibre10">materials</em></span>.</p></div></div>

<div class="book" title="The UE4 editor" id="1NA0K1-dd4a3f777fc247568443d5ffb917736d">
<div class="book" title="Adding objects to the scene"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch08lvl2sec87" class="calibre1"/>Adding objects to the scene</h2></div></div></div><p class="calibre9">Adding objects to <a id="id323" class="calibre1"/>the scene is as easy as dragging and dropping them in from the <span class="strong"><strong class="calibre2">Content Browser</strong></span> tab. The <span class="strong"><strong class="calibre2">Content Browser</strong></span> tab appears, by default, docked at the left-hand side of the window. If it isn't seen, simply select <span class="strong"><strong class="calibre2">Window</strong></span> and navigate to <span class="strong"><strong class="calibre2">Content Browser</strong></span> in order to make it appear.</p><div class="mediaobject"><img src="../images/00080.jpeg" alt="Adding objects to the scene" class="calibre11"/><div class="caption"><p class="calibre16">Make sure that the Content Browser is visible in order to add objects to your level</p></div></div><p class="calibre12"> </p><p class="calibre9">Next, select the<a id="id324" class="calibre1"/> <span class="strong"><strong class="calibre2">Props</strong></span> folder on the left-hand side of the <span class="strong"><strong class="calibre2">Content Browser</strong></span>.</p><div class="mediaobject"><img src="../images/00081.jpeg" alt="Adding objects to the scene" class="calibre11"/><div class="caption"><p class="calibre16">Drag and drop things from the Content Browser into your game world</p></div></div><p class="calibre12"> </p><p class="calibre9">To resize an object, press <span class="strong"><em class="calibre10">R</em></span> on your keyboard. The manipulators around the object will appear as boxes, which denotes resize mode.</p><div class="mediaobject"><img src="../images/00082.jpeg" alt="Adding objects to the scene" class="calibre11"/><div class="caption"><p class="calibre16">Press <span class="strong"><em class="calibre10">R</em></span> on your keyboard to resize an object</p></div></div><p class="calibre12"> </p><p class="calibre9">In order to change<a id="id325" class="calibre1"/> the material that is used to paint the object, simply drag and drop a new material from the <span class="strong"><strong class="calibre2">Content Browser</strong></span> window inside the <span class="strong"><strong class="calibre2">Materials</strong></span> folder.</p><div class="mediaobject"><img src="../images/00083.jpeg" alt="Adding objects to the scene" class="calibre11"/><div class="caption"><p class="calibre16">Drag and drop a material from the Content Browser's Materials folder to color things with a new color</p></div></div><p class="calibre12"> </p><p class="calibre9">Materials are like paints. You can coat an object with any material you want by simply dragging and dropping the material you desire onto the object you desire it to be coated on. Materials are only skin-deep: they don't change the other properties of an object (such as weight).</p></div></div>

<div class="book" title="Starting from scratch" id="1O8H61-dd4a3f777fc247568443d5ffb917736d"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch08lvl1sec57" class="calibre1"/>Starting from scratch</h1></div></div></div><p class="calibre9">If you want to start <a id="id326" class="calibre1"/>creating a level from scratch, simply click on <span class="strong"><strong class="calibre2">File</strong></span> and navigate to <span class="strong"><strong class="calibre2">New Level...</strong></span>, as shown here:</p><div class="mediaobject"><img src="../images/00084.jpeg" alt="Starting from scratch" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">You can then select<a id="id327" class="calibre1"/> between <span class="strong"><strong class="calibre2">Default</strong></span> and <span class="strong"><strong class="calibre2">Empty Level</strong></span>. I think selecting <span class="strong"><strong class="calibre2">Empty Level</strong></span> is a good idea, for the reasons that are mentioned later.</p><div class="mediaobject"><img src="../images/00085.jpeg" alt="Starting from scratch" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">The new level will be completely black in color to start with. Try dragging and dropping some objects from the <span class="strong"><strong class="calibre2">Content Browser</strong></span> tab again.</p><p class="calibre9">This time, I added a resized shapes / box for the ground plane and textured it with moss, a couple of <span class="strong"><strong class="calibre2">Props</strong></span> / <span class="strong"><strong class="calibre2">SM_Rocks</strong></span>,  <span class="strong"><strong class="calibre2">Particles</strong></span> / <span class="strong"><strong class="calibre2">P_Fire</strong></span>, and most importantly, a light source.</p><p class="calibre9">Be sure to save your map. Here's a snapshot of my map (how does yours look?):</p><div class="mediaobject"><img src="../images/00086.jpeg" alt="Starting from scratch" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">If you want to <a id="id328" class="calibre1"/>change the default level that opens when you launch the editor, go to <span class="strong"><strong class="calibre2">Project Settings</strong></span> | <span class="strong"><strong class="calibre2">Maps &amp; Modes</strong></span>; then you will see a <span class="strong"><strong class="calibre2">Game Default Map</strong></span> and <span class="strong"><strong class="calibre2">Editor Startup Map</strong></span> setting, as shown in the following screenshot:</p><div class="mediaobject"><img src="../images/00087.jpeg" alt="Starting from scratch" class="calibre11"/></div><p class="calibre12"> </p></div>

<div class="book" title="Starting from scratch" id="1O8H61-dd4a3f777fc247568443d5ffb917736d">
<div class="book" title="Adding light sources"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch08lvl2sec88" class="calibre1"/>Adding light sources</h2></div></div></div><p class="calibre9">Note that if your scene <a id="id329" class="calibre1"/>appears completely black, it is possible that you forgot to put a light source into it.</p><p class="calibre9">In the previous scene, the <span class="strong"><strong class="calibre2">P_Fire</strong></span> particle emitter acts as a light source, but it only emits a small amount of light. To<a id="id330" class="calibre1"/> make sure that everything appears well-lit in your scene, you should add a light source, as follows:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Go to <span class="strong"><strong class="calibre2">Window</strong></span> and then click on <span class="strong"><strong class="calibre2">Modes</strong></span> to ensure that the light sources panel is shown:<div class="mediaobject"><img src="../images/00088.jpeg" alt="Adding light sources" class="calibre11"/></div><p class="calibre13"> </p></li><li class="listitem" value="2">Then, from the <span class="strong"><strong class="calibre2">Modes</strong></span> panel, drag one of the <span class="strong"><strong class="calibre2">Lights</strong></span> object into the scene:<div class="mediaobject"><img src="../images/00089.jpeg" alt="Adding light sources" class="calibre11"/></div><p class="calibre13"> </p></li><li class="listitem" value="3">Select the lightbulb and box icon (it looks like a mushroom, but it isn't).</li><li class="listitem" value="4">Click on <span class="strong"><strong class="calibre2">Lights</strong></span> in the left-hand side panel.</li><li class="listitem" value="5">Select the type of light you want and just pull it into your scene.</li></ol><div class="calibre14"/></div><p class="calibre9">If you don't have <a id="id331" class="calibre1"/>a light source, your scene will appear completely black.</p></div></div>

<div class="book" title="Starting from scratch" id="1O8H61-dd4a3f777fc247568443d5ffb917736d">
<div class="book" title="Collision volumes"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch08lvl2sec89" class="calibre1"/>Collision volumes</h2></div></div></div><p class="calibre9">You might <a id="id332" class="calibre1"/>have noticed that, so far, the camera just passes through all the scene geometry, even in play mode. That's not good. Let's make it such that the player can't just walk through the rocks in our scene.</p><p class="calibre9">There are a few different types of collision volumes. Generally, perfect mesh-mesh collisions are way too expensive to do at runtime. Instead, we use an approximation (a bounding volume) to guess the collision volume.</p><div class="book" title="Adding collision detection for the objects editor"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch08lvl3sec20" class="calibre1"/>Adding collision detection for the objects editor</h3></div></div></div><p class="calibre9">The first thing we<a id="id333" class="calibre1"/> have to do is associate a collision volume with each of the rocks in the scene.</p><p class="calibre9">We can do this from the UE4 editor as follows:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Click on an object in the scene for which you want to add a collision volume.</li><li class="listitem" value="2">Right-click on this object in the <span class="strong"><strong class="calibre2">Scene Outliner</strong></span> tab (the default appears on the right-hand side of the screen) and select edit, as shown in the following screenshot:<div class="mediaobject"><img src="../images/00090.jpeg" alt="Adding collision detection for the objects editor" class="calibre11"/></div><p class="calibre13"> </p><div class="note1" title="Note"><h3 class="title2"><a id="note11" class="calibre1"/>Note</h3><p class="calibre9">You will find yourself in the mesh editor.</p></div></li><li class="listitem" value="3">Ensure<a id="id334" class="calibre1"/> that the collision volume is highlighted, at the top of the screen:<div class="mediaobject"><img src="../images/00091.jpeg" alt="Adding collision detection for the objects editor" class="calibre11"/></div><p class="calibre13"> </p></li><li class="listitem" value="4">Go to the <span class="strong"><strong class="calibre2">Collision</strong></span> menu and then click on <span class="strong"><strong class="calibre2">Add Capsule Simplified Collision</strong></span>:<div class="mediaobject"><img src="../images/00092.jpeg" alt="Adding collision detection for the objects editor" class="calibre11"/></div><p class="calibre13"> </p></li><li class="listitem" value="5">The collision<a id="id335" class="calibre1"/> volume, when added successfully, will appear as a bunch of lines surrounding the object, as shown in the following images:<div class="mediaobject"><img src="../images/00093.jpeg" alt="Adding collision detection for the objects editor" class="calibre11"/><div class="caption"><p class="calibre16">The default collision capsule (left) and manually resized versions (right)</p></div></div><p class="calibre13"> </p></li><li class="listitem" value="6">You can resize (<span class="strong"><em class="calibre10">R</em></span>), rotate (<span class="strong"><em class="calibre10">E</em></span>), move (<span class="strong"><em class="calibre10">W</em></span>), and change the collision volume as you wish, the<a id="id336" class="calibre1"/> same way you would manipulate an object in the UE4 editor.</li><li class="listitem" value="7">When you're done with adding collision meshes, try to click on <span class="strong"><strong class="calibre2">Play</strong></span>; you will notice that you can no longer pass through your collidable objects.</li></ol><div class="calibre14"/></div></div></div></div>
<div class="book" title="Adding an actor to the scene" id="1P71O1-dd4a3f777fc247568443d5ffb917736d"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch08lvl1sec58" class="calibre1"/>Adding an actor to the scene</h1></div></div></div><p class="calibre9">Now that we <a id="id337" class="calibre1"/>have a scene up and running, we need to add an actor to the<a id="id338" class="calibre1"/> scene. Let's first add an avatar for the player, complete with a collision volume. To do this, we'll have to inherit from a UE4 <code class="email">GameFramework</code> class.</p></div>

<div class="book" title="Creating a player entity"><div class="book" id="1Q5IA2-dd4a3f777fc247568443d5ffb917736d"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch08lvl1sec59" class="calibre1"/>Creating a player entity</h1></div></div></div><p class="calibre9">In order to <a id="id339" class="calibre1"/>create an onscreen representation of the player, we'll need to derive from the <code class="email">Character</code> class in Unreal.</p></div>

<div class="book" title="Creating a player entity">
<div class="book" title="Inheriting from UE4 GameFramework classes"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch08lvl2sec90" class="calibre1"/>Inheriting from UE4 GameFramework classes</h2></div></div></div><p class="calibre9">UE4 makes<a id="id340" class="calibre1"/> it easy to inherit from the base framework classes. All you have to do is perform the following steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open your project in the UE4 editor.</li><li class="listitem" value="2">Go to <span class="strong"><strong class="calibre2">File</strong></span> and then select <span class="strong"><strong class="calibre2">Add Code to Project...</strong></span>.<div class="mediaobject"><img src="../images/00094.jpeg" alt="Inheriting from UE4 GameFramework classes" class="calibre11"/><div class="caption"><p class="calibre16">Navigating to File | Add Code To Project... will allow you to derive from any of the UE4 GameFramework classes</p></div></div><p class="calibre13"> </p></li><li class="listitem" value="3">From here, choose the base class you want to derive from. You have <span class="strong"><strong class="calibre2">Character</strong></span>, <span class="strong"><strong class="calibre2">Pawn</strong></span>, <span class="strong"><strong class="calibre2">Actor</strong></span>, and so on, but for now, we will derive from <span class="strong"><strong class="calibre2">Character</strong></span>:<div class="mediaobject"><img src="../images/00095.jpeg" alt="Inheriting from UE4 GameFramework classes" class="calibre11"/><div class="caption"><p class="calibre16">Select the UE4 class you want to derive from</p></div></div><p class="calibre13"> </p></li><li class="listitem" value="4">Click <a id="id341" class="calibre1"/>on <span class="strong"><strong class="calibre2">Next &gt;</strong></span> to get this dialog box, where you name the class. I named my player's class <code class="email">Avatar</code>.<div class="mediaobject"><img src="../images/00096.jpeg" alt="Inheriting from UE4 GameFramework classes" class="calibre11"/></div><p class="calibre13"> </p></li><li class="listitem" value="5">Finally, click on <span class="strong"><strong class="calibre2">Create Class</strong></span> to create the class in code, as shown in the preceding screenshot.</li></ol><div class="calibre14"/></div><p class="calibre9">Let UE4 refresh your<a id="id342" class="calibre1"/> Visual Studio project when it asks you. Open the new <code class="email">Avatar.h</code> file from the <span class="strong"><strong class="calibre2">Solution Explorer</strong></span>.</p><p class="calibre9">The code that UE4 generates will look a little weird. Remember the macros that I suggested you avoid in <a class="calibre1" title="Chapter 5. Functions and Macros" href="part0034_split_000.html#10DJ41-dd4a3f777fc247568443d5ffb917736d">Chapter 5</a>, <span class="strong"><em class="calibre10">Functions and Macros</em></span>. The UE4 code uses macros extensively. These macros are used to copy and paste boilerplate starter code that lets your code integrate with the UE4 editor.</p><p class="calibre9">The contents of the <code class="email">Avatar.h</code> file are shown in the following code:</p><div class="note"><pre class="programlisting">#pragma once
// Avatar.h code file
#include "GameFramework/Character.h"
#include "Avatar.generated.h"
UCLASS()
class MYPROJECT_API AAvatar : public ACharacter
{
  GENERATED_UCLASS_BODY()
};</pre></div><p class="calibre9">Let's talk about macros for a moment.</p><p class="calibre9">The <code class="email">UCLASS()</code> macro<a id="id343" class="calibre1"/> basically makes your C++ code class available in the UE4 editor. The <a id="id344" class="calibre1"/>
<code class="email">GENERATED_UCLASS_BODY()</code> macro copies and pastes code that UE4 needs to make your class function properly as a UE4 class.</p><div class="note" title="Note"><h3 class="title2"><a id="tip47" class="calibre1"/>Tip</h3><p class="calibre9">For <code class="email">UCLASS()</code> and <code class="email">GENERATED_UCLASS_BODY()</code>, you don't truly need to understand how UE4 works its magic. You just need to make sure that they are present at the right spot (where they were when you generated the class).</p></div><div class="book" title="Associating a model with the Avatar class"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch08lvl3sec21" class="calibre1"/>Associating a model with the Avatar class</h3></div></div></div><p class="calibre9">Now we need<a id="id345" class="calibre1"/> to associate a model with our character object. In order to do this, we need a model to play with. Fortunately, there is a whole pack of sample models available from the UE4 marketplace for free.</p><div class="book" title="Downloading free models"><div class="book"><div class="book"><div class="book"><h4 class="title3"><a id="ch08lvl4sec02" class="calibre1"/>Downloading free models</h4></div></div></div><p class="calibre9">To create the<a id="id346" class="calibre1"/> player object, we'll download the <span class="strong"><strong class="calibre2">Animation Starter Pack</strong></span> file (which is free) from the <span class="strong"><strong class="calibre2">Marketplace</strong></span> tab.</p><div class="mediaobject"><img src="../images/00097.jpeg" alt="Downloading free models" class="calibre11"/><div class="caption"><p class="calibre16">From the Unreal Launcher, click on Marketplace and search for Animation Starter Pack, which is free at the time of writing this book</p></div></div><p class="calibre12"> </p><p class="calibre9">After you've downloaded the <span class="strong"><strong class="calibre2">Animation Starter Pack</strong></span> file, you will be able to add it to any of the projects you've previously created, as shown in the following screenshot:</p><div class="mediaobject"><img src="../images/00098.jpeg" alt="Downloading free models" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">When you click on<a id="id347" class="calibre1"/> <span class="strong"><strong class="calibre2">Add to project</strong></span> under <span class="strong"><strong class="calibre2">Animation Starter Pack</strong></span>, you will get this pop up, asking which project to add the pack to:</p><div class="mediaobject"><img src="../images/00099.jpeg" alt="Downloading free models" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Simply select <a id="id348" class="calibre1"/>your project and the new artwork will be available in your <span class="strong"><strong class="calibre2">Content Browser</strong></span>.</p></div></div></div></div>

<div class="book" title="Creating a player entity">
<div class="book" title="Loading the mesh"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch08lvl2sec91" class="calibre1"/>Loading the mesh</h2></div></div></div><p class="calibre9">In general, it is<a id="id349" class="calibre1"/> considered a bad practice to hardcode your assets into the game. Hardcoding means that you write C++ code that specifies the asset to load. However, hardcoding<a id="id350" class="calibre1"/> means the loaded asset is part of the final executable, which will mean that changing the asset that is loaded wouldn't be modifiable at runtime. This is a bad practice. It is much better to be able to change the asset loaded during runtime.</p><p class="calibre9">For this reason, we're going to use the UE4 blueprints feature to set up the model mesh and collision capsule of our <code class="email">Avatar</code> class.</p><div class="book" title="Creating a blueprint from our C++ class"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch08lvl3sec22" class="calibre1"/>Creating a blueprint from our C++ class</h3></div></div></div><div class="book"><ol class="orderedlist"><li class="listitem" value="1">This <a id="id351" class="calibre1"/>is really easy. Open the <span class="strong"><strong class="calibre2">Class Viewer</strong></span> tab by navigating to <span class="strong"><strong class="calibre2">Window</strong></span> and then clicking on <span class="strong"><strong class="calibre2">Class Viewer</strong></span>, as shown here:<div class="mediaobject"><img src="../images/00100.jpeg" alt="Creating a blueprint from our C++ class" class="calibre11"/></div><p class="calibre13"> </p></li><li class="listitem" value="2">In the <span class="strong"><strong class="calibre2">Class Viewer</strong></span> dialog, start typing in the name of your C++ class. If you have properly created and exported the class from your C++ code, it will appear, as shown in the following screenshot:<div class="mediaobject"><img src="../images/00101.jpeg" alt="Creating a blueprint from our C++ class" class="calibre11"/></div><p class="calibre13"> </p><div class="note1" title="Note"><h3 class="title2"><a id="tip48" class="calibre1"/>Tip</h3><p class="calibre9">If your <code class="email">Avatar</code> class does not show up, close the editor and compile/run the C++ project again.</p></div></li><li class="listitem" value="3">Right-click <a id="id352" class="calibre1"/>on the class that you want to create a blueprint of (in my case, it's my <span class="strong"><strong class="calibre2">Avatar</strong></span> class).</li><li class="listitem" value="4">Name your blueprint something unique. I called my blueprint <span class="strong"><strong class="calibre2">BP_Avatar</strong></span>.</li><li class="listitem" value="5">Now, open this blueprint for editing, by double-clicking on <span class="strong"><strong class="calibre2">BP_Avatar</strong></span> (it will appear in the <span class="strong"><strong class="calibre2">Class Viewer</strong></span> tab after you add it, just under <span class="strong"><strong class="calibre2">Avatar</strong></span>), as shown in the following screenshot:<div class="mediaobject"><img src="../images/00102.jpeg" alt="Creating a blueprint from our C++ class" class="calibre11"/></div><p class="calibre13"> </p></li><li class="listitem" value="6">You will be presented with the blueprints window for your new <span class="strong"><strong class="calibre2">BP_Avatar</strong></span> object, as shown here:<div class="mediaobject"><img src="../images/00103.jpeg" alt="Creating a blueprint from our C++ class" class="calibre11"/></div><p class="calibre13"> </p><div class="note1" title="Note"><h3 class="title2"><a id="note12" class="calibre1"/>Note</h3><p class="calibre9">From this window, you can attach a model to the <code class="email">Avatar</code> class visually. Again, this is the recommended pattern since artists will typically be the ones setting up their assets for game designers to play with.</p></div></li><li class="listitem" value="7">To set <a id="id353" class="calibre1"/>up the default mesh, click on the <span class="strong"><strong class="calibre2">Defaults</strong></span> button at the top. Scroll down through the properties until you come across <span class="strong"><strong class="calibre2">Mesh</strong></span>.<div class="mediaobject"><img src="../images/00104.jpeg" alt="Creating a blueprint from our C++ class" class="calibre11"/></div><p class="calibre13"> </p></li><li class="listitem" value="8">Click on the dropdown and select <span class="strong"><strong class="calibre2">HeroTPP</strong></span> for your mesh, as shown in the preceding screenshot.</li><li class="listitem" value="9">If <span class="strong"><strong class="calibre2">HeroTPP</strong></span> doesn't appear in the dropdown, make sure that you download and add the<span class="strong"><strong class="calibre2"> Animation Starter Pack</strong></span> to your project. Alternatively, you can add the<a id="id354" class="calibre1"/> yellow <span class="strong"><strong class="calibre2">TutorialTPP</strong></span> model to your project if you select <span class="strong"><strong class="calibre2">Show Engine Content</strong></span> under <span class="strong"><strong class="calibre2">View</strong></span> <span class="strong"><strong class="calibre2">Options</strong></span>:<div class="mediaobject"><img src="../images/00105.jpeg" alt="Creating a blueprint from our C++ class" class="calibre11"/></div><p class="calibre13"> </p></li><li class="listitem" value="10">What about the collision volume? Click on the <span class="strong"><strong class="calibre2">Components</strong></span> tab in the blueprint editor for your avatar:<div class="mediaobject"><img src="../images/00106.jpeg" alt="Creating a blueprint from our C++ class" class="calibre11"/><div class="caption"><p class="calibre16">If your capsule doesn't encapsulate your model, adjust the model so that it fits</p></div></div><p class="calibre13"> </p><div class="note1" title="Note"><h3 class="title2"><a id="note13" class="calibre1"/>Note</h3><p class="calibre9">If your model ended up like mine, the capsule is off the mark! We need to adjust it.</p></div></li><li class="listitem" value="11">Click on<a id="id355" class="calibre1"/> the blue Avatar model and press the <span class="strong"><em class="calibre10">W</em></span> key. Move him down until he fits inside the capsule. If the capsule isn't big enough, you can adjust its size in the <span class="strong"><strong class="calibre2">Details</strong></span> tab under <span class="strong"><strong class="calibre2">Capsule Height</strong></span> and <span class="strong"><strong class="calibre2">Capsule Radius</strong></span>, as shown in the following screenshot:<div class="mediaobject"><img src="../images/00107.jpeg" alt="Creating a blueprint from our C++ class" class="calibre11"/><div class="caption"><p class="calibre16">You can stretch your capsule by adjusting the Capsule Height property</p></div></div><p class="calibre13"> </p></li><li class="listitem" value="12">Now, we're ready <a id="id356" class="calibre1"/>to add this avatar to the game world. Click and drag your <span class="strong"><strong class="calibre2">BP_Avatar</strong></span> model from the <span class="strong"><strong class="calibre2">Class Viewer</strong></span> tab to your scene in the UE4 editor.<div class="mediaobject"><img src="../images/00108.jpeg" alt="Creating a blueprint from our C++ class" class="calibre11"/><div class="caption"><p class="calibre16">Our Avatar class added to the scene, in a T-pose</p></div></div><p class="calibre13"> </p></li></ol><div class="calibre14"/></div><p class="calibre9">The pose of Avatar<a id="id357" class="calibre1"/> is called the T-pose. Animators often leave their characters in this default pose. Animations can be applied to the character in order to make them change this default pose to something more interesting. You want him animated, you say! Well, that's easy.</p><p class="calibre9">Under the <span class="strong"><strong class="calibre2">Defaults</strong></span> tab in the blueprint editor, just above <span class="strong"><strong class="calibre2">Mesh</strong></span>, there is an <span class="strong"><strong class="calibre2">Animation</strong></span> section where you can select the active animation on your <span class="strong"><strong class="calibre2">Mesh</strong></span>. If you wish to use a certain animation asset, simply click on the drop-down menu and choose the animation you desire to show.</p><p class="calibre9">A better thing to do, however, is to use a blueprint for the animation. This way, an artist can properly set the animation based on what the character is doing. If you select <span class="strong"><strong class="calibre2">Use Animation Blueprint</strong></span> from <span class="strong"><strong class="calibre2">Animation Mode</strong></span> and then select <span class="strong"><strong class="calibre2">ASP_HeroTPP_AnimBlueprint</strong></span> from the drop-down menu, the character will appear to behave much better in the game, because the animation will be adjusted by the blueprint (which would have been done by an artist) as the character moves.</p><div class="mediaobject"><img src="../images/00109.jpeg" alt="Creating a blueprint from our C++ class" class="calibre11"/></div><p class="calibre12"> </p><div class="note" title="Note"><h3 class="title2"><a id="tip49" class="calibre1"/>Tip</h3><p class="calibre9">We can't cover everything here. Animation blueprints are covered in <a class="calibre1" title="Chapter 11. Monsters" href="part0076_split_000.html#28FAO1-dd4a3f777fc247568443d5ffb917736d">Chapter 11</a>, <span class="strong"><em class="calibre10">Monsters</em></span>. If you're really interested in animation, it also wouldn't be a bad idea to sit through a couple of Gnomon Workshop tutorials on IK, animation, and rigging, such as Alex Alvarez's <a id="id358" class="calibre1"/>
<span class="strong"><em class="calibre10">Rigging 101 </em></span>class at <a class="calibre1" href="http://www.thegnomonworkshop.com/store/product/768/Rigging-101">http://www.thegnomonworkshop.com/store/product/768/Rigging-101</a>.</p></div><p class="calibre9">One more thing: let's <a id="id359" class="calibre1"/>make the camera for the Avatar appear behind it. This will give you a third person's point-of-view, which will allow you to see the whole character, as shown in the following screenshot with the corresponding steps:</p><div class="mediaobject"><img src="../images/00110.jpeg" alt="Creating a blueprint from our C++ class" class="calibre11"/></div><p class="calibre12"> </p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">In the <span class="strong"><strong class="calibre2">BP_Avatar</strong></span> blueprint editor, click on the <span class="strong"><strong class="calibre2">Components</strong></span> tab.</li><li class="listitem" value="2">Click on <span class="strong"><strong class="calibre2">Add Component</strong></span>.</li><li class="listitem" value="3">Choose to add a <span class="strong"><strong class="calibre2">Camera</strong></span>.</li></ol><div class="calibre14"/></div><p class="calibre9">A camera will <a id="id360" class="calibre1"/>appear in the viewport. You can click on the camera and move it around. Position the camera so that it is somewhere behind the player. Make sure that the blue arrow on the player is facing the same direction as the camera. If it isn't, rotate the Avatar model mesh so that it faces the same direction as its blue-colored arrow.</p><div class="mediaobject"><img src="../images/00111.jpeg" alt="Creating a blueprint from our C++ class" class="calibre11"/><div class="caption"><p class="calibre16">The blue-colored arrow on your model mesh indicates the forward direction for the model mesh. Make sure that the camera's opening faces the same direction as the character's forward vector</p></div></div><p class="calibre12"> </p></div></div></div>

<div class="book" title="Writing C++ code that controls the game's character"><div class="book" id="1R42S2-dd4a3f777fc247568443d5ffb917736d"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch08lvl1sec60" class="calibre1"/>Writing C++ code that controls the game's character</h1></div></div></div><p class="calibre9">When<a id="id361" class="calibre1"/> you launch your UE4 game, you might notice that the camera is a default, free-flying camera. What we will do now is make the starting character an instance of our <code class="email">Avatar</code> class and control our character using the keyboard.</p></div>

<div class="book" title="Writing C++ code that controls the game's character">
<div class="book" title="Making the player an instance of the Avatar class"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch08lvl2sec92" class="calibre1"/>Making the player an instance of the Avatar class</h2></div></div></div><p class="calibre9">In the<a id="id362" class="calibre1"/> Unreal Editor, create a subclass of <span class="strong"><strong class="calibre2">Game Mode</strong></span> by navigating to <span class="strong"><strong class="calibre2">File</strong></span> | <span class="strong"><strong class="calibre2">Add Code To Project...</strong></span> and selecting <span class="strong"><strong class="calibre2">Game Mode</strong></span>. I named mine <span class="strong"><strong class="calibre2">GameModeGoldenEgg</strong></span>.</p><div class="mediaobject"><img src="../images/00112.jpeg" alt="Making the player an instance of the Avatar class" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">The UE4 <span class="strong"><strong class="calibre2">GameMode</strong></span> contains<a id="id363" class="calibre1"/> the rules of the game and describes how the game is played to the engine. We will work more with our <code class="email">GameMode</code> class later. For now, we need to subclass it.</p><p class="calibre9">Recompile your project from Visual Studio, so you can create a <span class="strong"><strong class="calibre2">GameModeGoldenEgg</strong></span> blueprint. Create the <span class="strong"><strong class="calibre2">GameMode</strong></span> blueprint by going to the <span class="strong"><strong class="calibre2">Blueprints</strong></span> icon in the menu bar at the top, clicking on <span class="strong"><strong class="calibre2">GameMode</strong></span>, and then selecting <span class="strong"><strong class="calibre2">+ Create</strong></span> | <span class="strong"><strong class="calibre2">GameModeGoldenEgg</strong></span> (or whatever you named your <span class="strong"><strong class="calibre2">GameMode</strong></span> subclass in step 1).</p><div class="mediaobject"><img src="../images/00113.jpeg" alt="Making the player an instance of the Avatar class" class="calibre11"/></div><p class="calibre12"> </p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Name your blueprint; I called mine <span class="strong"><strong class="calibre2">BP_GameModeGoldenEgg</strong></span>, as shown in the following screenshot:<div class="mediaobject"><img src="../images/00114.jpeg" alt="Making the player an instance of the Avatar class" class="calibre11"/></div><p class="calibre13"> </p></li><li class="listitem" value="2">Your newly<a id="id364" class="calibre1"/> created blueprint will open in the blueprint editor. If it doesn't, you can open the <span class="strong"><strong class="calibre2">BP_GameModeGoldenEgg</strong></span> class from the <span class="strong"><strong class="calibre2">Class Viewer</strong></span> tab.</li><li class="listitem" value="3">Select your <span class="strong"><strong class="calibre2">BP_Avatar</strong></span> class from the <span class="strong"><strong class="calibre2">Default Pawn Class</strong></span> panel, as shown in the following screenshot. The <span class="strong"><strong class="calibre2">Default Pawn Class</strong></span> panel is the type of object that will be used for the player.<div class="mediaobject"><img src="../images/00115.jpeg" alt="Making the player an instance of the Avatar class" class="calibre11"/></div><p class="calibre13"> </p></li><li class="listitem" value="4">Now, launch your game. You can see a back view as the camera is placed behind the place, as shown here:<div class="mediaobject"><img src="../images/00116.jpeg" alt="Making the player an instance of the Avatar class" class="calibre11"/></div><p class="calibre13"> </p></li></ol><div class="calibre14"/></div><p class="calibre9">You'll notice<a id="id365" class="calibre1"/> that you can't move. Why is that? The answer is because we haven't set up the controller inputs yet.</p></div></div>

<div class="book" title="Writing C++ code that controls the game's character">
<div class="book" title="Setting up controller inputs"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch08lvl2sec93" class="calibre1"/>Setting up controller inputs</h2></div></div></div><div class="book"><ol class="orderedlist"><li class="listitem" value="1">To <a id="id366" class="calibre1"/>set up <a id="id367" class="calibre1"/>controller inputs, go to <span class="strong"><strong class="calibre2">Settings</strong></span> | <span class="strong"><strong class="calibre2">Project Settings...</strong></span>:<div class="mediaobject"><img src="../images/00117.jpeg" alt="Setting up controller inputs" class="calibre11"/></div><p class="calibre13"> </p></li><li class="listitem" value="2">Next, in<a id="id368" class="calibre1"/> the<a id="id369" class="calibre1"/> left-hand side panel, scroll down until you see <span class="strong"><strong class="calibre2">Input</strong></span> under <span class="strong"><strong class="calibre2">Engine</strong></span>.<div class="mediaobject"><img src="../images/00118.jpeg" alt="Setting up controller inputs" class="calibre11"/></div><p class="calibre13"> </p></li><li class="listitem" value="3">On the right-hand side, you can set up some <span class="strong"><strong class="calibre2">Bindings</strong></span>. Click on the small arrow next to <span class="strong"><strong class="calibre2">Axis Mappings</strong></span> in order to expand it. Add just two axis mappings to start, one called <span class="strong"><strong class="calibre2">Forward</strong></span> (connected to the keyboard letter <span class="strong"><em class="calibre10">W</em></span>) and one called <span class="strong"><strong class="calibre2">Strafe</strong></span> (connected to the keyboard letter <span class="strong"><em class="calibre10">D</em></span>). Remember the names that you set; we will look them up in C++ code in just a moment.</li><li class="listitem" value="4">Close<a id="id370" class="calibre1"/> the <span class="strong"><strong class="calibre2">Project Settings</strong></span> dialog. Now, open your C++ code.</li></ol><div class="calibre14"/></div><p class="calibre9">In the <code class="email">Avatar.h</code> constructor, you <a id="id371" class="calibre1"/>need to add three member function declarations, as shown here:</p><div class="note"><pre class="programlisting">UCLASS()
class GOLDENEGG_API AAvatar : public ACharacter
{
  GENERATED_UCLASS_BODY()

  // New! These 3 new member function declarations
  // they will be used to move our player around!
  void SetupPlayerInputComponent(class UInputComponent*  InputComponent) override;
  void MoveForward( float amount );
  void MoveRight( float amount );
};</pre></div><p class="calibre9">Notice how the first member function we're adding (<code class="email">SetupPlayerInputComponent</code>) is an override of a virtual function. <code class="email">SetupPlayerInputComponent</code> is a virtual function in the <code class="email">APawn</code> base class.</p><p class="calibre9">In the <code class="email">Avatar.cpp</code> file, you need to put the function bodies. Add the following member function definitions:</p><div class="note"><pre class="programlisting">void AAvatar::SetupPlayerInputComponent(class UInputComponent* InputComponent)
{
  check(InputComponent);
  InputComponent-&gt;BindAxis("Forward", this,  &amp;AAvatar::MoveForward);
  InputComponent-&gt;BindAxis("Strafe", this, &amp;AAvatar::MoveRight);
}</pre></div><p class="calibre9">This member function looks up the <span class="strong"><strong class="calibre2">Forward</strong></span> and <span class="strong"><strong class="calibre2">Strafe</strong></span> axis bindings that we just created in Unreal Editor and connects them to the member functions inside the <code class="email">this</code> class. Which member functions should we connect to? Why, we should connect to <code class="email">AAvatar::MoveForward</code> and <code class="email">AAvatar::MoveRight</code>. Here are the member function definitions for these two functions:</p><div class="note"><pre class="programlisting">void AAvatar::MoveForward( float amount )
{
  // Don't enter the body of this function if Controller is
  // not set up yet, or if the amount to move is equal to 0
  if( Controller &amp;&amp; amount )
  {
    FVector fwd = GetActorForwardVector();
    // we call AddMovementInput to actually move the
    // player by `amount` in the `fwd` direction
    AddMovementInput(fwd, amount);
  }
}

void AAvatar::MoveRight( float amount )
{
  if( Controller &amp;&amp; amount )
  {
    FVector right = GetActorRightVector();
    AddMovementInput(right, amount);
  }
}</pre></div><div class="note" title="Note"><h3 class="title2"><a id="tip50" class="calibre1"/>Tip</h3><p class="calibre9">The <code class="email">Controller</code> object and the <code class="email">AddMovementInput</code> functions are defined in the <code class="email">APawn</code> base<a id="id372" class="calibre1"/> class. Since<a id="id373" class="calibre1"/> the <code class="email">Avatar</code> class derives from <code class="email">ACharacter</code>, which in turn derives from <code class="email">APawn</code>, we get free use of all the member functions in the base class <code class="email">APawn</code>. Now do you see the beauty of inheritance and code reuse?</p></div><div class="book" title="Exercise"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch08lvl3sec23" class="calibre1"/>Exercise</h3></div></div></div><p class="calibre9">Add axis <a id="id374" class="calibre1"/>bindings and C++ functions to move the player to the left and back.</p><div class="note" title="Note"><h3 class="title2"><a id="note14" class="calibre1"/>Note</h3><p class="calibre9">Here' a hint: you only need to add axis bindings if you realize going backwards is only the negative of going forward.</p></div></div><div class="book" title="Solution"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch08lvl3sec24" class="calibre1"/>Solution</h3></div></div></div><p class="calibre9">Enter two <a id="id375" class="calibre1"/>extra axis bindings by navigating to <span class="strong"><strong class="calibre2">Settings</strong></span> | <span class="strong"><strong class="calibre2">Project Settings...</strong></span> | <span class="strong"><strong class="calibre2">Input</strong></span>, as shown here:</p><div class="mediaobject"><img src="../images/00119.jpeg" alt="Solution" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Scale<a id="id376" class="calibre1"/> the <span class="strong"><strong class="calibre2">S</strong></span> and <span class="strong"><strong class="calibre2">A</strong></span> inputs by -1.0. This will invert the axis. So pressing the <span class="strong"><em class="calibre10">S</em></span> key in the game will move the player forward. Try it!</p><p class="calibre9">Alternatively, you can define two completely separate member functions in your <code class="email">AAvatar</code> class, as follows, and bind the <span class="strong"><em class="calibre10">A</em></span> and <span class="strong"><em class="calibre10">S</em></span> keys to <code class="email">AAvatar::MoveLeft</code> and <code class="email">AAvatar::MoveBack</code>, respectively:</p><div class="note"><pre class="programlisting">void AAvatar::MoveLeft( float amount )
{
  if( Controller &amp;&amp; amount )
  {
    FVector left = -GetActorRightVector();
    AddMovementInput(left, amount);
  }
}
void AAvatar::MoveBack( float amount )
{
  if( Controller &amp;&amp; amount )
  {
    FVector back = -GetActorForwardVector();
    AddMovementInput(back, amount);
  }
}</pre></div></div></div></div>

<div class="book" title="Writing C++ code that controls the game's character">
<div class="book" title="Yaw and pitch"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch08lvl2sec94" class="calibre1"/>Yaw and pitch</h2></div></div></div><p class="calibre9">We can change <a id="id377" class="calibre1"/>the direction in which the <a id="id378" class="calibre1"/>player looks by setting the yaw and pitch of the controller.</p><p class="calibre9">All we have to do here is add in new axis bindings for the mouse, as shown in the following screenshot:</p><div class="mediaobject"><img src="../images/00120.jpeg" alt="Yaw and pitch" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">From C++, you need to add in two new member function declarations to <code class="email">AAvatar.h</code>:</p><div class="note"><pre class="programlisting">void Yaw( float amount );
void Pitch( float amount );</pre></div><p class="calibre9">The bodies of these member functions will go in the <code class="email">AAvatar.cpp</code> file:</p><div class="note"><pre class="programlisting">void AAvatar::Yaw( float amount )
{
  AddControllerYawInput(200.f * amount * GetWorld()- &gt;GetDeltaSeconds());
}
void AAvatar::Pitch( float amount )
{
  AddControllerPitchInput(200.f * amount * GetWorld()- &gt;GetDeltaSeconds());
}</pre></div><p class="calibre9">Then, add two lines to <code class="email">SetupPlayerInputComponent</code>:</p><div class="note"><pre class="programlisting">void AAvatar::SetupPlayerInputComponent(class UInputComponent*  InputComponent)
{
  // .. as before, plus:
  InputComponent-&gt;BindAxis("Yaw", this, &amp;AAvatar::Yaw);
  InputComponent-&gt;BindAxis("Pitch", this, &amp;AAvatar::Pitch);
}</pre></div><p class="calibre9">Here, notice<a id="id379" class="calibre1"/> how I've multiplied the <code class="email">amount</code> values in the <code class="email">Yaw</code> and <code class="email">Pitch</code> functions by 200. This number represents<a id="id380" class="calibre1"/> the mouse's sensitivity. You can (should) add a <code class="email">float</code> member to the <code class="email">AAvatar</code> class in order to avoid hardcoding this sensitivity number.</p><p class="calibre9">
<code class="email">GetWorld()-&gt;GetDeltaSeconds()</code> gives you the amount of time that passed between the last frame and this frame. It isn't a lot: <code class="email">GetDeltaSeconds()</code> should be around 16 milliseconds (0.016 s) most of the time (if your game is running at 60 fps).</p><p class="calibre9">So, now we have player input and control. To add new functionality to your Avatar, this is all that you have to do:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Bind your key or mouse actions by going to <span class="strong"><strong class="calibre2">Settings</strong></span> | <span class="strong"><strong class="calibre2">Project Settings</strong></span> | <span class="strong"><strong class="calibre2">Input</strong></span>.</li><li class="listitem" value="2">Add a member function to run when that key is pressed.</li><li class="listitem" value="3">Add a line to <code class="email">SetupPlayerInputComponent</code>, connecting the name of the bound input to the member function we want to run when that key is pushed.</li></ol><div class="calibre14"/></div></div></div>
<div class="book" title="Creating non-player character entities"><div class="book" id="1S2JE2-dd4a3f777fc247568443d5ffb917736d"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch08lvl1sec61" class="calibre1"/>Creating non-player character entities</h1></div></div></div><p class="calibre9">So, we need<a id="id381" class="calibre1"/> to create a few <span class="strong"><strong class="calibre2">NPC</strong></span>s (<span class="strong"><strong class="calibre2">non-playable characters</strong></span>). NPCs <a id="id382" class="calibre1"/>are characters within the game that help the player. Some offer special items, some are shop vendors, and some have information to give to the player. In this game, they will react to the player as he gets near. Let's program in some of this behavior.</p><p class="calibre9">First, create<a id="id383" class="calibre1"/> another subclass of <span class="strong"><strong class="calibre2">Character</strong></span>. In the UE4 Editor, go to <span class="strong"><strong class="calibre2">File </strong></span>|<span class="strong"><strong class="calibre2"> Add Code To Project...</strong></span> and choose the <span class="strong"><strong class="calibre2">Character</strong></span> class from which you can make a subclass. Name your subclass <code class="email">NPC</code>.</p><p class="calibre9">Now, edit your code in Visual Studio. Each NPC will have a message to tell the player, so we add in a <code class="email">UPROPERTY() FString</code> property to the <code class="email">NPC</code> class.</p><div class="note" title="Note"><h3 class="title2"><a id="tip51" class="calibre1"/>Tip</h3><p class="calibre9">
<code class="email">FString</code>s are UE4's version of C++'s <code class="email">&lt;string&gt;</code> type. When programming in UE4, you should use the <code class="email">FString</code> objects over C++ STL's <code class="email">string</code> objects. In general, you should preferably use UE4's built-in types, as they guarantee cross-platform compatibility.</p></div><p class="calibre9">How to add the <code class="email">UPROPERTY() FString</code> property to the <code class="email">NPC</code> class is shown in the following code:</p><div class="note"><pre class="programlisting">UCLASS()
class GOLDENEGG_API ANPC : public ACharacter
{
  GENERATED_UCLASS_BODY()
  UPROPERTY(VisibleAnywhere, BlueprintReadOnly, Category =  Collision)
  TSubobjectPtr&lt;class USphereComponent&gt; ProxSphere;
  // This is the NPC's message that he has to tell us.
  UPROPERTY(EditAnywhere, BlueprintReadWrite, Category =  NPCMessage)
  FString NpcMessage;
  // When you create a blueprint from this class, you want to be 
  // able to edit that message in blueprints,
  // that's why we have the EditAnywhere and BlueprintReadWrite 
  // properties.
}</pre></div><p class="calibre9">Notice that we put the <code class="email">EditAnywhere</code> and <code class="email">BlueprintReadWrite</code> properties into the <code class="email">UPROPERTY</code> macro. This will make the <code class="email">NpcMessage</code> editable in blueprints.</p><div class="note" title="Note"><h3 class="title2"><a id="tip52" class="calibre1"/>Tip</h3><p class="calibre9">Full descriptions of all the UE4 property specifiers<a id="id384" class="calibre1"/> are available at <a class="calibre1" href="https://docs.unrealengine.com/latest/INT/Programming/UnrealArchitecture/Reference/Properties/index.html">https://docs.unrealengine.com/latest/INT/Programming/UnrealArchitecture/Reference/Properties/index.html</a>.</p></div><p class="calibre9">Recompile your project (as we did for the <code class="email">Avatar</code> class). Then, go to the <span class="strong"><strong class="calibre2">Class Viewer</strong></span>, right click on your <code class="email">NPC</code> class, and create a blueprint from it.</p><p class="calibre9">Each NPC <a id="id385" class="calibre1"/>character you want to create can be a blueprint based off of the <code class="email">NPC</code> class. Name each blueprint something unique, as we'll be selecting a different model mesh and message for each NPC that appears, as shown in the following screenshot:</p><div class="mediaobject"><img src="../images/00121.jpeg" alt="Creating non-player character entities" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Now, open the blueprint, select skeletal<span class="strong"><strong class="calibre2"> mesh</strong></span> from the <span class="strong"><strong class="calibre2">Add</strong></span> <span class="strong"><strong class="calibre2">Components</strong></span>, and adjust the capsule (as we did for <span class="strong"><strong class="calibre2">BP_Avatar</strong></span>). You can also change the material of your new character so that he looks different from the player.</p><div class="mediaobject"><img src="../images/00122.jpeg" alt="Creating non-player character entities" class="calibre11"/><div class="caption"><p class="calibre16">Change the material of your character in your mesh's properties. Under the Rendering tab, click on the + icon to add a new material. Then, click on the small capsule-shaped item to select a material to render with.</p></div></div><p class="calibre12"> </p><p class="calibre9">In the <span class="strong"><strong class="calibre2">Defaults</strong></span> tab, search<a id="id386" class="calibre1"/> for the <code class="email">NpcMessage</code> property. This is our connection between C++ code and blueprints: because we entered a <code class="email">UPROPERTY()</code> function on the <code class="email">FString NpcMessage</code> variable, that property appears editable within UE4, as shown in the following screenshot:</p><div class="mediaobject"><img src="../images/00123.jpeg" alt="Creating non-player character entities" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Now, drag <span class="strong"><strong class="calibre2">BP_NPC_Owen</strong></span> into the<a id="id387" class="calibre1"/> scene. You can create a second or third character as well, and be sure to give them unique names, appearances, and messages.</p><div class="mediaobject"><img src="../images/00124.jpeg" alt="Creating non-player character entities" class="calibre11"/><div class="caption"><p class="calibre16">I've created two blueprints for NPCs based on the NPC base classes, BP_NPC_Justin and BP_NPC_Owen. They have different appearances and different messages for the player.</p></div></div><p class="calibre12"> </p><div class="mediaobject"><img src="../images/00125.jpeg" alt="Creating non-player character entities" class="calibre11"/><div class="caption"><p class="calibre16">Justin and Owen in the scene</p></div></div><p class="calibre12"> </p></div>

<div class="book" title="Displaying a quote from each NPC dialog box"><div class="book" id="1T1402-dd4a3f777fc247568443d5ffb917736d"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch08lvl1sec62" class="calibre1"/>Displaying a quote from each NPC dialog box</h1></div></div></div><p class="calibre9">To <a id="id388" class="calibre1"/>display a dialog box, we need a custom (heads-up display) <span class="strong"><strong class="calibre2">HUD</strong></span>. In<a id="id389" class="calibre1"/> the UE4 editor, go to <span class="strong"><strong class="calibre2">File</strong></span> | <span class="strong"><strong class="calibre2">Add Code To Project...</strong></span> and choose the <code class="email">HUD</code> class from which the subclass is created. Name your subclass as you wish; I've named mine <code class="email">MyHUD</code>.</p><p class="calibre9">After you have created the <code class="email">MyHUD</code> class, let Visual Studio reload. We will make some code edits.</p></div>

<div class="book" title="Displaying a quote from each NPC dialog box">
<div class="book" title="Displaying messages on the HUD"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch08lvl2sec95" class="calibre1"/>Displaying messages on the HUD</h2></div></div></div><p class="calibre9">Inside<a id="id390" class="calibre1"/> the <code class="email">AMyHUD</code> class, we need to implement the <code class="email">DrawHUD()</code> function in order to draw our messages to the HUD and to initialize a font to draw to the HUD with, as shown in the following code:</p><div class="note"><pre class="programlisting">UCLASS()
class GOLDENEGG_API AMyHUD : public AHUD
{
  GENERATED_UCLASS_BODY()
  // The font used to render the text in the HUD.
  UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = HUDFont)
  UFont* hudFont;
  // Add this function to be able to draw to the HUD!
  virtual void DrawHUD() override;
};</pre></div><p class="calibre9">The HUD font will <a id="id391" class="calibre1"/>be set in a blueprinted version of the <code class="email">AMyHUD</code> class. The <code class="email">DrawHUD()</code> function runs once per frame. In order to draw within the frame, add a function to the <code class="email">AMyHUD.cpp</code> file:</p><div class="note"><pre class="programlisting">void AMyHUD::DrawHUD()
{
  // call superclass DrawHUD() function first
  Super::DrawHUD();
  // then proceed to draw your stuff.
  // we can draw lines..
  DrawLine( 200, 300, 400, 500, FLinearColor::Blue );
  // and we can draw text!
  DrawText( "Greetings from Unreal!", FVector2D( 0, 0 ), hudFont,  FVector2D( 1, 1 ), FColor::White );
}</pre></div><p class="calibre9">Wait! We haven't initialized our font yet. To do this, we need to set it up in blueprints. Compile and run your Visual Studio project. Once you are in the editor, go to the <span class="strong"><strong class="calibre2">Blueprints</strong></span> menu at the top and navigate to <span class="strong"><strong class="calibre2">GameMode </strong></span>|<span class="strong"><strong class="calibre2"> HUD </strong></span>|<span class="strong"><strong class="calibre2"> + Create </strong></span>|<span class="strong"><strong class="calibre2"> MyHUD</strong></span>.</p><div class="mediaobject"><img src="../images/00126.jpeg" alt="Displaying messages on the HUD" class="calibre11"/><div class="caption"><p class="calibre16">Creating a blueprint of the MyHUD class</p></div></div><p class="calibre12"> </p><p class="calibre9">I called <a id="id392" class="calibre1"/>mine <code class="email">BP_MyHUD</code>. Edit <code class="email">BP_MyHUD</code> and select a font from the drop-down menu under <span class="strong"><strong class="calibre2">HUDFont</strong></span>:</p><div class="mediaobject"><img src="../images/00127.jpeg" alt="Displaying messages on the HUD" class="calibre11"/><div class="caption"><p class="calibre16">I selected RobotoDistanceField for my HUD font</p></div></div><p class="calibre12"> </p><p class="calibre9">Next, edit<a id="id393" class="calibre1"/> your <span class="strong"><strong class="calibre2">Game Mode</strong></span> blueprint (<span class="strong"><strong class="calibre2">BP_GameModeGoldenEgg</strong></span>) and select your new <code class="email">BP_MyHUD</code> (not <code class="email">MyHUD</code> class) for the <span class="strong"><strong class="calibre2">HUD Class</strong></span> panel:</p><div class="mediaobject"><img src="../images/00128.jpeg" alt="Displaying messages on the HUD" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Test your <a id="id394" class="calibre1"/>program by running it! You should see text printed on the screen.</p><div class="mediaobject"><img src="../images/00129.jpeg" alt="Displaying messages on the HUD" class="calibre11"/></div><p class="calibre12"> </p></div></div>

<div class="book" title="Displaying a quote from each NPC dialog box">
<div class="book" title="Using TArray&lt;Message&gt;"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch08lvl2sec96" class="calibre1"/>Using TArray&lt;Message&gt;</h2></div></div></div><p class="calibre9">Each <a id="id395" class="calibre1"/>message we want to display for the player will have a few properties:</p><div class="book"><ul class="itemizedlist"><li class="listitem">An <code class="email">FString</code> variable for the message</li><li class="listitem">A <code class="email">float</code> variable for the time to display it</li><li class="listitem">An <code class="email">FColor</code> variable for the color of the message</li></ul></div><p class="calibre9">So it makes sense<a id="id396" class="calibre1"/> for us to write a little <code class="email">struct</code>  function to contain all this information.</p><p class="calibre9">At the top of <code class="email">MyHUD.h</code>, insert the following <code class="email">struct</code> declaration:</p><div class="note"><pre class="programlisting">struct Message
{
  FString message;
  float time;
  FColor color;
  Message()
  {
    // Set the default time.
    time = 5.f;
    color = FColor::White;
  }
  Message( FString iMessage, float iTime, FColor iColor )
  {
    message = iMessage;
    time = iTime;
    color = iColor;
  }
};</pre></div><div class="note" title="Note"><h3 class="title2"><a id="note15" class="calibre1"/>Note</h3><p class="calibre9">An enhanced version of the <code class="email">Message</code> structure (with a background color) is in the code package for this chapter. We used simpler code here so that it'd be easier to understand the chapter.</p></div><p class="calibre9">Now, inside the <code class="email">AMyHUD</code> class, we want to add a <code class="email">TArray</code> of these messages. A <code class="email">TArray</code> is a UE4-defined special type of dynamically growable C++ array. We will cover the detailed use of <code class="email">TArray</code> in the next chapter, but this simple usage of  <code class="email">TArray</code> should be a nice introduction to garner your interest in the usefulness of arrays in games. This will be declared as <code class="email">TArray&lt;Message&gt;</code>:</p><div class="note"><pre class="programlisting">UCLASS()
class GOLDENEGG_API AMyHUD : public AHUD
{
  GENERATED_UCLASS_BODY()
  // The font used to render the text in the HUD.
  UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = HUDFont)
  UFont* hudFont;
  // New! An array of messages for display
  TArray&lt;Message&gt; messages;
  virtual void DrawHUD() override;
  // New! A function to be able to add a message to display
  void addMessage( Message msg );
};</pre></div><p class="calibre9">Now, whenever<a id="id397" class="calibre1"/> the NPC <a id="id398" class="calibre1"/>has a message to display, we're just need to call <code class="email">AMyHud::addMessage()</code> with our message. The message will be added to <code class="email">TArray</code> of the messages to be displayed. When a message expires (after a certain amount of time), it will be removed from the HUD.</p><p class="calibre9">Inside the <code class="email">AMyHUD.cpp</code> file, add the following code:</p><div class="note"><pre class="programlisting">void AMyHUD::DrawHUD()
{
  Super::DrawHUD();
  // iterate from back to front thru the list, so if we remove
  // an item while iterating, there won't be any problems
  for( int c = messages.Num() - 1; c &gt;= 0; c-- )
  {
    // draw the background box the right size
    // for the message
    float outputWidth, outputHeight, pad=10.f;
    GetTextSize( messages[c].message, outputWidth, outputHeight,  hudFont, 1.f );

    float messageH = outputHeight + 2.f*pad;
    float x = 0.f, y = c*messageH;

    // black backing
    DrawRect( FLinearColor::Black, x, y, Canvas-&gt;SizeX, messageH  );
    // draw our message using the hudFont
    DrawText( messages[c].message, messages[c].color, x + pad, y +  pad, hudFont );

    // reduce lifetime by the time that passed since last 
    // frame.
    messages[c].time -= GetWorld()-&gt;GetDeltaSeconds();

    // if the message's time is up, remove it
    if( messages[c].time &lt; 0 )
    {
      messages.RemoveAt( c );
    }
  }
}

void AMyHUD::addMessage( Message msg )
{
  messages.Add( msg );
}</pre></div><p class="calibre9">The <code class="email">AMyHUD::DrawHUD()</code> function<a id="id399" class="calibre1"/> now draws all the messages in the <code class="email">messages</code> array, and arranges each message in the <code class="email">messages</code> array by the amount of time that passed since the last frame. Expired messages are removed from the <code class="email">messages</code> collection once their <code class="email">time</code> value drops below 0.</p><div class="book" title="Exercise"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch08lvl3sec25" class="calibre1"/>Exercise</h3></div></div></div><p class="calibre9">Refactor<a id="id400" class="calibre1"/> the <code class="email">DrawHUD()</code> function so that the code that draws the messages to the screen is in a separate function called <code class="email">DrawMessages()</code>.</p><p class="calibre9">The <code class="email">Canvas</code> variable is only available in <code class="email">DrawHUD()</code>, so you will have to save <code class="email">Canvas-&gt;SizeX</code> and <code class="email">Canvas-&gt;SizeY</code> in class-level variables.</p><div class="note" title="Note"><h3 class="title2"><a id="note16" class="calibre1"/>Note</h3><p class="calibre9">Refactoring means to change the way code works internally so that it is more organized or easier to read but still has the same apparent result to the user running the program. Refactoring often is a good practice. The reason why refactoring occurs is because nobody knows exactly what the final code should look like once they start writing it.</p></div></div><div class="book" title="Solution"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch08lvl3sec26" class="calibre1"/>Solution</h3></div></div></div><p class="calibre9">See the <code class="email">AMyHUD::DrawMessages()</code> function<a id="id401" class="calibre1"/> in the code package for this chapter.</p></div></div></div>

<div class="book" title="Displaying a quote from each NPC dialog box">
<div class="book" title="Triggering an event when it is near an NPC"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch08lvl2sec97" class="calibre1"/>Triggering an event when it is near an NPC</h2></div></div></div><p class="calibre9">To trigger an<a id="id402" class="calibre1"/> event near the NPC, we need to set an additional collision detection volume that is a bit wider than the default capsule shape. The additional collision detection volume will be a sphere around each NPC. When the player steps into the NPC sphere, the NPC reacts and displays a message.</p><div class="mediaobject"><img src="../images/00130.jpeg" alt="Triggering an event when it is near an NPC" class="calibre11"/><div class="caption"><p class="calibre16">We're going to add the dark red sphere to the NPC so that he can tell when the player is nearby</p></div></div><p class="calibre12"> </p><p class="calibre9">Inside your <code class="email">NPC.h</code> class file, add the following code in order to declare <code class="email">ProxSphere</code> and <code class="email">UFUNCTION</code> called <code class="email">Prox</code>:</p><div class="note"><pre class="programlisting">UCLASS()
class GOLDENEGG_API ANPC : public ACharacter
{
  GENERATED_UCLASS_BODY()
  // This is the NPC's message that he has to tell us.
  UPROPERTY(EditAnywhere, BlueprintReadWrite, Category =  NPCMessage)
  FString NpcMessage;
  // The sphere that the player can collide with to get item
  UPROPERTY(VisibleAnywhere, BlueprintReadOnly, Category =  Collision)
  TSubobjectPtr&lt;class USphereComponent&gt; ProxSphere;
  // The corresponding body of this function is 
  // ANPC::Prox_Implementation, __not__ ANPC::Prox()!
  // This is a bit weird and not what you'd expect,
  // but it happens because this is a BlueprintNativeEvent
  UFUNCTION(BlueprintNativeEvent, Category = "Collision")
  void Prox( AActor* OtherActor, UPrimitiveComponent* OtherComp,  int32 OtherBodyIndex, bool bFromSweep, const FHitResult &amp;  SweepResult );
};</pre></div><p class="calibre9">This looks a bit <a id="id403" class="calibre1"/>messy, but it is actually not that complicated. Here, we declare an extra bounding sphere volume called <code class="email">ProxSphere</code>, which detects when the player is near the NPC.</p><p class="calibre9">In the <code class="email">NPC.cpp</code> file, we need to add the following code in order to complete the proximity detection:</p><div class="note"><pre class="programlisting">ANPC::ANPC(const class FPostConstructInitializeProperties&amp; PCIP) : Super(PCIP)
{
  ProxSphere = PCIP.CreateDefaultSubobject&lt;USphereComponent&gt;(this,  TEXT("Proximity Sphere"));
  ProxSphere-&gt;AttachTo( RootComponent );
  ProxSphere-&gt;SetSphereRadius( 32.f );
  // Code to make ANPC::Prox() run when this proximity sphere
  // overlaps another actor.
  ProxSphere-&gt;OnComponentBeginOverlap.AddDynamic( this,  &amp;ANPC::Prox );
  NpcMessage = "Hi, I'm Owen";//default message, can be edited
  // in blueprints
}
// Note! Although this was declared ANPC::Prox() in the header,
// it is now ANPC::Prox_Implementation here.
void ANPC::Prox_Implementation( AActor* OtherActor,  UPrimitiveComponent* OtherComp, int32 OtherBodyIndex, bool  bFromSweep, const FHitResult &amp; SweepResult )
{
  // This is where our code will go for what happens
  // when there is an intersection
}</pre></div><div class="book" title="Make the NPC display something to the HUD when something is nearby"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch08lvl3sec27" class="calibre1"/>Make the NPC display something to the HUD when something is nearby</h3></div></div></div><p class="calibre9">When the<a id="id404" class="calibre1"/> player is near the NPC sphere collision volume, display a message to the HUD that alerts the player about what the NPC is saying.</p><p class="calibre9">This is the complete implementation of <code class="email">ANPC::Prox_Implementation</code>:</p><div class="note"><pre class="programlisting">void ANPC::Prox_Implementation( AActor* OtherActor, UPrimitiveComponent* OtherComp, int32 OtherBodyIndex, bool bFromSweep, const FHitResult &amp; SweepResult )
{
  // if the overlapped actor is not the player,
  // you should just simply return from the function
  if( Cast&lt;AAvatar&gt;( OtherActor ) == nullptr )
  {
    return;
  }
  APlayerController* PController = GetWorld()- &gt;GetFirstPlayerController();
  if( PController )
  {
    AMyHUD * hud = Cast&lt;AMyHUD&gt;( PController-&gt;GetHUD() );
    hud-&gt;addMessage( Message( NpcMessage, 5.f, FColor::White ) );
  }
}</pre></div><p class="calibre9">The first thing we do in this function is to cast <code class="email">OtherActor</code> (the thing that came near the NPC) to <code class="email">AAvatar</code>. The cast succeeds (and is not <code class="email">nullptr</code>) when <code class="email">OtherActor</code> is an <code class="email">AAvatar</code> object. We get the HUD object (which happens to be attached to the player controller) and pass a message from the NPC to the HUD. The message is displayed whenever the player is within the red bounding sphere surrounding the NPC.</p><div class="mediaobject"><img src="../images/00131.jpeg" alt="Make the NPC display something to the HUD when something is nearby" class="calibre11"/><div class="caption"><p class="calibre16">Owen's greeting</p></div></div><p class="calibre12"> </p></div><div class="book" title="Exercises"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch08lvl3sec28" class="calibre1"/>Exercises</h3></div></div></div><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Add <a id="id405" class="calibre1"/>a <code class="email">UPROPERTY</code> function name for the NPC's name so that the name of the NPC is editable in blueprints, similar to the message that the NPC has for the player. Show the NPC's name in the output.</li><li class="listitem" value="2">Add a <code class="email">UPROPERTY</code> function (type <code class="email">UTexture2D*</code>) for the NPC's face texture. Draw the NPC's face beside its message in the output.</li><li class="listitem" value="3">Render the player's HP as a bar (filled rectangle).</li></ol><div class="calibre14"/></div></div><div class="book" title="Solutions"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch08lvl3sec29" class="calibre1"/>Solutions</h3></div></div></div><p class="calibre9">Add<a id="id406" class="calibre1"/> this property to the <code class="email">ANPC</code> class:</p><div class="note"><pre class="programlisting">// This is the NPC's name
UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = NPCMessage)
FString name;</pre></div><p class="calibre9">Then, in <code class="email">ANPC::Prox_Implementation</code>, change the string passed to the HUD to:</p><div class="note"><pre class="programlisting">name + FString(": ") + message</pre></div><p class="calibre9">This way, the NPC's name will be attached to the message.</p><p class="calibre9">Add <code class="email">this</code> property to the <code class="email">ANPC</code> class:</p><div class="note"><pre class="programlisting">UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = NPCMessage)
UTexture2D* Face;</pre></div><p class="calibre9">Then you can select face icons to be attached to the NPC's face in blueprints.</p><p class="calibre9">Attach a texture to your <code class="email">struct Message</code>:</p><div class="note"><pre class="programlisting">UTexture2D* tex;</pre></div><p class="calibre9">To render these icons, you need to add a call to <code class="email">DrawTexture()</code> with the right texture passed in to it:</p><div class="note"><pre class="programlisting">DrawTexture( messages[c].tex, x, y, messageH, messageH, 0, 0, 1, 1  );</pre></div><p class="calibre9">Be sure to check whether the texture is valid before you render it. The icons should look similar to what is shown here, at the top of the screen:</p><div class="mediaobject"><img src="../images/00132.jpeg" alt="Solutions" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">This is how a <a id="id407" class="calibre1"/>function to draw the player's remaining health in a bar will look:</p><div class="note"><pre class="programlisting">void AMyHUD::DrawHealthbar()
{
  // Draw the healthbar.
  AAvatar *avatar = Cast&lt;AAvatar&gt;(  UGameplayStatics::GetPlayerPawn(GetWorld(), 0) );
  float barWidth=200, barHeight=50, barPad=12, barMargin=50;
  float percHp = avatar-&gt;Hp / avatar-&gt;MaxHp;
  DrawRect( FLinearColor( 0, 0, 0, 1 ), Canvas-&gt;SizeX - barWidth -  barPad - barMargin, Canvas-&gt;SizeY - barHeight - barPad -  barMargin, barWidth + 2*barPad, barHeight + 2*barPad );
  DrawRect( FLinearColor( 1-percHp, percHp, 0, 1 ), Canvas-&gt;SizeX  - barWidth - barMargin, Canvas-&gt;SizeY - barHeight - barMargin,  barWidth*percHp, barHeight );
}</pre></div></div></div></div>
<div class="book" title="Summary" id="1TVKI1-dd4a3f777fc247568443d5ffb917736d"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch08lvl1sec63" class="calibre1"/>Summary</h1></div></div></div><p class="calibre9">In this chapter, we went through a lot of material. We showed you how to create a character and display it on the screen, control your character with axis bindings, and create and display NPCs that can post messages to the HUD.</p><p class="calibre9">In the upcoming chapters, we will develop our game further by adding an <span class="strong"><em class="calibre10">Inventory System and Pickup Items</em></span> in <a class="calibre1" title="Chapter 10. Inventory System and Pickup Items" href="part0072_split_000.html#24L8G2-dd4a3f777fc247568443d5ffb917736d">Chapter 10</a>, as well as the code and the concept to account for what the player is carrying. Before we do that, though, we will do an in-depth exploration of some of the UE4 container types in <a class="calibre1" title="Chapter 9. Templates and Commonly Used Containers" href="part0066_split_000.html#1UU541-dd4a3f777fc247568443d5ffb917736d">Chapter 9</a>, <span class="strong"><em class="calibre10">Templates and Commonly Used Containers</em></span>.</p></div></body></html>