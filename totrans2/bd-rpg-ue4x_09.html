<html><head></head><body><div class="chapter" title="Chapter&#xA0;9.&#xA0;Equipment"><div class="titlepage"><div><div><h1 class="title"><a id="ch09"/>Chapter 9. Equipment</h1></div></div></div><p>In the previous chapter, we covered how to create useable items, populate them in a store controlled by an NPC, allow the player to buy items from the store, and use those items from their inventory. In this chapter, we will continue from where we left off by offering the player weapons and armor to equip themselves with.</p><p>We will cover the following topics in this chapter:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The weapons Data Table</li><li class="listitem" style="list-style-type: disc">Setting the weapon and equipment screen variables</li><li class="listitem" style="list-style-type: disc">Creating the weapon button</li><li class="listitem" style="list-style-type: disc">Revisiting the equipment screen</li><li class="listitem" style="list-style-type: disc">Setting the equipment screen Text Blocks</li><li class="listitem" style="list-style-type: disc">Correcting character stats when equipping</li></ul></div><div class="section" title="The weapons Data Table"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec60"/>The weapons Data Table</h1></div></div></div><p>Now that <a id="id508" class="indexterm"/>we have a decent framework for item creation, it will be very easy to create equipment. Since the <span class="strong"><strong>Items</strong></span> Data Table reads all of the stats of the party members so that the stats can be modified if an item is used, we can expect equipment to modify all of the same stats; therefore, we can use the same structure for the <span class="strong"><strong>Equipment</strong></span> Data Table, as we did for the <span class="strong"><strong>Items</strong></span> Data Table. </p><p>So, at this point, we will create a Data Table for weapons by clicking on <span class="strong"><strong>Content Browser</strong></span> and navigating to <span class="strong"><strong>+Add New</strong></span> | <span class="strong"><strong>Miscellaneous</strong></span> | <span class="strong"><strong>Data Table</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_09_01.jpg" alt="The weapons Data Table"/></div><p>Next, we can <a id="id509" class="indexterm"/>pick the <span class="strong"><strong>Items Data</strong></span> structure since we will be calling the same data in the <span class="strong"><strong>Equipment</strong></span> Data Table as we did in <span class="strong"><strong>Item</strong></span> Data Table:</p><div class="mediaobject"><img src="graphics/B04548_09_02.jpg" alt="The weapons Data Table"/></div><p>Then, name the Data Table <span class="strong"><strong>Weapons</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_09_03.jpg" alt="The weapons Data Table"/></div><p>We will use<a id="id510" class="indexterm"/> this <span class="strong"><strong>Weapons</strong></span> Data Table to populate every weapon that we plan to equip on a character in the game. For now, we will only make a Data Table for one character's weapons, but you can use all of the following steps to create more weapon Data Tables for additional characters.</p><p>You can now open the <span class="strong"><strong>Weapons</strong></span> Data Table, and just like our <span class="strong"><strong>Items</strong></span> Data Table, we begin with creating data by clicking on the <span class="strong"><strong>Add</strong></span> button and then naming the data. In this case, we will make our first weapon, a dagger, and then give the dagger some stats. Since the dagger is a weapon, we will just need to modify the <a id="id511" class="indexterm"/><span class="strong"><strong>ATK</strong></span> stat. Since we are keeping our examples simple, we are not utilizing other stats that many other RPGs have such as <span class="emphasis"><em>accuracy</em></span> and <span class="emphasis"><em>dexterity</em></span> because we do not have accuracy or dexterity in our RPG framework. However, if you decide to add these additional mechanics to your game later on, you will want to modify the appropriate stats in your Data Table that are associated with your equipment. You may also want to give the dagger a gold value if weapons hold a resale value in your game.</p><div class="mediaobject"><img src="graphics/B04548_09_04.jpg" alt="The weapons Data Table"/></div></div></div>
<div class="section" title="Setting the weapon and equipment screen variables"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec61"/>Setting the weapon and equipment screen variables</h1></div></div></div><p>Now that <a id="id512" class="indexterm"/>you <a id="id513" class="indexterm"/>have a weapon in your <span class="strong"><strong>Weapons</strong></span> Data Table, we can set up a framework to equip this weapon.</p><p>Just like the items that you created, you can choose to populate the weapons in a shop, you can choose to allow weapons to be picked up automatically from other NPCs in the field, or you can make them enemy drops just like you did with gold. Whichever method you choose, make sure that the weapons end up getting populated in your equipment screen in a similar way in which the items got populated in your inventory screen. At the bare minimum, we will need the character to hold an array of weapons. Navigate to the <span class="strong"><strong>FieldPlayer</strong></span> Blueprint and open the Event Graph. Then, add a new text array variable that is similar to the <span class="strong"><strong>arrayItem</strong></span> variable <a id="id514" class="indexterm"/>that you created in the previous chapter, and call it <span class="strong"><strong>arrayWeapons</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_09_05.jpg" alt="Setting the weapon and equipment screen variables"/></div><p>The major difference between the items and equipment is that we will be able to equip and unequip equipment rather than just <span class="emphasis"><em>using</em></span> the equipment, so we will need to create a framework for this on our equipment screen. While we are in the <span class="strong"><strong>FieldPlayer</strong></span> Blueprint, we can start <a id="id515" class="indexterm"/>creating this framework by also creating an <code class="literal">equipmentScreen</code> Boolean that we will eventually set to let the system know when the player is accessing the equipment screen. This will be needed when equipping weapons and armor just like the <code class="literal">inventoryScreen</code> Boolean was needed to allow the user to use items when accessing the inventory screen:</p><div class="mediaobject"><img src="graphics/B04548_09_06.jpg" alt="Setting the weapon and equipment screen variables"/></div><p>Now that the player can hold a weapons array and an equipment screen Boolean, we need to navigate to the <span class="strong"><strong>Pause_Equipment</strong></span> Event Graph, and set the <code class="literal">equipmentScreen</code> Boolean to true when the event is constructed, and set it to false when the player leaves the screen. This is identical to the way in which we set the <code class="literal">inventoryScreen</code> Boolean in the <span class="strong"><strong>Pause_Inventory</strong></span> Event <a id="id516" class="indexterm"/>Graph:</p><div class="mediaobject"><img src="graphics/B04548_09_07.jpg" alt="Setting the weapon and equipment screen variables"/></div></div>
<div class="section" title="Creating the weapon button"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec62"/>Creating the weapon button</h1></div></div></div><p>Next, we<a id="id517" class="indexterm"/> can move on to populating the equipment screen. To do this, we first need to create a weapon button similar to the item button that we created previously. This weapon button will house all the logic that will be performed when the user presses the weapon button. Since the weapon button will be similar to the item button in a lot of ways, we can duplicate the item button and modify it to fit the weapon parameters. So, go to the <span class="strong"><strong>Item</strong></span> Widget Blueprint by navigating to <span class="strong"><strong>Content Browser</strong></span> | <span class="strong"><strong>Blueprints</strong></span> | <span class="strong"><strong>UI</strong></span>, and duplicate the <span class="strong"><strong>Item</strong></span> Widget Blueprint:</p><div class="mediaobject"><img src="graphics/B04548_09_08.jpg" alt="Creating the weapon button"/></div><p>Then, rename<a id="id518" class="indexterm"/> it <span class="strong"><strong>Weapon</strong></span>, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/B04548_09_09.jpg" alt="Creating the weapon button"/></div><p>We can now open the <span class="strong"><strong>Weapon</strong></span> Widget Blueprint and navigate to the Event Graph. Here, you will see an exact copy of the <span class="strong"><strong>Item</strong></span> Widget Blueprint logic, and since the logic for equipping weapons will be similar to using items, we can just modify the Event Graph to fit it with what we want to happen when the user presses the weapon button.</p><p>First, we need to<a id="id519" class="indexterm"/> edit the section where the <span class="strong"><strong>OnClicked</strong></span> event is located. We want the <span class="strong"><strong>OnClicked</strong></span> event to find the <code class="literal">equipmentScreen</code> Boolean and check whether it is true, so we can remove the check for the <code class="literal">inventoryScreen</code> Boolean and replace it with the <code class="literal">equipmentScreen</code> Boolean:</p><div class="mediaobject"><img src="graphics/B04548_09_10.jpg" alt="Creating the weapon button"/></div><p>If the <code class="literal">equipmentScreen</code> Boolean returns false, the false branch will do nothing, and so we need to delete all of the false branch logic:</p><div class="mediaobject"><img src="graphics/B04548_09_11.jpg" alt="Creating the weapon button"/></div><p>If the branch returns<a id="id520" class="indexterm"/> true, then we will set the <span class="strong"><strong>Get Data Table Row Weapons</strong></span> function to get the <span class="strong"><strong>Weapons</strong></span> Data Table:</p><div class="mediaobject"><img src="graphics/B04548_09_12.jpg" alt="Creating the weapon button"/></div><p>Then, from <span class="strong"><strong>Break ItemsData</strong></span>, set it <a id="id521" class="indexterm"/>to break the data <span class="strong"><strong>ATK</strong></span> stat, and set the <span class="strong"><strong>ATK</strong></span> stat of the character accordingly:</p><div class="mediaobject"><img src="graphics/B04548_09_13.jpg" alt="Creating the weapon button"/></div><p>For now, the <span class="strong"><strong>OnClicked</strong></span> event <a id="id522" class="indexterm"/>in your <span class="strong"><strong>Weapon</strong></span> Event Graph will look like this:</p><div class="mediaobject"><img src="graphics/B04548_09_14.jpg" alt="Creating the weapon button"/></div><p>Also, make sure <a id="id523" class="indexterm"/>that you are still setting the <span class="strong"><strong>Party Members</strong></span> stats to the <span class="strong"><strong>Character Target</strong></span> variable; otherwise, the base stats of the characters will not carry over correctly:</p><div class="mediaobject"><img src="graphics/B04548_09_15.jpg" alt="Creating the weapon button"/></div></div>
<div class="section" title="Revisiting the equipment screen"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec63"/>Revisiting the equipment screen</h1></div></div></div><p>You may <a id="id524" class="indexterm"/>notice that if we stick to this Event Graph, we will merely be using each weapon instead of equipping it because of the <span class="strong"><strong>Remove from Parent</strong></span> function. We will come back to edit this Event Graph later on in the chapter to properly set the button to equip rather than use.</p><p>We will now populate the equipment screen. As mentioned earlier in this chapter, you can choose how you want to populate the equipment screen. For simplicity of this example, we will just populate the equipment screen as we did with the shop. So, we will navigate back to the <span class="strong"><strong>Pause_Equipment</strong></span> Widget Blueprint's Event Graph, and use the same logic that we implemented to populate the shop screen; only this time set the <span class="strong"><strong>Get Data Table Row Names</strong></span> function to get the <span class="strong"><strong>Weapons</strong></span> Data Table. Then, set the <span class="strong"><strong>Create Widget</strong></span> function to get the <span class="strong"><strong>Weapon</strong></span> widget. Note that you need to ensure that <span class="strong"><strong>is Variable</strong></span> of the Scroll Box is checked in your <span class="strong"><strong>Designer</strong></span> view; otherwise, your Scroll Box will produce an error because it won't be found. </p><p>The Event Graph of <span class="strong"><strong>Pause_Equipment</strong></span> will look like this when you are done:</p><div class="mediaobject"><img src="graphics/B04548_09_16.jpg" alt="Revisiting the equipment screen"/></div><p>If you test the equipment screen now, you will notice that the weapons get populated in the Scroll Box, and if you use the equipment, the stats of the character go up and match the increased stats of the weapon. However, we still have some issues. The weapon is being used instead of equipped, and if we continue to use weapons, the stats end up climbing instead of getting <a id="id525" class="indexterm"/>replaced. Let's set the weapon to be equipped first rather than replaced.</p></div>
<div class="section" title="Setting the equipment screen Text Blocks"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec64"/>Setting the equipment screen Text Blocks</h1></div></div></div><p>Since we <a id="id526" class="indexterm"/>know that the equipment screen has Text Blocks on the right-hand side of the <span class="strong"><strong>Weapon</strong></span> and <span class="strong"><strong>Armor</strong></span> titles, which we created in <a class="link" href="ch05.html" title="Chapter 5. Bridging Character Statistics">Chapter 5</a>, <span class="emphasis"><em>Bridging Character Statistics</em></span>, we want to bind these Text Blocks to a text variable that will hold the names of the weapons and armor that we are equipping. Let's first navigate to our <span class="strong"><strong>FieldPlayer</strong></span> Blueprint Event Graph, and create a text variable to hold the soldier's weapon name. We will call this text variable <code class="literal">soldierWeapon</code>:</p><div class="mediaobject"><img src="graphics/B04548_09_17.jpg" alt="Setting the equipment screen Text Blocks"/></div><p>Next, navigate to the <span class="strong"><strong>Pause_Equipment</strong></span> Widget Blueprint's <span class="strong"><strong>Designer</strong></span> view. Select the Text Block on the <a id="id527" class="indexterm"/>right-hand side of the <span class="strong"><strong>Weapon</strong></span> title, navigate to <span class="strong"><strong>Details</strong></span> | <span class="strong"><strong>Content</strong></span> | <span class="strong"><strong>Text</strong></span>, and click on the <span class="strong"><strong>Bind</strong></span> drop-down menu to select <span class="strong"><strong>+Create Binding</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_09_18.jpg" alt="Setting the equipment screen Text Blocks"/></div><p>In the Event Graph for this binding, use the <span class="strong"><strong>Get All Actors Of Class</strong></span> function to get all the actors of the <span class="strong"><strong>FieldPlayer</strong></span>, and get the <code class="literal">soldierWeapon</code> variable and link it to the <span class="strong"><strong>Return Value</strong></span> pin of <span class="strong"><strong>ReturnNode</strong></span> so that the Text Block is able to draw the text that is saved in the <code class="literal">soldierWeapon</code> variable:</p><div class="mediaobject"><img src="graphics/B04548_09_19.jpg" alt="Setting the equipment screen Text Blocks"/></div><p>We can now set the<a id="id528" class="indexterm"/> text to the <code class="literal">soldierWeapon</code> variable by going back to the <span class="strong"><strong>Weapon</strong></span> Widget Blueprint Event Graph and replacing the <span class="strong"><strong>Remove from Parent</strong></span> function with <span class="strong"><strong>Set soldierWeapon</strong></span>. The text value of <code class="literal">soldierWeapon</code> should be set to the <span class="strong"><strong>Item</strong></span> variable that the user clicks on:</p><div class="mediaobject"><img src="graphics/B04548_09_20.jpg" alt="Setting the equipment screen Text Blocks"/></div><p>If you test the equipment screen now, you will notice that when the equipment button is pressed, the name of the weapon gets updated and the weapons will not be removed from the equipment screen.</p><div class="mediaobject"><img src="graphics/B04548_09_21.jpg" alt="Setting the equipment screen Text Blocks"/></div></div>
<div class="section" title="Correcting the character stats when equipping"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec65"/>Correcting the character stats when equipping</h1></div></div></div><p>The last<a id="id529" class="indexterm"/> thing that we need to do is adding some logic to make sure that the base stats do not continue to climb if the equipment is chosen more than once from the equipment screen. To do this, we need to create two variables in the <span class="strong"><strong>FieldPlayer</strong></span> Blueprint. One variable will be a Boolean that keeps track of whether the soldier has a weapon equipped. The other will be an integer to keep track of the soldier's base attack stat. These elements together will allow us to create the logic in our weapon button that prevents the attack stat from climbing every time we click on a weapon.</p><p>So, first navigate to the <span class="strong"><strong>FieldPlayer</strong></span> Blueprint and create a Boolean called <span class="strong"><strong>soldierWeaponEquipped</strong></span>. Then, create an integer called <span class="strong"><strong>soldierbaseAtk</strong></span>:</p><div class="mediaobject"><img src="graphics/B04548_09_23.jpg" alt="Correcting the character stats when equipping"/></div><p>We specify these<a id="id530" class="indexterm"/> stats to be of a specific character and weapon equipment because if your game has more characters in your party, along with both weapons and armor for each character, you will need to differentiate between all the characters' statuses. Moreover, you may want to create a base status for every statistic because some equipment may change stats other than attack.</p><p>We can now create the logic using the new variables that we created. Navigate to the <span class="strong"><strong>Weapon</strong></span> Widget Blueprint Event Graph. We need to modify some of our logic to tell when a weapon is <a id="id531" class="indexterm"/>equipped on the soldier. Create a <span class="strong"><strong>SET Soldier Weapon Equipped</strong></span> function and set it to <span class="strong"><strong>true</strong></span> after you have equipped the weapon (or pressed the button for the weapon):</p><div class="mediaobject"><img src="graphics/B04548_09_24.jpg" alt="Correcting the character stats when equipping"/></div><p>Remember that since this particular button equips the soldier's weapon only when it is pressed, if you have additional characters and/or different types of equipment, you need to create a different Widget Blueprint to accommodate these characters and equipment types.</p><p>Next, we need to create the logic to calculate the base attack. Since we have already used the Boolean to differentiate between when the soldier is equipping a weapon or not, we can use this logic to calculate the base attack stat. What we know in our game, by default, is that the character does not have a weapon equipped. So, what we can do is define the base attack stat as soon as we construct this Widget Blueprint, but specifically, when the soldier does not have a weapon equipped.</p><p>At this point, when the Widget Blueprint is constructed, get all the actors of the Field Player class using the <span class="strong"><strong>Get All Actors Of Class</strong></span> function. After we have got all the actors of this class, get the <code class="literal">soldierWeaponEquipped</code> variable. Let's allow the <span class="strong"><strong>Get All Actors Of Class</strong></span> function to fire off a branch that checks whether the <code class="literal">soldierWeaponEquipped</code> variable is true or false:</p><div class="mediaobject"><img src="graphics/B04548_09_25.jpg" alt="Correcting the character stats when equipping"/></div><p>If the condition <a id="id532" class="indexterm"/>is false, set the <span class="strong"><strong>soldierbaseAtk</strong></span> to the <span class="strong"><strong>ATK</strong></span> variable of the character. When choosing a weapon, instead of adding the <span class="strong"><strong>ATK</strong></span> of <span class="strong"><strong>ItemData</strong></span> and the <span class="strong"><strong>ATK</strong></span> of the current character's <span class="strong"><strong>ATK</strong></span> stat, add the <span class="strong"><strong>ATK</strong></span> of <span class="strong"><strong>ItemData</strong></span> and <span class="strong"><strong>soldierbaseAtk</strong></span> so that we can always use the base <span class="strong"><strong>ATK</strong></span> variable when equipping a weapon rather than the current stat. This will prevent the <span class="strong"><strong>ATK</strong></span> variable from climbing:</p><div class="mediaobject"><img src="graphics/B04548_09_26-1.jpg" alt="Correcting the character stats when equipping"/></div><p>One major problem <a id="id533" class="indexterm"/>you will notice is that the attack stat will continue to grow if we exit the equipment screen and come back to equip an item. This is because we do not have logic in place for when a weapon is already equipped. So, when <code class="literal">soldierWeaponEquipped</code> is true, we need to find which weapon is currently equipped, and subtract its stats from the soldier's base stats in order to reset the base stats.</p><p>To do this, we will simply use the <span class="strong"><strong>Get Data Table Row Names</strong></span> function to get the names of the items in the <span class="strong"><strong>Weapons</strong></span> Data Table. For each name in the Data Table, we need to compare the name to the <code class="literal">soldierWeapon</code> variable from the Field Player class. If the names are equal, we get the row name from the <span class="strong"><strong>Weapons</strong></span> Data Table using the <span class="strong"><strong>Get Data Table Row</strong></span> function, subtract the <span class="strong"><strong>ATK</strong></span> stat of the weapon from the <code class="literal">soldierbaseAtk</code> stat, find<a id="id534" class="indexterm"/> the absolute value of that operation using the <span class="strong"><strong>Absolute (Int)</strong></span> function, and finally, set that number to the <code class="literal">soldierbaseAtk</code> stat:</p><div class="mediaobject"><img src="graphics/B04548_09_26.jpg" alt="Correcting the character stats when equipping"/></div><p>At this point, if you test the equipping of weapons, the attack stat will no longer climb.</p><p>This method will work since we do not have a leveling system in place yet. However, when we do have a leveling system in place, we will want to replace this <span class="strong"><strong>ATK</strong></span> variable with the base <span class="strong"><strong>ATK</strong></span> variable that we create for the leveling.</p></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec66"/>Summary</h1></div></div></div><p>Now that you know how to equip and set stats for the soldier's weapon, you can use similar methodologies to create Data Tables, Blueprints, and logic for other characters and their equipment.</p><p>In the next chapter, we will create a leveling system for our game. We will learn how to allow enemies to give experience points to the player after they are defeated, which will then be used to level up characters in the game.</p></div></body></html>