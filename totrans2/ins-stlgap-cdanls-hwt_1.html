<html><head></head><body><div class="chapter" title="Chapter&#xA0;1.&#xA0;Instant StyleCop Code Analysis How-to"><div class="titlepage"><div><div><h1 class="title"><a id="ch01"/>Chapter 1. Instant StyleCop Code Analysis How-to</h1></div></div></div><p>Welcome to <span class="emphasis"><em>Instant StyleCop Code Analysis How-to</em></span>. If we look at how we begin development of medium and big projects, one of the first things we do is to edict base principles and among them, we define coding conventions. These rules, stating how our code must look like, are here in order to improve readability and maintainability for all developers of the team. The choices made there are fairly arbitrary and depends on the background and the likes and dislikes of the person (or the development team) who laid them down. After the project begins, it however takes a lot of time and code reviews to follow them.</p><p>This is where <span class="strong"><strong>StyleCop</strong></span> comes in. In this book we will take a look at some recipes that range from a simple to advanced level, which will tell you all about StyleCop and how it is used to analyze code.</p><div class="section" title="Installing StyleCop with Visual Studio (Simple)"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec09"/>Installing StyleCop with Visual Studio (Simple)</h1></div></div></div><p>In this recipe, we will describe the installation process of StyleCop, learn how to configure the rules to be executed on a project, and how to launch an analysis from Visual Studio.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec07"/>Getting ready</h2></div></div></div><p>In order to follow this recipe, you will need to have at least one of the following Visual Studio programs installed:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Visual Studio 2008 Professional</li><li class="listitem" style="list-style-type: disc">Visual Studio 2010 Professional</li><li class="listitem" style="list-style-type: disc">Visual Studio 2012 Professional</li></ul></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec08"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Download StyleCop from its website (<a class="ulink" href="http://stylecop.codeplex.com">http://stylecop.codeplex.com</a>). At the time of writing, the current version of StyleCop is 4.7 released on January 5, 2012.</li><li class="listitem">Once downloaded, verify your Visual Studio is closed and launch the setup. The procedure is relatively straightforward. The only tricky part is to choose the correct components for your installation according to your use.<p>The wizard shows an MSBuild integration step during installation as shown in the following screenshot. Here are two pieces of advice on the installation process:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">For a developer using only Visual Studio on his computer, staying with only the Visual Studio integration is fine</li><li class="listitem" style="list-style-type: disc">However, if you need to use another IDE such as <span class="strong"><strong>SharpDevelop</strong></span> or need StyleCop to be used in your CI, the best approach is to add the MSBuild integration as it might be required</li></ul></div><div class="mediaobject"><img src="graphics/9543_1_1.jpg" alt="How to do it..."/></div></li><li class="listitem">Once the installation process is finished, let's see what has been added to your Visual Studio.</li><li class="listitem">Open a project in your Visual Studio.</li><li class="listitem">Right-click on the project file in the explorer solution panel, and then click on <span class="strong"><strong>StyleCop Settings...</strong></span> to open the configuration window as shown in the following screenshot:<div class="mediaobject"><img src="graphics/9543_1_2.jpg" alt="How to do it..."/></div></li><li class="listitem">Once you have finished selecting the rules you need, you can launch your first analysis of code.</li><li class="listitem">In the Explorer solution, right-click on the project file to open the context menu, and then click on <span class="strong"><strong>Run StyleCop…</strong></span> to launch your analysis. You can perform analysis on different scope by launching StyleCop in different ways:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">From the <span class="strong"><strong>Tools</strong></span> menu, you can perform a scan for the current C# document, or a full scan of your solution</li><li class="listitem" style="list-style-type: disc">In the Explorer solution, from the context menu, where you can restrict the scope of your analysis to the node you have currently selected</li><li class="listitem" style="list-style-type: disc">And from the coding panel, where you can analyze the code you're currently modifying.</li></ul></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec09"/>How it works...</h2></div></div></div><p>StyleCop configuration is made on a project basis, not solution. This means you will have to specify for each project what rules and other configuration data you will use.</p><p>When opening a Visual Studio solution, you can access the StyleCop configuration from the context menu of each project in the explorer panel. You can also find configurations made this way in the <code class="literal">Settings.Stylecop</code> file of the project folder.</p><p>You can also use some "master" configuration files if you want to propagate the same settings in multiple projects.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec10"/>There's more...</h2></div></div></div><p>Now let's talk about some useful options that are available in the settings and how to have StyleCop violations displayed in your favorite IDE if it's not Visual Studio.</p><div class="section" title="Rules activation"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec01"/>Rules activation</h3></div></div></div><p>Each section of rules may contain some additional configuration elements (they will be displayed in the <span class="strong"><strong>Detailed settings</strong></span> region of the <span class="strong"><strong>Rules</strong></span> tab.</p><p>At the moment you have additional configuration elements for the following lines:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>C#</strong></span>: The detailed settings of this section are certainly the most important as they allow you to exclude generated and designer files from further analysis by StyleCop. This is helpful as designer files do not generally follow these rules and generates many issues.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Documentation rules</strong></span>: In this section, you can change the check scope of the documentation. This means you can remove the rule checking for private and internal code and you can exclude fields from it.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Ordering rules</strong></span>: The detailed section lets you exclude the generated code from the checks.</li></ul></div></div><div class="section" title="Merging StyleCop settings"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec02"/>Merging StyleCop settings</h3></div></div></div><p>Earlier in this chapter, I explained that StyleCop configuration was set up on a project basis. While this is true for the standard behavior, the <span class="strong"><strong>Setting Files</strong></span> tab allows you to change the default behavior and specify a setting file to merge with your current project settings as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/9543_1_3.jpg" alt="Merging StyleCop settings"/></div><p>Doing so allows you to have a global configuration file and depend on it for rule exclusion. If you modify any settings, they will appear in bold in the <span class="strong"><strong>Rules</strong></span> tabs to show they have been overwritten.</p></div><div class="section" title="Using StyleCop with Express editions of Visual Studio and SharpDevelop"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec03"/>Using StyleCop with Express editions of Visual Studio and SharpDevelop</h3></div></div></div><p>In order to use StyleCop with Visual Studio Express or SharpDevelop, we have to enable MSBuild integration. For SharpDevelop, that is all that's required. SharpDevelop will then take care of missing lines in your project files.</p><p>However, for Visual Studio Express, you need to manually add StyleCop analysis in your project files. See the <span class="emphasis"><em>Automating StyleCop using MSBuild (Simple)</em></span> recipe to know how to do this.</p><p>Once you have set up StyleCop analysis in the projects files of your solution, StyleCop violations will be displayed as warnings or errors at compile time.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip02"/>Tip</h3><p><span class="strong"><strong>Is there a way to do automate StyleCop integration for all my project files?</strong></span></p><p>Since framework 4.0 it is also possible to include the <code class="literal">Stylecop.targets</code> file in <code class="literal">C:\Program Files\MSBuild\4.0\Microsoft.CSharp.targets\ImportAfter\</code>.</p><p>This will allow the integration of <code class="literal">Stylecop.targets</code> by default in all the project builds. If the directory doesn't exist, you will have to create it.</p><p>To be sure of version of the framework MSBuild uses, you can run the following command in your visual studio command line:</p><div class="informalexample"><pre class="programlisting">MSBuild /version</pre></div></div></div></div></div></div></div>
<div class="section" title="Understanding the Resharper add-in (Simple)"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec10"/>Understanding the Resharper add-in (Simple)</h1></div></div></div><p>In this recipe, we will discover the StyleCop add-in for Resharper. We will see its real-time analysis and how to easily fix most of the StyleCop violations.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec11"/>Getting ready</h2></div></div></div><p>For this recipe, you will need to have:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">StyleCop 4.7 installed.</li><li class="listitem" style="list-style-type: disc">Resharper 7.1 installed. Evaluation version available at <a class="ulink" href="http://devnet.jetbrains.com/docs/DOC-280">http://devnet.jetbrains.com/docs/DOC-280</a>.</li><li class="listitem" style="list-style-type: disc">Visual Studio Professional (2008, 2010, or 2012).</li><li class="listitem" style="list-style-type: disc">A sample C# project to modify.</li></ul></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec12"/>How to do it...</h2></div></div></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note02"/>Note</h3><p>Before starting to see the benefit of Resharper with StyleCop, I have to say that the installation is not an easy one. First, each version of StyleCop seems to be tightly built on a specific version of Resharper. At the time of writing, StyleCop Version 4.7 is compatible with Resharper v7.1.1000.900. You can find the compatibility matrix at <a class="ulink" href="http://stylecop.codeplex.com/">http://stylecop.codeplex.com/</a>.</p><p>Then you need to install them in a specific order to be able to use them. The exact order to install them is to begin with Resharper, and installing StyleCop after. If you didn't do it this way, you will have to remove both products and reinstall them in the right order.</p></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">When you open Visual Studio for the first time after having installed Resharper, you will be asked if you want to reset the default settings of Resharper to comply with StyleCop rules. Click on <span class="strong"><strong>Yes</strong></span> to do so.</li><li class="listitem">Now let's open our sample project. The first thing visible is a new column at the right-hand side of the code screen as shown in the following screenshot:<div class="mediaobject"><img src="graphics/9543_2_1.jpg" alt="How to do it..."/></div><p>This column updates in real time and gives you all the errors or warnings you have in your document. If you go over one of the warnings displayed in the file, you will be able to see a description of the warning.</p></li><li class="listitem">If you click on it, a light bulb icon will appear on the left-hand side of your code and provide you options for dealing with the error. Generally the options are of three kinds for each error:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">You can either autofix the rule, which is also marked by a light bulb icon</li><li class="listitem" style="list-style-type: disc">You can explicitly suppress the error by automatically adding a suppress message in your code. This is marked by a hammer icon</li><li class="listitem" style="list-style-type: disc">And you can change the level of this kind of error for Resharper. This is marked as a barred light bulb</li></ul></div><p>The following screenshot shows you the options available for dealing with the StyleCop violation:</p><div class="mediaobject"><img src="graphics/9543_2_2.jpg" alt="How to do it..."/></div></li><li class="listitem">As this is quite a long task, we can fix in one go most of the violations. To do so, use the <span class="strong"><strong>Clean up</strong></span> command. This command is accessible in three places:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">From the <span class="strong"><strong>Resharper</strong></span> | <span class="strong"><strong>Tools</strong></span> menu.</li><li class="listitem" style="list-style-type: disc">In the Explorer solution, from the context menu.</li><li class="listitem" style="list-style-type: disc">And from the coding panel's context menu.</li></ul></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec13"/>How it works...</h2></div></div></div><p>Whereas the auto clean up feature of Resharper helps to quickly fix a lot of violations, it won't fix all of them, and you will have to check the remaining violations manually or with the help of the fixing feature of Resharper.</p><p>If you want to know what the autofixing capabilities of the Resharper add-in are, you can refer to the following link:</p><p><a class="ulink" href="http://stylecop.codeplex.com/wikipage?title=ReSharper%20Fixes&amp;referringTitle=Documentation">http://stylecop.codeplex.com/wikipage?title=ReSharper%20Fixes&amp;referringTitle=Documentation</a></p><p>You can manage the behavior of the Resharper addin in the <span class="strong"><strong>Resharper</strong></span> | <span class="strong"><strong>Option…</strong></span> menu. You have two menus that address StyleCop. The first is the <span class="strong"><strong>Code Inspection</strong></span> | <span class="strong"><strong>Inspection Severity</strong></span> menu, which allows you to change the way each StyleCop violation is displayed in Resharper.</p><p>The second one allows you to manage how StyleCop is running under Resharper, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/9543_2_3.jpg" alt="How it works..."/></div><p>The most important part in this screen is the <span class="strong"><strong>Analysis Performance</strong></span> as it allows you to control the resources allocated to the StyleCop analysis.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec14"/>There's more...</h2></div></div></div><p>Though Resharper is certainly the most complete tool to autofix your violations and has the advantage of being directly supported by the StyleCop team, it's not the only program that is able to automatically correct violations. Other tools exist, and can help with StyleCop violation fixing.</p><div class="section" title="Dev Express – Code Rush"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec04"/>Dev Express – Code Rush</h3></div></div></div><p>This is a direct competitor of Resharper. Through plugins, it can also have some StyleCop compliant violation fixing features. However, at the time of writing, they seem to cover only a small part of StyleCop violations.</p><p>You can download Code Rush at the following address:</p><p><a class="ulink" href="http://www.devexpress.com/Products/Visual_Studio_Add-in/Coding_Assistance/index.xml">http://www.devexpress.com/Products/Visual_Studio_Add-in/Coding_Assistance/index.xml</a></p><p>The plugin used to include StyleCop violation fixing is <span class="strong"><strong>CR_StyleNinja</strong></span> and is available at the following site:</p><p><a class="ulink" href="http://code.google.com/p/dxcorecommunityplugins/wiki/CR_StyleNinja">http://code.google.com/p/dxcorecommunityplugins/wiki/CR_StyleNinja</a></p></div><div class="section" title="Code Maid"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec05"/>Code Maid</h3></div></div></div><p><span class="strong"><strong>Code Maid</strong></span> is a free Visual Studio add-in allowing you to reformat your code. While it doesn't have a plugin for StyleCop, it allows you to reformat your code in order to remove layout and ordering violations.</p><p>You can find the tool at the following address:</p><p><a class="ulink" href="http://www.codemaid.net/">http://www.codemaid.net/</a></p></div><div class="section" title="NArrange"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec06"/>NArrange</h3></div></div></div><p><span class="strong"><strong>Narrange</strong></span> is another code beautifier, but unlike Code Maid, it's not a Visual Studio add-in. All configurations are made in an XML file and you can set up NArrange launch from the Visual Studio external tools menu. The configuration has a tool to simplify its edition.</p><p>One of the advantages of this tool is the fact it is not dependant on Visual Studio. You can integrate it with other developing tools such as SharpDevelop or MonoDevelop.</p><p>You can download it at the following site:</p><p><a class="ulink" href="http://www.narrange.net/">http://www.narrange.net/</a></p></div></div></div>
<div class="section" title="Automating StyleCop using MSBuild (Simple)"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec11"/>Automating StyleCop using MSBuild (Simple)</h1></div></div></div><p>In this recipe, we will see how to automate our build process using MSBuild. We will describe which lines need to be added to the MSBuild project in order to enable StyleCop analysis and how to cap the number of violations encountered before the build breaks.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec15"/>Getting ready</h2></div></div></div><p>For this recipe, you will need to have:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">StyleCop 4.7 installed with the option MSBuild integration checked</li><li class="listitem" style="list-style-type: disc">A sample C# project to modify</li></ul></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec16"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open your project file with the text editor, and locate the following line:<div class="informalexample"><pre class="programlisting">&lt;Import Project="$(MSBuildBinPath)\Microsoft.CSharp.targets" /&gt;</pre></div></li><li class="listitem">After this, add the following line:<div class="informalexample"><pre class="programlisting">&lt;Import Project="$(ProgramFiles)\MSBuild\StyleCop\v4.7\StyleCop.targets" /&gt;</pre></div><p>This enables StyleCop analysis on the project.</p></li><li class="listitem">Now let's modify the behavior of the StyleCop task to brake after 100 violations are encountered. Locate the first <code class="literal">PropertyGroup</code> section within the project file, and then add a new XML element <code class="literal">StyleCopMaxViolationCount</code> with a value of <code class="literal">100</code>. For example:<div class="informalexample"><pre class="programlisting">&lt;Project DefaultTargets="Build" &gt;
  &lt;PropertyGroup&gt;
    &lt;Configuration Condition=" '$(Configuration)' == '' "&gt;
        Debug
    &lt;/Configuration&gt;
    &lt;Platform Condition=" '$(Platform)' == '' "&gt;
        AnyCPU
    &lt;/Platform&gt;
    &lt;ProductVersion&gt;8.0.50727&lt;/ProductVersion&gt;
    &lt;SchemaVersion&gt;2.0&lt;/SchemaVersion&gt;
    &lt;ProjectGuid&gt;
        {F029E8D9-743F-4C6F-95F3-6FBDA6477165}
    &lt;/ProjectGuid&gt;
    &lt;OutputType&gt;Exe&lt;/OutputType&gt;
    &lt;AppDesignerFolder&gt;Properties&lt;/AppDesignerFolder&gt;
    &lt;RootNamespace&gt;VanillaProject&lt;/RootNamespace&gt;
    &lt;AssemblyName&gt;VanillaProject&lt;/AssemblyName&gt;
    &lt;StyleCopMaxViolationCount&gt;
        100
    &lt;/StyleCopMaxViolationCount&gt;
  &lt;/PropertyGroup&gt;</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec17"/>How it works...</h2></div></div></div><p>The first element we added imports the StyleCop task in the project. That's all that is really required to enable StyleCop analysis via MSBuild. The element is located just under the project root node. It can be placed anywhere as long as it's a direct child of the root node. As you can see, the path used to locate the <code class="literal">StyleCop.Targets</code> file is dependant of the version you installed on your computer.</p><p>In the second part, I showed you how to modify the behavior of StyleCop by adding properties in the project.</p><p>There are 10 properties that can be modified that way; I will present the three most important to me:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">StyleCopAdditionalAddinPaths</code>: This allows you to specify other paths for your custom rules</li><li class="listitem" style="list-style-type: disc"><code class="literal">StyleCopTreatErrorsAsWarnings</code>: This allow you to turn your StyleCop violations into build errors</li><li class="listitem" style="list-style-type: disc"><code class="literal">StyleCopMaxViolationCount</code>: This allows you to specify the maximum number of violations we accept in the project before breaking the build</li></ul></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec18"/>There's more...</h2></div></div></div><p>Here is some other information that might come in handy in certain scenarios.</p><div class="section" title="Setting up properties of the task in a more global way"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec07"/>Setting up properties of the task in a more global way</h3></div></div></div><p>In this recipe, we have seen how to modify the StyleCop task behavior on a project basis. However, we can set the behavior properties as environment variables on the machine, or within the build environment command window. Setting the properties in this way will cause StyleCop to behave in the same way for all projects where StyleCop build integration is enabled.</p></div><div class="section" title="Excluding files from StyleCop analysis"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec08"/>Excluding files from StyleCop analysis</h3></div></div></div><p>Excluding files from analysis can be helpful in certain scenarios (such as in legacy projects, or when you add third-party <code class="literal">Mono.Options</code> files, for example). To do such a thing, you need to open your project file and change the compile node of the file:</p><div class="informalexample"><pre class="programlisting">&lt;Compile Include="File.cs"/&gt;</pre></div><p>Should become:</p><div class="informalexample"><pre class="programlisting">&lt;Compile Include="File.cs"&gt; 
  &lt;ExcludeFromStyleCop&gt;true&lt;/ExcludeFromStyleCop&gt; 
&lt;/Compile&gt;</pre></div></div></div></div>
<div class="section" title="Automating StyleCop using a command-line batch (Simple)"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec12"/>Automating StyleCop using a command-line batch (Simple)</h1></div></div></div><p>In this recipe, I will show you how to analyze your projects with StyleCop from the command line. For this, I will use a tool named <span class="strong"><strong>StyleCopCmd</strong></span>, and prepare it to be able to launch the last version of StyleCop.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec19"/>Getting ready</h2></div></div></div><p>For this recipe, you need to have the following elements:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">StyleCop 4.7 with MSBuild integration</li><li class="listitem" style="list-style-type: disc">StyleCopCmd 0.2.10 (Sources); they can be downloaded from <a class="ulink" href="http://sourceforge.net/projects/stylecopcmd/files/stylecopcmd/stylecopcmd-0.2.1/StyleCopCmd-src-0.2.1.0.zip/download">http://sourceforge.net/projects/stylecopcmd/files/stylecopcmd/stylecopcmd-0.2.1/StyleCopCmd-src-0.2.1.0.zip/download</a></li><li class="listitem" style="list-style-type: disc">A sample C# project to analyze</li></ul></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec20"/>How to do it...</h2></div></div></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note03"/>Note</h3><p>As indicated in the previous recipe, StyleCopCmd is not maintained anymore. However, the tool works correctly and need just a little tweaking to be run with the last version of StyleCop. That's what we will do in this recipe.</p></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the Visual Studio project of StyleCopCmd.</li><li class="listitem">First, we have to change the references of StyleCop libraries from 4.3 to 4.7. This is done quite easily in the all projects by removing the references to:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">Stylecop</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">Stylecop.CSharp</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">Stylecop.CSharp.Rules</code></li></ul></div></li><li class="listitem">Use Visual Studio to replace all <code class="literal">Microsoft.Stylecop</code> occurrences by StyleCop. When the project was put on CodePlex, one of the first things undertaken was the removal of Microsoft references.</li><li class="listitem">Finally, in the file <code class="literal">ReportBuilder.cs</code> of the StyleCopCmd project, remove the call to the dispose method in the method created at line 437.</li><li class="listitem">Verify you are able to generate your binaries (right-click on <span class="strong"><strong>Net.SF.StyleCopCmd.Console</strong></span> and click on <span class="strong"><strong>Build</strong></span>)<div class="mediaobject"><img src="graphics/9543_4_1.jpg" alt="How to do it..."/></div></li><li class="listitem">Now that we have our up-to-date binaries we can use them to launch StyleCop directly from the command line. To do so, open a command console, and then go to your StyleCopCmd directory and type the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Net.SF.StyleCopCmd.Console.exe -ifp "((.)*(Base*)(.)*(\.cs))|((.)*(\.Designer\.cs))|(AssemblyInfo\.cs)" -sf "..\StylecopCustomRule\StylecopCustomRule.sln" -of "stylecop-report.xml"</strong></span>
</pre></div></li><li class="listitem">On the screen, the only information that appears is the total number of violations and the list of files scanned:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Pass 1:   StylecopCustomRule.csproj - MyCustomRule.cs</strong></span>
<span class="strong"><strong>9 violations encountered.</strong></span>
</pre></div></li><li class="listitem">If we look at what has been generated, you will find two files in your directory:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">stylecop-report.xml</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">stylecop-report.violations.xml</code></li></ul></div><p>Both displays the list of violations generated by StyleCop; the only difference is the XML structure of the files. The first one follows StyleCopCmd internal schema and transformation files whereas the second is a bare output of StyleCop.</p></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec21"/>How it works...</h2></div></div></div><p>StyleCopCmd comes with a lot of options out of the box.</p><p>In the previous example, I made you give a solution file. However, StyleCop allows four kinds of entry point:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The solution files with <code class="literal">–sf</code> parameter</li><li class="listitem" style="list-style-type: disc">The project files with <code class="literal">–pf</code> parameter</li><li class="listitem" style="list-style-type: disc">Directory with <code class="literal">–d</code> parameter, an optional <code class="literal">–r</code> option allows you to force recursion on the given directory</li><li class="listitem" style="list-style-type: disc">And files with <code class="literal">–f</code> parameter</li></ul></div><p>The <code class="literal">ipf</code> parameter allows you to remove some of the files from StyleCop scan by providing a regular expression matching their filename.</p><p>Finally, the <code class="literal">-of</code> option permits you to specify the name of the output file. This is used with <code class="literal">–tf</code>, which is used to transform the output with the help of an XSLT file. It can give you any kind of human readable report.</p><p>To get help, launch StyleCopCmd with the <code class="literal">-?</code> option; this will display the available options as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/9543_4_2.jpg" alt="How it works..."/></div><p>I will let you explore the remaining possibilities.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec22"/>There's more...</h2></div></div></div><p>StyleCopCmd is not the only tool available to do StyleCop analysis from the command line. As we will see later, the <span class="strong"><strong>API</strong></span> of StyleCop is quite easy to understand and though they don't give a command line directly, lots of projects have been made to support this functionality.</p><div class="section" title="StyleCopCmd for Mono and Linux systems"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec09"/>StyleCopCmd for Mono and Linux systems</h3></div></div></div><p>StyleCopCmd has been made available on Mono and Linux systems thanks to the work of Ian Norton (<a class="ulink" href="https://github.com/inorton/StyleCopCmd">https://github.com/inorton/StyleCopCmd</a>).</p><p>The original version of StyleCopCmd is still linked to StyleCop 4.3, and you will have to upgrade the project to StyleCop 4.7 if you want to use the latest functionality of StyleCop.</p><p>Some problems are known and well documented. For me, the major problem I encountered was the registry key used by StyleCop. It forces the user to execute StyleCop commands with root privilege on the first start.</p></div><div class="section" title="StyleCop CLI"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec10"/>StyleCop CLI</h3></div></div></div><p><span class="strong"><strong>StyleCop CLI</strong></span> has the same objective as StyleCopCmd. It permits an integration of StyleCop from the command line in a wider automation system.</p><p>Compared to StyleCopCmd, this project has less functionality; one of the most important missing functionality is the ability to transform the output of StyleCop violations. However, the tool doesn't need any tweaking to be compatible with StyleCop 4.7 as it already embeds it. The tool is available at the following site:</p><p><a class="ulink" href="http://sourceforge.net/projects/stylecopcli/">http://sourceforge.net/projects/stylecopcli/</a></p></div><div class="section" title="Building your own"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec11"/>Building your own</h3></div></div></div><p>As I said earlier, lots of people have already started this task for you. However, if you're not satisfied with the existing tools or if you just want to look at how to make one, a good start is the tutorial made by the team of <span class="strong"><strong>StyleCop+,</strong></span> which gives you advice on how to start building such a tool. The tutorial is available at the following site:</p><p><a class="ulink" href="http://stylecopplus.codeplex.com/wikipage?title=Running%20StyleCop%20from%20Your%20Code">http://stylecopplus.codeplex.com/wikipage?title=Running%20StyleCop%20from%20Your%20Code</a></p></div></div></div>
<div class="section" title="Automating StyleCop using NAnt (Intermediate)"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec13"/>Automating StyleCop using NAnt (Intermediate)</h1></div></div></div><p>In this recipe, we will see how to use StyleCopCmd to automate our process using NAnt.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec23"/>Getting ready</h2></div></div></div><p>For this recipe, you will need to have:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">StyleCop 4.7 installed</li><li class="listitem" style="list-style-type: disc">NAnt Version 0.89 or higher</li><li class="listitem" style="list-style-type: disc">The sample C# project used in the previous recipe</li></ul></div><p>I will assume you have already used NAnt, and I will concentrate on describing the two methods to achieve integration of StyleCop task in to your NAnt script.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec24"/>How to do it...</h2></div></div></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note04"/>Note</h3><p>StyleCopCmd comes with its own NAnt task. It is contained in the <code class="literal">Net.SF.StyleCopCmd.Core.dll</code> file.</p></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">To include it in your NAnt script you will need to add a reference to this dll and add the following XML element in your project or target element:<div class="informalexample"><pre class="programlisting">&lt;styleCopCmd outputXmlFile="stylecop-report.xml"
             transformFile=""
             recursionEnabled="true"
             ignorePatterns="AssemblyInfo\.cs"
             processorSymbols="" 
             styleCopSettingsFile="Stylecop.Settings" &gt;
    &lt;solutionFiles&gt;
        &lt;include name="StylecopCustomRule.sln" /&gt;
    &lt;/solutionFiles&gt;
    &lt;projectFiles /&gt;
    &lt;directories /&gt;
    &lt;files /&gt;
&lt;/styleCopCmd&gt;</pre></div></li><li class="listitem">Once our build file is ready, we can execute it in a console, and we obtain the following output:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>NAnt 0.92 (Build 0.92.4543.0; release; 09/06/2012)</strong></span>
<span class="strong"><strong>Copyright (C) 2001-2012 Gerry Shaw</strong></span>
<span class="strong"><strong>http://nant.sourceforge.net</strong></span>

<span class="strong"><strong>Buildfile: file:///C:/dev/StylecopCustomRule/bin/test.build</strong></span>
<span class="strong"><strong>Target framework: Microsoft .NET Framework 4.0</strong></span>

<span class="strong"><strong>[styleCopCmd] Pass 1:   StylecopCustomRule.csproj - MyCustomRule.cs</strong></span>
<span class="strong"><strong>[styleCopCmd] 9 violations encountered.</strong></span>

<span class="strong"><strong>BUILD SUCCEEDED</strong></span>

<span class="strong"><strong>Total time: 1.6 seconds.</strong></span>
</pre></div></li><li class="listitem">As with the command-line version, we obtain two files in the directory that can be exploited in a CI to show the violations results:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">stylecop-report.xml</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">stylecop-report.violations.xml</code></li></ul></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec25"/>How it works...</h2></div></div></div><p>In the previous sample, I tried to give you the full NAnt command. In the <code class="literal">StyleCopCmd</code> element we can configure six attributes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">outputXmlFile</code>: This attribute is used to specify the result file we want.</li><li class="listitem" style="list-style-type: disc"><code class="literal">transformFile</code>: This attribute is used to specify the transformation (XSLT) file we want to apply to the result file.</li><li class="listitem" style="list-style-type: disc"><code class="literal">recursionEnabled</code>: This attribute is used to enable recursion in the directories to check.</li><li class="listitem" style="list-style-type: disc"><code class="literal">ignorePatterns</code>: This attribute contains a regular expression pattern to exclude filenames from scanning; in the sample I removed the <code class="literal">AssemblyInfo.cs</code> file from the scan.</li><li class="listitem" style="list-style-type: disc"><code class="literal">processorSymbols</code>: This attribute is used to specify a list of processor symbols (for example: <code class="literal">DEBUG</code>, <code class="literal">CODE_ANALYSIS</code>) to be used by StyleCop. Generally, it is not used in most scenarios.</li><li class="listitem" style="list-style-type: disc"><code class="literal">styleCopSettingsFile</code>: This attribute is used to specify a common settings file for all the files being scanned. If no common settings files exist, then it should be removed from the task.</li></ul></div><p>The elements <code class="literal">solutionFiles</code>, <code class="literal">projectFiles</code>, <code class="literal">directories</code>, and <code class="literal">files</code> are used to specify the different kinds of element to analyze.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec26"/>There's more...</h2></div></div></div><p>The explained method is not the only one usable to launch StyleCopCmd task. Another way to do it is to rely to the <code class="literal">exec</code> element of the NAnt framework. It allows you to use the command line executable of StyleCopCmd (or your own if you made it). The tool can be found at the following site:</p><p><a class="ulink" href="http://nant.sourceforge.net/release/0.92/help/tasks/exec.html">http://nant.sourceforge.net/release/0.92/help/tasks/exec.html</a></p></div></div>
<div class="section" title="Integrating StyleCop analysis results in Jenkins/Hudson (Intermediate)"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec14"/>Integrating StyleCop analysis results in Jenkins/Hudson (Intermediate)</h1></div></div></div><p>In this recipe we will see how to build and display StyleCop errors in Jenkins/Hudson jobs. To do so, we will need to see how to configure the Jenkins job with a full analysis of the C# files in order to display the technical debt of the project. As we want it to diminish, we will also set in the job an automatic recording of the last number of violations. Finally, we will return an error if we add any violations when compared to the previous build.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec27"/>Getting ready</h2></div></div></div><p>For this recipe, you will need to have:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">StyleCop 4.7 installed with the option MSBuild integration checked</li><li class="listitem" style="list-style-type: disc">A Subversion server</li><li class="listitem" style="list-style-type: disc">A working Jenkins server including:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The MSBuild plug in for Jenkins</li><li class="listitem" style="list-style-type: disc">The Violation plug in for Jenkins</li></ul></div></li><li class="listitem" style="list-style-type: disc">A C# project followed in a subversion repository.</li></ul></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec28"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">The first step is to build a working build script for your project. All solutions have their advantages and drawbacks. I will use MSBuild in this recipe. The only difference here will be that I won't separate files on a project basis but take the "whole" solution:<div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;Project DefaultTargets="StyleCop" &gt;
<span class="strong"><strong>  &lt;UsingTask TaskName="StyleCopTask" AssemblyFile="$(MSBuildExtensionsPath)\..\StyleCop 4.7\StyleCop.dll" /&gt;</strong></span>
  &lt;PropertyGroup&gt;
    &lt;!-- Set a default value of 1000000 as maximum Stylecop violations found --&gt;
    &lt;StyleCopMaxViolationCount&gt;1000000&lt;/StyleCopMaxViolationCount&gt;
  &lt;/PropertyGroup&gt;
  &lt;Target Name="StyleCop"&gt;

    &lt;!-- Get last violation count from file if exists --&gt;
<span class="strong"><strong>    &lt;ReadLinesFromFile Condition="Exists('violationCount.txt')" File="violationCount.txt"&gt;</strong></span>
<span class="strong"><strong>      &lt;Output TaskParameter="Lines" PropertyName="StyleCopMaxViolationCount" /&gt;</strong></span>
<span class="strong"><strong>    &lt;/ReadLinesFromFile&gt;</strong></span>

    &lt;!-- Create a collection of files to scan --&gt;
    &lt;CreateItem Include=".\**\*.cs"&gt;
      &lt;Output TaskParameter="Include" ItemName="StyleCopFiles" /&gt;
    &lt;/CreateItem&gt;

    &lt;!-- Launch Stylecop task itself --&gt;
    &lt;StyleCopTask
      ProjectFullPath="$(MSBuildProjectFile)"
      SourceFiles="@(StyleCopFiles)"
      ForceFullAnalysis="true"
      TreatErrorsAsWarnings="true"
      OutputFile="StyleCopReport.xml"
      CacheResults="true"
      OverrideSettingsFile= "StylecopCustomRule\Settings.Stylecop"
      MaxViolationCount="$(StyleCopMaxViolationCount)"&gt;

      &lt;!-- Set the returned number of violation --&gt;
<span class="strong"><strong>      &lt;Output TaskParameter="ViolationCount" PropertyName="StyleCopViolationCount" /&gt;</strong></span>
    &lt;/StyleCopTask&gt;

    &lt;!-- Write number of violation founds in last build --&gt;
<span class="strong"><strong>    &lt;WriteLinesToFile File="violationCount.txt" Lines="$(StyleCopViolationCount)" Overwrite="true" /&gt;</strong></span>
  &lt;/Target&gt;
&lt;/Project&gt;</pre></div></li><li class="listitem">After that, we prepare the files that will be scanned by the StyleCop engine and we launch the StyleCop task on it. We redirect the current number of violations to the <code class="literal">StyleCopViolationCount</code> property.</li><li class="listitem">Finally, we write the result in the <code class="literal">violationsCount.txt</code> file to find out the level of technical debt remaining. This is done with the <code class="literal">WriteLinesToFile</code> element.</li><li class="listitem">Now that we have our build script for our job, let's see how to use it with Jenkins. First, we have to create the Jenkins job itself. We will create a <span class="strong"><strong>Build a free-style software</strong></span> project. After that, we have to set how the subversion repository will be accessed, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/9543_6_1.jpg" alt="How to do it..."/></div><p>We also set it to check for changes on the subversion repository every 15 minutes.</p><p>Then, we have to launch our MSBuild script using the MSBuild task. The task is quite simple to configure and lets you fill in three fields:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>MSBuild Version</strong></span>: You need to select one of the MSBuild versions you configured in Jenkins (<span class="strong"><strong>Jenkins</strong></span> | <span class="strong"><strong>Manage Jenkins</strong></span> | <span class="strong"><strong>Configure System</strong></span>)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>MSBuild Build File</strong></span>: Here we will provide the <code class="literal">Stylecop.proj</code> file we previously made</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Command Line Arguments</strong></span>: In our case, we don't have any to provide, but it might be useful when you have multiple targets in your MSBuild file</li></ul></div></li><li class="listitem">Finally we have to configure the display of StyleCop errors. This were we will use the violation plugin of Jenkins. It permits the display of multiple quality tools' results on the same graphic. In order to make it work, you have to provide an XML file containing the violations.<div class="mediaobject"><img src="graphics/9543_6_2.jpg" alt="How to do it..."/></div><p>As you can see in the preceding screenshot, Jenkins is again quite simple to configure. After providing the XML filename for StyleCop, you have to fix thresholds to build health and the maximum number of violations you want to display in the detail screen of each file in violation.</p></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec29"/>How it works...</h2></div></div></div><p>In the first part of the <span class="emphasis"><em>How to do it…</em></span> section, we presented a build script. Let's explain what it does:</p><p>First, as we don't use the premade MSBuild integration, we have to declare in which assembly the StyleCop task is defined and how we will call it. This is achieved through the use of the <code class="literal">UsingTask</code> element.</p><p>Then we try to retrieve the previous count of violations and set the maximum number of violations that are acceptable at this stage of our project. This is the role of the <code class="literal">ReadLinesFromFile</code> element, which reads the content of a file. As we added a condition to ascertain the existence of the <code class="literal">violationsCount.txt</code> file, it will only be executed if the file exists. We redirect the output to the property <code class="literal">StyleCopMaxViolationCount</code>.</p><p>After that we have configured the Jenkins job to follow our project with StyleCop. We have configured some strict rules to ensure nobody will add new violations over time, and with the violation plugin and the way we addressed StyleCop, we are able to follow the technical debt of the project regarding StyleCop violations in the <span class="strong"><strong>Violations</strong></span> page.</p><div class="mediaobject"><img src="graphics/9543_6_3.jpg" alt="How it works..."/></div><p>A summary of each file is also present and if we click on one of them, we will be able to follow the violations of the file.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip03"/>Tip</h3><p><span class="strong"><strong>How to address multiple projects with their own StyleCop settings</strong></span></p><p>As far as I know, this is the limit of the MSBuild StyleCop task. When I need to address multiple projects with their own settings, I generally switch to StyleCopCmd using NAnt or a simple batch script and process the <code class="literal">stylecop-report.violations.xml</code> file with an XSLT to get the number of violations.</p></div></div></div></div>
<div class="section" title="Customizing file headers (Simple)"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec15"/>Customizing file headers (Simple)</h1></div></div></div><p>In this recipe, we will see how to customize file headers to avoid StyleCop violations, and how we can use Visual Studio templates and snippets to make our life easier while developing.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec30"/>Getting ready</h2></div></div></div><p>For this recipe, you will need to have:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">StyleCop 4.7 installed</li><li class="listitem" style="list-style-type: disc">Visual Studio 2008 or higher</li></ul></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec31"/>How to do it...</h2></div></div></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note05"/>Note</h3><p>StyleCop doesn't use a lot of rules for headers. Basically, it requires the following things: the file name, a copyright, a company name, and a summary.</p><p>Let's try to make a LGPL header compliant with StyleCop. As there's no advice on how to integrate the Version 3.0, we will stick with the header proposed in Version 2.1 and which can be viewed at <a class="ulink" href="http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html">http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html</a>.</p></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">The only requirements of the LGPL license header is to give one line to describe the project, the year of the project, and the author that wrote it (I will use the company name as the author). So the file header should look something like the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>// &lt;summary&gt;</strong></span>
<span class="strong"><strong>// {one line to give the library's name and an idea of what it does.}</strong></span>
<span class="strong"><strong>// &lt;/summary&gt;</strong></span>
<span class="strong"><strong>// &lt;copyright file="{File}" company="{Company}"&gt;</strong></span>
<span class="strong"><strong>// Copyright (C) {year} {Company}</strong></span>
<span class="strong"><strong>//</strong></span>
<span class="strong"><strong>// This library is free software; you can redistribute it and/or</strong></span>
<span class="strong"><strong>// modify it under the terms of the GNU Lesser General Public</strong></span>
<span class="strong"><strong>// License as published by the Free Software Foundation; either</strong></span>
<span class="strong"><strong>// version 2.1 of the License, or (at your option) any later version.</strong></span>
<span class="strong"><strong>//</strong></span>
<span class="strong"><strong>// This library is distributed in the hope that it will be useful,</strong></span>
<span class="strong"><strong>// but WITHOUT ANY WARRANTY; without even the implied warranty of</strong></span>
<span class="strong"><strong>// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</strong></span>
<span class="strong"><strong>// Lesser General Public License for more details.</strong></span>
<span class="strong"><strong>//</strong></span>
<span class="strong"><strong>// You should have received a copy of the GNU Lesser General Public</strong></span>
<span class="strong"><strong>// License along with this library; if not, write to the Free Software</strong></span>
<span class="strong"><strong>// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA</strong></span>
<span class="strong"><strong>// &lt;/copyright&gt;</strong></span>
</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note06"/>Note</h3><p>As you can see, I have separated the summary of the project from the main license part. I also enclosed in brackets the variables part of the license. Some people also like to add some contact information. To do so, I would add an author element at the end of the file.</p></div></div></li><li class="listitem">Having this license is great in itself; however it will be quite boring to add it manually in each file we create. In order to automate it, we will create a Visual Studio template. This will help you to have consistent file headers during your project at a minimal cost. To begin with, we will create a new library project, and modify <code class="literal">Class1.cs</code> by adding the previous LGPL header we made. Now, we have to modify the line of the summary section to comply with our project description; then we will modify the first copyright lines to enable visual studio to change text automatically. The first two lines of the copyright section have to be changed like this:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>// &lt;copyright file="$safeitemname$.cs" company="$registeredorganization$"&gt;</strong></span>
<span class="strong"><strong>// Copyright (C) $year$ $registeredorganization$</strong></span>
</pre></div></li><li class="listitem">In this code, we just introduce some Visual Studio template parameters:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">safeitemname</code>: This is the name you provide when you add a new item to your project.</li><li class="listitem" style="list-style-type: disc"><code class="literal">year</code>: This is the year you added the file.</li><li class="listitem" style="list-style-type: disc"><code class="literal">registeredorganization</code>: This is the name of the company you provided during your Windows installation. It can be found in the registry under the <code class="literal">HKLM\Software\Microsoft\Windows NT\CurrentVersion\RegisteredOrganization</code> key.</li></ul></div></li><li class="listitem">Now that we have our model for the template ready, we have to export it.</li><li class="listitem">Click on the <span class="strong"><strong>File</strong></span> menu and select <span class="strong"><strong>Export Template</strong></span>.</li><li class="listitem">Select the <code class="literal">Class1.cs</code> item, and then click on <code class="literal">Next</code>.</li><li class="listitem">Add the default assemblies you want to include in the template, and then click on <span class="strong"><strong>Next</strong></span>.</li><li class="listitem">Modify the template name and template description to suit your taste and click on <span class="strong"><strong>Finish</strong></span>.<div class="mediaobject"><img src="graphics/9543_7_2.jpg" alt="How to do it..."/></div></li></ol></div><p>The template is now available in the <span class="strong"><strong>My templates</strong></span> section when you create a new file.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec32"/>How it works...</h2></div></div></div><p>In this recipe, we see a way to include your own licensing section in headers. If your needs are not so specific that they include a particular license, you can have a look at this site <a class="ulink" href="http://vstemplates.codeplex.com/">http://vstemplates.codeplex.com/</a>, which provides some basic templates for visual studio compatible with StyleCop.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec33"/>There's more...</h2></div></div></div><p>In the following paragraph we will see two others topics meant to help you manage the headers of your code files.</p><div class="section" title="Other ways to handle the headers"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec12"/>Other ways to handle the headers</h3></div></div></div><p>While templates are ideal for new files, you might need to apply your templates to old work. Visual Studio provides numerous ways to do so. You can at least rely on snippets or macro.</p><p><span class="strong"><strong>Snippets</strong></span> are quite easy to create. They are in fact a simple XML file with a piece of code containing parameters. Let's create it for the LGPL license:</p><div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;CodeSnippets &gt;
  &lt;CodeSnippet Format="1.0.0"&gt;
    &lt;Header&gt;
      &lt;Title&gt;Add LGPL License&lt;/Title&gt;
      &lt;Author&gt;Franck LEVEQUE&lt;/Author&gt;
      &lt;Description&gt;Add LGPL License to a file&lt;/Description&gt;
      &lt;Shortcut&gt;copyright&lt;/Shortcut&gt;
    &lt;/Header&gt;
    &lt;Snippet&gt;
      &lt;Declarations&gt;
        &lt;Literal Editable="true"&gt;
          &lt;ID&gt;Description&lt;/ID&gt;
          &lt;ToolTip&gt;Insert here your project description &lt;/ToolTip&gt;
          &lt;Default&gt;Project description&lt;/Default&gt;
        &lt;/Literal&gt;
        &lt;Literal Editable="true"&gt;
          &lt;ID&gt;ClassName&lt;/ID&gt;
          &lt;Default&gt;ClassNamePlaceHolder&lt;/Default&gt;
        &lt;/Literal&gt;
        &lt;Literal Editable="true"&gt;
          &lt;ID&gt;Company&lt;/ID&gt;
          &lt;Default&gt;Company&lt;/Default&gt;
        &lt;/Literal&gt;
        &lt;Literal Editable="true"&gt;
          &lt;ID&gt;year&lt;/ID&gt;
          &lt;Default&gt;Year&lt;/Default&gt;
        &lt;/Literal&gt;
      &lt;/Declarations&gt;
      &lt;Code Language="csharp" Kind="" Delimiter="$"&gt;&lt;![CDATA[// &lt;summary&gt;
// $Description$
// &lt;/summary&gt;
// &lt;copyright file="$ClassName$.cs" company="$Company$"&gt;
// Copyright (C) $year$ $Company$
//
// This library is free software; you can redistribute it and/or
// modify it under the terms of the GNU Lesser General Public
// License as published by the Free Software Foundation; either
// version 2.1 of the License, or (at your option) any later version.
//
// This library is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
// Lesser General Public License for more details.
//
// You should have received a copy of the GNU Lesser General Public
// License along with this library; if not, write to the Free Software
// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA  
// &lt;/copyright&gt;]]&gt;&lt;/Code&gt;
    &lt;/Snippet&gt;
  &lt;/CodeSnippet&gt;
&lt;/CodeSnippets&gt;</pre></div><p>The first part of the snippet named <code class="literal">Header</code> describes what will be displayed in the snippet menu; I added a <code class="literal">Shortcut</code> element to be able to use it by typing copyright followed by two tabulations. The two really important sections are the <code class="literal">Declarations</code> section and the <code class="literal">Code</code> section. As you can see the <code class="literal">Code</code> section is simply the code of the LGPL we created in the first part. We just replaced each variable name with a parameter name surrounded by <code class="literal">$</code>. The <code class="literal">Declarations</code> section contains a definition of all the parameters you use in your snippet code. Each <code class="literal">Literal</code> element contains an <code class="literal">Editable</code> attribute specifying that you can edit the parameter, an <code class="literal">ID</code> element that is the variable name surrounded by <code class="literal">$</code> in the code and a default value.</p><p>Your snippets usable in C# are generally located in <code class="literal">Documents\Visual Studio 2008\Code Snippets\Visual C#\My Code Snippets</code>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note07"/>Note</h3><p>To edit snippets more easily, you can use <span class="strong"><strong>Snippet Editor</strong></span>. It can be downloaded at <a class="ulink" href="http://snippeteditor.codeplex.com/">http://snippeteditor.codeplex.com/</a>.</p></div></div></div><div class="section" title="Company configuration"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec13"/>Company configuration</h3></div></div></div><p>StyleCop can enforce a specific company name and a copyright text in the copyright section. This might be useful if you want to be sure all the files of your project have the same copyright information. To do so, you need to go in the StyleCop settings in the <span class="strong"><strong>Company Information</strong></span> tab.</p><div class="mediaobject"><img src="graphics/9543_7_1.jpg" alt="Company configuration"/></div><p>The <span class="strong"><strong>Company Name</strong></span> field corresponds to the <code class="literal">company</code> attribute of your <code class="literal">copyright</code> tag, whereas the <span class="strong"><strong>Copyright</strong></span> field refers to the content of the <code class="literal">copyright</code> tag.</p></div></div></div>
<div class="section" title="Creating custom rules (Intermediate)"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec16"/>Creating custom rules (Intermediate)</h1></div></div></div><p>In this recipe, we will see how to create our own custom rules for the StyleCop engine. We will also see how to add parameters to this rule.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec34"/>Getting ready</h2></div></div></div><p>For this recipe, you will need to have:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">StyleCop 4.7 installed</li><li class="listitem" style="list-style-type: disc">Visual Studio 2008</li></ul></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec35"/>How to do it...</h2></div></div></div><p>In the early days of StyleCop, lots of the rules chosen by Microsoft were criticized. One of them was the fact that the developer couldn't add an underscore at the beginning of their private instance fields. In this recipe, we will take this rule as an example and try to implement it at the beginning of non public instance fields.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note08"/>Note</h3><p>This rule directly conflicts with the following StyleCop rules:</p><p><span class="strong"><strong>SA1306</strong></span>: Variable names and private field names must start with a lower-case letter</p><p><span class="strong"><strong>SA1309</strong></span>: Field names must not start with an underscore.</p><p>You will have to disable them, if you want to use the rule.</p></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">To create our custom rule, the first thing we must do is create a new Class Library project in Visual Studio. Then, we need to add the following reference to our project:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">Stylecop</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">Stylecop.CSharp</code></li></ul></div><p>Both libraries are located in the installation directory of StyleCop.</p></li><li class="listitem">The rules need to be implemented in a code analyzer. Each analyzer is composed of two files:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A file containing the class that will discover your rules violations</li><li class="listitem" style="list-style-type: disc">An XML file containing the rules description</li></ul></div></li><li class="listitem">Let's begin with the XML file. This file should have the same name as your analyzer class. Its purpose is to describe the analyzer category, describe the rules it contains, and prepare the parameters you might need in your rules. Let's have look at the file contained in our custom rule:<div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;SourceAnalyzer Name="NamingExtension"&gt;
<span class="strong"><strong>  &lt;Description&gt;</strong></span>
    Naming rules extending Stylecop.
  &lt;/Description&gt;
<span class="strong"><strong>  &lt;Properties&gt;</strong></span>
    &lt;BooleanProperty
      Name="UseTokenAnalysis"
      DefaultValue="true"
      FriendlyName="Token Analysis"
      Description="Indicates whether the analyzer of document will the token analysis or the visitor pattern analysis."
      DisplaySettings="true"/&gt;
  &lt;/Properties&gt;
<span class="strong"><strong>  &lt;Rules&gt;</strong></span>
    &lt;Rule Name="NonPublicFieldsMustBeginBy" CheckId="NE1001"&gt;
      &lt;Context&gt;Instance fields should be prefixed.&lt;/Context&gt;
      &lt;Description&gt;Instance fields should be prefixed to allow a better visibility of non public fields.&lt;/Description&gt;
    &lt;/Rule&gt;
  &lt;/Rules&gt;
&lt;/SourceAnalyzer&gt;</pre></div><p>The file is composed of three important elements:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <code class="literal">Description</code> element is used to define the description that will be displayed to the user for the category.</li><li class="listitem" style="list-style-type: disc">The <code class="literal">Properties</code> section is optional, and allows you to define parameters you want to use in the different rules that your analyzer manages. There are four available kinds of properties: <code class="literal">BooleanProperty</code>, <code class="literal">StringProperty</code>, <code class="literal">IntegerProperty</code>, and <code class="literal">CollectionProperty</code>. They can be accessed in your code by the analyzer function <code class="literal">GetSetting(Settings, String)</code>.</li><li class="listitem" style="list-style-type: disc">The <code class="literal">Rules</code> section is used to describe all the rules your analyzer will manage.</li></ul></div></li><li class="listitem">Next we need to create our analyzer class, which inherits <code class="literal">SourceAnalyzer</code> and defines <code class="literal">SourceAnalizerAttribute,</code> specifying which parser this analyzer is for:<div class="informalexample"><pre class="programlisting">using System;
using System.Linq;

using StyleCop;
using StyleCop.CSharp;

namespace StylecopCustomRule
{
    /// &lt;summary&gt;
    /// Description of custom rule for stylecop
    /// &lt;/summary&gt;
<span class="strong"><strong>    [SourceAnalyzer(typeof (CsParser))]</strong></span>
<span class="strong"><strong>    public class NonPublicFieldsMustBeginBy : SourceAnalyzer</strong></span>
    {
<span class="strong"><strong>        public override void AnalyzeDocument(CodeDocument document)</strong></span>
        {
            var csDocument = (CsDocument) document;
            
            // General settings
            var generalSettings = (from parser in document.Settings.ParserSettings
                         where parser.AddIn.GetType().Equals(typeof(CsParser))
                         select parser).Single();
            BooleanProperty analyseGeneratedFiles = (BooleanProperty)generalSettings[«AnalyzeGeneratedFiles»];


            if (csDocument.RootElement != null &amp;&amp;
               (analyseGeneratedFiles.Value || !csDocument.RootElement.Generated))
            {
<span class="strong"><strong>                csDocument.WalkDocument(new CodeWalkerElementVisitor&lt;object&gt;(this.VisitElement), null, null);</strong></span>
            }
        }

<span class="strong"><strong>        private bool VisitElement(CsElement element, CsElement parentElement, object context)</strong></span>
        {
            if (element.ElementType == ElementType.Field &amp;&amp; 
                element.ActualAccess != AccessModifierType.Public &amp;&amp;
                element.ActualAccess != AccessModifierType.Internal &amp;&amp; 
                !element.Declaration.Name.StartsWith("_"))
            {
<span class="strong"><strong>                this.AddViolation(element, "NonPublicFieldsMustBeginBy", new object[0]);</strong></span>
            }

            return true;
        }
    }
}</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec36"/>How it works...</h2></div></div></div><p>The main entry point is the <code class="literal">AnalyzeDocument</code> function; this is where the document will be analyzed to see if it contains any broken rules. We have two options. Either we use the visitor pattern provided by StyleCop, and in this case we have to define code walkers for the type of construction we want to check (there are four walkers available: <code class="literal">CodeWalkerElementVisitor</code>, <code class="literal">CodeWalkerStatementVisitor</code>, <code class="literal">CodeWalkerExpressionVisitor</code>, and <code class="literal">CodeWalkerQueryClauseVisitor</code>), or you can directly access the token list and check them directly. The second approach is a little trickier as upper constructions are made of one or more tokens. To use it in our example, we just have to replace the call to the visitor function by a <span class="strong"><strong>LINQ</strong></span> request selecting the tokens in violation of your rule. For our sample, it will look as follows:</p><div class="informalexample"><pre class="programlisting">if (csDocument.RootElement != null &amp;&amp; (analyseGeneratedFiles.Value || !csDocument.RootElement.Generated))
{
   Array.ForEach(
       (from token in csDocument.Tokens
        let element = token.FindParentElement()
        where token.CsTokenClass == CsTokenClass.Token &amp;&amp;
        token.CsTokenType == CsTokenType.Other &amp;&amp;
        element.ElementType == ElementType.Field &amp;&amp;
        element.ActualAccess != AccessModifierType.Public &amp;&amp;
        element.ActualAccess != AccessModifierType.Internal &amp;&amp;
        !token.Text.StartsWith("_")
        select element).ToArray(),
        a =&gt; this.AddViolation(
        a, 
        "NonPublicFieldsMustBeginByUnderscore", 
        new object[0]));                
}</pre></div><p>As you can see, both ways of enforcing our rule look quite similar as we need the parent element of tokens to check easily if the token is a field and if it respects the rule. To exclude tokens of the element construct I had to add further restrictions based on the token class and token type.</p><p>When you report your violations you have to be careful of the name of the violation as any reference to an unknown rule in the XML file will just discard the violation.</p><p>In this recipe, we have seen how to implement a rule. However, you have to keep in mind that the analyzer is designed to allow you to create a set of rules, not just one. We have also seen that the central method of the analyzer is the <code class="literal">AnalyzeDocument</code> function; this is where you have to analyze the rule violations and report them. We also quickly see how to set some properties and use them.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec37"/>There's more...</h2></div></div></div><p>However, custom tasks is a huge topic. In addition, you can customize the StyleCop setting, unit test your rules, and much more.</p><div class="section" title="Customize your StyleCop settings dialog"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec14"/>Customize your StyleCop settings dialog</h3></div></div></div><p>Defining your properties in the XML file of the analyzer doesn't display them in the StyleCop settings UI. Only <code class="literal">BooleanProperty</code> can be shown directly using the <code class="literal">DisplaySettings</code> element as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/9543_8_1.jpg" alt="Customize your StyleCop settings dialog"/></div><p>All other properties require a custom UI. This is achieved by providing <code class="literal">UserControl</code> implementing <code class="literal">Stylecop.IPropertyControlPage</code>.</p><p>A really great tutorial is provided in the <span class="emphasis"><em>Adding a Custom StyleCop Settings Page</em></span> section of the StyleCop SDK.</p></div><div class="section" title="Unit testing your rules"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec15"/>Unit testing your rules</h3></div></div></div><p>Unit testing your rules is really important and can be achieved quite easily. To do so, we have to rely to the integration API provided by the StyleCop team. In this recipe code, I have made a project to unit test my rule using NUnit 2.6.2.</p><p>As it was only one rule, I didn't abstract the StyleCop integration in a base class, but this should be done as all your rules will depend on the same code implementation.</p><p>I also use test files that I placed in the <code class="literal">TestFiles</code> directory.</p></div></div></div>
<div class="section" title="Integrating StyleCop in your own tool (Advanced)"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec17"/>Integrating StyleCop in your own tool (Advanced)</h1></div></div></div><p>In this recipe, we will see how to embed StyleCop with your own tools. As an example, we will create a <span class="emphasis"><em>real-time</em></span> analysis add-in for MonoDevelop/Xamarin Studio.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec38"/>Getting ready</h2></div></div></div><p>For this recipe, you will need to have:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">StyleCop 4.7 installed</li><li class="listitem" style="list-style-type: disc">Xamarin Studio 4.0 or MonoDevelop 4.0</li></ul></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec39"/>How to do it...</h2></div></div></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note09"/>Note</h3><p>MonoDevelop add-ins are library projects composed of two mandatory components:</p><p>An <code class="literal">addin.xml</code> file describing the add-in, its dependencies, and the dll files to load at runtime and the code of your add-in.</p><p>We will create an add-in with an executable command in the tool menu to activate or deactivate the real-time analysis.</p></div></div><p>Let's go to the part related to the StyleCop analysis itself; for this I will heavily rely on the code provided with this recipe:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We first initialize a StyleCop console in our command handler constructor (<code class="literal">RealTimeEgine.cs</code> line 85-87):<div class="informalexample"><pre class="programlisting">this.console = new StyleCopConsole(null, true, null, null, true);
this.console.OutputGenerated += this.OnOutputGenerated;
this.console.ViolationEncountered += this.OnViolationEncountered;</pre></div><p>The <code class="literal">StyleCopConsole</code> class is the main entry point of the StyleCop analysis system, and it is able to run the analysis and report the violations found.</p><p>We currently use default settings, but the arguments passed to the engine are really important if you want to embed specific settings or rule analyses.</p><p>The five constructor parameters are:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The first argument is the path to the settings you want to load. If it is set to null value, then it uses the default project settings files.</li><li class="listitem" style="list-style-type: disc">The second argument indicates whether we want to write results cache files or not.</li><li class="listitem" style="list-style-type: disc">The third argument is the path of the output file we want to write in.</li><li class="listitem" style="list-style-type: disc">The fourth argument is a list of paths to search for parser and analyzer add-ins. It can be set to null if no add-ins are provided.</li><li class="listitem" style="list-style-type: disc">The last argument indicates whether we want to load add-ins from the default path where the core binary is located.</li></ul></div></li><li class="listitem">After the initialization of our console, we indicate callbacks for its output and the violations encountered.</li><li class="listitem">Now let's see the execution code itself (<code class="literal">RealTimeEgine.cs</code> line 166-180):<div class="informalexample"><pre class="programlisting">Configuration configuration = new Configuration(new string[0]);
List&lt;CodeProject&gt; projects = new List&lt;CodeProject&gt;();
CodeProject project = new CodeProject(IdeApp.ProjectOperations.CurrentSelectedProject.BaseDirectory.GetHashCode(),IdeApp.ProjectOperations.CurrentSelectedProject.BaseDirectory, 
configuration);
                
// Add each source file to this project.                              this.console.Core.Environment.AddSourceCode(project, tmpFileName, null);
projects.Add(project);
this.console.Start(projects, false);</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec40"/>How it works...</h2></div></div></div><p>To execute the analysis, we have to define a <code class="literal">Configuration</code> object, this is used to allow StyleCop to analyze preprocessor regions (for example, if you want to analyze regions marked by a <code class="literal">#if DEBUG</code>, you should add the <code class="literal">DEBUG</code> string in this object).</p><p>After that, we configure our project itself; it's the common unit under which we analyze a subset of files. It takes an ID, a base path, and a configuration.</p><p>Then we add each source file related to the project, in our case it is a temporary file made of the content of the file currently being edited.</p><p>Finally, we start the console process. The callbacks we set up at the beginning will transmit the violations and the process message to the host.</p><p>The add-in is plugged to two events of the MonoDevelop apps:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">ActiveDocumentChanged</code>: This event is called when the active document is "replaced" by another one.</li><li class="listitem" style="list-style-type: disc"><code class="literal">DocumentParsed</code>: This event is called once the document has been correctly parsed by MonoDevelop. It is run after almost every modification in the text editor.</li></ul></div><p>Following is the sequence diagram of the add-in:</p><div class="mediaobject"><img src="graphics/9543_9_1.jpg" alt="How it works..."/></div><p>You should have a look at the full source code to understand how the add-in really works.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec41"/>There's more...</h2></div></div></div><p>The current add-in is just the beginning. It currently contains some drawbacks (first launch of StyleCop) and can be improved in many ways. Here some of them:</p><div class="section" title="Add a configuration screen"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec16"/>Add a configuration screen</h3></div></div></div><p>The add-in is currently not configurable. While this is not really important if you use the default parameters of StyleCop and don't have any custom rules, it will be mandatory for a finished product. It could at least define a way to add StyleCop settings and a path to check for custom rules.</p></div><div class="section" title="Do the work in a background thread"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec17"/>Do the work in a background thread</h3></div></div></div><p>One of the most significant drawback of the current implementation is that the UI freezes for one to two seconds during the first launch of the StyleCop analysis. To prevent this, we should put the StyleCop analysis in a separate thread to let the user interact with the interface during the analysis.</p></div><div class="section" title="Change the display of violations"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec18"/>Change the display of violations</h3></div></div></div><p>I used the error pad in this example, but Xamarin Studio is similar to Resharper when it reports violations. So we should reposition the reporting of violations to the bar at the right of the text editor.</p></div></div></div></body></html>