<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch08"/>Chapter 8. Unreal Motion Graphics</h1></div></div></div><p>
<strong>Unreal Motion Graphics</strong> (<strong>UMG</strong>) is a<a id="id355" class="indexterm"/> User Interface (UI) authoring tool that is used to<a id="id356" class="indexterm"/> create in game <strong>Heads up Display</strong> (<strong>HUDs</strong>), Main Menu, and other UI elements. They are created using a special blueprint called <strong>Widget Blueprint</strong>
<a id="id357" class="indexterm"/>, which contains various predefined widgets that you can use to construct your interface. Let's take a look at UMG now.</p><p>In this chapter, you will learn how to create UMG Widgets and assign one to our character to display his health. You will also learn how to create floating health bars.</p><div><div><div><div><h1 class="title"><a id="ch08lvl1sec39"/>Setting up a project</h1></div></div></div><p>To get started, start<a id="id358" class="indexterm"/> Unreal Engine 4 and create a new project based on Third Person Template.</p><p>Since we are going to have a HUD with a health bar, let's add a new health variable to our Third Person Character Blueprint. Open up the <strong>ThirdPersonCharacter</strong> Blueprint in the <code class="literal">ThirdPersonBP/Blueprints</code> folder:</p><div><img src="img/B03950_08_01.jpg" alt="Setting up a project"/></div><p>Inside our character Blueprint, create a new <a id="id359" class="indexterm"/>variable called <strong>Health</strong> and follow these steps:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Set the variable type to <code class="literal">float</code> and give it a default value of 100. The next step is to create a <strong>Pure</strong> function that shows the percentage of the total health of the player.</li><li class="listitem" style="list-style-type: disc">Inside your Character Blueprint, create a new function (for example, <strong>GetHealthPercentage</strong>) and open it.</li><li class="listitem" style="list-style-type: disc">In the function graph, get your health variable and divide it by the default value of health. By doing so, we will get the percentage of our player health. To get the default value of any variable in your class, just right-click in graph and search for <strong>Get Class Defaults</strong>. This node will return all the default values of the variables you created.</li><li class="listitem" style="list-style-type: disc">Now, create a new <a id="id360" class="indexterm"/>output for this function (float type) and connect the result (divide node) to this output. This function will now return the percentage of your player health. For example, if your player's health is 42, then dividing it by 100 (default health value) will return 0.42. We can use this information for our progress bar in HUD as well as the floating health bar.</li></ul></div><p>The resulting Blueprint function should look like this:</p><div><img src="img/B03950_08_02.jpg" alt="Setting up a project"/></div><div><div><h3 class="title"><a id="note22"/>Note</h3><p>Note that it is very important to set the output name to <strong>ReturnValue</strong>.</p></div></div><p>We will now create a UMG Widget and make use of this function to display the player's health. </p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec70"/>Creating the HUD Widget</h2></div></div></div><p>To create a new <a id="id361" class="indexterm"/>Widget Blueprint:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Right-click on Content Browser</li><li class="listitem" style="list-style-type: disc">Select <strong>Widget Blueprint</strong> under the <strong>User Interface</strong> section:<div><img src="img/B03950_08_03.jpg" alt="Creating the HUD Widget"/></div></li></ul></div><p>Once you select that, a new <strong>Widget Blueprint</strong> will be placed in Content Browser and it prompts you to enter<a id="id362" class="indexterm"/> a new name. For this example, I named it <code class="literal">MyUMG_HUD</code>.</p><p>Double-click on <code class="literal">MyUMG_HUD</code> to open it:</p><div><img src="img/B03950_08_04.jpg" alt="Creating the HUD Widget"/><div><p>Widget Blueprint User Interface</p></div></div><p>This is Widget Blueprint. This is where you create the UI for your game. Let's take a closer look at Widget Blueprint UI:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Toolbar</strong>: This is the common toolbar that lets you <strong>Compile</strong>, <strong>Save</strong>, <strong>Play</strong>, and <strong>Debug</strong> your graph.</li><li class="listitem" style="list-style-type: disc"><strong>Editor Mode</strong>: This lets<a id="id363" class="indexterm"/> you switch between the <strong>Designer</strong> mode and the <strong>Graph</strong> mode.</li><li class="listitem" style="list-style-type: disc"><strong>Visual Designer</strong>: This is the main area where you drag and drop all the widgets to create your UI as it appears in the game.</li><li class="listitem" style="list-style-type: disc"><strong>Palette</strong>: This is the list of widgets that you can drag and drop into <strong>Visual Designer</strong>. This will also list any custom widgets you have created.</li><li class="listitem" style="list-style-type: disc"><strong>Hierarchy</strong>: This displays the structure of this widget. You can drag and drop widgets in this too.</li><li class="listitem" style="list-style-type: disc"><strong>Animation List</strong>: This lets you create new <strong>Animation Tracks</strong>, which you can use to animate various properties of widgets.</li><li class="listitem" style="list-style-type: disc"><strong>Animation Track Editor</strong>: After creating a new Animation, you can select that Animation and create key frames here.</li></ul></div><p>Since we will be using this as our player HUD, let's create a progress bar that shows the player's health.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec71"/>Creating the health bar</h2></div></div></div><p>From the <strong>Palette</strong> window, drag and drop<a id="id364" class="indexterm"/> the <strong>Progress Bar</strong> widget on to the <strong>Visual Designer</strong>. Once placed on the <strong>Visual Designer</strong>, you can resize it to any size you want. You can also place it anywhere, but, for this example, I decided to keep it at the bottom-left corner of the screen.</p><p>When you select the <strong>Progress Bar</strong> widget, you will see all the properties that you can edit in <strong>Details Panel</strong> including the name of your <strong>Progress Bar</strong>. For this example, I have changed the name of our progress bar to HealthBar. The <strong>Progress Bar</strong> widget offers a variety of settings that you can change including the look and feel.</p><p>The following screenshot is from the health bar that I have just placed:</p><div><img src="img/B03950_08_05.jpg" alt="Creating the health bar"/></div><p>Let's take a quick look at some of the common settings that you will change:</p><p>
<strong>Anchors</strong>: These define the location of the widget and maintain it for varying screen sizes. By default, there are 16 anchor positions and, typically, one of these is sufficient for most needs. But there are times where you have to adjust the Anchor position manually. For example, if your game has an<a id="id365" class="indexterm"/> inventory system where the player can dynamically resize the contents, then you need to tweak the Anchor position manually. For this example, we will set the Anchor position to the lower-left corner of the screen.</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Position X</strong>: This positions the widget on the <em>X Axis</em>. (horizontal).</li><li class="listitem" style="list-style-type: disc"><strong>Position Y</strong>: This positions the widget on the <em>Y Axis</em>. (vertical).</li><li class="listitem" style="list-style-type: disc"><strong>Size X</strong>: This scales the widget on the <em>X Axis</em>.</li><li class="listitem" style="list-style-type: disc"><strong>Size Y</strong>: This scales the widget on the <em>Y Axis</em>.</li><li class="listitem" style="list-style-type: disc"><strong>Alignment</strong>: This is the pivot point of the widget. Setting both <strong>X</strong> and <strong>Y</strong> to <code class="literal">0.0</code> will set the pivot point to the upper left corner and setting both to <code class="literal">1.0</code> will set the pivot point to the lower-right corner. You can use the alignment option with Anchors to precisely set a widget to the center of the screen. For example, you can set alignment (both <strong>X</strong> and <strong>Y</strong>) to <code class="literal">0.5</code> and Anchors to the center and set both position <strong>X</strong> and <strong>Y</strong> to <code class="literal">0.0</code>. This will bring your widget exactly to the center of the screen. This can be used for setting a crosshair.</li><li class="listitem" style="list-style-type: disc"><strong>Size to Content</strong>: If enabled, this widget will ignore <strong>Size X</strong> and <strong>Size Y</strong> values and, instead, scale according to the Widget content. For example, if your widget is a <strong>Text Block</strong>, then it will scale automatically according to the size of the given text.</li><li class="listitem" style="list-style-type: disc"><strong>ZOrder</strong>: This defines the render priority for this widget. Higher priority widgets are rendered last, which makes them appear on top of other widgets.</li><li class="listitem" style="list-style-type: disc"><strong>Style</strong>: This defines the look and feel of this widget. Note that each widget has its own unique style settings (you can either use a <strong>Texture</strong> or <strong>Material</strong> to use as an image for your widget). If it's a progress bar widget, then style category will let you change the progress bar fill image, background image, and marquee image. If it was a button, then you can change the image of the button based on the button state. For example, <strong>Normal</strong> state, <strong>Hover</strong> state, <strong>Pressed</strong> state, and so on.</li><li class="listitem" style="list-style-type: disc"><strong>Percent</strong>: This fills the progress bar with the given value. It ranges from 0-1. In this example, we will use the <strong>Health Percentage</strong> of our character to drive this value.</li><li class="listitem" style="list-style-type: disc"><strong>Bar Fill Type</strong>: This defines how the progress bar fills. For example, from left to right, right to left, from the center, and more.</li><li class="listitem" style="list-style-type: disc"><strong>Is Marquee</strong>: This enables the marquee animation progress bar. This means that the progress bar will show activity but does not indicate when it will stop.</li><li class="listitem" style="list-style-type: disc"><strong>Fill Color and Opacity</strong>: This defines the color and opacity for the fill image of the progress bar.</li></ul></div><p>Now that we know the <strong>Progress Bar</strong> settings, let's continue and assign the Health Percentage of our character to the health bar we created. To do that, first let's switch our <strong>Editor</strong> mode to <strong>Graph</strong> mode by clicking on the <strong>Graph</strong> button on the top-left corner of Widget Blueprint. Once you click, you will see the Blueprint graph editor for this widget.</p><p>On the left side of the widget <a id="id366" class="indexterm"/>Blueprint, you will see the <strong>My Blueprint</strong> tab. As you have learned previously in the chapter on Blueprints, this is where you create your variables. So let's create a new variable (I named it <code class="literal">MyCharacter</code>) and set the type for our <strong>Third Person Character</strong>. See the following screenshot for reference:</p><div><img src="img/B03950_08_06.jpg" alt="Creating the health bar"/></div><p>Once you create that, go back to the <strong>Designer</strong> mode and select your <strong>Progress Bar</strong>. In the <strong>Details Panel</strong>, you can see a <strong>Bind</strong> option near the <strong>Percent</strong> value. When you click on it, you will see a new dropdown menu that shows our newly created <code class="literal">MyCharacter</code> variable. Move your mouse over it and you will see the <strong>GetPlayerHealthPercentage</strong> function, which we created previously:</p><div><img src="img/B03950_08_07.jpg" alt="Creating the health bar"/></div><p>Once you click on that, it will<a id="id367" class="indexterm"/> set the Health Percentage value from our character to the progress bar.</p><div><div><h3 class="title"><a id="note23"/>Note</h3><p>If you don't see your character variable in the <strong>Bind</strong> dropdown, make sure you compiled the <strong>Widget Blueprint</strong>.</p></div></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec40"/>Assigning our HUD to Character</h1></div></div></div><p>Now that we have<a id="id368" class="indexterm"/> finished setting up the HUD, it is time we assign it to the character. Let's close <strong>Widget Blueprint</strong> for now and open <strong>ThirdPersonCharacter Blueprint</strong>.</p><p>Inside our <strong>Character Blueprint</strong>, open the <strong>Event Graph</strong> and:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Right-click and, from the<a id="id369" class="indexterm"/> resulting context menu, search for <strong>Event BeginPlay</strong> and select it.</li><li class="listitem" style="list-style-type: disc">Drag a wire from the execution pin of <strong>Event BeginPlay</strong> and release the mouse button. From the context menu, search for <strong>Create Widget</strong> and select it.</li><li class="listitem" style="list-style-type: disc">In the <strong>Create Widget</strong> node, select <strong>MyUMG_HUD</strong> in the class pin.</li><li class="listitem" style="list-style-type: disc">From the <strong>Return Value</strong> of the <strong>Create Widget</strong> node, drag a new wire and release the mouse button. From the context menu, search for <strong>Set My Character</strong> and select it.</li><li class="listitem" style="list-style-type: disc">Right-click on the graph editor and search for <code class="literal">self</code> and select <strong>Get a reference to self</strong>. Connect this node to the <strong>My Character</strong> pin.</li><li class="listitem" style="list-style-type: disc">Again, drag a wire from the <strong>Return Value</strong> of the <strong>Create Widget</strong> node and search for <strong>Add to Viewport</strong>.</li><li class="listitem" style="list-style-type: disc">Connect the<a id="id370" class="indexterm"/> output execution pin of the <strong>Set My Character</strong> node to the input execution pin of <strong>Add to Viewport</strong>.</li></ul></div><p>The resulting graph should look like this:</p><div><img src="img/B03950_08_08.jpg" alt="Assigning our HUD to Character"/></div><p>Now, if you play the game, you will<a id="id371" class="indexterm"/> see the health bar filled completely:</p><div><img src="img/B03950_08_09.jpg" alt="Assigning our HUD to Character"/></div><div><div><h3 class="title"><a id="note24"/>Note</h3><p>If your health bar is still empty, make sure you set the output name of <strong>GetHealthPercentage</strong> to <strong>ReturnValue</strong>.</p></div></div><p>To test it, we <a id="id372" class="indexterm"/> can create a new function called <strong>DecrementHealth</strong> and create a <a id="id373" class="indexterm"/>graph like this:</p><div><img src="img/B03950_08_10.jpg" alt="Assigning our HUD to Character"/></div><p>After that, drag and drop this function from your <strong>My Blueprints</strong> tab and connect it after the <strong>Add to Viewport</strong> node. Now, if<a id="id374" class="indexterm"/> you start playing, you will <a id="id375" class="indexterm"/>see the player health going down randomly.</p></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec41"/>Creating floating health bars</h1></div></div></div><p>In this section, you will learn how to create <a id="id376" class="indexterm"/>a floating health bar above the character's head. Let's go back to <strong>Content Browser</strong> and create a new <strong>Widget Blueprint</strong> (for this example, I'll name it <strong>MyFloatingHealthbar</strong>) and open it.</p><p>In the <strong>Designer</strong> tab, you can see an option called <strong>Fill Screen</strong> at the top-right corner of the visual designer. Click on that and change it to <strong>Custom</strong>:</p><div><img src="img/B03950_08_11.jpg" alt="Creating floating health bars"/></div><p>The <strong>Custom</strong> mode will let you assign the width and height of this widget. Let's set the width and height to 256 and 32. Now, we will drag and drop a new Progress Bar into the visual designer and use the following settings:</p><div><img src="img/B03950_08_12.jpg" alt="Creating floating health bars"/></div><p>Set the <strong>Anchors</strong> to the very <a id="id377" class="indexterm"/>last anchor (this is the Fill Anchor). Anchor helps the widget stay in its position with different screen sizes. This avoids the widget being cropped off the screen. In addition to the fill anchor, there are other preset anchors too, such as fill bottom left side, fill right side, fill bottom area, fill top area, top left, center, right corners, and more. Based on the position of your widget, you can select any Anchor you want and, in the game, the widget will be positioned relative to the Anchor position.</p><p>In this example, since we set the anchor to fill, Position X and Y and Size X and Y will be replaced with <strong>Offset Left</strong>, <strong>Top</strong>, <strong>Right</strong>, and <strong>Bottom</strong> respectively. Change the <strong>Offset Right</strong> and <strong>Bottom</strong> to <code class="literal">0.0</code>. The Progress Bar will now be properly stretched to the width and height of the visual designer.</p><p>Now, let's create a new variable called <strong>My Character</strong> with the type set to your <strong>ThirdPersonCharacter Blueprint</strong> and bind the <strong>Percent</strong> value to your character's <strong>GetHealthPercentage</strong> function. This is the exact same step we performed for our HUD Widget.</p><p>After setting the percent value, let's close this <strong>Widget Blueprint</strong> for now and open <strong>ThirdPersonCharacter Blueprint</strong>. Switch to the <strong>Viewport</strong> tab and click on <strong>Add Component</strong> in the <strong>Components</strong> tab and select <strong>Widget Component</strong>:</p><div><img src="img/B03950_08_13.jpg" alt="Creating floating health bars"/></div><p>Once you select it, this widget <a id="id378" class="indexterm"/>component will be added to your Player Character. Select the newly added <strong>Widget Component</strong> and in <strong>Details Panel</strong>, set the <strong>Draw Size</strong> to the same size we used for our <strong>MyFloatingHealthbar</strong>, which was <code class="literal">256</code> and <code class="literal">32</code>. And then set the <strong>Widget Class</strong> to <strong>MyFloatingHealthbar</strong> class and set <strong>Space</strong> to <strong>Screen</strong>. Finally, move the <strong>Widget</strong> to your desired location. In this example, I've set it above the character's head.</p><p>For reference, here is the screenshot:</p><div><img src="img/B03950_08_14.jpg" alt="Creating floating health bars"/></div><p>If you play now, you will see the health bar floating on top of the player's head but it will be empty. This is because we haven't assigned the <strong>My Character</strong> value to our floating health bar. To make it work:</p><div><ol class="orderedlist arabic"><li class="listitem">Switch to the <strong>Construction Script</strong> tab.</li><li class="listitem">Right-click anywhere on the <strong>Construction Script</strong> tab, search for <strong>Get Widget</strong>, and select it.</li><li class="listitem">Drag a new wire from the <strong>Widget</strong> node you just created, search for <strong>Get User Widget Object</strong>, and select it.</li><li class="listitem">Drag a new wire from <strong>Get User Widget Object</strong> Return Value pin, search for <strong>Cast</strong> to <strong>MyFloatingHealthbar</strong>, and select it.</li><li class="listitem">Connect the output execution pin of <strong>Construction Script</strong> to this newly created <strong>Cast</strong> node.</li><li class="listitem">From the output pin (such as <strong>My Floating Healthbar</strong>) drag a new wire and search for <strong>Set My Character</strong> and select it.</li><li class="listitem">Connect the unnamed <a id="id379" class="indexterm"/>output execution pin of the <strong>Cast</strong> node to the <strong>Set My Character</strong> node.</li><li class="listitem">Right-click on the graph editor, search for <code class="literal">self</code>, and select <strong>Get a reference to self</strong>. Connect this node to the <strong>My Character</strong> pin.</li></ol></div><p>That's it! Now if you press play, you will see your character's health bar floating on top of your player's head:</p><div><img src="img/B03950_08_15.jpg" alt="Creating floating health bars"/></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec42"/>Summary</h1></div></div></div><p>UMG can be used to create a wide variety of UI effects. From here, you can extend this by adding a player portrait image next to your floating health bar or give a weapon to your character and show the ammo count for that weapon and more. You can also add the Widget component to other actors in your game (for example, a treasure chest) that shows information about that actor. Remember that laying out your UI in Visual Designer is only the beginning. To make your UI look good, you have to change the look and feel by changing the style of your widgets.</p></div></body></html>