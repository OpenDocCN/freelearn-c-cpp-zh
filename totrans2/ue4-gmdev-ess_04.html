<html><head></head><body><div class="chapter" title="Chapter&#xA0;4.&#xA0;Post Process"><div class="titlepage"><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Post Process</h1></div></div></div><p>Post Process in Unreal Engine 4 allows you to create a variety of artistic effects and change the overall look and feel of the whole game. Post Process effects are activated using Post Process Volumes and can be used individually to affect only a specific area or the entire scene. You can have multiple Post Process Volumes overlapping and render their effects based on their priority. Post Process Volumes can be used to add or modify simple effects such as Bloom, Lens Flares, Eye Adaptation, Depth of Field, and so on and they can also be used to get advanced effects using Materials. Another great feature of Post Process Volume is <a id="id171" class="indexterm"/>
<span class="strong"><strong>Look up Table</strong></span> (<span class="strong"><strong>LUT</strong></span>), which is used to store color transformations from image editing software, such as Adobe Photoshop or GIMP. They are very easy to set up and can yield very good results. We will get into LUT later in this chapter.</p><p>When you first start a project without starter content, there will be no Post Process Volumes present in the scene, so Engine will use the default settings. You can change these settings per project under <span class="strong"><strong>Project Settings</strong></span>:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Click on <span class="strong"><strong>Edit</strong></span> in the menu bar.</li><li class="listitem">Click on <span class="strong"><strong>Project Settings</strong></span>.</li><li class="listitem">Go to the <span class="strong"><strong>Rendering</strong></span> section.</li><li class="listitem">Expand <span class="strong"><strong>Default Postprocessing Settings</strong></span>:<div class="mediaobject"><img src="graphics/B03950_04_01.jpg" alt="Post Process"/></div></li></ol></div><p>Here, you will see the default settings for Unreal Engine when there is no Post Process Volume in your scene. You can modify these settings or add a Post Process Volume to override them independently.</p><div class="section" title="Adding Post Process"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec24"/>Adding Post Process</h1></div></div></div><p>To use <a id="id172" class="indexterm"/>Post Process, you need a Post Process Volume in your scene:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go to the <span class="strong"><strong>Modes</strong></span> tab (if you closed it, press <span class="emphasis"><em>Shift</em></span> + <span class="emphasis"><em>1</em></span>).</li><li class="listitem">Select the <span class="strong"><strong>Volumes</strong></span> tab.</li><li class="listitem">Drag and drop Post Process Volume into the scene:<div class="mediaobject"><img src="graphics/B03950_04_02.jpg" alt="Adding Post Process"/></div></li></ol></div><p>You now have a Post Process Volume in your scene. However, it only shows the effects when the player is inside that volume. To make it affect the whole scene perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select <span class="strong"><strong>Post Process Volume</strong></span></li><li class="listitem">In the <span class="strong"><strong>Details</strong></span> panel, scroll down and expand the <span class="strong"><strong>Post Process Volume</strong></span> section</li><li class="listitem">Enable <span class="strong"><strong>Unbound</strong></span></li></ol></div><p>Enabling <span class="strong"><strong>Unbound</strong></span> will<a id="id173" class="indexterm"/> ignore the bounds of this volume and affect the whole scene. Now, let's take a quick look at these Post Process settings:</p><div class="mediaobject"><img src="graphics/B03950_04_03.jpg" alt="Adding Post Process"/></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Priority</strong></span>: If multiple volumes are overlapping each other, then the volume with higher priority overrides the lower one.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Blend Radius</strong></span>: This is the radius of the volume used for blending. Generally, a value of <code class="literal">100</code> works best. This setting is ignored if you have <span class="strong"><strong>Unbound</strong></span> enabled.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Blend Weight</strong></span>: This defines the influence of properties. <code class="literal">0</code> means no effect and <code class="literal">1</code> means full effect.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Enabled</strong></span>: This enables or disables this volume.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Unbound</strong></span>: If enabled, then Post Process effects will ignore the bounds of this volume and will affect the whole scene.</li></ul></div><div class="section" title="LUT"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec44"/>LUT</h2></div></div></div><p>LUTs <a id="id174" class="indexterm"/>are <a id="id175" class="indexterm"/>color neutral textures unwrapped to a 256 x 16 size texture. They are used to create unique artistic effects and are modified using image editing software such as Adobe Photoshop. If you are not familiar with Photoshop, you can use free and open source software such as GIMP. The following is an image of the default LUT texture:</p><div class="mediaobject"><img src="graphics/B03950_04_04.jpg" alt="LUT"/></div><p>The <a id="id176" class="indexterm"/>procedure of LUT is as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First you take a screenshot of your world and bring it into Photoshop.</li><li class="listitem">On top of that screenshot, you insert the LUT texture.</li><li class="listitem">Then on top of both, apply color manipulations (for example: adjustment layer).</li><li class="listitem">Now select the LUT texture and save it with your color manipulation as PNG or TGA.</li><li class="listitem">Finally, import your LUT into Unreal Engine.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note09"/>Note</h3><p>Note that after you import your LUT into <span class="strong"><strong>Content Browser</strong></span>, open it and set the <span class="strong"><strong>Texture Group</strong></span> to <span class="strong"><strong>ColorLookupTable</strong></span>. This is an important step and should not be skipped.</p></div></div></li></ol></div><p>To apply the<a id="id177" class="indexterm"/> LUT, select the Post Process volume, and under the <span class="strong"><strong>Scene Color</strong></span> section, you can enable <span class="strong"><strong>Color Grading</strong></span> and set your LUT texture:</p><div class="mediaobject"><img src="graphics/B03950_04_05.jpg" alt="LUT"/></div><p>With the <span class="strong"><strong>Color Grading Intensity</strong></span> option, you can change the intensity of the effect.</p></div><div class="section" title="Post Process Materials"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec45"/>Post Process Materials</h2></div></div></div><p>Post Process Materials <a id="id178" class="indexterm"/>help you create custom <a id="id179" class="indexterm"/>post processing with the help of Material Editor. You need to create a Material with your desired effect and assign it to <span class="strong"><strong>Blendables</strong></span> in Post Process Volume. Click on the plus sign to add more slots:</p><div class="mediaobject"><img src="graphics/B03950_04_06.jpg" alt="Post Process Materials"/></div><p>Before I explain about Post Process Materials, let's take a quick look at one of the most important Post Process nodes in Material Editor:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Scene Texture</strong></span>: This node has multiple selections that output different textures:<div class="mediaobject"><img src="graphics/B03950_04_07.jpg" alt="Post Process Materials"/></div></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>UVs</strong></span> (optional): This input tiles the texture. For UV operations on the <span class="strong"><strong>SceneTexture</strong></span> node, it is good to use the <span class="strong"><strong>ScreenPosition</strong></span> node instead of the regular <span class="strong"><strong>Texture Coordinate</strong></span> node.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Color</strong></span>: This outputs the final texture as RGBA. If you want to multiply this with a<a id="id180" class="indexterm"/> color, you first need to use a component mask to extract R, G, and B and then multiply it by your color.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Size</strong></span>: This outputs the size (width and height) of the texture.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>InvSize</strong></span>: This is the inverse of the <span class="strong"><strong>Size</strong></span> output. (1/width and 1/height).<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note10"/>Note</h3><p>It is important to keep in mind that you should only use Post Process Materials when you really need them. For <span class="strong"><strong>Color Correction</strong></span> and various other effects, you should stick with the settings from Post Process Volume since they are more efficient and optimized.</p></div></div></li></ul></div></div><div class="section" title="Creating a Post Process Material"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec46"/>Creating a Post Process Material</h2></div></div></div><p>With <a id="id181" class="indexterm"/>Post Process Material, you can create your own custom Post Processing effects. Some examples are:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Highlighting a specific object in your game</li><li class="listitem" style="list-style-type: disc">Rendering occluded objects</li><li class="listitem" style="list-style-type: disc">Edge detection, and so on</li></ul></div><p>In this quick example, we will see how to highlight an object in our world. To render a specific object separately, we need to put them to a custom depth buffer. The good thing is, it's as easy as clicking on a checkbox.</p><p>Select your Static Mesh and under the <span class="strong"><strong>Rendering</strong></span> section, expand the options and enable <span class="strong"><strong>Render Custom Depth</strong></span>:</p><div class="mediaobject"><img src="graphics/B03950_04_08.jpg" alt="Creating a Post Process Material"/></div><p>Now that<a id="id182" class="indexterm"/> the mesh is rendered in the <code class="literal">CustomDepth</code> buffer, we can use this information in Material Editor to mask out and render it separately. To do that:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a new Material and open it.</li><li class="listitem">First thing to do now is to set <span class="strong"><strong>Material Domain</strong></span> to <span class="strong"><strong>Post Process</strong></span>. This will disable all inputs except <span class="strong"><strong>Emissive Color</strong></span>.</li><li class="listitem">Now, right-click on the graph and search for <span class="strong"><strong>SceneTexture</strong></span> and select it. Set <span class="strong"><strong>Scene Texture Id</strong></span> to <span class="strong"><strong>CustomDepth</strong></span>.</li><li class="listitem"><span class="strong"><strong>CustomDepth</strong></span> outputs a raw value so let's divide it by the distance we want.</li><li class="listitem">Add a new <span class="strong"><strong>Divide</strong></span> node and connect <span class="strong"><strong>CustomDepth</strong></span> to input <span class="emphasis"><em>A</em></span>. Select the divide node and for <span class="emphasis"><em>Const B</em></span> give a high value (for example: <code class="literal">100000000</code>). Remember, 1 Unreal Unit is equal to <code class="literal">1</code> cm so if you give a small value like <code class="literal">100</code> or <code class="literal">1000</code>, you need to go really close to the object to see the effect. This is why we use a very large value.</li><li class="listitem">Add <a id="id183" class="indexterm"/>a <span class="strong"><strong>Clamp</strong></span> node and connect <span class="strong"><strong>Divide</strong></span> to the first input of the <span class="strong"><strong>Clamp</strong></span> node.</li><li class="listitem">Create a <span class="strong"><strong>Lerp</strong></span> node and connect the output of <span class="strong"><strong>Clamp</strong></span> to the <span class="emphasis"><em>Alpha</em></span> input of <span class="strong"><strong>Lerp</strong></span>. The <span class="strong"><strong>Lerp</strong></span> node will blend input <code class="literal">A</code> and <code class="literal">B</code> based on the alpha value. If the alpha value is <code class="literal">1</code>, then input <span class="emphasis"><em>A</em></span> is used. If it is <code class="literal">0</code> then input <span class="emphasis"><em>B</em></span> is used.</li><li class="listitem">Create another <span class="strong"><strong>SceneTexture</strong></span> node and set its <span class="emphasis"><em>Scene Texture Id</em></span> to <span class="strong"><strong>PostProcessInput0</strong></span>. <span class="strong"><strong>PostProcessInput0</strong></span> outputs the final HDR color so make sure you use this. There's another output called <span class="strong"><strong>SceneColor</strong></span>, which does the same but it outputs lower quality of the current scene.</li><li class="listitem">Right-click on the graph again and search for the <span class="strong"><strong>Desaturation</strong></span> node. Connect <span class="strong"><strong>PostProcessInput0</strong></span> <span class="emphasis"><em>Color</em></span> output to <span class="strong"><strong>Desaturation</strong></span> input. We will use this to desaturate the whole scene except our mesh with <span class="strong"><strong>CustomDepth</strong></span>.</li><li class="listitem">Connect the <span class="strong"><strong>Desaturation</strong></span> output to <span class="emphasis"><em>Lerp B</em></span> and <span class="strong"><strong>PostProcessInput0</strong></span> to <span class="emphasis"><em>Lerp A</em></span>, and finally, connect the <span class="strong"><strong>Lerp</strong></span> to <span class="strong"><strong>Emissive Color</strong></span>.</li></ol></div><p>Here is the final screenshot of the whole graph:</p><div class="mediaobject"><img src="graphics/B03950_04_09.jpg" alt="Creating a Post Process Material"/></div><p>And in this <a id="id184" class="indexterm"/>example scene, I've applied this Material to Post Process Blendables and you can see the effect:</p><div class="mediaobject"><img src="graphics/B03950_04_10.jpg" alt="Creating a Post Process Material"/></div><p>Everything <a id="id185" class="indexterm"/>that is in color has Render Custom Depth enabled so the Post Process Material is masking them out and applying the desaturation to the entire scene.</p></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec25"/>Summary</h1></div></div></div><p>In next chapter, we will add lights and discuss Light Mobility, Lightmass, and Dynamic Lights.</p></div></body></html>