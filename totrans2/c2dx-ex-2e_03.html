<html><head></head><body>
<div id="page" style="height:0pt"/><div class="book" title="Chapter&#xA0;3.&#xA0;Your First Game &#x2013; Air Hockey"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03" class="calibre1"/>Chapter 3. Your First Game – Air Hockey</h1></div></div></div><p class="calibre6">
<span class="strong"><em class="calibre8">We are going to build an Air Hockey game to introduce you to all the main aspects of building a project with Cocos2d-x. These include setting up the project's configuration, loading images, loading sounds, building a game for more than one screen resolution, and managing touch events.</em></span>
</p><p class="calibre6">
<span class="strong"><em class="calibre8">Oh, and you will need to call a friend. This is a two player game. Go on, I'll wait here.</em></span>
</p><p class="calibre6">By the end of this chapter, you will know:</p><div class="book"><ul class="itemizedlist"><li class="listitem">How to build an iPad-only game</li><li class="listitem">How to enable multitouch</li><li class="listitem">How to support both retina and non-retina displays</li><li class="listitem">How to load images and sounds</li><li class="listitem">How to play sound effects</li><li class="listitem">How to create sprites</li><li class="listitem">How to extend the Cocos2d-x <code class="email">Sprite</code> class</li><li class="listitem">How to create labels and update them</li></ul></div><p class="calibre6">Without further ado...let's begin.</p></div>

<div class="book" title="Chapter&#xA0;3.&#xA0;Your First Game &#x2013; Air Hockey">
<div class="book" title="Game configurations"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_1"><a id="ch03lvl1sec28" class="calibre1"/>Game configurations</h1></div></div></div><p class="calibre6">The game <a id="id86" class="calibre1"/>will have the following characteristics:</p><div class="book"><ul class="itemizedlist"><li class="listitem">It must support multitouch since it's a two player game</li><li class="listitem">It must be played on large screens since it's a two player game</li><li class="listitem">It must support retina displays because we want to cash in on that</li><li class="listitem">It must be played only in portrait mode because I built the art in portrait</li></ul></div><p class="calibre6">So let's create our project!</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Time for action &#x2013; creating your game project"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec29" class="calibre1"/>Time for action – creating your game project</h1></div></div></div><p class="calibre6">I'll build <a id="id87" class="calibre1"/>the game first in Xcode and then show how to take the project to Eclipse, but the folder structure remains the same, so you can work with any IDE you wish and the instructions here will be the same:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open the terminal and create a new Cocos2d-x project called <code class="email">AirHockey</code> that uses C++ as its main language. I saved mine on the desktop, so the command I had to enter looks like this:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre7">cocos new AirHockey -p com.rengelbert.AirHockey -l cpp -d /Users/rengelbert/Desktop/AirHockey</strong></span>
</pre></div></li><li class="listitem" value="2">Once the project is created, navigate to its <code class="email">proj.ios_mac</code> folder and double-click on the <code class="email">AirHockey.xcodeproj</code> file. (For Eclipse, you can follow the same steps we did when we created the <code class="email">HelloWorld</code> project to import the project.)</li><li class="listitem" value="3">Select the top item in <span class="strong"><strong class="calibre7">Project Navigator</strong></span> and making sure the <span class="strong"><strong class="calibre7">iOS</strong></span> target is selected, edit the information by navigating to <span class="strong"><strong class="calibre7">General</strong></span> | <span class="strong"><strong class="calibre7">Deployment info</strong></span>, setting the target device to <span class="strong"><strong class="calibre7">iPad</strong></span> and <span class="strong"><strong class="calibre7">Device Orientation</strong></span> to <span class="strong"><strong class="calibre7">Portrait</strong></span> and <span class="strong"><strong class="calibre7">Upside Down</strong></span>.<div class="mediaobject"><img src="../images/00007.jpeg" alt="Time for action – creating your game project" class="calibre9"/></div><p class="calibre14"> </p></li><li class="listitem" value="4">Save your project changes.</li></ol><div class="calibre12"/></div></div>

<div class="book" title="Time for action &#x2013; creating your game project">
<div class="book" title="What just happened?"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec29" class="calibre1"/>
<span class="strong"><em class="calibre8">What just happened?</em></span>
</h2></div></div></div><p class="calibre6">You<a id="id88" class="calibre1"/> created a Cocos2d-x project targeting iPads, and you are ready to set it up with the rest of the configurations I described earlier.</p><p class="calibre6">So let's do that now.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Time for action &#x2013; laying down the rules"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec30" class="calibre1"/>Time for action – laying down the rules</h1></div></div></div><p class="calibre6">We'll <a id="id89" class="calibre1"/>update the <code class="email">RootViewController.mm</code> file.</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Go to <code class="email">RootViewController.mm</code> inside the <code class="email">ios</code> folder and look for the <code class="email">shouldAutorotateToInterfaceOrientation</code> method. Change the line inside the method to read:<div class="informalexample"><pre class="programlisting">return UIInterfaceOrientationIsPortrait( interfaceOrientation );</pre></div></li><li class="listitem" value="2">And a few lines below in the <code class="email">supportedInterfaceOrientations</code> method, change the line inside the conditional <code class="email">to</code>:<div class="informalexample"><pre class="programlisting">return UIInterfaceOrientationMaskPortrait;</pre></div></li></ol><div class="calibre12"/></div></div>

<div class="book" title="Time for action &#x2013; laying down the rules">
<div class="book" title="What just happened?"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec30" class="calibre1"/>
<span class="strong"><em class="calibre8">What just happened?</em></span>
</h2></div></div></div><p class="calibre6">We just told <code class="email">RootViewController</code> we want our application to play in any of the two supported portrait modes.</p></div></div>
<div class="book" title="Supporting retina displays"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec31" class="calibre1"/>Supporting retina displays</h1></div></div></div><p class="calibre6">Now<a id="id90" class="calibre1"/> let's add the images to our project.</p></div>

<div id="page" style="height:0pt"/><div class="book" title="Time for action &#x2013; adding the image files"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec32" class="calibre1"/>Time for action – adding the image files</h1></div></div></div><p class="calibre6">First, we <a id="id91" class="calibre1"/>download the resources for this project, and then we add them in Xcode.</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Go to this book's <span class="strong"><strong class="calibre7">Support</strong></span> page (<a class="calibre1" href="http://www.packtpub.com/support">www.packtpub.com/support</a>) and download the <code class="email">4198_03_RESOURCES.zip</code> file. Inside it, you should find three folders called <code class="email">hd</code>, <code class="email">sd</code>, and <code class="email">fonts</code>.</li><li class="listitem" value="2">Go to your <code class="email">Project</code> folder, the actual folder in your system. Drag the three folders to the <code class="email">Resources</code> folder inside your project.</li><li class="listitem" value="3">Go back to Xcode. Select the <code class="email">Resources</code> folder in your project navigation panel. Then go to <span class="strong"><strong class="calibre7">File</strong></span> | <span class="strong"><strong class="calibre7">Add Files to AirHockey</strong></span>.</li><li class="listitem" value="4">In the <span class="strong"><strong class="calibre7">File</strong></span> window, navigate to the <code class="email">Resources</code> folder and select the <code class="email">sd</code>, <code class="email">hd</code>, and <code class="email">fonts</code> folders.</li><li class="listitem" value="5">This is <a id="id92" class="calibre1"/>very important: make sure <span class="strong"><strong class="calibre7">Create folder references for any added folders</strong></span> is selected. Also make sure you selected <span class="strong"><strong class="calibre7">AirHockey</strong></span> as the target. It wouldn't hurt to make sure <span class="strong"><strong class="calibre7">Copy items to destination...</strong></span> is also selected.</li><li class="listitem" value="6">Click on <span class="strong"><strong class="calibre7">Add</strong></span>.</li></ol><div class="calibre12"/></div></div>

<div class="book" title="Time for action &#x2013; adding the image files">
<div class="book" title="What just happened?"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec31" class="calibre1"/>
<span class="strong"><em class="calibre8">What just happened?</em></span>
</h2></div></div></div><p class="calibre6">You added the necessary image files for your Air Hockey game. These come in two versions: one for retina displays (high definition) and one for non-retina displays (standard definition). It is very important that references are added to the actual folders, only this way Xcode will be able to have two files with the same name inside the project and still keep them apart; one in each folder. We also added the font we'll be using in the game.</p><p class="calibre6">Now let's tell Cocos2d-x where to look for the correct files.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Time for action &#x2013; adding retina support"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec33" class="calibre1"/>Time for action – adding retina support</h1></div></div></div><p class="calibre6">This <a id="id93" class="calibre1"/>time we'll work with the class <code class="email">AppDelegate.cpp</code>:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Go to <code class="email">AppDelegate.cpp</code> (you'll find it in the <code class="email">Classes</code> folder). Inside the <code class="email">applicationDidFinishLaunching</code> method, and below the <code class="email">director-&gt;setAnimationInterval(1.0 / 60)</code> line, add the following lines:<div class="informalexample"><pre class="programlisting">auto screenSize = glview-&gt;getFrameSize();
auto designSize = Size(768, 1024);
glview-&gt;setDesignResolutionSize(designSize.width, designSize.height, ResolutionPolicy::EXACT_FIT);

std::vector&lt;std::string&gt; searchPaths;
if (screenSize.width &gt; 768) {
    searchPaths.push_back("hd");
    director-&gt;setContentScaleFactor(2);
} else  {
    searchPaths.push_back("sd");
    director-&gt;setContentScaleFactor(1);
}
auto fileUtils = FileUtils::getInstance();
fileUtils-&gt;setSearchPaths(searchPaths);</pre></div></li><li class="listitem" value="2">Save the file.</li></ol><div class="calibre12"/></div></div>

<div class="book" title="Time for action &#x2013; adding retina support">
<div class="book" title="What just happened?"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec32" class="calibre1"/>
<span class="strong"><em class="calibre8">What just happened?</em></span>
</h2></div></div></div><p class="calibre6">An entire book could be written about this topic, although in this first example, we have a very simple implementation on how to support multiple screen sizes since we are only targeting iPads. Here we are saying: "Hey <code class="email">AppDelegate</code>, I designed this game for a 768 x 1024 screen."</p><p class="calibre6">All the <a id="id94" class="calibre1"/>values for positioning and font size were chosen for that screen size. If the screen is larger, make sure you grab the files from the <code class="email">hd</code> folder and change the scale by which you will multiply all my positioning and font sizes. If the screen has the same size I designed the game for, use the files in the <code class="email">sd</code> folder and set the scale to 1. (Android adds even more complexity to this, but we'll tackle that in later in the book.)</p><p class="calibre6">
<code class="email">FileUtils</code> will look for every file you load for your game first inside <code class="email">Resources</code> | <code class="email">sd</code> (or <code class="email">hd</code>). If it doesn't find them there, it will try to find them in <code class="email">Resources</code>. This is a good thing because files shared by both versions may be added only once to the project, inside <code class="email">Resources</code>. That is what we'll do now with the sound files.</p></div></div>
<div class="book" title="Adding sound effects"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec34" class="calibre1"/>Adding sound effects</h1></div></div></div><p class="calibre6">This<a id="id95" class="calibre1"/> game has two files for sound effects. You will find them in the same <code class="email">.zip</code> file you downloaded previously.</p></div>

<div id="page" style="height:0pt"/><div class="book" title="Time for action &#x2013; adding the sound files"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec35" class="calibre1"/>Time for action – adding the sound files</h1></div></div></div><p class="calibre6">Assuming<a id="id96" class="calibre1"/> you have the sound files from the downloaded resources, let's add them to the project.</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Drag both the <code class="email">.wav</code> files to the <code class="email">Resources</code> folder inside your <code class="email">Project</code> folder.</li><li class="listitem" value="2">Then go to Xcode, select the <code class="email">Resources</code> folder in the file navigation panel and select <span class="strong"><strong class="calibre7">File</strong></span> | <span class="strong"><strong class="calibre7">Add Files to AirHockey</strong></span>.</li><li class="listitem" value="3">Make sure the <span class="strong"><strong class="calibre7">AirHockey</strong></span> target is selected.</li><li class="listitem" value="4">Go to <code class="email">AppDelegate.cpp</code> again. At the top, add this <code class="email">include</code> statement:<div class="informalexample"><pre class="programlisting">#include "SimpleAudioEngine.h"</pre></div></li><li class="listitem" value="5">Then below the <code class="email">USING_NS_CC</code> macro (for <code class="email">using namespace cocos2d</code>), add:<div class="informalexample"><pre class="programlisting">using namespace CocosDenshion;</pre></div></li><li class="listitem" value="6">Then just below the lines you added in the previous section, inside <code class="email">applicationDidFinishLaunching</code>, add the following lines:<div class="informalexample"><pre class="programlisting">auto audioEngine = SimpleAudioEngine::getInstance();
audioEngine-&gt;preloadEffect( fileUtils-&gt;fullPathForFilename("hit.wav").c_str() );
audioEngine-&gt;preloadEffect( fileUtils-&gt;fullPathForFilename("score.wav").c_str() );
audioEngine-&gt;setBackgroundMusicVolume(0.5f);
audioEngine-&gt;setEffectsVolume(0.5f);</pre></div></li></ol><div class="calibre12"/></div></div>

<div class="book" title="Time for action &#x2013; adding the sound files">
<div class="book" title="What just happened?"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec33" class="calibre1"/>
<span class="strong"><em class="calibre8">What just happened?</em></span>
</h2></div></div></div><p class="calibre6">With the <code class="email">preloadEffect</code> method from <code class="email">CocosDenshion</code>, you manage to preload the files as well<a id="id97" class="calibre1"/> as instantiate and initialize <code class="email">SimpleAudioEngine</code>. This step will always take a toll on your application's processing power, so it's best to do it early on.</p><p class="calibre6">By now, the folder structure for your game should look like this:</p><div class="mediaobject"><img src="../images/00008.jpeg" alt="What just happened?" class="calibre9"/></div><p class="calibre10"> </p></div></div>
<div class="book" title="Extending Sprite"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec36" class="calibre1"/>Extending Sprite</h1></div></div></div><p class="calibre6">No, there is <a id="id98" class="calibre1"/>nothing wrong with <code class="email">Sprite</code>. I just picked a game where we need a bit more information from some of its sprites. In this case, we want to store where a sprite is and where it will be once the current iteration of the game is completed. We will also need a helper method to get the sprite's radius.</p><p class="calibre6">So let's create our <code class="email">GameSprite</code> class.</p></div>

<div id="page" style="height:0pt"/><div class="book" title="Time for action &#x2013; adding GameSprite.cpp"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec37" class="calibre1"/>Time for action – adding GameSprite.cpp</h1></div></div></div><p class="calibre6">From<a id="id99" class="calibre1"/> here on, we'll create any new classes inside Xcode, but you could do it just as easily in Eclipse if you remember to update the <code class="email">Make</code> file. I'll show you how to do that later in this chapter.</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">In Xcode, select the <code class="email">Classes</code> folder and then go to <span class="strong"><strong class="calibre7">File</strong></span> | <span class="strong"><strong class="calibre7">New</strong></span> | <span class="strong"><strong class="calibre7">File</strong></span> and navigate to <span class="strong"><strong class="calibre7">iOS</strong></span> | <span class="strong"><strong class="calibre7">Source</strong></span> select<span class="strong"><strong class="calibre7"> C++ File</strong></span>.</li><li class="listitem" value="2">Call it <code class="email">GameSprite</code> and make sure the <span class="strong"><strong class="calibre7">Also create a header file</strong></span> option is selected.</li><li class="listitem" value="3">Select the new <code class="email">GameSprite.h</code> interface file and replace the code there with this:<div class="informalexample"><pre class="programlisting">#ifndef __GAMESPRITE_H__
#define __GAMESPRITE_H__
#include "cocos2d.h"
using namespace cocos2d;
class GameSprite : public Sprite {
public:
   CC_SYNTHESIZE(Vec2, _nextPosition, NextPosition);
   CC_SYNTHESIZE(Vec2, _vector, Vector);
   CC_SYNTHESIZE(Touch*, _touch, Touch);
   GameSprite();
   virtual ~GameSprite();
   static GameSprite* gameSpriteWithFile(const char*  pszFileName);
   virtual void setPosition(const Vec2&amp; pos) override;
   float radius();
};
#endif // __GAMESPRITE_H__</pre></div></li></ol><div class="calibre12"/></div></div>

<div class="book" title="Time for action &#x2013; adding GameSprite.cpp">
<div class="book" title="What just happened?"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec34" class="calibre1"/>
<span class="strong"><em class="calibre8">What just happened?</em></span>
</h2></div></div></div><p class="calibre6">In the interface, we declare the class to be a subclass of the public <code class="email">Sprite</code> class.</p><p class="calibre6">Then we add three synthesized properties. In Cocos2d-x, these are macros to create getters and setters. You declare the type, the protected variable name, and the words that will be <a id="id100" class="calibre1"/>appended to the <code class="email">get</code> and <code class="email">set</code> methods. So in the first <code class="email">CC_SYNTHESIZE</code> method, the <code class="email">getNextPosition</code> and <code class="email">setNextPosition</code> method will be created to deal with the <code class="email">Point</code> value inside the <code class="email">_nextPosition</code> protected variable.</p><p class="calibre6">We also add the constructor and destructor for our class, and the ubiquitous static method for instantiation. This receives as a parameter, the image filename used by the sprite. We finish off by overriding <code class="email">setPosition</code> from <code class="email">Sprite</code> and adding the declaration for our helper method radius.</p><p class="calibre6">The next step then is to implement our new class.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Time for action &#x2013; implementing GameSprite"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec38" class="calibre1"/>Time for action – implementing GameSprite</h1></div></div></div><p class="calibre6">With <a id="id101" class="calibre1"/>the header out of the way, all we need to do is implement our methods.</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Select the <code class="email">GameSprite.cpp</code> file and let's start on the instantiation logic of the class:<div class="informalexample"><pre class="programlisting">#include "GameSprite.h"

GameSprite::GameSprite(void){
    _vector = Vec2(0,0);
}

GameSprite::~GameSprite(void){
}

GameSprite* GameSprite::gameSpriteWithFile(const char * pszFileName) {
   auto sprite = new GameSprite();
   if (sprite &amp;&amp; sprite-&gt;initWithFile(pszFileName)) {
          sprite-&gt;autorelease();
          return sprite;
   }
   CC_SAFE_DELETE(sprite);
   return sprite = nullptr;
}</pre></div></li><li class="listitem" value="2">Next we need to override the <code class="email">Node</code> method <code class="email">setPosition</code>. We need to make sure that whenever we change the position of the sprite, the new value is also used by <code class="email">_nextPosition</code>:<div class="informalexample"><pre class="programlisting">void GameSprite::setPosition(const Point&amp; pos) {
    Sprite::setPosition(pos);
    if (!_nextPosition.equals(pos)) {
        _nextPosition = pos;
    }
}</pre></div></li><li class="listitem" value="3">And finally, we implement our new method to retrieve the radius of our sprite, which we determine to be half its texture's width:<div class="informalexample"><pre class="programlisting">float GameSprite::radius() {
    return getTexture()-&gt;getContentSize().width * 0.5f;
}</pre></div></li></ol><div class="calibre12"/></div></div>

<div class="book" title="Time for action &#x2013; implementing GameSprite">
<div class="book" title="What just happened?"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec35" class="calibre1"/>
<span class="strong"><em class="calibre8">What just happened?</em></span>
</h2></div></div></div><p class="calibre6">Things <a id="id102" class="calibre1"/>only begin happening in the static method. We create a new <code class="email">GameSprite</code> class, then we call <code class="email">initWithFile</code> on it. This is a <code class="email">GameSprite</code> method inherited from its super class; it returns a Boolean value for whether that operation succeeded. The static method ends by returning an <code class="email">autorelease</code> version of the <code class="email">GameSprite</code> object.</p><p class="calibre6">The <code class="email">setPosition</code> override makes sure <code class="email">_nextPosition</code> receives the position information whenever the sprite is placed somewhere. And the helper <code class="email">radius</code> method returns half of the sprite's texture width.</p></div></div>

<div class="book" title="Time for action &#x2013; implementing GameSprite">
<div class="book" title="Have a go hero"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec36" class="calibre1"/>Have a go hero</h2></div></div></div><p class="calibre6">Change the radius method to an inline method in the interface and remove it from the implementation file.</p></div></div>
<div class="book" title="The actual game scene"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec39" class="calibre1"/>The actual game scene</h1></div></div></div><p class="calibre6">Finally, we'll<a id="id103" class="calibre1"/> get to see all our work and have some fun with it. But first, let's delete the <code class="email">HelloWorldScene</code> class (both header and implementation files). You'll get a few errors in the project so let's fix these.</p><p class="calibre6">References to the class must be changed at two lines in <code class="email">AppDelegate.cpp</code>. Go ahead and change the references to a <code class="email">GameLayer</code> class.</p><p class="calibre6">We'll create that class next.</p></div>

<div id="page" style="height:0pt"/><div class="book" title="Time for action &#x2013; coding the GameLayer interface"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec40" class="calibre1"/>Time for action – coding the GameLayer interface</h1></div></div></div><p class="calibre6">
<code class="email">GameLayer</code> is<a id="id104" class="calibre1"/> the main container in our game.</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Follow the steps to add a new file to your <code class="email">Classes</code> folder. This is a C++ file called <code class="email">GameLayer</code>.</li><li class="listitem" value="2">Select your <code class="email">GameLayer.h</code>. Just below the first <code class="email">define</code> preprocessor command, add:<div class="informalexample"><pre class="programlisting">#define GOAL_WIDTH 400</pre></div></li><li class="listitem" value="3">We define the width of the goals in pixels.</li><li class="listitem" value="4">Next, add the declarations for our sprites and our score text labels:<div class="informalexample"><pre class="programlisting">#include "cocos2d.h"
#include "GameSprite.h"

using namespace cocos2d;

class GameLayer : public Layer
{
    GameSprite* _player1;
    GameSprite* _player2;
    GameSprite* _ball;
    
    Vector&lt;GameSprite*&gt; _players;
    Label* _player1ScoreLabel;
    Label* _player2ScoreLabel;</pre></div><p class="calibre13">We <a id="id105" class="calibre1"/>have the <code class="email">GameSprite</code> objects for two players (the weird looking things called mallets), and the ball (called a puck). We'll store the two players in a Cocos2d-x <code class="email">Vector</code>. We also have two text labels to display the score for each player.</p></li><li class="listitem" value="5">Declare a variable to store the screen size. We'll use this a lot for positioning:<div class="informalexample"><pre class="programlisting">Size _screenSize;</pre></div></li><li class="listitem" value="6">Add variables to store the score information and a method to update these scores on screen:<div class="informalexample"><pre class="programlisting">int _player1Score;
int _player2Score;
    
void playerScore (int player);</pre></div></li><li class="listitem" value="7">Finally, let's add our methods:<div class="informalexample"><pre class="programlisting">public:
    
   GameLayer();
   virtual ~GameLayer();
   virtual bool init();

    static Scene* scene();
    
    CREATE_FUNC(GameLayer);
    
    void onTouchesBegan(const std::vector&lt;Touch*&gt; &amp;touches,  Event* event);
   void onTouchesMoved(const std::vector&lt;Touch*&gt; &amp;touches,  Event* event);
   void onTouchesEnded(const std::vector&lt;Touch*&gt; &amp;touches,  Event* event);

  void update (float dt);
};
#endif // __GAMELAYER_H__</pre></div></li></ol><div class="calibre12"/></div><p class="calibre6">There<a id="id106" class="calibre1"/> are constructor and destructor methods, then the <code class="email">Layer init</code> methods, and finally the event handlers for the touch events and our loop method called <code class="email">update</code>. These touch event handlers will be added to our class to handle when users' touches begin, when they move across the screen, and when they end.</p></div>

<div class="book" title="Time for action &#x2013; coding the GameLayer interface">
<div class="book" title="What just happened?"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec37" class="calibre1"/>
<span class="strong"><em class="calibre8">What just happened?</em></span>
</h2></div></div></div><p class="calibre6">
<code class="email">GameLayer</code> is our game. It contains references to all the sprites we need to control and update, as well as all game data.</p><p class="calibre6">In the class implementation, all the logic starts inside the <code class="email">init</code> method.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Time for action &#x2013; implementing init()"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec41" class="calibre1"/>Time for action – implementing init()</h1></div></div></div><p class="calibre6">Inside <code class="email">init()</code>, we'll build the game screen, bringing in all the sprites and labels we'll need<a id="id107" class="calibre1"/> for the game:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">So right after the <code class="email">if</code> statement where we call the super <code class="email">Layer::init</code> method, we add:<div class="informalexample"><pre class="programlisting">_players = Vector&lt;GameSprite*&gt;(2);
_player1Score = 0;
_player2Score = 0;
_screenSize = Director::getInstance()-&gt;getWinSize();</pre></div></li><li class="listitem" value="2">We create the vector where we'll store both players, initialize the score values, and grab the screen size from the singleton, all-knowing <code class="email">Director</code>. We'll use the screen size to position all sprites relatively. Next we will create our first sprite. It is created with an image filename, which <code class="email">FileUtils</code> will take care of loading from the correct folder:<div class="informalexample"><pre class="programlisting">auto court = Sprite::create("court.png");
court-&gt;setPosition(Vec2(_screenSize.width * 0.5, _screenSize.height * 0.5));
this-&gt;addChild(court);</pre></div></li><li class="listitem" value="3">Get into the habit of positioning sprites with relative values, and not absolute ones, so we can support more screen sizes. And say hello to the <code class="email">Vec2</code> type definition used to create points; you'll be seeing it a lot in Cocos2d-x.</li><li class="listitem" value="4">We finish by adding the sprite as a child to our <code class="email">GameLayer</code> (the court sprite does not need to be a <code class="email">GameSprite</code>).</li><li class="listitem" value="5">Next we will use our spanking new <code class="email">GameSprite</code> class, carefully positioning the objects on screen:<div class="informalexample"><pre class="programlisting">_player1 =  GameSprite::gameSpriteWithFile("mallet.png");
_player1-&gt;setPosition(Vec2(_screenSize.width * 0.5,  _player1-&gt;radius() * 2));
_players.pushBack(_player1);
this-&gt;addChild(_player1);
    
_player2 =  GameSprite::gameSpriteWithFile("mallet.png");
_player2-&gt;setPosition(Vec2(_screenSize.width * 0.5, _screenSize.height - _player1-&gt;radius() * 2));
_players.pushBack(_player2);
this-&gt;addChild(_player2);
_ball = GameSprite::gameSpriteWithFile("puck.png");
_ball-&gt;setPosition(Vec2(_screenSize.width * 0.5, _screenSize.height * 0.5 - 2 * _ball-&gt;radius()));
this-&gt;addChild(_ball);</pre></div></li><li class="listitem" value="6">We will <a id="id108" class="calibre1"/>create TTF labels with the <code class="email">Label</code> class <code class="email">createWithTTF</code> static method, passing as parameters the initial string value (<code class="email">0</code>), and the path to the font file. We will then position and rotate the labels:<div class="informalexample"><pre class="programlisting">_player1ScoreLabel = Label::createWithTTF("0",  "fonts/Arial.ttf", 60);
_player1ScoreLabel-&gt;setPosition(Vec2(_screenSize.width - 60,  _screenSize.height * 0.5 - 80));
_player1ScoreLabel-&gt;setRotation(90);
this-&gt;addChild(_player1ScoreLabel);
_player2ScoreLabel = Label::createWithTTF("0",  "fonts/Arial.ttf", 60);
_player2ScoreLabel-&gt;setPosition(Vec2(_screenSize.width - 60,  _screenSize.height * 0.5 + 80));
_player2ScoreLabel-&gt;setRotation(90);
this-&gt;addChild(_player2ScoreLabel);</pre></div></li><li class="listitem" value="7">Then we turn <code class="email">GameLayer</code> into a multitouch event listener and tell the <code class="email">Director</code> event dispatcher that <code class="email">GameLayer</code> wishes to listen to those events. And we finish by scheduling the game's main loop as follows:<div class="informalexample"><pre class="programlisting">auto listener = EventListenerTouchAllAtOnce::create();
listener-&gt;onTouchesBegan =  CC_CALLBACK_2(GameLayer::onTouchesBegan, this);
listener-&gt;onTouchesMoved =  CC_CALLBACK_2(GameLayer::onTouchesMoved, this);
listener-&gt;onTouchesEnded =  CC_CALLBACK_2(GameLayer::onTouchesEnded, this);
_eventDispatcher-&gt;addEventListenerWithSceneGraphPriority(listener, this);
//create main loop
this-&gt;scheduleUpdate();
return true;</pre></div></li></ol><div class="calibre12"/></div></div>

<div class="book" title="Time for action &#x2013; implementing init()">
<div class="book" title="What just happened?"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec38" class="calibre1"/>
<span class="strong"><em class="calibre8">What just happened?</em></span>
</h2></div></div></div><p class="calibre6">You <a id="id109" class="calibre1"/>created the game screen for Air Hockey, with your own sprites and labels. The game screen, once all elements are added, should look like this:</p><div class="mediaobject"><img src="../images/00009.jpeg" alt="What just happened?" class="calibre9"/></div><p class="calibre10"> </p><p class="calibre6">And now we're ready to handle the player's screen touches.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Time for action &#x2013; handling multitouches"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec42" class="calibre1"/>Time for action – handling multitouches</h1></div></div></div><p class="calibre6">There are<a id="id110" class="calibre1"/> three methods we need to implement in this game to handle touches. Each method receives, as one of its parameters, a vector of <code class="email">Touch</code> objects:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">So add our <code class="email">onTouchesBegan</code> method:<div class="informalexample"><pre class="programlisting">void GameLayer::onTouchesBegan(const std::vector&lt;Touch*&gt; &amp;touches, Event* event)
{
   for( auto touch : touches) {
     if(touch != nullptr) {
        auto tap = touch-&gt;getLocation();
        for (auto player : _players) {
         if (player-&gt;boundingBox().containsPoint(tap)) {
            player-&gt;setTouch(touch);
         }
       }
     }
   }
}</pre></div><p class="calibre13">Each <code class="email">GameSprite</code>, if you recall, has a <code class="email">_touch</code> property.</p><p class="calibre13">So we iterate through the touches, grab their location on screen, loop through the players in the vector, and determine if the touch lands on one of the players. If so, we store the touch inside the player's <code class="email">_touch</code> property (from the <code class="email">GameSprite</code> class).</p><p class="calibre13">A similar <a id="id111" class="calibre1"/>process is repeated for <code class="email">onTouchesMoved</code> and <code class="email">onTouchesEnded</code>, so you can copy and paste the code and just replace what goes on inside the <code class="email">_players</code> array for loop.</p></li><li class="listitem" value="2">In <code class="email">TouchesMoved</code>, when we loop through the players, we do this:<div class="informalexample"><pre class="programlisting">for (auto player : _players) {
  if (player-&gt;getTouch() != nullptr &amp;&amp; player-&gt;getTouch() ==  touch) {
    Point nextPosition = tap;
   if (nextPosition.x &lt; player-&gt;radius())
      nextPosition.x = player-&gt;radius();
   if (nextPosition.x &gt; _screenSize.width - player-&gt;radius())
      nextPosition.x = _screenSize.width - player-&gt;radius();
   if (nextPosition.y &lt; player-&gt;radius())
      nextPosition.y  = player-&gt;radius();
   if (nextPosition.y &gt; _screenSize.height - player-&gt;radius())
      nextPosition.y = _screenSize.height - player-&gt;radius();
                    
   //keep player inside its court
   if (player-&gt;getPositionY() &lt; _screenSize.height* 0.5f) {
      if (nextPosition.y &gt; _screenSize.height* 0.5 -  player-&gt;radius()) {
         nextPosition.y = _screenSize.height* 0.5 -  player-&gt;radius();
        }
   } else {
      if (nextPosition.y &lt; _screenSize.height* 0.5 +  player-&gt;radius()) {
         nextPosition.y = _screenSize.height* 0.5 +  player-&gt;radius();
      }
   }              
   player-&gt;setNextPosition(nextPosition);
   player-&gt;setVector(Vec2(tap.x - player-&gt;getPositionX(),  tap.y - player-&gt;getPositionY()));
 }   
}</pre></div><p class="calibre13">We check to see if the <code class="email">_touch</code> property stored inside the player is the being moved now. If so, we update the player's position with the touch's current position, but we check to see if the new position is valid: a player cannot move <a id="id112" class="calibre1"/>outside the screen and cannot enter its opponent's court. We also update the player's vector of movement; we'll need this when we collide the player with the puck. The vector is based on the player's displacement.</p></li><li class="listitem" value="3">In <code class="email">onTouchesEnded,</code> we add this:<div class="informalexample"><pre class="programlisting">for (auto player : _players) {
   if (player-&gt;getTouch() != nullptr &amp;&amp; player-&gt;getTouch() == touch) {
     //if touch ending belongs to this player, clear it
     player-&gt;setTouch(nullptr);
     player-&gt;setVector(Vec2(0,0));
   }
}</pre></div></li></ol><div class="calibre12"/></div><p class="calibre6">We clear the <code class="email">_touch</code> property stored inside the player if this touch is the one just ending. The player also stops moving, so its vector is set to <code class="email">0</code>. Notice that we don't need the location of the touch anymore; so in <code class="email">TouchesEnded</code> you can skip that bit of logic.</p></div>

<div class="book" title="Time for action &#x2013; handling multitouches">
<div class="book" title="What just happened?"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec39" class="calibre1"/>
<span class="strong"><em class="calibre8">What just happened?</em></span>
</h2></div></div></div><p class="calibre6">When you implement logic for multitouch this is pretty much what you will have to do: store the individual touches inside either an array or individual sprites, so you can keep tracking these touches.</p><p class="calibre6">Now, for the heart and soul of the game—the main loop.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Time for action &#x2013; adding our main loop"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec43" class="calibre1"/>Time for action – adding our main loop</h1></div></div></div><p class="calibre6">This is<a id="id113" class="calibre1"/> the heart of our game—the <code class="email">update</code> method:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">We will update the puck's velocity with a little friction applied to its vector (<code class="email">0.98f</code>). We will store what its next position will be at the end of the iteration, if no collision occurred:<div class="informalexample"><pre class="programlisting">void GameLayer::update (float dt) {
   
    auto ballNextPosition = _ball-&gt;getNextPosition();
    auto ballVector = _ball-&gt;getVector();
    ballVector *=  0.98f;
    
    ballNextPosition.x += ballVector.x;
    ballNextPosition.y += ballVector.y;</pre></div></li><li class="listitem" value="2">Next comes the collision. We will check collisions with each player sprite and the ball:<div class="informalexample"><pre class="programlisting">float squared_radii = pow(_player1-&gt;radius() +  _ball-&gt;radius(), 2);
for (auto player : _players) {
  auto playerNextPosition = player-&gt;getNextPosition();
  auto playerVector = player-&gt;getVector();  
  float diffx = ballNextPosition.x - player-&gt;getPositionX();
  float diffy = ballNextPosition.y - player-&gt;getPositionY();
  float distance1 = pow(diffx, 2) + pow(diffy, 2);
  float distance2 = pow(_ball-&gt;getPositionX() -  playerNextPosition.x, 2) + pow(_ball-&gt;getPositionY() -  playerNextPosition.y, 2);</pre></div><a id="id114" class="calibre1"/><p class="calibre13">Collisions are checked through the distance between ball and players. Two conditions will flag a collision, as illustrated in the following diagram:</p><div class="mediaobject"><img src="../images/00010.jpeg" alt="Time for action – adding our main loop" class="calibre9"/></div><p class="calibre14"> </p></li><li class="listitem" value="3">If the distance between ball and player equals the sum of the radii of both sprites, or is less than the sum of the radii of both sprites, we have a collision:<div class="informalexample"><pre class="programlisting">if (distance1 &lt;= squared_radii || 
    distance2 &lt;= squared_radii)  {</pre></div></li><li class="listitem" value="4">We use the squared radii values so we don't need to use costly square root calculations to get the values for distance. So all values in the previous conditional statement are squared, including the distances.</li><li class="listitem" value="5">These conditions are checked both with the player's current position and its next position, so there is less risk of the ball moving "through" the player sprite between iterations.</li><li class="listitem" value="6">If there is a collision, we grab the magnitudes of both the ball's vector and the player's vector, and make the force with which the ball will be pushed away. We <a id="id115" class="calibre1"/>update the ball's next position in that case, and play a nice sound effect through the <code class="email">SimpleAudioEngine</code> singleton (don't forget to include the <code class="email">SimpleAudioEngine.h</code> header file and declare we're using the <code class="email">CocosDenshion</code> namespace):<div class="informalexample"><pre class="programlisting">    float mag_ball = pow(ballVector.x, 2) + pow(ballVector.y, 2);
    float mag_player = pow(playerVector.x, 2) + pow (playerVector.y, 2);
    float force = sqrt(mag_ball + mag_player);
    float angle = atan2(diffy, diffx);

        ballVector.x = force * cos(angle);
        ballVector.y = (force * sin(angle));

        ballNextPosition.x = playerNextPosition.x + (player-&gt;radius() + _ball-&gt;radius() + force) * cos(angle);
        ballNextPosition.y = playerNextPosition.y + (player-&gt;radius() + _ball-&gt;radius() + force) * sin(angle);

       SimpleAudioEngine::getInstance()-&gt;playEffect("hit.wav");
    }
}</pre></div></li><li class="listitem" value="7">Next, we will check the collision between the ball and screen sides. If so, we will move the ball back to the court and play our sound effect here as well:<div class="informalexample"><pre class="programlisting">if (ballNextPosition.x &lt; _ball-&gt;radius()) {
    ballNextPosition.x = _ball-&gt;radius();
    ballVector.x *= -0.8f;
    SimpleAudioEngine::getInstance()-&gt;playEffect("hit.wav");
}

if (ballNextPosition.x &gt; _screenSize.width - _ball-&gt;radius()) {
    ballNextPosition.x = _screenSize.width - _ball-&gt;radius();
    ballVector.x *= -0.8f;
    SimpleAudioEngine::getInstance()-&gt;playEffect("hit.wav");
}</pre></div></li><li class="listitem" value="8">At the top and bottom sides of the court, we check to see whether the ball has not moved through one of the goals through our previously defined <code class="email">GOAL_WIDTH</code> property as follows:<div class="informalexample"><pre class="programlisting">if (ballNextPosition.y &gt; _screenSize.height - _ball-&gt;radius()) {
    if (_ball-&gt;getPosition().x &lt; _screenSize.width * 0.5f - GOAL_WIDTH * 0.5f || _ball-&gt;getPosition().x &gt; _screenSize.width * 0.5f + GOAL_WIDTH * 0.5f) {
        ballNextPosition.y = _screenSize.height - _ball-&gt;radius();
        ballVector.y *= -0.8f;
        SimpleAudioEngine::getInstance()-&gt;playEffect("hit.wav");
    }
}

if (ballNextPosition.y &lt; _ball-&gt;radius() ) {
    if (_ball-&gt;getPosition().x &lt; _screenSize.width * 0.5f - GOAL_WIDTH * 0.5f || _ball-&gt;getPosition().x &gt; _screenSize.width * 0.5f + GOAL_WIDTH * 0.5f) {
        ballNextPosition.y = _ball-&gt;radius();
        ballVector.y *= -0.8f;
        SimpleAudioEngine::getInstance()-&gt;playEffect("hit.wav");
    }
}</pre></div></li><li class="listitem" value="9">We <a id="id116" class="calibre1"/>finally update the ball information, and if the ball has passed through the goal posts (drum roll):<div class="informalexample"><pre class="programlisting">_ball-&gt;setVector(ballVector);
_ball-&gt;setNextPosition(ballNextPosition);

//check for goals!
if (ballNextPosition.y  &lt; -_ball-&gt;radius() * 2) {
   this-&gt;playerScore(2);
}

if (ballNextPosition.y &gt; _screenSize.height + _ball-&gt;radius() * 2) {
   this-&gt;playerScore(1);
}</pre></div></li><li class="listitem" value="10">We call our helper method to score a point and we finish the update with the placement of all the elements, now that we know where the <code class="email">nextPosition</code> value is for each one of the elements in the game:<div class="informalexample"><pre class="programlisting">_player1-&gt;setPosition(_player1-&gt;getNextPosition());
_player2-&gt;setPosition(_player2-&gt;getNextPosition());
_ball-&gt;setPosition(_ball-&gt;getNextPosition()); </pre></div></li></ol><div class="calibre12"/></div></div>

<div class="book" title="Time for action &#x2013; adding our main loop">
<div class="book" title="What just happened?"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec40" class="calibre1"/>
<span class="strong"><em class="calibre8">What just happened?</em></span>
</h2></div></div></div><p class="calibre6">We have just built the game's main loop. Whenever your gameplay depends on precise collision detection, you will undoubtedly apply a similar logic of position now, position next, collision checks, and adjustments to position next, if a collision has occurred. And we <a id="id117" class="calibre1"/>finish the game with our helper method.</p><p class="calibre6">All that's left to do now is update the scores.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Time for action &#x2013; updating scores"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec44" class="calibre1"/>Time for action – updating scores</h1></div></div></div><p class="calibre6">Time to type the last method in the game.</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">We <a id="id118" class="calibre1"/>start by playing a nice effect for a goal and stopping our ball:<div class="informalexample"><pre class="programlisting">void GameLayer::playerScore (int player) {
    
    SimpleAudioEngine::getInstance()-&gt;playEffect("score.wav");
    
    _ball-&gt;setVector(Vec2(0,0));</pre></div></li><li class="listitem" value="2">Then we update the score for the scoring player, updating the score label in the process. And the ball moves to the court of the player against whom a point was just scored:<div class="informalexample"><pre class="programlisting">char score_buffer[10];
if (player == 1) {
    _player1Score++;
    _player1ScoreLabel-&gt;setString(std::to_string(_player1Score));
    _ball-&gt;setNextPosition(Vec2(_screenSize.width * 0.5, _screenSize.height * 0.5 + 2 * _ball-&gt;radius()));

    } else {
    _player2Score++;
    _player2ScoreLabel-&gt;setString(std::to_string(_player2Score));
    _ball-&gt;setNextPosition(Vec2(_screenSize.width * 0.5, _screenSize.height * 0.5 - 2 * _ball-&gt;radius()));
    }</pre></div><p class="calibre13">The players are moved to their original position and their <code class="email">_touch</code> properties are cleared:</p><div class="informalexample"><pre class="programlisting">    _player1-&gt;setPosition(Vec2(_screenSize.width * 0.5, _player1-&gt;radius() * 2));
    _player2-&gt;setPosition(Vec2(_screenSize.width * 0.5, _screenSize.height - _player1-&gt;radius() * 2));
    _player1-&gt;setTouch(nullptr);
    _player2-&gt;setTouch(nullptr);
}</pre></div></li></ol><div class="calibre12"/></div></div>

<div class="book" title="Time for action &#x2013; updating scores">
<div class="book" title="What just happened?"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec41" class="calibre1"/>
<span class="strong"><em class="calibre8">What just happened?</em></span>
</h2></div></div></div><p class="calibre6">Well, guess what! You just finished your first game in Cocos2d-x. We charged forward at a brisk pace for our first game, but we managed to touch on almost every area of game development <a id="id119" class="calibre1"/>with Cocos2d-x in the process.</p><p class="calibre6">If you click <span class="strong"><strong class="calibre7">Run</strong></span> now, you should be able to play the game. In the source code for this chapter, you should also find the complete version of the game if you run into any problems.</p><p class="calibre6">Time to take this to Android!</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Time for action &#x2013; running the game in Android"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec45" class="calibre1"/>Time for action – running the game in Android</h1></div></div></div><p class="calibre6">Time to deploy the game to Android.</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Follow <a id="id120" class="calibre1"/>the instructions from the <code class="email">HelloWorld</code> example to import the game into Eclipse.</li><li class="listitem" value="2">Navigate to the <code class="email">proj.android</code> folder and open the <code class="email">AndroidManifest.xml</code> file in a text editor. Then, go to the <code class="email">jni</code> folder and open the <code class="email">Android.mk</code> file in a text editor.</li><li class="listitem" value="3">In the <code class="email">AndroidManifest.xml</code> file, edit the following line in the <code class="email">activity</code> tag:<div class="informalexample"><pre class="programlisting">android:screenOrientation="portrait"   </pre></div></li><li class="listitem" value="4">And it's possible to target only tablets by adding these lines in the <code class="email">supports-screens</code> tag:<div class="informalexample"><pre class="programlisting">&lt;supports-screens android:anyDensity="true"
          android:smallScreens="false"
          android:normalScreens="false"
          android:largeScreens="true"
          android:xlargeScreens="true"/&gt;</pre></div></li><li class="listitem" value="5">Although if you want to target only tablets, you might also wish to target the later versions of SDK, like this:<div class="informalexample"><pre class="programlisting">&lt;uses-sdk android:minSdkVersion="11"/&gt;</pre></div></li><li class="listitem" value="6">Next, let's edit the make file, so open the <code class="email">Android.mk</code> file and edit the lines in <code class="email">LOCAL_SRC_FILES</code> to read:<div class="informalexample"><pre class="programlisting">LOCAL_SRC_FILES := hellocpp/main.cpp \
                   ../../Classes/AppDelegate.cpp \
                   ../../Classes/GameSprite.cpp \
                   ../../Classes/GameLayer.cpp </pre></div></li><li class="listitem" value="7">Save it and run your application (don't forget to connect an Android device, in this case, a tablet if you used the settings as explained here).</li></ol><div class="calibre12"/></div></div>

<div class="book" title="Time for action &#x2013; running the game in Android">
<div class="book" title="What just happened?"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch03lvl2sec42" class="calibre1"/>
<span class="strong"><em class="calibre8">What just happened?</em></span>
</h2></div></div></div><p class="calibre6">And that's it! You can edit these files inside Eclipse as well.</p><p class="calibre6">When<a id="id121" class="calibre1"/> you build a Cocos2d-x project in the command line, you see a message saying that the <code class="email">hellocpp</code> target is being renamed. But I think this is still a bug in the build script and usually correcting that in the make file and the folder structure creates a much bigger headache. So for now, stick to the strangely named <code class="email">hellocpp</code> in <code class="email">Android.mk</code>.</p></div></div>

<div class="book" title="Time for action &#x2013; running the game in Android">
<div class="book" title="Have a go hero"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch03lvl2sec43" class="calibre1"/>Have a go hero</h2></div></div></div><p class="calibre6">Make any changes to the code. For instance, add an extra label and then publish again from Eclipse. You may find that working with the project in this IDE is faster than Xcode.</p><p class="calibre6">Sadly, sooner or later, Eclipse will throw one of its infamous tantrums. A common problem that occurs if you have many projects open in your navigator is for one or many of the projects to report an error like <span class="strong"><strong class="calibre7">Cannot find the class file for java.lang.Object</strong></span> or <span class="strong"><strong class="calibre7">The type java.lang.Object cannot be resolved</strong></span>. Get into the habit of cleaning your project and building it as soon as you open Eclipse and keeping only active projects opened, but even that might fail you. The solution? Restart Eclipse, or better yet, delete the project from the navigator (but not from the disk!) and reimport it. Yeah, I know. Welcome to Eclipse!</p></div></div>
<div class="book" title="Summary"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch03lvl1sec46" class="calibre1"/>Summary</h1></div></div></div><p class="calibre6">You now know how to add sprites and labels, and how to add support for two screen resolutions as well as support for multitouch. There are quite a few ways to create sprites other than by passing it an image filename, and I'll show examples of these in the games to come.</p><p class="calibre6">
<code class="email">LabelTTF</code> won't be used as much in this book. Generally, they are good for large chunks of text and text that is not updated too frequently; we'll use bitmap fonts from now on.</p><p class="calibre6">So, let's move on to the next game and animations. I promise I won't make you type as much. You should get your friend to do it for you!</p></div></body></html>