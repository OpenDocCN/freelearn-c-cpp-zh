# 前言

C++ 是最受欢迎和广泛使用的编程语言之一，这种状态已经持续了三十年。C++ 的设计重点在于性能、效率和灵活性，它结合了面向对象、命令式、泛型和函数式编程等范式。C++ 由国际标准化组织（**ISO**）标准化，并在过去十五年里经历了巨大的变化。随着 C++11 标准的发布，这门语言进入了一个新的时代，通常被称为现代 C++。类型推断、移动语义、lambda 表达式、智能指针、统一初始化、变长模板和许多其他最近引入的特性，已经改变了我们在 C++ 中编写代码的方式，以至于它几乎看起来像一门全新的编程语言。这种变化随着 C++20 的发布得到了进一步的推进，C++20 包含了许多对语言的改进，如模块、概念和协程，以及标准库的改进，如范围、文本格式化和日历。现在，随着 C++23 和即将到来的 C++26 中引入的更多变化，这门语言正在进一步发展。

本书涵盖了 C++11、C++14、C++17、C++20 和 C++23 中包含的许多新特性。本书以食谱的形式组织，每个食谱都涵盖一个特定的语言或库特性，或者是一个开发者经常遇到的问题及其使用现代 C++ 的典型解决方案。通过超过 150 个食谱，你将学会掌握核心语言特性和标准库，包括字符串、容器、算法、迭代器、流、正则表达式、线程、文件系统、原子操作、实用工具和范围。

这本书的第三版花费了几个月的时间来编写，在这段时间里，C++23 标准的工作已经完成。然而，在撰写这篇前言的时候，该标准尚未获得批准，并将在今年（2024 年）发布。

第二版和第三版中新增或更新的超过 30 个食谱涵盖了 C++20 的特性，包括模块、概念、协程、范围、线程和同步机制、文本格式化、日历和时区、即时函数、三向比较运算符以及新的 `std::span` 类。本第三版中新增或更新的近 20 个食谱涵盖了 C++23 的特性，包括 `std::expected` 类、`std::mdspan` 类、`stacktrace` 库、`span` 缓冲区、多维索引运算符以及文本格式库的扩展。

书中的所有食谱都包含代码示例，展示了如何使用某个功能或如何解决问题。这些代码示例是用 Visual Studio 2022 编写的，但也已使用 Clang 和 GCC 编译。由于各种语言和库功能已逐渐添加到所有这些编译器中，建议您使用每个编译器的最新版本，以确保所有新功能都得到支持。

在撰写这篇前言时，最新的版本是 GCC 14.0、Clang 18.0 和 VC++ 2022 版本 14.37（来自 Visual Studio 2019 版本 17.7）。尽管所有这些编译器都是 C++17 完整的，但它们对 C++23 的支持各不相同。请参阅[`en.cppreference.com/w/cpp/compiler_support`](https://en.cppreference.com/w/cpp/compiler_support)以检查您的编译器对 C++23 特性的支持。

# 本书面向对象

本书旨在面向所有 C++开发者，无论其经验水平如何。典型的读者是希望掌握语言并成为多产的现代 C++开发者的入门级或中级 C++开发者。经验丰富的 C++开发者将发现这是一本很好的参考资料，其中包含许多 C++11、C++14、C++17、C++20 和 C++23 语言和库特性，这些特性可能在某些时候很有用。本书包含超过 150 个食谱，涵盖了从简单到中级甚至高级的内容。然而，它们都需要先前的 C++知识，包括函数、类、模板、命名空间、宏等。因此，如果你不熟悉这门语言，建议你首先阅读一本入门书籍，以便熟悉核心方面，然后继续阅读本书。

# 本书涵盖内容

*第一章*，*学习现代核心语言特性*，介绍了现代核心语言特性，包括类型推断、统一初始化、作用域枚举、基于范围的 for 循环、结构化绑定、类模板参数推导等。

*第二章*，*处理数字和字符串*，讨论了如何在数字和字符串之间进行转换、生成伪随机数、处理正则表达式以及各种类型的字符串，以及如何使用 C++20 文本格式化库来格式化文本。

*第三章*，*探索函数*，深入探讨了默认和删除函数、可变模板、lambda 表达式和高级函数。

*第四章*，*预处理和编译*，从如何执行条件编译、编译时断言、代码生成以及使用属性提示编译器等方面，探讨了编译的各个方面。

*第五章*，*标准库容器、算法和迭代器*，介绍了几个标准容器、许多算法，并教你如何编写自己的随机访问迭代器。

*第六章，通用工具*：深入探讨了 `chrono` 库，包括 C++20 的日历和时间区域支持；`any`、`optional`、`variant` 以及 `span` 和 `mdspan` 类型；以及类型特性。

*第七章，处理文件和流*：解释了如何读取和写入流中的数据，使用 I/O 操作符控制流，并探讨了 `filesystem` 库。

*第八章，利用线程和并发*：教你如何使用线程、互斥锁、锁、条件变量、承诺、未来、原子类型，以及 C++20 的闩锁、栅栏和信号量。

*第九章，健壮性和性能*：专注于异常、常量正确性、类型转换、智能指针和移动语义。

*第十章，实现模式和惯用语*：涵盖了各种有用的模式和惯用语，例如 pimpl 惯用语、非虚拟接口惯用语、奇特重复的模板模式以及混入。

*第十一章，探索测试框架*：使用三个最广泛使用的测试框架，Boost.Test、Google Test 和 Catch2，为你提供入门。

*第十二章，C++20 核心特性*：介绍了 C++20 标准中最重要的新增功能——模块、概念、协程和范围，包括 C++23 的更新。

# 本版新增内容

本节提供了一列新的或更新的食谱，以及变化的简要描述。

*第一章，学习现代核心语言特性*：

+   *使用范围枚举*：更新了 C++23 的 `std::to_underlying` 和 `std::is_scoped_enum`

+   *使用基于范围的 for 循环迭代范围*：更新了 C++23 的 `init` 语句

+   *使用下标操作符访问集合中的元素*： (新) C++23 的多维下标操作符

*第二章，处理数字和字符串*：

+   *理解各种数值类型*： (新) 解释了 C++ 数值类型

+   *理解各种字符和字符串类型*： (新) 解释了 C++ 字符类型

+   *将 Unicode 字符打印到输出控制台*： (新) 讨论了与 UNICODE 一起工作并将内容打印到控制台

+   *创建字符串辅助库*：更新了 C++20 的 `starts_with()`、`ends_with()` 和 `contains()`

+   *使用 std::format 和 std::print 格式化和打印文本*：更新了 C++23 的 `std::print()` 和 `std::println()`

+   *使用 std::format 与用户定义类型*：更新了 C++23 的 `std::formattable` 和更好的示例

*第三章，探索函数*：

+   *与标准算法一起使用 lambda 表达式*：更新了 C++23 的函数调用操作符属性

+   *编写递归 lambda 表达式*：更新了 C++14 的递归泛型 lambda 表达式

+   *编写函数模板*： (新) 编写函数模板的教程

*第四章，预处理器和编译*：

+   *条件编译源代码*：更新了 C++23 的 `#warning`、`#elifdef` 和 `#elifndef`

+   *使用 static_assert 进行编译时断言检查*：更新了 C++26 的用户生成消息

+   *使用属性向编译器提供元数据*： 更新了 C++23 的 lambda、`[[assume]]`和重复属性上的属性

*第五章*，*标准库容器、算法和迭代器*：

+   *使用 vector 作为默认容器*： 更新了 C++23 的范围感知成员函数

+   *选择合适的标准容器* (新) 标准容器的比较

*第六章*，*通用工具*：

+   *使用日历*： 更新了与 C++20 兼容的示例

+   *在时区之间转换时间*： 更新了与 C++20 兼容的示例

+   *链式计算，可能或可能不产生值*： (新) 讨论了 C++23 的`std::optional`单子操作

+   *使用 std::expected 返回值或错误*： (新) 讨论了 C++23 的`std::expected`类型

+   *使用 std::mdspan 对对象序列的多维视图*： (新) 探索了 C++23 的`std::mdspan`类型

+   *使用 source_location 提供日志细节*： (新) 探索了 C++20 的`std::source_location`类型

+   *使用堆栈跟踪库打印调用堆栈*： (新) 介绍了 C++23 的堆栈跟踪库

*第七章*，*处理文件和流*：

+   *在固定大小的外部缓冲区上使用流*： (新) 探索了 C++23 的 span 缓冲区

*第八章*，*利用线程和并发*：

+   *使用线程同步机制*： 更新了与 C++20 兼容的示例

+   *同步输出流*： (新) 讨论了 C++20 的同步流

*第九章*，*健壮性和性能*：

+   *创建编译时常量表达式*： 更新了 C++23 的静态`constexpr`变量

+   *在常量评估上下文中优化代码*： (新) 解释了 C++23 的`consteval`

+   *在常量表达式中使用虚函数调用*： (新) 讨论了 C++20 的`constexpr`虚函数

*第十章*，*实现模式和惯用语*：

+   *使用混入向类添加功能*： (新) 解释了混入模式

+   *使用类型擦除泛型处理无关类型*： (新) 讨论了类型擦除惯用语

*第十一章*，*探索测试框架*：

+   *开始使用 Catch2*： 更新了 Catch2 版本 3.4.0 的安装说明

+   *使用 Catch2 进行断言*： 更新了 Catch2 版本 3.4.0 的示例

*第十二章*，*C++20 核心特性*：

+   *探索缩写函数模板*： (新) 检查了 C++20 的缩写函数模板

+   *探索标准范围适配器*： (新) 讨论了 C++20 和 C++23 的范围适配器

+   *将范围转换为容器*： (新) 解释了如何使用 C++23 的`std::ranges::to()`将范围转换为标准容器

+   *使用约束算法*： (新) 探索了直接与范围一起工作的通用算法

+   *创建异步计算的协程任务*： 更新了符合标准的示例（以及使用 libcoro 库的替代方案）

+   *为值序列创建协程生成器类型*： 更新了符合标准的示例（以及使用 libcoro 库的替代方案）

+   *使用 std::generator 类型递归生成值*：（新）解释了 C++23 的`std::generator`

# 为了充分利用本书

书中展示的代码可以从[`github.com/PacktPublishing/Modern-Cpp-Programming-Cookbook-Third-Edition`](https://github.com/PacktPublishing/Modern-Cpp-Programming-Cookbook-Third-Edition)下载，尽管我鼓励你尝试自己编写所有示例。为了编译它们，你需要在 Windows 上安装 VC++ 2022 17.7，在 Linux 和 Mac 上安装 GCC 14.0 或 Clang 18.0。如果你没有编译器的最新版本，或者想尝试另一个编译器，你可以使用在线可用的编译器。

虽然你可以使用各种在线平台，但我推荐 Wandbox，可在[`wandbox.org/`](https://wandbox.org/)找到，以及 Compiler Explorer，可在[`godbolt.org/`](https://godbolt.org/)找到。

## 下载示例代码文件

本书代码包托管在 GitHub 上，网址为[`github.com/PacktPublishing/Modern-Cpp-Programming-Cookbook-Third-Edition`](https://github.com/PacktPublishing/Modern-Cpp-Programming-Cookbook-Third-Edition)。我们还有其他来自我们丰富图书和视频目录的代码包，可在[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)找到。查看它们！

## 下载彩色图像

我们还提供了一份包含本书中使用的截图/图表彩色图像的 PDF 文件。您可以从这里下载：[`packt.link/gbp/9781835080542`](https://packt.link/gbp/9781835080542)。

## 使用的约定

本书使用了多种文本约定。

`CodeInText`: 表示文本中的代码单词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 昵称。例如：“几何模块定义在一个名为`geometry.ixx`/`.cppm`的文件中，尽管任何文件名都会得到相同的结果。”

代码块设置如下：

```cpp
static std::map<
  std::string,
  std::function<std::unique_ptr<Image>()>> mapping
{
  { "bmp", []() {return std::make_unique<BitmapImage>(); } },
  { "png", []() {return std::make_unique<PngImage>(); } },
  { "jpg", []() {return std::make_unique<JpgImage>(); } }
}; 
```

当我们希望将您的注意力引向代码块中的特定部分时，相关的行或项目会被突出显示：

```cpp
static std::map<
  std::string,
  **std::function<std::unique_ptr<Image>()>> mapping**
{
  { "bmp", []() {return std::make_unique<BitmapImage>(); } },
  { "png", []() {return std::make_unique<PngImage>(); } },
  { "jpg", []() {return std::make_unique<JpgImage>(); } }
}; 
```

任何命令行输入或输出都应如下编写：

```cpp
running thread 140296854550272
running thread 140296846157568
running thread 140296837764864 
```

**粗体**：表示新术语、重要单词或你在屏幕上看到的单词，例如在菜单或对话框中，也以这种方式出现在文本中。例如：“从**管理**面板中选择**系统信息**。”

警告或重要注意事项看起来像这样。

小贴士和技巧看起来像这样。

# 联系我们

我们欢迎读者的反馈。

**一般反馈**：请发送电子邮件至`feedback@packtpub.com`，并在邮件主题中提及本书的标题。如果你对本书的任何方面有疑问，请通过电子邮件联系我们`questions@packtpub.com`。

**勘误**：尽管我们已经尽一切努力确保内容的准确性，但错误仍然可能发生。如果您在此书中发现错误，我们将不胜感激，如果您能向我们报告，请访问[`www.packtpub.com/submit-errata`](http://www.packtpub.com/submit-errata)，选择您的书籍，点击勘误提交表单链接，并输入详细信息。

**盗版**：如果您在互联网上以任何形式遇到我们作品的非法副本，如果您能提供位置地址或网站名称，我们将不胜感激。请通过`copyright@packtpub.com`与我们联系，并提供材料的链接。

**如果您有兴趣成为作者**：如果您在某个领域有专业知识，并且您有兴趣撰写或为书籍做出贡献，请访问[`authors.packtpub.com`](http://authors.packtpub.com)。

# 分享您的想法

一旦您阅读了《现代 C++编程食谱，第三版》，我们非常乐意听取您的想法！请[点击此处直接进入此书的亚马逊评论页面](https://packt.link/r/1835080545)并分享您的反馈。

您的评论对我们和科技社区非常重要，并将帮助我们确保我们提供高质量的内容。

# 下载此书的免费 PDF 副本

感谢您购买此书！

您喜欢在路上阅读，但无法携带您的印刷书籍到处走？

您的电子书购买是否与您选择的设备不兼容？

不要担心，现在，随着每本 Packt 书籍，您都可以免费获得该书的 DRM 免费 PDF 版本。

在任何地方、任何设备上阅读。直接从您最喜欢的技术书籍中搜索、复制和粘贴代码到您的应用程序中。

优惠不会就此结束，您还可以获得独家折扣、时事通讯和每日免费内容的每日电子邮件。

按照以下简单步骤获取好处：

1.  扫描下面的二维码或访问以下链接

*![二维码描述自动生成](img/B21549_Free_PDF.png)*

[`packt.link/free-ebook/9781835080542`](https://packt.link/free-ebook/9781835080542)

1.  提交您的购买证明

1.  就这些！我们将直接将您的免费 PDF 和其他好处发送到您的电子邮件。
