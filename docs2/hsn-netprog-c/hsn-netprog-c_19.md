# 第十五章：答案

# 第一章，介绍网络和协议

1.  **IPv4 和 IPv6 之间有哪些关键区别？**

IPv4 仅支持 40 亿个唯一的地址，并且由于它们分配得不够高效，我们现在正在耗尽。IPv6 支持 3.4 x 10³⁸个可能的地址。IPv6 提供了许多其他改进，但这是直接影响我们网络编程的一个。

1.  **`ipconfig`和`ifconfig`命令给出的 IP 地址与远程 Web 服务器看到的 IP 地址相同吗？**

有时，这些地址会匹配，但并不总是如此。如果你在一个私有 IPv4 网络上，那么你的路由器很可能会执行网络地址转换。远程 Web 服务器然后看到转换后的地址。

如果你有一个公开路由的 IPv4 或 IPv6 地址，那么远程 Web 服务器看到的地址将与`ipconfig`和`ifconfig`报告的地址相匹配。

1.  **IPv4 回环地址是什么？**

IPv4 回环地址是`127.0.0.1`，它允许网络程序在相同机器上执行时相互通信。

1.  **IPv6 回环地址是什么？**

IPv6 回环地址是`::1`。它的工作方式与 IPv4 回环地址相同。

1.  **域名（例如，`example.com`）是如何解析成 IP 地址的？**

DNS 用于将域名解析为 IP 地址。该协议在第五章中详细说明，*主机名解析和 DNS*。

1.  **如何找到你的公网 IP 地址？**

最简单的方法是访问一个为你报告这个信息的网站。

1.  **操作系统如何知道哪个应用程序负责处理传入的数据包？**

每个 IP 数据包都有一个本地地址、远程地址、本地端口号、远程端口号和协议类型。这五个属性被操作系统记住，以确定哪个应用程序应该处理任何给定的传入数据包。

# 第二章，掌握套接字 API

1.  **什么是套接字？**

套接字是一个抽象，表示系统间通信链路的一个端点。

1.  **什么是无连接协议？什么是面向连接的协议？**

面向连接的协议在更大的数据流上下文中发送数据包。无连接协议独立于之前或之后的数据发送每个数据包。

1.  **UDP 是无连接的还是面向连接的协议？**

UDP 被认为是一个无连接协议。每个消息都是独立于之前或之后发送的。

1.  **TCP 是无连接的还是面向连接的协议？**

TCP 被认为是一个面向连接的协议。数据以流的形式按顺序发送和接收。

1.  **哪些类型的应用程序通常从使用 UDP 协议中受益？**

UDP 应用程序在牺牲可靠性的同时，从更好的实时性能中受益。它们还能够利用 IP 多播。

1.  **哪些类型的应用程序通常从使用 TCP 协议中受益？**

需要可靠数据流传输的应用程序可以从 TCP 协议中受益。

1.  **TCP 是否保证数据能够成功传输？**

TCP 对可靠性做出了一些保证，但没有任何东西可以真正保证数据能够成功传输。例如，如果有人拔掉了你的调制解调器，没有任何协议可以克服这一点。

1.  **伯克利套接字和 Winsock 套接字之间有哪些主要区别？**

头文件是不同的。套接字本身表示为有符号和无符号`int`。当`socket()`或`accept()`调用失败时，返回值是不同的。伯克利套接字也是标准文件描述。Winsock 并不总是这样。错误代码不同，并且以不同的方式检索。还有其他差异，但这些是我们程序受影响的主要差异。

1.  **`bind()`函数的作用是什么？**

`bind()`函数将套接字与特定的本地网络地址和端口号关联。它的使用几乎总是必需的，对于服务器而言，而对于客户端通常不是必需的。

1.  **`accept()`函数的作用是什么？**

`accept()`函数将阻塞，直到新的 TCP 客户端连接。然后它返回这个新连接的套接字。

1.  **在 TCP 连接中，是客户端还是服务器先发送应用程序数据？**

客户端或服务器都可以先发送数据。它们甚至可以同时发送数据。在实践中，许多客户端-服务器协议（如 HTTP）是通过客户端首先发送请求，然后服务器发送响应来工作的。

# 第三章，TCP 连接的深入概述

1.  **我们如何判断下一次调用`recv()`是否会阻塞？**

我们使用`select()`函数来指示哪些套接字可以无阻塞地读取。

1.  **如何确保`select()`不会阻塞超过指定的时间？**

你可以向`select()`传递一个超时参数。

1.  **当我们使用我们的`tcp_client`程序连接到 Web 服务器时，为什么需要在 Web 服务器响应之前发送一个空白行？**

HTTP，Web 服务器的协议，期望一个空白行来表示请求的结束。没有这个空白行，它就不知道客户端是否会继续发送额外的请求头。

1.  **`send()`函数是否会阻塞？**

是的。你可以使用`select()`来确定套接字何时准备好写入而不阻塞。或者，可以将套接字置于非阻塞模式。有关更多信息，请参阅第十三章，*套接字编程技巧和陷阱*。

1.  **我们如何判断套接字是否被我们的对等方断开连接？**

`recv()`的返回值可以指示套接字是否已断开连接。

1.  **通过`recv()`接收到的数据是否总是与通过`send()`发送的数据大小相同？**

不。TCP 是一种流协议。没有办法判断从一次`recv()`调用返回的数据是使用一次还是多次`send()`调用发送的。

1.  考虑以下代码：

```cpp
recv(socket_peer, buffer, 4096, 0);
printf(buffer);
```

它有什么问题？

也看看这段代码有什么问题：

```cpp
recv(socket_peer, buffer, 4096, 0);
printf("%s", buffer);
```

`recv()` 返回的数据不是以空字符终止的！前述代码片段中的任何一个都可能导致 `printf()` 读取 `recv()` 返回的数据的末尾。此外，在第一个代码示例中，接收到的数据可能包含格式说明符（例如 `%d`），这会导致额外的内存访问违规。

# 第四章，建立 UDP 连接

1.  **`sendto()` 和 `recvfrom()` 与 `send()` 和 `recv()` 有什么区别？**

在调用 `connect()` 之后，`send()` 和 `recv()` 函数是有用的。它们只与传递给 `connect()` 的一个远程地址一起工作。`sendto()` 和 `recvfrom()` 函数可以与多个远程地址一起使用。

1.  **`send()` 和 `recv()` 可以在 UDP 套接字上使用吗？**

是的。在这种情况下，应该首先调用 `connect()` 函数。然而，`sendto()` 和 `recvfrom()` 函数对于 UDP 套接字通常更有用。

1.  **在 UDP 套接字的情况下，`connect()` 会做什么？**

`connect()` 函数将套接字与远程地址关联。

1.  **与 TCP 相比，什么使得使用 UDP 的多路复用更容易？**

一个 UDP 套接字可以与多个远程对等方通信。对于 TCP，每个对等方需要一个套接字。

1.  **与 TCP 相比，UDP 的缺点是什么？**

UDP 不尝试修复 TCP 所做的许多错误。例如，TCP 确保数据按发送的顺序到达，TCP 尝试避免造成网络拥塞，并且 TCP 尝试重新发送丢失的数据包。UDP 什么都不做。

1.  **同一个程序可以使用 UDP 和 TCP 吗？**

是的。它只需要为两者创建套接字。

# 第五章，主机名解析和 DNS

1.  **哪个函数以可移植和协议无关的方式填充套接字编程所需的地址？**

`getaddrinfo()` 是用于此目的的函数。

1.  **哪个套接字编程函数可以将 IP 地址转换回名称？**

`getnameinfo()` 可以用于将地址转换回名称。

1.  **DNS 查询将名称转换为地址，反向 DNS 查询将地址转换回名称。如果你对一个名称运行 DNS 查询，然后对结果地址运行反向 DNS 查询，你是否总是得到你开始的名称？**

有时，你会得到相同的名称，但并不总是这样。这是因为正向和反向查找使用独立的记录。也可能有多个名称指向一个地址，但那个地址只能有一个指向单个名称的记录。

1.  **用于返回名称的 IPv4 和 IPv6 地址的 DNS 记录类型是什么？**

`A` 记录类型返回一个 IPv4 地址，而 `AAAA` 记录类型返回一个 IPv6 地址。

1.  **哪种 DNS 记录类型存储有关电子邮件服务器的特殊信息？**

`MX` 记录类型用于返回电子邮件服务器信息。

1.  **`getaddrinfo()` 是否总是立即返回？或者它可以阻塞？**

如果 `getaddrinfo()` 正在进行名称查找，它通常会阻塞。在最坏的情况下，需要向多个 DNS 服务器发送许多 UDP 消息，因此这可能会导致明显的延迟。这也是 DNS 缓存重要的原因之一。

如果你只是使用 `getaddrinfo()` 将文本 IP 地址转换为地址，那么它不应该阻塞。

1.  **当 DNS 响应太大而无法放入单个 UDP 数据包时会发生什么？**

DNS 响应的头部将设置 `TC` 位。这表示消息已被截断。应使用 TCP 重新发送查询。

# 第六章，构建简单的 Web 客户端

1.  **HTTP 使用 TCP 还是 UDP？**

HTTP 在 TCP 端口 `80` 上运行。

1.  **可以通过 HTTP 发送哪些类型的资源？**

HTTP 可以用来传输几乎任何计算机文件。它通常用于网页（HTML）及其相关文件（例如样式、脚本、字体和图像）。

1.  **常见的 HTTP 请求类型有哪些？**

`GET`、`POST` 和 `HEAD` 是最常见的 HTTP 请求类型。

1.  **通常用于从服务器向客户端发送数据的 HTTP 请求类型是什么？**

`GET` 是客户端请求从服务器获取资源的常用请求类型。

1.  **通常用于从客户端向服务器发送数据的 HTTP 请求类型是什么？**

当客户端需要向服务器发送数据时，使用 `POST`。

1.  确定 HTTP 响应体长度的两种常用方法是什么？

HTTP 主体长度通常由 `Content-Length` 标头或使用 `Transfer-Encoding: chunked` 确定。

1.  **`POST` 类型的 HTTP 请求体是如何格式化的？**

这由应用程序决定。客户端应设置 `Content-Type` 标头以指定它使用的格式。"application/x-www-form-urlencoded" 和 "application/json" 是常见的值。

# 第七章，构建简单的 Web 服务器

1.  **HTTP 客户端如何指示它已发送完 HTTP 请求？**

HTTP 请求应以一个空行结束。

1.  **HTTP 客户端如何知道 HTTP 服务器发送的内容类型？**

HTTP 服务器应使用 `Content-Type` 标头识别内容。

1.  **HTTP 服务器如何识别文件的媒体类型？**

识别文件媒体类型的一种常见方法就是查看文件扩展名。尽管如此，服务器也可以使用其他方法。当发送动态页面或数据库中的数据时，将没有文件和文件扩展名。在这种情况下，服务器必须从其上下文中知道媒体类型。

1.  **如何判断文件是否存在于文件系统中并且可以被你的程序读取？`fopen(filename, "r") != 0` 是一个好的测试吗？**

这不是一个简单的问题。一个健壮的程序需要仔细考虑系统特定的 API。Windows 使用特殊的文件名，这可能会使仅依赖于 `fopen()` 检查文件存在性的程序出错。

# 第八章，让你的程序发送电子邮件

1.  **SMTP 运行在哪个端口上？**

SMTP 通过 TCP 端口`25`进行邮件传输。许多提供商使用替代端口进行邮件提交。

1.  **如何确定哪个 SMTP 服务器接收特定域的邮件？**

负责接收特定域邮件的邮件服务器由 MX 类型的 DNS 记录给出。

1.  **如何确定哪个 SMTP 服务器为特定提供商发送邮件？**

在一般情况下，这是不可能确定的。在任何情况下，可能有几个服务器负责。有时这些服务器将列在 TXT 类型的 DNS 记录下使用 SPF，但这绝对不是普遍的。

1.  **为什么 SMTP 服务器在没有认证的情况下不会中继邮件？**

开放中继 SMTP 服务器是垃圾邮件发送者的目标。SMTP 服务器需要认证以防止滥用。

1.  **当 SMTP 是一个基于文本的协议时，如何将二进制文件作为电子邮件附件发送？**

二进制文件必须重新编码为纯文本。最常见的方法是使用`Content-Transfer-Encoding: base64`。

# 第九章，使用 HTTPS 和 OpenSSL 加载安全网页

1.  **HTTPS 通常在哪个端口上运行？**

HTTPS 通过 TCP 端口`443`连接。

1.  **对称加密使用多少个密钥？**

对称加密使用一个密钥。数据使用相同的密钥进行加密和解密。

1.  **非对称加密使用多少个密钥？**

非对称加密使用两个不同但数学上相关的密钥。数据使用一个密钥加密，使用另一个密钥解密。

1.  **TLS 使用对称加密还是非对称加密？**

TLS 使用对称和非对称加密算法来工作。

1.  **SSL 和 TLS 之间的区别是什么？**

TLS 是 SSL 的后继者。SSL 现在已弃用。

1.  **证书有什么用途？**

证书允许服务器或客户端验证其身份。

# 第十章，实现安全 Web 服务器

1.  **客户端如何决定是否应该信任服务器的证书？**

客户端可以信任服务器证书的方式有很多。信任链模型是最常见的。在这个模型中，客户端明确信任一个权威机构。然后，客户端隐式信任任何由这个受信任的权威机构签名的证书。

1.  **自签名证书的主要问题是什么？**

自签名证书未由受信任的证书颁发机构签名。除非用户添加特殊例外，否则网络浏览器不会知道信任自签名证书。

1.  **什么可以导致`SSL_accept()`失败？**

如果客户端不信任服务器的证书，或者客户端和服务器无法就相互支持的协议版本和加密套件达成一致，则`SSL_accept()`会失败。

1.  **`select()`能否用于 HTTPS 服务器的连接多路复用？**

是的，但请注意，`select()`在底层的 TCP 连接层上工作，而不是在 TLS 层上。因此，当`select()`指示套接字有等待的数据时，这并不一定意味着有新的 TLS 数据准备好。

# 第十一章，使用 libssh 建立 SSH 连接

1.  **使用 Telnet 的显著缺点是什么？**

事实上，Telnet 不提供任何安全功能。密码以明文形式发送。

1.  **SSH 通常运行在哪个端口上？**

SSH 的官方端口是 TCP 端口`22`。在实践中，通常会在任意端口上运行 SSH 以试图隐藏自己，从攻击者的角度来看，这些攻击者只是麻烦而不是真正的威胁。

1.  **为什么客户端验证 SSH 服务器是至关重要的？**

如果客户端没有验证 SSH 服务器的身份，那么它可能会被欺骗向冒充者发送凭证。

1.  **服务器通常是如何进行身份验证的？**

SSH 服务器通常使用证书来标识自己。这与使用 HTTPS 时服务器进行身份验证的方式类似。

1.  **SSH 客户端通常是如何进行身份验证的？**

客户端使用密码进行身份验证仍然很常见。这种方法的不利之处在于，如果客户端被欺骗连接到冒充的服务器，那么他们的密码就会被泄露。SSH 提供了替代方法，包括使用证书来验证客户端，这些方法不易受到重放攻击。

# 第十二章，网络监控和安全

1.  **您会使用哪个工具来测试目标系统的可达性？**

`ping`工具用于测试可达性。

1.  **哪个工具可以列出到达目标系统的路由器？**

`traceroute`（在 Windows 上为`tracert`）工具将显示到目标系统的网络路径。

1.  **原始套接字用于什么？**

原始套接字允许程序员直接指定进入网络数据包的内容。它们比 TCP 和 UDP 套接字提供更底层的访问，可以用来实现额外的协议，如 ICMP。

1.  **哪些工具可以列出您系统上的开放 TCP 套接字？**

netstat 工具可以用来显示您本地系统上的开放连接。

1.  **网络 C 程序的安全方面最大的担忧是什么？**

当用 C 语言编写网络应用程序时，必须特别注意内存安全。即使是小小的错误也可能让攻击者破坏您的程序。

# 第十三章，套接字编程技巧和陷阱

1.  **检测到网络错误时，终止程序是否总是可以接受的？**

是的。对于一些在错误情况下终止的应用程序来说，这是正确的做法。对于更复杂的应用程序，可能需要重试并继续的能力。

1.  **用于将错误代码转换为文本描述的系统函数有哪些？**

您可以在 Windows 上使用`FormatMessage()`，在其他平台上使用`strerror()`来获取错误消息。

1.  **在 TCP 套接字上调用`connect()`完成需要多长时间？**

在 TCP 三次握手完成期间，对`connect()`的调用通常会阻塞至少一个网络往返时间。

1.  **如果您在断开的 TCP 套接字上调用`send()`会发生什么？**

在基于 Unix 的系统上，您的程序可以接收一个`SIGPIPE`信号。计划这一点很重要。否则，`send()`返回`-1`。

1.  **如何确保下一次调用`send()`不会阻塞？**

要么使用`select()`确保套接字准备好接收更多数据，要么使用非阻塞套接字。

1.  **如果 TCP 连接的两端都试图同时发送大量数据会发生什么？**

如果 TCP 连接的两端都在调用`send()`，但没有调用`recv()`，那么它们可能会陷入死锁状态。在调用`send()`之间穿插调用`recv()`是很重要的。使用`select()`可以帮助你的程序了解下一步该做什么。

1.  **通过禁用 Nagle 算法能否提高应用程序的性能？**

这取决于你的应用程序正在做什么。对于使用 TCP 的实时应用程序，禁用 Nagle 算法通常是在降低延迟的同时牺牲带宽效率的良好权衡。对于其他应用程序，禁用它可能会降低吞吐量，增加网络拥塞，甚至增加延迟。

1.  **`select()`可以处理多少个连接？**

这取决于你的平台。它由`FD_SETSIZE`宏定义，在 Windows 上可以轻松增加，但在其他平台上则不行。通常，上限大约是 1,024 个套接字。

# 第十四章，物联网的 Web 编程

1.  **使用 Wi-Fi 连接有哪些缺点？**

Wi-Fi 对于最终用户设置来说可能很困难。它也不在所有地方都可用。

1.  **使用以太网连接有哪些缺点？**

许多设备没有被用于已经布线的区域。

1.  **使用蜂窝连接有哪些缺点？**

蜂窝连接成本高昂。与其他方法相比，它也可能具有更高的延迟和更大的电力需求。

1.  **使用带嵌入式 Linux 的单板计算机有哪些优点？有哪些缺点？**

能够访问完整的操作系统，如 Linux，可以简化软件开发。然而，**单板计算机**（**SBCs**）相对较贵，与微控制器相比，提供的板级连接选项和外围设备较少。它们还需要相对较多的电力。

1.  **在物联网设备中使用微控制器有哪些优点？**

许多物联网设备无论如何都需要使用微控制器来提供其基本功能。微控制器价格低廉，提供广泛的外围设备，能够满足实时性能约束，并且可以在非常少的电力下运行。

1.  **在物联网设备通信中，使用 HTTPS 是否总是合适的？**

HTTPS 对于大多数应用来说是一种不错的物联网通信安全方式；然而，它有大量的处理和带宽开销。每个应用都是独特的，所使用的安全方案应根据你的具体需求来选择。
