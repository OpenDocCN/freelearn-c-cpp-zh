# 前言

在高级语言主导技术景观的时代，C++ 仍然是一个基石，推动着从裸机嵌入式平台到分布式、云原生基础设施的广泛系统。它的优势在于能够提供性能敏感的解决方案，同时熟练处理复杂的数据结构。在过去二十年中，C++ 经历了显著的发展，不断适应现代计算的需求。

本书为那些寻求掌握编写清晰、高效 C++ 代码技艺的人提供了一本全面的指南。它深入探讨了 SOLID 原则的实施和利用 C++ 最新特性和方法对遗留代码进行重构。读者将深入理解语言、标准库、广泛的 Boost 库集合以及微软的指南支持库。

从基础知识开始，本书涵盖了编写清晰代码所必需的核心元素，特别强调使用 C++ 进行面向对象编程。它通过使用 Google Test 等流行的单元测试框架的示例，深入探讨了软件测试的设计原则。此外，本书还探讨了用于静态和动态代码分析的自动化工具的应用，展示了 Clang Tools 的强大功能。

到旅程结束时，读者将具备应用行业认可的编码实践的知识和技能，使他们能够为现实应用编写清晰、可持续和可读的 C++ 代码。

# 本书面向的对象

本书旨在为 C++ 社区中的广泛专业人士提供帮助。如果你是一位希望提升技能并编写更优雅、高效代码的 C++ 工程师，本书将为你提供提升编程实践所需的知识和技巧。它也是那些负责重构和改进现有代码库的人的绝佳资源，提供了使这一过程更易于管理和有效的实用建议和策略。

此外，本书还是技术和管理领导者的宝贵指南，他们旨在提升软件开发流程。无论你是领导一个小团队还是管理一个更大的开发项目，你都会找到有用的提示和方法，使你的工作流程更加顺畅和高效。通过实施本书中概述的最佳实践，你可以营造一个更富有成效和和谐的开发环境，最终导致软件质量更高和项目更成功。

# 本书涵盖的内容

*第一章*, *C++编码标准*，探讨了干净代码的世界及其在成功软件项目中的关键作用。我们讨论了技术债务以及低质量代码如何导致其积累。本章还涵盖了代码格式化和文档的重要性，强调了它们在维护可管理和有效代码库中的作用。我们介绍了 C++社区中使用的常见约定和最佳实践，强调了干净代码和适当文档对任何项目的必要性。

*第二章*, *主要软件开发原则*，涵盖了创建结构良好且易于维护的代码的关键软件设计原则。我们讨论了 SOLID 原则——单一职责、开闭原则、里氏替换原则、接口隔离原则和依赖倒置原则，这些原则有助于开发者编写易于理解、测试和修改的代码。我们还强调了抽象层次的重要性、副作用和可变性的概念及其对软件质量的影响。通过应用这些原则，开发者可以创建更健壮、可靠和可扩展的软件。

*第三章*, *糟糕代码的原因*，确定了导致 C++代码质量不佳的关键因素。这些因素包括快速交付的压力、C++允许对同一问题有多个解决方案的灵活性、个人编码风格以及缺乏对现代 C++特性的了解。了解这些原因有助于开发者避免常见的陷阱，并有效地改进现有的代码库。

*第四章*, *识别适合重写的理想候选者 - 模式与反模式*，专注于在 C++项目中识别适合重构的理想候选者。我们将探讨使代码段适合重构的因素，如技术债务、复杂性和可读性差。我们还将讨论常见的模式和反模式，提供改进代码结构、可读性和可维护性的指南和技术，而不改变其行为。本章旨在使开发者具备有效提升其 C++代码库质量和健壮性的知识。

*第五章*, *命名的重要性*，强调了在 C++编程中命名约定的关键作用。为变量、函数和类选择合适的名称可以增强代码的可读性和可维护性。我们讨论了命名的最佳实践、不良命名对代码效率的影响以及一致编码规范的重要性。通过理解和应用这些原则，你将编写更清晰、更有效的代码。

*第六章*, *在 C++中利用丰富的静态类型系统*，探讨了 C++中强大的静态类型系统，强调其在编写健壮、高效和可维护代码中的作用。我们讨论了高级技术，如使用`<chrono>`库处理时间长度、`not_null`包装器和`std::optional`进行更安全的指针处理。此外，我们还探讨了如 Boost 等外部库，以增强类型安全性。通过实际示例，我们展示了如何利用这些工具充分发挥 C++类型系统的潜力，从而实现更具表达性和错误抵抗力的代码。

*第七章*, *C++中的类、对象和面向对象编程*，专注于 C++中类、对象和面向对象编程（OOP）的高级主题。我们涵盖了类设计、方法实现、继承和模板使用。关键主题包括优化类封装、高级方法实践、评估继承与组合、以及复杂的模板技术。实际示例说明了这些概念，帮助您创建健壮和可扩展的软件架构。

*第八章*, *在 C++中设计和开发 API*，探讨了设计可维护 API 的原理和实践。我们讨论了在 API 设计中清晰性、一致性和可扩展性的重要性。通过具体示例，我们说明了有助于创建直观、易于使用和健壮 API 的最佳实践。通过应用这些原则，您将开发出满足用户需求且随时间适应的 API，确保您的软件库的长期成功和成功。

*第九章*, *代码格式化和命名约定*，探讨了代码格式化和命名约定在创建健壮和可维护软件中的关键作用。虽然这些主题可能看似微不足道，但它们极大地提高了代码的可读性，简化了维护，并促进了在复杂语言（如 C++）中的有效团队合作。我们深入探讨了代码格式化的重要性，并提供了使用 Clang-Format 和编辑器特定插件等工具实现一致格式化的实用知识。到本章结束时，您将了解这些实践的重要性以及如何在您的 C++项目中有效地应用它们。

*第十章*, *C++中静态分析简介*，讨论了静态分析在确保 C++开发中代码质量和可靠性中的关键作用。我们讨论了静态分析如何快速且经济地识别错误，使其成为软件质量保证的关键组成部分。我们深入探讨了 Clang-Tidy、PVS-Studio 和 SonarQube 等流行工具，并指导如何将静态分析集成到您的开发工作流程中。

*第十一章*，*动态分析*，探讨了 C++中的动态代码分析，重点关注在程序执行过程中审查程序行为以检测内存泄漏、竞态条件和运行时错误等问题的工具。我们涵盖了基于编译器的清理器，如地址清理器（ASan）、线程清理器（TSan）和未定义行为清理器（UBSan），以及用于彻底内存调试的 Valgrind。通过理解和将这些工具集成到您的开发工作流程中，您可以确保编写更干净、更高效、更可靠的 C++代码。

*第十二章*，*测试*，强调了软件测试在确保质量、可靠性和可维护性中的关键作用。我们涵盖了各种测试方法，从单元测试开始以验证单个组件，然后是集成测试以检查集成单元之间的交互。接着我们转向系统测试，对整个软件系统进行全面评估，最后以验收测试来确保软件满足最终用户的需求。通过理解这些方法，您将掌握测试如何支撑稳健和以用户为中心的软件开发。

*第十三章*，*管理第三方库的现代方法*，讨论了第三方库在 C++开发中的关键作用。我们探讨了第三方库管理的基础知识，包括静态编译与动态编译对部署的影响。鉴于 C++缺乏标准化的库生态系统，我们检查了 vcpkg 和 Conan 等工具，以了解它们在集成和管理库方面的优势。此外，我们还讨论了使用 Docker 创建一致和可重复的开发环境。到本章结束时，您将能够有效地选择和管理第三方库，从而提高您的开发工作流程和软件质量。

*第十四章*，*版本控制*，强调了在软件开发中维护干净的提交历史的重要性。我们讨论了清晰和有目的的提交信息的最佳实践，并介绍了 Git、常规提交规范和提交 linting 等工具。通过遵循这些原则，开发者可以增强沟通、协作和项目的可维护性。

*第十五章*，*代码审查*，探讨了代码审查在确保稳健和可维护的 C++代码中的关键作用。虽然自动化工具和方法提供了显著的好处，但它们并非万无一失。由人工审查员进行的代码审查有助于捕捉自动化流程可能遗漏的错误，并确保遵守标准。我们讨论了有效代码审查的策略和实用指南，强调其在预防错误、提高代码质量和培养学习与责任感的协作文化中的作用。

# 要充分利用这本书

要充分利用这本书，你应该对 C++的基础知识有扎实的理解。熟悉如 Make 和 CMake 等构建系统将有所帮助。此外，具备基本的 Docker 和终端技能可以增强你的学习体验，尽管这些是可选的。

**如果您正在使用这本书的数字版，我们建议您自己输入代码或从书的 GitHub 仓库（下一节中提供链接）获取代码。这样做将帮助您避免与代码的复制和粘贴相关的任何潜在错误。**

# 下载示例代码文件

您可以从 GitHub 下载本书的示例代码文件[`github.com/PacktPublishing/Refactoring-with-C-`](https://github.com/PacktPublishing/Refactoring-with-C-）。如果代码有更新，它将在 GitHub 仓库中更新。

我们还有其他来自我们丰富的图书和视频目录的代码包，可在[https://github.com/PacktPublishing/](https://github.com/PacktPublishing/)找到。查看它们吧！

# 使用的约定

本书使用了多种文本约定。

`文本中的代码`：表示文本中的代码单词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 昵称。以下是一个示例：“将下载的`WebStorm-10*.dmg`磁盘映像文件作为系统中的另一个磁盘挂载。”

代码块是这样设置的：

```cpp
html, body, #map {
 height: 100%;
 margin: 0;
 padding: 0
}
```

当我们希望您注意代码块中的特定部分时，相关的行或项目将以粗体显示：

```cpp
[default]
exten => s,1,Dial(Zap/1|30)
exten => s,2,Voicemail(u100)
exten => s,102,Voicemail(b100)
exten => i,1,Voicemail(s0)
```

任何命令行输入或输出都写作如下：

```cpp
$ mkdir css
$ cd css
```

**粗体**：表示新术语、重要单词或您在屏幕上看到的单词。例如，菜单或对话框中的单词以粗体显示。以下是一个示例：“从**管理**面板中选择**系统信息**。”

小贴士或重要注意事项

看起来是这样的。

# 联系我们

我们欢迎读者提供反馈。

**一般反馈**：如果您对本书的任何方面有疑问，请通过 customercare@packtpub.com 给我们发邮件，并在邮件主题中提及书名。

**勘误**：尽管我们已经尽一切努力确保内容的准确性，但错误仍然可能发生。如果您在这本书中发现了错误，我们将不胜感激，如果您能向我们报告这一点。请访问[www.packtpub.com/support/errata](http://www.packtpub.com/support/errata)并填写表格。

**盗版**：如果您在互联网上以任何形式遇到我们作品的非法副本，如果您能提供位置地址或网站名称，我们将不胜感激。请通过版权@packt.com 与我们联系，并提供材料的链接。

**如果您有兴趣成为作者**：如果您在某个主题上具有专业知识，并且您有兴趣撰写或为书籍做出贡献，请访问[authors.packtpub.com](http://authors.packtpub.com)。

# 分享您的想法

一旦您阅读了《使用 C++重构》，我们非常乐意听到您的想法！请[点击此处直接转到此书的亚马逊评论页面](https://packt.link/r/1837633770)并分享您的反馈。

您的评论对我们和科技社区非常重要，并将帮助我们确保我们提供高质量的内容。

# 下载此书的免费 PDF 副本

感谢您购买此书！

您喜欢在路上阅读，但无法携带您的印刷书籍到处走吗？

您的电子书购买是否与您选择的设备不兼容？

别担心，现在每购买一本 Packt 图书，您都可以免费获得该书的 DRM 免费 PDF 版本。

在任何地方、任何设备上阅读。直接从您最喜欢的技术书籍中搜索、复制和粘贴代码到您的应用程序中。

优惠不仅限于此，您还可以获得独家折扣、时事通讯和每日免费内容的每日电子邮件访问权限

按照以下简单步骤获取这些好处：

1.  扫描下方二维码或访问以下链接

![](img/B19606_QR_Free_PDF.jpg)

[`packt.link/free-ebook/9781837633777`](https://packt.link/free-ebook/9781837633777)

1.  提交您的购买证明

1.  就这样！我们将直接将您的免费 PDF 和其他好处发送到您的电子邮件中
