# 前言

如今的 C++为程序员提供了编写富有表现力和健壮的代码的能力，同时仍然可以针对几乎任何硬件平台，并且同时满足性能关键的要求。这使得 C++成为一种独特的语言。在过去的几年里，C++已经变成了一种更有趣、具有更好默认值的现代语言。

本书旨在为你提供编写高效应用程序的坚实基础，以及现代 C++中实现库的策略的洞察。我试图以实用的方式来解释当今的 C++是如何工作的，其中 C++17 和 C++20 的特性是语言的自然部分，而不是从历史上看待 C++。

本书的第二版是为了涵盖 C++20 新增的功能而撰写的。我包括了我认为与本书其余内容和重点相契合的功能。自然地，讨论新功能的章节更多地作为介绍，并包含较少的最佳实践和经过验证的解决方案。

在出版本书时，一些 C++20 功能的编译器支持仍然是实验性的。如果你在出版日期附近阅读本书，很可能你将不得不等待一些功能被你的编译器完全支持。

许多章节涵盖了广泛的难度范围。它们从绝对基础开始，最后涉及高级主题，如自定义内存分配器。如果某个部分对你不相关，可以随意跳过，或者以后再回来看。除了前三章外，大多数章节都可以独立阅读。

我们的主要技术审阅者 Timur Doumler 对这个新版本产生了很大的影响。他的热情和出色的反馈导致第一版的一些章节被重新修改，以更彻底、更深入地解释主题。在自然地融入新的 C++20 功能的章节中，Timur 也是一个重要的贡献者。本书的部分内容也经过了 Arthur O'Dwyer、Marius Bancila 和 Lewis Baker 的审阅。能够有这样优秀的审阅者参与这个项目是一种真正的快乐。我希望你能像我写作时那样享受阅读这个新版本。

# 本书适合对象

本书希望你具备 C++和计算机体系结构的基本知识，并对提升自己的技能有真正的兴趣。希望在你完成本书时，你能够对如何改进 C++应用程序在性能和语法上有一些见解。此外，我也希望你能有一些"啊哈"时刻。

# 本书涵盖内容

*第一章*，*C++简介*，介绍了 C++的一些重要特性，如零成本抽象、值语义、const 正确性、显式所有权和错误处理。它还讨论了 C++的缺点。

*第二章*，*基本 C++技术*，概述了使用 auto 进行自动类型推导，lambda 函数，移动语义和错误处理。

*第三章*，*分析和测量性能*，将教你如何使用大 O 符号分析算法复杂性。本章还讨论了如何对代码进行性能分析，找出热点，并使用 Google Benchmark 设置性能测试。

*第四章*，*数据结构*，带你了解了数据结构的重要性，以便可以快速访问。介绍了标准库中的容器，如`std::vector`，`std::list`，`std::unordered_map`和`std::priority_queue`。最后，本章演示了如何使用并行数组。

*第五章*，*算法*，介绍了标准库中最重要的算法。你还将学习如何使用迭代器和范围，以及如何实现自己的通用算法。

第六章，范围和视图，将教您如何使用 C++20 引入的范围库组合算法。您将了解范围库中视图的用途以及延迟评估的一些好处。

第七章，内存管理，侧重于安全高效的内存管理。这包括内存所有权、RAII、智能指针、栈内存、动态内存和自定义内存分配器。

第八章，编译时编程，解释了使用`constexpr`、`consteval`和类型特征的元编程技术。您还将学习如何使用 C++20 概念和新的概念库。最后，它提供了元编程用例的实际示例，如反射。

第九章，基本实用程序，将指导您了解实用程序库以及如何利用`std::optional`、`std::any`和`std::variant`等类型，使用编译时编程技术。

第十章，代理对象和延迟评估，探讨了如何利用代理对象进行底层优化，同时保持清晰的语法。此外，还演示了一些创造性的运算符重载用法。

第十一章，并发，涵盖了并发编程的基础知识，包括并行执行、共享内存、数据竞争和死锁。还介绍了 C++线程支持库、原子库和 C++内存模型。

第十二章，协程和延迟生成器，包含对协程抽象的一般介绍。您将了解普通函数和协程如何在 CPU 上使用堆栈和堆执行。引入了 C++20 无栈协程，并将发现如何使用生成器解决问题。

第十三章，使用协程进行异步编程，介绍了使用 C++20 的无栈协程进行并发编程，并涉及使用 Boost.Asio 进行异步网络编程的主题。

第十四章，并行算法，首先展示了编写并行算法的复杂性以及如何衡量它们的性能。然后演示了如何使用执行策略在并行上下文中利用标准库算法。

# 充分利用本书

要充分利用本书，您需要具备 C++的基本知识。最好您已经遇到与性能相关的问题，并且现在正在寻找新的工具和实践，以备下次需要处理性能和 C++时使用。

本书中有很多代码示例。其中一些来自现实世界，但大多数是人工的或大大简化的示例，用来证明一个概念，而不是提供生产就绪的代码。

我已将所有代码示例放在按章节划分的源文件中，这样您可以很容易找到想要尝试的示例。如果您打开源代码文件，您会注意到我已经用 Google 测试框架编写了大部分示例的`main()`函数的测试用例。我希望这会对您有所帮助，而不是让您感到困惑。这使我能够为每个示例编写有用的描述，并且使得一次运行一个章节中的所有示例变得更容易。

为了编译和运行示例，您需要以下内容：

+   一台计算机

+   操作系统（示例已在 Windows、Linux 和 macOS 上验证）

+   一个编译器（我使用了 Clang、GCC 和 Microsoft Visual C++）

+   CMake

提供的示例代码中的 CMake 脚本将下载并安装进一步的依赖项，如 Boost、Google Benchmark 和 Google 测试。

在写作本书的过程中，我发现使用**Compiler Explorer**很有帮助，该工具可在[`godbolt.org/`](https://godbolt.org/)上使用。Compiler Explorer 是一个在线编译器服务，可以让您尝试各种编译器和版本。如果您还没有尝试过，请试一试！

## 下载示例代码文件

本书的代码包托管在 GitHub 上，网址为[`github.com/PacktPublishing/Cpp-High-Performance-Second-Edition`](https://github.com/PacktPublishing/Cpp-High-Performance-Second-Edition)。如果代码有更新，将在现有的 GitHub 存储库上进行更新。

Packt 的丰富图书和视频目录中还有其他代码包，可在[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)上找到。去看看吧！

## 下载彩色图片

Packt 还提供了一份 PDF 文件，其中包含本书中使用的屏幕截图/图表的彩色图片。您可以在这里下载：[`static.packt-cdn.com/downloads/9781839216541_ColorImages.pdf`](https://static.packt-cdn.com/downloads/9781839216541_ColorImages.pdf)。

## 使用的约定

本书中使用了许多文本约定。

`CodeInText`：表示文本中的代码词、文件夹名称、文件名、文件扩展名、虚拟 URL 和用户输入。例如："关键字`constexpr`是在 C++11 中引入的。"

一段代码块设置如下：

```cpp
#include <iostream>
int main() {
  std::cout << "High Performance C++\n"; 
} 
```

当我希望引起您对代码块的特定部分的注意时，相关行或项目将以粗体显示：

```cpp
#include <iostream>
int main() {
std`::`cout `<<` "High Performance C++\n"`;`
} 
```

任何命令行输入或输出都以以下形式书写：

```cpp
$ clang++ -std=c++20 high_performance.cpp
$ ./a.out
$ High Performance C++ 
```

**粗体**：表示一个新术语、一个重要词或者屏幕上看到的词。例如："填写表格，然后点击**保存**按钮。"

警告或重要说明会出现在这样的形式中。

# 联系我们

读者的反馈总是受欢迎的。

**一般反馈**：如果您对本书的任何方面有疑问，请在消息主题中提及书名，并发送电子邮件至`customercare@packtpub.com`联系 Packt。

**勘误**：尽管我们已经尽一切努力确保内容的准确性，但错误是难免的。如果您在本书中发现了错误，我们将不胜感激地接受您的报告。请访问[www.packtpub.com/support/errata](http://www.packtpub.com/support/errata)，选择您的书籍，点击**勘误提交表**链接，并输入详细信息。

**盗版**：如果您在互联网上发现我们作品的任何形式的非法副本，我们将不胜感激地接受您提供的位置地址或网站名称。请通过链接`copyright@packt.com`与我们联系。

**如果您有兴趣成为作者**：如果您在某个专题上有专业知识，并且有兴趣撰写或贡献一本书，请访问[authors.packtpub.com](http://authors.packtpub.com)。

## 评论

请留下评论。一旦您阅读并使用了这本书，为什么不在购买它的网站上留下评论呢？潜在的读者可以看到并使用您公正的意见来做出购买决定，我们在 Packt 可以了解您对我们产品的看法，我们的作者可以看到您对他们书籍的反馈。谢谢！

有关 Packt 的更多信息，请访问[packt.com](http://packt.com)。
