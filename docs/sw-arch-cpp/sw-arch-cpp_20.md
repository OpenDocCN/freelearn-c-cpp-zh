# 附录 A

感谢您在软件架构的旅程中走到这一步。我们撰写这本书的目标是帮助您在设计应用程序和系统时做出明智的决策。到目前为止，当决定选择 IaaS、PaaS、SaaS 或 FaaS 时，您应该感到自信。

在这本书中，我们还有很多事情没有涉及，因为它们非常广泛，超出了书的范围。要么是我们对给定主题的经验太少，要么是我们认为它太小众。还有一些领域，我们觉得非常重要，但我们在章节中找不到合适的位置。您将在这个附录中找到它们。

# 设计数据存储

现在让我们讨论一下应用程序的存储。首先让我们决定您应该选择 SQL、NoSQL 还是其他什么。

一个很好的经验法则是根据数据库的大小来决定技术。对于小型数据库，比如那些大小永远不会增长到千兆字节区域的数据库，选择 SQL 是一个有效的方法。如果您有一个非常小的数据库或想创建一个内存缓存，您可以尝试 SQLite。如果您计划进入单一的千兆字节，再次保证大小永远不会超过这个范围，您最好选择 NoSQL。在某些情况下，仍然可以坚持使用 SQL 数据库，但由于硬件成本的原因，这很快就会变得昂贵，因为您需要一台强大的服务器作为主节点。即使这不是问题，您也应该衡量性能是否足够满足您的需求，并准备好长时间的维护窗口。在某些情况下，只需运行一组 SQL 机器，使用诸如 Citus 之类的技术，这也可能适合您，Citus 本质上是一个分片的 PostgreSQL。然而，通常在这种情况下，选择 NoSQL 更便宜、更简单。如果您的数据库大小超过 10 TB，或者需要实时摄入数据，考虑使用数据仓库而不是 NoSQL。

## 我应该使用哪种 NoSQL 技术？

这个问题的答案取决于几个因素。以下是其中的一些：

+   如果您想存储时间序列（在小的、定期的间隔内保存增量），那么最好的选择是使用 InfluxDB 或 VictoriaMetrics。

+   如果您需要类似 SQL 但可以不使用连接，或者换句话说，如果您计划将数据存储在列中，您可以尝试使用 Apache Cassandra、AWS DynamoDB 或 Google 的 BigTable。

+   如果不是这种情况，那么您应该考虑您的数据是否是没有模式的文档，比如 JSON 或某种应用程序日志。如果是这种情况，您可以选择 Elasticsearch，它非常适合这种灵活的数据，并提供 RESTful API。您也可以尝试使用 MongoDB，它以**二进制 JSON**（**BSON**）格式存储数据，并允许 MapReduce。

好吧，但如果您不想存储文档怎么办？那么您可以选择对象存储，特别是如果您的数据很大的话。在这种情况下，通常选择云提供商是可以的，这意味着使用 Amazon 的 S3 或 Google 的 Cloud Storage 或 Microsoft 的 Blob 存储应该有助于您的情况。如果您想选择本地存储，您可以使用 OpenStack 的 Swift 或部署 Ceph。

如果文件存储也不是你要找的，那么也许你的情况只是简单的键值数据。使用这种存储有它的好处，因为它很快。这就是为什么许多分布式缓存都是使用它构建的。值得注意的技术包括 Riak、Redis 和 Memcached（最后一个不适合持久化数据）。

除了前面提到的选项，您还可以考虑使用基于树的数据库，比如 BerkeleyDB。这些数据库基本上是专门的键值存储，具有类似路径的访问。如果��对您的情况太过限制，您可能会对面向图的数据库感兴趣，比如 Neo4j 或 OrientDB。

# 无服务器架构

虽然与云原生设计相关，无服务器架构本身是一个热门话题。自引入 FaaS 或 CaaS 产品（如 AWS Lambda、AWS Fargate、Google Cloud Run 和 Azure Functions）以来，它变得非常受欢迎。

无服务器主要是 PaaS 产品（如 Heroku）的演进。它抽象了底层基础架构，使开发人员可以专注于应用程序，而不是基础架构选择。

与旧的 PaaS 解决方案相比，无服务器的另一个好处是您不必为您不使用的部分付费。与支付给定服务级别的费用不同，您通常会根据部署的工作负载的实际执行时间付费。如果您只想每天运行一段代码，您不需要为基础服务器支付月费。

虽然我们没有详细讨论无服务器，但它很少与 C++一起使用。在 FaaS 方面，目前只有 AWS Lambda 支持 C++作为可能的语言。由于容器是语言无关的，您可以使用 C++应用程序和函数与 AWS Fargate、Azure 容器实例或 Google Cloud Run 等 CaaS 产品一起使用。

如果您想要运行与您的 C++应用程序一起使用的非 C++辅助代码，无服务器函数可能仍然与您相关。维护任务和定期作业非常适合无服务器，它们通常不需要 C++二进制文件的性能或效率。

# 通信和文化

本书的重点是软件架构。那么为什么我们要在围绕软件的书中提到沟通和文化呢？如果您仔细想想，所有的软件都是由人编写的，供人使用的。人的因素是主要的，但我们经常不愿承认它。

作为架构师，您的角色不仅是找出解决特定问题的最佳方法。您还必须将您提出的解决方案与团队成员沟通。通常，您所做的选择将是基于先前的对话。

这些是沟通和团队文化在软件架构中也发挥作用的原因。

在早期的章节中，我们提到了康威定律。这个定律指出软件系统的架构反映了正在处理它的组织。这意味着构建优秀的产品需要构建优秀的团队并理解心理学。

如果您想成为一名优秀的架构师，学习人际关系技能可能与学习技术技能一样重要。

# DevOps

我们在本书中多次使用了 DevOps（和 DevSecOps）这个术语。在我们看来，这个主题值得额外的空间。DevOps 是一种构建软件产品的方法，它打破了传统的基于独立开发的模式。

在瀑布模型中，团队独��地操作单个工作方面。开发团队编写代码，QA 测试和验证代码，然后才是安全和合规性。最终，运维团队将负责维护。团队很少进行沟通，即使进行沟通，通常也是一个非常正式的过程。

关于特定专业领域的知识以前只能由负责特定工作流程的团队获得。开发人员对 QA 知之甚少，对运维几乎一无所知。虽然这种设置非常方便，但现代环境需要比瀑布模型提供更多的灵活性。

这就是为什么提出了一种新的工作模式，鼓励更多的协作，更好的沟通，并在软件产品的不同利益相关者之间进行大量的知识共享。虽然 DevOps 指的是将开发人员和运维团队聚集在一起，但它的意思是让每个人更加接近。

开发人员在编写第一行代码之前就开始与 QA 和安全合作。运维工程师对代码库更熟悉。企业可以轻松跟踪特定工单的进展，并且在某些情况下，甚至可以自助进行部署预览。

DevOps 已经成为使用特定工具如 Terraform 或 Kubernetes 的代名词。但 DevOps 并不意味着使用任何特定的工具。你的组织可以遵循 DevOps 原则而不使用 Terraform 或 Kubernetes，也可以在不实践 DevOps 的情况下使用 Terraform 和 Kubernetes。

DevOps 的原则之一是鼓励产品利益相关者之间改善信息流动。有了这一点，就有可能实现另一个原则：减少不为最终产品带来价值的浪费活动。

当你构建现代系统时，值得使用现代方法。将现有组织迁移到 DevOps 可能需要进行大规模的思维转变，因此并非总是可能的。在启动一个你可以控制的全新项目时值得追求。
