# 前言

C++是一种通用、多范式的编程语言，支持过程式、面向对象和在一定程度上支持函数式编程范式。它最初是带有类的 C 语言，但随着时间的推移，它已经转变为一种现代语言，能够在不牺牲性能的情况下编写高度表达性的代码。尽管如此，C 仍然是嵌入式开发中的主导语言，这主要归因于其简单性和较平缓的学习曲线。

然而，C 语言的简单性往往使得编写复杂系统过于冗长，增加了开发者的认知负担，并使代码更容易出错。这正是 C++的优势所在。凭借泛型编程、运行时和编译时多态性、编译时计算以及增强的类型和内存安全性等特性，它是嵌入式系统开发的绝佳选择。

关于 C++的神话，如代码膨胀和运行时开销，仍然广泛存在。本书首先驳斥这些误解，并引导您了解 C++的基础知识。然后，它将重点转向更高级的现代 C++概念，并将它们应用于解决嵌入式开发中的实际问题。

本书的目标是通过精心挑选的示例和运用良好的软件开发实践，向您展示现代 C++在嵌入式系统中的有效应用。

# 本书面向的对象

本书面向的是那些在日常工作中主要使用 C 语言，并希望发现现代 C++的嵌入式开发者。虽然期望您对 C++有一定的了解，但不是必需的，因为本书也涵盖了 C++的基础知识。

# 本书涵盖的内容

*第一章*，*破解关于 C++的常见神话*，探讨了关于 C++的广泛误解，并系统地予以驳斥。您还将了解 C++的历史和零开销原则。

*第二章*，*资源受限嵌入式系统中的挑战*，探讨了资源受限嵌入式系统面临的设计挑战，重点关注性能分析技术和内存管理。它还展示了如何避免可能存在问题的语言特性，如异常和 RTTI。

*第三章*，*嵌入式 C++生态系统*，回顾了嵌入式领域中用于 C++开发的工具，包括工具链、静态分析器、性能分析工具和测试框架。

*第四章*，*设置 C++嵌入式项目的开发环境*，指导您如何设置现代 C++嵌入式项目的开发环境，包括使用模拟器在虚拟环境中测试您的代码。

*第五章*，*类 – C++应用程序的构建块*，指导您了解 C++中的类，包括存储持续时间、初始化、继承和动态多态性。

*第六章*，*超越类 – 基本的 C++概念*，涵盖了 C++的基本特性，如命名空间和函数重载。它还讨论了与 C 的互操作性，并介绍了标准库容器和算法。

*第七章*，*强化固件 – 实用的 C++错误处理方法*，探讨了 C++中的各种错误处理技术，包括错误代码、断言和全局处理程序。它还解释了异常的机制以及它们是如何工作的。

*第八章*，*使用模板构建通用和可重用代码*，介绍了模板和概念。它还提供了对模板元编程和编译时多态性的介绍。

*第九章*，*使用强类型提高类型安全性*，讨论了 C++中的隐式和显式类型转换，并介绍了强类型的概念。一个来自嵌入式库的实用示例演示了如何提高类型安全性。

*第十章*，*使用 Lambda 编写表达性代码*，介绍了 Lambda，并展示了如何在命令设计模式中使用它们来实现一个表达性中断管理器。

*第十一章*，*编译时计算*，探讨了 C++的编译时计算能力，并演示了如何使用它们构建一个在编译时生成查找表的信号发生器库。

*第十二章*，*编写 C++ HAL*，演示了在 C++中使用模板元编程确保类型安全来实施 HAL 的实现。

*第十三章*，*与 C 库一起工作*，展示了如何在 C++项目中有效地使用 C 库。它通过使用文件系统 C 库的示例演示了 RAII 原则。

*第十四章*，*使用序列器增强超级循环*，展示了如何使用序列器来改进基于简单超级循环的设计。它还介绍了**嵌入式模板库**（**ETL**）及其在编译时已知固定大小的容器类模板。

*第十五章*，*实用模式 – 构建温度发布者*，指导你通过观察者设计模式，并演示了如何在恒温器和 HVAC 控制器等系统中应用它。

*第十六章*，*设计可伸缩的有限状态机*，探讨了实现有限状态机的不同方法。它从基本的枚举-开关方法开始，引入了状态设计模式，然后介绍了 Boost.SML 库。

*第十七章*，*库和框架*，突出了 C++标准模板库中对于在受限系统中进行固件开发有用的部分。它还介绍了 CIB 和 Pigweed 库。

*第十八章*，*跨平台开发*，讨论了在嵌入式软件中实现可移植性和可测试性的良好软件设计的重要性。

# 为了充分利用这本书

书中的许多示例都可以在 Compiler Explorer ([`godbolt.org/`](https://godbolt.org/))中运行。使用它来观察编译器的汇编输出。通过实验示例，调整它们，并用不同的优化级别和编译器标志编译它们，以了解这些更改如何影响编译器输出。

大多数示例也可以在 Renode 模拟器中运行。本书附带的 Docker 容器包括 GCC 工具链和 Renode 模拟器，使您能够在嵌入式目标模拟中运行代码。

| **本书涵盖的软件/硬件** | **操作系统要求** |
| --- | --- |
| Docker | Windows, macOS, 或 Linux |

**如果您正在使用本书的数字版，我们建议您自己输入代码或从本书的 GitHub 仓库（下一节中有一个链接）获取代码。这样做将帮助您避免与代码复制和粘贴相关的任何潜在错误。**

## 下载示例代码文件

该书的代码包托管在 GitHub 上，地址为[`github.com/PacktPublishing/Cpp-in-Embedded-Systems`](https://github.com/PacktPublishing/Cpp-in-Embedded-Systems)。我们还有其他来自我们丰富图书和视频目录的代码包，可在[`github.com/PacktPublishing`](https://github.com/PacktPublishing)找到。查看它们吧！

## 下载彩色图像

我们还提供了一份包含本书中使用的截图/图表的彩色图像的 PDF 文件。您可以从这里下载：[`packt.link/gbp/9781835881149`](https://packt.link/gbp/9781835881149)。

## 使用的约定

本书中使用了多种文本约定。

`CodeInText`：表示文本中的代码单词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 昵称。例如：“`PT100`类也是`TemperatureSensor`类，`TemperatureController`类有一个`TemperatureSensor`成员（对象）和一个`PidController`类。”

代码块设置为如下：

```cpp
#define N 20
int buffer[N];
for(int i = 0; i < N; i ++) {
    printf("%d ", buffer[i]);
} 
```

任何命令行输入或输出都按照以下方式编写：

```cpp
The output of this simple program might be surprising:
resistance = 3.00 
```

**粗体**：表示新术语、重要单词或屏幕上看到的单词。例如，菜单或对话框中的单词在文本中显示如下。例如：“现在，我们需要通过在执行面板中点击**库**按钮来添加 Google Test 库。”

警告或重要提示如下所示。

小贴士和技巧如下所示。

# 联系我们

我们始终欢迎读者的反馈。

**一般反馈**：请通过电子邮件`feedback@packtpub.com`发送，并在邮件主题中提及本书的标题。如果您对本书的任何方面有疑问，请通过电子邮件`questions@packtpub.com`联系我们。

**勘误**: 尽管我们已经尽一切努力确保内容的准确性，但错误仍然可能发生。如果您在这本书中发现了错误，我们将不胜感激，如果您能向我们报告，我们将非常感谢。请访问 [`www.packtpub.com/submit-errata`](http://www.packtpub.com/submit-errata)，点击 **提交勘误** 并填写表格。

**盗版**: 如果您在互联网上以任何形式发现我们作品的非法副本，如果您能提供位置地址或网站名称，我们将不胜感激。请通过 `copyright@packtpub.com` 联系我们，并附上材料的链接。

**如果您有兴趣成为作者**: 如果您在某个领域有专业知识，并且您有兴趣撰写或为书籍做出贡献，请访问 [`authors.packtpub.com/`](http://authors.packtpub.com/)。

# 分享您的想法

读完 *C++ in Embedded Systems* 后，我们非常乐意听到您的想法！请点击此处直接进入这本书的亚马逊评论页面并分享您的反馈。

您的评论对我们和科技社区非常重要，并将帮助我们确保我们提供高质量的内容。

# 加入我们的 Discord 社区

加入我们社区的 Discord 空间，与作者和其他读者进行讨论：

[`packt.link/embeddedsystems`](https://packt.link/embeddedsystems)

![Discord 二维码](img/QR_code_Discord.png)

# 下载这本书的免费 PDF 版本

感谢您购买这本书！

您喜欢在路上阅读，但无法携带您的印刷书籍到处走吗？

您选择的设备是否与您的电子书购买不兼容？

不要担心，现在，随着每本 Packt 书籍，您都可以免费获得该书的 DRM-free PDF 版本。

在任何地方、任何设备上阅读。直接从您最喜欢的技术书籍中搜索、复制和粘贴代码到您的应用程序中。

优惠远不止于此，您还可以获得独家折扣、时事通讯和每日免费内容的每日电子邮件。

按照以下简单步骤获取福利：

1.  扫描下面的二维码或访问以下链接

![二维码描述自动生成](img/B22402_QR_Free_PDF.png)

[`packt.link/free-ebook/9781835881149`](https://packt.link/free-ebook/9781835881149)

1.  提交您的购买证明

1.  就这些！我们将直接将您的免费 PDF 和其他福利发送到您的电子邮件。
