# 序言

打造顶级软件并非易事。开发者在网上研究这一主题时，常常遇到的问题是如何判断哪些建议是更新的，哪些方法已经被更 fresh、更好的实践所超越。与此同时，大多数资源对这个过程的解释是混乱的，没有适当的背景、上下文和结构。

*现代 CMake for C++* 是一本端到端的指南，提供了更简单的体验，因为它全面地处理了 C++解决方案的构建。它教会您如何在 CMake 项目中使用 CMake，并展示使其可维护、优雅和干净的原因。它引导您通过许多项目中出现的复杂任务的自动化，包括构建、测试和打包。

本书将指导您如何形成源目录，以及如何构建目标和包。随着您的进展，您将学习如何编译和链接可执行文件和库，这些过程是如何详细工作的，以及如何优化所有步骤以获得最佳结果。您还将了解如何将外部依赖项添加到项目中：第三方库、测试框架、程序分析工具和文档生成器。最后，您将探索如何为内部和外部目的导出、安装和打包您的解决方案。

完成本书后，您将能够在专业水平上自信地使用 CMake。

# 本书适合谁阅读

学习 C++语言往往不足以让你为交付项目到最高标准做好准备。如果你有兴趣成为一名专业的构建工程师，一个更好的软件开发者，或者简单地说，想精通 CMake，如果你想了解项目是如何组合在一起的以及为什么这样，如果你正在从不同的构建环境中过渡，或者如果你对从零开始学习现代 CMake 感兴趣，那么这本书适合你。

# 本书涵盖内容

第一章，*CMake 的初步步骤*，涵盖了如何安装和使用 CMake 的命令行，以及构成项目的文件。

第二章，*CMake 语言*，提供了关键代码信息：注释、命令调用和参数、变量、列表和控制结构。

第三章，*设置您的第一个 CMake 项目*，介绍了项目的基本配置、所需的 CMake 版本、项目元数据和文件结构，以及工具链设置。

第四章，*与目标工作*，介绍了逻辑构建目标，这些目标为可执行文件和库生成工件。

第五章，*使用 CMake 编译 C++源代码*，解释了编译过程的细节以及如何在 CMake 项目中控制编译过程。

第六章，*使用 CMake 链接*，提供了关于链接、静态和共享库的一般信息。本章还解释了如何结构化一个项目，以便它可以被测试。

第七章，*使用 CMake 管理依赖项*，解释了现代 CMake 中可用的依赖管理方法。

第八章，*测试框架*，描述了如何将最流行的测试框架添加到您的项目中，以及如何使用 CMake 工具集中的 CTest 工具。

第九章，*程序分析工具*，介绍了如何在您的项目中执行自动格式化，以及进行静态和动态分析。

第十章，*生成文档*，解释了如何使用 Doxygen 直接从 C++源代码生成用户手册。

第十一章，*安装和打包*，展示了如何将您的项目准备成在其他项目中使用或在系统上安装。我们还将看到 CPack 工具的解释。

第十二章，*创建你的专业项目*，介绍了如何将迄今为止你所获得的所有知识整合成一个完全形成的项目。

附录：*杂项命令*，提供最流行命令的快速参考：`string()`、`list()`、`file()` 和 `math()`。

# 为了充分利用本书

本书假设您对 C++和类 Unix 系统有基本的熟悉度。虽然这不是一个严格的要求，但熟悉这些内容将有助于您完全理解本书中的示例。

本书针对 CMake 3.20，但描述的大多数技术应该从 CMake 3.15 起就可以工作（在之后添加的功能通常会 highlighted）。

所有示例已在安装以下包的 Debian 上进行测试：

`clang-format clang-tidy cppcheck doxygen g++ gawk git graphviz lcov libpqxx-dev libprotobuf-dev make pkg-config protobuf-compiler tree valgrind vim wget`

为了体验相同的环境，建议使用如第一章所解释的 Docker 镜像。

**如果你使用的是本书的数字版，我们建议你亲自输入代码或从本书的 GitHub 仓库（下一节中有链接）访问代码。这样做可以帮助你避免因复制和粘贴代码而可能出现的任何潜在错误。**

# 下载示例代码文件

您可以从 GitHub 下载本书的示例代码文件，地址为[`github.com/PacktPublishing/Modern-CMake-for-Cpp`](https://github.com/PacktPublishing/Modern-CMake-for-Cpp)。如果代码有更新，它将在 GitHub 仓库中更新。

我们还有其他丰富的书籍和视频目录中的代码包，可在[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)找到。去看看吧！

# 下载彩色图像

我们还提供了一个 PDF 文件，其中包含本书中使用的屏幕截图和图表的彩色图像。您可以通过此链接下载： [`static.packt-cdn.com/downloads/9781801070058_ColorImages.pdf`](https://static.packt-cdn.com/downloads/9781801070058_ColorImages.pdf)。

# 本书中使用了以下约定：

本书中使用了多种文本约定。

`文本中的代码`：表示文本中的代码单词、数据库表名、文件夹名、文件名、文件扩展名、路径名、假 URL、用户输入和 Twitter 处理。以下是一个示例："选择`Debug`、`Release`、`MinSizeRel`或`RelWithDebInfo`并按如下方式指定。"

代码块如下所示：

```cpp
cmake_minimum_required(VERSION 3.20)
project(Hello)
add_executable(Hello hello.cpp)
```

当我们要引起您对代码块中特定部分的关注时，相关行或项目以粗体显示：

```cpp
cmake_minimum_required(VERSION 3.20)
project(app)
message("Top level CMakeLists.txt")
add_subdirectory(api)
```

任何命令行输入或输出如下所示：

```cpp
cmake --build <dir> --parallel [<number-of-jobs>]
cmake --build <dir> -j [<number-of-jobs>]
```

**粗体**：表示新术语、重要单词或您在屏幕上看到的单词。例如，菜单或对话框中的单词以**粗体**显示。以下是一个示例："如果其他方法都失败了，我们需要使用大炮，总有**跟踪模式**。"

提示或重要说明

文本中代码如下所示。
