# 前言

在本书中，你将学习高级 C++技术，可以应用于自己的 C++项目。本书使用食谱式方法教授 C++，每个食谱都有示例和屏幕截图，可以从 GitHub 下载并自行操作。本书使用 C++17 规范教授 C++，并在最后一章预览了添加到 C++20 的新功能。在一些食谱中，我们甚至会使用反汇编器来更好地理解 C++的编译方式，以及某些决策对应用程序的影响。通过本书，你将掌握 C++的高级概念，并能解决日常问题，从而将你的 C++编程提升到更高水平。

# 本书适合谁

本书适用于熟悉 C++并希望获得专业技能并成为熟练 C++开发人员的中级 C++开发人员。假定对语言有很好的理解，包括对汇编语言的基本理解。

# 本书涵盖内容

第一章，*开始使用库开发*，教你如何开发自己的库，包括最少惊讶原则的解释，如何对所有内容进行命名空间处理，如何编写仅包含头文件的库，以及如何确保其他人将继续使用你的库。

第二章，*使用异常进行错误处理*，涵盖了 C++异常和错误处理的更高级主题，包括对`noexcept`说明符和运算符的详细解释，RAII 如何在异常存在的情况下支持资源管理，为什么应避免从析构函数中抛出异常，以及如何编写自己的异常。

第三章，*实现移动语义*，详细解释了 C++移动语义，包括*大五*的解释，如何使你的类可移动，如何编写仅移动（和非移动）非复制样式的类，如何正确实现移动构造函数，为什么`const &&`没有意义，以及如何使用引用资格。

第四章，*使用模板进行通用编程*，教你如何像专家一样编写模板函数，包括如何实现自己的 SFINAE，如何执行完美转发，如何使用`constexpr-if`语句，如何利用参数包的元组，如何在编译时循环参数包，如何使用类型特征来实现相同函数的不同版本，如何使用`template<auto>`，以及如何在自己的应用程序中利用显式类型声明。

第五章，*并发和同步*，教你如何使用`std::mutex`（及其相关内容），何时使用原子类型，如何使用`mutable`关键字处理具有线程安全性的`const`类，如何编写线程安全类，如何编写线程安全包装器，以及如何编写异步 C++，包括 promises 和 futures。

第六章，*优化代码以提高性能*，介绍了如何对 C++进行性能分析和基准测试，如何反汇编 C++以更好地理解如何优化代码，如何定位并删除不需要的内存分配，以及为什么`noexcept`有助于优化。

第七章，*调试和测试*，指导你如何使用`Catch2`来对 C++进行单元测试，如何使用 Google 的 ASAN 和 UBSAN 清除器动态分析代码以检测内存损坏和未定义行为，以及如何使用 NDEBUG。

第八章，*创建和实现自己的容器*，教你如何通过创建始终排序的`std::vector`来编写自己的容器包装器。

第九章，*探索类型擦除*，教授了关于类型擦除的一切，包括如何通过继承和使用模板来擦除类型，如何实现类型擦除模式，以及如何实现委托模式。

第十章，*深入了解动态分配*，教授动态内存分配的高级主题，包括如何正确使用`std::unique_ptr`和`std::shared_ptr`，如何处理循环引用，如何对智能指针进行类型转换，以及堆是如何在后台工作以为应用程序提供动态内存的。

第十一章，*C++中的常见模式*，解释了计算机科学中不同模式在 C++中的实现，包括工厂模式、单例模式、装饰器模式和观察者模式，以及如何实现静态多态性以编写自己的静态接口而无需虚继承。

第十二章，*深入了解类型推导*，深入探讨了 C++17 中类型推导的执行方式，包括`auto`、`decltype`和`template`如何自动推断其类型。本章最后还提供了如何编写自己的 C++17 用户定义的推导指南的示例。

第十三章，*奖励：使用 C++20 特性*，提供了 C++20 即将推出的新特性的预览，包括概念、模块、范围和协程。

# 充分利用本书

我们假设您以前已经编写过 C++，并且已经熟悉了一些现代 C++特性。

本书使用 Ubuntu 提供示例，您可以在阅读本书时自行编译和运行。我们假设您对 Ubuntu 有一些基本的了解，知道如何安装它，以及如何使用 Linux 终端。

我们在一些示例中使用反汇编器来更好地理解编译器在幕后的工作。虽然您不需要知道如何阅读汇编代码来理解所教授的内容，但对 x86_64 汇编的基本理解将有所帮助。

# 下载示例代码文件

您可以从[www.packt.com](http://www.packt.com)的帐户中下载本书的示例代码文件。如果您在其他地方购买了本书，可以访问[www.packtpub.com/support](https://www.packtpub.com/support)注册，直接将文件发送到您的邮箱。

您可以按照以下步骤下载代码文件：

1.  登录或在[www.packt.com](http://www.packt.com)注册。

1.  选择支持选项卡。

1.  点击代码下载。

1.  在搜索框中输入书名，然后按照屏幕上的说明操作。

下载文件后，请确保使用最新版本的解压缩软件解压或提取文件夹。

+   Windows 上的 WinRAR/7-Zip

+   Mac 上的 Zipeg/iZip/UnRarX

+   Linux 上的 7-Zip/PeaZip

该书的代码包也托管在 GitHub 上，网址为[`github.com/PacktPublishing/Advanced-CPP-Programming-CookBook`](https://github.com/PacktPublishing/Advanced-CPP-Programming-CookBook)。如果代码有更新，将在现有的 GitHub 存储库上进行更新。

我们还有其他代码包，来自我们丰富的图书和视频目录，可在**[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)**上找到。快去看看吧！

# 代码实例

访问以下链接查看代码运行的视频：[`bit.ly/2tQoZyW`](https://bit.ly/2tQoZyW)

# 使用的约定

本书中使用了许多文本约定。

`constexpr`：指示文本中的代码字、数字、文件夹名称、文件名、文件扩展名、路径名、虚拟 URL 和用户输入。例如："`noexcept`说明符用于告诉编译器函数是否可能引发 C++异常。"

代码块设置如下：

```cpp
int main(void)
{
    the_answer is;
    return 0;
}
```

当我们希望引起您对代码块的特定部分的注意时，相关的行或项目会以粗体显示：

```cpp
int main(void)
{
    auto execute_on_exit = finally{[]{
        std::cout << "The answer is: 42\n";
    }};
}
```

任何命令行输入或输出都将按以下方式编写：

```cpp
> mkdir build && cd build
> cmake ..
> make recipe04_examples
```

**粗体**：表示一个新术语，一个重要词或您在屏幕上看到的词。例如，重要单词会以这种方式出现在文本中。这里有一个例子：“在这个食谱中，我们将学习为什么在析构函数中抛出异常是一个**坏主意**。”

警告或重要说明会出现在这样的地方。

提示和技巧会出现在这样的地方。

# 部分

在这本书中，您会发现一些经常出现的标题（*准备好*，*如何做...*，*它是如何工作的...*，*还有更多...*和*另请参阅*）。

为了清晰地说明如何完成一个食谱，请按照以下部分进行操作：

# 准备好

这一部分告诉您在食谱中可以期待什么，并描述如何设置任何软件或食谱所需的任何初步设置。

# 如何做...

这一部分包含了遵循食谱所需的步骤。

# 它是如何工作的...

这一部分通常包括了对前一部分发生的事情的详细解释。

# 还有更多...

这部分包括有关食谱的额外信息，以使您对食谱更加了解。

# 另请参阅

这一部分为食谱提供了其他有用信息的有用链接。