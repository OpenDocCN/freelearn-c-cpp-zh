# 前言

Packt 公司大约一年前首次联系我，希望我写这本书。这是一段漫长的旅程，有时比预期的要艰难，但我学到了很多。你现在手中的这本书是许多漫长日子的结晶，我很自豪终于能把它呈现给大家。

我认为 C 语言是一种美丽的编程语言。在日常使用的其他任何语言中，都没有像 C 语言那样让你如此接近机器。我用 C 语言编写过只有 16 字节 RAM 的 8 位微控制器程序，就像我用它编写过具有多核、多 GHz 处理器的现代桌面程序一样。C 语言在这两种环境中都能高效工作，这确实令人印象深刻。

网络编程是一个有趣的话题，但也是一个非常深奥的话题；在许多层面上都在发生很多事情。一些编程语言隐藏了这些抽象。例如，在 Python 编程语言中，你只需一行代码就可以下载整个网页。在 C 语言中就不是这样！在 C 语言中，如果你想下载一个网页，你必须知道一切是如何工作的。你需要了解套接字，你需要了解**传输控制协议**（**TCP**），你还需要了解 HTTP。在 C 语言网络编程中，没有任何东西是隐藏的。

C 语言是学习网络编程的绝佳语言。这不仅是因为我们可以看到所有的细节，还因为所有流行的操作系统都使用用 C 语言编写的内核。没有其他语言能像 C 语言那样给你提供同样的第一级访问权限。在 C 语言中，一切都在你的控制之下——你可以按照自己的意愿精确地布局你的数据结构，精确地管理内存，甚至可以按照自己的意愿“自食其果”。

当我开始写这本书的时候，我调查了其他与用 C 语言学习网络编程相关的资源。我发现了很多错误信息——不仅在网络上，甚至在印刷品中。有很多 C 语言网络代码是错误的。关于 C 语言套接字的互联网教程经常使用已弃用的函数，并且完全忽略了内存安全性。当涉及到网络编程时，你不能采取“它工作所以足够好，巧合编程”的方法。你必须使用推理。

在这本书中，我特别注意以现代和安全的方式处理网络编程。示例程序被精心设计，以便与 IPv4 和 IPv6 一起工作，并且尽可能以可移植、操作系统无关的方式编写。无论何时有机会出现内存错误，我都会尽力注意并指出这些关注点。安全性往往被放在次要位置。我相信安全性很重要，并且应该从一开始就在系统中进行规划。因此，除了教授网络基础知识外，这本书还花了很多时间与安全协议一起工作，例如 TLS。

我希望你能像我写作这本书一样享受阅读这本书。

# 这本书面向谁

本书面向希望将网络功能添加到其软件中的 C 或 C++程序员。它也适用于只想学习网络编程和常见网络协议的学生或专业人士。

假设读者已经对 C 编程语言有一定了解。这包括对指针、基本数据结构和手动内存管理的基本熟练度。

# 本书涵盖内容

第一章，*介绍网络和协议*，介绍了与网络相关的重要概念。本章包括示例程序，以确定您的 IP 地址。

第二章，*掌握套接字 API*，介绍了套接字编程 API，并指导你构建你的第一个网络程序——一个微型的 Web 服务器。

第三章，*TCP 连接的深入概述*，专注于 TCP 套接字的编程。在本章中，我们为客户端和服务器端开发了示例程序。

第四章，*建立 UDP 连接*，涵盖了使用**用户数据报协议**（**UDP**）套接字进行编程。

第五章，*主机名解析和 DNS*，解释了如何将主机名转换为 IP 地址。在本章中，我们构建了一个示例程序，使用 UDP 手动执行 DNS 查询查找。

第六章，*构建一个简单的 Web 客户端*，介绍了 HTTP——推动网站运行的协议。我们直接进入并使用 C 构建了一个 HTTP 客户端。

第七章，*构建一个简单的 Web 服务器*，描述了如何使用 C 构建一个功能齐全的 Web 服务器。该程序能够为任何现代 Web 浏览器提供静态网站服务。

第八章，*使您的程序发送电子邮件*，描述了**简单邮件传输协议**（**SMTP**）——推动电子邮件的协议。在本章中，我们开发了一个程序，能够通过互联网发送电子邮件。

第九章，*使用 HTTPS 和 OpenSSL 加载安全 Web 页面*，探讨了 TLS——确保网页安全的协议。在本章中，我们开发了一个 HTTPS 客户端，能够安全地下载网页。

第十章，*实现安全 Web 服务器*，继续探讨安全主题，并探索构建安全 HTTPS Web 服务器的方法。

第十一章，*使用 libssh 建立 SSH 连接*，继续探讨安全协议主题。本章涵盖了使用**安全壳**（**SSH**）连接到远程服务器、执行命令和安全下载文件的内容。

第十二章，*网络监控和安全*，讨论了用于测试网络功能、解决问题和监听不安全通信协议的工具和技术。

第十三章，*套接字编程技巧和陷阱*，详细介绍了 TCP 以及套接字编程中出现的许多重要边缘情况。所涵盖的技术对于创建健壮的网络程序非常有价值。

第十四章，*物联网的 Web 编程*，概述了物联网（IoT）应用的设计和编程。

附录 A，*问题答案*，提供了每章末尾的阅读理解问题的答案。

附录 B，*在 Windows 上设置您的 C 编译器*，提供了在 Windows 上设置开发环境以编译本书中所有示例程序的说明。

附录 C，*在 Linux 上设置您的 C 编译器*，提供了准备您的 Linux 计算机以能够编译本书中所有示例程序的设置说明。

附录 D，*在 macOS 上设置您的 C 编译器*，提供了配置您的 macOS 系统以能够编译本书中所有示例程序的逐步说明。

附录 E，*示例程序*，按章节列出本书代码库中包含的每个示例程序。

# 要充分利用本书

预期读者精通 C 编程语言。这包括熟悉内存管理、指针的使用和基本数据结构。

推荐使用 Windows、Linux 或 macOS 开发机器；您可以参考附录中的设置说明。

本书采用实践学习方法，包括 44 个示例程序。在阅读本书的同时完成这些示例将有助于巩固概念。

本书代码采用 MIT 开源许可证发布。鼓励读者使用、修改、改进甚至发布对这些示例程序的更改。

# 下载示例代码文件

您可以从[www.packt.com](http://www.packt.com)的账户下载本书的示例代码文件。如果您在其他地方购买了此书，您可以访问[www.packt.com/support](http://www.packt.com/support)并注册，以便将文件直接通过电子邮件发送给您。

本书代码包也公开托管在 GitHub 上，地址为**[`github.com/codeplea/hands-on-network-programming-with-c`](https://github.com/codeplea/hands-on-network-programming-with-c)**。如果代码有更新，它将在该 GitHub 仓库中更新。每章介绍示例程序时，都会以下载书籍代码所需的命令开始。

# 下载彩色图像

我们还提供包含本书中使用的截图/图表的彩色图像的 PDF 文件。您可以从这里下载：[`www.packtpub.com/sites/default/files/downloads/9781789349863_ColorImages.pdf`](http://www.packtpub.com/sites/default/files/downloads/9781789349863_ColorImages.pdf)。

# 使用的约定

本书使用了多种文本约定。

`CodeInText`：表示文本中的代码单词、变量名、函数名、目录名、文件名、文件扩展名、路径名、URL 和用户输入。以下是一个示例：“使用`select()`函数等待网络数据。”

代码块设置如下：

```cpp
/* example program */

#include <stdio.h>
int main() {
    printf("Hello World!\n");
    return 0;
}
```

任何命令行输入或输出都写作如下：

```cpp
gcc hello.c -o hello
./hello
```

**粗体**：表示新术语、重要单词或您在屏幕上看到的单词。例如，菜单或对话框中的单词在文本中显示如下。以下是一个示例：“从管理面板中选择系统信息。”

# 联系我们

我们始终欢迎读者的反馈。

**一般反馈**：如果您对本书的任何方面有疑问，请在邮件主题中提及书名，并通过`customercare@packtpub.com`给我们发送邮件。

**勘误表**：尽管我们已经尽最大努力确保内容的准确性，但错误仍然可能发生。如果您在这本书中发现了错误，我们将非常感激您能向我们报告。请访问[www.packt.com/submit-errata](http://www.packt.com/submit-errata)，选择您的书籍，点击勘误提交表单链接，并输入详细信息。

**盗版**：如果您在互联网上以任何形式发现我们作品的非法副本，我们将非常感激您能提供位置地址或网站名称。请通过`copyright@packt.com`与我们联系，并提供材料的链接。

**如果您有兴趣成为作者**：如果您在某个领域有专业知识，并且您有兴趣撰写或为书籍做出贡献，请访问[authors.packtpub.com](http://authors.packtpub.com/)。

# 评论

请留下评论。一旦您阅读并使用过这本书，为何不在购买它的网站上留下评论呢？潜在的读者可以查看并使用您的客观意见来做出购买决定，我们 Packt 可以了解您对我们产品的看法，我们的作者也可以看到他们对书籍的反馈。谢谢！

如需了解更多关于 Packt 的信息，请访问[packt.com](http://www.packt.com/)。
