# 前言

LLVM 是近年来非常热门的话题之一。它是一个开源项目，拥有越来越多的贡献者。每个程序员在编程过程中都会遇到编译器。简单来说，编译器将高级语言转换为机器可执行代码。然而，在底层进行的是大量的复杂算法。因此，要开始学习编译器，LLVM 将是研究的最简单的基础设施。用面向对象的 C++编写，设计模块化，概念易于映射到理论，LLVM 对经验丰富的编译器程序员和愿意学习的新手学生都具有吸引力。

作为作者，我们坚持认为，简单的解决方案通常比复杂的解决方案更有效，也更易于理解。在整本书中，我们将探讨各种有助于提升你的技能并驱使你深入学习更多知识的话题。

我们还相信，这本书对那些不直接参与编译器开发的人也会有所帮助，因为编译器开发的知识将帮助他们编写更优化的代码。

# 本书涵盖内容

第一章, *玩转 LLVM*，介绍了 LLVM 的模块化设计和 LLVM 中间表示。在这一章中，我们还探讨了 LLVM 提供的一些工具。

第二章, *构建 LLVM IR*，介绍了 LLVM 基础设施提供的某些基本函数调用，用于构建 LLVM IR。本章演示了使用 LLVM API 构建模块、函数、基本块、条件语句和循环。

第三章, *高级 LLVM IR*，介绍了某些高级 IR 范式。本章向读者解释了高级 IR，并展示了如何使用 LLVM 函数调用在 IR 中生成它们。

第四章, *基本 IR 变换*，讨论了使用 LLVM 优化工具 opt 和 LLVM Pass 基础设施在 IR 级别进行的基本变换优化。你将学习如何在一个 Pass 中使用另一个 Pass 的信息，然后探讨指令简化与指令组合 Pass。

第五章, *高级 IR 块变换*，讨论了在 IR 块级别上的优化。我们将讨论各种优化，如循环优化、标量演化、向量化等，随后对本章进行总结。

第六章, *IR 到选择 DAG 阶段*，带您了解目标无关代码生成器的抽象基础设施。我们探讨了 LLVM IR 如何转换为选择 DAG 以及随后的各个阶段。它还介绍了指令选择、调度、寄存器分配等内容。

第七章, *为目标架构生成代码*，向读者介绍了 tablegen 概念。它展示了如何使用 tablegen 表示目标架构规范，例如寄存器集、指令集、调用约定等，以及如何使用 tablegen 的输出为特定架构生成代码。本章可以作为读者启动目标机器代码生成器的参考。

# 您需要本书的以下内容

完成本书中的大多数示例，您只需要一台 Linux 机器，最好是 Ubuntu。您还需要一个简单的文本或代码编辑器、互联网接入和浏览器。我们建议安装 meld 工具来比较两个文件；它在 Linux 平台上表现良好。

# 适用于本书的读者

本书旨在为那些已经了解一些编译器概念的人而写，希望他们能快速熟悉 LLVM 的基础设施和它提供的丰富库集。对于熟悉编译器概念并希望在他们的工作中以有意义的方式深入了解、探索和使用 LLVM 基础设施的编译器程序员来说，本书将是有用的。

本书也适用于那些虽然没有直接参与编译器项目，但经常参与编写数千行代码的开发阶段的程序员。了解编译器的工作原理后，他们将以最佳方式编码，并通过编写干净的代码来提高性能。

# 习惯用法

在本书中，您将找到许多文本样式，用于区分不同类型的信息。以下是一些这些样式的示例及其含义的解释。

文本中的代码单词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 昵称如下所示："LLVM `Pass Manager` 使用显式提到的依赖信息。"

代码块如下设置：

```cpp
int add(int a) {
return globvar + a;
}
```

当我们希望您注意代码块中的特定部分时，相关的行或项目将以粗体显示：

```cpp
 Value *StartVal = Builder.getInt32(1);
 Value *Res = createLoop(Builder, List, VL, StartVal, Arg2);

  Builder.CreateRet(Res);
```

任何命令行输入或输出如下所示：

```cpp
$ clang -emit-llvm -c -S add.c
$ cat add.ll

```

**新术语**和**重要词汇**以粗体显示。屏幕上看到的单词，例如在菜单或对话框中，在文本中如下所示："点击**下一步**按钮将您带到下一屏幕。"

### 注意

警告或重要注意事项如下所示。

### 小贴士

小技巧和窍门看起来是这样的。

# 读者反馈

我们始终欢迎读者的反馈。请告诉我们你对这本书的看法——你喜欢什么或不喜欢什么。读者的反馈对我们来说非常重要，因为它帮助我们开发出你真正能从中获得最大收益的书籍。

要发送一般性反馈，请简单地发送电子邮件到 `<feedback@packtpub.com>`，并在邮件的主题中提及书籍的标题。

如果你在一个你具有专业知识的主题上，并且你对撰写或为书籍做出贡献感兴趣，请参阅我们的作者指南，网址为 [www.packtpub.com/authors](http://www.packtpub.com/authors)。

# 客户支持

现在你已经是 Packt 书籍的骄傲拥有者，我们有许多事情可以帮助你从购买中获得最大收益。

## 下载示例代码

你可以从你购买的所有 Packt 出版物的账户中下载示例代码文件，网址为 [`www.packtpub.com`](http://www.packtpub.com)。如果你在其他地方购买了这本书，你可以访问 [`www.packtpub.com/support`](http://www.packtpub.com/support) 并注册，以便将文件直接发送给你。

## 错误清单

尽管我们已经尽一切努力确保我们内容的准确性，但错误仍然会发生。如果你在我们的书中发现错误——可能是文本或代码中的错误——如果你能向我们报告这一点，我们将不胜感激。这样做可以让你帮助其他读者避免挫败感，并帮助我们改进这本书的后续版本。如果你发现任何错误清单，请通过访问 [`www.packtpub.com/submit-errata`](http://www.packtpub.com/submit-errata)，选择你的书籍，点击**错误提交表单**链接，并输入你的错误详细信息来报告它们。一旦你的错误清单得到验证，你的提交将被接受，错误清单将被上传到我们的网站或添加到该标题的错误清单部分。

要查看之前提交的错误清单，请访问 [`www.packtpub.com/books/content/support`](https://www.packtpub.com/books/content/support)，并在搜索字段中输入书籍的名称。所需信息将出现在**错误清单**部分。

## 盗版

互联网上对版权材料的盗版是一个持续存在的问题，所有媒体都存在这个问题。在 Packt，我们非常重视我们版权和许可证的保护。如果你在互联网上发现任何形式的非法副本，请立即提供位置地址或网站名称，以便我们可以追究补救措施。

请通过 `<copyright@packtpub.com>` 联系我们，并提供涉嫌盗版材料的链接。

我们感谢你在保护我们的作者和为你提供有价值内容的能力方面提供的帮助。

## 问题

如果你对这本书的任何方面有问题，你可以通过 `<questions@packtpub.com>` 联系我们，我们将尽力解决问题。
