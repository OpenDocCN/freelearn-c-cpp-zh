# 前言

随着您的程序变得更大，了解如何编写代码，以便类和模块能够以智能的方式相互通信变得至关重要。知道如何编写干净且可扩展的代码对于中型到大型项目的成功至关重要，尤其是如果有多个程序员参与时。我们不希望花费时间重写其他程序员的代码，因为这比弄清楚原始代码的工作方式要容易。同样，我们也不希望其他程序员被我们的代码所困惑，并重写我们已经解决的问题的解决方案。

本书探讨了设计代码的常见方法，以便它能够被理解、重用、维护，并在必要时扩展。这些常见的模式将使类之间的通信变得简单和清晰。无论您是使用商业游戏引擎还是从头开始编写自己的引擎，了解这些模式都将使您的游戏项目更有可能成功。

本书每一章都探讨了游戏中最常用的设计模式之一。我们一起讨论我们试图解决的问题以及特定模式如何对我们有所帮助。在每一章中，我们还介绍了模式的优缺点，以便您更好地了解何时使用它。本书不是一本“食谱书”。在您的项目中使用模式并不像复制我们提供的代码那样简单。我们不是学习代码的食谱，而是要学习如何编写游戏引擎的基础知识。

我们将通过查看大量的代码示例来完成这项工作。正如我们所说，这些示例不能简单地复制粘贴到任何项目中。然而，通过理解这些示例如何适应本书的特定项目，您可以在任何项目中实现它们。

# 本书涵盖的内容

第一章，*设计模式简介*，介绍了设计模式的概念以及它们如何使我们的项目受益。我们还深入了解了代码模块化的优势，并设置了一个示例项目，我们可以在本书中在此基础上构建。

第二章，*一个实例统治一切 - 单例模式*，讨论了众所周知的单例模式，解释了在游戏中全局访问单个实例的常见论点和反对意见。

第三章，*使用组件对象模型创建灵活性*，探讨了如何创建大量不同的游戏对象类型，同时最大限度地减少代码重复。

第四章，*使用状态模式实现人工智能*，展示了如何使用状态来允许游戏对象根据你在游戏中的不同刺激改变其行为和功能。我们讨论并应用了如何将这一概念应用于玩家行为和人工智能。

第五章，*通过工厂方法模式解耦代码*，解释了如何将我们的特定游戏对象与游戏引擎分离。这将使我们能够重用游戏引擎的所有部分或至少部分，用于未来的游戏。

第六章，*使用原型模式创建对象*，介绍了另一种减少我们游戏引擎内部依赖的方法。我们学习如何通过它们的基类来创建对象。此外，我们还介绍了如何从文件中读取对象数据。

第七章，*通过对象池提高性能*，介绍了一种通过重用我们通过动态创建并使用管理器来控制当前使用与否的对象，从而降低我们游戏中内存成本的方法。

第八章，*通过命令模式控制 UI*，讨论了如何创建可重用的动作，这些动作可以用于 UI 按钮点击或键盘或控制器等输入设备。

第九章，*通过观察者模式解耦游戏玩法*，解释了类如何在不使用全局变量的情况下进行通信和共享数据的多重方式。

第十章，*使用享元模式共享对象*，讨论了如何通过分离可以和不可以共享的数据来设计尽可能轻量级的对象。我们利用这一知识创建了一个粒子系统，该系统产生用于模拟火焰、爆炸和烟雾等事物的小型对象。

第十一章，*理解图形和动画*，提供了对图形和渲染工作原理的低级解释，以便你更好地在你的游戏中实现它们。

第十二章，*最佳实践*，涵盖了一些将改善你未来代码和游戏项目的主题，涉及如何提高代码质量、正确使用 const 关键字、迭代如何是改善游戏和代码设计的好方法，以及何时应考虑将脚本添加到你的游戏中。

# 你需要这本书的内容

要编写代码，你实际上只需要一个文本编辑器，但为了进行严肃的开发，你需要使用集成开发环境（IDE）。在这本书中，我们使用 Windows 计算机上的 Microsoft Visual Studio 2015 和 C++，但所教授的概念也可以应用于任何编程语言。对于那些没有安装 Visual Studio 但使用 Windows 的用户，我们将在第一章“设计模式简介”中介绍如何安装免费的 Visual Studio Community 版本并将其与我们的项目设置好。

# 这本书面向的对象

这本书是为任何想要学习如何编写更好、更干净代码的人准备的。虽然设计模式通常不需要任何特定的编程语言，但本书中的示例是用 C++编写的。如果读者已经熟悉 C++和 STL 容器，他们将能从本书中获得更多收获。本书附带的项目是用 Microsoft Visual Studio 2015 编写的，因此熟悉该 IDE 将非常有帮助。

# 习惯用法

在这本书中，你会找到许多文本样式，用于区分不同类型的信息。以下是一些这些样式的示例及其含义的解释。

文本中的代码单词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 用户名如下所示：“我将更新`ChasePlayerComponent`类，该类已存在于`EngineTest`项目中。”

代码块以如下方式设置：

```cpp
class Animal
{
  public:
    virtual void Speak(void) const //virtual in the base class
    {
      //Using the Mach 5 console print
      M5DEBUG_PRINT("...\n");
    }
};

```

当我们希望引起你对代码块中特定部分的注意时，相关的行或项目将以粗体显示：

```cpp
class StaticExamples
{
  public:
    static float classVariable;

    static void StaticFunction()
    {
      // Note, can only use static variables and functions within 
 // static function
 std::string toDisplay = "\n I can be called anywhere! 
 classVariable value: " + 
 std::to_string(classVariable);

 printf(toDisplay.c_str());
    }

    void InFunction()
    {
      static int enemyCount = 0;

      // Increase the value of enemyCount
      enemyCount += 10;

      std::string toDisplay = "\n Value of enemyCount: " + 
      std::to_string(enemyCount);

      printf(toDisplay.c_str());
   }
};

```

**新术语**和**重要词汇**以粗体显示。你在屏幕上看到的单词，例如在菜单或对话框中，在文本中如下所示：“为了下载新模块，我们将前往文件 | 设置 | 项目名称 | 项目解释器。”

警告或重要提示以如下框中的形式出现。

技巧和窍门如下所示。

# 读者反馈

我们欢迎读者的反馈。告诉我们你对这本书的看法——你喜欢什么或不喜欢什么。读者反馈对我们来说很重要，因为它帮助我们开发出你真正能从中获得最大收益的标题。

要向我们发送一般反馈，只需发送电子邮件至`feedback@packtpub.com`，并在邮件主题中提及本书的标题。

如果你在一个主题上有所专长，并且你对撰写或为本书做出贡献感兴趣，请参阅我们的作者指南[www.packtpub.com/authors](http://www.packtpub.com/authors)。

# 客户支持

现在你已经是 Packt 图书的骄傲拥有者，我们有许多事情可以帮助你从购买中获得最大收益。

# 下载示例代码

您可以从[`www.packtpub.com`](http://www.packtpub.com)的账户下载本书的示例代码文件。如果您在其他地方购买了此书，您可以访问[`www.packtpub.com/support`](http://www.packtpub.com/support)并注册，以便将文件直接通过电子邮件发送给您。

您可以通过以下步骤下载代码文件：

1.  使用您的电子邮件地址和密码登录或注册我们的网站。

1.  将鼠标指针悬停在顶部的“支持”标签上。

1.  点击“代码下载和勘误”。

1.  在搜索框中输入书籍名称。

1.  选择您想要下载代码文件的书籍。

1.  从下拉菜单中选择您购买此书的来源。

1.  点击“代码下载”。

下载文件后，请确保您使用最新版本的以下软件解压缩或提取文件夹：

+   适用于 Windows 的 WinRAR / 7-Zip。

+   适用于 Mac 的 Zipeg / iZip / UnRarX。

+   适用于 Linux 的 7-Zip / PeaZip。

本书代码包也托管在 GitHub 上，网址为[`github.com/PacktPublishing/Game-Development-Patterns-and-Best-Practices`](https://github.com/PacktPublishing/Game-Development-Patterns-and-Best-Practices)。我们还有其他来自我们丰富图书和视频目录的代码包可供下载，网址为[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)。请查看它们！

# 下载本书的彩色图像

我们还为您提供了一个包含本书中使用的截图/图表彩色图像的 PDF 文件。彩色图像将帮助您更好地理解输出中的变化。您可以从[`www.packtpub.com/sites/default/files/downloads/GameDevelopmentPatternsandBestPractices_ColorImages.pdf`](https://www.packtpub.com/sites/default/files/downloads/GameDevelopmentPatternsandBestPractices_ColorImages.pdf)下载此文件。

# 勘误

尽管我们已经尽一切努力确保内容的准确性，但错误仍然可能发生。如果您在我们的书中发现错误——可能是文本或代码中的错误——如果您能向我们报告，我们将不胜感激。这样做可以帮助其他读者避免挫败感，并帮助我们改进本书的后续版本。如果您发现任何勘误，请通过访问[`www.packtpub.com/submit-errata`](http://www.packtpub.com/submit-errata)，选择您的书籍，点击勘误提交表单链接，并输入您的勘误详情来报告它们。一旦您的勘误得到验证，您的提交将被接受，勘误将被上传到我们的网站或添加到该标题的“勘误”部分下的现有勘误列表中。

要查看之前提交的勘误，请访问[`www.packtpub.com/books/content/support`](https://www.packtpub.com/books/content/support)，并在搜索字段中输入书籍名称。所需信息将出现在“勘误”部分下。

# 侵权

互联网上对版权材料的盗版是一个跨所有媒体的持续问题。在 Packt，我们非常重视保护我们的版权和许可证。如果您在互联网上发现任何形式的我们作品的非法副本，请立即提供位置地址或网站名称，以便我们可以寻求补救措施。

请通过`copyright@packtpub.com`与我们联系，并提供疑似盗版材料的链接。

我们感谢您在保护我们的作者和我们为您提供有价值内容的能力方面的帮助。

# 问题

如果您在这本书的任何方面遇到问题，您可以联系我们的`questions@packtpub.com`，我们将尽力解决问题。
