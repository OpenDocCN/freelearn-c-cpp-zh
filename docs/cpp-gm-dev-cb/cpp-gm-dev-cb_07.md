# 第七章：组织和备份

在本章中，将涵盖以下内容：

+   版本控制

+   安装一个版本控制客户端

+   选择一个主机来保存您的数据

+   为您的代码添加源代码控制-提交和更新您的代码

+   解决冲突

+   创建一个分支

# 介绍

假设我们需要在一个有很多开发人员的项目上工作。如果每个开发人员都在不同的源文件上工作，一种（相当可怕的）工作方式是通过电子邮件或 FTP 客户端获取新更新的源文件，并将其替换到您的项目中。现在如果开发人员，包括您自己，都在同一个源文件上工作。我们仍然可以遵循这种可怕的方式，并将我们已经工作过的部分添加到我们通过 FTP 收到的文件中，但很快这将变得非常繁琐，几乎不可能工作。因此，我们有一个将文件保存到某个中央仓库或分布式仓库的系统，然后有手段更新和发送代码，以便每个开发人员都使用最新的副本。有各种各样的方法来执行这个操作，通常被称为对代码进行版本控制。

# 版本控制

修订控制是跨开发人员共享文件的一种非常有效的方式。有各种版本控制系统，每种系统都有其优点和缺点。我们将看看目前最流行的三种版本控制系统。

## 准备工作

要完成这个教程，您需要一台运行 Windows 的计算机。不需要其他先决条件。

## 如何做...

在这个教程中，我们将看到可用于我们的不同类型的源代码控制：

1.  转到此链接并下载一个 SVN 客户端：[`tortoisesvn.net/downloads.html`](http://tortoisesvn.net/downloads.html)

1.  转到此链接并下载 GIT 客户端：[`desktop.github.com`](https://desktop.github.com)

1.  转到此链接并下载一个 Mercurial 客户端：[`tortoisehg.bitbucket.org/download/index.html`](http://tortoisehg.bitbucket.org/download/index.html)

## 它是如何工作的...

有各种类型的 SVN 客户端可供我们使用。每种都有其优点和缺点。

SVN 具有许多功能，可以解决与原子操作和源文件损坏相关的问题。它是免费和开源的。它有许多不同 IDE 的插件。然而，这个工具的一个主要缺点是它在操作中相对非常慢。

GIT 主要是为 Linux 而设计的，但它大大提高了操作速度。它也可以在 UNIX 系统上运行。它具有廉价的分支操作，但与 Linux 相比，它对单个开发人员的 Windows 支持有限。然而，GIT 非常受欢迎，许多人更喜欢 GIT 而不是 SVN。

# 安装一个版本控制客户端

有很多版本控制客户端。然而，我们将看看一个 SVN 客户端。Tortoise SVN 是迄今为止最受 SVN 用户欢迎的。尽管 GIT 是另一个非常受欢迎的系统，但我们将在这个教程中看看 Tortoise SVN。Tortoise SVN 提供了一个非常友好和直观的界面，因此即使是初学者也很容易掌握。在几个小时内，一个完全的新手就可以理解使用 Tortoise SVN 的基础知识。

## 准备工作

您需要一台 Windows 机器。不需要其他先决条件。

## 如何做...

在这个教程中，我们将发现安装和使用 Tortoise SVN 有多么容易：

1.  转到此链接：[`tortoisesvn.net/downloads.html`](http://tortoisesvn.net/downloads.html)

1.  根据您使用的是 32 位还是 64 位 Windows 机器，下载并安装正确的版本。

1.  在您的计算机上创建一个新文件夹。

1.  右键单击文件夹。

1.  检查一个名为**SVN Checkout…**的新命令现在可以使用。

## 它是如何工作的...

在我们转到下载站点并安装软件包后，它将安装在系统上，并添加了许多 shell 和内核命令。因此，当我们右键单击文件夹时，“**SVN Checkout…**”命令现在被添加为任何新文件夹的属性。还有另一个名为**Tortoise SVN**的命令可供我们使用，它还有更多命令。在我们检出项目后，“**SVN Checkout…**”将被替换为**SVN Update**或**SVN Commit**。我们只需要确保根据我们使用的操作系统版本向计算机添加了正确的安装程序。

# 选择托管数据的主机

在我们开始对我们的代码进行版本控制之前，我们需要决定将代码文件保存到哪里。有很多种方法可以做到这一点，但我们将讨论两种最流行的方法。第一种方法是将文件保存在本地，并将个人计算机视为托管数据的服务器。第二种方法是使用云服务来为我们托管数据文件。

## 准备工作

您需要一个可用的 Windows 计算机。

## 如何做...

在这个教程中，我们将了解如何轻松地在本地或云端托管文件。

对于保存在云端的文件，请按照以下步骤操作：

1.  转到以下链接：[`xp-dev.com`](https://xp-dev.com)。

1.  转到**计划**并选择最适合您需求的计划。还有一个免费的 10MB 计划。

1.  选择计划后，您将被重定向以为当前项目创建名称。

1.  新项目现在将显示在仪表板上。您可以根据您的计划创建多个项目。

1.  单击一个项目。这应该打开更多选项卡。目前最重要的是：

+   **存储库**

+   **项目跟踪**

+   **活动**

+   **设置**

1.  单击**存储库**以创建一个新的存储库。

1.  生成的链接现在可以用于对项目中的文件进行版本控制。

1.  要向项目添加用户，请单击**设置**并邀请用户加入项目。

对于保存在本地服务器上的文件：

1.  将新项目或空项目保存在您的计算机上。

1.  从这里下载**Visual SVN Server**：[`www.visualsvn.com/server/`](https://www.visualsvn.com/server/)。

1.  安装软件。

1.  然后从现有项目创建一个项目。

1.  您的项目现在已准备好进行版本控制。

1.  要添加用户，请单击**用户**并添加用户名和密码。

## 它是如何工作的...

当我们在`xp-dev`上创建项目时，实际上是`xp-dev`根据我们选择的计划在其服务器上为我们创建了一个云空间。之后，对于文件的每次迭代，它都会在服务器上保存一个副本。在仪表板上，一旦我们创建一个存储库，我们就可以创建一个新的存储库，生成的 URL 现在将是项目的 URL。通过这种方式，我们可以恢复到任何迭代或恢复文件，如果我们误删了它。当我们提交文件时，文件的新副本现在保存在服务器上。当我们更新项目时，服务器上的最新版本现在被推送到您的本地计算机。通过这种方式，`xp-dev`保存了所有更新和提交的整个活动历史。系统的缺点是，如果`xp-dev`客户端关闭，那么所有云服务也将关闭。因此，由于您无法进行任何更新或提交，项目将会受到影响。

托管的另一种方法是使用您自己的本地计算机。Visual SVN Server 基本上将您的计算机变成了服务器。之后，该过程与`xp-dev`处理所有更新和提交的方式非常相似。

我们还可以从亚马逊或 Azure 那里获取一些空间，并将该空间用作服务器。在这种情况下，步骤与第二种方法（本地服务器）非常相似。登录到亚马逊空间或 Azure 空间后，将其视为您的计算机，然后重复本地服务器的步骤。

# 添加源代码控制-提交和更新您的代码。

在协作项目或个人工作时，您可以对文件执行的最重要的操作之一是添加源代码控制。这样做的最大优势是文件始终有备份和版本控制。假设您进行了一些本地更改，并且发生了许多崩溃。由于这些崩溃，您将怎么做？一种选择是追溯您的步骤并将它们改回以前的状态。这是一个浪费时间的过程，也存在风险。如果您的文件有备份，您只需要对特定的修订执行还原操作，代码就会恢复到那一点。同样，如果我们错误地删除了一个文件，我们总是可以更新项目，它将从服务器中拉取最新的文件。

## 准备工作

对于这个教程，您将需要一台 Windows 机器和安装了 SVN 客户端的版本。数据托管服务现在应该已经集成，并且您应该有一个 URL。不需要其他先决条件。

## 如何做...

在这个教程中，我们将找出添加源代码控制有多么容易：

1.  在机器上创建一个新文件夹。

1.  将其重命名为您想要的任何名称。

1.  右键单击并检查 SVN 命令是否显示为其中一个选项。

1.  单击**SVN Checkout**。使用您从`xp-dev`或您的本地服务器或云服务器收到的 URL。

1.  将文件添加到新文件夹中。它可以是任何格式。

1.  右键单击文件，然后选择**Tortoise SVN** | **添加**。

1.  转到根文件夹，然后选择**SVN** | **提交**。

1.  删除文件。

1.  转到**SVN** | **更新**。

1.  对文件进行一些更改。

1.  选择**SVN** | **提交**。

1.  然后选择**Tortoise SVN**，然后**还原到此修订版**（修订版`1`）。

## 它是如何工作的...

SVN 检出成功后，项目要么从本地机器复制到服务器，要么从服务器复制到本地机器，具体取决于哪个是最新的。一旦我们将文件添加到文件夹中，我们必须记住文件仍然是本地的。只有我们可以看到它并访问它。正在处理该项目的其他人将对此一无所知。现在，一个新程序员在这个阶段可能犯的一个常见错误是忘记将文件添加到 SVN。当您提交项目时，该文件将不会显示。在提交部分有一个**显示未版本化文件**的复选框。但是，我不建议这种方法，因为在这种情况下，所有临时文件也将显示出来。一个更好的方法是右键单击文件，然后转到**Tortoise SVN** | **添加**。这将为修订添加文件。现在我们可以进行 SVN 提交，文件将存储在服务器上。

当我们删除文件时，我们必须记住我们只是在本地删除了文件。它仍然存在于服务器上。因此，当我们执行 SVN 更新时，文件将再次被恢复。我们必须小心不要执行**Tortoise SVN** | **删除和提交**。这将从服务器中删除该修订版的文件。现在，如果我们对文件进行一些更改，我们可以**SVN 提交**它。我们不再需要选择**Tortoise SVN** | **添加**。这将在服务器上创建文件的新版本。现在两个版本的文件都存在。我们可以拥有任意数量的版本。要访问任何修订版，我们需要选择根文件夹或任何特定文件，然后执行**还原到此修订版**（编号）。服务器然后查找我们请求的版本，并将正确的副本推送给我们。

# 解决冲突

让我们考虑一个由多个程序员共同处理的单个源文件。您可能有一些本地更改。当您尝试更新时，可能会发生 SVN 客户端足够智能地将文件合并在一起。但是，在大多数情况下，它将无法正确合并，我们需要有效地解决冲突。但是，SVN 客户端将显示冲突的文件。

## 准备工作

对于这个教程，您需要一台 Windows 机器和安装了 SVN 客户端的版本。还需要一个版本化的项目。

## 如何做...

在这个教程中，我们将发现解决冲突有多容易：

1.  拿一个已经版本化并提交到 SVN 的项目。

1.  在编辑器中打开文件并对文件进行更改。

1.  执行**SVN 更新**操作。

1.  文件现在显示冲突。

1.  使用**Diff 工具**或**Win Merge**查看两个文件之间的差异（您可能需要单独安装 Win Merge）。

1.  通常，左侧将是本地修订版本，右侧将是服务器上的版本。但是，这些也可以互换。

1.  查看差异后，您可以以两种方式解决冲突：

+   选择你想要从服务器和本地更改中选择的部分。

+   选择**使用“我的”解决冲突**或选择**使用“他们的”解决冲突**。

## 它是如何工作的...

冲突发生时，客户端无法决定本地副本还是服务器副本应该被视为正确的工作版本。大多数良好的客户端在更新后会显示这个错误。其他客户端会在代码中插入两个部分，通常用`r>>>>>`或`m>>>>`标记，表示哪一部分是服务器的，哪一部分是我们的。在 Tortoise SVN 上，如果我们选择忽略冲突，那么这些标记可能会显示为单独的文件或包含在文件中。更好的方法是始终解决冲突。如果我们使用诸如 Win Merge 之类的工具，它会将两个修订版本并排显示，我们可以比较并选择我们需要的部分，或整个文件。之后，一旦我们接受了更改并提交了它们，该文件将成为服务器上的更新版本。因此，更新他们的代码的其他人也会得到我们所做的更改。

# 创建一个分支

让我们假设我们正在制作一款游戏，该游戏计划在年底发布。然而，我们还需要展示一个经过精心打磨的版本供 GDC 或 E3 展示。此时，制作人可能会要求我们制作一个特定于 E3 或 GDC 的版本。这个 GDC 或 E3 版本可以被打磨并稳定下来，而主要版本可能会继续通过添加新功能进行实验。

## 准备工作

要完成本教程，您需要一台运行 Windows 的机器，并安装了 SVN 客户端的版本。还需要一个版本化的项目。不需要其他先决条件。

## 如何做...

在这个教程中，我们将发现创建一个分支有多容易：

1.  右键单击版本化项目。

1.  转到仓库浏览器。

1.  选择要创建分支的根文件夹。

1.  选择目的地。

1.  现在创建了一个分支。

1.  通过使用 URL 在机器上检出创建的分支。

## 它是如何工作的...

当我们从根文件夹创建一个分支时，会创建该文件夹及其后续子文件夹的镜像副本。从那时起，这两者可以独立工作。主根有一个 URL，分支也有自己的 URL。我们可以像为根文件夹一样更新和提交到分支。此外，所有其他功能对分支也是可用的。有时，在我们对分支进行更改后，我们可能需要将它们推回到根目录。虽然 SVN 客户端 Tortoise SVN 为我们提供了一个合并分支的工具，但它很少成功，往往我们需要手动进行合并。
