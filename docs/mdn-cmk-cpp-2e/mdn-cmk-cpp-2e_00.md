# 序言

创建一流的软件并非易事。开发人员在网上研究这个话题时，经常难以判断哪些建议是最新的，哪些方法已经被更新、更好的实践所取代。此外，大多数资源以混乱的方式解释过程，缺乏适当的背景、上下文和结构。

*现代 CMake for C++* 提供了一个端到端的指南，通过全面处理 C++ 解决方案的构建，提供了更简便的体验。它不仅教你如何在项目中使用 CMake，还突出展示了使项目保持可维护、优雅和清晰的要素。该指南将帮助你自动化许多项目中常见的复杂任务，包括构建、测试和打包。

本书指导你如何组织源目录、构建目标以及创建包。在进阶过程中，你将学会如何编译和链接可执行文件和库，详细了解这些过程，并优化每个步骤以获得最佳结果。此外，你将学会如何将外部依赖项（如第三方库、测试框架、程序分析工具和文档生成工具）集成到项目中。最后，你将学习如何导出、安装和打包你的解决方案，以供内部和外部使用。

完成本书后，你将能够在专业层面上自信地使用 CMake。

# 本书适合的读者

当你学会了 C++ 后，你会很快发现，仅仅精通语言本身并不足以使你准备好交付最高标准的项目。本书弥补了这一空白：它面向任何希望成为更好的软件开发人员，甚至是专业构建工程师的人！

阅读本书，如果你想从零开始学习现代 CMake，或提升和刷新你当前的 CMake 技能。它将帮助你理解如何制作一流的 C++ 项目，并从其他构建环境过渡过来。

# 本书内容

*第一章*，*CMake 入门*，涵盖了 CMake 的安装、命令行界面的使用，并介绍了 CMake 项目所需的基本构建块。

*第二章*，*CMake 语言*，涵盖了 CMake 语言的基本概念，包括命令调用、参数、变量、控制结构和注释。

*第三章*，*在流行 IDE 中使用 CMake*，强调了**集成开发环境**（**IDE**）的重要性，指导你选择合适的 IDE，并提供 Clion、Visual Studio Code 和 Visual Studio IDE 的设置说明。

*第四章*，*设置你的第一个 CMake 项目*，将教你如何在 CMake 项目的顶级文件中进行配置，结构化文件树，并为开发准备必要的工具链。

*第五章*，*与目标一起工作*，探讨了逻辑构建目标的概念，理解它们的属性和不同类型，并学习如何为 CMake 项目定义自定义命令。

*第六章*，*使用生成器表达式*，解释了生成器表达式的目的和语法，包括如何用于条件扩展、查询和转换。

*第七章*，*使用 CMake 编译 C++ 源代码*，深入探讨编译过程，配置预处理器和优化器，并发现减少构建时间和改善调试的技巧。

*第八章*，*链接可执行文件和库*，了解链接机制、不同类型的库、唯一定义规则、链接顺序，以及如何为测试准备项目。

*第九章*，*在 CMake 中管理依赖关系*，将教你如何管理第三方库，如何为那些缺乏支持的库添加 CMake 支持，并从互联网获取外部依赖项。

*第十章*，*使用 C++20 模块*，介绍了 C++20 模块，展示如何在 CMake 中启用其支持，并相应地配置工具链。

*第十一章*，*测试框架*，将帮助你理解自动化测试的重要性，利用 CMake 中内置的测试支持，并使用流行框架开始单元测试。

*第十二章*，*程序分析工具*，将展示如何在构建时和运行时自动格式化源代码并检测软件错误。

*第十三章*，*生成文档*，介绍了如何使用 Doxygen 从源代码自动生成文档，并添加样式以增强文档的外观。

*第十四章*，*安装和打包*，为你的项目准备发布，无论是否进行安装，创建可重用的包，并指定单个组件进行打包。

*第十五章*，*创建你的专业项目*，将本书中获得的所有知识应用于开发一个全面的、专业级别的项目。

*第十六章*，*编写 CMake 预设*，将高级项目配置封装到使用 CMake 预设文件的工作流中，使项目设置和管理更高效。

*附录* - *杂项命令*，作为参考，提供与字符串、列表、文件和数学运算相关的各种 CMake 命令。

# 为了充分利用本书的内容

本书假设读者对 C++ 和类 Unix 系统有基本的了解。尽管 Unix 知识不是严格要求，但它会对充分理解本书中的示例有所帮助。

本书针对 CMake 3.26，但大多数技术应该在 CMake 3.15 版本及以上都能使用（新增加的功能通常会突出显示）。一些章节已更新至 CMake 3.28，以涵盖最新的功能。

示例运行环境的准备在*第 1-3 章*中涵盖，但我们特别建议，如果你熟悉 Docker 工具，可以使用本书提供的 Docker 镜像。

## 下载示例代码文件

本书的代码包托管在 GitHub 上，地址为[`github.com/PacktPublishing/Modern-CMake-for-Cpp-2E`](https://github.com/PacktPublishing/Modern-CMake-for-Cpp-2E)。我们还提供了其他来自我们丰富书籍和视频目录的代码包，您可以在[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)查看。快来看看吧！

## 下载彩色图像

我们还提供了一个 PDF 文件，其中包含本书中使用的截图/图表的彩色图像。您可以在此下载：[`packt.link/gbp/9781805121800`](https://packt.link/gbp/9781805121800)。

## 使用的约定

本书中使用了多种文本约定。

`CodeInText`：表示文本中的代码字、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 账户。例如：“将下载的`WebStorm-10*.dmg`磁盘镜像文件挂载为系统中的另一个磁盘。”

代码块设置如下：

```cpp
cmake_minimum_required(VERSION 3.26)
project(Hello)
add_executable(Hello hello.cpp) 
```

当我们希望特别提醒您关注代码块中的某部分时，相关的行或项目将设置为粗体：

```cpp
cmake_minimum_required(VERSION 3.26)
project(Hello)
add_executable(Hello hello.cpp)
**add_subdirectory****(api)** 
```

任何命令行输入或输出以以下方式编写：

```cpp
cmake --build <dir> --parallel [<number-of-jobs>]
cmake --build <dir> -j [<number-of-jobs>] 
```

**粗体**：表示新术语、重要单词或屏幕上显示的单词。例如：“从**管理**面板中选择**系统信息**。”

警告或重要注释以如下方式显示。

提示和技巧以如下方式显示。

# 联系我们

我们始终欢迎读者的反馈。

**一般反馈**：请发送电子邮件至`feedback@packtpub.com`，并在邮件主题中注明书名。如果您有关于本书的任何问题，请通过`questions@packtpub.com`与我们联系。

**勘误表**：虽然我们已尽一切努力确保内容的准确性，但错误仍然可能发生。如果您在本书中发现任何错误，我们将非常感激您能向我们报告。请访问，[`www.packtpub.com/submit-errata`](http://www.packtpub.com/submit-errata)，选择您的书籍，点击“勘误提交表单”链接，并输入详细信息。

**盗版**：如果你在互联网上发现任何我们作品的非法复制品，任何形式的，我们将非常感激您能提供该位置地址或网站名称。请通过电子邮件`copyright@packtpub.com`与我们联系，并附上相关材料的链接。

**如果您有兴趣成为作者**：如果您在某个领域具有专业知识，并且有兴趣写作或为书籍贡献内容，请访问[`authors.packtpub.com`](http://authors.packtpub.com)。

# 分享您的想法

一旦您阅读了*现代 CMake for C++*，*第二版*，我们很想听听您的想法！请[点击这里直接访问亚马逊的书评页面](https://www.packtpub.com/)并分享您的反馈。

您的评论对我们和技术社区非常重要，帮助我们确保提供高质量的内容。

# 下载本书的免费 PDF 副本

感谢您购买本书！

你喜欢随时随地阅读，但又不能把印刷版书籍带在身边吗？

你的电子书购买是否无法在你选择的设备上使用？

不用担心，现在购买每本 Packt 图书，你都可以免费获得该图书的 DRM-free PDF 版本。

在任何地方、任何设备上阅读。直接从你最喜欢的技术书籍中搜索、复制并粘贴代码到你的应用程序中。

优惠不止这些，你还可以获得独家折扣、新闻通讯以及每日发送到邮箱的精彩免费内容。

按照以下简单步骤获取这些福利：

1.  扫描二维码或访问下面的链接：

![](img/B19844_Free_PDF_QR.png)

https://packt.link/free-ebook/9781805121800

1.  提交你的购买凭证。

1.  就这样！我们会将你的免费 PDF 和其他福利直接发送到你的电子邮件。
