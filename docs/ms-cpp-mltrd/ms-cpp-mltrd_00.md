# 前言

多线程应用程序在单处理器环境中执行多个线程，以实现。本书充满了实际示例，将帮助您成为在 C++中编写健壮的并发和并行应用程序的专家。在本书中，您将深入了解多线程和并发的基础知识，并了解如何实现它们。在此过程中，您将探索原子操作以优化代码性能，并将并发应用于分布式计算和 GPGPU 处理。

# 本书涵盖的内容

第一章《重新审视多线程》总结了 C++中的多线程，重新审视了您应该已经熟悉的所有概念，并通过使用 C++ 2011 修订版中添加的本机线程支持进行了多线程的基本示例。

第二章《处理器和操作系统上的多线程实现》在前一章讨论的硬件实现提供的基础上构建，展示了操作系统如何利用这些功能并使其可用于应用程序。它还讨论了进程和线程如何允许使用内存和处理器，以防止应用程序和线程相互干扰。

第三章《C++多线程 API》探讨了各种多线程 API，这些 API 可以作为操作系统级 API（例如 Win32 和 POSIX）提供，也可以作为框架（例如 Boost、Qt 和 POCO）提供。它简要介绍了每个 API，列出了与其他 API 相比的差异，以及它可能对您的应用程序具有的优势和劣势。

第四章《线程同步和通信》将前几章学到的主题，探讨了使用 C++ 14 的本机线程 API 实现的高级多线程实现，允许多个线程在没有任何线程安全问题的情况下进行通信。它还涵盖了许多类型的同步机制之间的区别，包括互斥锁、锁和条件变量。

第五章《本机 C++线程和原语》包括线程、并发、本地存储，以及该 API 支持的线程安全性。在前一章的示例基础上，它讨论并探讨了如何使用 C++ 11 和 C++ 14 提供的完整功能集来扩展和优化线程安全性。

第六章《调试多线程代码》教会您如何使用诸如 Valgrind（Memcheck、DRD、Helgrind 等）之类的工具来分析应用程序的多线程性能，找到热点，并解决或预防由并发访问导致的问题。

第七章《最佳实践》涵盖了常见的陷阱和注意事项，以及如何在它们回来困扰你之前发现它们。它还通过示例探讨了许多常见和不太常见的场景。

第八章《原子操作-与硬件一起工作》详细介绍了原子操作：它们是什么以及如何最好地使用它们。评估了跨 CPU 架构的编译器支持，并评估了在代码中实现原子操作是否值得投入时间。它还探讨了这种优化如何限制代码的可移植性。

第九章，*使用分布式计算进行多线程*，汲取了前几章的教训，并将它们应用到多系统、集群级别的规模上。使用基于 OpenMPI 的示例，它展示了如何在多个系统上进行多线程处理，比如计算机集群中的节点。

第十章，*使用 GPGPU 进行多线程*，展示了在 GPGPU 应用程序中使用多线程的情况（例如，CUDA 和 OpenCL）。使用基于 OpenCL 的示例，探讨了一个基本的多线程应用程序，可以并行执行任务。本章汲取了前几章的教训，并将其应用于视频卡和衍生硬件（例如，机架式矢量处理器硬件）上的处理。

# 您需要什么

要按照本书中的说明，您需要在系统上安装任何操作系统（Windows、Linux 或 macOS）和任何 C++编译器。

# 本书适用对象

本书适用于希望扩展多线程和并发处理知识的中级 C++开发人员。您应该具有多线程的基本经验，并且能够在命令行上使用 C++开发工具链。

# 约定

在这本书中，您将找到许多文本样式，用于区分不同类型的信息。以下是这些样式的一些示例以及它们的含义解释。

文本中的代码单词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 句柄显示如下：“`randGen()`方法接受两个参数，定义返回值的范围：”

代码块设置如下：

```cpp
cout_mtx.lock();
 cout << "Thread " << tid << " adding " << rval << ". New value: " << val << ".\n";
 cout_mtx.unlock();

 values_mtx.lock();
 values.push_back(val);
 values_mtx.unlock();
}

```

当我们希望引起您对代码块的特定部分的注意时，相关行或项目将以粗体显示：

```cpp
cout_mtx.lock();
 cout << "Thread " << tid << " adding " << rval << ". New value: " << val << ".\n";
 cout_mtx.unlock();

 values_mtx.lock();
 values.push_back(val);
 values_mtx.unlock();
}

```

任何命令行输入或输出都以以下方式编写：

```cpp
$ make
g++ -o ch01_mt_example -std=c++11 ch01_mt_example.cpp

```

新术语和重要单词以粗体显示。例如，屏幕上看到的单词，比如菜单或对话框中的单词，会出现在文本中。

警告或重要说明会出现在这样的地方。

提示和技巧会出现在这样的地方。

# 读者反馈

我们一直欢迎读者的反馈。请告诉我们您对本书的看法-您喜欢或不喜欢的地方。读者的反馈对我们很重要，因为它有助于我们开发您真正能够从中获益的标题。要向我们发送一般反馈，只需发送电子邮件至`feedback@packtpub.com`，并在消息主题中提及书名。如果您在某个专题上有专业知识，并且有兴趣撰写或为书籍做出贡献，请参阅我们的作者指南[www.packtpub.com/authors](http://www.packtpub.com/authors)。

# 下载示例代码

您可以从[`www.packtpub.com`](http://www.packtpub.com)的帐户中下载本书的示例代码文件。如果您在其他地方购买了本书，您可以访问[`www.packtpub.com/support`](http://www.packtpub.com/support)并注册，以便直接通过电子邮件接收文件。您可以按照以下步骤下载代码文件：

1.  使用您的电子邮件地址和密码登录或注册我们的网站。

1.  将鼠标指针悬停在顶部的“支持”选项卡上。

1.  单击“代码下载和勘误”。

1.  在搜索框中输入书名。

1.  选择您要下载代码文件的书籍。

1.  从下拉菜单中选择您购买本书的地点。

1.  单击“代码下载”。

下载文件后，请确保使用以下最新版本的软件解压缩或提取文件夹：

+   Windows 的 WinRAR / 7-Zip

+   Mac 上的 Zipeg / iZip / UnRarX

+   Linux 的 7-Zip / PeaZip

该书的代码包也托管在 GitHub 上，网址为[`github.com/PacktPublishing/Mastering-CPP-Multithreading`](https://github.com/PacktPublishing/Mastering-CPP-Multithreading)。我们还有其他代码包来自我们丰富的图书和视频目录，可在[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)找到。去看看吧！

# 勘误

尽管我们已经尽一切努力确保内容的准确性，但错误还是会发生。如果您在我们的书中发现错误，也许是文本或代码中的错误，我们将不胜感激，如果您能向我们报告。通过这样做，您可以帮助其他读者避免挫折，并帮助我们改进本书的后续版本。如果您发现任何勘误，请访问[`www.packtpub.com/submit-errata`](http://www.packtpub.com/submit-errata)报告，选择您的书，点击勘误提交表格链接，并输入您的勘误详情。一旦您的勘误经过验证，您的提交将被接受，并且勘误将被上传到我们的网站或添加到该书标题的勘误部分的任何现有勘误列表中。要查看先前提交的勘误，请访问[`www.packtpub.com/books/content/support`](https://www.packtpub.com/books/content/support)，并在搜索框中输入书名。所需信息将出现在勘误部分下方。

# 盗版

互联网上的盗版行为是跨所有媒体持续存在的问题。在 Packt，我们非常重视版权和许可的保护。如果您在互联网上发现我们作品的任何非法副本，请立即向我们提供位置地址或网站名称，以便我们采取补救措施。请通过`copyright@packtpub.com`与我们联系，并附上涉嫌盗版材料的链接。我们感谢您帮助保护我们的作者和我们为您提供有价值内容的能力。

# 问题

如果您对本书的任何方面有问题，可以通过`questions@packtpub.com`与我们联系，我们将尽力解决问题。
