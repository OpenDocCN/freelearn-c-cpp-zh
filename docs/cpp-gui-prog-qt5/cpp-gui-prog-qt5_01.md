# 第一章：介绍 Qt

Qt（发音为可爱）自从首次发布以来，已经被软件工程师和开发人员使用了二十多年，用于创建跨平台应用程序。经过多次所有权变更和大量的重大代码改进，Qt 变得更加功能丰富，支持的平台也比以前更多。Qt 不仅在桌面应用程序开发方面表现出色，而且在移动和嵌入式系统开发方面也非常出色。

在本章中，我们将涵盖以下主题：

+   什么是 Qt？

+   为什么使用 Qt？

+   在 Qt 中使用工具

+   下载和安装 Qt

+   建立工作环境

+   运行我们的第一个`Hello World`Qt 程序

在本章中，我们将更多地了解 Qt 的历史。然后，我们将继续使用 Qt 的最新版本构建我们的第一个示例程序，该版本是 Qt 5 版。为了方便我们的读者，我们将在整本书中简称为 Qt。

# 什么是 Qt？

目前，Qt 的最新版本（本书撰写时）是版本 5.10。这个版本包含了许多新功能以及成千上万的错误修复，使 Qt 成为软件开发人员和系统工程师的强大稳定的开发工具包。Qt 有一个庞大的 SDK（软件开发工具包），包含了各种工具和库，帮助开发人员完成工作，而不用太担心特定平台的技术问题。Qt 在幕后处理所有混乱的集成和兼容性问题，这样你就不必处理它们。这不仅提高了效率，还降低了开发成本，特别是当您尝试开发迎合更广泛用户群的跨平台应用程序时。

Qt 有两种许可证：

+   第一种是开源许可证，免费，但只有在您的项目/产品符合其条款和条件时才免费。例如，如果您对 Qt 的源代码进行了任何更改，您有义务将这些更改提交给 Qt 开发人员。不这样做可能会导致严重的法律问题，因此您可能希望选择第二个选项。

+   第二种许可证是商业许可证，它给予您对专有 Qt 源代码修改的全部权利，并保持您的应用程序私有。但当然，这些特权是需要付费的。

如果你刚开始学习 Qt，不要被这些术语吓倒，因为你肯定不会修改 Qt 库的源代码，也不会重新编译它，至少现在不会。

有关 Qt 许可的更多信息，请访问[`www.qt.io/licensing-comparison.`](https://www.qt.io/licensing-comparison)

# 为什么使用 Qt？

不难看出为什么 Qt 有机会在市场上击败所有其他现有的 SDK；首先是跨平台兼容性。几乎找不到其他开发工具包支持这么多平台而不需要为每个平台编写不同的代码。通过消除这些额外的步骤，程序员可以专注于开发他们的应用程序，而不需要担心每个平台特定功能的实现。此外，您的代码将看起来干净，没有所有的`#ifdef`宏和需要为不同平台加载不同的依赖项。

Qt 通常使用 C++，这是一种生成小型高效代码的编译语言。它也有很好的文档，并遵循一套非常一致的命名约定，这减少了开发人员的学习曲线。

请注意，Qt 确实包含一小部分仅适用于特定平台的功能。但是，这些功能很少，通常用于特殊用例，例如仅在移动平台上工作的 Qt 传感器，仅在桌面上工作的 Qt Web Engine，仅适用于 Android 和 Linux 的 Qt NFC 等。这些都是一些非常特定的功能，只存在于支持它们的特定平台上。除此之外，通常所有平台都支持常见功能。

# Qt Designer

Qt Designer 通常由开发人员用于设计桌面应用程序的 GUI，而 Qt Quick Designer 通常用于移动和嵌入式平台。话虽如此，两种格式在桌面和移动格式上都可以正常运行，唯一的区别是外观和所使用的语言类型。

Qt Designer 保存的 GUI 文件具有`.ui`扩展名，保存为 XML 格式。该文件存储了 GUI 设计人员放置的每个小部件的属性，例如位置、大小、边距、工具提示、布局方向等。它还在文件内部保存了信号和槽事件名称，以便在后期轻松连接代码。该格式不支持编码，仅适用于 Qt C++项目，即基于小部件的应用程序项目。

# Qt Quick Designer

另一方面，Qt Quick Designer 以`.ui.qml`和`.qml`格式保存 GUI 文件。从技术概念和开发方法来看，Qt Quick 是一种非常不同的 GUI 系统，我们将在第十四章《Qt Quick 和 QML》中进行介绍。Qt Quick Designer 保存其数据的格式不是 XML，而是一种类似 JavaScript 的声明性语言称为**QML**。QML 不仅允许设计人员以类似于 CSS（层叠样式表）的方式自定义他们的 GUI，还允许程序员在 QML 文件中编写功能性 JavaScript。正如我们之前提到的，`.ui.qml`是仅用于视觉装饰的文件格式，而`.qml`包含应用程序逻辑。

如果您正在使用 Qt Quick 编写简单的程序，您根本不需要接触任何 C++编码。这对 Web 开发人员来说尤其受欢迎，因为他们可以立即开始使用 Qt Quick 开发自己的应用程序，无需经历陡峭的学习曲线；一切对他们来说都是如此熟悉。对于更复杂的软件，您甚至可以在 QML 中链接 C++函数，反之亦然。同样，如果您对 Qt Quick 和 QML 想了解更多信息，请转到第十四章《QtQuick 和 QML》。

由于 Qt Creator 本身也是用 Qt 库编写的，因此它也是完全跨平台的。因此，您可以在不同的开发环境中使用相同的一组工具，并为您的团队开发统一的工作流程，从而提高效率和节约成本。

除此之外，Qt 还配备了许多不同的模块和插件，涵盖了您项目所需的各种功能。通常情况下，您无需寻找其他外部库或依赖项并尝试自行实现它们。Qt 的抽象层使后端实现对用户不可见，并导致统一的编码风格和语法。如果您尝试自行组合一堆外部依赖项，您会发现每个库都有其独特的编码风格。在同一项目中混合所有不同的编码风格会非常混乱，除非您制作自己的抽象层，这是一项非常耗时的任务。由于 Qt 已经包含了大多数（如果不是全部）您需要创建功能丰富的应用程序的模块，因此您无需自行实现。

有关 Qt 附带的模块的更多信息，请访问：[`doc.qt.io/qt-5/qtmodules.html`](http://doc.qt.io/qt-5/qtmodules.html)。

也就是说，还有许多第三方库可以扩展 Qt，以实现 Qt 本身不支持的功能，例如专注于游戏开发或为特定用户群设计的其他功能的库。

# 下载和安装 Qt

不浪费任何时间，让我们开始安装吧！要获取开源 Qt 的免费安装程序，首先转到他们的网站[`www.qt.io`](https://www.qt.io)。在那里，寻找一个名为 Download Qt 的按钮（如果他们已经更新了网站，网站可能看起来不同）。请注意，您可能正在下载商业 Qt 的免费试用版，在 30 天后将无法使用。确保您下载的是开源版本的 Qt。此外，您可能需要为您的平台选择正确的安装程序，因为 Qt 有许多不同的安装程序，适用于不同的操作系统 Windows、macOS 和 Linux。

您可能会想知道为什么安装程序的大小如此之小-只有大约 19 MB。这是因为统一的在线安装程序实际上不包含任何 Qt 软件包，而是一个下载客户端，它可以帮助您下载所有相关文件，并在下载完成后将它们安装到您的计算机上。一旦您下载了在线安装程序，请双击它，您将看到一个类似于这样的界面（以下示例在 Windows 系统上运行）：

![](img/2887b5c2-45ea-457d-94bf-1dcd96367148.png)

单击“下一步”按钮，将出现一个 DRM（数字版权管理）页面，并要求您使用 Qt 帐户登录。如果您没有帐户，您也可以在同一页面上创建您的帐户：

![](img/8da1ff97-e940-4f55-9e78-b9c1c17dfcce.png)

一旦您登录，您将看到一条消息，上面写着您的 Qt 帐户在此主机平台上没有有效的商业许可证。不用担心，只需单击“下一步”按钮即可继续。

接下来，您将被要求指定安装路径。默认路径通常就可以了，但您可以根据需要将其更改为任何其他路径。此外，您可以选择保留与 Qt Creator 关联这些常见文件类型的选项，或者如果不需要，也可以手动取消选中。

之后，您将看到一系列复选框，您可以使用这些复选框选择要安装到计算机上的 Qt 版本。通常，对于新用户，默认选项就足够了。如果您不需要某些选项，例如对 Android 上的 Qt 的支持，您可以在此处取消选择它们，以减小下载的大小。如果需要，您随时可以使用维护工具返回并添加或删除 Qt 组件：

![](img/02db9bda-c373-4b0e-957c-9dc316133d55.png)

接下来，您将看到许可协议。勾选第一个选项，即我已阅读并同意许可协议中包含的条款，然后单击“下一步”按钮。确保您确实阅读了许可协议中规定的条款和条件！

最后，安装程序将要求您输入一个名称，以创建 Qt 的开始菜单快捷方式。完成后，只需单击“下一步”，然后单击“安装”。下载过程将根据您的互联网速度花费几分钟到几个小时不等。一旦所有文件都已下载，安装程序将自动继续将文件安装到您刚刚在之前的步骤中设置的安装路径。

# 设置工作环境

既然您已经安装了最新版本的 Qt，让我们启动 Qt Creator，并开始通过创建我们的第一个项目来进行实验！您应该能够在桌面上或开始菜单的某个位置找到 Qt Creator 的快捷方式图标。

让我们看看设置环境的步骤：

1.  当您首次启动 Qt Creator 时，您应该会看到以下界面：

![](img/78301c1b-8a25-4575-a4ea-b46880946909.png)

1.  在开始创建第一个项目之前，您可能需要调整一些设置。转到顶部菜单，选择“工具”|“选项”。屏幕上将弹出一个类似于此的窗口：

![](img/6a5dc3a3-954d-439e-8d96-c396f90317b6.png)

1.  窗口左侧有许多不同的类别可供选择。每个类别代表一组选项，您可以设置以自定义 Qt Creator 的外观和操作方式。您可能不想触碰设置，但最好先了解它们。您可能想要更改的第一个设置之一是语言选项，该选项位于环境类别中。Qt Creator 为我们提供了在不同语言之间切换的选项。虽然它不支持所有语言，但大多数流行的语言都可用，例如英语、法语、德语、日语、中文、俄语等。选择所需的语言后，单击应用并重新启动 Qt Creator。您必须重新启动 Qt Creator 才能看到更改。

1.  您可能需要的下一个设置是缩进设置。默认情况下，Qt 使用空格缩进，每当您在键盘上按“Tab”键时，将向您的脚本添加四个空格。像我这样的一些人更喜欢制表符缩进。您可以在 C++类别中更改缩进设置。

请注意，如果您要为 Qt 项目的源代码做出贡献，则需要使用空格缩进，而不是制表符，这是 Qt 项目的编码标准和样式。

1.  在 C++类别下，您可以找到一个名为“复制”的按钮，位于右上方的“编辑”按钮旁边。单击它，将弹出一个新窗口。

1.  输入您自己的代码样式名称，因为您无法编辑默认的内置编码样式。创建自己的设置后，单击“编辑”按钮。现在您可以在“常规”选项卡下看到实际的“制表符和缩进”设置：

![](img/86b23382-3d24-4f3a-8b10-e8642f5a3a21.png)

1.  请注意，即使在“文本编辑器”类别中有一个名为“制表符和缩进”的设置，我认为这是一个旧设置，在 Qt Creator 中已不再起作用。界面上还有一条注释，写着代码缩进是在 C++和 Qt Quick 设置中配置的。这可能的原因是，由于 Qt Creator 现在同时支持 C++项目和 QML 项目，Qt 开发人员可能觉得有必要将设置分开，因此旧设置不再有效。我相当肯定，文本编辑器中的这一部分将在不久的将来被弃用。

1.  接下来，在“构建和运行”类别下，您将看到一个名为“工具包”的选项卡。

1.  这是您可以为每个平台设置编译设置的地方。从下一个截图中可以看出，我的 Qt 不支持在 MSVC（Microsoft Visual Studio Compiler）下进行桌面构建，因为我从未在计算机上安装 Visual Studio。相反，我的 Qt 只支持在 MinGW（Minimal GNU for Windows）编译器下进行桌面构建。从此窗口，您可以检查并查看您的 Qt 是否支持您项目所需的平台和编译器，并在必要时进行更改。但是现在，我们将保持不变。要了解有关*工具包*是什么以及如何配置构建设置的更多信息，请转到第十五章，*跨平台开发*： 

![](img/96a3210e-7871-4d1e-bbe1-f31ed021db05.png)

1.  最后，我们可以将我们的项目链接到版本控制类别中的版本控制服务器。

1.  版本控制允许您或您的团队将代码更改提交到集中系统，以便每个团队成员都可以获取相同的代码，而无需手动传递文件。当您在一个大团队中工作时，手动跟踪代码更改非常困难，甚至更难合并不同程序员完成的代码。版本控制系统旨在解决这些问题。Qt 支持不同类型的版本控制系统，如 Git、SVN、Mercurial、Perforce 等。尽管这是一个非常有用的功能，特别是在团队中工作时，但我们现在不需要为其进行配置：

![](img/8faf6c93-fcab-4c20-b1e6-b9c70cba4b3e.png)

# 运行我们的第一个 Hello World Qt 程序

Hello World 程序是一个非常简单的程序，它只是显示一个输出，上面写着`Hello, World!`（或者其他内容，不一定是这个），以显示 SDK 正常工作。我们不需要编写很长的代码来生成`Hello World`程序，我们可以只使用最少和最基本的代码来完成。实际上，在 Qt 中我们不需要编写任何代码，因为它会在您第一次创建项目时生成代码！

让我们按照以下步骤开始我们的项目：

1.  要在 Qt 中创建新项目，请单击 Qt Creator 欢迎屏幕上的“新项目”按钮。或者，您也可以转到顶部菜单，选择“文件”|“新文件或项目”。

1.  之后，您将看到一个窗口，让您为项目或文件选择模板。在这个演示中，我们将选择 Qt Widgets Application：

![](img/61467706-8fad-4cfb-be1b-a27dce3aae57.png)

1.  之后，设置您的项目名称和项目目录。您还可以勾选“用作默认项目位置”，这样下次在 Qt 中创建新项目时就可以自动获得相同的路径。

1.  接下来，Qt Creator 将要求您为项目选择一个或多个工具包。在这个演示中，我们将选择使用 MinGW 编译器的桌面 Qt。不用担心，因为您可以在开发过程中随时添加或删除项目中的工具包：

![](img/f117e1ba-50ee-481b-ab1b-52bdb4a9f7d1.png)

1.  之后，您将看到一个页面，上面写着“类信息”。这基本上是您为基本窗口设置类名的地方，但我们不打算更改任何内容，所以只需点击“下一步”按钮继续：

![](img/4955e578-162a-477d-9739-1e799f4c42bd.png)

1.  最后，它会要求您将项目链接到您的版本控制服务器。如果您以前没有在 Qt 中添加过任何内容，可以单击“Configure”按钮，它将带您进入我在本章前一节中向您展示的设置对话框。

1.  但是，在这个演示中，我们将保持设置为<None>并按下“Finish”按钮。然后，Qt Creator 将继续生成项目所需的文件。一两秒后，Qt Creator 将自动切换到编辑模式，您应该能够在项目面板下看到它为您创建的文件。您可以通过在 Qt Creator 中双击它们来打开任何文件，并且它们将显示在右侧的编辑器中：

![](img/cb27c62e-5ab5-4690-b775-70a353b84b85.png)

1.  在开始编译项目之前，让我们在项目面板的`Forms`目录下打开`mainwindow.ui`文件。不要太担心用户界面，因为我们将在下一章中介绍它。我们需要做的是在右侧窗口的中心点击并拖动“Display Widgets”类别下的“Label”图标，如下面的屏幕截图所示：

![](img/60c3a7ec-dbe6-4832-a1b5-0b36788c4e76.png)

1.  之后，双击`Text Label`小部件并将文本更改为`Hello World!`。完成后，按下键盘上的*Enter*按钮：

![](img/6d7f068a-eca4-4c99-9253-8f31e8ccfed0.png)

1.  最后一步是按下位于左下角的运行按钮，看起来像这样：

![](img/a071be71-b7fd-4cf3-92b0-ee7e0fd16d28.png)

1.  通常情况下，我们会先构建程序，然后运行程序，但是 Qt Creator 足够聪明，可以自行构建它。然而，构建和运行应用程序分开仍然是一个好习惯。经过几秒钟的编译，...哇！你已经使用 Qt 创建了你的第一个`Hello World`程序！

![](img/6823e337-e451-4170-898a-cd7ef9504c04.png)

# 摘要

诸如 Qt Creator 之类的工具的存在使得为开发人员设计应用程序的用户界面成为一项简单而有趣的工作。我们不再需要编写大量的代码来创建单个按钮，或者更改一大堆代码来调整文本标签的位置，因为当我们设计我们的 GUI 时，Qt Designer 会为我们生成那些代码。Qt 已经将所见即所得的哲学应用到了工作流程中，并为我们提供了完成工作所需的所有便利和效率。

在下一章中，我们将学习 Qt Creator 的方方面面，并开始使用 Qt 设计我们的第一个 GUI！
