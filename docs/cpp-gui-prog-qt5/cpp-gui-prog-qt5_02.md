# Qt 小部件和样式表

使用 Qt 进行软件开发的一个优势是，使用 Qt 提供的工具非常容易设计程序的**图形用户界面**（**GUI**）。在本书中，我们将尝试创建一个涉及 Qt 许多不同组件和模块的单一项目。我们将在每一章中逐步介绍项目的每个部分，这样您最终将能够掌握整个 Qt 框架，并同时完成演示项目，这对于您的作品集来说是一个非常有价值的项目。您可以在[`github.com/PacktPublishing/Hands-On-GUI-Programming-with-C-QT5`](https://github.com/PacktPublishing/Hands-On-GUI-Programming-with-C-QT5)找到所有源代码。

在本章中，我们将涵盖以下主题：

+   Qt Designer 简介

+   基本 Qt 小部件

+   Qt 样式表

在本章中，我们将深入探讨 Qt 在设计时如何为我们提供优雅的 GUI。在本章开头，您将了解 Qt 提供的小部件类型及其功能。之后，我们将逐步进行一系列步骤，并使用 Qt 设计我们的第一个表单应用程序。

# Qt Designer 简介

Qt 中有两种类型的 GUI 应用程序，即 Qt Quick 应用程序和 Qt Widgets 应用程序。在本书中，我们将主要涵盖后者，因为这是为桌面应用程序设计 GUI 的标准方式，而 Qt Quick 更广泛地用于移动和嵌入式系统：

1.  我们需要做的第一件事是打开 Qt Creator 并创建一个新项目。您可以通过转到“文件”|“新文件或项目”，或者点击欢迎屏幕上的“新项目”按钮来完成：

![](img/9d6b9538-0ada-4bb2-89f9-17caebfb9a74.png)

1.  在那之后，将弹出一个新窗口，询问您要创建的项目类型。在“应用程序”类别下选择“Qt Widgets 应用程序”，然后点击“选择...”，接着，为您的项目创建一个名称（我选择了`Chapter2`），并通过点击“浏览...”按钮选择项目目录：

![](img/4e7a8d84-01bf-4955-845d-8aa6561f1888.png)

1.  接下来，您将被要求为您的项目选择一个工具包。如果您在 Windows 系统上运行，并且已安装了 Microsoft Visual Studio，则可以选择具有 MSVC 编译器的相关工具包；否则，选择运行 MinGW 编译器的工具包。Qt 通常预装了 MinGW 编译器，因此您无需单独下载它。如果您在 Linux 系统上运行，那么您将看到 GCC 工具包，如果您在 macOS 上运行，那么您将看到 Clang 工具包。要了解更多关于*工具包和构建设置*的信息，请查看第十五章，*跨平台开发*：

![](img/27f4cfa6-475e-4f42-b565-9b1032f053dc.png)

1.  在那之后，新项目向导将要求您命名主窗口类。我们将使用默认设置，然后点击“下一步”按钮继续：

![](img/807a7eff-6385-4e4b-bb7f-152a098a229e.png)

1.  最后，您将被要求将您的版本控制工具链接到您的项目。通过将版本控制工具链接到您的项目，您将能够将代码的每个修订版本保存在远程服务器上，并跟踪对项目所做的所有更改。如果您是在团队中工作，这将特别有用。然而，在本教程中，我们将不使用任何版本控制，所以让我们继续点击“完成”按钮：

![](img/de7bb5f9-296f-4f14-9e74-3585be29dc2d.png)

1.  完成后，Qt Creator 将打开您的新项目，您将能够在左上角看到您的项目目录显示，如下所示：

![](img/36036ee1-58f6-4813-92e1-f96125abb552.png)

1.  现在，通过双击项目目录面板上的`mainwindow.ui`来打开它。然后，Qt Creator 将切换到另一种模式，称为 Qt Designer，这实质上是一个用于为程序设计基于小部件的 GUI 的工具。一旦激活 Qt Designer，您将在左侧面板上看到可用的小部件列表，并且在右侧设计 GUI 的位置。在开始学习如何设计我们自己的 UI 之前，让我们花点时间熟悉一下 Qt Designer 的界面：

![](img/0e7c7455-3546-4bdd-ad91-6e405747afe6.png)

以下数字代表前面截图中显示的 UI：

1.  菜单栏：菜单栏是您找到 Qt Creator 的所有基本功能的地方，例如创建新项目，保存文件，更改编译器设置等。

1.  小部件框：小部件框有点像工具箱，其中显示了 Qt Designer 提供的所有不同小部件，并准备好供使用。您可以从小部件框直接将任何小部件拖放到表单编辑器的画布上，它们将出现在您的程序中。

1.  模式选择器：模式选择器是您可以通过单击编辑或设计按钮快速轻松地在源代码编辑或 UI 设计之间切换的地方。您还可以通过单击位于模式选择器面板上的相应按钮轻松导航到调试器和分析器工具。

1.  构建快捷键：这里显示了三个不同的快捷按钮——构建、运行和调试。您可以通过按下这里的按钮轻松构建和测试运行应用程序，而不是在菜单栏上这样做。

1.  表单编辑器：这是您应用创意并设计应用程序 UI 的地方。您可以从小部件框中拖放任何小部件到表单编辑器的画布上，以使其出现在您的程序中。

1.  表单工具栏：表单工具栏是您可以快速选择要编辑的不同表单的地方。您可以通过单击位于小部件框上方的下拉框并选择要在 Qt Designer 中打开的 UI 文件来切换到不同的表单。还有一些按钮，允许您在表单编辑器和 UI 布局之间切换不同的模式。

1.  对象检查器：这是当前`.ui`文件中所有小部件以分层方式列出的地方。小部件按照其与其他小部件的父子关系在树状列表中排列。通过在表单编辑器中移动它来轻松重新排列小部件的层次结构。

1.  属性编辑器：当您从对象检查器窗口（或表单编辑器窗口）中选择一个小部件时，该特定小部件的属性将显示在属性编辑器上。您可以在这里更改任何属性，结果将立即显示在表单编辑器上。

1.  动作编辑器和信号与槽编辑器：动作编辑器和信号与槽编辑器都位于此窗口中。您可以使用动作编辑器创建与菜单栏和工具栏按钮相关联的动作。信号和槽编辑器是您

1.  输出窗格：输出窗格是您在测试应用程序时查找问题或调试信息的地方。它由几个窗口组成，显示不同的信息，例如问题、搜索结果、应用程序输出等。

简而言之，Qt 提供了一个名为 Qt Creator 的多合一编辑器。Qt Creator 与 Qt 附带的几种不同工具紧密配合，例如脚本编辑器、编译器、调试器、分析器和 UI 编辑器。您在上面的截图中看到的 UI 编辑器称为 Qt Designer。Qt Designer 是设计师设计其程序 UI 的完美工具，而无需编写任何代码。这是因为 Qt Designer 采用了所见即所得的方法，通过提供最终结果的准确视觉表示，意味着您在 Qt Designer 中设计的任何内容在编译和运行程序时都会完全相同。请注意，Qt 附带的每个工具实际上都可以单独运行，但如果您是初学者或只是做一个简单的项目，建议只使用 Qt Creator，它将所有这些工具连接在一个界面中。

# 基本的 Qt 小部件

现在，我们将看一下 Qt Designer 中默认的小部件集。实际上，您可以自己创建自定义小部件，但这是本书范围之外的高级主题。让我们来看看小部件框中列出的第一和第二类别——布局和间隔：

![](img/b0c9740b-923c-42a5-8f99-7becc72dd3f7.png)

布局和间隔实际上并不是您可以直接观察到的东西，但它们可以影响小部件的位置和方向：

1.  垂直布局：垂直布局小部件以垂直列从上到下布置小部件。

1.  水平布局：水平布局小部件以水平行从左到右（或从右到左的从右到左语言）布置小部件。

1.  网格布局：网格布局小部件以二维网格布局放置小部件。每个小部件可以占据多个单元格。

1.  表单布局：表单布局小部件以两列字段样式放置小部件。正如其名称所示，这种类型的布局最适合输入小部件的表单。

Qt 提供的布局对于创建高质量的应用程序非常重要，而且非常强大。Qt 程序通常不使用固定位置来布置元素，因为布局允许对话框和窗口以合理的方式动态调整大小，同时处理不同语言中本地化的文本长度。如果您在 Qt 程序中不使用布局，其 UI 在不同计算机或设备上可能会看起来非常不同，这在大多数情况下会导致不愉快的用户体验。

接下来，让我们看看间隔小部件。间隔是一个不可见的小部件，它沿特定方向推动小部件，直到达到布局容器的限制。间隔必须在布局内使用，否则它们将不会产生任何效果。

有两种类型的间隔，即水平间隔和垂直间隔：

1.  水平间隔：水平间隔小部件是一个占据布局内空间并将布局内其他小部件推动沿水平空间移动的小部件。

1.  垂直间隔：垂直间隔与水平间隔类似，只是它将小部件沿垂直空间推动。

在没有实际使用它们的情况下，很难想象布局和间隔是如何工作的。不用担心，我们马上就会尝试它。Qt Designer 最强大的功能之一是您可以在每次更改后无需更改和编译代码即可实验和测试布局。

除了布局和间隔之外，还有几个类别，包括按钮、项目视图、容器、输入小部件和显示小部件。我不会解释它们中的每一个，因为它们的名称基本上是不言自明的。您也可以将小部件拖放到表单编辑器中以查看其功能。让我们来试一试：

1.  从小部件框中将“推按钮”小部件拖放到表单编辑器中，如下截图所示：

![](img/b08ee4fd-99be-4cc4-b9ea-05ff5ebcc182.png)

1.  然后，选择新添加的“推送按钮”小部件，你会看到与该特定小部件相关的所有信息现在都显示在属性编辑器面板上：

![](img/0e37a02f-3c9f-4105-8f8e-c9c5adc6a2c9.png)

1.  你可以在 C++代码中以编程方式更改小部件的属性，如外观、焦点策略、工具提示等。有些属性也可以直接在表单编辑器中进行编辑。让我们双击“推送按钮”并更改按钮的文本，然后通过拖动其边缘来调整按钮的大小：

![](img/66b379d7-9073-4de9-9ac0-4c67809f03e4.png)

1.  完成后，让我们在表单编辑器中拖放一个水平布局。然后，将“推送按钮”拖放到新添加的布局中。你会看到按钮自动适应到布局中：

![](img/46d70ffd-ef5a-40d5-886e-3d909a82504b.png)

1.  默认情况下，主窗口不具有任何布局效果，因此小部件将保持在它们最初放置的位置，即使窗口被调整大小，这看起来并不好。要为主窗口添加布局效果，在表单编辑器中右键单击窗口，选择“布局”，最后选择“垂直布局”。现在你会看到我们之前添加的水平布局小部件现在自动扩展以适应整个窗口。这是 Qt 中布局的正确行为：

![](img/7df2925b-fe74-48f6-9624-923afa4de14b.png)

1.  接下来，我们可以玩一下间隔器，看看它有什么效果。我们将在包含“推送按钮”的布局顶部拖放一个垂直间隔器，然后在其布局内的按钮两侧放置两个水平间隔器：

![](img/b786e4c5-9668-4c30-ac42-3ad74bade19c.png)

间隔器将推动它们两端的所有小部件并占据空间。在这个例子中，“提交”按钮将始终保持在窗口底部并保持其中间位置，无论窗口的大小如何。这使得 GUI 在不同的屏幕尺寸上看起来很好。

自从我们在窗口中添加了间隔器以后，我们的“推送按钮”被挤压到了最小尺寸。通过将其`minimumSize`属性设置为 120 x 40 来放大按钮，你会看到按钮现在显得更大了：

![](img/10f7a183-c62d-4c25-bf11-16e2e9784767.png)

1.  之后，让我们在“推送按钮”的布局上方添加一个表单布局，并在其下方添加一个垂直间隔器。现在你会看到表单布局非常窄，因为它被我们之前放置在主窗口上的垂直间隔器挤压，这可能会在你想要将小部件拖放到表单布局中时造成麻烦。为了解决这个问题，暂时将`layoutTopMargin`属性设置为`20`或更高：

![](img/190414c4-4b1b-4b30-b24c-940dc11f5e7e.png)

1.  然后，在表单布局的左侧拖放两个标签，右侧拖放两个行编辑。双击标签，将它们的显示文本分别更改为“用户名：”和“密码：”。完成后，将表单布局的`layoutTopMargin`属性设置回`0`：

![](img/80a44e78-2571-458f-b9db-adbae4d956fa.png)

目前，GUI 看起来非常棒，但是表单布局现在占据了中间的所有空间，这在主窗口最大化时并不是很愉快。为了保持表单紧凑，我们将执行以下一些有点棘手的步骤：

1.  首先，在表单上方拖放一个水平布局，并将其`layoutTopMargin`和`layoutBottomMargin`设置为`20`，以便稍后放置在其中的小部件不会离“提交”按钮太近。接下来，将之前放置在表单布局中的整个表单布局拖放到水平布局中。然后，在表单的两侧放置水平间隔器以使其保持居中。以下截图说明了这些步骤：

![](img/e87bdb1a-9eab-4ffc-bad2-59b8bf8a76af.png)

1.  之后，我们可以在进入下一部分之前对 GUI 进行进一步调整，使其看起来整洁。首先，将两个行编辑小部件的`minimumSize`属性设置为 150 x 25。然后，将表单布局的`layoutLeftMargin`、`layoutRightMargin`、`layoutTopMargin`和`layoutBottomMargin`属性设置为`25`。我们这样做的原因是我们将在下一部分中为表单布局添加轮廓。

1.  由于“提交”按钮现在与表单布局的距离太远，让我们将水平布局的`layoutBottomMargin`属性设置为`0`，以将表单布局设置为`0`。这将使“提交”按钮稍微上移并靠近表单布局。之后，我们将调整“提交”按钮的大小，使其与表单布局对齐。让我们将“提交”按钮的`minimumSize`属性设置为 260 x 35，然后我们完成了！：

![](img/cc448268-3595-446c-a1cb-1fb416824a36.png)

您还可以通过转到“工具”|“表单编辑器”|“预览”来预览 GUI，而无需构建程序。Qt Designer 是一种非常方便的工具，可以在不陡峭的学习曲线的情况下为 Qt 程序设计时尚的 GUI。在接下来的部分中，我们将学习如何使用 Qt 样式表自定义小部件的外观。

# Qt 样式表

Qt 的小部件应用程序使用了一个名为 Qt 样式表的样式系统，它类似于 Web 技术的样式系统——**CSS**（**层叠样式表**）。您只需要编写小部件的样式描述，Qt 将相应地呈现它。Qt 样式表的语法与 CSS 几乎相同。

Qt 样式表受 CSS 的启发，因此它们非常相似：

+   Qt 样式表：

```cpp
QLineEdit { color: blue; background-color: black; } 
```

+   CSS：

```cpp
h1 { color: blue; background-color: black; } 
```

在上面的示例中，Qt 样式表和 CSS 都包含了一个声明块和一个选择器。每个声明由属性和值组成，它们之间用冒号分隔。

您可以通过两种方法更改小部件的样式表——直接使用 C++代码或使用属性编辑器。如果您使用 C++代码，可以调用`QObject::setStyleSheet()`函数，如下所示：

```cpp
myButton->setStyleSheet("background-color: green"); 
```

上述代码将我们的按钮小部件的背景颜色更改为绿色。您也可以通过在 Qt Designer 中将相同的声明写入小部件的`styleSheet`属性中来实现相同的结果：

```cpp
QPushButton#myButton { background-color: green } 
```

关于 Qt 样式表的语法和属性的更多信息，请参考以下链接：[`doc.qt.io/qt-5/stylesheet-reference.html`](http://doc.qt.io/qt-5/stylesheet-reference.html)

让我们继续我们的项目，并将自定义 Qt 样式表应用到我们的 GUI 上！

1.  首先，右键单击“提交”按钮，然后选择“更改样式表...”将弹出一个窗口供您编辑小部件的样式表：

![](img/26ee01cd-38ad-4ec7-a8d5-907c466e4c39.png)

1.  然后，将以下内容添加到样式表编辑器窗口中：

```cpp
border: 1px solid rgb(24, 103, 155); 
border-radius: 5px; 
background-color: rgb(124, 203, 255); 
color: white;
```

1.  完成后，单击“确定”按钮，您应该能够看到“提交”按钮的外观发生了变化：

![](img/e14883aa-10c4-4615-93c4-30d02a0923c4.png)

我们之前使用的样式表基本上是不言自明的。它使按钮的边框变为深蓝色，并使用 RGB 值设置边框颜色。然后，它还将按钮应用了圆角效果，并将其背景颜色更改为浅蓝色。最后，“提交”文本也已更改为白色。

1.  接下来，我们想要将自定义样式表应用到表单布局上。但是，您会注意到右键单击它时没有“更改样式表...”选项。这是因为布局不具备该属性。为了对表单布局应用样式，我们必须首先将其转换为 QWidget 或 QFrame 对象。为此，请右键单击表单布局，然后选择“转换为 | QFrame”：

![](img/3634c2e1-b183-4dd3-ab0e-845d8041d60c.png)

1.  完成后，您会注意到它现在具有`styleSheet`属性，因此我们现在可以自定义其外观。让我们右键单击它，然后选择“Change styleSheet...”打开样式表编辑器窗口。然后，插入以下脚本：

```cpp
#formFrame { 
border: 1px solid rgb(24, 103, 155); 
border-radius: 5px; 
background-color: white; } 
```

单词`formFrame`指的是小部件的`objectName`属性，它必须与小部件的确切名称匹配，否则样式将不会应用于它。我们为这个例子定义小部件名称的原因（这是我们在上一个例子中没有做的）是因为如果我们不指定小部件名称，样式也将应用于其所有子级。您可以尝试从前面的脚本中删除`#formFrame {}`，然后看看会发生什么——现在，即使标签和行编辑也有边框线，这不是我们打算做的。GUI 现在看起来像这样：

![](img/120838d2-fa4d-46c0-8ef9-fd47c956e19b.png)

1.  最后，我们想要一个漂亮的背景，我们可以通过附加背景图像来实现这一点。为此，我们首先需要将图像导入到 Qt 的资源系统中。转到“文件”|“新建文件或项目...”，然后在“文件和类别”类别下选择 Qt。之后，选择 Qt 资源文件并单击“选择...”按钮。Qt 资源系统是一种存储二进制文件的平台无关机制，这些文件存储在应用程序的可执行文件中。您可以基本上将所有这些重要文件存储在这里，例如图标图像或语言文件，直接通过使用 Qt 资源文件将这些重要文件直接嵌入到编译过程中的程序中。

1.  然后，在按下“下一步”按钮之前，键入文件名并设置其位置，然后点击“完成”按钮。现在，您将看到一个新的资源文件被创建，我命名为`resource.qrc`：

![](img/50822283-7c7e-4793-8d0b-b8aecd132fbd.png)

1.  用 Qt Creator 打开`resource.qrc`，然后选择“添加”|“添加前缀”。之后，键入您喜欢的前缀，例如`/images`。完成后，再次选择“添加”，这次选择“添加文件”。添加样本项目提供的图像文件`login_bg.png`。然后，保存`resource.qrc`，右键单击图像，选择“复制资源路径到剪贴板”。之后，关闭`resource.qrc`，再次打开`mainwindow.ui`：

![](img/6dd73f49-ae5b-4203-b622-73a4a5516060.png)

1.  我们需要做的下一件事是右键单击“Object Inspector”中的`centralWidget`对象，然后选择“Change styleSheet...”，然后插入以下脚本：

```cpp
#centralWidget { 
border-image: url(:/images/login_bg.png); }
```

1.  在`url()`中的文本可以通过按*Ctrl* + *V*（或粘贴）插入，因为在上一步中选择“复制资源路径到剪贴板”时已将其复制到剪贴板。最终结果如下：

![](img/7234cdb9-3537-4851-94f0-2f498ad43a0e.png)

请确保您还构建和运行应用程序，然后检查最终结果是否与预期相同。还有很多东西可以调整，以使其看起来真正专业，但到目前为止，它看起来相当不错！

# 摘要

Qt Designer 真正改变了我们设计程序 GUI 的方式。它不仅包括所有常见的小部件，还有像布局和间隔这样方便的东西，这使我们的程序在不同类型的监视器和屏幕尺寸上运行得非常好。还要注意，我们已成功创建了一个具有漂亮用户界面的工作应用程序，而没有编写一行 C++代码！

本章中我们学到的只是 Qt 的冰山一角，因为还有许多功能我们尚未涵盖！在下一章中加入我们，学习如何使我们的程序真正功能强大！
