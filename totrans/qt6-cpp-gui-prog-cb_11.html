<html><head></head><body>
<div><h1 class="chapter-number" id="_idParaDest-224"><a id="_idTextAnchor224"/>11</h1>
<h1 id="_idParaDest-225"><a id="_idTextAnchor225"/>Conversion Library</h1>
<p>Data kept within our computer environment is encoded in a variety of ways. Sometimes, it can be used directly for a certain purpose; other times, it needs to be converted into another format in order to fit the context of the task. The process of converting data from one format into another also varies depending on the source format as well as the target format.</p>
<p>Sometimes, the process can be very complex, especially when dealing with data that is feature-rich and sensitive, such as image or video conversion. Even a small error during the conversion process may render a file unusable.</p>
<p>This chapter will cover the following recipes:</p>
<ul>
<li>Converting data</li>
<li>Converting images</li>
<li>Converting videos</li>
<li>Converting currency</li>
</ul>
<h1 id="_idParaDest-226"><a id="_idTextAnchor226"/>Technical requirements</h1>
<p>The technical requirements for this chapter include Qt 6.6.1 MinGW-64-bit and Qt Creator 12.0.2. All the code used in this chapter can be downloaded from the following GitHub repository: <a href="https://github.com/PacktPublishing/QT6-C-GUI-Programming-Cookbook---Third-Edition-/tree/main/Chapter11">https://github.com/PacktPublishing/QT6-C-GUI-Programming-Cookbook---Third-Edition-/tree/main/Chapter11</a>.</p>
<h1 id="_idParaDest-227"><a id="_idTextAnchor227"/>Converting data</h1>
<p>Qt provides a set of classes <a id="_idIndexMarker717"/>and functions for easily converting between different types of data. This makes Qt more than just a GUI library; it is a complete platform for software development. The <code>QVariant</code> class, which we will use in the following example, makes Qt even more flexible and powerful compared to the similar conversion functionalities provided by the C++ standard library.</p>
<h2 id="_idParaDest-228"><a id="_idTextAnchor228"/>How to do it…</h2>
<p>Let’s learn how to convert various data types in Qt by following these steps:</p>
<ol>
<li>Open <strong class="bold">Qt Creator</strong> and create a new <strong class="bold">Qt Console Application</strong> project by going to <strong class="bold">File</strong> | <strong class="bold">New Project…</strong>:</li>
</ol>
<div><div><img alt="Figure 11.1 – Create a Qt Console Application project" src="img/B20976_11_001.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.1 – Create a Qt Console Application project</p>
<ol>
<li value="2">Open <code>main.cpp</code> and add the <a id="_idIndexMarker718"/>following headers to it:<pre class="source-code">
#include &lt;QCoreApplication&gt;
<strong class="bold">#include &lt;QDebug&gt;</strong>
<strong class="bold">#include &lt;QtMath&gt;</strong>
<strong class="bold">#include &lt;QDateTime&gt;</strong>
<strong class="bold">#include &lt;QTextCodec&gt;</strong>
<code>main()</code> function, add the following code to convert a string into a number:<pre class="source-code">
    int numberA = 2;
    QString numberB = "5";
    qDebug() &lt;&lt; "1) " &lt;&lt; "2 + 5 =" &lt;&lt; numberA + numberB.toInt();</pre></li> <li>Convert the number back<a id="_idIndexMarker719"/> into a string:<pre class="source-code">
    float numberC = 10.25;
    float numberD = 2;
    QString result = QString::number(numberC * numberD);
    qDebug() &lt;&lt; "2) " &lt;&lt; "10.25 * 2 =" &lt;&lt; result;</pre></li> <li>Let’s see how to round down a value using <code>qFloor()</code>:<pre class="source-code">
    float numberE = 10.3;
    float numberF = qFloor(numberE);
    qDebug() &lt;&lt; "3) " &lt;&lt; "Floor of 10.3 is" &lt;&lt; numberF;</pre></li> <li>Using <code>qCeil()</code>, we are able to round down a number to the smallest integral value not smaller than its initial value:<pre class="source-code">
    float numberG = 10.3;
    float numberH = qCeil(numberG);
    qDebug() &lt;&lt; "4) " &lt;&lt; "Ceil of 10.3 is" &lt;&lt; numberH;</pre></li> <li>Create a date-time variable by converting it from a piece of date-time data written in the string format:<pre class="source-code">
    QString dateTimeAString = "2016-05-04 12:24:00";
    QDateTime dateTimeA = QDateTime::fromString(dateTimeAString, "yyyy-MM-dd hh:mm:ss");
    qDebug() &lt;&lt; "5) " &lt;&lt; dateTimeA;</pre></li> <li>Convert the date-time <a id="_idIndexMarker720"/>variable back into a string with our custom format:<pre class="source-code">
    QDateTime dateTimeB = QDateTime::currentDateTime();
    QString dateTimeBString = dateTimeB.toString("dd/MM/yy hh:mm");
    qDebug() &lt;&lt; "6) " &lt;&lt; dateTimeBString;</pre></li> <li>Call the <code>QString::toUpper()</code> function to convert a string variable into all capital letters:<pre class="source-code">
    QString hello1 = "hello world!";
    qDebug() &lt;&lt; "7) " &lt;&lt; hello1.toUpper();</pre></li> <li>Calling <code>QString::toLower()</code> will convert the string completely into lowercase:<pre class="source-code">
    QString hello2 = "HELLO WORLD!";
    qDebug() &lt;&lt; "8) " &lt;&lt; hello2.toLower();</pre></li> <li>The <code>QVariant</code> class provided by Qt is a very powerful data type that can be easily converted to other types without any effort from the programmer:<pre class="source-code">
    QVariant aNumber = QVariant(3.14159);
    double aResult = 12.5 * aNumber.toDouble();
    qDebug() &lt;&lt; "9) 12.5 * 3.14159 =" &lt;&lt; aResult;</pre></li> <li>This demonstrates how a single <code>QVariant</code> variable can be simultaneously converted to multiple data types without any effort from the programmer:<pre class="source-code">
    qDebug() &lt;&lt; "10) ";
    QVariant myData = QVariant(10);
    qDebug() &lt;&lt; myData;
    myData = myData.toFloat() / 2.135;
    qDebug() &lt;&lt; myData;
    myData = true;
    qDebug() &lt;&lt; myData;
    myData = QDateTime::currentDateTime();
    qDebug() &lt;&lt; myData;
    myData = "Good bye!";
    qDebug() &lt;&lt; myData;</pre></li> <li>The full source code<a id="_idIndexMarker721"/> in <code>main.cpp</code> will now look like this:<pre class="source-code">
#include &lt;QCoreApplication&gt;
#include &lt;QDebug&gt;
#include &lt;QtMath&gt;
#include &lt;QDateTime&gt;
#include &lt;QStringConverter&gt;
#include &lt;iostream&gt;
int main(int argc, char *argv[]) {
    QCoreApplication a(argc, argv);</pre></li> <li>After that, let’s add code to convert a string into a number, and vice versa:<pre class="source-code">
// String to number
    int numberA = 2;
    QString numberB = "5";
    qDebug() &lt;&lt; "1) " &lt;&lt; "2 + 5 =" &lt;&lt; numberA +
numberB.toInt();
// Number to string
    float numberC = 10.25;
    float numberD = 2;
    QString result = QString::number(numberC * numberD);
    qDebug() &lt;&lt; "2) " &lt;&lt; "10.25 * 2 =" &lt;&lt; result;</pre></li> <li>Write the code to convert<a id="_idIndexMarker722"/> floating-point numbers to their nearest succeeding or preceding integer number, respectively:<pre class="source-code">
// Floor
    float numberE = 10.3;
    float numberF = qFloor(numberE);
    qDebug() &lt;&lt; "3) " &lt;&lt; "Floor of 10.3 is" &lt;&lt; numberF;
// Ceil
    float numberG = 10.3;
    float numberH = qCeil(numberG);
    qDebug() &lt;&lt; "4) " &lt;&lt; "Ceil of 10.3 is" &lt;&lt; numberH;</pre></li> <li>Convert a string into the date-time format, and vice versa:<pre class="source-code">
// Date time from string
    QString dateTimeAString = "2016-05-04 12:24:00";
    QDateTime dateTimeA = QDateTime::fromString(dateTimeAString, "yyyy-MM-dd hh:mm:ss");
    qDebug() &lt;&lt; "5) " &lt;&lt; dateTimeA;
// Date time to string
    QDateTime dateTimeB = QDateTime::currentDateTime();
    QString dateTimeBString = dateTimeB.toString("dd/MM/yy hh:mm");
    qDebug() &lt;&lt; "6) " &lt;&lt; dateTimeBString;</pre></li> <li>Continue to add code to convert strings into uppercase or lowercase characters:<pre class="source-code">
// String to all uppercase
    QString hello1 = "hello world!";
    qDebug() &lt;&lt; "7) " &lt;&lt; hello1.toUpper();
// String to all lowercase
    QString hello2 = "HELLO WORLD!";
    qDebug() &lt;&lt; "8) " &lt;&lt; hello2.toLower();</pre></li> <li>Convert the <code>QVariant</code> data<a id="_idIndexMarker723"/> type into other types:<pre class="source-code">
// QVariant to double
    QVariant aNumber = QVariant(3.14159);
    double aResult = 12.5 * aNumber.toDouble();
    qDebug() &lt;&lt; "9) 12.5 * 3.14159 =" &lt;&lt; aResult;
// QVariant different types
    qDebug() &lt;&lt; "10) ";
    QVariant myData = QVariant(10);
    qDebug() &lt;&lt; myData;
    myData = myData.toFloat() / 2.135;
    qDebug() &lt;&lt; myData;
    myData = true;
    qDebug() &lt;&lt; myData;</pre></li> <li>Convert the <code>QVariant</code> data type into <code>QDateTime</code> and <code>QString</code>:<pre class="source-code">
    myData = QDateTime::currentDateTime();
    qDebug() &lt;&lt; myData;
    myData = "Good bye!";
    qDebug() &lt;&lt; myData;
    return a.exec();
}</pre></li> <li>Compile and run the project, and<a id="_idIndexMarker724"/> you should see something like this:</li>
</ol>
<div><div><img alt="Figure 11.2 – Printing the conversion results on the application output window" src="img/B20976_11_002.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.2 – Printing the conversion results on the application output window</p>
<h2 id="_idParaDest-229"><a id="_idTextAnchor229"/>How it works…</h2>
<p>All the data types provided by Qt, such as <code>QString</code>, <code>QDateTime</code>, and <code>QVariant</code>, contain functions that make conversion to other types easy and straightforward. Qt also provides its own object conversion function, <code>qobject_cast()</code>, which doesn’t rely on the standard library. It is also more compatible with Qt and works well to convert between Qt’s widget types and data types.</p>
<p>Qt also provides you with the <code>QtMath</code> class, which helps you to manipulate number variables, such as rounding up a floating-point number or converting an angle from degrees to radians. <code>QVariant</code> is a special class that can be used to store data of all kinds of types, such as <code>int</code>, <code>float</code>, <code>char</code>, and <code>string</code>. It can automatically determine the data type by examining the value stored in the variable. You can also easily convert the data into any of the types supported by the <code>QVariant</code> class by just calling a single function, such as <code>toFloat()</code>, <code>toInt()</code>, <code>toBool()</code>, <code>toChar()</code>, or <code>toString()</code>.</p>
<h2 id="_idParaDest-230"><a id="_idTextAnchor230"/>There’s more…</h2>
<p>Be aware that each of these <a id="_idIndexMarker725"/>conversions takes computing power. Even though modern computers are extremely fast at handling these operations, you should be careful not to overdo it with a large quantity at once. If you’re converting a large set of variables for complex calculations, it might slow down your computer significantly, so try to convert variables only when necessary.</p>
<h1 id="_idParaDest-231"><a id="_idTextAnchor231"/>Converting images</h1>
<p>In this section, we will learn how to build a<a id="_idIndexMarker726"/> simple image converter that converts an image from one format into another. Qt supports reading and writing different types of image formats, and this support comes in the form of external DLL files due to licensing issues.</p>
<p>However, you don’t have to worry about that because as long as you include those DLL files in your project, it will work seamlessly across different formats. There are certain formats that only support reading and not writing, and some that support both.</p>
<p class="callout-heading">Note</p>
<p class="callout">You can check out the full details about converting images at <a href="http://doc.qt.io/qt-6/qtimageformats-index.html">http://doc.qt.io/qt-6/qtimageformats-index.html</a>.</p>
<h2 id="_idParaDest-232"><a id="_idTextAnchor232"/>How to do it…</h2>
<p>Qt’s built-in image libraries make image conversion really simple:</p>
<ol>
<li>Open Qt Creator and create a new <strong class="bold">Qt Widgets </strong><strong class="bold">Application</strong> project.</li>
<li>Open <code>mainwindow.ui</code> and add a line edit and push button to the canvas to select image files, a combo box to select the desired file format, and another push button to start the conversion process:</li>
</ol>
<div><div><img alt="Figure 11.3 – Lay out the UI as shown here" src="img/B20976_11_003.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.3 – Lay out the UI as shown here</p>
<ol>
<li value="3">Double-click the combobox, and a window will then appear where you can edit the box. We will add three<a id="_idIndexMarker727"/> items to the combobox list by clicking the <code>PNG</code>, <code>JPEG</code>, and <code>BMP</code>:</li>
</ol>
<div><div><img alt="Figure 11.4 – Adding three options to the combobox" src="img/B20976_11_004.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.4 – Adding three options to the combobox</p>
<ol>
<li value="4">Right-click on one of the push buttons, select <strong class="bold">Go to slot…</strong>, and then click the <strong class="bold">OK</strong> button. A slot function will be automatically added to your source files. Repeat this step for the other push button as well:</li>
</ol>
<div><div><img alt="Figure 11.5 – Select the clicked() signal and press OK" src="img/B20976_11_005.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.5 – Select the clicked() signal and press OK</p>
<ol>
<li value="5">Let’s move over to the source <a id="_idIndexMarker728"/>code. Open <code>mainwindow.h</code> and add the following header:<pre class="source-code">
#include &lt;QMainWindow&gt;
<strong class="bold">#include &lt;QFileDialog&gt;</strong>
<strong class="bold">#include &lt;QMessageBox&gt;</strong>
<code>mainwindow.cpp</code> and define what will happen when the <strong class="bold">Browse</strong> button is clicked, which in this case is opening the file dialog to select an image file:<pre class="source-code">
void MainWindow::on_browseButton_clicked() {
    QString fileName = QFileDialog::getOpenFileName(this, "Open Image", "", "Image Files (*.png *.jpg *.bmp)");
    ui-&gt;filePath-&gt;setText(fileName);
}</pre></li> <li>Define what will happen when the <strong class="bold">Convert</strong> button is clicked:<pre class="source-code">
void MainWindow::on_convertButton_clicked() {
    QString fileName = ui-&gt;filePath-&gt;text();
    if (fileName != "") {
        QFileInfo fileInfo = QFileInfo(fileName);
        QString newFileName = fileInfo.path() + "/" + fileInfo.completeBaseName();
        QImage image = QImage(ui-&gt;filePath-&gt;text());
        if (!image.isNull()) {</pre></li> <li>Check which format is<a id="_idIndexMarker729"/> used:<pre class="source-code">
// 0 = PNG, 1 = JPG, 2 = BMP
            int format = ui-&gt;fileFormat-&gt;currentIndex();
            if (format == 0) {
                newFileName += ".png";
            }
            else if (format == 1) {
                newFileName += ".jpg";
            }
            else if (format == 2) {
                newFileName += ".bmp";
            }</pre></li> <li>Check whether the image has been converted:<pre class="source-code">
            qDebug() &lt;&lt; newFileName &lt;&lt; format;
            if (image.save(newFileName, 0, -1)) {
                QMessageBox::information(this, "Success", "Image successfully converted.");
            }
            else {
                QMessageBox::warning(this, "Failed", "Failed to convert image.");
            }
        }</pre></li> <li>Display the message<a id="_idIndexMarker730"/> boxes:<pre class="source-code">
        else {
            QMessageBox::warning(this, "Failed", "Failed to open image file.");
            }
        }
    else {
        QMessageBox::warning(this, "Failed", "No file is selected.");
    }
}</pre></li> <li>Build and run the program now, and we should get a pretty simple image converter that looks like this:</li>
</ol>
<div><div><img alt="Figure 11.6 – Browse an image, select a format, and press the Convert button" src="img/B20976_11_006.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.6 – Browse an image, select a format, and press the Convert button</p>
<h2 id="_idParaDest-233"><a id="_idTextAnchor233"/>How it works…</h2>
<p>The previous example uses the native <code>QImage</code> class from Qt, which contains functions that can access pixel data and manipulate it. It is also used to load an image file and extract its data through different decompression methods, depending on the format of the image.</p>
<p>Once the data is extracted, you <a id="_idIndexMarker731"/>can do anything you want with it, such as display the image on screen, manipulate its color information, resize the image, or compress it with another format and save it as a file.</p>
<p>We used <code>QFileInfo</code> to separate the filename from the extension so that we could amend the extension name with the new format selected by the user from the combobox. This way, we can save the newly converted image in the same folder as the original image and automatically give it the same filename as well, except in a different format.</p>
<p>As long as you’re trying to convert the image to a format supported by Qt, you just need to call <code>QImage::save()</code>. Internally, Qt will figure out the rest for you and output the image to the chosen format. In the <code>QImage::save()</code> function, there is a parameter that sets the image quality and another that sets the format. In this example, we just set both as the default values, which saves the image at the highest quality and lets Qt figure out the format by checking the extension stated in the output filename.</p>
<h2 id="_idParaDest-234"><a id="_idTextAnchor234"/>There’s more…</h2>
<p>You can also convert an image into a PDF using the <code>QPdfWriter</code> class provided by Qt. Essentially, you paint the selected image to the layout of a newly created PDF document and set its resolution accordingly.</p>
<p class="callout-heading">Note</p>
<p class="callout">For more information<a id="_idIndexMarker732"/> about the <code>QPdfWriter</code> class, visit <a href="http://doc.qt.io/qt-6/qpdfwriter.html">http://doc.qt.io/qt-6/qpdfwriter.html</a>.</p>
<h1 id="_idParaDest-235"><a id="_idTextAnchor235"/>Converting videos</h1>
<p>In this recipe, we will create a simple video<a id="_idIndexMarker733"/> converter using Qt and <code>QProcess</code> class provided by Qt.</p>
<h2 id="_idParaDest-236"><a id="_idTextAnchor236"/>How to do it…</h2>
<p>Let’s make a simple video converter <a id="_idIndexMarker734"/>with the following steps:</p>
<ol>
<li>Download <code>FFmpeg</code> (a static package) from <a href="http://ffmpeg.zeranoe.com/builds">http://ffmpeg.zeranoe.com/builds</a> and extract the contents to your preferred location – for example, <code>C:/FFmpeg/</code>.</li>
<li>Open Qt Creator and create a new <strong class="bold">Qt Widgets Application</strong> project by going to <strong class="bold">File</strong> | <strong class="bold">New Project...</strong>.</li>
<li>Open <code>mainwindow.ui</code> – we’re going to work on the program’s user interface. Its UI is very similar to the previous example, except that we add an extra text-edit widget to the canvas, just under the combobox:</li>
</ol>
<div><div><img alt="Figure 11.7 – Design your video converter’s UI like this" src="img/B20976_11_007.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.7 – Design your video converter’s UI like this</p>
<ol>
<li value="4">Double-click the combobox, and then a window will appear to edit the box. We will add three items to the combobox list by clicking the <code>AVI</code>, <code>MP4</code>, and <code>MOV</code>:</li>
</ol>
<div><div><img alt="Figure 11.8 – Adding three video formats to the combobox" src="img/B20976_11_008.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.8 – Adding three video formats to the combobox</p>
<ol>
<li value="5">Right-click on one of the <a id="_idIndexMarker735"/>push buttons, select <strong class="bold">Go to slot…</strong>, and then click the <strong class="bold">OK</strong> button. A slot function will then be automatically added to your source files. Repeat this step for the other push button as well.</li>
<li>Open <code>mainwindow.h</code> and add the following headers to the top:<pre class="source-code">
#include &lt;QMainWindow&gt;
<strong class="bold">#include &lt;QFileDialog&gt;</strong>
<strong class="bold">#include &lt;QProcess&gt;</strong>
<strong class="bold">#include &lt;QMessageBox&gt;</strong>
<strong class="bold">#include &lt;QScrollBar&gt;</strong>
<code>public</code> keyword:<pre class="source-code">
public:
    explicit MainWindow(QWidget *parent = 0);
    ~MainWindow();
<strong class="bold">QProcess* process;</strong>
<strong class="bold">QString outputText;</strong>
<strong class="bold">QString fileName;</strong>
<strong class="bold">QString outputFileName;</strong></pre></li> <li>Add three extra slot functions under the two functions that Qt created for us previously in the <em class="italic">Converting </em><em class="italic">images</em> recipe:<pre class="source-code">
private slots:
    void on_browseButton_clicked();
    void on_convertButton_clicked();
    void processStarted();
    void readyReadStandardOutput();
    void processFinished();</pre></li> <li>Open <code>mainwindow.cpp</code> and <a id="_idIndexMarker736"/>add the following code to the class constructor:<pre class="source-code">
MainWindow::MainWindow(QWidget *parent) :
    QMainWindow(parent), ui(new Ui::MainWindow) {
    ui-&gt;setupUi(this);
    <strong class="bold">process = new QProcess(this);</strong>
    <strong class="bold">connect(process, QProcess::started, this,</strong>
<strong class="bold">MainWindow::processStarted);</strong>
    <strong class="bold">connect(process, QProcess::readyReadStandardOutput, this,</strong>
<strong class="bold">MainWindow::readyReadStandardOutput);</strong>
    <strong class="bold">connect(process, QProcess::finished, this,</strong>
<strong class="bold">MainWindow::processFinished);</strong>
}</pre></li> <li>Define what will happen when the <strong class="bold">Browse</strong> button is clicked, which in this case is opening up the file dialog to allow us to choose the video file:<pre class="source-code">
void MainWindow::on_browseButton_clicked() {
    QString fileName = QFileDialog::getOpenFileName(this, "Open Video", "", "Video Files (*.avi *.mp4 *.mov)");
    ui-&gt;filePath-&gt;setText(fileName);
}</pre></li> <li>Define what will happen if the <code>FFmpeg</code>, which will then handle the conversion process externally:<pre class="source-code">
void MainWindow::on_convertButton_clicked() {
    QString ffmpeg = "C:/FFmpeg/bin/ffmpeg";
    QStringList arguments;
    fileName = ui-&gt;filePath-&gt;text();
    if (fileName != "") {
        QFileInfo fileInfo = QFileInfo(fileName);
        outputFileName = fileInfo.path() + "/" +
fileInfo.completeBaseName();</pre></li> <li>Check for the file’s format – specifically, whether it’s <code>.avi</code>, <code>.mp4</code>, or <code>.mov</code>:<pre class="source-code">
        if (QFile::exists(fileName)) {
            int format = ui-&gt;fileFormat-&gt;currentIndex();
            if (format == 0) {
                outputFileName += ".avi"; // AVI
            }
            else if (format == 1) {
                outputFileName += ".mp4"; // MP4
            }
            else if (format == 2) {
                outputFileName += ".mov"; // MOV
            }</pre></li> <li>Start the conversion using the following code:<pre class="source-code">
            qDebug() &lt;&lt; outputFileName &lt;&lt; format;
            arguments &lt;&lt; "-i" &lt;&lt; fileName &lt;&lt; outputFileName;
            qDebug() &lt;&lt; arguments;
            process-&gt;setProcessChannelMode(QProcess::MergedChannels);
            process-&gt;start(ffmpeg, arguments);
        }</pre></li> <li>Display the message <a id="_idIndexMarker738"/>boxes:<pre class="source-code">
        else {
            QMessageBox::warning(this, "Failed", "Failed to open video file.");
        }
    }
    else {
        QMessageBox::warning(this, "Failed", "No file is selected.");
    }
}</pre></li> <li>Tell the program what to do when the conversion process has started:<pre class="source-code">
void MainWindow::processStarted() {
    qDebug() &lt;&lt; "Process started.";
    ui-&gt;browseButton-&gt;setEnabled(false);
    ui-&gt;fileFormat-&gt;setEditable(false);
    ui-&gt;convertButton-&gt;setEnabled(false);
}</pre></li> <li>Write the slot function that gets called during the conversion process whenever <code>FFmpeg</code> returns an output<a id="_idIndexMarker739"/> to the program:<pre class="source-code">
void MainWindow::readyReadStandardOutput() {
    outputText += process-&gt;readAllStandardOutput();
    ui-&gt;outputDisplay-&gt;setText(outputText);
    ui-&gt;outputDisplay-&gt;verticalScrollBar()-&gt;setSliderPosition(ui-&gt;outputDisplay-&gt;verticalScrollBar()-&gt;maximum());
}</pre></li> <li>Define the slot function that gets called when the entire conversion process has been completed:<pre class="source-code">
void MainWindow::processFinished() {
    qDebug() &lt;&lt; "Process finished.";
    if (QFile::exists(outputFileName)) {
        QMessageBox::information(this, "Success", "Video successfully converted.");
    }
    else {
        QMessageBox::information(this, "Failed", "Failed to convert video.");
    }
    ui-&gt;browseButton-&gt;setEnabled(true);
    ui-&gt;fileFormat-&gt;setEditable(true);
    ui-&gt;convertButton-&gt;setEnabled(true);
}</pre></li> <li>Build and run the project, and <a id="_idIndexMarker740"/>you should get a simple, yet workable, video converter:</li>
</ol>
<div><div><img alt="Figure 11.9 – Your own video converter powered by FFmpeg and Qt" src="img/B20976_11_009.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.9 – Your own video converter powered by FFmpeg and Qt</p>
<h2 id="_idParaDest-237"><a id="_idTextAnchor237"/>How it works…</h2>
<p>The <code>QProcess</code> class provided by Qt is used to start external programs and communicate with them. In this case, we started <code>ffmpeg.exe</code>, located in <code>C:/FFmpeg/bin/</code>, as a process and started communicating with it. We also sent it a set of arguments to tell it what to do when it started. The arguments we used in this example are relatively basic – we only told <code>FFmpeg</code> the path to the source image and the output filename.</p>
<p class="callout-heading">Note</p>
<p class="callout">For more information regarding the argument settings available in <code>FFmpeg</code>, check out <a href="http://www.ffmpeg.org/ffmpeg.html">www.ffmpeg.org/ffmpeg.html</a>.</p>
<p><code>FFmpeg</code> does more than just convert video files. You can also use it to convert audio files and images.</p>
<p class="callout-heading">Note</p>
<p class="callout">For more information regarding all the formats supported by <code>FFmpeg</code>, check out <a href="https://www.ffmpeg.org/general.html#File-Formats">https://www.ffmpeg.org/general.html#File-Formats</a>.</p>
<p>Other than that, you can also play a <a id="_idIndexMarker741"/>video or audio file by running <code>ffplay.exe</code>, located in <code>C:/FFmpeg/bin</code>, or print out the information of the video or audio file in a human-readable fashion by running <code>ffprobe.exe</code>.</p>
<p class="callout-heading">Note</p>
<p class="callout">Check out <code>FFmpeg's</code> full documentation at <a href="https://www.ffmpeg.org/about.html">https://www.ffmpeg.org/about.html</a>.</p>
<h2 id="_idParaDest-238"><a id="_idTextAnchor238"/>There’s more…</h2>
<p>There are lots of things you can do using this method. You’re not limited to what Qt provides, and you can break out of such limitations by carefully selecting a third-party program that provides what you need. One such example is making your own antivirus GUI by utilizing the <a id="_idIndexMarker742"/>command-line-only antivirus scanners available on the market, such as <strong class="bold">Avira ScanCL</strong>, <strong class="bold">Panda Antivirus Command Line Scanner</strong>, <strong class="bold">SAV32CLI</strong>, and <strong class="bold">ClamAV</strong>. You can <a id="_idIndexMarker743"/>build your <a id="_idIndexMarker744"/>own GUI using Qt<a id="_idIndexMarker745"/> and essentially send commands to the antivirus process to tell it what to do.</p>
<h1 id="_idParaDest-239"><a id="_idTextAnchor239"/>Converting currency</h1>
<p>In this example, we will learn how to <a id="_idIndexMarker746"/>create a simple currency converter using Qt, with the <a id="_idIndexMarker747"/>help of an external service provider called <strong class="bold">Fixer.io</strong>.</p>
<h2 id="_idParaDest-240"><a id="_idTextAnchor240"/>How to do it…</h2>
<p>Make yourself a currency converter by following these simple steps:</p>
<ol>
<li>Open Qt Creator and create a new <strong class="bold">Qt Widgets Application</strong> project from <strong class="bold">File</strong> | <strong class="bold">New Project...</strong>.</li>
<li>Open the project file (<code>.pro</code>) and add the network module to our project:<pre class="source-code">
QT += core gui <code>mainwindow.ui</code> and remove the menu bar, toolbar, and status bar from the UI.</li>
<li>Add three horizontal layouts, a horizontal line, and a push button to the canvas. Left-click on the canvas, and continue by clicking the <code>Convert</code>. The UI should look something like this:</li>
</ol>
<div><div><img alt="Figure 11.10 – Place three vertical layouts above the Convert button" src="img/B20976_11_010.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.10 – Place three vertical layouts above the Convert button</p>
<ol>
<li value="5">Add two labels to the top layout, and set the text of the left one to <code>From:</code>, followed by the right one to <code>To:</code>. Add two <code>1</code>:</li>
</ol>
<div><div><img alt="Figure 11.11 – Add labels and Line Edit widgets to the layouts" src="img/B20976_11_011.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.11 – Add labels and Line Edit widgets to the layouts</p>
<ol>
<li value="6">Select the line edit on the right <a id="_idIndexMarker748"/>and enable the <strong class="bold">readOnly</strong> checkbox located in the <strong class="bold">Property</strong> pane:</li>
</ol>
<div><div><img alt="Figure 11.12 – Enable the readOnly property for the second line edit" src="img/B20976_11_012.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.12 – Enable the readOnly property for the second line edit</p>
<ol>
<li value="7">Set the cursor property to <strong class="bold">Forbidden</strong> so that users know it’s not editable when hovering the mouse over the widget:</li>
</ol>
<div><div><img alt="Figure 11.13 – Display the Forbidden cursor to let users know it’s disabled" src="img/B20976_11_013.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.13 – Display the Forbidden cursor to let users know it’s disabled</p>
<ol>
<li value="8">Add two comboboxes to the third layout located at the bottom. We will leave them empty for now:</li>
</ol>
<div><div><img alt="Figure 11.14 – Add two comboboxes to the final layout" src="img/B20976_11_014.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.14 – Add two comboboxes to the final layout</p>
<ol>
<li value="9">Right-click on the <code>clicked()</code> signal as the selection and click <code>mainwindow.h</code> and <code>mainwindow.cpp</code>.</li>
<li>Open <code>mainwindow.h</code> and make sure the following headers are added to the top of the source file:<pre class="source-code">
#include &lt;QMainWindow&gt;
<strong class="bold">#include &lt;QDoubleValidator&gt;</strong>
<strong class="bold">#include &lt;QNetworkAccessManager&gt;</strong>
<strong class="bold">#include &lt;QNetworkRequest&gt;</strong>
<strong class="bold">#include &lt;QNetworkReply&gt;</strong>
<strong class="bold">#include &lt;QJsonDocument&gt;</strong>
<strong class="bold">#include &lt;QJsonObject&gt;</strong>
<strong class="bold">#include &lt;QDebug&gt;</strong>
<code>finished()</code>:<pre class="source-code">
private slots:
    void on_convertButton_clicked();
    void finished(QNetworkReply* reply);</pre></li> <li>Add two variables under the <code>private</code> label:<pre class="source-code">
private:
    Ui::MainWindow *ui;
    QNetworkAccessManager* manager;
    QString targetCurrency;</pre></li> <li>Open the <code>mainwindow.cpp</code> file. Add several currency short code to both comboboxes in the class <a id="_idIndexMarker750"/>constructor. Set a validator to the <code>finished()</code> signal to our <code>finished()</code> slot function:<pre class="source-code">
MainWindow::MainWindow(QWidget *parent) :
    QMainWindow(parent), ui(new Ui::MainWindow) {
    ui-&gt;setupUi(this);
    <strong class="bold">QStringList currencies;</strong>
    <strong class="bold">currencies.push_back("EUR");</strong>
    <strong class="bold">currencies.push_back("USD");</strong>
    <strong class="bold">currencies.push_back("CAD");</strong>
    <strong class="bold">currencies.push_back("MYR");</strong>
    <strong class="bold">currencies.push_back("GBP");</strong></pre></li> <li>We continue from the previous code and insert the currency short forms into the comboboxes. Then, we declare a new network access manager and connect its finished signal to our custom slot function:<pre class="source-code">
    ui-&gt;currencyFrom-&gt;insertItems(0, currencies);
    ui-&gt;currencyTo-&gt;insertItems(0, currencies);
    QValidator *inputRange = new QDoubleValidator(this);
    ui-&gt;amountFrom-&gt;setValidator(inputRange);
    manager = new QNetworkAccessManager(this);
    connect(manager, &amp;QNetworkAccessManager::finished, this, &amp;MainWindow::finished);
}</pre></li> <li>Define what will happen<a id="_idIndexMarker751"/> if the <strong class="bold">Convert</strong> button is clicked by the user:<pre class="source-code">
void MainWindow::on_convertButton_clicked() {
    if (ui-&gt;amountFrom-&gt;text() != "") {
        ui-&gt;convertButton-&gt;setEnabled(false);
        QString from = ui-&gt;currencyFrom-&gt;currentText();
        QString to = ui-&gt;currencyTo-&gt;currentText();
        targetCurrency = to;
        QString url = "http://data.fixer.io/api/latest?base=" +      from + "&amp;symbols=" + to + "&amp;access_key=YOUR_KEY";</pre></li> <li>Start the request by<a id="_idIndexMarker752"/> calling <code>get()</code>:<pre class="source-code">
        QNetworkRequest request = QNetworkRequest(QUrl(url));
        manager-&gt;get(request);
    }
    else {
        QMessageBox::warning(this, "Error", "Please insert a value.");
    }
}</pre></li> <li>Define what will happen when the <code>finished()</code> signal is triggered:<pre class="source-code">
void MainWindow::finished(QNetworkReply* reply) {
    QByteArray response = reply-&gt;readAll();
    qDebug() &lt;&lt; response;
    QJsonDocument jsonResponse =
QJsonDocument::fromJson(response);
    QJsonObject jsonObj = jsonResponse.object();
    QJsonObject jsonObj2 = jsonObj.value("rates").toObject();
    double rate = jsonObj2.value(targetCurrency).toDouble();</pre></li> <li>Continue to write the code from the preceding code, as shown in the following snippet:<pre class="source-code">
    if (rate == 0)
        rate = 1;
    double amount = ui-&gt;amountFrom-&gt;text().toDouble();
    double result = amount * rate;
    ui-&gt;amountTo-&gt;setText(QString::number(result));
    ui-&gt;convertButton-&gt;setEnabled(true);
}</pre></li> <li>Compile and run the project, and<a id="_idIndexMarker753"/> then you should get a simple currency converter that looks like this:</li>
</ol>
<div><div><img alt="Figure 11.15 – A usable currency converter is complete" src="img/B20976_11_015.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 11.15 – A usable currency converter is complete</p>
<h2 id="_idParaDest-241"><a id="_idTextAnchor241"/>How it works…</h2>
<p>Similar to the previous example we saw, which uses an external program to achieve a specific task, this time we used an external service provider that provided us with an open <strong class="bold">Application Programming Interface</strong> (<strong class="bold">API</strong>) that<a id="_idIndexMarker754"/> is free for all and easy to use.</p>
<p>This way, we don’t have to think about the method used to retrieve the latest currency rate. Instead, the service provider has already done the job for us; we just have to send a polite request for it. Then, we wait for the response from their server and process the data according to our intended purposes.</p>
<p>There are quite a few different <a id="_idIndexMarker755"/>service providers you can choose from, besides Fixer.io (<a href="http://fixer.io">http://fixer.io</a>). Some are free but come <a id="_idIndexMarker756"/>without any advanced features; some provide you with a premium price. Some of these alternatives are <strong class="bold">Open Exchange Rates</strong> (<a href="https://openexchangerates.org">https://openexchangerates.org</a>), the <strong class="bold">currencylayer API</strong> (<a href="https://currencylayer.com">https://currencylayer.com</a>), the <strong class="bold">Currency API</strong> (<a href="https://currency-api.appspot.com">https://currency-api.appspot.com</a>), the <strong class="bold">XE Currency Data API</strong> (<a href="http://www.xe.com/xecurrencydata">http://www.xe.com/xecurrencydata</a>), and <strong class="bold">jsonrates</strong> (<a href="http://jsonrates.com">http://jsonrates.com</a>).</p>
<p>In the<a id="_idIndexMarker757"/> previous code, you <a id="_idIndexMarker758"/>should have noticed an access key being <a id="_idIndexMarker759"/>passed to the Fixer.io API, which is a free access <a id="_idIndexMarker760"/>key I registered for this tutorial. If you use it for your own project, you should create an account at Fixer.io.</p>
<h2 id="_idParaDest-242"><a id="_idTextAnchor242"/>There’s more…</h2>
<p>Besides currency exchange rates, you<a id="_idIndexMarker761"/> can use this method to execute more advanced tasks that are perhaps too complicated to do by yourself, or are simply impossible to access unless you use the services provided by specialists, such as <a id="_idIndexMarker762"/>programmable <strong class="bold">Short Message Service</strong> (<strong class="bold">SMS</strong>) and voice services, web analytics and statistics generation, and online payment gateways. Most of these services are not free, but you can easily achieve those functions in minutes without even setting up the server infrastructure and backend system; it’s definitely the cheapest and fastest way to get your product up and running without much hassle.</p>
</div>
</body></html>