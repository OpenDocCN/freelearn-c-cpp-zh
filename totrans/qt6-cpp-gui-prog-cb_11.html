<html><head></head><body>
<div id="_idContainer184">
<h1 class="chapter-number" id="_idParaDest-224"><a id="_idTextAnchor224"/><span class="koboSpan" id="kobo.1.1">11</span></h1>
<h1 id="_idParaDest-225"><a id="_idTextAnchor225"/><span class="koboSpan" id="kobo.2.1">Conversion Library</span></h1>
<p><span class="koboSpan" id="kobo.3.1">Data kept within our computer environment is encoded in a variety of ways. </span><span class="koboSpan" id="kobo.3.2">Sometimes, it can be used directly for a certain purpose; other times, it needs to be converted into another format in order to fit the context of the task. </span><span class="koboSpan" id="kobo.3.3">The process of converting data from one format into another also varies depending on the source format as well as the </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">target format.</span></span></p>
<p><span class="koboSpan" id="kobo.5.1">Sometimes, the process can be very complex, especially when dealing with data that is feature-rich and sensitive, such as image or video conversion. </span><span class="koboSpan" id="kobo.5.2">Even a small error during the conversion process may render a </span><span class="No-Break"><span class="koboSpan" id="kobo.6.1">file unusable.</span></span></p>
<p><span class="koboSpan" id="kobo.7.1">This chapter will cover the </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">following recipes:</span></span></p>
<ul>
<li><span class="No-Break"><span class="koboSpan" id="kobo.9.1">Converting data</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.10.1">Converting images</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.11.1">Converting videos</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.12.1">Converting currency</span></span></li>
</ul>
<h1 id="_idParaDest-226"><a id="_idTextAnchor226"/><span class="koboSpan" id="kobo.13.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.14.1">The technical requirements for this chapter include Qt 6.6.1 MinGW-64-bit and Qt Creator 12.0.2. </span><span class="koboSpan" id="kobo.14.2">All the code used in this chapter can be downloaded from the following GitHub </span><span class="No-Break"><span class="koboSpan" id="kobo.15.1">repository: </span></span><a href="https://github.com/PacktPublishing/QT6-C-GUI-Programming-Cookbook---Third-Edition-/tree/main/Chapter11"><span class="No-Break"><span class="koboSpan" id="kobo.16.1">https://github.com/PacktPublishing/QT6-C-GUI-Programming-Cookbook---Third-Edition-/tree/main/Chapter11</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.17.1">.</span></span></p>
<h1 id="_idParaDest-227"><a id="_idTextAnchor227"/><span class="koboSpan" id="kobo.18.1">Converting data</span></h1>
<p><span class="koboSpan" id="kobo.19.1">Qt provides a set of classes </span><a id="_idIndexMarker717"/><span class="koboSpan" id="kobo.20.1">and functions for easily converting between different types of data. </span><span class="koboSpan" id="kobo.20.2">This makes Qt more than just a GUI library; it is a complete platform for software development. </span><span class="koboSpan" id="kobo.20.3">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.21.1">QVariant</span></strong><span class="koboSpan" id="kobo.22.1"> class, which we will use in the following example, makes Qt even more flexible and powerful compared to the similar conversion functionalities provided by the C++ </span><span class="No-Break"><span class="koboSpan" id="kobo.23.1">standard library.</span></span></p>
<h2 id="_idParaDest-228"><a id="_idTextAnchor228"/><span class="koboSpan" id="kobo.24.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.25.1">Let’s learn how to convert various data types in Qt by following </span><span class="No-Break"><span class="koboSpan" id="kobo.26.1">these steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.27.1">Open </span><strong class="bold"><span class="koboSpan" id="kobo.28.1">Qt Creator</span></strong><span class="koboSpan" id="kobo.29.1"> and create a new </span><strong class="bold"><span class="koboSpan" id="kobo.30.1">Qt Console Application</span></strong><span class="koboSpan" id="kobo.31.1"> project by going to </span><strong class="bold"><span class="koboSpan" id="kobo.32.1">File</span></strong><span class="koboSpan" id="kobo.33.1"> | </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.34.1">New Project…</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.35.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer169">
<span class="koboSpan" id="kobo.36.1"><img alt="Figure 11.1 – Create a Qt Console Application project" src="image/B20976_11_001.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.37.1">Figure 11.1 – Create a Qt Console Application project</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.38.1">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.39.1">main.cpp</span></strong><span class="koboSpan" id="kobo.40.1"> and add the </span><a id="_idIndexMarker718"/><span class="koboSpan" id="kobo.41.1">following headers </span><span class="No-Break"><span class="koboSpan" id="kobo.42.1">to it:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.43.1">
#include &lt;QCoreApplication&gt;
</span><strong class="bold"><span class="koboSpan" id="kobo.44.1">#include &lt;QDebug&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.45.1">#include &lt;QtMath&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.46.1">#include &lt;QDateTime&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.47.1">#include &lt;QTextCodec&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.48.1">#include &lt;iostream&gt;</span></strong></pre></li> <li><span class="koboSpan" id="kobo.49.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.50.1">main()</span></strong><span class="koboSpan" id="kobo.51.1"> function, add the following code to convert a string into </span><span class="No-Break"><span class="koboSpan" id="kobo.52.1">a number:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.53.1">
    int numberA = 2;
    QString numberB = "5";
    qDebug() &lt;&lt; "1) " &lt;&lt; "2 + 5 =" &lt;&lt; numberA + numberB.toInt();</span></pre></li> <li><span class="koboSpan" id="kobo.54.1">Convert the number back</span><a id="_idIndexMarker719"/><span class="koboSpan" id="kobo.55.1"> into </span><span class="No-Break"><span class="koboSpan" id="kobo.56.1">a string:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.57.1">
    float numberC = 10.25;
    float numberD = 2;
    QString result = QString::number(numberC * numberD);
    qDebug() &lt;&lt; "2) " &lt;&lt; "10.25 * 2 =" &lt;&lt; result;</span></pre></li> <li><span class="koboSpan" id="kobo.58.1">Let’s see how to round down a value </span><span class="No-Break"><span class="koboSpan" id="kobo.59.1">using </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.60.1">qFloor()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.61.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.62.1">
    float numberE = 10.3;
    float numberF = qFloor(numberE);
    qDebug() &lt;&lt; "3) " &lt;&lt; "Floor of 10.3 is" &lt;&lt; numberF;</span></pre></li> <li><span class="koboSpan" id="kobo.63.1">Using </span><strong class="source-inline"><span class="koboSpan" id="kobo.64.1">qCeil()</span></strong><span class="koboSpan" id="kobo.65.1">, we are able to round down a number to the smallest integral value not smaller than its </span><span class="No-Break"><span class="koboSpan" id="kobo.66.1">initial value:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.67.1">
    float numberG = 10.3;
    float numberH = qCeil(numberG);
    qDebug() &lt;&lt; "4) " &lt;&lt; "Ceil of 10.3 is" &lt;&lt; numberH;</span></pre></li> <li><span class="koboSpan" id="kobo.68.1">Create a date-time variable by converting it from a piece of date-time data written in the </span><span class="No-Break"><span class="koboSpan" id="kobo.69.1">string format:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.70.1">
    QString dateTimeAString = "2016-05-04 12:24:00";
    QDateTime dateTimeA = QDateTime::fromString(dateTimeAString, "yyyy-MM-dd hh:mm:ss");
    qDebug() &lt;&lt; "5) " &lt;&lt; dateTimeA;</span></pre></li> <li><span class="koboSpan" id="kobo.71.1">Convert the date-time </span><a id="_idIndexMarker720"/><span class="koboSpan" id="kobo.72.1">variable back into a string with our </span><span class="No-Break"><span class="koboSpan" id="kobo.73.1">custom format:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.74.1">
    QDateTime dateTimeB = QDateTime::currentDateTime();
    QString dateTimeBString = dateTimeB.toString("dd/MM/yy hh:mm");
    qDebug() &lt;&lt; "6) " &lt;&lt; dateTimeBString;</span></pre></li> <li><span class="koboSpan" id="kobo.75.1">Call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.76.1">QString::toUpper()</span></strong><span class="koboSpan" id="kobo.77.1"> function to convert a string variable into all </span><span class="No-Break"><span class="koboSpan" id="kobo.78.1">capital letters:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.79.1">
    QString hello1 = "hello world!";
    qDebug() &lt;&lt; "7) " &lt;&lt; hello1.toUpper();</span></pre></li> <li><span class="koboSpan" id="kobo.80.1">Calling </span><strong class="source-inline"><span class="koboSpan" id="kobo.81.1">QString::toLower()</span></strong><span class="koboSpan" id="kobo.82.1"> will convert the string completely </span><span class="No-Break"><span class="koboSpan" id="kobo.83.1">into lowercase:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.84.1">
    QString hello2 = "HELLO WORLD!";
    qDebug() &lt;&lt; "8) " &lt;&lt; hello2.toLower();</span></pre></li> <li><span class="koboSpan" id="kobo.85.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.86.1">QVariant</span></strong><span class="koboSpan" id="kobo.87.1"> class provided by Qt is a very powerful data type that can be easily converted to other types without any effort from </span><span class="No-Break"><span class="koboSpan" id="kobo.88.1">the programmer:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.89.1">
    QVariant aNumber = QVariant(3.14159);
    double aResult = 12.5 * aNumber.toDouble();
    qDebug() &lt;&lt; "9) 12.5 * 3.14159 =" &lt;&lt; aResult;</span></pre></li> <li><span class="koboSpan" id="kobo.90.1">This demonstrates how a single </span><strong class="source-inline"><span class="koboSpan" id="kobo.91.1">QVariant</span></strong><span class="koboSpan" id="kobo.92.1"> variable can be simultaneously converted to multiple data types without any effort from </span><span class="No-Break"><span class="koboSpan" id="kobo.93.1">the programmer:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.94.1">
    qDebug() &lt;&lt; "10) ";
    QVariant myData = QVariant(10);
    qDebug() &lt;&lt; myData;
    myData = myData.toFloat() / 2.135;
    qDebug() &lt;&lt; myData;
    myData = true;
    qDebug() &lt;&lt; myData;
    myData = QDateTime::currentDateTime();
    qDebug() &lt;&lt; myData;
    myData = "Good bye!";
    qDebug() &lt;&lt; myData;</span></pre></li> <li><span class="koboSpan" id="kobo.95.1">The full source code</span><a id="_idIndexMarker721"/><span class="koboSpan" id="kobo.96.1"> in </span><strong class="source-inline"><span class="koboSpan" id="kobo.97.1">main.cpp</span></strong><span class="koboSpan" id="kobo.98.1"> will now look </span><span class="No-Break"><span class="koboSpan" id="kobo.99.1">like this:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.100.1">
#include &lt;QCoreApplication&gt;
#include &lt;QDebug&gt;
#include &lt;QtMath&gt;
#include &lt;QDateTime&gt;
#include &lt;QStringConverter&gt;
#include &lt;iostream&gt;
int main(int argc, char *argv[]) {
    QCoreApplication a(argc, argv);</span></pre></li> <li><span class="koboSpan" id="kobo.101.1">After that, let’s add code to convert a string into a number, and </span><span class="No-Break"><span class="koboSpan" id="kobo.102.1">vice versa:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.103.1">
// String to number
    int numberA = 2;
    QString numberB = "5";
    qDebug() &lt;&lt; "1) " &lt;&lt; "2 + 5 =" &lt;&lt; numberA +
numberB.toInt();
// Number to string
    float numberC = 10.25;
    float numberD = 2;
    QString result = QString::number(numberC * numberD);
    qDebug() &lt;&lt; "2) " &lt;&lt; "10.25 * 2 =" &lt;&lt; result;</span></pre></li> <li><span class="koboSpan" id="kobo.104.1">Write the code to convert</span><a id="_idIndexMarker722"/><span class="koboSpan" id="kobo.105.1"> floating-point numbers to their nearest succeeding or preceding integer </span><span class="No-Break"><span class="koboSpan" id="kobo.106.1">number, respectively:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.107.1">
// Floor
    float numberE = 10.3;
    float numberF = qFloor(numberE);
    qDebug() &lt;&lt; "3) " &lt;&lt; "Floor of 10.3 is" &lt;&lt; numberF;
// Ceil
    float numberG = 10.3;
    float numberH = qCeil(numberG);
    qDebug() &lt;&lt; "4) " &lt;&lt; "Ceil of 10.3 is" &lt;&lt; numberH;</span></pre></li> <li><span class="koboSpan" id="kobo.108.1">Convert a string into the date-time format, and </span><span class="No-Break"><span class="koboSpan" id="kobo.109.1">vice versa:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.110.1">
// Date time from string
    QString dateTimeAString = "2016-05-04 12:24:00";
    QDateTime dateTimeA = QDateTime::fromString(dateTimeAString, "yyyy-MM-dd hh:mm:ss");
    qDebug() &lt;&lt; "5) " &lt;&lt; dateTimeA;
// Date time to string
    QDateTime dateTimeB = QDateTime::currentDateTime();
    QString dateTimeBString = dateTimeB.toString("dd/MM/yy hh:mm");
    qDebug() &lt;&lt; "6) " &lt;&lt; dateTimeBString;</span></pre></li> <li><span class="koboSpan" id="kobo.111.1">Continue to add code to convert strings into uppercase or </span><span class="No-Break"><span class="koboSpan" id="kobo.112.1">lowercase characters:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.113.1">
// String to all uppercase
    QString hello1 = "hello world!";
    qDebug() &lt;&lt; "7) " &lt;&lt; hello1.toUpper();
// String to all lowercase
    QString hello2 = "HELLO WORLD!";
    qDebug() &lt;&lt; "8) " &lt;&lt; hello2.toLower();</span></pre></li> <li><span class="koboSpan" id="kobo.114.1">Convert the </span><strong class="source-inline"><span class="koboSpan" id="kobo.115.1">QVariant</span></strong><span class="koboSpan" id="kobo.116.1"> data</span><a id="_idIndexMarker723"/><span class="koboSpan" id="kobo.117.1"> type into </span><span class="No-Break"><span class="koboSpan" id="kobo.118.1">other types:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.119.1">
// QVariant to double
    QVariant aNumber = QVariant(3.14159);
    double aResult = 12.5 * aNumber.toDouble();
    qDebug() &lt;&lt; "9) 12.5 * 3.14159 =" &lt;&lt; aResult;
// QVariant different types
    qDebug() &lt;&lt; "10) ";
    QVariant myData = QVariant(10);
    qDebug() &lt;&lt; myData;
    myData = myData.toFloat() / 2.135;
    qDebug() &lt;&lt; myData;
    myData = true;
    qDebug() &lt;&lt; myData;</span></pre></li> <li><span class="koboSpan" id="kobo.120.1">Convert the </span><strong class="source-inline"><span class="koboSpan" id="kobo.121.1">QVariant</span></strong><span class="koboSpan" id="kobo.122.1"> data type into </span><strong class="source-inline"><span class="koboSpan" id="kobo.123.1">QDateTime</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.124.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.125.1">QString</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.126.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.127.1">
    myData = QDateTime::currentDateTime();
    qDebug() &lt;&lt; myData;
    myData = "Good bye!";
    qDebug() &lt;&lt; myData;
    return a.exec();
}</span></pre></li> <li><span class="koboSpan" id="kobo.128.1">Compile and run the project, and</span><a id="_idIndexMarker724"/><span class="koboSpan" id="kobo.129.1"> you should see something </span><span class="No-Break"><span class="koboSpan" id="kobo.130.1">like this:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer170">
<span class="koboSpan" id="kobo.131.1"><img alt="Figure 11.2 – Printing the conversion results on the application output window" src="image/B20976_11_002.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.132.1">Figure 11.2 – Printing the conversion results on the application output window</span></p>
<h2 id="_idParaDest-229"><a id="_idTextAnchor229"/><span class="koboSpan" id="kobo.133.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.134.1">All the data types provided by Qt, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.135.1">QString</span></strong><span class="koboSpan" id="kobo.136.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.137.1">QDateTime</span></strong><span class="koboSpan" id="kobo.138.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.139.1">QVariant</span></strong><span class="koboSpan" id="kobo.140.1">, contain functions that make conversion to other types easy and straightforward. </span><span class="koboSpan" id="kobo.140.2">Qt also provides its own object conversion function, </span><strong class="source-inline"><span class="koboSpan" id="kobo.141.1">qobject_cast()</span></strong><span class="koboSpan" id="kobo.142.1">, which doesn’t rely on the standard library. </span><span class="koboSpan" id="kobo.142.2">It is also more compatible with Qt and works well to convert between Qt’s widget types and </span><span class="No-Break"><span class="koboSpan" id="kobo.143.1">data types.</span></span></p>
<p><span class="koboSpan" id="kobo.144.1">Qt also provides you with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.145.1">QtMath</span></strong><span class="koboSpan" id="kobo.146.1"> class, which helps you to manipulate number variables, such as rounding up a floating-point number or converting an angle from degrees to radians. </span><strong class="source-inline"><span class="koboSpan" id="kobo.147.1">QVariant</span></strong><span class="koboSpan" id="kobo.148.1"> is a special class that can be used to store data of all kinds of types, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.149.1">int</span></strong><span class="koboSpan" id="kobo.150.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.151.1">float</span></strong><span class="koboSpan" id="kobo.152.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.153.1">char</span></strong><span class="koboSpan" id="kobo.154.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.155.1">string</span></strong><span class="koboSpan" id="kobo.156.1">. </span><span class="koboSpan" id="kobo.156.2">It can automatically determine the data type by examining the value stored in the variable. </span><span class="koboSpan" id="kobo.156.3">You can also easily convert the data into any of the types supported by the </span><strong class="source-inline"><span class="koboSpan" id="kobo.157.1">QVariant</span></strong><span class="koboSpan" id="kobo.158.1"> class by just calling a single function, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.159.1">toFloat()</span></strong><span class="koboSpan" id="kobo.160.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.161.1">toInt()</span></strong><span class="koboSpan" id="kobo.162.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.163.1">toBool()</span></strong><span class="koboSpan" id="kobo.164.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.165.1">toChar()</span></strong><span class="koboSpan" id="kobo.166.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.167.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.168.1">toString()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.169.1">.</span></span></p>
<h2 id="_idParaDest-230"><a id="_idTextAnchor230"/><span class="koboSpan" id="kobo.170.1">There’s more…</span></h2>
<p><span class="koboSpan" id="kobo.171.1">Be aware that each of these </span><a id="_idIndexMarker725"/><span class="koboSpan" id="kobo.172.1">conversions takes computing power. </span><span class="koboSpan" id="kobo.172.2">Even though modern computers are extremely fast at handling these operations, you should be careful not to overdo it with a large quantity at once. </span><span class="koboSpan" id="kobo.172.3">If you’re converting a large set of variables for complex calculations, it might slow down your computer significantly, so try to convert variables only </span><span class="No-Break"><span class="koboSpan" id="kobo.173.1">when necessary.</span></span></p>
<h1 id="_idParaDest-231"><a id="_idTextAnchor231"/><span class="koboSpan" id="kobo.174.1">Converting images</span></h1>
<p><span class="koboSpan" id="kobo.175.1">In this section, we will learn how to build a</span><a id="_idIndexMarker726"/><span class="koboSpan" id="kobo.176.1"> simple image converter that converts an image from one format into another. </span><span class="koboSpan" id="kobo.176.2">Qt supports reading and writing different types of image formats, and this support comes in the form of external DLL files due to </span><span class="No-Break"><span class="koboSpan" id="kobo.177.1">licensing issues.</span></span></p>
<p><span class="koboSpan" id="kobo.178.1">However, you don’t have to worry about that because as long as you include those DLL files in your project, it will work seamlessly across different formats. </span><span class="koboSpan" id="kobo.178.2">There are certain formats that only support reading and not writing, and some that </span><span class="No-Break"><span class="koboSpan" id="kobo.179.1">support both.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.180.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.181.1">You can check out the full details about converting images </span><span class="No-Break"><span class="koboSpan" id="kobo.182.1">at </span></span><a href="http://doc.qt.io/qt-6/qtimageformats-index.html"><span class="No-Break"><span class="koboSpan" id="kobo.183.1">http://doc.qt.io/qt-6/qtimageformats-index.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.184.1">.</span></span></p>
<h2 id="_idParaDest-232"><a id="_idTextAnchor232"/><span class="koboSpan" id="kobo.185.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.186.1">Qt’s built-in image libraries make image conversion </span><span class="No-Break"><span class="koboSpan" id="kobo.187.1">really simple:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.188.1">Open Qt Creator and create a new </span><strong class="bold"><span class="koboSpan" id="kobo.189.1">Qt Widgets </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.190.1">Application</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.191.1"> project.</span></span></li>
<li><span class="koboSpan" id="kobo.192.1">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.193.1">mainwindow.ui</span></strong><span class="koboSpan" id="kobo.194.1"> and add a line edit and push button to the canvas to select image files, a combo box to select the desired file format, and another push button to start the </span><span class="No-Break"><span class="koboSpan" id="kobo.195.1">conversion process:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer171">
<span class="koboSpan" id="kobo.196.1"><img alt="Figure 11.3 – Lay out the UI as shown here" src="image/B20976_11_003.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.197.1">Figure 11.3 – Lay out the UI as shown here</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.198.1">Double-click the combobox, and a window will then appear where you can edit the box. </span><span class="koboSpan" id="kobo.198.2">We will add three</span><a id="_idIndexMarker727"/><span class="koboSpan" id="kobo.199.1"> items to the combobox list by clicking the </span><strong class="bold"><span class="koboSpan" id="kobo.200.1">+</span></strong><span class="koboSpan" id="kobo.201.1"> button three times and renaming the items </span><strong class="source-inline"><span class="koboSpan" id="kobo.202.1">PNG</span></strong><span class="koboSpan" id="kobo.203.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.204.1">JPEG</span></strong><span class="koboSpan" id="kobo.205.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.206.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.207.1">BMP</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.208.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer172">
<span class="koboSpan" id="kobo.209.1"><img alt="Figure 11.4 – Adding three options to the combobox" src="image/B20976_11_004.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.210.1">Figure 11.4 – Adding three options to the combobox</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.211.1">Right-click on one of the push buttons, select </span><strong class="bold"><span class="koboSpan" id="kobo.212.1">Go to slot…</span></strong><span class="koboSpan" id="kobo.213.1">, and then click the </span><strong class="bold"><span class="koboSpan" id="kobo.214.1">OK</span></strong><span class="koboSpan" id="kobo.215.1"> button. </span><span class="koboSpan" id="kobo.215.2">A slot function will be automatically added to your source files. </span><span class="koboSpan" id="kobo.215.3">Repeat this step for the other push button </span><span class="No-Break"><span class="koboSpan" id="kobo.216.1">as well:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer173">
<span class="koboSpan" id="kobo.217.1"><img alt="Figure 11.5 – Select the clicked() signal and press OK" src="image/B20976_11_005.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.218.1">Figure 11.5 – Select the clicked() signal and press OK</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.219.1">Let’s move over to the source </span><a id="_idIndexMarker728"/><span class="koboSpan" id="kobo.220.1">code. </span><span class="koboSpan" id="kobo.220.2">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.221.1">mainwindow.h</span></strong><span class="koboSpan" id="kobo.222.1"> and add the </span><span class="No-Break"><span class="koboSpan" id="kobo.223.1">following header:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.224.1">
#include &lt;QMainWindow&gt;
</span><strong class="bold"><span class="koboSpan" id="kobo.225.1">#include &lt;QFileDialog&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.226.1">#include &lt;QMessageBox&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.227.1">#include &lt;QDebug&gt;</span></strong></pre></li> <li><span class="koboSpan" id="kobo.228.1">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.229.1">mainwindow.cpp</span></strong><span class="koboSpan" id="kobo.230.1"> and define what will happen when the </span><strong class="bold"><span class="koboSpan" id="kobo.231.1">Browse</span></strong><span class="koboSpan" id="kobo.232.1"> button is clicked, which in this case is opening the file dialog to select an </span><span class="No-Break"><span class="koboSpan" id="kobo.233.1">image file:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.234.1">
void MainWindow::on_browseButton_clicked() {
    QString fileName = QFileDialog::getOpenFileName(this, "Open Image", "", "Image Files (*.png *.jpg *.bmp)");
    ui-&gt;filePath-&gt;setText(fileName);
}</span></pre></li> <li><span class="koboSpan" id="kobo.235.1">Define what will happen when the </span><strong class="bold"><span class="koboSpan" id="kobo.236.1">Convert</span></strong><span class="koboSpan" id="kobo.237.1"> button </span><span class="No-Break"><span class="koboSpan" id="kobo.238.1">is clicked:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.239.1">
void MainWindow::on_convertButton_clicked() {
    QString fileName = ui-&gt;filePath-&gt;text();
    if (fileName != "") {
        QFileInfo fileInfo = QFileInfo(fileName);
        QString newFileName = fileInfo.path() + "/" + fileInfo.completeBaseName();
        QImage image = QImage(ui-&gt;filePath-&gt;text());
        if (!image.isNull()) {</span></pre></li> <li><span class="koboSpan" id="kobo.240.1">Check which format </span><span class="No-Break"><span class="koboSpan" id="kobo.241.1">is</span></span><span class="No-Break"><a id="_idIndexMarker729"/></span><span class="No-Break"><span class="koboSpan" id="kobo.242.1"> used:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.243.1">
// 0 = PNG, 1 = JPG, 2 = BMP
            int format = ui-&gt;fileFormat-&gt;currentIndex();
            if (format == 0) {
                newFileName += ".png";
            }
            else if (format == 1) {
                newFileName += ".jpg";
            }
            else if (format == 2) {
                newFileName += ".bmp";
            }</span></pre></li> <li><span class="koboSpan" id="kobo.244.1">Check whether the image has </span><span class="No-Break"><span class="koboSpan" id="kobo.245.1">been converted:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.246.1">
            qDebug() &lt;&lt; newFileName &lt;&lt; format;
            if (image.save(newFileName, 0, -1)) {
                QMessageBox::information(this, "Success", "Image successfully converted.");
            }
            else {
                QMessageBox::warning(this, "Failed", "Failed to convert image.");
            }
        }</span></pre></li> <li><span class="koboSpan" id="kobo.247.1">Display the </span><span class="No-Break"><span class="koboSpan" id="kobo.248.1">message</span></span><span class="No-Break"><a id="_idIndexMarker730"/></span><span class="No-Break"><span class="koboSpan" id="kobo.249.1"> boxes:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.250.1">
        else {
            QMessageBox::warning(this, "Failed", "Failed to open image file.");
            }
        }
    else {
        QMessageBox::warning(this, "Failed", "No file is selected.");
    }
}</span></pre></li> <li><span class="koboSpan" id="kobo.251.1">Build and run the program now, and we should get a pretty simple image converter that looks </span><span class="No-Break"><span class="koboSpan" id="kobo.252.1">like this:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer174">
<span class="koboSpan" id="kobo.253.1"><img alt="Figure 11.6 – Browse an image, select a format, and press the Convert button" src="image/B20976_11_006.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.254.1">Figure 11.6 – Browse an image, select a format, and press the Convert button</span></p>
<h2 id="_idParaDest-233"><a id="_idTextAnchor233"/><span class="koboSpan" id="kobo.255.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.256.1">The previous example uses the native </span><strong class="source-inline"><span class="koboSpan" id="kobo.257.1">QImage</span></strong><span class="koboSpan" id="kobo.258.1"> class from Qt, which contains functions that can access pixel data and manipulate it. </span><span class="koboSpan" id="kobo.258.2">It is also used to load an image file and extract its data through different decompression methods, depending on the format of </span><span class="No-Break"><span class="koboSpan" id="kobo.259.1">the image.</span></span></p>
<p><span class="koboSpan" id="kobo.260.1">Once the data is extracted, you </span><a id="_idIndexMarker731"/><span class="koboSpan" id="kobo.261.1">can do anything you want with it, such as display the image on screen, manipulate its color information, resize the image, or compress it with another format and save it as </span><span class="No-Break"><span class="koboSpan" id="kobo.262.1">a file.</span></span></p>
<p><span class="koboSpan" id="kobo.263.1">We used </span><strong class="source-inline"><span class="koboSpan" id="kobo.264.1">QFileInfo</span></strong><span class="koboSpan" id="kobo.265.1"> to separate the filename from the extension so that we could amend the extension name with the new format selected by the user from the combobox. </span><span class="koboSpan" id="kobo.265.2">This way, we can save the newly converted image in the same folder as the original image and automatically give it the same filename as well, except in a </span><span class="No-Break"><span class="koboSpan" id="kobo.266.1">different format.</span></span></p>
<p><span class="koboSpan" id="kobo.267.1">As long as you’re trying to convert the image to a format supported by Qt, you just need to call </span><strong class="source-inline"><span class="koboSpan" id="kobo.268.1">QImage::save()</span></strong><span class="koboSpan" id="kobo.269.1">. </span><span class="koboSpan" id="kobo.269.2">Internally, Qt will figure out the rest for you and output the image to the chosen format. </span><span class="koboSpan" id="kobo.269.3">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.270.1">QImage::save()</span></strong><span class="koboSpan" id="kobo.271.1"> function, there is a parameter that sets the image quality and another that sets the format. </span><span class="koboSpan" id="kobo.271.2">In this example, we just set both as the default values, which saves the image at the highest quality and lets Qt figure out the format by checking the extension stated in the </span><span class="No-Break"><span class="koboSpan" id="kobo.272.1">output filename.</span></span></p>
<h2 id="_idParaDest-234"><a id="_idTextAnchor234"/><span class="koboSpan" id="kobo.273.1">There’s more…</span></h2>
<p><span class="koboSpan" id="kobo.274.1">You can also convert an image into a PDF using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.275.1">QPdfWriter</span></strong><span class="koboSpan" id="kobo.276.1"> class provided by Qt. </span><span class="koboSpan" id="kobo.276.2">Essentially, you paint the selected image to the layout of a newly created PDF document and set its </span><span class="No-Break"><span class="koboSpan" id="kobo.277.1">resolution accordingly.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.278.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.279.1">For more information</span><a id="_idIndexMarker732"/><span class="koboSpan" id="kobo.280.1"> about the </span><strong class="source-inline"><span class="koboSpan" id="kobo.281.1">QPdfWriter</span></strong><span class="koboSpan" id="kobo.282.1"> class, </span><span class="No-Break"><span class="koboSpan" id="kobo.283.1">visit </span></span><a href="http://doc.qt.io/qt-6/qpdfwriter.html"><span class="No-Break"><span class="koboSpan" id="kobo.284.1">http://doc.qt.io/qt-6/qpdfwriter.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.285.1">.</span></span></p>
<h1 id="_idParaDest-235"><a id="_idTextAnchor235"/><span class="koboSpan" id="kobo.286.1">Converting videos</span></h1>
<p><span class="koboSpan" id="kobo.287.1">In this recipe, we will create a simple video</span><a id="_idIndexMarker733"/><span class="koboSpan" id="kobo.288.1"> converter using Qt and </span><strong class="bold"><span class="koboSpan" id="kobo.289.1">FFmpeg</span></strong><span class="koboSpan" id="kobo.290.1">, a leading multimedia framework that is free and open source. </span><span class="koboSpan" id="kobo.290.2">Although Qt supports playing video files through its widget, it does not currently support video conversion. </span><span class="koboSpan" id="kobo.290.3">Fear not! </span><span class="koboSpan" id="kobo.290.4">You can still achieve the same goal by making your program cooperate with another standalone program, through the </span><strong class="source-inline"><span class="koboSpan" id="kobo.291.1">QProcess</span></strong><span class="koboSpan" id="kobo.292.1"> class provided </span><span class="No-Break"><span class="koboSpan" id="kobo.293.1">by Qt.</span></span></p>
<h2 id="_idParaDest-236"><a id="_idTextAnchor236"/><span class="koboSpan" id="kobo.294.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.295.1">Let’s make a simple video converter </span><a id="_idIndexMarker734"/><span class="koboSpan" id="kobo.296.1">with the </span><span class="No-Break"><span class="koboSpan" id="kobo.297.1">following steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.298.1">Download </span><strong class="source-inline"><span class="koboSpan" id="kobo.299.1">FFmpeg</span></strong><span class="koboSpan" id="kobo.300.1"> (a static package) from </span><a href="http://ffmpeg.zeranoe.com/builds"><span class="koboSpan" id="kobo.301.1">http://ffmpeg.zeranoe.com/builds</span></a><span class="koboSpan" id="kobo.302.1"> and extract the contents to your preferred location – for </span><span class="No-Break"><span class="koboSpan" id="kobo.303.1">example, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.304.1">C:/FFmpeg/</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.305.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.306.1">Open Qt Creator and create a new </span><strong class="bold"><span class="koboSpan" id="kobo.307.1">Qt Widgets Application</span></strong><span class="koboSpan" id="kobo.308.1"> project by going to </span><strong class="bold"><span class="koboSpan" id="kobo.309.1">File</span></strong><span class="koboSpan" id="kobo.310.1"> | </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.311.1">New Project...</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.312.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.313.1">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.314.1">mainwindow.ui</span></strong><span class="koboSpan" id="kobo.315.1"> – we’re going to work on the program’s user interface. </span><span class="koboSpan" id="kobo.315.2">Its UI is very similar to the previous example, except that we add an extra text-edit widget to the canvas, just under </span><span class="No-Break"><span class="koboSpan" id="kobo.316.1">the combobox:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer175">
<span class="koboSpan" id="kobo.317.1"><img alt="Figure 11.7 – Design your video converter’s UI like this" src="image/B20976_11_007.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.318.1">Figure 11.7 – Design your video converter’s UI like this</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.319.1">Double-click the combobox, and then a window will appear to edit the box. </span><span class="koboSpan" id="kobo.319.2">We will add three items to the combobox list by clicking the </span><strong class="bold"><span class="koboSpan" id="kobo.320.1">+</span></strong><span class="koboSpan" id="kobo.321.1"> button three times, and then rename the items </span><strong class="source-inline"><span class="koboSpan" id="kobo.322.1">AVI</span></strong><span class="koboSpan" id="kobo.323.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.324.1">MP4</span></strong><span class="koboSpan" id="kobo.325.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.326.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.327.1">MOV</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.328.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer176">
<span class="koboSpan" id="kobo.329.1"><img alt="Figure 11.8 – Adding three video formats to the combobox" src="image/B20976_11_008.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.330.1">Figure 11.8 – Adding three video formats to the combobox</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.331.1">Right-click on one of the </span><a id="_idIndexMarker735"/><span class="koboSpan" id="kobo.332.1">push buttons, select </span><strong class="bold"><span class="koboSpan" id="kobo.333.1">Go to slot…</span></strong><span class="koboSpan" id="kobo.334.1">, and then click the </span><strong class="bold"><span class="koboSpan" id="kobo.335.1">OK</span></strong><span class="koboSpan" id="kobo.336.1"> button. </span><span class="koboSpan" id="kobo.336.2">A slot function will then be automatically added to your source files. </span><span class="koboSpan" id="kobo.336.3">Repeat this step for the other push button </span><span class="No-Break"><span class="koboSpan" id="kobo.337.1">as well.</span></span></li>
<li><span class="koboSpan" id="kobo.338.1">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.339.1">mainwindow.h</span></strong><span class="koboSpan" id="kobo.340.1"> and add the following headers to </span><span class="No-Break"><span class="koboSpan" id="kobo.341.1">the top:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.342.1">
#include &lt;QMainWindow&gt;
</span><strong class="bold"><span class="koboSpan" id="kobo.343.1">#include &lt;QFileDialog&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.344.1">#include &lt;QProcess&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.345.1">#include &lt;QMessageBox&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.346.1">#include &lt;QScrollBar&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.347.1">#include &lt;QDebug&gt;</span></strong></pre></li> <li><span class="koboSpan" id="kobo.348.1">Add the following pointers under the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.349.1">public</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.350.1"> keyword:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.351.1">
public:
    explicit MainWindow(QWidget *parent = 0);
    ~MainWindow();
</span><strong class="bold"><span class="koboSpan" id="kobo.352.1">QProcess* process;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.353.1">QString outputText;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.354.1">QString fileName;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.355.1">QString outputFileName;</span></strong></pre></li> <li><span class="koboSpan" id="kobo.356.1">Add three extra slot functions under the two functions that Qt created for us previously in the </span><em class="italic"><span class="koboSpan" id="kobo.357.1">Converting </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.358.1">images</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.359.1"> recipe:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.360.1">
private slots:
    void on_browseButton_clicked();
    void on_convertButton_clicked();
    void processStarted();
    void readyReadStandardOutput();
    void processFinished();</span></pre></li> <li><span class="koboSpan" id="kobo.361.1">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.362.1">mainwindow.cpp</span></strong><span class="koboSpan" id="kobo.363.1"> and </span><a id="_idIndexMarker736"/><span class="koboSpan" id="kobo.364.1">add the following code to the </span><span class="No-Break"><span class="koboSpan" id="kobo.365.1">class constructor:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.366.1">
MainWindow::MainWindow(QWidget *parent) :
    QMainWindow(parent), ui(new Ui::MainWindow) {
    ui-&gt;setupUi(this);
    </span><strong class="bold"><span class="koboSpan" id="kobo.367.1">process = new QProcess(this);</span></strong><span class="koboSpan" id="kobo.368.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.369.1">connect(process, QProcess::started, this,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.370.1">MainWindow::processStarted);</span></strong><span class="koboSpan" id="kobo.371.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.372.1">connect(process, QProcess::readyReadStandardOutput, this,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.373.1">MainWindow::readyReadStandardOutput);</span></strong><span class="koboSpan" id="kobo.374.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.375.1">connect(process, QProcess::finished, this,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.376.1">MainWindow::processFinished);</span></strong><span class="koboSpan" id="kobo.377.1">
}</span></pre></li> <li><span class="koboSpan" id="kobo.378.1">Define what will happen when the </span><strong class="bold"><span class="koboSpan" id="kobo.379.1">Browse</span></strong><span class="koboSpan" id="kobo.380.1"> button is clicked, which in this case is opening up the file dialog to allow us to choose the </span><span class="No-Break"><span class="koboSpan" id="kobo.381.1">video file:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.382.1">
void MainWindow::on_browseButton_clicked() {
    QString fileName = QFileDialog::getOpenFileName(this, "Open Video", "", "Video Files (*.avi *.mp4 *.mov)");
    ui-&gt;filePath-&gt;setText(fileName);
}</span></pre></li> <li><span class="koboSpan" id="kobo.383.1">Define what will happen if the </span><strong class="bold"><span class="koboSpan" id="kobo.384.1">Convert</span></strong><span class="koboSpan" id="kobo.385.1"> button is clicked. </span><span class="koboSpan" id="kobo.385.2">Here, we pass the filenames and </span><a id="_idIndexMarker737"/><span class="koboSpan" id="kobo.386.1">arguments to </span><strong class="source-inline"><span class="koboSpan" id="kobo.387.1">FFmpeg</span></strong><span class="koboSpan" id="kobo.388.1">, which will then handle the conversion </span><span class="No-Break"><span class="koboSpan" id="kobo.389.1">process externally:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.390.1">
void MainWindow::on_convertButton_clicked() {
    QString ffmpeg = "C:/FFmpeg/bin/ffmpeg";
    QStringList arguments;
    fileName = ui-&gt;filePath-&gt;text();
    if (fileName != "") {
        QFileInfo fileInfo = QFileInfo(fileName);
        outputFileName = fileInfo.path() + "/" +
fileInfo.completeBaseName();</span></pre></li> <li><span class="koboSpan" id="kobo.391.1">Check for the file’s format – specifically, whether it’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.392.1">.avi</span></strong><span class="koboSpan" id="kobo.393.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.394.1">.mp4</span></strong><span class="koboSpan" id="kobo.395.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.396.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.397.1">.mov</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.398.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.399.1">
        if (QFile::exists(fileName)) {
            int format = ui-&gt;fileFormat-&gt;currentIndex();
            if (format == 0) {
                outputFileName += ".avi"; // AVI
            }
            else if (format == 1) {
                outputFileName += ".mp4"; // MP4
            }
            else if (format == 2) {
                outputFileName += ".mov"; // MOV
            }</span></pre></li> <li><span class="koboSpan" id="kobo.400.1">Start the conversion using the </span><span class="No-Break"><span class="koboSpan" id="kobo.401.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.402.1">
            qDebug() &lt;&lt; outputFileName &lt;&lt; format;
            arguments &lt;&lt; "-i" &lt;&lt; fileName &lt;&lt; outputFileName;
            qDebug() &lt;&lt; arguments;
            process-&gt;setProcessChannelMode(QProcess::MergedChannels);
            process-&gt;start(ffmpeg, arguments);
        }</span></pre></li> <li><span class="koboSpan" id="kobo.403.1">Display the </span><span class="No-Break"><span class="koboSpan" id="kobo.404.1">message </span></span><span class="No-Break"><a id="_idIndexMarker738"/></span><span class="No-Break"><span class="koboSpan" id="kobo.405.1">boxes:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.406.1">
        else {
            QMessageBox::warning(this, "Failed", "Failed to open video file.");
        }
    }
    else {
        QMessageBox::warning(this, "Failed", "No file is selected.");
    }
}</span></pre></li> <li><span class="koboSpan" id="kobo.407.1">Tell the program what to do when the conversion process </span><span class="No-Break"><span class="koboSpan" id="kobo.408.1">has started:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.409.1">
void MainWindow::processStarted() {
    qDebug() &lt;&lt; "Process started.";
    ui-&gt;browseButton-&gt;setEnabled(false);
    ui-&gt;fileFormat-&gt;setEditable(false);
    ui-&gt;convertButton-&gt;setEnabled(false);
}</span></pre></li> <li><span class="koboSpan" id="kobo.410.1">Write the slot function that gets called during the conversion process whenever </span><strong class="source-inline"><span class="koboSpan" id="kobo.411.1">FFmpeg</span></strong><span class="koboSpan" id="kobo.412.1"> returns an output</span><a id="_idIndexMarker739"/><span class="koboSpan" id="kobo.413.1"> to </span><span class="No-Break"><span class="koboSpan" id="kobo.414.1">the program:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.415.1">
void MainWindow::readyReadStandardOutput() {
    outputText += process-&gt;readAllStandardOutput();
    ui-&gt;outputDisplay-&gt;setText(outputText);
    ui-&gt;outputDisplay-&gt;verticalScrollBar()-&gt;setSliderPosition(ui-&gt;outputDisplay-&gt;verticalScrollBar()-&gt;maximum());
}</span></pre></li> <li><span class="koboSpan" id="kobo.416.1">Define the slot function that gets called when the entire conversion process has </span><span class="No-Break"><span class="koboSpan" id="kobo.417.1">been completed:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.418.1">
void MainWindow::processFinished() {
    qDebug() &lt;&lt; "Process finished.";
    if (QFile::exists(outputFileName)) {
        QMessageBox::information(this, "Success", "Video successfully converted.");
    }
    else {
        QMessageBox::information(this, "Failed", "Failed to convert video.");
    }
    ui-&gt;browseButton-&gt;setEnabled(true);
    ui-&gt;fileFormat-&gt;setEditable(true);
    ui-&gt;convertButton-&gt;setEnabled(true);
}</span></pre></li> <li><span class="koboSpan" id="kobo.419.1">Build and run the project, and </span><a id="_idIndexMarker740"/><span class="koboSpan" id="kobo.420.1">you should get a simple, yet workable, </span><span class="No-Break"><span class="koboSpan" id="kobo.421.1">video converter:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer177">
<span class="koboSpan" id="kobo.422.1"><img alt="Figure 11.9 – Your own video converter powered by FFmpeg and Qt" src="image/B20976_11_009.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.423.1">Figure 11.9 – Your own video converter powered by FFmpeg and Qt</span></p>
<h2 id="_idParaDest-237"><a id="_idTextAnchor237"/><span class="koboSpan" id="kobo.424.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.425.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.426.1">QProcess</span></strong><span class="koboSpan" id="kobo.427.1"> class provided by Qt is used to start external programs and communicate with them. </span><span class="koboSpan" id="kobo.427.2">In this case, we started </span><strong class="source-inline"><span class="koboSpan" id="kobo.428.1">ffmpeg.exe</span></strong><span class="koboSpan" id="kobo.429.1">, located in </span><strong class="source-inline"><span class="koboSpan" id="kobo.430.1">C:/FFmpeg/bin/</span></strong><span class="koboSpan" id="kobo.431.1">, as a process and started communicating with it. </span><span class="koboSpan" id="kobo.431.2">We also sent it a set of arguments to tell it what to do when it started. </span><span class="koboSpan" id="kobo.431.3">The arguments we used in this example are relatively basic – we only told </span><strong class="source-inline"><span class="koboSpan" id="kobo.432.1">FFmpeg</span></strong><span class="koboSpan" id="kobo.433.1"> the path to the source image and the </span><span class="No-Break"><span class="koboSpan" id="kobo.434.1">output filename.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.435.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.436.1">For more information regarding the argument settings available in </span><strong class="source-inline"><span class="koboSpan" id="kobo.437.1">FFmpeg</span></strong><span class="koboSpan" id="kobo.438.1">, check </span><span class="No-Break"><span class="koboSpan" id="kobo.439.1">out </span></span><a href="http://www.ffmpeg.org/ffmpeg.html"><span class="No-Break"><span class="koboSpan" id="kobo.440.1">www.ffmpeg.org/ffmpeg.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.441.1">.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.442.1">FFmpeg</span></strong><span class="koboSpan" id="kobo.443.1"> does more than just convert video files. </span><span class="koboSpan" id="kobo.443.2">You can also use it to convert audio files </span><span class="No-Break"><span class="koboSpan" id="kobo.444.1">and images.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.445.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.446.1">For more information regarding all the formats supported by </span><strong class="source-inline"><span class="koboSpan" id="kobo.447.1">FFmpeg</span></strong><span class="koboSpan" id="kobo.448.1">, check </span><span class="No-Break"><span class="koboSpan" id="kobo.449.1">out </span></span><a href="https://www.ffmpeg.org/general.html#File-Formats"><span class="No-Break"><span class="koboSpan" id="kobo.450.1">https://www.ffmpeg.org/general.html#File-Formats</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.451.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.452.1">Other than that, you can also play a </span><a id="_idIndexMarker741"/><span class="koboSpan" id="kobo.453.1">video or audio file by running </span><strong class="source-inline"><span class="koboSpan" id="kobo.454.1">ffplay.exe</span></strong><span class="koboSpan" id="kobo.455.1">, located in </span><strong class="source-inline"><span class="koboSpan" id="kobo.456.1">C:/FFmpeg/bin</span></strong><span class="koboSpan" id="kobo.457.1">, or print out the information of the video or audio file in a human-readable fashion by </span><span class="No-Break"><span class="koboSpan" id="kobo.458.1">running </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.459.1">ffprobe.exe</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.460.1">.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.461.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.462.1">Check out </span><strong class="source-inline"><span class="koboSpan" id="kobo.463.1">FFmpeg's</span></strong><span class="koboSpan" id="kobo.464.1"> full documentation </span><span class="No-Break"><span class="koboSpan" id="kobo.465.1">at </span></span><a href="https://www.ffmpeg.org/about.html"><span class="No-Break"><span class="koboSpan" id="kobo.466.1">https://www.ffmpeg.org/about.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.467.1">.</span></span></p>
<h2 id="_idParaDest-238"><a id="_idTextAnchor238"/><span class="koboSpan" id="kobo.468.1">There’s more…</span></h2>
<p><span class="koboSpan" id="kobo.469.1">There are lots of things you can do using this method. </span><span class="koboSpan" id="kobo.469.2">You’re not limited to what Qt provides, and you can break out of such limitations by carefully selecting a third-party program that provides what you need. </span><span class="koboSpan" id="kobo.469.3">One such example is making your own antivirus GUI by utilizing the </span><a id="_idIndexMarker742"/><span class="koboSpan" id="kobo.470.1">command-line-only antivirus scanners available on the market, such as </span><strong class="bold"><span class="koboSpan" id="kobo.471.1">Avira ScanCL</span></strong><span class="koboSpan" id="kobo.472.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.473.1">Panda Antivirus Command Line Scanner</span></strong><span class="koboSpan" id="kobo.474.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.475.1">SAV32CLI</span></strong><span class="koboSpan" id="kobo.476.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.477.1">ClamAV</span></strong><span class="koboSpan" id="kobo.478.1">. </span><span class="koboSpan" id="kobo.478.2">You can </span><a id="_idIndexMarker743"/><span class="koboSpan" id="kobo.479.1">build your </span><a id="_idIndexMarker744"/><span class="koboSpan" id="kobo.480.1">own GUI using Qt</span><a id="_idIndexMarker745"/><span class="koboSpan" id="kobo.481.1"> and essentially send commands to the antivirus process to tell it what </span><span class="No-Break"><span class="koboSpan" id="kobo.482.1">to do.</span></span></p>
<h1 id="_idParaDest-239"><a id="_idTextAnchor239"/><span class="koboSpan" id="kobo.483.1">Converting currency</span></h1>
<p><span class="koboSpan" id="kobo.484.1">In this example, we will learn how to </span><a id="_idIndexMarker746"/><span class="koboSpan" id="kobo.485.1">create a simple currency converter using Qt, with the </span><a id="_idIndexMarker747"/><span class="koboSpan" id="kobo.486.1">help of an external service provider </span><span class="No-Break"><span class="koboSpan" id="kobo.487.1">called </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.488.1">Fixer.io</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.489.1">.</span></span></p>
<h2 id="_idParaDest-240"><a id="_idTextAnchor240"/><span class="koboSpan" id="kobo.490.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.491.1">Make yourself a currency converter by following these </span><span class="No-Break"><span class="koboSpan" id="kobo.492.1">simple steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.493.1">Open Qt Creator and create a new </span><strong class="bold"><span class="koboSpan" id="kobo.494.1">Qt Widgets Application</span></strong><span class="koboSpan" id="kobo.495.1"> project from </span><strong class="bold"><span class="koboSpan" id="kobo.496.1">File</span></strong><span class="koboSpan" id="kobo.497.1"> | </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.498.1">New Project...</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.499.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.500.1">Open the project file (</span><strong class="source-inline"><span class="koboSpan" id="kobo.501.1">.pro</span></strong><span class="koboSpan" id="kobo.502.1">) and add the network module to </span><span class="No-Break"><span class="koboSpan" id="kobo.503.1">our project:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.504.1">
QT += core gui </span><strong class="bold"><span class="koboSpan" id="kobo.505.1">network</span></strong></pre></li> <li><span class="koboSpan" id="kobo.506.1">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.507.1">mainwindow.ui</span></strong><span class="koboSpan" id="kobo.508.1"> and remove the menu bar, toolbar, and status bar from </span><span class="No-Break"><span class="koboSpan" id="kobo.509.1">the UI.</span></span></li>
<li><span class="koboSpan" id="kobo.510.1">Add three horizontal layouts, a horizontal line, and a push button to the canvas. </span><span class="koboSpan" id="kobo.510.2">Left-click on the canvas, and continue by clicking the </span><strong class="bold"><span class="koboSpan" id="kobo.511.1">Lay Out Vertically</span></strong><span class="koboSpan" id="kobo.512.1"> button on top of the canvas. </span><span class="koboSpan" id="kobo.512.2">Change the label of the push button to </span><strong class="source-inline"><span class="koboSpan" id="kobo.513.1">Convert</span></strong><span class="koboSpan" id="kobo.514.1">. </span><span class="koboSpan" id="kobo.514.2">The UI should look something </span><span class="No-Break"><span class="koboSpan" id="kobo.515.1">like this:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer178">
<span class="koboSpan" id="kobo.516.1"><img alt="Figure 11.10 – Place three vertical layouts above the Convert button" src="image/B20976_11_010.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.517.1">Figure 11.10 – Place three vertical layouts above the Convert button</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.518.1">Add two labels to the top layout, and set the text of the left one to </span><strong class="source-inline"><span class="koboSpan" id="kobo.519.1">From:</span></strong><span class="koboSpan" id="kobo.520.1">, followed by the right one to </span><strong class="source-inline"><span class="koboSpan" id="kobo.521.1">To:</span></strong><span class="koboSpan" id="kobo.522.1">. </span><span class="koboSpan" id="kobo.522.2">Add two </span><strong class="bold"><span class="koboSpan" id="kobo.523.1">Line Edit</span></strong><span class="koboSpan" id="kobo.524.1"> widgets to the second layout, and set both their default values </span><span class="No-Break"><span class="koboSpan" id="kobo.525.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.526.1">1</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.527.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer179">
<span class="koboSpan" id="kobo.528.1"><img alt="Figure 11.11 – Add labels and Line Edit widgets to the layouts" src="image/B20976_11_011.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.529.1">Figure 11.11 – Add labels and Line Edit widgets to the layouts</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.530.1">Select the line edit on the right </span><a id="_idIndexMarker748"/><span class="koboSpan" id="kobo.531.1">and enable the </span><strong class="bold"><span class="koboSpan" id="kobo.532.1">readOnly</span></strong><span class="koboSpan" id="kobo.533.1"> checkbox located in the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.534.1">Property</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.535.1"> pane:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer180">
<span class="koboSpan" id="kobo.536.1"><img alt="Figure 11.12 – Enable the readOnly property for the second line edit" src="image/B20976_11_012.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.537.1">Figure 11.12 – Enable the readOnly property for the second line edit</span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.538.1">Set the cursor property to </span><strong class="bold"><span class="koboSpan" id="kobo.539.1">Forbidden</span></strong><span class="koboSpan" id="kobo.540.1"> so that users know it’s not editable when hovering the mouse over </span><span class="No-Break"><span class="koboSpan" id="kobo.541.1">the widget:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer181">
<span class="koboSpan" id="kobo.542.1"><img alt="Figure 11.13 – Display the Forbidden cursor to let users know it’s disabled" src="image/B20976_11_013.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.543.1">Figure 11.13 – Display the Forbidden cursor to let users know it’s disabled</span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.544.1">Add two comboboxes to the third layout located at the bottom. </span><span class="koboSpan" id="kobo.544.2">We will leave them empty </span><span class="No-Break"><span class="koboSpan" id="kobo.545.1">for now:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer182">
<span class="koboSpan" id="kobo.546.1"><img alt="Figure 11.14 – Add two comboboxes to the final layout" src="image/B20976_11_014.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.547.1">Figure 11.14 – Add two comboboxes to the final layout</span></p>
<ol>
<li value="9"><span class="koboSpan" id="kobo.548.1">Right-click on the </span><strong class="bold"><span class="koboSpan" id="kobo.549.1">Convert</span></strong><span class="koboSpan" id="kobo.550.1"> button</span><a id="_idIndexMarker749"/><span class="koboSpan" id="kobo.551.1"> and select </span><strong class="bold"><span class="koboSpan" id="kobo.552.1">Go to slot…</span></strong><span class="koboSpan" id="kobo.553.1">. </span><span class="koboSpan" id="kobo.553.2">A window will pop up, asking you to select an appropriate signal. </span><span class="koboSpan" id="kobo.553.3">Let’s keep the default </span><strong class="source-inline"><span class="koboSpan" id="kobo.554.1">clicked()</span></strong><span class="koboSpan" id="kobo.555.1"> signal as the selection and click </span><strong class="bold"><span class="koboSpan" id="kobo.556.1">OK</span></strong><span class="koboSpan" id="kobo.557.1">. </span><span class="koboSpan" id="kobo.557.2">Qt Creator will automatically add a slot function to both </span><strong class="source-inline"><span class="koboSpan" id="kobo.558.1">mainwindow.h</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.559.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.560.1">mainwindow.cpp</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.561.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.562.1">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.563.1">mainwindow.h</span></strong><span class="koboSpan" id="kobo.564.1"> and make sure the following headers are added to the top of the </span><span class="No-Break"><span class="koboSpan" id="kobo.565.1">source file:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.566.1">
#include &lt;QMainWindow&gt;
</span><strong class="bold"><span class="koboSpan" id="kobo.567.1">#include &lt;QDoubleValidator&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.568.1">#include &lt;QNetworkAccessManager&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.569.1">#include &lt;QNetworkRequest&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.570.1">#include &lt;QNetworkReply&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.571.1">#include &lt;QJsonDocument&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.572.1">#include &lt;QJsonObject&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.573.1">#include &lt;QDebug&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.574.1">#include &lt;QMessageBox&gt;</span></strong></pre></li> <li><span class="koboSpan" id="kobo.575.1">Add another slot function, </span><span class="No-Break"><span class="koboSpan" id="kobo.576.1">called </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.577.1">finished()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.578.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.579.1">
private slots:
    void on_convertButton_clicked();
    void finished(QNetworkReply* reply);</span></pre></li> <li><span class="koboSpan" id="kobo.580.1">Add two variables under the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.581.1">private</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.582.1"> label:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.583.1">
private:
    Ui::MainWindow *ui;
    QNetworkAccessManager* manager;
    QString targetCurrency;</span></pre></li> <li><span class="koboSpan" id="kobo.584.1">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.585.1">mainwindow.cpp</span></strong><span class="koboSpan" id="kobo.586.1"> file. </span><span class="koboSpan" id="kobo.586.2">Add several currency short code to both comboboxes in the class </span><a id="_idIndexMarker750"/><span class="koboSpan" id="kobo.587.1">constructor. </span><span class="koboSpan" id="kobo.587.2">Set a validator to the </span><strong class="bold"><span class="koboSpan" id="kobo.588.1">Line Edit</span></strong><span class="koboSpan" id="kobo.589.1"> widget on the left so that it can only accept inputs that are numbers. </span><span class="koboSpan" id="kobo.589.2">Initialize the network access manager and connect its </span><strong class="source-inline"><span class="koboSpan" id="kobo.590.1">finished()</span></strong><span class="koboSpan" id="kobo.591.1"> signal to our </span><strong class="source-inline"><span class="koboSpan" id="kobo.592.1">finished()</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.593.1">slot function:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.594.1">
MainWindow::MainWindow(QWidget *parent) :
    QMainWindow(parent), ui(new Ui::MainWindow) {
    ui-&gt;setupUi(this);
    </span><strong class="bold"><span class="koboSpan" id="kobo.595.1">QStringList currencies;</span></strong><span class="koboSpan" id="kobo.596.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.597.1">currencies.push_back("EUR");</span></strong><span class="koboSpan" id="kobo.598.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.599.1">currencies.push_back("USD");</span></strong><span class="koboSpan" id="kobo.600.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.601.1">currencies.push_back("CAD");</span></strong><span class="koboSpan" id="kobo.602.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.603.1">currencies.push_back("MYR");</span></strong><span class="koboSpan" id="kobo.604.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.605.1">currencies.push_back("GBP");</span></strong></pre></li> <li><span class="koboSpan" id="kobo.606.1">We continue from the previous code and insert the currency short forms into the comboboxes. </span><span class="koboSpan" id="kobo.606.2">Then, we declare a new network access manager and connect its finished signal to our custom </span><span class="No-Break"><span class="koboSpan" id="kobo.607.1">slot function:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.608.1">
    ui-&gt;currencyFrom-&gt;insertItems(0, currencies);
    ui-&gt;currencyTo-&gt;insertItems(0, currencies);
    QValidator *inputRange = new QDoubleValidator(this);
    ui-&gt;amountFrom-&gt;setValidator(inputRange);
    manager = new QNetworkAccessManager(this);
    connect(manager, &amp;QNetworkAccessManager::finished, this, &amp;MainWindow::finished);
}</span></pre></li> <li><span class="koboSpan" id="kobo.609.1">Define what will happen</span><a id="_idIndexMarker751"/><span class="koboSpan" id="kobo.610.1"> if the </span><strong class="bold"><span class="koboSpan" id="kobo.611.1">Convert</span></strong><span class="koboSpan" id="kobo.612.1"> button is clicked by </span><span class="No-Break"><span class="koboSpan" id="kobo.613.1">the user:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.614.1">
void MainWindow::on_convertButton_clicked() {
    if (ui-&gt;amountFrom-&gt;text() != "") {
        ui-&gt;convertButton-&gt;setEnabled(false);
        QString from = ui-&gt;currencyFrom-&gt;currentText();
        QString to = ui-&gt;currencyTo-&gt;currentText();
        targetCurrency = to;
        QString url = "http://data.fixer.io/api/latest?base=" +      from + "&amp;symbols=" + to + "&amp;access_key=YOUR_KEY";</span></pre></li> <li><span class="koboSpan" id="kobo.615.1">Start the request by</span><a id="_idIndexMarker752"/> <span class="No-Break"><span class="koboSpan" id="kobo.616.1">calling </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.617.1">get()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.618.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.619.1">
        QNetworkRequest request = QNetworkRequest(QUrl(url));
        manager-&gt;get(request);
    }
    else {
        QMessageBox::warning(this, "Error", "Please insert a value.");
    }
}</span></pre></li> <li><span class="koboSpan" id="kobo.620.1">Define what will happen when the </span><strong class="source-inline"><span class="koboSpan" id="kobo.621.1">finished()</span></strong><span class="koboSpan" id="kobo.622.1"> signal </span><span class="No-Break"><span class="koboSpan" id="kobo.623.1">is triggered:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.624.1">
void MainWindow::finished(QNetworkReply* reply) {
    QByteArray response = reply-&gt;readAll();
    qDebug() &lt;&lt; response;
    QJsonDocument jsonResponse =
QJsonDocument::fromJson(response);
    QJsonObject jsonObj = jsonResponse.object();
    QJsonObject jsonObj2 = jsonObj.value("rates").toObject();
    double rate = jsonObj2.value(targetCurrency).toDouble();</span></pre></li> <li><span class="koboSpan" id="kobo.625.1">Continue to write the code from the preceding code, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.626.1">following snippet:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.627.1">
    if (rate == 0)
        rate = 1;
    double amount = ui-&gt;amountFrom-&gt;text().toDouble();
    double result = amount * rate;
    ui-&gt;amountTo-&gt;setText(QString::number(result));
    ui-&gt;convertButton-&gt;setEnabled(true);
}</span></pre></li> <li><span class="koboSpan" id="kobo.628.1">Compile and run the project, and</span><a id="_idIndexMarker753"/><span class="koboSpan" id="kobo.629.1"> then you should get a simple currency converter that looks </span><span class="No-Break"><span class="koboSpan" id="kobo.630.1">like this:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer183">
<span class="koboSpan" id="kobo.631.1"><img alt="Figure 11.15 – A usable currency converter is complete" src="image/B20976_11_015.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.632.1">Figure 11.15 – A usable currency converter is complete</span></p>
<h2 id="_idParaDest-241"><a id="_idTextAnchor241"/><span class="koboSpan" id="kobo.633.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.634.1">Similar to the previous example we saw, which uses an external program to achieve a specific task, this time we used an external service provider that provided us with an open </span><strong class="bold"><span class="koboSpan" id="kobo.635.1">Application Programming Interface</span></strong><span class="koboSpan" id="kobo.636.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.637.1">API</span></strong><span class="koboSpan" id="kobo.638.1">) that</span><a id="_idIndexMarker754"/><span class="koboSpan" id="kobo.639.1"> is free for all and easy </span><span class="No-Break"><span class="koboSpan" id="kobo.640.1">to use.</span></span></p>
<p><span class="koboSpan" id="kobo.641.1">This way, we don’t have to think about the method used to retrieve the latest currency rate. </span><span class="koboSpan" id="kobo.641.2">Instead, the service provider has already done the job for us; we just have to send a polite request for it. </span><span class="koboSpan" id="kobo.641.3">Then, we wait for the response from their server and process the data according to our </span><span class="No-Break"><span class="koboSpan" id="kobo.642.1">intended purposes.</span></span></p>
<p><span class="koboSpan" id="kobo.643.1">There are quite a few different </span><a id="_idIndexMarker755"/><span class="koboSpan" id="kobo.644.1">service providers you can choose from, besides Fixer.io (</span><a href="http://fixer.io"><span class="koboSpan" id="kobo.645.1">http://fixer.io</span></a><span class="koboSpan" id="kobo.646.1">). </span><span class="koboSpan" id="kobo.646.2">Some are free but come </span><a id="_idIndexMarker756"/><span class="koboSpan" id="kobo.647.1">without any advanced features; some provide you with a premium price. </span><span class="koboSpan" id="kobo.647.2">Some of these alternatives are </span><strong class="bold"><span class="koboSpan" id="kobo.648.1">Open Exchange Rates</span></strong><span class="koboSpan" id="kobo.649.1"> (</span><a href="https://openexchangerates.org"><span class="koboSpan" id="kobo.650.1">https://openexchangerates.org</span></a><span class="koboSpan" id="kobo.651.1">), the </span><strong class="bold"><span class="koboSpan" id="kobo.652.1">currencylayer API</span></strong><span class="koboSpan" id="kobo.653.1"> (</span><a href="https://currencylayer.com"><span class="koboSpan" id="kobo.654.1">https://currencylayer.com</span></a><span class="koboSpan" id="kobo.655.1">), the </span><strong class="bold"><span class="koboSpan" id="kobo.656.1">Currency API</span></strong><span class="koboSpan" id="kobo.657.1"> (</span><a href="https://currency-api.appspot.com"><span class="koboSpan" id="kobo.658.1">https://currency-api.appspot.com</span></a><span class="koboSpan" id="kobo.659.1">), the </span><strong class="bold"><span class="koboSpan" id="kobo.660.1">XE Currency Data API</span></strong><span class="koboSpan" id="kobo.661.1"> (</span><a href="http://www.xe.com/xecurrencydata"><span class="koboSpan" id="kobo.662.1">http://www.xe.com/xecurrencydata</span></a><span class="koboSpan" id="kobo.663.1">), and </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.664.1">jsonrates</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.665.1"> (</span></span><a href="http://jsonrates.com"><span class="No-Break"><span class="koboSpan" id="kobo.666.1">http://jsonrates.com</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.667.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.668.1">In the</span><a id="_idIndexMarker757"/><span class="koboSpan" id="kobo.669.1"> previous code, you </span><a id="_idIndexMarker758"/><span class="koboSpan" id="kobo.670.1">should have noticed an access key being </span><a id="_idIndexMarker759"/><span class="koboSpan" id="kobo.671.1">passed to the Fixer.io API, which is a free access </span><a id="_idIndexMarker760"/><span class="koboSpan" id="kobo.672.1">key I registered for this tutorial. </span><span class="koboSpan" id="kobo.672.2">If you use it for your own project, you should create an account </span><span class="No-Break"><span class="koboSpan" id="kobo.673.1">at Fixer.io.</span></span></p>
<h2 id="_idParaDest-242"><a id="_idTextAnchor242"/><span class="koboSpan" id="kobo.674.1">There’s more…</span></h2>
<p><span class="koboSpan" id="kobo.675.1">Besides currency exchange rates, you</span><a id="_idIndexMarker761"/><span class="koboSpan" id="kobo.676.1"> can use this method to execute more advanced tasks that are perhaps too complicated to do by yourself, or are simply impossible to access unless you use the services provided by specialists, such as </span><a id="_idIndexMarker762"/><span class="koboSpan" id="kobo.677.1">programmable </span><strong class="bold"><span class="koboSpan" id="kobo.678.1">Short Message Service</span></strong><span class="koboSpan" id="kobo.679.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.680.1">SMS</span></strong><span class="koboSpan" id="kobo.681.1">) and voice services, web analytics and statistics generation, and online payment gateways. </span><span class="koboSpan" id="kobo.681.2">Most of these services are not free, but you can easily achieve those functions in minutes without even setting up the server infrastructure and backend system; it’s definitely the cheapest and fastest way to get your product up and running without </span><span class="No-Break"><span class="koboSpan" id="kobo.682.1">much hassle.</span></span></p>
</div>
</body></html>