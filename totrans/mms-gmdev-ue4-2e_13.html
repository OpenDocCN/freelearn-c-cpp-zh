<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Virtual Reality and Augmented Reality in UE4</h1>
                </header>
            
            <article>
                


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Introduction</h1>
                </header>
            
            <article>
                
<p>Two of the newest and most exciting additions to UE4 are its Virtual Reality (VR) and <strong>Augmented Reality</strong> (<strong>AR</strong>) integrations. While VR has been around for some time, AR was first fully functioning without any need for merging a custom branch or using experimental components mid-summer 2018 in version 4.20. While there is a huge world of both to explore, we'll keep to the focus of this book of building awareness and confidence in Unreal's systems in this chapter by building projects for both and working through some real world additions to them to learn what is involved. So get ready to explore the newest and arguably coolest new platforms in the Unreal world! Our final chapter here covers:</p>
<ul>
<li>Creating and modifying a VR project
<ul>
<li>Preparation for and deployment to an Android GearVR headset</li>
<li>Adding new motion-based controls to the project</li>
</ul>
</li>
<li>Creating and modifying an AR project
<ul>
<li>Preparation for and deployment to an Android phone</li>
<li>Porting our projectiles from the main project into our new AR game!</li>
</ul>
</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Technical requirements</h1>
                </header>
            
            <article>
                
<p>To keep focus on the tech of these new platforms, they will both be created as new standalone projects as noted above. While it is entirely possible to port our existing Mastering project to support VR and even AR, as noted numerous times in this book: major decisions like that are best made at the start of a project so they can be initially proven out, and then maintained throughout development. That said, in the AR project, we'll port over some of our work from the previous project to get a feel for how that goes also, giving a good test of how portable that work was when created. The two respective projects are in these branches in GitHub:</p>
<p>VR:</p>
<p><a href="https://github.com/PacktPublishing/Mastering-Game-Development-with-Unreal-Engine-4-Second-Edition/tree/Chapter-13-VR">https://github.com/PacktPublishing/Mastering-Game-Development-with-Unreal-Engine-4-Second-Edition/tree/Chapter-13-VR</a></p>
<p>AR:</p>
<p><a href="https://github.com/PacktPublishing/Mastering-Game-Development-with-Unreal-Engine-4-Second-Edition/tree/Chapter-13-AR">https://github.com/PacktPublishing/Mastering-Game-Development-with-Unreal-Engine-4-Second-Edition/tree/Chapter-13-AR</a></p>
<p>In addition, for the AR component, given the GearVR platform used, Google's ARCore app was also installed on my Galaxy Note 8 for Unreal integration without the previous large headache installing custom Google APIs. In this area (AR), 4.20 is a dream compared to previous integrations, both for iOS and especially Android, so it is highly recommended (though not specifically required) to update to at least 4.20 for this chapter.</p>
<p><span>Engine version used: 4.20.2.</span></p>
<div class="packt_infobox">Note: for those using Mac and iOS platforms, while I don't specifically cover those here, these are mainly blueprint project templates and the process will not vary too much, so feel free to go through the blueprint code &amp; code-migration and other points in this chapter, while substituting in "Finder" for "Explorer" and "XCode" for "Visual Studio" and "iPad/iPhone" for "Android," the only parts that might be most difficult were already covered in <span class="cdp-organizer-chapter-number"><a href="5fc16cd9-a5d9-4181-8373-0ad5775cc688.xhtml" target="_blank">Chapter 10</a>, <em>Packaging the Game (PC, Mobile).</em></span></div>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Making a VR project and adding new controls</h1>
                </header>
            
            <article>
                
<p>VR as I'm sure readers at this stage well know involves the user wearing a headset and the game or app presenting them with a 3D world they can explore immersed completely inside that view.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Making the initial VR project</h1>
                </header>
            
            <article>
                
<p>For those who have been with me the whole journey of this book, there will be a bit of review from <a href="dfc11944-e8b6-45b1-8997-5f1a59d0f8ac.xhtml" target="_blank">Chapter 1</a>, <em>Making a C++ Project for a First-Person Shooter</em>. It shouldn't be too much, though; but for those who wanted to skip straight to here, we won't skip any major steps. So first launch the Engine without a project specified, as noted in <kbd>Chapter 1</kbd> this can be done from your engine install directory itself, or hopefully those here since that chapter already have a shortcut built for it. When the Unreal Project Browser comes up, click the<span> </span><span class="packt_screen">New Project</span><span> </span>tab:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/63f49102-9d4a-4692-a4e2-3ac9c7e34a4c.png" style="width:43.00em;height:29.92em;"/></p>
<p class="mce-root"/>
<p class="mce-root"/>
<p>And select the Blueprint tab's<span> </span><span class="packt_screen">VR Project</span><span> </span>template, we'll set the content level to<span> </span><span class="packt_screen">Mobile / Tablet</span>, and remove<span> </span><span class="packt_screen">Starter Content</span><span> </span>(though I generally recommend keeping this in for prototyping as it gives some fun objects to play with, but does take up a fair deal of extra space). Of course you're welcome to name it whatever you like, but to match GitHub's files, go with the above, MasteringVR. After clicking the create button, it should automatically open up in the editor and for several platforms (PS4-VR, Oculus Rift, etc., the "wired" headsets) it is ready to deploy and test immediately.</p>
<p>For those who have been through the whole book, you'll also know I generally prefer to work in C++ for speed and debugging purposes, however, these templates currently exist for only as Blueprint templates. Now, that said, it's easy enough to add a C++ class and start compiling the project yourself, as will be done in the AR project. <em>However</em>, do note that this adds considerable time to your build iterations. In my case, 5-10 minutes <em>per use</em> of the Launch button in the editor, as each time it will recompile and re-sign your <kbd>.apk</kbd>. For those looking closely at GitHub, you'll notice at one point I was going to add code to a pawn class in a .cpp, but after noticing this issue, reverted back to full blueprint. If you stick to blueprint only as we will for this VR section, that iteration time can be less than a minute (total!) so consider wisely before you commit to C++ in projects like these where you are constantly having to deploy to hardware.</p>
<div class="packt_infobox">And keep in mind: the first time you build and deploy for a platform, it will need to compile all of the engine shaders and cook your content. After that first build, iteration times are as I describe above; but that first launch will be a bit slow and painful.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Building and deploying for GearVR</h1>
                </header>
            
            <article>
                
<p>Even with the handy VR project template, there are still a number of steps to get things working on the GearVR platform for those following my lead here and using a Samsung Android device.</p>
<div class="packt_infobox"><span>I'm a big fan of this platform for a number of reasons. First: no wires! The wired headsets are more powerful and bring some extra capabilities with them, but also that feeling you're tethered to a PC or PS4 all the time which I find distracting. Second: accessibility. While the store and platform are Samsung's and not Google's like other Android apps, a huge number of people own the S7 and on up line which all perform in my opinion very well in GearVR apps. Hopefully it catches on and maybe even Samsung and Google integrate their stores at some point; but for any with the option of trying these projects on such devices, I have had very good results.</span></div>
<p class="mce-root"/>
<p><span>So first, for any Android-based app, you need to go to <span class="packt_screen">Project Settings -&gt; Platforms -&gt; Android</span> and click the <span class="packt_screen">Configure Now</span> button at the top:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/4a3b46ba-0a30-49cc-9eea-9ff7a656caa2.png"/></p>
<p class="mce-root"/>
<p>After that, just below in its settings we need a few more things set:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/dd395905-d445-40c3-a046-c1cfd78657c0.png"/></p>
<p>Namely we need to set the SDK versions to 19 and Epic recommends setting the KitKat+ full screen immersive settings to true (though I didn't find this necessary in testing).</p>
<p>Next, scrolling down in the same section to <span class="packt_screen">Advanced APK Settings</span>, we need one more checkbox checked:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/fd1ed507-5001-43eb-9fec-bf18b1b2bbe9.png"/></p>
<p><span class="packt_screen">Configure the AndroidManifest for deployment to Oculus Mobile</span> is strictly needed, and for those extra observant, I went ahead and turned on OpenGL ES3.1 as any device that can use a GearVR headset (Galaxy S6+) will support it anyway and there's no reason to limit your shader options nor force yourself to recompile all those shaders later.</p>
<div class="packt_infobox">Note also, I tried enabling Vulkan as I am a fan of its hardware acceleration platform, but got a crash on startup with this basic project, so, at least for the moment, save yourself some trouble and leave it unchecked.</div>
<p class="mce-root"/>
<p>And two final minor notes. First, if you are going to launch from the editor as I typically do for iterating, set your startup map to the <span class="packt_screen">MotionControllerMap</span> as here, not the <span class="packt_screen">StartupMap</span> default:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/e85af292-3fa8-442e-8ae3-a7ed5631d058.png"/></p>
<p>For whatever reason, the GearVR controller doesn't activate in the <span class="packt_screen">StartupMap</span>, but works as we desire in the <span class="packt_screen">MotionControllerMap</span> just fine (which is the default game map anyway if you make a standalone .apk and install and run that). Note, you may have to click the tumbstick a couple of times before things show up properly, even here, it seems.</p>
<p>And lastly, you'll need to follow these directions to get a signing key from Oculus, but it's a much simpler process than most of those in the building and deploying chapter we had earlier:</p>
<p><a href="https://dashboard.oculus.com/tools/osig-generator/">https://dashboard.oculus.com/tools/osig-generator/</a></p>
<p>If you don't have that key in the folder it specifies, your app will crash on startup for being unsigned.</p>
<p>Now we can quickly make changes and view those in less than a minute on our GearVR headset!</p>
<div class="packt_tip">For those wanting to use the HMD (Head Mounted Display) pad itself, there's a great guide from Epic in Further Reading at the end.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding HMD controls</h1>
                </header>
            
            <article>
                
<p>Now that we're playing in the level and can teleport around with the thumbstick and if you can get close-enough to the blue boxes you can grab them and throw them using the trigger on the controller, it might be nice to move around in the level a bit without having to use the teleport exclusively. One way we could even free up the entire thumbstick for other uses is to make motion based on your head's orientation, using the HMD (Head Mounted Display) orientation itself as a means of conveying input.</p>
<p>However, this means the player can't really look up and down anymore freely without moving; but we'll put in a fix for that too. Let's get the player moving around via blueprint first using some simple logic based on the camera orientation. To do this, we'll do the work in the <span class="packt_screen">MotionControllerPawn</span> (found in Content/VirtualRealityBP/Blueprints in the content browser). <span>For this to actually work, however, we'll need to convert the pawn to a character. So as we've done in the past, open the blueprint, go to <span class="packt_screen">File</span></span> | <span><span class="packt_screen">Reparent Blueprint</span>, and pick <span class="packt_screen">Character</span>. Now, the default character has quite a tall capsule, and our previous pawn expected its origin to be on the ground, so let's just make its capsule small, doesn't have to be too tiny for this to all work ok, 34cm, its original radius, seems fine for the height too:</span></p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/0550ef53-2091-4404-8df9-4c7af1aa6f90.png"/></p>
<p class="mce-root"/>
<p>Next we'll add a new blueprint function and drag a pin off of the sequence node in event tick to call it:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/bdc12e7a-c3bb-47dc-887d-16d23d96ac22.png"/></p>
<p>In that function, we'll add some simple logic to move the player based on camera orientation. </p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/2b786955-108c-4449-b726-632e8701dfa9.png"/></p>
<p>As you can see at the start, the portion I mentioned earlier where we can disable the movement is done whenever any controller is trying to grab or teleport (and also we stop if the tilt is less than 10 degrees either way). This way the player can fully look around while doing those actions, but when not, tilting forward and back will move the player forward &amp; backward, while turning of course changes direction still. If desired, you could easily add strafing left and right by using the same logic with the roll of the camera, and a sideways movement vector.</p>
<p class="mce-root"/>
<p class="mce-root"/>
<p>With this addition, I actually find grabbing those boxes and throwing them around much easier than just by teleporting!</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/8d95f99e-2d76-47ab-9838-3df06c11a822.png"/></p>
<div class="packt_tip">In case you're curious about the screenshot above (which was from device running VR), I simply added an Execute Console Command node to blueprint that was triggered when I pulled the trigger on the controller, and it executed "HighResShot 1920x1280" (but of course you can make that resolution anything you want) and then retrieved them from the phone when it was plugged in from: <kbd>\Phone\UE4Game\MasteringVR\Saved\Screenshots\Android</kbd>.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Making an AR project and porting our projectiles</h1>
                </header>
            
            <article>
                
<p>AR is a field that has gained huge popularity over the past year, so it is great to see UE4 finally have a very solid and simple integration path and project template. For those new to it, Augmented Reality is rather different from VR as it does not take the user out of the real world and into a separate one, but rather integrates with the real world through a device which is either worn like the Microsoft's HoloLens, or the newly announced Magic Leap goggles, or held such as many current smartphones and tablets. AR takes real-world surroundings and integrates them to the app or game so the user can combine real world objects with in-game interactions. We'll get this started with its new project and then pull some code and assets from previous work into this branch to show that process now.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Making the initial AR project</h1>
                </header>
            
            <article>
                
<p>So much like in our first chapter and directly above in the VR section, this will be a bit of review; but since it's a project starting from scratch, it's always best to go through each step (so be ready for the Unreal Project Browser one more time!) So launching the engine without a project once more, gets us to the browser, where under the <span class="packt_screen">New Project</span> and <span class="packt_screen">Blueprint</span> tabs, you'll now find <span class="packt_screen">Handheld AR</span> as a template, select that, we set the content to <span class="packt_screen">Mobile / Tablet</span> again and no <span class="packt_screen">Starter Content</span> (unless you want it of course).</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/1421e8fe-5a96-4825-a500-1ba1e2585a6e.png"/></p>
<p>And as usual, this should now be opened up in your editor so we can begin work right away!</p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Android deployment specifics</h1>
                </header>
            
            <article>
                
<p>There was much less to do here than in the VR section, but the same critical start has to be made, configuring for Android:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/d4a7eb91-088a-40b2-be92-98aa8a6b70dd.png"/></p>
<p>Like in VR or again, any Android project, be sure to head to <span class="packt_screen">Project Settings</span> | <span class="packt_screen">Platforms</span> | <span class="packt_screen">Android</span>, and click the <span class="packt_screen">Configure Now</span> button. As you can see below that in this template, it has already done other work we had to do for VR like setting APK versions for you.</p>
<p>In truth, this was all that was needed to get the basic AR game running on my device, from there you can tap to add some shapes to the world and use the debug menus to get a feel for what work UE4 AR is doing and visualize how well it is doing it.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Porting our projectiles and firing them in AR</h1>
                </header>
            
            <article>
                
<p>Now we'll make things more interesting by pulling our projectiles from the earlier project in to this AR demo in all their glory. First, though, we'll need to add the source files to the proper folder and then generate project files. To do this, I've made two copies of the project on my local hard drive (which makes GitHub a bit tricky to handle as they're both branches in the same repository); but to keep things simple, I'll work locally with a copy of this branch (simply cut &amp; paste to a new folder):</p>
<p><a href="https://github.com/PacktPublishing/Mastering-Game-Development-with-Unreal-Engine-4-Second-Edition/tree/Chapter-13-AR">https://github.com/PacktPublishing/Mastering-Game-Development-with-Unreal-Engine-4-Second-Edition/tree/Chapter-13-AR</a></p>
<p>And have <kbd>chapter 12</kbd>'s branch here in my normal GitHub local drive location:</p>
<p><a href="https://github.com/PacktPublishing/Mastering-Game-Development-with-Unreal-Engine-4-Second-Edition/tree/Chapter-12">https://github.com/PacktPublishing/Mastering-Game-Development-with-Unreal-Engine-4-Second-Edition/tree/Chapter-12</a></p>
<p>This way I can cherry-pick items from <kbd>chapter 12</kbd> into the AR project. In the end, it's a bit complicated, but I'll simply delete my local <kbd>chapter 12</kbd> files and folders when done, <em>except</em> the <kbd>.git</kbd> hidden folder for git's information, then move (or rename) the local AR to that location and switch branches back to the AR project and check in those specific changes. Git can be tricky in cases like this, but right now we're just trying to have some fun in an AR environment and see what we can do, so let's get to it!</p>
<p>Copying the source files as noted was the first step, just simply take <kbd>chapter 12</kbd>'s <kbd>MasteringProjectile.h</kbd> and <kbd>.cpp</kbd> files, and move them in to the <kbd>MasteringAR/Source</kbd> folder. Once that's done, we can right click on the <kbd>MasteringAR.uproj</kbd> file and generate project files with our UE4 version, or use a batch file as we have in the past to make sure we have VS 2017 files. Now we can build and run the editor as normal and deploy the project as well. Keep in mind, though, as a C++ project now, iteration times will increase significantly between runs on the device as it will compile code each time it deploys; but that's what we need to do here to get our projectiles firing with all their code of course we built over previous chapters.</p>
<div class="packt_tip">In full disclosure: I actually had to, from the UE4 AR project here, name it Mastering.uproject, add a new C++ class of MasteringProjectile (based on the Actor class), and then copy-paste the code from the main project into this one for the migrated assets to find their parent class properly. In the past, the copy-paste file-version above has worked fine, but in case anyone has trouble, try this one as a last resort as I did.</div>
<p>A bit unfortunately, we actually need to launch the <kbd>chapter 12</kbd> project to migrate the assets from there, to our AR project. So open it in the editor and we'll browse to the projectiles section of our blueprints and right click on one of them. You'll see this pop-up and under <span class="packt_screen">Asset Actions</span> is <span class="packt_screen">Migrate</span>.</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/8d521690-14e9-4354-a715-93f27d73fac0.png"/></p>
<p class="mce-root"/>
<p class="mce-root"/>
<p>The next thing that will pop-up is a list, basically, of all the dependencies that Unreal is telling you it will copy, just click <span class="packt_screen">ok</span>:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/b1d0f31d-1318-4e97-aa41-7fabef4fb792.png" style="width:38.83em;height:34.00em;"/></p>
<p class="mce-root"/>
<p>Now we just need to point to our Content folder in the AR project's Content folder, and those projectiles and all their asset dependencies (the special FX we did in <a href="3555f7d2-c20d-48b4-97ba-748a9bd16a13.xhtml" target="_blank"/><a href="3555f7d2-c20d-48b4-97ba-748a9bd16a13.xhtml" target="_blank">Chapter 12</a>, <em><span>In-Scene Video and Visual Effects</span></em><span>, and so on</span><span>, will all be brought with it). Migrating assets like this is a huge time saver between projects that share them, so I'm glad to finally get a chance to share its use here.</span></p>
<p class="mce-root"/>
<p>With that done, we can get back to the AR project in the editor once more, make an array of our projectiles, and spawn those instead of the test geometry the project starts with:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/9b382b44-c29e-4ff7-b584-245a71c0f466.png"/></p>
<p>And that's it, now we have our core project's projectiles spawning in the AR world with special FX and all!</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/c31bfa0f-55f0-4ed7-b936-a4556f943032.png" style="width:27.25em;height:48.50em;"/></p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>Through this journey, we've gone from the most basic starting point in UE4 to building and modifying some of its latest and greatest technologies. There's nothing quite as satisfying as seeing your work on your target platform and knowing it's only a matter of time before the rest of the world gets to share in it too. VR and AR are exciting new areas and UE4 is a leader in their development we are lucky to have. Having the know-how to get these technologies up and running and the myriad of new projects and games they bring to possible makes this a very exciting time, and can allow us to feel we're truly mastering UE4!</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Questions</h1>
                </header>
            
            <article>
                
<ol>
<li>What advantages and disadvantages does including starting content in a new project entail?</li>
<li>When making a VR or AR project, what is the primary reason to keep it blueprint only as long as possible?</li>
<li>What step is necessary to getting every Android project to build and deploy?</li>
<li>What are some advantages and disadvantages to the GearVR platform over the current PC/Console versions?</li>
<li>When adding movement via the HMD, what problems could it cause a user? How was it mitigated?</li>
<li>Which basic Android settings for the AR template are already set that we had to set for the VR template?</li>
<li>When converting from blueprint only to a C++ project, what two steps are taken?</li>
<li>How are assets migrated from one project to another with full dependencies?</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Further reading</h1>
                </header>
            
            <article>
                
<p><span>GearVR HMD touchpad in UE4:</span></p>
<p><a href="https://docs.unrealengine.com/en-us/Platforms/GearVR/HowTo/HMDTouchPad">https://docs.unrealengine.com/en-us/Platforms/GearVR/HowTo/HMDTouchPad</a></p>
<p>Google's supported Android AR devices:</p>
<p><a href="https://developers.google.com/ar/discover/supported-devices">https://developers.google.com/ar/discover/supported-devices</a></p>


            </article>

            
        </section>
    </body></html>