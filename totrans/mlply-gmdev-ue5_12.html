<html><head></head><body>
<div><h1 class="chapter-number" id="_idParaDest-238"><a id="_idTextAnchor239"/>12</h1>
<h1 id="_idParaDest-239"><a id="_idTextAnchor240"/>Managing Multiplayer Sessions</h1>
<p>As you already know from previous chapters, a game session is represented by a server with multiple players all connected to it.</p>
<p>Unreal Engine provides a solid framework for creating, destroying, and handling game sessions. By having a strong grip on how to handle a multiplayer session, programmers can ensure their games will provide a nice and flawless experience to all players involved.</p>
<p>In this chapter, you will be presented with the main concepts needed to manage a game session, starting from the basic setup to creating one. Then, you’ll learn how to let clients search for available sessions and how to join them. By the end of this chapter, you will have built a user interface that will be used later to handle the Unreal Engine multiplayer session system.</p>
<p>Through the next few sections, I will present the following topics:</p>
<ul>
<li>Understanding game sessions</li>
<li>Preparing a project game session</li>
<li>Creating a session</li>
<li>Joining a session</li>
</ul>
<h1 id="_idParaDest-240"><a id="_idTextAnchor241"/>Technical requirements</h1>
<p>To follow the topics presented in this chapter, you should have completed <a href="B18203_11.xhtml#_idTextAnchor215"><em class="italic">Chapter 11</em></a>, <em class="italic">Debugging a Multiplayer Game</em>, and understood its content.</p>
<p>Additionally, if you would prefer to begin with code from the companion repository for this book, you can download the <code>.zip</code> project files provided in this book’s companion project repository: <a href="https://github.com/PacktPublishing/Multiplayer-Game-Development-with-Unreal-Engine-5">https://github.com/PacktPublishing/Multiplayer-Game-Development-with-Unreal-Engine-5</a>.</p>
<p>You can download the files that are up to date with the end of the previous chapter by clicking the <code>Unreal Shadows – </code><a href="B18203_11.xhtml#_idTextAnchor215"><em class="italic">Chapter 11</em></a><code> </code><code>End</code> link.</p>
<h1 id="_idParaDest-241"><a id="_idTextAnchor242"/>Understanding game sessions</h1>
<p>During a <strong class="bold">game session</strong>, players<a id="_idIndexMarker666"/> can participate in online games by connecting to remote servers or even using their computers as dedicated servers. The Unreal Engine game session system offers a wide range of impressive online capabilities, such as a server browser, player limits, server search over the network, and much more. It’s easy to use and only requires a few commands to activate. Whether running on a player’s machine or a dedicated server, game sessions provide a way for players to connect and immerse themselves in the virtual world of the game. In this chapter, we will focus on setting up a local network environment, leaving the dedicated server setup to the next chapter.</p>
<p>However, before we begin working on sessions, I need to introduce you to the Online Subsystem and its unique characteristics.</p>
<h2 id="_idParaDest-242"><a id="_idTextAnchor243"/>Introducing the Online Subsystem</h2>
<p>In Unreal Engine, the <strong class="bold">Online Subsystem</strong> is a <a id="_idIndexMarker667"/>system that offers a standard method of accessing the features of online services such as Epic Online Services, Steam, Xbox Live, and others. This <a id="_idIndexMarker668"/>is especially useful in game development scenarios where multiple platforms or online services are supported. In such cases, the Online Subsystem eliminates the need for developers to make code changes by enabling the use of configuration adjustments for each supported service. This ensures that the coding process and development efforts are streamlined, efficient, and consistent across all supported platforms and services.</p>
<p>The core purpose of the Online Subsystem is to manage asynchronous communication with a diverse range of online platforms. As network speeds, server delays, and backend service runtimes are typically unknown to local machines, interactions with such systems are highly unpredictable in terms of duration. To address this issue, the Online Subsystem leverages delegates for all remote operations, ensuring that they are always executed when any supported asynchronous feature is utilized. Delegates serve a dual purpose by enabling the system to respond to requests as they complete, as well as allowing developers to query runtime requests. By providing a single code path to follow, delegates negate the need for developers to write custom code to handle various success or failure conditions.</p>
<p>Supported features <a id="_idIndexMarker669"/>are grouped into service-specific, modular interfaces. For instance, the <strong class="bold">Leaderboard</strong> interface encompasses all aspects related <a id="_idIndexMarker670"/>to leaderboard access – such as the ability to register personal scores or times, as well as check the leaderboards for scores from players across the globe or within your friends’ lists – while the <strong class="bold">Purchase</strong> interface covers the process of making in-game purchases and handling past purchases history. Each feature set on every supported online service has an associated interface, allowing developers to write code that is agnostic to the online service being employed, promoting consistency across services.</p>
<p>Epic Games provides a list of plugins that allow developers to work on the Online Subsystem, including dedicated plugins for the most common and used platforms. <em class="italic">Figure 12</em><em class="italic">.1</em> shows a portion of the many elements available in Unreal Engine’s <strong class="bold">Plugins</strong> | <strong class="bold">Online </strong><strong class="bold">Platform</strong> section:</p>
<div><div><img alt="Figure 12.1 – Some of the available Online Subsystem plugins" src="img/Figure_12_01_B18203.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.1 – Some of the available Online Subsystem plugins</p>
<p>In this chapter, we will use the default Online Subsystem, which offers the most basic operations to <a id="_idIndexMarker671"/>handle a session, including its creation, destruction, and joining. In <a href="B18203_15.xhtml#_idTextAnchor288"><em class="italic">Chapter 15</em></a>, <em class="italic">Adding Epic Online Services (EOS)</em>, we’ll dive into more detail <a id="_idIndexMarker672"/>regarding more advanced Online Subsystem features. Let’s start by learning how to manage the most basic session operations.</p>
<h2 id="_idParaDest-243"><a id="_idTextAnchor244"/>Understanding session commands</h2>
<p>So, how can <a id="_idIndexMarker673"/>a multiplayer session be managed and operated? There are four main operations you can use to handle a session:</p>
<ul>
<li><strong class="bold">Create Session</strong></li>
<li><strong class="bold">Destroy Session</strong></li>
<li><strong class="bold">Find Session</strong></li>
<li><strong class="bold">Join Session</strong></li>
</ul>
<p>Let’s take a closer look at each of them and analyze them in detail.</p>
<h3>Create Session</h3>
<p>The <strong class="bold">Create Session</strong> command <a id="_idIndexMarker674"/>constitutes <a id="_idIndexMarker675"/>the starting point of the session process. Once a session is created successfully, it becomes discoverable by other instances of the game, which can subsequently join it. The <strong class="bold">Create Session</strong> command allows you to specify key aspects, such as the number of players allowed in the session itself and LAN mode, which lets you manage an internet-based game or a LAN game.</p>
<h3>Destroy Session</h3>
<p>If you are <a id="_idIndexMarker676"/>hosting a session (that is, you created a session), <strong class="bold">Destroy Session</strong> will <a id="_idIndexMarker677"/>close it so that it is no longer available for discovery and joining. Connected clients will be immediately disconnected from the session. If you are a client who’s connected to a session, calling this command is the way to go to leave the session and, consequently, the game.</p>
<h3>Find Session</h3>
<p>By using<a id="_idIndexMarker678"/> the <strong class="bold">Find Session</strong> command, you<a id="_idIndexMarker679"/> can retrieve a comprehensive list of currently created and accessible game sessions. Upon a successful call of this method, the returned objects can be queried to obtain important information such as the server’s name, ping, and player count. As for the <strong class="bold">Create Session</strong> command, you can opt for an internet-based game or a LAN-based one.</p>
<h3>Join Session</h3>
<p>After<a id="_idIndexMarker680"/> identifying the desired session, you can<a id="_idIndexMarker681"/> initiate a <strong class="bold">Join Session</strong> call to join the game. Upon successful connection to the server, the game will automatically transition to the server’s map and allow you to participate in the ongoing gameplay.</p>
<h2 id="_idParaDest-244"><a id="_idTextAnchor245"/>Understanding connection errors</h2>
<p>As you already know, network operations<a id="_idIndexMarker682"/> always pose the risk of encountering errors, and it’s critical for games to handle them appropriately. Instances such as the host leaving the session (or crashing), temporary internet connection issues, or other unforeseen problems are common examples.</p>
<p>Any failures <a id="_idIndexMarker683"/>associated with the aforementioned session functions will be communicated through appropriate events or, in the case of Blueprints, dedicated execution pins, allowing the developer to configure the game response accordingly. This will guarantee a positive experience for the players, even during critical situations.</p>
<p>Now that you have a grasp of how to make and oversee multiplayer game sessions, let’s head back into Unreal Engine and apply this knowledge to our project! In the next few sections, you will create a user interface that lets you host a session and expose it to the network or join one.</p>
<h1 id="_idParaDest-245"><a id="_idTextAnchor246"/>Preparing a project game session</h1>
<p>In this chapter <a id="_idIndexMarker684"/>and the next, we will create a new level that will serve as a starting point for your game and will let players host a session or join one. As mentioned previously, in this chapter, we will focus on creating a LAN-hosted game – this means that all players will be connected to the same local network – leaving the trickier details of hosting a game over the internet to the next chapter.</p>
<p>The level will be pretty simple and will contain the following elements:</p>
<ul>
<li>A user interface widget that will do the following:<ul><li>Let the player create and host a session</li><li>Let the player find and join hosted sessions</li></ul></li>
<li>A 3D model of the character that the player will use to change skin colors</li>
</ul>
<p>In this chapter, we will focus on creating the user interface – including all the needed widgets – leaving the level creation and the skin handling to the next one.</p>
<p>This interface will concentrate on the primary session functions and not on its visual aspect. However, you can decide on the style and look based on your personal preference – just let your creativity run free!</p>
<p>To create our user interface, we will use UMG again – you used it in <a href="B18203_06.xhtml#_idTextAnchor125"><em class="italic">Chapter 6</em></a>, <em class="italic">Replicating Properties </em><em class="italic">O</em><em class="italic">ver the Network</em>. One of the main advantages of using the UMG system is that you can create a custom widget and use it to compose the full interface. This will let you separate elements into logical blocks and keep the overall system clean and reusable.</p>
<p>We will start by creating the needed elements for creating and joining a session. By the end of this chapter, we will put everything together in a main menu interface.</p>
<p>To get started, we will need four main components:</p>
<ul>
<li>A <strong class="bold">Create Session</strong> widget, which will help us in handling the session creation</li>
<li>A <strong class="bold">Find Sessions</strong> widget, which will let us look for available sessions and list them in the user interface</li>
<li>A <strong class="bold">Session Item Renderer</strong> widget, which will be used to show each session’s information and will let us join a session</li>
<li>A <strong class="bold">Main Menu</strong> widget, which<a id="_idIndexMarker685"/> will let us display the previous widgets on the screen</li>
</ul>
<p>Let’s start creating these widgets by opening the Unreal project and navigating to the <code>Content</code> | <code>Blueprints</code> folder. The first widget we will be adding is <strong class="bold">Create Session</strong>.</p>
<h1 id="_idParaDest-246"><a id="_idTextAnchor247"/>Creating a session</h1>
<p>In this section, you will be creating a user interface widget that will let you<a id="_idIndexMarker686"/> manage session creation. In particular, the <strong class="bold">Create Session </strong>widget will do the following:</p>
<ul>
<li>Let the player select how many players are allowed to connect in a single session</li>
<li>Create the session with the click of a button</li>
<li>Open the game level and start the game</li>
</ul>
<p>The first thing we must do is create the actual widget so, in the <code>Blueprints</code> folder of the Content Browser, do the following:</p>
<ol>
<li>Right-click and select <strong class="bold">User Interface</strong> | <strong class="bold">Widget Blueprint</strong>. In the pop-up window that appears, select <strong class="bold">User Widget</strong>, as shown in <em class="italic">Figure 12</em><em class="italic">.2</em>:</li>
</ol>
<div><div><img alt="Figure 12.2 – The user widget creation window" src="img/Figure_12_02_B18203.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.2 – The user widget creation window</p>
<ol>
<li value="2">Name<a id="_idIndexMarker687"/> the newly created widget <code>WB_CreateSession</code> and double-click on it to open it.</li>
</ol>
<p>Now, we will add the visual elements.</p>
<h2 id="_idParaDest-247"><a id="_idTextAnchor248"/>Adding the visual elements</h2>
<p>Once the<a id="_idIndexMarker688"/> editor is open, select the <strong class="bold">Designer</strong> view and do the following:</p>
<ol>
<li>From the <code>CreateSessionPanel</code>.</li>
<li>From the <code>Background</code>.</li><li>Set its <code>(0, 0, </code><code>0, 0.4)</code>.</li><li>While<a id="_idIndexMarker689"/> holding the <em class="italic">Ctrl</em> and <em class="italic">Shift</em> keys, click the <strong class="bold">Anchors</strong> drop-down menu and select the bottom-right button to make the background stretch over the entirety of the <strong class="bold">Canvas</strong> panel. The selection button is shown in <em class="italic">Figure 12.3</em>:</li></ul></li>
</ol>
<div><div><img alt="Figure 12.3 – The background anchors selection" src="img/Figure_12_03_B18203.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.3 – The background anchors selection</p>
<ol>
<li value="3">From the <code>Container</code></li><li>While <a id="_idIndexMarker690"/>holding the <em class="italic">Ctrl</em> and <em class="italic">Shift</em> keys, click the <strong class="bold">Anchors</strong> drop-down menu and select the bottom-right button to make the background stretch over the entirety of the <strong class="bold">Canvas</strong> panel</li></ul></li>
</ol>
<p>At this point, you have created the container for the widget – nothing fancy, but it’s fully functional. The widget hierarchy can be seen in <em class="italic">Figure 12</em><em class="italic">.4</em>:</p>
<div><div><img alt="Figure 12.4 – The partial CreateSession widget hierarchy" src="img/Figure_12_04_B18203.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.4 – The partial CreateSession widget hierarchy</p>
<p>We are now going to add the working elements that will allow the player to create the session. To do so, follow these steps:</p>
<ol>
<li>From the <code>TitleLabel</code></li><li>Set its <code>5.0</code></li><li>Set the <strong class="bold">Text</strong> property to <strong class="bold">Create Session</strong></li></ul></li>
<li>From the <code>Separator</code></li><li>Set its <code>10.0</code></li></ul></li>
<li>From the <code>MaxPlayersLabel</code></li><li>Set its <code>5.0</code></li><li>Set the <strong class="bold">Text</strong> property to <strong class="bold">Max Players</strong></li></ul></li>
<li>From<a id="_idIndexMarker691"/> the <code>MaxPlayersSpinBox</code></li><li>Set its <code>10.0</code></li><li>Enable the <code>1</code></li><li>Enable the <code>5</code></li><li>Set both <code>0</code></li><li>Double-check that the <strong class="bold">Is Variable</strong> checkbox is selected</li></ul></li>
<li>From the <code>CreateSessionBtn</code></li><li>Set its <code>5.0</code></li><li>Double-check that the <strong class="bold">Is Variable</strong> checkbox is selected</li></ul></li>
<li>From the <code>CreateSessionLabel</code></li><li>Set its <strong class="bold">Text</strong> property to <strong class="bold">Create</strong></li><li>Set its <strong class="bold">Justification</strong> property to <strong class="bold">Align </strong><strong class="bold">Text Center</strong></li></ul></li>
</ol>
<p>The<a id="_idIndexMarker692"/> final structure of the widget is shown in <em class="italic">Figure 12</em><em class="italic">.5</em>:</p>
<div><div><img alt="Figure 12.5 – The final CreateSession widget hierarchy" src="img/Figure_12_05_B18203.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.5 – The final CreateSession widget hierarchy</p>
<p>The <strong class="bold">Designer</strong> view for the widget is shown in <em class="italic">Figure 12</em><em class="italic">.6</em>:</p>
<div><div><img alt="Figure 12.6 – The Designer view of the CreateSession widget" src="img/Figure_12_06_B18203.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.6 – The Designer view of the CreateSession widget</p>
<p>With <a id="_idIndexMarker693"/>this layout, the player will be able to select the maximum number of players hosted in a session and start the session itself.</p>
<h2 id="_idParaDest-248"><a id="_idTextAnchor249"/>Implementing the Visual Scripting logic</h2>
<p>Now that the <a id="_idIndexMarker694"/>visual part of the widget is finished, you can start adding the Visual Scripting logic. Open the <strong class="bold">Graph</strong> panel by clicking the <strong class="bold">Graph</strong> button and, in the <strong class="bold">Variables</strong> panel, you should already have two variables – <strong class="bold">CreateSessionBtn</strong> and <strong class="bold">MaxPlayersSpinBox</strong>. Then, complete the following steps:</p>
<ol>
<li>Add a new variable of the <code>MaxPlayers</code>.</li>
<li>Select the <strong class="bold">MaxPlayersSpinBox</strong> variable and, in the <strong class="bold">Events</strong> panel, click on the <strong class="bold">On Value Changed +</strong> button to create an event.</li>
<li>Select the <strong class="bold">CreateSessionBtn</strong> variable and, in the <strong class="bold">Events</strong> panel, click on the <strong class="bold">On Clicked +</strong> button to create an event.</li>
</ol>
<p>The previous steps will create two events that will handle the corresponding user interactions, as shown in <em class="italic">Figure 12</em><em class="italic">.7</em>:</p>
<div><div><img alt="Figure 12.7 – The CreateSession graph events" src="img/Figure_12_07_B18203.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.7 – The CreateSession graph events</p>
<p>We will start <a id="_idIndexMarker695"/>by handling the spin box change event, which will simply have to assign its value to the <strong class="bold">MaxConnections</strong> variable. To do so, follow these steps:</p>
<ol>
<li>From the <strong class="bold">Variables</strong> panel, drag a <strong class="bold">Set Max </strong><strong class="bold">Players</strong> node.</li>
<li>Connect the outgoing execution pin of the <strong class="bold">On Value Changed (MaxPlayersSpinBox)</strong> event to the incoming execution pin of the <strong class="bold">Set Max </strong><strong class="bold">Players</strong> node.</li>
<li>Connect the <strong class="bold">In Value</strong> pin of the event node to the <strong class="bold">Max Players</strong> pin of the <strong class="bold">Set</strong> node. This will automatically create a <strong class="bold">Truncate</strong> node to convert the spin box float value into an integer.</li>
</ol>
<p>The final result of this part of the graph is shown in <em class="italic">Figure 12</em><em class="italic">.8</em>:</p>
<div><div><img alt="Figure 12.8 – The spin box Event Graph" src="img/Figure_12_08_B18203.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.8 – The spin box Event Graph</p>
<p>We can<a id="_idIndexMarker696"/> now start working on the session creation part of the graph, which will be fired whenever the <strong class="bold">CreateSessionBtn</strong> button is clicked.</p>
<ol>
<li value="4">Add a <strong class="bold">Create Session</strong> node and a <strong class="bold">Get Player Controller</strong> node to the graph.</li>
<li>From the <strong class="bold">Variables</strong> panel, drag a <strong class="bold">Get Max </strong><strong class="bold">Players</strong> node.</li>
<li>Connect the outgoing execution pin of the <strong class="bold">On Clicked (CreateSessionBtn)</strong> event to the incoming execution pin of the <strong class="bold">Create </strong><strong class="bold">Session</strong> node.</li>
<li>Connect the <strong class="bold">Return Value</strong> pin of the <strong class="bold">Get Player Controller</strong> node to the <strong class="bold">Player Controller</strong> pin of the <strong class="bold">Create </strong><strong class="bold">Session</strong> node.</li>
<li>Connect the outgoing pin of the <strong class="bold">Max Players</strong> node to the <strong class="bold">Public Connections</strong> pin of the <strong class="bold">Create </strong><strong class="bold">Session</strong> node.</li>
<li>Enable the <strong class="bold">Use LAN</strong> checkbox of the <strong class="bold">Create </strong><strong class="bold">Session</strong> node.</li>
<li>Add an <code>Level_01</code> to the <code>listen</code> to the <strong class="bold">Options</strong> input field to open the level as a listen server</li></ul></li>
<li>Connect the <strong class="bold">On Success</strong> execution pin of the <strong class="bold">Create Session</strong> node to the incoming <a id="_idIndexMarker697"/>execution pin of the <strong class="bold">Open Level (by </strong><strong class="bold">Name)</strong> node.</li>
<li>Optionally, connect the <strong class="bold">On Failure</strong> execution pin of the <strong class="bold">Create Session</strong> node to a <strong class="bold">Print String</strong> node; this will show an error message. This will trace any failure that may pop up during the creation of a session in the <strong class="bold">Output </strong><strong class="bold">Log</strong> window.</li>
</ol>
<p>The final graph is shown in <em class="italic">Figure 12</em><em class="italic">.9</em>:</p>
<div><div><img alt="Figure 12.9 – The Create Session Event Graph" src="img/Figure_12_09_B18203.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.9 – The Create Session Event Graph</p>
<p>The graph you have just created is simple but does a lot of things, including creating a session on a LAN, setting a maximum of players per session, and opening the game level to start the actual multiplayer session.</p>
<p>In the next section, we will work on an interface that will let the player search for and join existing sessions.</p>
<h1 id="_idParaDest-249"><a id="_idTextAnchor250"/>Joining a session</h1>
<p>In this section, we <a id="_idIndexMarker698"/>will work on a couple of widgets that will display a list of sessions available in the network and let the players join them. We will need two widgets: <strong class="bold">Session Item Renderer</strong> and <strong class="bold">Find Session</strong>. The first one will be used to display a single session’s information, while the second one will be responsible for using the first one as a list of available sessions.</p>
<h2 id="_idParaDest-250"><a id="_idTextAnchor251"/>Creating the SessionItemRenderer widget</h2>
<p>The widget <a id="_idIndexMarker699"/>you will<a id="_idIndexMarker700"/> create will have the following features:</p>
<ul>
<li>Displays the available server name</li>
<li>Displays the maximum number of available connections, along with the number of connected players</li>
<li>Provides a join button to let the player enter the session</li>
</ul>
<p>The first thing we must do is create the widget. So, in the Content Browser area, follow these steps:</p>
<ol>
<li>Right-click and select <strong class="bold">User Interface</strong> | <strong class="bold">Widget Blueprint</strong>. In the pop-up window that appears, select <strong class="bold">User Widget</strong>.</li>
<li>Name the newly created widget <code>WB_SessionItemRenderer</code> and double-click on it to open it.</li>
</ol>
<p>Once again, we will start by adding the user interface elements.</p>
<h3>Adding the visual elements</h3>
<p>Once the <a id="_idIndexMarker701"/>editor is open, select the <strong class="bold">Designer</strong> panel and do the following:</p>
<ol>
<li>From the <code>Container</code>.</li>
<li>From the <code>ServerNameLabel</code> and tick the <code>Fill</code> and the <code>5.0</code></li><li>Set the <code>Server Name</code></li></ul></li>
<li>From<a id="_idIndexMarker702"/> the <code>NumPlayersLabel</code> and tick the <code>5.0</code></li><li>Set the <code>0/0</code></li></ul></li>
<li>From the <code>JoinBtn</code> and double-check that the <code>5.0</code></li></ul></li>
<li>From the <code>JoinLabel</code></li><li>Set the <code>Join Session</code></li></ul></li>
</ol>
<p>The final structure of the widget is shown in <em class="italic">Figure 12</em><em class="italic">.10</em>:</p>
<div><div><img alt="Figure 12.10 – The hierarchy view of the SessionItemRenderer widget" src="img/Figure_12_10_B18203.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.10 – The hierarchy view of the SessionItemRenderer widget</p>
<p>The <a id="_idIndexMarker703"/><strong class="bold">Designer</strong> view for the widget is shown in <em class="italic">Figure 12</em><em class="italic">.11</em>:</p>
<div><div><img alt="Figure 12.11 – The Designer view of the SessionItemRenderer widget" src="img/Figure_12_11_B18203.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.11 – The Designer view of the SessionItemRenderer widget</p>
<p>With this layout, the player will be able to see the information for each available session and the join button.</p>
<p>Now that the visual part of the widget is finished, you can start adding the Visual Scripting logic.</p>
<h3>Implementing the Visual Scripting logic</h3>
<p> Open the <strong class="bold">Graph</strong> panel<a id="_idIndexMarker704"/> by clicking the <strong class="bold">Graph</strong> button and do the following:</p>
<ol>
<li>In the <strong class="bold">Variables</strong> panel, you should already have three variables – <strong class="bold">JoinBtn</strong>, <strong class="bold">NumPlayersLabel</strong>, and <strong class="bold">ServerNameLabel</strong>. In the Designer graph, all of them have been marked as <strong class="bold">Is Variable</strong>.</li>
<li>Add a new variable of the <code>SearchResult</code></li><li>In its <strong class="bold">Details</strong> panel, enable the <strong class="bold">Instance Editable</strong> and <strong class="bold">Expose on Spawn</strong> properties to make this property accessible from other Blueprints</li></ul></li>
</ol>
<p>You should be already familiar with the <strong class="bold">Instance Editable</strong> property, but <strong class="bold">Expose on Spawn</strong> may be new to you. Enabling it will show a pin for this property when spawning this Blueprint – this will help us later on in initializing the data when we add this renderer to the list of available sessions.</p>
<p>Now that the variables have been set up, it’s time to add some Visual Scripting. We will start by implementing the <strong class="bold">Join Session</strong> logic. To do so, follow these steps:</p>
<ol>
<li>With the <strong class="bold">JoinBtn</strong> variable selected, add an <strong class="bold">On Clicked (JoinBtn)</strong> event by clicking on the <strong class="bold">On Clicked +</strong> button in the <strong class="bold">Events</strong> panel.</li>
<li>Add a <strong class="bold">Join Session</strong> node to the graph and connect its incoming execution pin to the outgoing execution pin of the <strong class="bold">On Clicked (</strong><strong class="bold">JoinBtn)</strong> event.</li>
<li>Add a <strong class="bold">Get Player Controller</strong> node to the graph and connect its <strong class="bold">Return Value</strong> pin to the <strong class="bold">Player Controller</strong> pin of <strong class="bold">Join </strong><strong class="bold">Session Node</strong>.</li>
<li>From the <strong class="bold">Variables</strong> panel, drag a <strong class="bold">Get Search Result</strong> node into the graph and connect its pin to the <strong class="bold">Search Result</strong> node of the <strong class="bold">Join </strong><strong class="bold">Session</strong> node.</li>
</ol>
<p>The final result for this part of the graph is shown in <em class="italic">Figure 12</em><em class="italic">.12</em>:</p>
<div><div><img alt="Figure 12.12 – The Join Session graph" src="img/Figure_12_12_B18203.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.12 – The Join Session graph</p>
<p>As you can see, joining <a id="_idIndexMarker705"/>a session is quite straightforward once you have the session data (that is, the search result); this data will be obtained during the <strong class="bold">Find Session</strong> procedure we’ll add later.</p>
<p>Please notice that we don’t need to open any level after joining a session as we did for the <strong class="bold">Create Session</strong> widget; this will happen automatically once we are connected to the host.</p>
<p>To complete this widget, we need to show the search result data in the labels we have previously created and, as we have previously exposed this data on spawn, we will have it already available at construction time. Let’s complete the widget’s Visual Scripting by looking for the <strong class="bold">Event Construct</strong> event node in the graph – it should already be available by default. Then, perform the following steps:</p>
<ol>
<li>To keep things clean, add a <strong class="bold">Sequence</strong> node with two outgoing pins (the default setup) and connect its incoming execution pin to the outgoing execution pin of the event node.</li>
<li>From the <strong class="bold">Variables</strong> panel, drag a <strong class="bold">Get Server Name Label</strong> node and a <strong class="bold">Get Search </strong><strong class="bold">Result</strong> node.</li>
<li>From the <strong class="bold">Server Name Label</strong> outgoing pin, click and drag to create a <strong class="bold">SetText (</strong><strong class="bold">Text)</strong> node.</li>
<li>Connect the <strong class="bold">SetText (Text)</strong> incoming execution pin to the <strong class="bold">Then 0</strong> execution pin of the <strong class="bold">Sequence</strong> node.</li>
<li>From the <strong class="bold">Search Result</strong> outgoing pin, click and drag to add a <strong class="bold">Get Server </strong><strong class="bold">Name</strong> node.</li>
<li>Connect<a id="_idIndexMarker706"/> the <strong class="bold">Get Server Name</strong> outgoing pin to the <strong class="bold">In Text</strong> pin of the <strong class="bold">SetText (Text)</strong> node. This will automatically create a <strong class="bold">To Text (String)</strong> node that will convert the text into the correct type.</li>
</ol>
<p>So far, the graph should be like <em class="italic">Figure 12</em><em class="italic">.13</em>:</p>
<div><div><img alt="Figure 12.13 – The first part of the Event Construct event node" src="img/Figure_12_13_B18203.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.13 – The first part of the Event Construct event node</p>
<p>The previous graph simply gets the available server’s name from the search result data and displays it in the corresponding label. We are going to do something similar with the number of connected players. To do so, keep on working on the same graph and continue with these steps.</p>
<ol>
<li value="7">From the <strong class="bold">Variables</strong> panel, drag a <strong class="bold">Get Num Players Label</strong> node and a <strong class="bold">Get Search </strong><strong class="bold">Result</strong> node.</li>
<li>From the <strong class="bold">Num Players Label</strong> outgoing pin, click and drag to create a <strong class="bold">SetText (</strong><strong class="bold">Text)</strong> node.</li>
<li>Connect <a id="_idIndexMarker707"/>the <strong class="bold">SetText (Text)</strong> incoming execution pin to the <strong class="bold">Then 1</strong> execution pin of the <strong class="bold">Sequence</strong> node.</li>
<li>From the <strong class="bold">Search Result</strong> outgoing pin, click and drag to add a <strong class="bold">Get Current Players</strong> node. Repeat this step, but this time, add a <strong class="bold">Get Max </strong><strong class="bold">Players</strong> node.</li>
<li>Add an <code>/</code> character into the input field for the <strong class="bold">B</strong> pin.</li><li>Connect the incoming <strong class="bold">C</strong> pin to <strong class="bold">Return Value</strong> of the <strong class="bold">Get Max Players</strong> node. This will automatically add a node converted for the type.</li></ul></li>
<li>Connect the <strong class="bold">Append</strong> node’s outgoing pin to the <strong class="bold">In Text</strong> pin of the <strong class="bold">SetText (Text)</strong> node. This will automatically create a <strong class="bold">To Text (String)</strong> node that will convert the text into the correct type.</li>
</ol>
<p>This portion of the graph will look like <em class="italic">Figure 12</em><em class="italic">.14</em>:</p>
<div><div><img alt="Figure 12.14 – The second part of the Event Construct event node" src="img/Figure_12_14_B18203.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.14 – The second part of the Event Construct event node</p>
<p>This<a id="_idIndexMarker708"/> widget is now complete and contains all the logic to show a session’s information and join it.</p>
<p>We are now going to create the third widget, which will allow us to search the network for available sessions.</p>
<h2 id="_idParaDest-251"><a id="_idTextAnchor252"/>Creating the FindSessions widget</h2>
<p>The <strong class="bold">FindSessions</strong> widget <a id="_idIndexMarker709"/>will have the<a id="_idIndexMarker710"/> following <a id="_idIndexMarker711"/>features:</p>
<ul>
<li>Let the player find available sessions through the click of a button</li>
<li>Show a list of the available sessions</li>
<li>If required, display information messages</li>
</ul>
<p>The first thing we must do is create the actual widget. So, in the Content Browser area, do the following:</p>
<ol>
<li>Right-click and select <strong class="bold">User Interface</strong> | <strong class="bold">Widget Blueprint</strong>. In the pop-up window that appears, select <strong class="bold">User Widget</strong>.</li>
<li>Name the newly created widget <code>WB_FindSessions</code> and double-click on it to open it.</li>
</ol>
<p>As usual, you <a id="_idIndexMarker712"/>will start by adding the visual elements to the widget.</p>
<h3>Adding the visual elements</h3>
<p>Once the<a id="_idIndexMarker713"/> editor is open, select the <strong class="bold">Designer</strong> panel and follow these steps:</p>
<ol>
<li>From the <code>FindSessionsPanel</code>.</li>
<li>From the <code>Background</code></li><li>Set its <code>(0, 0, </code><code>0, 0.4)</code></li><li>While holding the <em class="italic">Ctrl</em> and <em class="italic">Shift</em> keys, click the <strong class="bold">Anchors</strong> drop-down menu and select the bottom-right button to make the background stretch over the entirety of the <strong class="bold">Canvas</strong> panel</li></ul></li>
<li>From the <code>Container</code></li><li>While holding the <em class="italic">Ctrl</em> and <em class="italic">Shift</em> keys pressed, click the <strong class="bold">Anchors</strong> drop-down menu, and select the bottom-right button to make the background stretch over the entirety of the <strong class="bold">Canvas</strong> panel</li></ul></li>
</ol>
<p>At this point, you will have created the container for the widget – nothing fancy, but fully functional. The widget hierarchy can be seen in <em class="italic">Figure 12</em><em class="italic">.15</em>:</p>
<div><div><img alt="Figure 12.15 – The partial FindSessions widget hierarchy" src="img/Figure_12_15_B18203.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.15 – The partial FindSessions widget hierarchy</p>
<p>Now, we are <a id="_idIndexMarker714"/>going to add the working elements that will allow the player to find the network sessions.</p>
<ol>
<li value="4">From the <code>FindSessionsBtn</code></li><li>Set its <code>10.0</code></li><li>Double-check that the <strong class="bold">Is Variable</strong> checkbox is selected</li></ul></li>
<li>From the <code>FindSessionsLabel</code></li><li>Set the <code>Find Sessions</code></li></ul></li>
<li>From the <code>Separator</code></li><li>Set its <code>10.0</code></li></ul></li>
<li>From the <code>SessionsScrollBox</code></li><li>Set its <code>10.0</code></li><li>Set its <strong class="bold">Size</strong> property to <strong class="bold">Fill</strong></li><li>Double-check that the <strong class="bold">Is Variable</strong> checkbox is selected</li></ul></li>
<li>From<a id="_idIndexMarker715"/> the <code>SessionMessage</code> and tick the <code>10.0</code></li><li>Set the <strong class="bold">Text</strong> property to <strong class="bold">No </strong><strong class="bold">Session Available</strong></li></ul></li>
</ol>
<p>The final structure of the widget is shown in <em class="italic">Figure 12</em><em class="italic">.16</em>:</p>
<div><div><img alt="Figure 12.16 – The final FindSessions widget hierarchy" src="img/Figure_12_16_B18203.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.16 – The final FindSessions widget hierarchy</p>
<p>The <strong class="bold">Designer</strong> view for the widget is shown in <em class="italic">Figure 12</em><em class="italic">.17</em>:</p>
<div><div><img alt="Figure 12.17 – The final FindSessions widget Designer view" src="img/Figure_12_17_B18203.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.17 – The final FindSessions widget Designer view</p>
<p>With this layout, the <a id="_idIndexMarker716"/>player will be able to click the <strong class="bold">Find Sessions</strong> button to search the network for available sessions and display them in a selectable list. You now need to open the <strong class="bold">Graph</strong> panel and add some Visual Scripting logic.</p>
<h3>Implementing the Visual Scripting logic</h3>
<p>This part will <a id="_idIndexMarker717"/>be a bit more complex than the rest as there will be a lot going on; in particular, the code logic will have to do the following:</p>
<ul>
<li>Search for available networks over the LAN</li>
<li>Display a list of available sessions through the <strong class="bold">SessionItemRenderer</strong> widget</li>
<li>Display error messages</li>
<li>Enable and disable the search button, depending on the circumstances</li>
</ul>
<p>As a first step, I need you to check that, in the <strong class="bold">Variables</strong> panel, there are three references to the items you will be using: <strong class="bold">FindSessionBtn</strong>, <strong class="bold">SessionMessage</strong>, and <strong class="bold">SessionScrollBox</strong>. Then, follow these steps:</p>
<ol>
<li>Add a new variable called <code>SessionResults</code> of the <strong class="bold">Blueprint Session Result</strong> type and make it an <strong class="bold">Array</strong> – this will contain a list of the sessions that have been found in the network.</li>
<li>Select <strong class="bold">FindSessionBtn</strong> and, in the <strong class="bold">Events</strong> panel, add an <strong class="bold">On Clicked</strong> event by <a id="_idIndexMarker718"/>clicking the <strong class="bold">+</strong> button next to the corresponding element.</li>
<li>Connect the outgoing execution pin of <strong class="bold">On Clicked (FindSessionBtn)</strong> to a <strong class="bold">Sequence</strong> node with two execution pins (that is, the default ones).</li>
</ol>
<p>Now, to keep things clean, you’ll be creating some functions that will do some of the minor operations:</p>
<ul>
<li><strong class="bold">AddItemRenderer</strong> to add a session item to the list</li>
<li><strong class="bold">EnableSearchButton/DisableSearchButton</strong> to make the search button interactable or not, depending on the situation</li>
<li><strong class="bold">GetSessionResultMessage</strong> to compose the resulting message of a search</li>
</ul>
<p>Let’s create these now.</p>
<h4>Creating the AddItemRenderer function</h4>
<p>We’ll start from <a id="_idIndexMarker719"/>the first function by clicking on the <strong class="bold">+</strong> button in the <strong class="bold">Functions</strong> section of the <strong class="bold">My Blueprint</strong> window. Follow these steps:</p>
<ol>
<li>Name the function <code>AddItemRenderer</code> and, in the <code>SearchResult</code></li><li>With the function node selected, look for the <strong class="bold">Graph</strong> section of the <strong class="bold">My Blueprint</strong> window and set <strong class="bold">Access Specifier</strong> to <strong class="bold">Protected</strong></li></ul></li>
<li> Add a <strong class="bold">Get Player Controller</strong> node to the graph.</li>
<li> Add a <strong class="bold">Create Widget</strong> node to the graph and do the following:<ul><li>Connect its incoming execution pin to the outgoing execution pin of the <strong class="bold">Add Item Renderer</strong> function node</li><li>From the drop-down menu of the <strong class="bold">Class</strong> pin, select <strong class="bold">WB_SessionItemRenderer</strong></li><li>Connect the <strong class="bold">Owning Player</strong> pin to <strong class="bold">Return Value</strong> of the <strong class="bold">Get Player </strong><strong class="bold">Controller</strong> node</li><li>Connect the <strong class="bold">Search Result</strong> pin to the <strong class="bold">Search Result</strong> pin of the <strong class="bold">Add Item Renderer</strong> function node</li></ul></li>
<li>Drag<a id="_idIndexMarker720"/> a <strong class="bold">Get Session Scroll Box</strong> node from the <strong class="bold">Variables</strong> panel onto the graph.</li>
<li>Add an <strong class="bold">Add Child</strong> node to the graph and do the following:<ul><li>Connect its incoming execution pin to the outgoing execution pin of the <strong class="bold">Create </strong><strong class="bold">Widget</strong> node</li><li>Connect the <strong class="bold">Content</strong> pin to the <strong class="bold">Return Value</strong> pin of the <strong class="bold">Create </strong><strong class="bold">Widget</strong> node</li><li>Connect the <strong class="bold">Target</strong> pin to the <strong class="bold">Session Scroll Box</strong> getter node</li></ul></li>
</ol>
<p>The final graph for the <strong class="bold">AddItemRenderer</strong> function is shown in <em class="italic">Figure 12</em><em class="italic">.18</em>:</p>
<div><div><img alt="Figure 12.18 – The AddItemRenderer function" src="img/Figure_12_18_B18203.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.18 – The AddItemRenderer function</p>
<p>We can now start creating the function that will enable the search button when requested.</p>
<h4>Creating the EnableSearchButton function</h4>
<p>Let’s start <a id="_idIndexMarker721"/>by creating the function by clicking on the <strong class="bold">+</strong> button in the <strong class="bold">Functions</strong> section of the <strong class="bold">My Blueprint</strong> window. Follow these steps:</p>
<ol>
<li>Name the function <code>EnableSearchButton</code> and, with the function node selected, look for the <strong class="bold">Graph</strong> section of the <strong class="bold">My Blueprint</strong> window and set <strong class="bold">Access Specifier</strong> to <strong class="bold">Protected</strong>.</li>
<li>From the <strong class="bold">Variables</strong> panel, drag a <strong class="bold">FindSessionsBtn</strong> node.</li>
<li>Add a <strong class="bold">Set Is Enabled</strong> node to the graph and do the following:<ul><li>Connect its incoming execution pin to the outgoing execution pin of the <strong class="bold">Enable Search Button</strong> function node</li><li>Connect the <strong class="bold">Target</strong> pin to the <strong class="bold">Find Session </strong><strong class="bold">Btn</strong> getter</li><li>Tick the <strong class="bold">In Is </strong><strong class="bold">Enabled</strong> checkbox</li></ul></li>
</ol>
<p>The final graph for this function is shown in <em class="italic">Figure 12</em><em class="italic">.19</em>:</p>
<div><div><img alt="Figure 12.19 – The EnableSearchButton function" src="img/Figure_12_19_B18203.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.19 – The EnableSearchButton function</p>
<p>The function that <a id="_idIndexMarker722"/>will disable the button is almost identical to the previous one, so let’s create it.</p>
<h4>Creating the DisableSearchButton function</h4>
<p>Let’s start <a id="_idIndexMarker723"/>by creating the function by clicking on the <strong class="bold">+</strong> button in the <strong class="bold">Functions</strong> section of the <strong class="bold">My Blueprint</strong> window. Follow these steps:</p>
<ol>
<li>With the function node selected, look for the <strong class="bold">Graph</strong> section of the <strong class="bold">My Blueprint</strong> window and set <strong class="bold">Access Specifier</strong> to <strong class="bold">Protected</strong>.</li>
<li>From the <strong class="bold">Variables</strong> panel, drag a <strong class="bold">FindSessionsBtn</strong> node.</li>
<li>Add a <strong class="bold">Set Is Enabled</strong> node to the graph and do the following:<ul><li>Connect its incoming execution pin to the outgoing execution pin of the <strong class="bold">Enable Search Button</strong> function node</li><li>Connect the <strong class="bold">Target</strong> pin to the <strong class="bold">Find Session </strong><strong class="bold">Btn</strong> getter</li><li>Leave the <strong class="bold">In Is Enabled</strong> checkbox unticked</li></ul></li>
</ol>
<p>The final graph for this function is shown in <em class="italic">Figure 12</em><em class="italic">.20</em>:</p>
<div><div><img alt="Figure 12.20 – The DisableSearchButton function" src="img/Figure_12_20_B18203.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.20 – The DisableSearchButton function</p>
<p>We need <a id="_idIndexMarker724"/>just one last function – the one that will compose the sessions message.</p>
<h4>Creating the GetSessionResultMessage function</h4>
<p>Let’s start by creating<a id="_idIndexMarker725"/> the function by clicking on the <strong class="bold">+</strong> button in the <strong class="bold">Functions</strong> section of the <strong class="bold">My Blueprint</strong> window. Follow these steps:</p>
<ol>
<li>Name the function <code>GetSessionsResultMessage</code> and do the following:<ul><li>With the function node selected, look for the <code>ReturnValue</code>; this will add <strong class="bold">Return Node</strong> to the graph.</li></ul></li>
<li>From the <strong class="bold">Variables</strong> panel, drag a <strong class="bold">Get Session </strong><strong class="bold">Results</strong> node.</li>
<li>From the outgoing pin of the <strong class="bold">Session Results</strong> getter, click and drag to add a <strong class="bold">Length</strong> node.</li>
<li>Add<a id="_idIndexMarker726"/> an <code>Found:</code></li><li>Connect the <code>sessions</code></li></ul></li>
<li>Connect the outgoing pin of the <strong class="bold">Append</strong> node to <strong class="bold">Return Value</strong> of <strong class="bold">Return Node</strong>; this will automatically create a <strong class="bold">To Text (String)</strong> converter node in between.</li>
</ol>
<p>The final graph for this function is shown in <em class="italic">Figure 12</em><em class="italic">.21</em>:</p>
<div><div><img alt="Figure 12.21 – The GetSessionsResultMessage function" src="img/Figure_12_21_B18203.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.21 – The GetSessionsResultMessage function</p>
<p>The last function has been created, so it’s time to get back to the main Event Graph and create the search and result logic.</p>
<h4>Implementing the Event Graph</h4>
<p>The <a id="_idIndexMarker727"/>main graph will need to look for the available sessions in the network and expose them in the widget list. To start with this Visual Scripting logic, follow these steps:</p>
<ol>
<li>Locate the <strong class="bold">On Clicked (FindSessionBtn)</strong> event and add a <strong class="bold">Sequence</strong> node to the outgoing execution pin.</li>
<li>From the <strong class="bold">Variables</strong> panel, drag a <strong class="bold">SessionsScrollBox</strong> node and, from its outgoing pin, click and drag to add a <strong class="bold">Clear </strong><strong class="bold">Children</strong> node.</li>
<li>Connect the <strong class="bold">Clear Children</strong> incoming execution pin to the <strong class="bold">Then 0</strong> outgoing execution pin of the <strong class="bold">Sequence</strong> node.</li>
<li>From the <strong class="bold">Functions</strong> panel, drag a <strong class="bold">Disable Search Button</strong> function and connect its incoming execution pin to the outgoing execution pin of the <strong class="bold">Clear </strong><strong class="bold">Children</strong> node.</li>
<li>From the <strong class="bold">Variables</strong> panel, drag a <strong class="bold">Session Message</strong> node and, from its outgoing pin, click and drag to add a <strong class="bold">Set Text</strong> node (from the <strong class="bold">Content</strong> category).</li>
<li>Connect the incoming execution pin of the <strong class="bold">Set Text</strong> node to the outgoing pin of <strong class="bold">Disable </strong><strong class="bold">Search Button</strong>.</li>
<li>Insert <strong class="bold">Search Session...</strong> into the <strong class="bold">Text</strong> field of the <strong class="bold">Set </strong><strong class="bold">Text</strong> node.</li>
</ol>
<p>This first part of the graph essentially cleans the sessions list from previous search results, disables the search button to avoid multiple clicks, and displays a message. This is shown in <em class="italic">Figure 12</em><em class="italic">.22</em>:</p>
<div><div><img alt="Figure 12.22 – The first part of the FindSessions graph" src="img/Figure_12_22_B18203.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.22 – The first part of the FindSessions graph</p>
<p>The second part of the graph will be responsible for searching the network sessions<a id="_idIndexMarker728"/> and showing the actual results.</p>
<ol>
<li value="8">Add a <strong class="bold">Get Player Controller</strong> node to the graph.</li>
<li>Add a <code>10</code></li><li>Tick the <strong class="bold">Use LAN</strong> checkbox to enable it</li></ul></li>
<li>From the <strong class="bold">Variables</strong> panel, drag a <strong class="bold">Set Session Results</strong> node and connect its incoming execution pin to the <strong class="bold">On Success</strong> execution pin of the <strong class="bold">Find </strong><strong class="bold">Sessions</strong> node.</li>
<li>From the <strong class="bold">Functions</strong> panel, drag a <strong class="bold">Get Sessions Result </strong><strong class="bold">Message</strong> node.</li>
<li>From the <strong class="bold">Variables</strong> panel, drag a <strong class="bold">Session Message</strong> getter node and do the following:<ul><li>From its outgoing pin, click and drag to add a <strong class="bold">Set Text</strong> node (from the <strong class="bold">Content</strong> category)</li><li>Connect its <strong class="bold">Text</strong> pin to the <strong class="bold">Return Value</strong> pin of the <strong class="bold">Get Sessions Result </strong><strong class="bold">Message</strong> node</li><li>Connect its incoming execution pin to the outgoing execution pin of the <strong class="bold">Set Session </strong><strong class="bold">Results</strong> node</li></ul></li>
<li>From<a id="_idIndexMarker729"/> the <strong class="bold">Variables</strong> panel, drag a <strong class="bold">Get Session Results</strong> node. From its outgoing pin, click and drag to add a <strong class="bold">For Each Loop</strong> node. Connect the incoming <strong class="bold">Exec</strong> pin of the <strong class="bold">For Each Loop</strong> node to the outgoing pin of the <strong class="bold">Set </strong><strong class="bold">Text</strong> node.</li>
<li>From the <strong class="bold">Functions</strong> panel, drag an <strong class="bold">Add Item Renderer</strong> node to the graph and do the following:<ul><li>Connect its incoming execution pin to the <strong class="bold">Loop Body</strong> execution pin of the <strong class="bold">For Each </strong><strong class="bold">Loop</strong> node</li><li>Connect its <strong class="bold">Search Result</strong> pin to the <strong class="bold">Array Element</strong> pin of the <strong class="bold">For Each </strong><strong class="bold">Loop</strong> node</li></ul></li>
<li>From the <strong class="bold">Functions</strong> panel, drag an <strong class="bold">Enable Search Button</strong> node onto the graph and connect its incoming execution pin to the <strong class="bold">Completed</strong> execution pin of the <strong class="bold">For Each </strong><strong class="bold">Loop</strong> node.</li>
</ol>
<p>This second part of the graph looks for a list of available sessions in the network, displays a result message, and adds the results to the session list. The graph is shown in <em class="italic">Figure 12</em><em class="italic">.23</em>:</p>
<div><div><img alt="Figure 12.23 – The second part of the FindSessions graph" src="img/Figure_12_23_B18203.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.23 – The second part of the FindSessions graph</p>
<p>The last part of the graph will just show an error message if the search results with a failure.</p>
<ol>
<li value="16">From<a id="_idIndexMarker730"/> the <strong class="bold">Variables</strong> panel, drag a <strong class="bold">Session Message</strong> getter node and, from its outgoing pin, click and drag to add a <strong class="bold">Set Text</strong> node (from the <strong class="bold">Content</strong> category).</li>
<li>In the <code>Error searching for </code><code>available sessions</code>.</li>
<li>Connect its incoming execution pin to the <strong class="bold">On Failure</strong> outgoing execution pin of the <strong class="bold">Find </strong><strong class="bold">Sessions</strong> node.</li>
<li>Connect its outgoing execution pin to an <strong class="bold">Enable Search Button</strong> node to make the button clickable again.</li>
</ol>
<p>This part of the graph is self-explanatory and is depicted in <em class="italic">Figure 12</em><em class="italic">.24</em>:</p>
<div><div><img alt="Figure 12.24 – The third part of the FindSessions graph" src="img/Figure_12_24_B18203.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.24 – The third part of the FindSessions graph</p>
<p>We have finally completed this widget and we are now ready to put things together in the <strong class="bold">Main </strong><strong class="bold">Menu</strong> widget.</p>
<h2 id="_idParaDest-252"><a id="_idTextAnchor253"/>Creating the Main Menu widget</h2>
<p>The <strong class="bold">Main Menu</strong> widget – the<a id="_idIndexMarker731"/> fourth and last one – simply acts as a container for the <strong class="bold">Create Session</strong> and <strong class="bold">Find Sessions</strong> ones. To <a id="_idIndexMarker732"/>create it, follow these steps:</p>
<ol>
<li>Right-click inside the Content Browser area and select <strong class="bold">User Interface</strong> | <strong class="bold">Widget Blueprint</strong>. In the pop-up window that appears, select <strong class="bold">User Widget</strong>.</li>
<li>Name the newly created widget <code>WB_MainMenu</code> and double-click on it to open it.</li>
<li>From the <strong class="bold">Palette</strong> window, drag a <strong class="bold">Canvas Panel</strong> item into the <strong class="bold">Designer</strong> view.</li>
<li>From the <strong class="bold">Palette</strong> menu, drag a <strong class="bold">WB Create Session</strong> item onto the <strong class="bold">Canvas</strong> panel and place it somewhere you think is appropriate.</li>
<li>From the <strong class="bold">Palette</strong> menu, drag a <strong class="bold">WB Find Sessions</strong> item onto the <strong class="bold">Canvas</strong> panel and place it somewhere you think is appropriate.</li>
</ol>
<p>The <strong class="bold">Designer</strong> view for this widget should look similar to the one shown in <em class="italic">Figure 12</em><em class="italic">.25</em>:</p>
<div><div><img alt="Figure 12.25 – The MainMenu widget" src="img/Figure_12_25_B18203.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 12.25 – The MainMenu widget</p>
<p>In this section, you <a id="_idIndexMarker733"/>created the user interface for the<a id="_idIndexMarker734"/> main menu level, which is composed of reusable widgets. Each widget contains dedicated logic for creating sessions and joining them.</p>
<h1 id="_idParaDest-253"><a id="_idTextAnchor254"/>Summary</h1>
<p>This chapter introduced you to the primary session commands within Unreal Engine’s Online Subsystem, providing you with the tools necessary to create, join, and manage multiplayer game sessions with ease. Armed with this knowledge, you have created a user interface that harnesses these features and puts them to practical use.</p>
<p>If you want to take your multiplayer game from being just a basic prototype to a fully functional and complete gaming experience, then you must learn how to use these features. Trust me – having this knowledge under your belt will make all the difference and help you create some truly awesome multiplayer games!</p>
<p>In the next chapter, we’ll take these helpful widgets and use them to create the main menu for the game. We’ll also create the needed Gameplay Framework classes, as well as a cool system for customizing the character’s appearance!</p>
</div>
</body></html>