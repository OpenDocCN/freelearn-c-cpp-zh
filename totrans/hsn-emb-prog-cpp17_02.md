# 什么是嵌入式系统？

实际上，**嵌入式系统**中的**嵌入式**部分指的是嵌入到更大系统中的状态。被嵌入的系统是某种描述的计算机系统，它在整体系统中具有一个或多个非常具体的功能，而不是作为一个通用组件。这个更大的系统可以是数字的、机械的或模拟的，而额外的集成数字电路与来自和到接口、传感器和内存的数据紧密交互，以实现实际系统功能。

在本章中，我们将探讨以下主题：

+   嵌入式平台的各个类别

+   每个类别的示例

+   每个类别的开发挑战

# 嵌入式系统的多面性

今天设备中的每个计算机化功能都是使用一个或多个微处理器实现的，这意味着计算机处理器（中央处理单元，或 CPU）通常包含在一个单一的**集成电路**（**IC**）中。微处理器至少包括**算术逻辑单元**（**ALU**）和控制电路，但逻辑上还包括寄存器和**输入/输出**（**I/O**）银行，以及针对特定产品类别（可穿戴设备、低功耗传感器、混合信号等）或市场（消费、医疗、汽车等）的更高级功能。

在这个历史时刻，几乎所有微处理器都存在于嵌入式系统中。尽管人们可能拥有电脑、笔记本电脑和智能手机，甚至可能有平板电脑，但一个家庭中嵌入式微处理器的数量远远超过通用微处理器的数量。

即使在笔记本电脑或 PC 中，除了其通用 CPU 外，还有许多嵌入式微处理器。这些微处理器执行的任务包括处理键盘或鼠标输入、处理触摸屏输入、将数据流转换为以太网包，或创建视频或音频输出。

在较老的系统中，如 Commodore 64，我们可以看到相同的模式，有一个 CPU 集成电路、声音集成电路、视频集成电路等。CPU 运行应用程序开发者编写的任何代码，而系统中的其他芯片具有非常具体的目的，甚至包括软盘或硬盘驱动器的控制器集成电路。

在通用计算机之外，我们到处都能找到嵌入式微处理器，通常以更集成的 MCU 形式存在。它们控制厨房设备、洗衣机和我们的汽车引擎，以及高级功能和传感器信息的处理。

虽然最初的微波炉是模拟设备，使用机械定时器和可变电阻来设置功率水平和持续时间，但今天的微波炉至少包含一个微控制器，负责处理用户输入、驱动某种类型的显示以及配置微波炉的系统。显示本身也可以有自己的微控制器，这取决于所选配置的复杂性。

更令人兴奋的是，嵌入式系统还提供了监控、自动化和故障安全功能，这些功能使飞机能够飞行，确保导弹和太空火箭按预期工作，并在医学和机器人等领域实现越来越多的可能性。飞机的航空电子设备不断监控来自众多传感器的无数参数，在它的三重冗余配置上运行相同的代码以检测任何可能的故障。

微型但强大的微处理器能够快速分析化学物质和 DNA 或 RNA 链，这在以前需要成排的设备。随着技术的进步，嵌入式系统已经变得足够小，可以穿过人体来监测其健康状况。

超出地球之外，火星、月球和小行星上的太空探测器与漫游车每天都在执行着各种各样的任务，这一切都得益于经过充分测试的嵌入式系统的便利。月球任务本身之所以成为可能，归功于第一个以阿波罗导航计算机为形式的嵌入式系统的重要实例。这个 1966 年代的嵌入式系统由充满三输入 NOR 逻辑门的绕线板组成，专为处理由土星 V 火箭发射的指挥舱和登月舱的导航、指导和控制而构建。

嵌入式系统的普遍性和多功能性使它们成为现代生活不可或缺的一部分。

对于嵌入式系统来说，它们通常被划分为以下几类：

+   **微控制器**（MCU）

+   **片上系统**（SoC），通常作为**单板计算机**（SBC）

# 微控制器

嵌入式系统领域的创新动力之一是成本，因为它们通常会是高产量、低成本的消费产品。为此，将整个微处理器、内存、存储和输入/输出外围设备集成到单个芯片上是有帮助的，这简化了实施工作，减少了 PCB 面积，同时还有更快、更简单的设计和生产以及更高的产出的额外好处。这导致了 20 世纪 70 年代**微控制器**（MCU）的发展：可以以最低成本添加到新设计中的单片计算机系统。

在 20 世纪 90 年代初将**电可擦可编程只读存储器**（EEPROM）引入微控制器（MCU）之后，首次实现了在不使用紫外线通过 MCU 封装中的特殊石英窗口擦除内存内容的情况下，重复写入 MCU 的程序内存。这使得原型设计更加容易，进一步降低了成本，并且在开发和低产量生产方面，还降低了电路编程的难度。

因此，许多以前由复杂的机械和模拟机制（如电梯和温度控制器）控制的系统现在包含一个或多个 MCU，它们处理相同的功能，同时降低成本并提高可靠性。通过在软件中处理功能，开发人员还可以自由添加高级功能，如复杂的预设程序（用于洗衣机、微波炉等）和简单到复杂的显示，以向用户提供反馈。

# TMS 1000

第一款商业可用的 MCU 是德州仪器的 TMS 1000，一款通用的 4 位单片系统。它首次于 1974 年上市销售。原始型号有 1 KB 的 ROM，64 x 4 位的 RAM 和 23 个 I/O 引脚。它们的时钟速度可以从 100 到 400 KHz，每个指令执行六个时钟周期。

后续型号会增加 ROM 和 RAM 的容量，尽管基本设计在 1981 年停产之前基本保持不变：

![图片](img/3b757a88-54d0-4f2c-a0d1-367c2523d7c2.png)

MCU 芯片的尺寸大约为 5 x 5 毫米，足够小，可以装入 DIP 封装中。这种类型的 MCU 使用掩模编程的 ROM，这意味着你不能得到一个空白的 TMS 1000 芯片并对其进行编程。相反，你必须将调试后的程序发送给德州仪器，以便使用光刻掩模物理生产，从而为每个位产生一个金属桥。

作为一种相对原始的设计（相对于后来的 MCU），它缺少堆栈和中断，有一组 43 条指令和两个通用寄存器，使其与英特尔 4004 CPU 非常相似。一些型号具有用于驱动**真空荧光显示器**（**VFD**）和连续读取输入的特殊外围设备，以通过键盘处理用户输入而不中断主程序。其基本引脚排列如下：

![图片](img/d3dc0886-0ef2-4ab9-906d-8c68a6eeff37.png)

显然，引脚功能早于我们今天所知的**通用输入/输出**（**GPIO**）引脚 - **K**引脚只能用于输入，而输出引脚标记为**O**，控制引脚标记为**R**。**OSC**引脚需要连接到外部振荡器电路。与离散逻辑 IC 类似，**Init**引脚用于在电源开启时初始化芯片，并且至少需要保持六个周期的高电平，而最近的 MCU 集成了上电复位（POR）和一个最多需要一个离散电阻和电容的复位引脚。

根据 1974 年原始德州仪器新闻稿，如果你大量购买，这些微控制器可以以 3 美元或更少的低价获得。它们将被用于流行的玩具，如 Speak and Spell，但几乎无处不在，包括家用电器、汽车和科学设备。到 20 世纪 80 年代初生产停止时，已经售出了数百万台。

同样值得注意的是，尽管一次性可编程低成本微控制器的价格大幅下降，但这类产品仍然坚持了下来——以 Padauk PMS150C 为例，现在只需 0.03 美元即可购买，尽管它提供的是 8 位架构，但其 1K 字节的 ROM 和 64 字节的 RAM 听起来有些奇怪地熟悉。

# Intel MCS-48

英特尔对德州仪器的成功 TMS 1000 MCU 的回应是 MCS-48 系列，8048、8035 和 8748 是 1976 年首次发布的型号。8048 有 1 KB 的 ROM 和 64 字节的 RAM。它是一个 8 位设计，具有哈佛架构（代码/数据内存分离），引入了 8 位的原生字长和中断支持（两级单级）并且与 8080/8085 外围设备兼容，使其成为一个高度通用的 MCU。更宽的 ALU 和寄存器字长的好处至今仍可感知，例如，在 8 位 MCU 上，32 位加法是作为一系列 8 位加法带进位顺序执行的。

MCS-48 具有超过 96 条指令，其中大多数长度为单字节，并且允许添加外部内存以补充内部内存。在社区的努力下，有关 MCS-48 系列的信息已被汇编并发布在[`devsaurus.github.io/mcs-48/mcs-48.pdf`](https://devsaurus.github.io/mcs-48/mcs-48.pdf) 。

在这里，我们考虑 MCS-48 功能框图的简单性，并将其与后继产品进行比较如下：

![](img/b5d1ac0d-9dea-45f2-a35b-77b9c74a8ade.png)

即使是比 TMS 1000 晚几年推出的设计，MCU 设计的快速演变也是显而易见的。由于 MCU 设计是与当时流行的 CPU 设计同步发展的，包括 6502、其 16 位版本以及最终成为 M68K 处理器家族的处理器，因此可以发现许多相似之处。

由于其灵活的设计，它一直流行并生产到 20 世纪 90 年代，直到 MCS-51（8051）系列逐渐取代它。下一节将详细介绍 8051。

MCS-48 被用于原始 IBM PC 的键盘控制器。它还与 80286 和 80386 一起使用，在 80286 的情况下执行 A20 线选通和复位功能。后来的 PC 将把这些功能集成到超级 I/O 设备中。

MCS-48 的其他显著用途包括 Magnavox Odyssey 视频游戏机和一系列 Korg 和 Roland 模拟合成器。虽然 MCS-48 系列提供了掩模 ROM（高达 2 KB）作为选项，但 87P50 使用外部 ROM 模块进行编程，而 8748 和 8749 具有高达 2 KB 的 EPROM，这使得 MCU 的内部编程可以反复更改。

就像独立的 EPROM 模块一样，这需要封装中包含一个熔融石英窗口，它允许紫外线到达 MCU 芯片，如下面的 8749 MCU 带 EPROM 的照片中可以清楚地看到（由 Konstantin Lanzet 提供，CC BY-SA 3.0）：

![](img/4ad70b0c-1c97-4323-ae7e-4c79e53867d6.png)

定义位为写入的 EPROM 单元中存储的电荷在 20-30 分钟的强紫外光照射下耗散。同样，在几周内直接阳光下也能达到相同效果。擦除周期通常意味着移除封装并将其放入光密擦除设备中。之后，EPROM 可以重新编程。EPROM 的指定数据保留时间为约 10-20 年（在 85°C 下），由于温度的退化呈指数加速，室温下 100 年或更长时间的声明并不罕见（27C512A：200 年）。

由于创建石英窗口并将其集成到封装中的成本，曾经使用了一段时间的一次性可编程 EPROM，它允许轻松编程 EPROM，但将编程好的芯片封装在不透明的封装中，因此无法再编程。最终，在 20 世纪 80 年代初，EEPROM 变得可用，几乎完全取代了 EPROM。EEPROM 可以在大约一百万次重写之前开始出现保留存储数据的问题。它们的数据保留性能与 EPROM 相似。

# 英特尔 MCS-51

从 Cypress CY7C68013A（USB 外围控制器）到 Ti CC2541（一款蓝牙 SoC）的最近芯片都具备商品化的 8051 核心，这表明英特尔 MCS-51 系列的设计至今仍很受欢迎。其他制造商也有大量的派生型 MCU，尽管英特尔在 2007 年 3 月停止生产这一系列的 MCU。首次在 20 世纪 80 年代推出，它是一款与 8048 类似的 8 位 MCU，但其功能集得到了大幅扩展。

如英特尔 80xxAH 数据表所示的功能框图如下所示：

![图片](img/893fbdf4-9c16-48cd-8446-bc058a32f4f0.png)

它与 Atmel（现在是微芯）AT89S51 非常相似，该产品至今仍在生产。

数据表通常在*特性*列表中讨论尺寸和性能指标，如下面的 AT89S51 所示：

+   4K 字节的**系统内可编程**（**ISP**）闪存

    - 耐用性：10,000 次写入/擦除周期（EEPROM 为 1,000,000 次）

+   4.0 V 至 5.5 V 的工作范围

+   完全静态操作：0 Hz 至 33 MHz（之前为 12 MHz）

+   三级程序存储器锁定

+   128 x 8 位内部 RAM

+   32 个可编程 I/O 线

但随后列表继续扩展到现代核心、外围、低功耗和可用性功能：

+   两个 16 位定时器/计数器

+   六个中断源

+   全双工 UART 串行通道

+   低功耗空闲和掉电模式

+   从掉电模式中断恢复

+   看门狗定时器

+   双数据指针

+   断电标志

+   快速编程时间

+   灵活的 ISP 编程，字节和页面模式

过去几十年中，8051 架构的唯一重大变化是从原始的**n 型金属氧化物半导体**（**NMOS**）晶体管技术迁移到**互补 MOS**（**CMOS**）——通常表示为 80C51——以及最近 USB、I2C 和 SPI 接口的添加，以及从本世纪初开始变得普遍的先进电源管理和调试接口。Atmel 应用笔记 3487A 没有给出字母 S 的简洁解释，然而当时新引入的电路内串行编程（ISP）可能因此被突出。

AT89S51 的引脚图说明了 SPI 引脚（MOSI、MISO、SCK）：

![](img/a764f469-f62f-4b51-99ee-5cc20c141900.png)

除了独立的 MCU 之外，8051 核心还被集成到更大的系统中，其中低功耗、基本 MCU 被用于各种低速度、实时或高 I/O 计数任务。从 Ti CC2541（蓝牙低功耗 SoC）到 Cypress CY7C68013A（FX2LP™ USB 外围控制器）等广泛芯片证明了 8051 架构至今的实用性和相关性。

在**现场可编程门阵列**（**FPGA**）或**专用集成电路**（**ASIC**）开发中，8051 型处理器也常作为软核使用，它们被适应并添加到 VHDL 和 Verilog HDL 项目中，以处理更适合顺序执行的任务，无需紧密的时序或大带宽。最后但同样重要的是，软核的魅力在于能够在保持与剩余硬件设计紧密集成的同时，使用全功能的开发和调试工具。软核运行的程序代码可能只有几百字节，但可能是一个大型状态机、内存、计数器和类似 ALU 的逻辑，这些都引发了哪个实现更容易验证和维护的问题。

# PIC

MCU 的 PIC 系列首次由通用仪器于 1976 年推出，使用他们新的 CP1600 16 位 CPU。这个 CPU 的指令集几乎与 PDP-11 系列处理器兼容。

1987 年，通用仪器将其微电子部门剥离出来，创建了 Microchip Technology，该公司于 1989 年成为一家独立公司。Microchip 技术至今仍在生产新的 PIC 设计。随着 PIC 核心和外设的演变，片上内存技术的发展导致了光密封装的 EPROM 的引入，用于及时编程，后来又引入了 EEPROM，用于电路编程能力。像大多数 MCU 一样，PIC MCU 具有哈佛架构。今天，PIC 设计从 8 位到 32 位，具有广泛的功能。以下是本书写作时的 PIC 系列：

| **系列** | **引脚** | **内存** | **详情** |
| --- | --- | --- | --- |
| PIC10 | 6-8 | 384-896 bytes ROM，64-512 bytes RAM | 8 位，8-16 MHz，修改后的哈佛架构 |
| PIC12 | 8 | 2-16 KB ROM，256 bytes RAM | 8 位，16 MHz，修改后的哈佛架构 |
| PIC16 | 8-64 | 3.5-56 KB ROM, 1-4 KB RAM | 8 位改进的哈佛架构 |
| PIC17 | 40-68 | 4-16 KB ROM, 232-454 bytes RAM | 8 位，33 MHz，被 PIC18 取代，尽管存在第三方克隆。 |
| PIC18 | 28-100 | 16-128 KB ROM, 3,728-4,096 bytes RAM | 8 位改进的哈佛架构 |
| PIC24 (dsPIC) | 14-144 | 64-1,024KB ROM, 8-16 KB RAM | 16 位，DsPIC（dsPIC33）微控制器内置数字信号处理（DSP）外设。 |
| PIC32MX | 64-100 | 32-512 KB ROM, 8-32 KB RAM | 32 位，200 MHz MIPS M4K，带有 MIPS16e 模式，2007 年发布。 |
| PIC32MZ ECPIC32MZ EFPIC32MZ DA | 64-288 | 512-2,048 KB ROM, 256-640 KB 静态 RAM（32 MB DDR2 DRAM） | 32 位，MIPS ISA（2013），PIC32MZ DA 版本（2017）具有图形核心。核心速度为 200 MHz（EC、DA）和 252 MHz（EF）。 |
| PIC32MM | 20-64 | 16-256 KB RAM, 4-32 KB RAM | 32 位 microMIPS，25 MHz，针对低成本和低功耗优化的变体。 |
| PIC32MK | 64-100 | 512-1,024 KB ROM, 128-256 KB RAM | 32 位，120 MHz，MIPS 指令集架构（ISA），2017 年推出的变体。针对工业控制和深度集成应用。 |

PIC32 系列家族有趣之处在于它们基于 MIPS 处理器核心，并使用这种**指令集架构（ISA**）而不是所有其他 PIC 微控制器使用的 PIC ISA。它们共享的处理器核心设计是 M4K，来自 MIPS 技术的 32 位 MIPS32 核心。在这些家族之间，从各自的数据表中的块图来看，差异很容易发现。

微控制器系列 PIC 的发展几十年，或许最好通过功能块图来具体体现，所以我们首先看看 PIC10：

![图片](img/90869401-7d48-4657-b198-ad7556ad1ca8.png)

这些是非常小的微控制器，处理器核心周围几乎没有外设——这里没有更详细地定义——引用的表格仅提到内存布局。I/O 端口非常有限，我们今天所知的 I2C 和 UART 接口并未作为外设逻辑实现。以选择下一个控制器为例，PIC16F84 数据表在处理器架构方面非常详细，显示在同时扩展 GPIO 和添加 EEPROM 以实现易于集成的非易失性存储的同时，还增加了更多的上电和复位电路。自包含的串行外设仍然不存在。

接下来，我们将看看 PIC18：

![图片](img/e6ce1ab5-1c0f-4c29-b0c3-7e061f2310c5.png)

PIC18 系列是最新 8 位 PIC 架构，其微控制器覆盖了广泛的应用范围。它比 PIC10、PIC12 和 PIC16 系列具有更多的 I/O 选项，同时在 ROM 和 RAM 方面也提供了更多选项，现在还提供了与同步串行端口一起的 USART，用于 4 线 SPI。请注意，端口现在具有备用引脚功能，并且为了简化，没有显示从外设到引脚以及相应的配置寄存器的路由。

接下来，让我们观察在 PIC24 功能块图中，焦点从核心转移到端口和外围功能的变化：

![](img/7c2d613d-7ecb-41b3-b888-92bc4c9eb493.png)

该图与 PIC10 的图类似，CPU 相对于整个微控制器被抽象为一个单独的块。每个`PORT`块代表一组 I/O 引脚，我们正在耗尽空间来显示所有可能的引脚功能。

每个 I/O 引脚都可以具有一个固定功能（与外围模块相关联），或者具有一个可分配的功能（硬件级重路由，或在软件中完成）。一般来说，微控制器越复杂，I/O 引脚越可能是通用的，而不是固定功能的。

最后，我们来看看 PIC32：

![](img/473399ca-4ada-4083-8265-cae721ce7a90.png)

这个框图是针对 PIC32MX1XX/2XX 系列中的 PIC32 设备的。它通常以 50 MHz 的频率运行。

PIC32 架构的一个有趣特性是，它通过让程序指令和数据都通过系统总线矩阵传输，有效地将哈佛架构的 M4K MIPS CPU 转变为更类似于约翰·冯·诺伊曼的架构。请注意，在 PIC10 图中专门为单个处理器寄存器分配的空间现在随意表示一个复杂的数字或混合信号外围设备，或者强大的 JTAG 在电路编程和调试接口。

# AVR

AVR 架构是由挪威理工学院的两名学生开发的，原始的 AVR 微控制器是在 Nordic VLSI（现在为 Nordic Semiconductor）开发的。它最初被称为μRISC，可用于许可，直到这项技术被 Atmel 收购。第一个 Atmel AVR 微控制器于 1997 年发布。

现在，我们可以回顾众多 8 位 AVR 系列：

| **系列** | **引脚数** | **存储器** | **详细信息** |
| --- | --- | --- | --- |
| ATtiny | 6-32 | 0.5-16KB ROM 0-2 KB RAM | 1.6-20 MHz. 紧凑、高效、功能有限的微控制器。 |
| ATmega | 32-100 | 4-256 KB ROM 0.5-32 KB RAM |  |
| ATxmega | 44-100 | 16-384 KB ROM, 1-32 KB RAM | 32 MHz，最大的 AVR 微控制器，具有广泛的外围设备和性能增强功能，如 DMA。 |

曾经还有一个 32 位的 AVR32 架构，但 Atmel 已经将其弃用，因为它转向了 ARM 32 位架构（SAM）。有关 SAM 的更多详细信息，请参阅*基于 ARM 的微控制器*部分。更详细的信息可以在相应的[产品选择指南](http://ww1.microchip.com/downloads/en/DeviceDoc/Atmel-45154-Product-Selection-Guide_Brochure.pdf)中找到。

此外，Atmel 曾经拥有所谓的**现场可编程系统级集成电路**（**FPSLIC**）微控制器：混合 AVR/FPGA 系统。这些系统实际上允许你向 AVR 微控制器的硬件中添加自己的外围设备和功能。

让我们看看 ATtiny 系列。这是 ATtiny212/412 系列微控制器的框图：

![](img/05383bb6-99ec-434c-b603-09548ed2532e.png)

这一系列的 ATtiny MCU 可以运行高达 20 MHz，具有高达 4 KB 的闪存 ROM 和 256 字节的 SRAM，以及高达 128 字节的 EEPROM，所有这些都在一个 8 引脚封装中。尽管体积小巧，但它具有大量外设，可以路由到任何支持的引脚：

![](img/ad999a59-ffc7-4ab8-9089-7bf6be05bb22.png)

与流行的 ATmega2560 和相关 MCU 相比，以下是其特性：

| **设备** | **闪存 (KB)** | **EEPROM (KB)** | **RAM (KB)** | **通用 I/O 引脚** | **16 位 PWM 通道** | **UART** | **ADC 通道** |
| --- | --- | --- | --- | --- | --- | --- | --- |
| ATmega640 | 64 | 4 | 8 | 86 | 12 | 4 | 16 |
| ATmega1280 | 128 | 4 | 8 | 86 | 12 | 4 | 16 |
| ATmega1281 | 128 | 4 | 8 | 54 | 6 | 2 | 8 |
| ATmega2560 | 256 | 4 | 8 | 86 | 12 | 4 | 16 |
| ATmega2561 | 256 | 4 | 8 | 54 | 6 | 2 | 8 |

由于 GPIO 引脚数量达到数十个，因此框图也相应地更加复杂，具有更多用于 I/O 引脚的端口块：

![](img/ce7750cb-a33d-49af-842d-a414db0e2b60.png)

在这里，所有进入和出去的箭头都表示一个引脚或一组引脚，其中大多数是通用引脚。由于引脚数量众多，对于物理芯片来说，再使用内联封装格式（DIP、SOIC 等）已不再实用。

对于 ATmega640、1280 和 2560，使用 100 引脚 TQFP 封装，这里每个引脚的功能如数据表所示：

![](img/7d0a8e35-d4cb-4e8b-825f-247338630835.png)

ATxmega 系列与 ATmega 非常相似，具有相似的引脚排列，主要通过架构变更和优化、更多的 ROM 和 RAM 以及外设选项来区分自己。

选择 ATtiny、ATmega 或 ATxmega MCU 首先取决于您项目的要求，特别是所需的输入和输出、外设类型（串行、SPI、I2C、CAN 等），以及运行此代码所需的代码和 RAM 的大小。

# 基于 M68k 和 Z80

Zilog Z80 8 位处理器是一种与 Intel 8080 兼容的处理器，在 1980 年代与其他微处理器竞争，为家用电脑和游戏系统供电，包括任天堂 Game Boy、世嘉 Master System、 Sinclair ZX80/ZX81/Spectrum、MSX 和 Tandy TRS-80。

Zilog 于 1994 年推出了一种基于 Z80 微处理器的 MCU（Z380），多年来进行了各种更新，包括 Z8、eZ80 等。Z80 克隆机也很常见。

另一种流行的 1980 年代微处理器是摩托罗拉 68k（或 68000）。它的算术逻辑单元和外部数据总线是 16 位，但具有 32 位寄存器和 32 位内部数据总线。自 1979 年推出以来，其架构至今仍在使用，飞思卡尔半导体（现为 NXP）生产了多种 68k 微处理器。

摩托罗拉在 1989 年推出了基于 68k 架构的多种 MCU，包括 MC68320 通信控制器。当前的 68k 基于的 MCU 设计包括 ColdFire，它是一个完全 32 位的设计。

# ARM Cortex-M

32 位 MCU 中非常常见的一种是 ARM Cortex-M 系列。它包括 M0、M0+、M1、M3、M4、M7、M23 和 M33，其中许多具有**浮点单元**（**FPU**）选项，以提高浮点性能。

它们不仅被用作独立的 MCU，还通常集成到**片上系统**（**SoC**）设备中，以提供特定的功能，例如触摸屏、传感器或电源管理功能。由于 Arm Holdings 本身不制造任何 MCU，许多第三方制造商已获得设计许可，有时会进行自己的修改和改进。

下面是这些 MCU 的简要概述：

| **核心** | **发布** | **架构** | **指令集** |
| --- | --- | --- | --- |
| M0 | 2009 | Armv6-M | Thumb-1，部分 Thumb-2。 |
| M0+ | 2012 | Armv6-M | Thumb-1，部分 Thumb-2。 |
| M1 | 2007 | Armv6-M | Thumb-1，部分 Thumb-2。 |
| M3 | 2004 | Armv7-M | Thumb-1，Thumb-2。 |
| M4 | 2010 | Armv7-M | Thumb1，Thumb-2，可选 FPU。 |
| M7 | 2014 | Armv7E-M | Thumb-1，Thumb-2，可选 FPU。 |
| M23 | 2016 | Armv8-M | Thumb-1，部分 Thumb-2。 |
| M33 | 2016 | Armv8-M | Thumb 1，Thumb-2，可选 FPU。 |

**Thumb** 指令集是紧凑的、16 位长度的指令，这使得它们非常适合嵌入式、资源受限的系统。除了 32 位指令集之外，其他 ARM 微处理器系列也可以支持这个 Thumb 指令集。

# H8（SuperH）

H8 系列 MCU 通常与 8 位、16 位和 32 位变体一起使用。最初由日立公司在 20 世纪 90 年代初创建，直到几年前，Renesas Technology 仍在创建新的设计，尽管后者建议新设计使用 RX（32 位）或 RL78（16 位）系列。H8 MCU 的一个显著用途是在乐高 Mindstorms RCX 控制器中，该控制器使用 H8/300 MCU。

# ESP8266/ESP32

ESP 系列 MCU 是由 Espressif Systems 生产的 32 位 MCU，集成了 Wi-Fi（两者）和蓝牙（ESP32）功能。

ESP8266 首次出现在 2014 年，当时由第三方制造商 Ai-Thinker 以模块（ESP-01）的形式出售，该模块可以被其他 MCU 或基于微处理器的系统使用，以提供 Wi-Fi 功能。该模块包含用于此目的的固件，允许使用 Hayes 风格的调制解调器命令来寻址该模块。

其系统规格如下：

+   Tensilica Xtensa Diamond Standard L106 微处理器（32 位）

+   80-160 MHz CPU 速度

+   用户应用程序可用的 RAM 少于 50 KB（加载 Wi-Fi 堆栈后）

+   外部 SPI ROM（512 KB 至 16 MB）

+   支持 802.11 b/g/n 的 Wi-Fi

由于 ESP-01 模块上的 32 位 MCU 被发现能够完成比分配给它的简单调制解调器任务多得多的任务，它很快就被用于更通用的任务，包括一系列升级的 ESP8266 模块（带有集成 EEPROM 芯片）以及分线板。在后者中，NodeMCU 风格的板变得非常受欢迎，尽管许多第三方制造商也制作了自己的分线板，这些分线板提供不同的外形和功能。

ESP8266EX 的基本框图如下：

![图片](img/f0bed65c-4e5c-4765-9d54-34ed7cdd3ee6.png)

在 ESP8266 取得巨大成功之后，Espressif Systems 开发了 ESP32，它采用了升级的双核 CPU 以及其他一些变化。其框图如下：

![图片](img/56fe4fde-18fb-4f1c-b82f-4f07034f5fc3.png)

其规格如下：

+   Xtensa 32 位 LX6（双核）微处理器

+   160-240 MHz 的 CPU 速度

+   520 KB 的 SRAM

+   支持 802.11 b/g/n 的 Wi-Fi

+   蓝牙 v4.2 和 BLE（低功耗）

ESP8266 和 ESP32 通常作为完整的模块出售，其中 MCU、外部 ROM 模块和 Wi-Fi 天线要么集成到板上，要么提供外部天线选项：

![图片](img/e66a9c6a-5202-4624-ac38-6a6d2b8273ca.png)

金属屏蔽可以覆盖板子，有助于保护板子免受电磁干扰，从而有利于其 Wi-Fi（以及 ESP32 的情况下的蓝牙）收发器，但整个设计需要固定天线和几何形状才能通过 FCC 认证，并在以后作为批准的模块使用。连接增益更高的外部天线可能违反当地法规。附带的 FCC ID 对于获得包含此类模块的产品商业化批准至关重要。

# 其他

除了之前列出的 MCU 之外，还有许多制造商提供具有不同架构的广泛 MCU。一些，如 Parallax 的 Propeller MCU，具有多核架构，相当独特，而大多数只是实现了常见的单核 CPU 架构，并带有多个外围设备、RAM 和内部或外部 ROM。

除了物理芯片之外，Altera（现在是 Intel）、Lattice Semiconductor 和 Xilinx 提供所谓的软核，这些 MCU 旨在在 FPGA 芯片上运行，无论是作为独立组件还是作为该 FPGA 上更大设计的一部分。这些也可以由 C/C++编译器针对。

# 挑战

MCU 的主要开发挑战在于可用的资源相对有限。特别是对于小型、低引脚数的 MCU，你必须很好地了解特定代码片段占用多少资源（CPU 周期、RAM 和 ROM），以及添加特定功能是否现实。

这也意味着为特定项目选择合适的 MCU 需要技术和经验。前者是选择适合任务的 MCU 所必需的；后者对于选择最优的 MCU 非常有帮助，并有助于缩短做出选择所需的时间。

# 系统级芯片/单板计算机

**系统级芯片（SoC**）与 MCU 类似，但通过在某种程度上实现集成同时仍需要一定数量的外部组件来区分这些类型的嵌入式系统。它们通常作为单板实现的一部分（**单板计算机（SBC**））出现，包括 PC/104 标准，以及最近出现的形态，如 Raspberry Pi 及其衍生板：

![图片](img/4dae667e-c4de-480b-9abb-3fda933f6019.png)

此图来自[`xdevs.com/article/rpi3_oc/`](https://xdevs.com/article/rpi3_oc/)。它清楚地展示了单板计算机（在本例中为 Raspberry Pi 3）的布局。BCM2837 是基于 ARM 的 SoC，提供 CPU 核心和基本外设（大部分集成到引脚部分）。所有 RAM 都位于外部模块中，以太网和 Wi-Fi 外设也是如此。ROM 以 SD（闪存）卡的形式提供，同时也提供存储。

大多数 SoC 都是基于 ARM 的（Cortex-A 系列），尽管 MIPS 也很常见。SBC 在工业环境中被广泛使用。

其他实例是大规模生产的板，如智能手机板，它们不形成预定义的形态，但仍然遵循相同的模式，即具有 SoC 和外部 RAM、ROM 和存储，以及各种外设。这与上一节中的 MCU 形成对比，MCU 总是能够独立工作，除了少数需要外部 ROM 的 MCU。

# 挑战

与 MCU 相比，SoC 的开发挑战通常要小得多。其中一些挑战与水平相当，并且有一个接口可以直接在设备上开发，甚至可以在设备上直接进行编译周期，而无需在 PC 上进行交叉编译并复制二进制文件。运行完整的操作系统而不是为裸机开发也有助于这一点。

显而易见的缺点是，随着功能的增加，复杂性也随之增加，随之而来的复杂问题，如处理用户账户、设置权限、管理设备驱动程序等。

# 摘要

在本章中，我们深入了解了嵌入式系统的构成。我们学习了如何区分各种类型的嵌入式系统，以及如何确定选择合适 MCU 或 SoC 的项目基础。

在本章之后，读者应该能够舒适地阅读 MCU 和 SoC 的数据表，解释两者之间的差异，并确定特定项目所需的内容。

下一章将探讨为什么 C++是嵌入式系统编程的一个高度合适的选择。
