<html><head></head><body>
<div id="_idContainer133">
<h1 class="chapter-number" id="_idParaDest-158"><a id="_idTextAnchor158"/><span class="koboSpan" id="kobo.1.1">8</span></h1>
<h1 id="_idParaDest-159"><a id="_idTextAnchor159"/><span class="koboSpan" id="kobo.2.1">Working with the Arduino IoT Cloud SDK and JavaScript</span></h1>
<p><span class="koboSpan" id="kobo.3.1">Every platform provides </span><strong class="bold"><span class="koboSpan" id="kobo.4.1">APIs</span></strong><span class="koboSpan" id="kobo.5.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.6.1">SDKs</span></strong><span class="koboSpan" id="kobo.7.1"> to make their product compatible with other platforms, and these endpoints are used by developers to create new functionalities to solve real-world issues. </span><span class="koboSpan" id="kobo.7.2">Likewise, the </span><strong class="bold"><span class="koboSpan" id="kobo.8.1">Arduino IoT Cloud</span></strong><span class="koboSpan" id="kobo.9.1"> comes with its own built-in features and functionalities, but there are also three different ways to extend the Arduino IoT Cloud platform’s functionality or make it compatible with other tools and services: namely, </span><strong class="bold"><span class="koboSpan" id="kobo.10.1">REST APIs</span></strong><span class="koboSpan" id="kobo.11.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.12.1">SDKs</span></strong><span class="koboSpan" id="kobo.13.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">and </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.15.1">webhooks</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.17.1">In this chapter, we will talk about APIs and SDKs and how they work. </span><span class="koboSpan" id="kobo.17.2">Specifically, we will use the </span><strong class="bold"><span class="koboSpan" id="kobo.18.1">Node.js SDK</span></strong><span class="koboSpan" id="kobo.19.1"> to illustrate different coding exercises. </span><span class="koboSpan" id="kobo.19.2">This chapter will cover </span><strong class="bold"><span class="koboSpan" id="kobo.20.1">Create, Read, Update, and Delete</span></strong><span class="koboSpan" id="kobo.21.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.22.1">CRUD</span></strong><span class="koboSpan" id="kobo.23.1">) operations for devices, Things, properties (aka variables), and dashboards. </span><span class="koboSpan" id="kobo.23.2">Beyond that, we will explore some other features such as how to set/get values </span><span class="No-Break"><span class="koboSpan" id="kobo.24.1">of properties.</span></span></p>
<p><span class="koboSpan" id="kobo.25.1">By the end of this chapter, you will understand how to interact with the Arduino IoT Cloud platform via an API or the Node.js SDK to create custom dashboards, interface with the data using other tools/apps, and use the SDK for bulk device creation </span><span class="No-Break"><span class="koboSpan" id="kobo.26.1">and management.</span></span></p>
<p><span class="koboSpan" id="kobo.27.1">In this chapter, we’re going to cover the following </span><span class="No-Break"><span class="koboSpan" id="kobo.28.1">main topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.29.1">Demystifying the Arduino IoT Cloud SDK – functionality </span><span class="No-Break"><span class="koboSpan" id="kobo.30.1">and operation</span></span></li>
<li><span class="koboSpan" id="kobo.31.1">Securing access – unveiling API keys </span><span class="No-Break"><span class="koboSpan" id="kobo.32.1">and authentication</span></span></li>
<li><span class="koboSpan" id="kobo.33.1">Step-by-step – installing the Arduino Node.js </span><span class="No-Break"><span class="koboSpan" id="kobo.34.1">SDK client</span></span></li>
<li><span class="koboSpan" id="kobo.35.1">Initial exploration – test drive </span><span class="No-Break"><span class="koboSpan" id="kobo.36.1">using Postman</span></span></li>
<li><span class="koboSpan" id="kobo.37.1">Diverse platform compatibility – SDKs for </span><span class="No-Break"><span class="koboSpan" id="kobo.38.1">various environments</span></span></li>
<li><span class="koboSpan" id="kobo.39.1">Interacting with devices – hands-on with the </span><span class="No-Break"><span class="koboSpan" id="kobo.40.1">Node.js SDK</span></span></li>
<li><span class="koboSpan" id="kobo.41.1">Engaging with Things – Node.js SDK </span><span class="No-Break"><span class="koboSpan" id="kobo.42.1">implementation guide</span></span></li>
<li><span class="koboSpan" id="kobo.43.1">Exploring properties – Node.js SDK </span><span class="No-Break"><span class="koboSpan" id="kobo.44.1">interaction techniques</span></span></li>
<li><span class="koboSpan" id="kobo.45.1">Crafting dashboards – unleashing potential via the </span><span class="No-Break"><span class="koboSpan" id="kobo.46.1">Node.js SDK</span></span></li>
<li><span class="koboSpan" id="kobo.47.1">Fine-tuning with the Node.js SDK – property </span><span class="No-Break"><span class="koboSpan" id="kobo.48.1">value management</span></span></li>
</ul>
<h1 id="_idParaDest-160"><a id="_idTextAnchor160"/><span class="koboSpan" id="kobo.49.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.50.1">There are no specific hardware requirements for this chapter as we are focusing on the SDK and will work through different coding exercises to perform different operations on the Arduino IoT Cloud platform using the Node.js SDK. </span><span class="koboSpan" id="kobo.50.2">To follow along with the coding and testing exercises, the following software </span><span class="No-Break"><span class="koboSpan" id="kobo.51.1">is required:</span></span></p>
<ul>
<li><span class="No-Break"><span class="koboSpan" id="kobo.52.1">Node.js</span></span></li>
<li><span class="koboSpan" id="kobo.53.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.54.1">Node.js Arduino IoT Cloud </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.55.1">module</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.56.1"> installed</span></span></li>
<li><span class="koboSpan" id="kobo.57.1">The </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.58.1">VSCode editor</span></strong></span></li>
<li><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.59.1">Postman</span></strong></span></li>
<li><span class="koboSpan" id="kobo.60.1">An Arduino IoT </span><span class="No-Break"><span class="koboSpan" id="kobo.61.1">Cloud account</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.62.1">Postman will be used for </span><strong class="bold"><span class="koboSpan" id="kobo.63.1">cURL testing</span></strong><span class="koboSpan" id="kobo.64.1"> and authentication, which will help other developers when doing request and response testing. </span><span class="koboSpan" id="kobo.64.2">For SDK coding, we will use Node.js and the VSCode editor. </span><span class="koboSpan" id="kobo.64.3">The code for this chapter is available from the book’s official GitHub repository </span><span class="No-Break"><span class="koboSpan" id="kobo.65.1">at </span></span><a href="https://github.com/PacktPublishing/Arduino-IoT-Cloud-for-Developers"><span class="No-Break"><span class="koboSpan" id="kobo.66.1">https://github.com/PacktPublishing/Arduino-IoT-Cloud-for-Developers</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.67.1">.</span></span></p>
<h1 id="_idParaDest-161"><a id="_idTextAnchor161"/><span class="koboSpan" id="kobo.68.1">Demystifying the Arduino IoT Cloud SDK – functionality and operation</span></h1>
<p><span class="koboSpan" id="kobo.69.1">The Arduino IoT Cloud</span><a id="_idIndexMarker605"/><span class="koboSpan" id="kobo.70.1"> offers a range of features, but there are inevitably situations where developers need to integrate their tools/systems/apps with the Arduino IoT Cloud for improved operations</span><a id="_idIndexMarker606"/><span class="koboSpan" id="kobo.71.1"> management and control. </span><span class="koboSpan" id="kobo.71.2">To cater to these requirements, the Arduino IoT Cloud provides different techniques and tools that can be used by developers and organizations</span><a id="_idIndexMarker607"/><span class="koboSpan" id="kobo.72.1"> to extend the product’s functionality and provide solutions for </span><span class="No-Break"><span class="koboSpan" id="kobo.73.1">real-world issues.</span></span></p>
<p><span class="koboSpan" id="kobo.74.1">As shown in the following diagram, the Arduino IoT Cloud provides three main interfaces</span><a id="_idIndexMarker608"/><span class="koboSpan" id="kobo.75.1"> to developers to help meet their requirements. </span><span class="koboSpan" id="kobo.75.2">First is webhooks, which we used in the previous chapter to send the data from an Arduino IoT Cloud Thing to a custom </span><strong class="bold"><span class="koboSpan" id="kobo.76.1">endpoint</span></strong><span class="koboSpan" id="kobo.77.1"> or any well-known platform including </span><strong class="bold"><span class="koboSpan" id="kobo.78.1">Zapier</span></strong><span class="koboSpan" id="kobo.79.1"> or </span><strong class="bold"><span class="koboSpan" id="kobo.80.1">IFTTT</span></strong><span class="koboSpan" id="kobo.81.1"> for further integration. </span><span class="koboSpan" id="kobo.81.2">Following webhooks, we have the REST API and SDK, both</span><a id="_idIndexMarker609"/><span class="koboSpan" id="kobo.82.1"> of which are very handy features for developers to mold</span><a id="_idIndexMarker610"/><span class="koboSpan" id="kobo.83.1"> the system according to </span><span class="No-Break"><span class="koboSpan" id="kobo.84.1">their requirements.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer127">
<span class="koboSpan" id="kobo.85.1"><img alt="Figure 8.1 – Arduino IoT Cloud interface" src="image/B19752_08_01.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.86.1">Figure 8.1 – Arduino IoT Cloud interface</span></p>
<p><span class="koboSpan" id="kobo.87.1">In this chapter, we are going</span><a id="_idIndexMarker611"/><span class="koboSpan" id="kobo.88.1"> to focus specifically on the Node.js SDK. </span><span class="koboSpan" id="kobo.88.2">However, it’s important first to give a proper overview of the Arduino IoT Cloud functionalities that can help developers make better decisions during integration with other platforms. </span><span class="koboSpan" id="kobo.88.3">The Arduino team has created REST API endpoints for different operations</span><a id="_idIndexMarker612"/><span class="koboSpan" id="kobo.89.1"> such as </span><em class="italic"><span class="koboSpan" id="kobo.90.1">create</span></em><span class="koboSpan" id="kobo.91.1">, </span><em class="italic"><span class="koboSpan" id="kobo.92.1">delete</span></em><span class="koboSpan" id="kobo.93.1">, </span><em class="italic"><span class="koboSpan" id="kobo.94.1">list</span></em><span class="koboSpan" id="kobo.95.1">, </span><em class="italic"><span class="koboSpan" id="kobo.96.1">update</span></em><span class="koboSpan" id="kobo.97.1">, and so on, and placed them into different categories according to the main terms used on the Arduino IoT Cloud platform, such as Thing, device, property, and so on. </span><span class="koboSpan" id="kobo.97.2">The developer can send a request to these endpoints via different methods such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.98.1">PUT</span></strong><span class="koboSpan" id="kobo.99.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.100.1">DELETE</span></strong><span class="koboSpan" id="kobo.101.1">, or </span><strong class="source-inline"><span class="koboSpan" id="kobo.102.1">GET</span></strong><span class="koboSpan" id="kobo.103.1"> with different parameters, and in return they will get their desired response from the Arduino IoT Cloud in JSON format that they can then use for further </span><span class="No-Break"><span class="koboSpan" id="kobo.104.1">product development.</span></span></p>
<p><span class="koboSpan" id="kobo.105.1">REST APIs are like raw material for developers in that they need to process them by writing code in their preferred language</span><a id="_idIndexMarker613"/><span class="koboSpan" id="kobo.106.1"> and sending and receiving requests and responses using the </span><strong class="bold"><span class="koboSpan" id="kobo.107.1">cURL library</span></strong><span class="koboSpan" id="kobo.108.1">. </span><span class="koboSpan" id="kobo.108.2">On the other hand, the Arduino team offers an SDK, which is basically a programming wrapper for REST API endpoints. </span><span class="koboSpan" id="kobo.108.3">This allows us to save time as we get access to a lot of methods and sample code to accomplish our tasks just using library methods. </span><span class="koboSpan" id="kobo.108.4">At the time of writing, the Arduino team has developed SDKs for three programming platforms: Node.js, </span><strong class="bold"><span class="koboSpan" id="kobo.109.1">Python</span></strong><span class="koboSpan" id="kobo.110.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.111.1">and </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.112.1">GoLang</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.113.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.114.1">In this chapter, we will work with the Node.js SDK specifically to create different scripts to perform CRUD operations on Things, devices, properties, and dashboards. </span><span class="koboSpan" id="kobo.114.2">We will also develop scripts that allow you to </span><em class="italic"><span class="koboSpan" id="kobo.115.1">fetch</span></em><span class="koboSpan" id="kobo.116.1">/</span><em class="italic"><span class="koboSpan" id="kobo.117.1">set</span></em><span class="koboSpan" id="kobo.118.1"> the latest values of Thing properties and much more. </span><span class="koboSpan" id="kobo.118.2">Overall, this chapter </span><a id="_idIndexMarker614"/><span class="koboSpan" id="kobo.119.1">will be fun for developers, as we are going to explore different techniques and methods</span><a id="_idIndexMarker615"/><span class="koboSpan" id="kobo.120.1"> that will help us extend IoT operations from small scale to </span><span class="No-Break"><span class="koboSpan" id="kobo.121.1">enterprise level.</span></span></p>
<p><span class="koboSpan" id="kobo.122.1">In this section, we have discussed what type of features the Arduino IoT Cloud API/SDKs provide to developers. </span><span class="koboSpan" id="kobo.122.2">In the next section, we will talk about API keys </span><span class="No-Break"><span class="koboSpan" id="kobo.123.1">for authentication.</span></span></p>
<h1 id="_idParaDest-162"><a id="_idTextAnchor162"/><span class="koboSpan" id="kobo.124.1">Securing access – unveiling API keys and authentication</span></h1>
<p><span class="koboSpan" id="kobo.125.1">Before heading into the meat of the chapter, we first need to talk about the authentication</span><a id="_idIndexMarker616"/><span class="koboSpan" id="kobo.126.1"> mechanism of the platform. </span><span class="koboSpan" id="kobo.126.2">The Arduino IoT Cloud uses a </span><strong class="bold"><span class="koboSpan" id="kobo.127.1">token authentication mechanism</span></strong><span class="koboSpan" id="kobo.128.1"> to validate API requests. </span><span class="koboSpan" id="kobo.128.2">This involves the SDK/tool sending the </span><strong class="bold"><span class="koboSpan" id="kobo.129.1">Client ID</span></strong><span class="koboSpan" id="kobo.130.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.131.1">Client Secret</span></strong><span class="koboSpan" id="kobo.132.1"> to </span><a href="https://api2.arduino.cc/iot/v1/clients/token"><span class="koboSpan" id="kobo.133.1">https://api2.arduino.cc/iot/v1/clients/token</span></a><span class="koboSpan" id="kobo.134.1"> to get a token that is used</span><a id="_idIndexMarker617"/><span class="koboSpan" id="kobo.135.1"> later to authenticate</span><a id="_idIndexMarker618"/> <span class="No-Break"><span class="koboSpan" id="kobo.136.1">for </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.137.1">requests</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.138.1">/</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.139.1">responses</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.140.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.141.1">Before we get started with the SDK installation and testing with Postman, we need to set up the API in the Arduino Cloud that will provide us the Client ID and Secret. </span><span class="koboSpan" id="kobo.141.2">In older versions of the interface, the API options are under the </span><strong class="bold"><span class="koboSpan" id="kobo.142.1">Integrations</span></strong><span class="koboSpan" id="kobo.143.1"> tab, but have now moved</span><a id="_idIndexMarker619"/><span class="koboSpan" id="kobo.144.1"> to the Arduino Cloud, which is available </span><span class="No-Break"><span class="koboSpan" id="kobo.145.1">at </span></span><a href="https://cloud.arduino.cc/home/"><span class="No-Break"><span class="koboSpan" id="kobo.146.1">https://cloud.arduino.cc/home/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.147.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.148.1">After visiting the Integration page click on </span><strong class="bold"><span class="koboSpan" id="kobo.149.1">API Keys</span></strong><span class="koboSpan" id="kobo.150.1"> and you will be taken</span><a id="_idIndexMarker620"/><span class="koboSpan" id="kobo.151.1"> to the API page. </span><span class="koboSpan" id="kobo.151.2">Click on </span><strong class="bold"><span class="koboSpan" id="kobo.152.1">CREATE API KEY</span></strong><span class="koboSpan" id="kobo.153.1">. </span><span class="koboSpan" id="kobo.153.2">A popup will appear; provide a name for the API and click on the </span><strong class="bold"><span class="koboSpan" id="kobo.154.1">CONTINUE</span></strong><span class="koboSpan" id="kobo.155.1"> button. </span><span class="koboSpan" id="kobo.155.2">The wizard that appears will take a few seconds to generate the keys and then a new popup will appear displaying</span><a id="_idIndexMarker621"/> <span class="No-Break"><span class="koboSpan" id="kobo.156.1">the keys:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer128">
<span class="koboSpan" id="kobo.157.1"><img alt="Figure 8.2 – API keys" src="image/B19752_08_02.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.158.1">Figure 8.2 – API keys</span></p>
<p><span class="koboSpan" id="kobo.159.1">Copy the </span><strong class="bold"><span class="koboSpan" id="kobo.160.1">Client ID</span></strong><span class="koboSpan" id="kobo.161.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.162.1">Client Secret</span></strong><span class="koboSpan" id="kobo.163.1"> values by clicking on the copy icons – never try to copy by manual</span><a id="_idIndexMarker622"/><span class="koboSpan" id="kobo.164.1"> selection as the </span><strong class="bold"><span class="koboSpan" id="kobo.165.1">Client Secret</span></strong><span class="koboSpan" id="kobo.166.1"> is very long, so clicking the copy icon is the best option. </span><span class="koboSpan" id="kobo.166.2">Save the both Client ID and Client Secret in a secure location and then click the checkbox confirming that you have saved your keys. </span><span class="koboSpan" id="kobo.166.3">Lastly, click on </span><strong class="bold"><span class="koboSpan" id="kobo.167.1">DONE</span></strong><span class="koboSpan" id="kobo.168.1"> and you will see your API key in the panel – it’s now ready </span><span class="No-Break"><span class="koboSpan" id="kobo.169.1">for use.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.170.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.171.1">A single API key is used to give access to all the Things and their variables. </span><span class="koboSpan" id="kobo.171.2">Having access to all infrastructure with just one API key is handy, instead of having to create separate API keys for each Thing, but you must take care of your key! </span><span class="koboSpan" id="kobo.171.3">This is a big security risk, as if you were to lose the key, a hacker could gain access to your </span><span class="No-Break"><span class="koboSpan" id="kobo.172.1">whole account.</span></span></p>
<p><span class="koboSpan" id="kobo.173.1">In this section, we have set up</span><a id="_idIndexMarker623"/><span class="koboSpan" id="kobo.174.1"> and created API authentication keys consisting</span><a id="_idIndexMarker624"/><span class="koboSpan" id="kobo.175.1"> of a Client ID and Client Secret. </span><span class="koboSpan" id="kobo.175.2">This section is most important, as without these keys we can’t use any APIs. </span><span class="koboSpan" id="kobo.175.3">In the next section, we are going to try our first API call using the </span><span class="No-Break"><span class="koboSpan" id="kobo.176.1">Postman tool.</span></span></p>
<h1 id="_idParaDest-163"><a id="_idTextAnchor163"/><span class="koboSpan" id="kobo.177.1">Initial exploration – test drive using Postman</span></h1>
<p><span class="koboSpan" id="kobo.178.1">Before diving</span><a id="_idIndexMarker625"/><span class="koboSpan" id="kobo.179.1"> into the SDK, we will try the </span><strong class="bold"><span class="koboSpan" id="kobo.180.1">naked REST APIs</span></strong><span class="koboSpan" id="kobo.181.1"> endpoints using Postman, a tool that helps developers to debug </span><em class="italic"><span class="koboSpan" id="kobo.182.1">requests</span></em><span class="koboSpan" id="kobo.183.1">/</span><em class="italic"><span class="koboSpan" id="kobo.184.1">responses</span></em><span class="koboSpan" id="kobo.185.1"> for other programming-language</span><a id="_idIndexMarker626"/><span class="koboSpan" id="kobo.186.1"> platforms not available as SDKs. </span><span class="koboSpan" id="kobo.186.2">Postman is a well-known tool among backend developers and is used to expose API requests/responses without any coding. </span><span class="koboSpan" id="kobo.186.3">Postman</span><a id="_idIndexMarker627"/><span class="koboSpan" id="kobo.187.1"> also helps developers to analyze responses via a </span><strong class="bold"><span class="koboSpan" id="kobo.188.1">graphical user </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.189.1">interface</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.190.1"> (</span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.191.1">GUI</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.192.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.193.1">Download Postman from </span><a href="https://www.postman.com/"><span class="koboSpan" id="kobo.194.1">https://www.postman.com/</span></a><span class="koboSpan" id="kobo.195.1">, choosing the correct version</span><a id="_idIndexMarker628"/><span class="koboSpan" id="kobo.196.1"> for your operating system. </span><span class="koboSpan" id="kobo.196.2">Before getting to work with Postman, firstly create a new workspace for the Arduino IoT Cloud to put all the requests</span><a id="_idIndexMarker629"/><span class="koboSpan" id="kobo.197.1"> in a separate group. </span><span class="koboSpan" id="kobo.197.2">To do this, click on </span><strong class="bold"><span class="koboSpan" id="kobo.198.1">Workspaces</span></strong><span class="koboSpan" id="kobo.199.1"> and then </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.200.1">Create Workspace</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.201.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer129">
<span class="koboSpan" id="kobo.202.1"><img alt="Figure 8.3 – Postman workspace" src="image/B19752_08_03.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.203.1">Figure 8.3 – Postman workspace</span></p>
<p><span class="koboSpan" id="kobo.204.1">A new window will be opened: provide a workspace</span><a id="_idIndexMarker630"/><span class="koboSpan" id="kobo.205.1"> name and description and set the visibility policy according to your requirements. </span><span class="koboSpan" id="kobo.205.2">After creating the new workspace, navigate to </span><strong class="bold"><span class="koboSpan" id="kobo.206.1">File</span></strong><span class="koboSpan" id="kobo.207.1"> &gt; </span><strong class="bold"><span class="koboSpan" id="kobo.208.1">New…</span></strong><span class="koboSpan" id="kobo.209.1"> and select </span><strong class="bold"><span class="koboSpan" id="kobo.210.1">HTTP Request</span></strong><span class="koboSpan" id="kobo.211.1">. </span><span class="koboSpan" id="kobo.211.2">Before sending</span><a id="_idIndexMarker631"/><span class="koboSpan" id="kobo.212.1"> any request to the Arduino IoT Cloud, an authentication token is mandatory. </span><span class="koboSpan" id="kobo.212.2">Refer to the following screenshot: click on the </span><strong class="bold"><span class="koboSpan" id="kobo.213.1">Authorization</span></strong><span class="koboSpan" id="kobo.214.1"> tab and select </span><strong class="bold"><span class="koboSpan" id="kobo.215.1">OAuth 2.0</span></strong><span class="koboSpan" id="kobo.216.1"> from the </span><strong class="bold"><span class="koboSpan" id="kobo.217.1">Type</span></strong><span class="koboSpan" id="kobo.218.1"> dropdown. </span><span class="koboSpan" id="kobo.218.2">Scroll down the </span><strong class="bold"><span class="koboSpan" id="kobo.219.1">Authorization</span></strong><span class="koboSpan" id="kobo.220.1"> page to find the </span><strong class="bold"><span class="koboSpan" id="kobo.221.1">Configure New Token</span></strong><span class="koboSpan" id="kobo.222.1"> section and click on the </span><strong class="bold"><span class="koboSpan" id="kobo.223.1">Configuration Options</span></strong><span class="koboSpan" id="kobo.224.1"> tab under </span><span class="No-Break"><span class="koboSpan" id="kobo.225.1">this section.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer130">
<span class="koboSpan" id="kobo.226.1"><img alt="Figure 8.4 – Authorization Configuration Options" src="image/B19752_08_04.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.227.1">Figure 8.4 – Authorization Configuration Options</span></p>
<p><span class="koboSpan" id="kobo.228.1">We need to provide three things under </span><strong class="bold"><span class="koboSpan" id="kobo.229.1">Configuration Options</span></strong><span class="koboSpan" id="kobo.230.1">. </span><span class="koboSpan" id="kobo.230.2">Firstly, add the </span><a href="https://api2.arduino.cc/iot/v1/clients/token"><span class="koboSpan" id="kobo.231.1">https://api2.arduino.cc/iot/v1/clients/token</span></a><span class="koboSpan" id="kobo.232.1"> URL to the </span><strong class="bold"><span class="koboSpan" id="kobo.233.1">Access Token URL</span></strong><span class="koboSpan" id="kobo.234.1"> field, then insert the values that we generated previously in the Arduino IoT Cloud API into the </span><strong class="bold"><span class="koboSpan" id="kobo.235.1">Client ID</span></strong><span class="koboSpan" id="kobo.236.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.237.1">Client Secret</span></strong><span class="koboSpan" id="kobo.238.1"> fields. </span><span class="koboSpan" id="kobo.238.2">Lastly, select </span><strong class="bold"><span class="koboSpan" id="kobo.239.1">Send client credentials in body</span></strong><span class="koboSpan" id="kobo.240.1"> from the </span><strong class="bold"><span class="koboSpan" id="kobo.241.1">Client Authentication</span></strong><span class="koboSpan" id="kobo.242.1"> dropdown. </span><span class="koboSpan" id="kobo.242.2">Now click on the </span><strong class="bold"><span class="koboSpan" id="kobo.243.1">Advanced Options</span></strong><span class="koboSpan" id="kobo.244.1"> tab, where we will set the API audience who will receive </span><span class="No-Break"><span class="koboSpan" id="kobo.245.1">the requests.</span></span></p>
<p><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.246.1">Figure 8</span></em></span><em class="italic"><span class="koboSpan" id="kobo.247.1">.5</span></em><span class="koboSpan" id="kobo.248.1"> shows the </span><strong class="bold"><span class="koboSpan" id="kobo.249.1">Advanced Options</span></strong><span class="koboSpan" id="kobo.250.1"> where we need</span><a id="_idIndexMarker632"/><span class="koboSpan" id="kobo.251.1"> to provide the Arduino IoT Cloud authentication URL with which we can authenticate and </span><span class="No-Break"><span class="koboSpan" id="kobo.252.1">authorize requests.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer131">
<span class="koboSpan" id="kobo.253.1"><img alt="Figure 8.5 – Authorization Advanced Options" src="image/B19752_08_05.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.254.1">Figure 8.5 – Authorization Advanced Options</span></p>
<p><span class="koboSpan" id="kobo.255.1">Add the </span><a href="https://api2.arduino.cc/iot"><span class="koboSpan" id="kobo.256.1">https://api2.arduino.cc/iot</span></a><span class="koboSpan" id="kobo.257.1"> URL into the </span><strong class="bold"><span class="koboSpan" id="kobo.258.1">Audience</span></strong><span class="koboSpan" id="kobo.259.1"> field. </span><span class="koboSpan" id="kobo.259.2">After setting up the configuration, click the </span><strong class="bold"><span class="koboSpan" id="kobo.260.1">Get new Access Token</span></strong><span class="koboSpan" id="kobo.261.1"> button. </span><span class="koboSpan" id="kobo.261.2">It will return either an error or a success message. </span><span class="koboSpan" id="kobo.261.3">If there is any error, then please repeat all the steps one by one, ensuring the configuration is as described previously. </span><span class="koboSpan" id="kobo.261.4">If you are successful, then click on </span><strong class="bold"><span class="koboSpan" id="kobo.262.1">Proceed</span></strong><span class="koboSpan" id="kobo.263.1"> and you will get your token </span><span class="No-Break"><span class="koboSpan" id="kobo.264.1">for authentication.</span></span></p>
<p><span class="koboSpan" id="kobo.265.1">After getting the authentication token, it’s time to do some experiments. </span><span class="koboSpan" id="kobo.265.2">The Arduino team has documented</span><a id="_idIndexMarker633"/><span class="koboSpan" id="kobo.266.1"> all the endpoints with cURL and the Node.js SDK samples in different categories, available at </span><a href="https://www.arduino.cc/reference/en/iot/api/"><span class="koboSpan" id="kobo.267.1">https://www.arduino.cc/reference/en/iot/api/</span></a><span class="koboSpan" id="kobo.268.1">. </span><span class="koboSpan" id="kobo.268.2">So here, we want to see the list of cloud variables/properties for specific Thing. </span><span class="koboSpan" id="kobo.268.3">Open up the preceding API documentation URL, find the </span><strong class="bold"><span class="koboSpan" id="kobo.269.1">API Methods – PropertiesV2</span></strong><span class="koboSpan" id="kobo.270.1"> category, and click on </span><strong class="bold"><span class="koboSpan" id="kobo.271.1">propertiesV2List</span></strong><span class="koboSpan" id="kobo.272.1">. </span><span class="koboSpan" id="kobo.272.2">Here you will see cURL and the Node.js SDK. </span><span class="koboSpan" id="kobo.272.3">Copy the URL from the cURL sample, which is </span><strong class="source-inline"><span class="koboSpan" id="kobo.273.1">https://api2.arduino.cc/iot/v2/things/{id}/properties?show_deleted=</span></strong><span class="koboSpan" id="kobo.274.1">. </span><span class="koboSpan" id="kobo.274.2">Here we need to replace </span><strong class="source-inline"><span class="koboSpan" id="kobo.275.1">{id}</span></strong><span class="koboSpan" id="kobo.276.1"> in the URL with the specific Thing ID (</span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.277.1">Figure 8</span></em></span><em class="italic"><span class="koboSpan" id="kobo.278.1">.6</span></em><span class="koboSpan" id="kobo.279.1">). </span><span class="koboSpan" id="kobo.279.2">The Thing ID is available under the Thing’s </span><strong class="bold"><span class="koboSpan" id="kobo.280.1">Metadata</span></strong><span class="koboSpan" id="kobo.281.1"> tab in the Arduino IoT Cloud. </span><span class="koboSpan" id="kobo.281.2">Add </span><strong class="source-inline"><span class="koboSpan" id="kobo.282.1">true</span></strong><span class="koboSpan" id="kobo.283.1"> to the end of the URL just after </span><strong class="source-inline"><span class="koboSpan" id="kobo.284.1">show_deleted</span></strong><span class="koboSpan" id="kobo.285.1">. </span><span class="koboSpan" id="kobo.285.2">After adding all the required data to the URL, it will look something </span><span class="No-Break"><span class="koboSpan" id="kobo.286.1">like </span></span><a href="https://api2.arduino.cc/iot/v2/things/8aee742e-4492-423d-9f19-79fec856b917/properties?show_deleted=true"><span class="No-Break"><span class="koboSpan" id="kobo.287.1">https://api2.arduino.cc/iot/v2/things/8aee742e-4492-423d-9f19-79fec856b917/properties?show_deleted=true</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.288.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.289.1">Click on </span><strong class="bold"><span class="koboSpan" id="kobo.290.1">Send</span></strong><span class="koboSpan" id="kobo.291.1"> and you will receive</span><a id="_idIndexMarker634"/><span class="koboSpan" id="kobo.292.1"> a response from the Arduino IoT Cloud in JSON format containing all the cloud variables properties of the Thing, including the property ID, name, type, last value of the cloud variable, and </span><span class="No-Break"><span class="koboSpan" id="kobo.293.1">so on:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer132">
<span class="koboSpan" id="kobo.294.1"><img alt="Figure 8.6 – Postman request response" src="image/B19752_08_06.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.295.1">Figure 8.6 – Postman request response</span></p>
<p><span class="koboSpan" id="kobo.296.1">The preceding screenshot shows the response in Postman. </span><span class="koboSpan" id="kobo.296.2">You can convert the response into plain text as well as other formats including </span><strong class="bold"><span class="koboSpan" id="kobo.297.1">XHTML</span></strong><span class="koboSpan" id="kobo.298.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.299.1">HTML</span></strong><span class="koboSpan" id="kobo.300.1">, and so on, but Postman has excellent visualization functionality for </span><strong class="bold"><span class="koboSpan" id="kobo.301.1">JSON</span></strong><span class="koboSpan" id="kobo.302.1"> data responses. </span><span class="koboSpan" id="kobo.302.2">This way, developers can easily understand and tweak the nature of the response and prepare the scripts according to their data structure. </span><span class="koboSpan" id="kobo.302.3">It also helps developers to choose specific content from the response more quickly, reducing the time and </span><span class="No-Break"><span class="koboSpan" id="kobo.303.1">effort required.</span></span></p>
<p><span class="koboSpan" id="kobo.304.1">In this section, we used Postman to generate our first request to the Arduino IoT Cloud. </span><span class="koboSpan" id="kobo.304.2">We began by configuring</span><a id="_idIndexMarker635"/><span class="koboSpan" id="kobo.305.1"> the API authentication keys in Postman and then requested the list of cloud variables/properties of Thing. </span><span class="koboSpan" id="kobo.305.2">The Arduino IoT Cloud successfully returned the response with all the required data in JSON format. </span><span class="koboSpan" id="kobo.305.3">In the following section, we will examine the SDKs available for </span><span class="No-Break"><span class="koboSpan" id="kobo.306.1">different platforms.</span></span></p>
<h1 id="_idParaDest-164"><a id="_idTextAnchor164"/><span class="koboSpan" id="kobo.307.1">Diverse platform compatibility – SDKs for various environments</span></h1>
<p><span class="koboSpan" id="kobo.308.1">After testing </span><em class="italic"><span class="koboSpan" id="kobo.309.1">request</span></em><span class="koboSpan" id="kobo.310.1">/</span><em class="italic"><span class="koboSpan" id="kobo.311.1">response</span></em><span class="koboSpan" id="kobo.312.1"> with Postman, it’s time to explore the SDKs available for the Arduino</span><a id="_idIndexMarker636"/><span class="koboSpan" id="kobo.313.1"> IoT Cloud. </span><span class="koboSpan" id="kobo.313.2">Earlier I mentioned the Arduino Team has developed official SDKs for three programming platforms, Node.js, Python, </span><span class="No-Break"><span class="koboSpan" id="kobo.314.1">and GoLang.</span></span></p>
<p><span class="koboSpan" id="kobo.315.1">Node.js is a very well-known</span><a id="_idIndexMarker637"/><span class="koboSpan" id="kobo.316.1"> language among backend developers</span><a id="_idIndexMarker638"/><span class="koboSpan" id="kobo.317.1"> and is used by both web and mobile developers. </span><span class="koboSpan" id="kobo.317.2">So, if you are planning to create a mobile or web app for Arduino IoT Cloud automation with custom visualizations, then Node.js is the best language, providing a wide variety of libraries for </span><span class="No-Break"><span class="koboSpan" id="kobo.318.1">HTTP services.</span></span></p>
<p><span class="koboSpan" id="kobo.319.1">On the other hand, Python</span><a id="_idIndexMarker639"/><span class="koboSpan" id="kobo.320.1"> is also a very well-known and rapidly</span><a id="_idIndexMarker640"/><span class="koboSpan" id="kobo.321.1"> growing language among web, IoT, and </span><strong class="bold"><span class="koboSpan" id="kobo.322.1">AI</span></strong><span class="koboSpan" id="kobo.323.1">/</span><strong class="bold"><span class="koboSpan" id="kobo.324.1">ML</span></strong><span class="koboSpan" id="kobo.325.1"> developers. </span><span class="koboSpan" id="kobo.325.2">Python seems to be trending toward AI/ML, and IoT is very close as a field to AI/ML. </span><span class="koboSpan" id="kobo.325.3">If you are planning to develop a solution focused on AI/ML, such as </span><strong class="bold"><span class="koboSpan" id="kobo.326.1">predictive maintenance</span></strong><span class="koboSpan" id="kobo.327.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.328.1">time series analysis</span></strong><span class="koboSpan" id="kobo.329.1">, or predictions then the Python SDK is the best choice to interact with the Arduino </span><span class="No-Break"><span class="koboSpan" id="kobo.330.1">IoT Cloud.</span></span></p>
<p><span class="koboSpan" id="kobo.331.1">GoLang is the last platform</span><a id="_idIndexMarker641"/><span class="koboSpan" id="kobo.332.1"> for which an SDK</span><a id="_idIndexMarker642"/><span class="koboSpan" id="kobo.333.1"> was developed by the Arduino</span><a id="_idIndexMarker643"/><span class="koboSpan" id="kobo.334.1"> team. </span><span class="koboSpan" id="kobo.334.2">GoLang was developed by Google and follows the </span><strong class="bold"><span class="koboSpan" id="kobo.335.1">C-type syntax</span></strong><span class="koboSpan" id="kobo.336.1">. </span><span class="koboSpan" id="kobo.336.2">The GoLang platform is good for operating system and network/API service development. </span><span class="koboSpan" id="kobo.336.3">If you are planning to maintain a high-performance system with the Arduino IoT Cloud or planning to run concurrent operations, then GoLang is the </span><span class="No-Break"><span class="koboSpan" id="kobo.337.1">better choice.</span></span></p>
<p><span class="koboSpan" id="kobo.338.1">We discussed here the three different platforms and their specialized domains of application. </span><span class="koboSpan" id="kobo.338.2">Node.js is best for </span><strong class="bold"><span class="koboSpan" id="kobo.339.1">Web APIs</span></strong><span class="koboSpan" id="kobo.340.1">, Python is good for machine</span><a id="_idIndexMarker644"/><span class="koboSpan" id="kobo.341.1"> learning, and GoLang</span><a id="_idIndexMarker645"/><span class="koboSpan" id="kobo.342.1"> is an awesome choice for high-performance systems. </span><span class="koboSpan" id="kobo.342.2">You can either choose</span><a id="_idIndexMarker646"/><span class="koboSpan" id="kobo.343.1"> one SDK platform for your development</span><a id="_idIndexMarker647"/><span class="koboSpan" id="kobo.344.1"> or consume</span><a id="_idIndexMarker648"/><span class="koboSpan" id="kobo.345.1"> all the SDKs</span><a id="_idIndexMarker649"/><span class="koboSpan" id="kobo.346.1"> depending on your </span><span class="No-Break"><span class="koboSpan" id="kobo.347.1">project requirements.</span></span></p>
<p><span class="koboSpan" id="kobo.348.1">In the next section, we will start our journey with the Node.js SDK, beginning by installing the official Arduino IoT Cloud Node.js SDK on </span><span class="No-Break"><span class="koboSpan" id="kobo.349.1">our machines.</span></span></p>
<h1 id="_idParaDest-165"><a id="_idTextAnchor165"/><span class="koboSpan" id="kobo.350.1">Step-by-step – installing the Arduino Node.js SDK client</span></h1>
<p><span class="koboSpan" id="kobo.351.1">From this point, we are going</span><a id="_idIndexMarker650"/><span class="koboSpan" id="kobo.352.1"> to use the Node.js SDK for our exercises and experiments. </span><span class="koboSpan" id="kobo.352.2">Before moving to the practical exercises, we need to first install the Arduino IoT</span><a id="_idIndexMarker651"/><span class="koboSpan" id="kobo.353.1"> Cloud package for Node.js. </span><span class="koboSpan" id="kobo.353.2">Download and install Node.js from </span><a href="https://nodejs.org/"><span class="koboSpan" id="kobo.354.1">https://nodejs.org/</span></a><span class="koboSpan" id="kobo.355.1">. </span><span class="koboSpan" id="kobo.355.2">After the installation of Node.js is complete, open up the Windows/Mac/Linux </span><strong class="bold"><span class="koboSpan" id="kobo.356.1">Terminal</span></strong><span class="koboSpan" id="kobo.357.1"> and navigate to the directory</span><a id="_idIndexMarker652"/><span class="koboSpan" id="kobo.358.1"> where you will set up your coding workspaces </span><span class="No-Break"><span class="koboSpan" id="kobo.359.1">using </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.360.1">VSCode</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.361.1">:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.362.1">
npm install @arduino/arduino-iot-client
npm i request-promise</span></pre> <p><span class="koboSpan" id="kobo.363.1">Type the two preceding commands in the </span><strong class="bold"><span class="koboSpan" id="kobo.364.1">Terminal</span></strong><span class="koboSpan" id="kobo.365.1"> and wait for the installation to complete. </span><span class="koboSpan" id="kobo.365.2">After a successful installation, open up VSCode and add the folder (where you have installed the Node.js Arduino IoT Cloud SDK) to the workspace where you installed the Arduino IoT Cloud and </span><span class="No-Break"><span class="koboSpan" id="kobo.366.1">request-promise modules.</span></span></p>
<p><span class="koboSpan" id="kobo.367.1">Navigate to the book’s official GitHub repository and download all the code from this chapter’s folder. </span><span class="koboSpan" id="kobo.367.2">Copy the files into the VSCode </span><strong class="source-inline"><span class="koboSpan" id="kobo.368.1">Workspace</span></strong><span class="koboSpan" id="kobo.369.1"> folder and extract the downloaded </span><strong class="source-inline"><span class="koboSpan" id="kobo.370.1">.zip</span></strong><span class="koboSpan" id="kobo.371.1"> file. </span><span class="koboSpan" id="kobo.371.2">Navigate to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.372.1">start</span></strong><span class="koboSpan" id="kobo.373.1"> folder and open up the </span><strong class="source-inline"><span class="koboSpan" id="kobo.374.1">main.js</span></strong><span class="koboSpan" id="kobo.375.1"> file </span><span class="No-Break"><span class="koboSpan" id="kobo.376.1">in VSCode.</span></span></p>
<p><span class="koboSpan" id="kobo.377.1">Here we have two methods, </span><strong class="source-inline"><span class="koboSpan" id="kobo.378.1">getToken()</span></strong><span class="koboSpan" id="kobo.379.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.380.1">ThingProperty()</span></strong><span class="koboSpan" id="kobo.381.1">. </span><span class="koboSpan" id="kobo.381.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.382.1">getToken()</span></strong><span class="koboSpan" id="kobo.383.1"> method will be same across the coding exercises and will be used to fetch the authentication token from the Arduino IoT Cloud on the basis of the Client ID and </span><span class="No-Break"><span class="koboSpan" id="kobo.384.1">Client Secret:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.385.1">
client_id: '-----Paste ClientID Here-----',             client_secret: '-----Paste Client Secret Here-----',</span></pre> <p><span class="koboSpan" id="kobo.386.1">The preceding code snippet is from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.387.1">getToken()</span></strong><span class="koboSpan" id="kobo.388.1"> method. </span><span class="koboSpan" id="kobo.388.2">Insert your Client ID in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.389.1">client_id</span></strong><span class="koboSpan" id="kobo.390.1"> variable and your Client Secret in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.391.1">client_secret</span></strong><span class="koboSpan" id="kobo.392.1"> variable. </span><span class="koboSpan" id="kobo.392.2">Likewise, insert your </span><strong class="source-inline"><span class="koboSpan" id="kobo.393.1">Thing ID</span></strong><span class="koboSpan" id="kobo.394.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.395.1">Property ID</span></strong><span class="koboSpan" id="kobo.396.1"> in the following code snippet under the </span><strong class="source-inline"><span class="koboSpan" id="kobo.397.1">ThingProperty()</span></strong><span class="koboSpan" id="kobo.398.1"> method. </span><span class="koboSpan" id="kobo.398.2">You can get your Thing ID by navigating to Thing and then the </span><strong class="bold"><span class="koboSpan" id="kobo.399.1">Metadata</span></strong><span class="koboSpan" id="kobo.400.1"> tab in the Arduino IoT Cloud. </span><span class="koboSpan" id="kobo.400.2">The property ID can be found by clicking on the cloud variable on the Thing page in the Arduino </span><span class="No-Break"><span class="koboSpan" id="kobo.401.1">IoT Cloud:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.402.1">
var id = "Paste -----Thing ID-----"; // {String} The id of the thing
var pid = "-----Property ID-----"; // {String} The id of the property</span></pre> <p><span class="koboSpan" id="kobo.403.1">Open the </span><strong class="bold"><span class="koboSpan" id="kobo.404.1">integrated terminal</span></strong><span class="koboSpan" id="kobo.405.1"> in VSCode and type the following command; Node will execute the </span><strong class="source-inline"><span class="koboSpan" id="kobo.406.1">main.js</span></strong><span class="koboSpan" id="kobo.407.1"> code and provide a response in </span><span class="No-Break"><span class="koboSpan" id="kobo.408.1">the console:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.409.1">
node main.js</span></pre> <p><span class="koboSpan" id="kobo.410.1">You will receive the following response in the console if everything </span><span class="No-Break"><span class="koboSpan" id="kobo.411.1">works fine:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.412.1">
API called successfully. </span><span class="koboSpan" id="kobo.412.2">Last Value of Property=259</span></pre> <p><span class="koboSpan" id="kobo.413.1">If you receive a </span><strong class="source-inline"><span class="koboSpan" id="kobo.414.1">401 error</span></strong><span class="koboSpan" id="kobo.415.1">, it means your Client ID and/or Client Secret are not correct. </span><span class="koboSpan" id="kobo.415.2">If a </span><strong class="source-inline"><span class="koboSpan" id="kobo.416.1">404 error</span></strong><span class="koboSpan" id="kobo.417.1"> is returned, it means you are not using the proper method to fetch property data. </span><span class="koboSpan" id="kobo.417.2">If you get a </span><strong class="source-inline"><span class="koboSpan" id="kobo.418.1">500 error</span></strong><span class="koboSpan" id="kobo.419.1">, it means the server is down or there is a network blockage for the Arduino IoT Cloud from </span><span class="No-Break"><span class="koboSpan" id="kobo.420.1">your ISP.</span></span></p>
<p><span class="koboSpan" id="kobo.421.1">In the </span><em class="italic"><span class="koboSpan" id="kobo.422.1">First try with Postman</span></em><span class="koboSpan" id="kobo.423.1"> section, we discussed how to use Arduino IoT Cloud endpoints with Postman for request/response tasks as well as installing the Node.js module for the cloud and testing it with an example where we fetched the last value of the Thing </span><span class="No-Break"><span class="koboSpan" id="kobo.424.1">cloud variable/property.</span></span></p>
<p><span class="koboSpan" id="kobo.425.1">Building on this foundation, we are going</span><a id="_idIndexMarker653"/><span class="koboSpan" id="kobo.426.1"> to start a new journey where we will play around with the Arduino IoT Cloud. </span><span class="koboSpan" id="kobo.426.2">Firstly, we will start with devices. </span><span class="koboSpan" id="kobo.426.3">In the next section, we will create, update, delete, list, and view a specific device. </span><span class="koboSpan" id="kobo.426.4">Later in the</span><a id="_idIndexMarker654"/><span class="koboSpan" id="kobo.427.1"> chapter, we will do the same for Things, properties (also known as cloud variables), </span><span class="No-Break"><span class="koboSpan" id="kobo.428.1">and dashboards.</span></span></p>
<h1 id="_idParaDest-166"><a id="_idTextAnchor166"/><span class="koboSpan" id="kobo.429.1">Interacting with devices – hands-on with the Node.js SDK</span></h1>
<p><span class="koboSpan" id="kobo.430.1">In this section, we are going</span><a id="_idIndexMarker655"/><span class="koboSpan" id="kobo.431.1"> to get hands-on and practical with devices. </span><span class="koboSpan" id="kobo.431.2">We will perform CRUD operations on a device as well as listing all the devices and showing all the parameters of specific devices. </span><span class="koboSpan" id="kobo.431.3">Open up VSCode and navigate to this chapter’s example code. </span><span class="koboSpan" id="kobo.431.4">Then click on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.432.1">device</span></strong><span class="koboSpan" id="kobo.433.1"> folder: here you can find all the code related to </span><span class="No-Break"><span class="koboSpan" id="kobo.434.1">device operations.</span></span></p>
<h2 id="_idParaDest-167"><a id="_idTextAnchor167"/><span class="koboSpan" id="kobo.435.1">Creating a device</span></h2>
<p><span class="koboSpan" id="kobo.436.1">Firstly, we will start</span><a id="_idIndexMarker656"/><span class="koboSpan" id="kobo.437.1"> with device creation. </span><span class="koboSpan" id="kobo.437.2">The documentation on device creation can be found at </span><a href="https://www.arduino.cc/reference/en/iot/api/#api-DevicesV2-devicesV2Create"><span class="koboSpan" id="kobo.438.1">https://www.arduino.cc/reference/en/iot/api/#api-DevicesV2-devicesV2Create</span></a><span class="koboSpan" id="kobo.439.1">. </span><span class="koboSpan" id="kobo.439.2">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.440.1">create-device.js</span></strong><span class="koboSpan" id="kobo.441.1"> under the </span><strong class="source-inline"><span class="koboSpan" id="kobo.442.1">device</span></strong><span class="koboSpan" id="kobo.443.1"> folder </span><span class="No-Break"><span class="koboSpan" id="kobo.444.1">in VSCode.</span></span></p>
<p><span class="koboSpan" id="kobo.445.1">There are two methods in the code: one is </span><strong class="source-inline"><span class="koboSpan" id="kobo.446.1">getToken()</span></strong><span class="koboSpan" id="kobo.447.1">, which is the same method as in all our coding exercises and helps us to fetch the authentication token for requests. </span><span class="koboSpan" id="kobo.447.2">The second method is </span><strong class="source-inline"><span class="koboSpan" id="kobo.448.1">CreateDevice()</span></strong><span class="koboSpan" id="kobo.449.1">, which is responsible for device creation. </span><span class="koboSpan" id="kobo.449.2">Consulting the documentation, we can see we need to initiate the </span><strong class="source-inline"><span class="koboSpan" id="kobo.450.1">api</span></strong><span class="koboSpan" id="kobo.451.1"> variable with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.452.1">AiotApi.DevicesV2Api()</span></strong><span class="koboSpan" id="kobo.453.1"> object, which is related </span><span class="No-Break"><span class="koboSpan" id="kobo.454.1">to devices:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.455.1">
var DeviceProperties = {
        'name':'Sense Home XIAO Series',
        'connection_type':'wifi',
        'fqbn':'esp32:esp32:XIAO_ESP32C3',
        'type':'login_and_secretkey_wifi'
    };
    var options = {
    };
    api.devicesV2Create(DeviceProperties, options).then(function(data) {
      console.log('Device Created successfully. </span><span class="koboSpan" id="kobo.455.2">Returned data: ' + util.inspect(data));
    }, function(error) {
      console.error(error);
    });</span></pre> <p><strong class="source-inline"><span class="koboSpan" id="kobo.456.1">api.devicesV2Create</span></strong><span class="koboSpan" id="kobo.457.1"> is the method responsible</span><a id="_idIndexMarker657"/><span class="koboSpan" id="kobo.458.1"> for device creation and takes two parameters as input. </span><strong class="source-inline"><span class="koboSpan" id="kobo.459.1">DeviceProperties</span></strong><span class="koboSpan" id="kobo.460.1"> covers things such as the device name, type, and </span><strong class="bold"><span class="koboSpan" id="kobo.461.1">Fully Qualified Board Name</span></strong><span class="koboSpan" id="kobo.462.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.463.1">FQBN</span></strong><span class="koboSpan" id="kobo.464.1">). </span><span class="koboSpan" id="kobo.464.2">Let’s start with </span><strong class="source-inline"><span class="koboSpan" id="kobo.465.1">name</span></strong><span class="koboSpan" id="kobo.466.1"> first – this could be anything you fancy, but avoid using special characters. </span><span class="koboSpan" id="kobo.466.2">Next, we need to provide a choice for </span><strong class="source-inline"><span class="koboSpan" id="kobo.467.1">connection_type</span></strong><span class="koboSpan" id="kobo.468.1">, such as Wi-Fi, GSM, LoRa WAN, and so on. </span><span class="koboSpan" id="kobo.468.2">All available types are provided by the documentation. </span><span class="koboSpan" id="kobo.468.3">For </span><strong class="source-inline"><span class="koboSpan" id="kobo.469.1">fqbn</span></strong><span class="koboSpan" id="kobo.470.1">, we need</span><a id="_idIndexMarker658"/><span class="koboSpan" id="kobo.471.1"> to provide the details of the development board. </span><span class="koboSpan" id="kobo.471.2">Taking the </span><strong class="bold"><span class="koboSpan" id="kobo.472.1">XIAO ESP32C3</span></strong><span class="koboSpan" id="kobo.473.1"> board as an example, it belongs to the </span><strong class="bold"><span class="koboSpan" id="kobo.474.1">ESP32</span></strong><span class="koboSpan" id="kobo.475.1"> family, so its FQBN would </span><span class="No-Break"><span class="koboSpan" id="kobo.476.1">be </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.477.1">esp32:esp32:XIAO_ESP32C3</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.478.1">.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.479.1">options</span></strong><span class="koboSpan" id="kobo.480.1"> are optional, so I left it blank, but you</span><a id="_idIndexMarker659"/><span class="koboSpan" id="kobo.481.1"> can provide the </span><strong class="source-inline"><span class="koboSpan" id="kobo.482.1">X-Organization</span></strong><span class="koboSpan" id="kobo.483.1"> value according to your requirements. </span><span class="koboSpan" id="kobo.483.2">Both arrays are passed to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.484.1">api.devicesV2Create</span></strong><span class="koboSpan" id="kobo.485.1"> method, which will return the response. </span><span class="koboSpan" id="kobo.485.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.486.1">util.inspect</span></strong><span class="koboSpan" id="kobo.487.1"> method is used to display the JSON response on the console with proper formatting. </span><span class="koboSpan" id="kobo.487.2">Type the following command to execute the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.488.1">create-device.js</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.489.1"> program:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.490.1">
node create-device.js</span></pre> <p><span class="koboSpan" id="kobo.491.1">After successful execution of the script, it will print a response like </span><span class="No-Break"><span class="koboSpan" id="kobo.492.1">the following:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.493.1">
Device Created successfully. </span><span class="koboSpan" id="kobo.493.2">Returned data: ArduinoDevicev2 {
  href: '/iot/v2/devices/e88b84a7-7ad7-4c2b-b79c-ab426e47dc67',
  id: 'e88b84a7-7ad7-4c2b-b79c-ab426e47dc67',
  label: 'Login and secret key for wifi device',
  name: 'Sense Home XIAO Series',
  serial: '',
  type: 'login_and_secretkey_wifi',
  user_id: 'f067c1e9-3ff8-4b9f-a9b4-f8c5c1d0ceb4',
  fqbn: 'esp32:esp32:XIAO_ESP32C3'
}</span></pre> <p><span class="koboSpan" id="kobo.494.1">In the response, you will get your device ID, which will be used later in the chapter for Thing creation when we associate the device with the Thing. </span><span class="koboSpan" id="kobo.494.2">The remaining properties are the same as already</span><a id="_idIndexMarker660"/><span class="koboSpan" id="kobo.495.1"> covered in </span><span class="No-Break"><span class="koboSpan" id="kobo.496.1">the code.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.497.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.498.1">If you are unable to get the correct FQBN, then add the device manually from the dashboard, finding and clicking on the device from the dropdown. </span><span class="koboSpan" id="kobo.498.2">This will give you the </span><strong class="source-inline"><span class="koboSpan" id="kobo.499.1">fqbn</span></strong><span class="koboSpan" id="kobo.500.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.501.1">type</span></strong><span class="koboSpan" id="kobo.502.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.503.1">connection_type</span></strong><span class="koboSpan" id="kobo.504.1"> details. </span><span class="koboSpan" id="kobo.504.2">You can use these details later in your Node.js script for automated creation </span><span class="No-Break"><span class="koboSpan" id="kobo.505.1">of devices.</span></span></p>
<h2 id="_idParaDest-168"><a id="_idTextAnchor168"/><span class="koboSpan" id="kobo.506.1">Updating a device</span></h2>
<p><span class="koboSpan" id="kobo.507.1">In this section, we are going</span><a id="_idIndexMarker661"/><span class="koboSpan" id="kobo.508.1"> to explore how we can update a device using the device ID. </span><span class="koboSpan" id="kobo.508.2">Let’s suppose we mistakenly added a device with the wrong FQBN and name. </span><span class="koboSpan" id="kobo.508.3">We will update both properties using the device ID. </span><span class="koboSpan" id="kobo.508.4">The documentation on updating devices is available at </span><a href="https://www.arduino.cc/reference/en/iot/api/#api-DevicesV2-devicesV2Update"><span class="koboSpan" id="kobo.509.1">https://www.arduino.cc/reference/en/iot/api/#api-DevicesV2-devicesV2Update</span></a><span class="koboSpan" id="kobo.510.1">. </span><span class="koboSpan" id="kobo.510.2">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.511.1">update-device.js</span></strong><span class="koboSpan" id="kobo.512.1"> file under the </span><strong class="source-inline"><span class="koboSpan" id="kobo.513.1">device</span></strong><span class="koboSpan" id="kobo.514.1"> folder </span><span class="No-Break"><span class="koboSpan" id="kobo.515.1">in VSCode:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.516.1">
var api = new AiotApi.DevicesV2Api();
var DeviceID="e88b84a7-7ad7-4c2b-b79c-ab426e47dc67";
var DeviceProperties = {
        'name':'Sense Home WeMos D1 Mini Series',
        'connection_type':'wifi',
        'fqbn':'esp8266:esp8266:d1_mini',
        'type':'login_and_secretkey_wifi'
};
var options = {
};
api.devicesV2Update(DeviceID,DeviceProperties, options).then(function(data) {
      console.log('Device Created successfully. </span><span class="koboSpan" id="kobo.516.2">Returned data: ' + util.inspect(data));
    }, function(error) {
      console.error(error);
});</span></pre> <p><span class="koboSpan" id="kobo.517.1">The preceding code is almost the same as the </span><strong class="source-inline"><span class="koboSpan" id="kobo.518.1">create-device</span></strong><span class="koboSpan" id="kobo.519.1"> code. </span><span class="koboSpan" id="kobo.519.2">Here we have one extra variable, </span><strong class="source-inline"><span class="koboSpan" id="kobo.520.1">DeviceID</span></strong><span class="koboSpan" id="kobo.521.1">, with which</span><a id="_idIndexMarker662"/><span class="koboSpan" id="kobo.522.1"> we will update the specific device. </span><span class="koboSpan" id="kobo.522.2">The rest of the code has the same device properties and options as previously. </span><span class="koboSpan" id="kobo.522.3">Now, fill in the correct </span><strong class="source-inline"><span class="koboSpan" id="kobo.523.1">fqbn</span></strong><span class="koboSpan" id="kobo.524.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.525.1">name</span></strong><span class="koboSpan" id="kobo.526.1"> values in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.527.1">DeviceProperties</span></strong><span class="koboSpan" id="kobo.528.1"> variable. </span><span class="koboSpan" id="kobo.528.2">Lastly, we call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.529.1">api.devicesV2Update()</span></strong><span class="koboSpan" id="kobo.530.1"> method. </span><span class="koboSpan" id="kobo.530.2">Execute the following command in </span><span class="No-Break"><span class="koboSpan" id="kobo.531.1">the Terminal:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.532.1">
node update-device.js</span></pre> <p><span class="koboSpan" id="kobo.533.1">After successful execution of the script, it will print a response like </span><span class="No-Break"><span class="koboSpan" id="kobo.534.1">the following:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.535.1">
Device Updated successfully. </span><span class="koboSpan" id="kobo.535.2">Returned data: ArduinoDevicev2 {
  href: '/iot/v2/devices/e88b84a7-7ad7-4c2b-b79c-ab426e47dc67',
  id: 'e88b84a7-7ad7-4c2b-b79c-ab426e47dc67',
  label: 'Login and secret key for wifi device',
  name: 'Sense Home WeMos D1 Mini Series',
  serial: '',
  type: 'login_and_secretkey_wifi',
  user_id: 'f067c1e9-3ff8-4b9f-a9b4-f8c5c1d0ceb4',
  created_at: 2023-04-17T00:47:40.700Z,
  fqbn: 'esp8266:esp8266:d1_mini'
}</span></pre> <p><span class="koboSpan" id="kobo.536.1">As we can see, after our update, the response sends back the new content. </span><span class="koboSpan" id="kobo.536.2">We provided a change of name and FQBN</span><a id="_idIndexMarker663"/><span class="koboSpan" id="kobo.537.1"> and it is reflected successfully in </span><span class="No-Break"><span class="koboSpan" id="kobo.538.1">the response.</span></span></p>
<h2 id="_idParaDest-169"><a id="_idTextAnchor169"/><span class="koboSpan" id="kobo.539.1">Deleting a device</span></h2>
<p><span class="koboSpan" id="kobo.540.1">In this section, we are going to explore </span><a id="_idIndexMarker664"/><span class="koboSpan" id="kobo.541.1">how we can delete a device using the device ID. </span><span class="koboSpan" id="kobo.541.2">The documentation for deleting devices is available </span><span class="No-Break"><span class="koboSpan" id="kobo.542.1">at </span></span><a href="https://www.arduino.cc/reference/en/iot/api/#api-DevicesV2-devicesV2Delete"><span class="No-Break"><span class="koboSpan" id="kobo.543.1">https://www.arduino.cc/reference/en/iot/api/#api-DevicesV2-devicesV2Delete</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.544.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.545.1">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.546.1">delete-device.js</span></strong><span class="koboSpan" id="kobo.547.1"> file under the </span><strong class="source-inline"><span class="koboSpan" id="kobo.548.1">device</span></strong><span class="koboSpan" id="kobo.549.1"> folder </span><span class="No-Break"><span class="koboSpan" id="kobo.550.1">in VSCode:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.551.1">
    var api = new AiotApi.DevicesV2Api();
    var DeviceID='e88b84a7-7ad7-4c2b-b79c-ab426e47dc67';
    var options = {
    };
    api.devicesV2Delete(DeviceID, options).then(function(data) {
      console.log('Device Deleted successfully. </span><span class="koboSpan" id="kobo.551.2">Returned data: ' + data);
    }, function(error) {
      console.error(error);
    });</span></pre> <p><span class="koboSpan" id="kobo.552.1">The preceding code snippet is taken from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.553.1">DeleteDevice()</span></strong><span class="koboSpan" id="kobo.554.1"> method. </span><span class="koboSpan" id="kobo.554.2">In this method, we need to supply </span><strong class="source-inline"><span class="koboSpan" id="kobo.555.1">DeviceID</span></strong><span class="koboSpan" id="kobo.556.1"> and options variables as parameters. </span><strong class="source-inline"><span class="koboSpan" id="kobo.557.1">DeviceID</span></strong><span class="koboSpan" id="kobo.558.1"> is mandatory for the deletion process while the </span><strong class="source-inline"><span class="koboSpan" id="kobo.559.1">options</span></strong><span class="koboSpan" id="kobo.560.1"> variable is not. </span><span class="koboSpan" id="kobo.560.2">Execute the following command in </span><span class="No-Break"><span class="koboSpan" id="kobo.561.1">the Terminal:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.562.1">
node delete-device.js</span></pre> <p><span class="koboSpan" id="kobo.563.1">After successful execution of the script, it will print a response to the console reporting that the device</span><a id="_idIndexMarker665"/><span class="koboSpan" id="kobo.564.1"> has been </span><span class="No-Break"><span class="koboSpan" id="kobo.565.1">deleted successfully.</span></span></p>
<h2 id="_idParaDest-170"><a id="_idTextAnchor170"/><span class="koboSpan" id="kobo.566.1">Listing devices</span></h2>
<p><span class="koboSpan" id="kobo.567.1">In this section, we will list</span><a id="_idIndexMarker666"/><span class="koboSpan" id="kobo.568.1"> all the devices. </span><span class="koboSpan" id="kobo.568.2">Note that there is a difference between listing devices and showing devices: </span><em class="italic"><span class="koboSpan" id="kobo.569.1">listing</span></em><span class="koboSpan" id="kobo.570.1"> devices means displaying all the devices with their properties, while </span><em class="italic"><span class="koboSpan" id="kobo.571.1">showing</span></em><span class="koboSpan" id="kobo.572.1"> a device only returns a specific device’s properties based on the </span><span class="No-Break"><span class="koboSpan" id="kobo.573.1">device ID.</span></span></p>
<p><span class="koboSpan" id="kobo.574.1">The documentation on listing devices is available at </span><a href="https://www.arduino.cc/reference/en/iot/api/#api-DevicesV2-devicesV2List"><span class="koboSpan" id="kobo.575.1">https://www.arduino.cc/reference/en/iot/api/#api-DevicesV2-devicesV2List</span></a><span class="koboSpan" id="kobo.576.1">. </span><span class="koboSpan" id="kobo.576.2">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.577.1">list-device.js</span></strong><span class="koboSpan" id="kobo.578.1"> file under the </span><strong class="source-inline"><span class="koboSpan" id="kobo.579.1">device</span></strong><span class="koboSpan" id="kobo.580.1"> folder in VSCode. </span><span class="koboSpan" id="kobo.580.2">The following code snippet is taken from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.581.1">ListDevice()</span></strong><span class="koboSpan" id="kobo.582.1"> method from the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.583.1">list-device.js</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.584.1"> file:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.585.1">
   var api = new AiotApi.DevicesV2Api()
   var opts = {
        'acrossUserIds': true // {Boolean} If true, returns all the devices
      };
      api.devicesV2List(opts).then(function(data) {
        for(var i=0;i&lt;data.length;i++){
            console.log("Device ID:"+data[i].id+" Device Name:"+data[i].name);
        }
    }, function(error) {
      console.error(error);
    });</span></pre> <p><span class="koboSpan" id="kobo.586.1">Here we need to provide the criteria that will be used to filter out the devices and return the desired response. </span><span class="koboSpan" id="kobo.586.2">In the current code, we only mention one parameter, </span><strong class="source-inline"><span class="koboSpan" id="kobo.587.1">'acrossUserIds'</span></strong><span class="koboSpan" id="kobo.588.1">, which is </span><strong class="source-inline"><span class="koboSpan" id="kobo.589.1">true</span></strong><span class="koboSpan" id="kobo.590.1"> to fetch all types of devices. </span><span class="koboSpan" id="kobo.590.2">But if required, you can filter the devices listed on the basis of </span><strong class="source-inline"><span class="koboSpan" id="kobo.591.1">tags</span></strong><span class="koboSpan" id="kobo.592.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.593.1">serial</span></strong><span class="koboSpan" id="kobo.594.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.595.1">X-Organization</span></strong><span class="koboSpan" id="kobo.596.1">. </span><span class="koboSpan" id="kobo.596.2">Execute the following command in </span><span class="No-Break"><span class="koboSpan" id="kobo.597.1">the Terminal:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.598.1">
node list-device.js</span></pre> <p><span class="koboSpan" id="kobo.599.1">After successful execution of the script, it will print a response in JSON format with the device properties, which will clog up the </span><strong class="bold"><span class="koboSpan" id="kobo.600.1">Terminal</span></strong><span class="koboSpan" id="kobo.601.1"> console with extensive output. </span><span class="koboSpan" id="kobo.601.2">I modified the code to only display</span><a id="_idIndexMarker667"/><span class="koboSpan" id="kobo.602.1"> the device ID and device name on </span><span class="No-Break"><span class="koboSpan" id="kobo.603.1">the console:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.604.1">
Device ID:04d8025a-4270-4d7e-aa04-45db87a594f5
Device Name:SmartAgriESP32-Sargodha
Device ID:5aae7e1f-940b-4426-80ac-1c953839cdb2
Device Name:MKR-GSM-1400
Device ID:fae0951d-3169-4d6a-a8e5-739c347eafc1
Device Name:MKR1500
Device ID:ca711f68-6de9-497a-ac45-780219ad2bb8
Device Name:Wemos d1 Mini by API Update
Device ID:64990519-1833-4bba-b035-978fcaa33466
Device Name:MKR1010-Device
Device ID:62e8600b-2733-4f24-9654-1fac549af27f
Device Name:XIAO-ESP32C3-Pulse-Sensor
Device ID:e88b84a7-7ad7-4c2b-b79c-ab426e47dc67
Device Name:Sense Home WeMos D1 Mini Series
Device ID:b9f3ff20-ebf1-4260-ad16-f434466458ac
Device Name:ArduinoNanoRP2040
Device ID:047d8316-dcdb-4bf5-af30-4319bb5a5eb0
Device Name:Delly</span></pre> <p><span class="koboSpan" id="kobo.605.1">In the preceding code, we are displaying two parameters on the console, but you can choose whichever and however many you want by specifying their names in the for loop. </span><span class="koboSpan" id="kobo.605.2">Using this, we can send the output in JSON format to a web/mobile client, which will display the information either in a list</span><a id="_idIndexMarker668"/><span class="koboSpan" id="kobo.606.1"> box or </span><span class="No-Break"><span class="koboSpan" id="kobo.607.1">in menus.</span></span></p>
<h2 id="_idParaDest-171"><a id="_idTextAnchor171"/><span class="koboSpan" id="kobo.608.1">Showing a device</span></h2>
<p><span class="koboSpan" id="kobo.609.1">This is the second-to-last</span><a id="_idIndexMarker669"/><span class="koboSpan" id="kobo.610.1"> subsection of the </span><em class="italic"><span class="koboSpan" id="kobo.611.1">Interacting with devices – hands-on with the Node.js SDK</span></em><span class="koboSpan" id="kobo.612.1"> section. </span><span class="koboSpan" id="kobo.612.2">Here we will fetch all the properties of a specific device by providing the device ID. </span><span class="koboSpan" id="kobo.612.3">The documentation on showing devices is available </span><span class="No-Break"><span class="koboSpan" id="kobo.613.1">at </span></span><a href="https://www.arduino.cc/reference/en/iot/api/#api-DevicesV2-devicesV2Show"><span class="No-Break"><span class="koboSpan" id="kobo.614.1">https://www.arduino.cc/reference/en/iot/api/#api-DevicesV2-devicesV2Show</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.615.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.616.1">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.617.1">show-device.js</span></strong><span class="koboSpan" id="kobo.618.1"> file under the </span><strong class="source-inline"><span class="koboSpan" id="kobo.619.1">device</span></strong><span class="koboSpan" id="kobo.620.1"> folder in VSCode. </span><span class="koboSpan" id="kobo.620.2">The following code snippet is taken from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.621.1">ShowDevice()</span></strong><span class="koboSpan" id="kobo.622.1"> method from the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.623.1">show-device.js</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.624.1"> file:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.625.1">
var api = new AiotApi.DevicesV2Api()
    var id = '62e8600b-2733-4f24-9654-1fac549af27f'; // {String} The id of the device
    var opts = {
    };
    api.devicesV2Show(id, opts).then(function(data) {
      console.log('Device Created successfully. </span><span class="koboSpan" id="kobo.625.2">Returned data: ' + util.inspect(data));
    }, function(error) {
      console.error(error);
    });</span></pre> <p><span class="koboSpan" id="kobo.626.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.627.1">devicesV2Show()</span></strong><span class="koboSpan" id="kobo.628.1"> method only takes two parameters: the first one is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.629.1">DeviceID</span></strong><span class="koboSpan" id="kobo.630.1"> and the second is </span><strong class="source-inline"><span class="koboSpan" id="kobo.631.1">options</span></strong><span class="koboSpan" id="kobo.632.1">, which includes </span><strong class="source-inline"><span class="koboSpan" id="kobo.633.1">X-Organization</span></strong><span class="koboSpan" id="kobo.634.1">. </span><strong class="source-inline"><span class="koboSpan" id="kobo.635.1">DeviceID</span></strong><span class="koboSpan" id="kobo.636.1"> is mandatory to fetch a proper response while the </span><strong class="source-inline"><span class="koboSpan" id="kobo.637.1">opts</span></strong><span class="koboSpan" id="kobo.638.1"> variable is optional, hence we pass this variable as empty. </span><span class="koboSpan" id="kobo.638.2">Execute the following command in </span><span class="No-Break"><span class="koboSpan" id="kobo.639.1">the Terminal:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.640.1">
node show-device.js</span></pre> <p><span class="koboSpan" id="kobo.641.1">After successful execution of the script, it will print the response in JSON format with the device properties as well as the details of any cloud variables if any associated variable </span><span class="No-Break"><span class="koboSpan" id="kobo.642.1">is present:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.643.1">
ArduinoDevicev2 {
  id: '62e8600b-2733-4f24-9654-1fac549af27f',
  label: 'Login and secret key for wifi device',
  name: 'XIAO-ESP32C3-Pulse-Sensor',
    ……………………………………..
</span><span class="koboSpan" id="kobo.643.2">  thing: ArduinoThing {
    id: '6b6cd076-5859-4a6d-9b4e-18879893c6cb',
    name: 'Tracking and notifying Your Heart Rate',
    ……………………………………..
</span><span class="koboSpan" id="kobo.643.3">    webhook_active: true,
    webhook_uri: 'https://hooks.zapier.com/hooks/catch/14930971/324me7k/'
  }
}</span></pre> <p><span class="koboSpan" id="kobo.644.1">The preceding code is the edited response of the script regarding device properties, which includes all the details of the given device such as last activity, the cloud variables count, the Thing ID associated with the device, webhook details (if active), sketch ID, and </span><span class="No-Break"><span class="koboSpan" id="kobo.645.1">so on.</span></span></p>
<p><span class="koboSpan" id="kobo.646.1">In this sub-section, we have explored how to get all the devices list from the Arduino IoT Cloud using the Node.js SDK. </span><span class="koboSpan" id="kobo.646.2">Next, let’s explore how to get the list of cloud variables/properties</span><a id="_idIndexMarker670"/><span class="koboSpan" id="kobo.647.1"> associated with </span><span class="No-Break"><span class="koboSpan" id="kobo.648.1">the device.</span></span></p>
<h2 id="_idParaDest-172"><a id="_idTextAnchor172"/><span class="koboSpan" id="kobo.649.1">Device properties/variables</span></h2>
<p><span class="koboSpan" id="kobo.650.1">Here, we will fetch</span><a id="_idIndexMarker671"/><span class="koboSpan" id="kobo.651.1"> all the cloud variable details for a specific device by providing the device ID. </span><span class="koboSpan" id="kobo.651.2">The documentation on showing devices is available </span><span class="No-Break"><span class="koboSpan" id="kobo.652.1">at </span></span><a href="https://www.arduino.cc/reference/en/iot/api/#api-DevicesV2-devicesV2GetProperties"><span class="No-Break"><span class="koboSpan" id="kobo.653.1">https://www.arduino.cc/reference/en/iot/api/#api-DevicesV2-devicesV2GetProperties</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.654.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.655.1">To begin, open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.656.1">properties-device.js</span></strong><span class="koboSpan" id="kobo.657.1"> file under the </span><strong class="source-inline"><span class="koboSpan" id="kobo.658.1">device</span></strong><span class="koboSpan" id="kobo.659.1"> folder in VSCode. </span><span class="koboSpan" id="kobo.659.2">The following code snippet is taken from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.660.1">ListPropDevice()</span></strong><span class="koboSpan" id="kobo.661.1"> method in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.662.1">properties-device.js</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.663.1"> file:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.664.1">
    var api = new AiotApi.DevicesV2Api()
    var id = '62e8600b-2733-4f24-9654-1fac549af27f'; // {String} The id of the device
    var opts = {
    };
    api.devicesV2GetProperties(id, opts).then(function(data) {
      console.log('Device Properties.' </span><span class="koboSpan" id="kobo.664.2">+ util.inspect(data));
    }, function(error) {
      console.error(error);
    });</span></pre> <p><span class="koboSpan" id="kobo.665.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.666.1">devicesV2GetProperties()</span></strong><span class="koboSpan" id="kobo.667.1"> method only takes two parameters: the first one is device ID and the second</span><a id="_idIndexMarker672"/><span class="koboSpan" id="kobo.668.1"> is options, which includes </span><strong class="source-inline"><span class="koboSpan" id="kobo.669.1">showDeleted</span></strong><span class="koboSpan" id="kobo.670.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.671.1">X-Organization</span></strong><span class="koboSpan" id="kobo.672.1">. </span><strong class="source-inline"><span class="koboSpan" id="kobo.673.1">DeviceID</span></strong><span class="koboSpan" id="kobo.674.1"> is mandatory to fetch a proper response, while the </span><strong class="source-inline"><span class="koboSpan" id="kobo.675.1">opts</span></strong><span class="koboSpan" id="kobo.676.1"> variable is optional, so we leave this variable empty when we pass it. </span><span class="koboSpan" id="kobo.676.2">Execute the following command in </span><span class="No-Break"><span class="koboSpan" id="kobo.677.1">the Terminal:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.678.1">
node properties-device.js</span></pre> <p><span class="koboSpan" id="kobo.679.1">After successful execution of the script, it will print a response in JSON format containing the cloud variable details associated with that particular </span><span class="No-Break"><span class="koboSpan" id="kobo.680.1">device ID:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.681.1">
  Properties: [
    ArduinoProperty {
      href: '/iot/v1/things/6b6cd076-5859-4a6d-9b4e-18879893c6cb/properties/b357a513-ad2b-4e1f-a76b-6dac078e36d5',
      id: 'b357a513-ad2b-4e1f-a76b-6dac078e36d5',
      name: 'BPM',
      permission: 'READ_ONLY',
      thing_id: '6b6cd076-5859-4a6d-9b4e-18879893c6cb',
      type: 'HEART_BEATS',
      update_strategy: 'ON_CHANGE',
      created_at: 2023-03-31T16:41:33.103Z,
      persist: true,
      tag: 1,
      thing_name: 'Tracking and notifying Your Heart Rate',
      update_parameter: 0,
      updated_at: 2023-03-31T17:05:19.564Z,
      variable_name: 'bPM'
    }
  ]</span></pre> <p><span class="koboSpan" id="kobo.682.1">The preceding response is the edited response of the script regarding the device cloud variables, including </span><strong class="source-inline"><span class="koboSpan" id="kobo.683.1">variable_name</span></strong><span class="koboSpan" id="kobo.684.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.685.1">type</span></strong><span class="koboSpan" id="kobo.686.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.687.1">permission</span></strong><span class="koboSpan" id="kobo.688.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.689.1">thing_id</span></strong><span class="koboSpan" id="kobo.690.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.691.1">update_strategy</span></strong><span class="koboSpan" id="kobo.692.1">, and so on. </span><span class="koboSpan" id="kobo.692.2">We have now</span><a id="_idIndexMarker673"/><span class="koboSpan" id="kobo.693.1"> seen how to get the cloud variable details, and in the next section we’ll move on to </span><span class="No-Break"><span class="koboSpan" id="kobo.694.1">cover Things.</span></span></p>
<h1 id="_idParaDest-173"><a id="_idTextAnchor173"/><span class="koboSpan" id="kobo.695.1">Engaging with Things – Node.js SDK implementation guide</span></h1>
<p><span class="koboSpan" id="kobo.696.1">The Thing</span><a id="_idIndexMarker674"/><span class="koboSpan" id="kobo.697.1"> is one of the most important elements in the Arduino IoT Cloud, and acts as defined container holding all of its ingredients such as cloud variables, the device, a sketch for the device, and the device’s network configuration. </span><span class="koboSpan" id="kobo.697.2">In this section, we will try a range of different coding exercises to get a feel for Thing </span><span class="No-Break"><span class="koboSpan" id="kobo.698.1">CRUD operations.</span></span></p>
<h2 id="_idParaDest-174"><a id="_idTextAnchor174"/><span class="koboSpan" id="kobo.699.1">Creating a Thing</span></h2>
<p><span class="koboSpan" id="kobo.700.1">Firstly, we will</span><a id="_idIndexMarker675"/><span class="koboSpan" id="kobo.701.1"> start with Thing creation. </span><span class="koboSpan" id="kobo.701.2">The relevant documentation can be found at </span><a href="https://www.arduino.cc/reference/en/iot/api/#api-ThingsV2-thingsV2Createe"><span class="koboSpan" id="kobo.702.1">https://www.arduino.cc/reference/en/iot/api/#api-ThingsV2-thingsV2Createe</span></a><span class="koboSpan" id="kobo.703.1">. </span><span class="koboSpan" id="kobo.703.2">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.704.1">create-thing.js</span></strong><span class="koboSpan" id="kobo.705.1"> file under the </span><strong class="source-inline"><span class="koboSpan" id="kobo.706.1">thing</span></strong><span class="koboSpan" id="kobo.707.1"> folder </span><span class="No-Break"><span class="koboSpan" id="kobo.708.1">in VSCode.</span></span></p>
<p><span class="koboSpan" id="kobo.709.1">There are two methods in this code: one is </span><strong class="source-inline"><span class="koboSpan" id="kobo.710.1">getToken()</span></strong><span class="koboSpan" id="kobo.711.1">, which is the same method as in all our coding exercises and helps us to fetch an authentication token for our requests. </span><span class="koboSpan" id="kobo.711.2">The second method is </span><strong class="source-inline"><span class="koboSpan" id="kobo.712.1">CreateThing()</span></strong><span class="koboSpan" id="kobo.713.1">, which is responsible for Thing creation. </span><span class="koboSpan" id="kobo.713.2">Referring to the documentation, we can see that we need to initiate the </span><strong class="source-inline"><span class="koboSpan" id="kobo.714.1">api</span></strong><span class="koboSpan" id="kobo.715.1"> variable with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.716.1">AiotApi.ThingsV2Api()</span></strong><span class="koboSpan" id="kobo.717.1"> object, which relates to the Arduino IoT Cloud Thing. </span><span class="koboSpan" id="kobo.717.2">This object is responsible for performing operations on </span><span class="No-Break"><span class="koboSpan" id="kobo.718.1">the Thing:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.719.1">
    var api = new AiotApi.ThingsV2Api()
    var thingCreate = {'name':' Sense the Env Thing Via API'}; // {ThingCreate}
    var opts = {
      'force': true // {Boolean} If true, detach device from the other thing, and attach to this thing
    };
    api.thingsV2Create(thingCreate, opts).then(function(data) {
      console.log('Thing Created successfully. </span><span class="koboSpan" id="kobo.719.2">Returned data: ' + util.inspect(data));
    }, function(error) {
      console.error(error);
    });</span></pre> <p><strong class="source-inline"><span class="koboSpan" id="kobo.720.1">api.thingsV2Create</span></strong><span class="koboSpan" id="kobo.721.1"> is the method responsible for Thing creation and takes two parameters as input: </span><strong class="source-inline"><span class="koboSpan" id="kobo.722.1">name</span></strong><span class="koboSpan" id="kobo.723.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.724.1">opts</span></strong><span class="koboSpan" id="kobo.725.1">. </span><span class="koboSpan" id="kobo.725.2">Firstly, we start with </span><strong class="source-inline"><span class="koboSpan" id="kobo.726.1">name</span></strong><span class="koboSpan" id="kobo.727.1">, which can be anything you like, but make sure to avoid special characters. </span><span class="koboSpan" id="kobo.727.2">For now, we provide just the Thing name in the variable, but in the upcoming</span><a id="_idIndexMarker676"/><span class="koboSpan" id="kobo.728.1"> update section, we will additionally pass the time zone and device </span><span class="No-Break"><span class="koboSpan" id="kobo.729.1">ID parameters.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.730.1">opts</span></strong><span class="koboSpan" id="kobo.731.1"> here is optional, hence I left it blank, but you can provide the </span><strong class="source-inline"><span class="koboSpan" id="kobo.732.1">X-Organization</span></strong><span class="koboSpan" id="kobo.733.1"> value if required. </span><span class="koboSpan" id="kobo.733.2">Both variables are passed to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.734.1">api.thingsV2Create</span></strong><span class="koboSpan" id="kobo.735.1"> method, which will return the response. </span><span class="koboSpan" id="kobo.735.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.736.1">util.inspect</span></strong><span class="koboSpan" id="kobo.737.1"> method is used to display the JSON response on the console with proper formatting. </span><span class="koboSpan" id="kobo.737.2">Type the following command to execute the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.738.1">create-device.js</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.739.1"> script:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.740.1">
node create-thing.js</span></pre> <p><span class="koboSpan" id="kobo.741.1">After successful execution of the script, it will print a response </span><span class="No-Break"><span class="koboSpan" id="kobo.742.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.743.1">
Thing Created successfully. </span><span class="koboSpan" id="kobo.743.2">Returned data: ArduinoThing {
  href: '/iot/v1/things/d99e244d-f245-4e27-9ead-717e52ac5a96',
  id: 'd99e244d-f245-4e27-9ead-717e52ac5a96',
  name: 'Sense the Env Thing Via API',
  timezone: 'America/New_York',
  user_id: 'f067c1e9-3ff8-4b9f-a9b4-f8c5c1d0ceb4',
  created_at: 2023-04-18T16:46:35.767Z,
  properties_count: 0,
  updated_at: 2023-04-18T16:46:35.767Z,
  webhook_active: false
}</span></pre> <p><span class="koboSpan" id="kobo.744.1">In the response, you will get your Thing ID, which will be used shortly in the following Thing update/delete operations – so make sure to paste this Thing ID into a Notepad file or something similar. </span><span class="koboSpan" id="kobo.744.2">Also returned</span><a id="_idIndexMarker677"/><span class="koboSpan" id="kobo.745.1"> are the time zone, properties count, and </span><span class="No-Break"><span class="koboSpan" id="kobo.746.1">webhook status.</span></span></p>
<h2 id="_idParaDest-175"><a id="_idTextAnchor175"/><span class="koboSpan" id="kobo.747.1">Updating a Thing</span></h2>
<p><span class="koboSpan" id="kobo.748.1">In this section, we are going</span><a id="_idIndexMarker678"/><span class="koboSpan" id="kobo.749.1"> to explore how to update a Thing using the Thing ID. </span><span class="koboSpan" id="kobo.749.2">Let’s suppose we mistakenly added the Thing without setting the proper time zone and without device association. </span><span class="koboSpan" id="kobo.749.3">In this scenario, we have the option to update the Thing with new properties. </span><span class="koboSpan" id="kobo.749.4">The documentation covering updating devices is available at </span><a href="https://www.arduino.cc/reference/en/iot/api/#api-ThingsV2-thingsV2Update"><span class="koboSpan" id="kobo.750.1">https://www.arduino.cc/reference/en/iot/api/#api-ThingsV2-thingsV2Update</span></a><span class="koboSpan" id="kobo.751.1">. </span><span class="koboSpan" id="kobo.751.2">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.752.1">update-thing.js</span></strong><span class="koboSpan" id="kobo.753.1"> file under the </span><strong class="source-inline"><span class="koboSpan" id="kobo.754.1">device</span></strong><span class="koboSpan" id="kobo.755.1"> folder </span><span class="No-Break"><span class="koboSpan" id="kobo.756.1">in VSCode:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.757.1">
    var api = new AiotApi.ThingsV2Api()
    var id = 'd99e244d-f245-4e27-9ead-717e52ac5a96'; // {String} The id of the thing
    var thingUpdate = {
        'name':'Sense the Env Thing Via API Update',
        'timezone':'Asia/Karachi',
        'device_id':'e88b84a7-7ad7-4c2b-b79c-ab426e47dc67'
    };
    var opts = {
      'force': true // {Boolean} If true, detach device from the other thing, and attach to this thing
    };
    api.thingsV2Update(id,thingUpdate, opts).then(function(data) {
      console.log('Thing Updated successfully. </span><span class="koboSpan" id="kobo.757.2">Returned data: ' + util.inspect(data));
    }, function(error) {
      console.error(error);
    });</span></pre> <p><span class="koboSpan" id="kobo.758.1">The preceding code is similar to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.759.1">create-thing</span></strong><span class="koboSpan" id="kobo.760.1"> code. </span><span class="koboSpan" id="kobo.760.2">Here we have one extra variable, </span><strong class="source-inline"><span class="koboSpan" id="kobo.761.1">id</span></strong><span class="koboSpan" id="kobo.762.1">, which will help us to update the specific Thing. </span><span class="koboSpan" id="kobo.762.2">We also have the </span><strong class="source-inline"><span class="koboSpan" id="kobo.763.1">timezone</span></strong><span class="koboSpan" id="kobo.764.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.765.1">device_id</span></strong><span class="koboSpan" id="kobo.766.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.767.1">name</span></strong><span class="koboSpan" id="kobo.768.1"> in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.769.1">thingupdate</span></strong><span class="koboSpan" id="kobo.770.1"> variable. </span><span class="koboSpan" id="kobo.770.2">Lastly, we call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.771.1">api.thingsV2Update()</span></strong><span class="koboSpan" id="kobo.772.1"> method. </span><span class="koboSpan" id="kobo.772.2">Execute the following command in </span><span class="No-Break"><span class="koboSpan" id="kobo.773.1">the Terminal:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.774.1">
node update-thing.js</span></pre> <p><span class="koboSpan" id="kobo.775.1">After successful execution of the script, it will print a response like </span><span class="No-Break"><span class="koboSpan" id="kobo.776.1">the following:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.777.1">
Thing Updated successfully. </span><span class="koboSpan" id="kobo.777.2">Returned data: ArduinoThing {
  href: '/iot/v1/things/d99e244d-f245-4e27-9ead-717e52ac5a96',
  id: 'd99e244d-f245-4e27-9ead-717e52ac5a96',
  name: 'Sense the Env Thing Via API Update',
  timezone: 'Asia/Karachi',
  user_id: 'f067c1e9-3ff8-4b9f-a9b4-f8c5c1d0ceb4',
  created_at: 2023-04-18T16:46:35.767Z,
  device_id: 'e88b84a7-7ad7-4c2b-b79c-ab426e47dc67',
  properties_count: 0,
  updated_at: 2023-04-18T16:46:35.767Z,
  webhook_active: false
}</span></pre> <p><span class="koboSpan" id="kobo.778.1">After our update, the response will return the new content. </span><span class="koboSpan" id="kobo.778.2">We provided new values for </span><strong class="source-inline"><span class="koboSpan" id="kobo.779.1">name</span></strong><span class="koboSpan" id="kobo.780.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.781.1">device_id</span></strong><span class="koboSpan" id="kobo.782.1">, along with the correct time zone. </span><span class="koboSpan" id="kobo.782.2">Everything is updated successfully and reflected</span><a id="_idIndexMarker679"/><span class="koboSpan" id="kobo.783.1"> in </span><span class="No-Break"><span class="koboSpan" id="kobo.784.1">the response.</span></span></p>
<h2 id="_idParaDest-176"><a id="_idTextAnchor176"/><span class="koboSpan" id="kobo.785.1">Creating a Thing sketch</span></h2>
<p><span class="koboSpan" id="kobo.786.1">With Thing creation</span><a id="_idIndexMarker680"/><span class="koboSpan" id="kobo.787.1"> out of the way, we now need to create a sketch for the Thing. </span><span class="koboSpan" id="kobo.787.2">The relevant documentation can be found at </span><a href="https://www.arduino.cc/reference/en/iot/api/#api-ThingsV2-thingsV2CreateSketch"><span class="koboSpan" id="kobo.788.1">https://www.arduino.cc/reference/en/iot/api/#api-ThingsV2-thingsV2CreateSketch</span></a><span class="koboSpan" id="kobo.789.1">. </span><span class="koboSpan" id="kobo.789.2">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.790.1">create-sketch-thing.js</span></strong><span class="koboSpan" id="kobo.791.1"> file under the </span><strong class="source-inline"><span class="koboSpan" id="kobo.792.1">thing</span></strong><span class="koboSpan" id="kobo.793.1"> folder </span><span class="No-Break"><span class="koboSpan" id="kobo.794.1">in VSCode.</span></span></p>
<p><span class="koboSpan" id="kobo.795.1">There are two methods in the code: one is </span><strong class="source-inline"><span class="koboSpan" id="kobo.796.1">getToken()</span></strong><span class="koboSpan" id="kobo.797.1">, which is the same method as used in all our coding exercises and fetches the authentication token for our requests. </span><span class="koboSpan" id="kobo.797.2">The second method is </span><strong class="source-inline"><span class="koboSpan" id="kobo.798.1">CreateSketch()</span></strong><span class="koboSpan" id="kobo.799.1">, which handles creating the sketch for our </span><span class="No-Break"><span class="koboSpan" id="kobo.800.1">specific Thing:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.801.1">
    var api = new AiotApi.ThingsV2Api()
    var id = 'd99e244d-f245-4e27-9ead-717e52ac5a96'; // {String} The id of the thing
    var thingSketch = {'sketch_version':'v1'}; // {ThingSketch}
    var opts = {
    };
    api.thingsV2CreateSketch(id, thingSketch, opts).then(function(data) {
      console.log('Thing Sketch Created successfully. </span><span class="koboSpan" id="kobo.801.2">Returned data: ' + util.inspect(data));
    }, function(error) {
      console.error(error);
    });</span></pre> <p><strong class="source-inline"><span class="koboSpan" id="kobo.802.1">api.thingsV2CreateSketch</span></strong><span class="koboSpan" id="kobo.803.1"> is the method</span><a id="_idIndexMarker681"/><span class="koboSpan" id="kobo.804.1"> responsible for Thing sketch creation and takes three parameters as input. </span><span class="koboSpan" id="kobo.804.2">The Thing ID is the first parameter; the second is the sketch version. </span><strong class="source-inline"><span class="koboSpan" id="kobo.805.1">opts</span></strong><span class="koboSpan" id="kobo.806.1"> is optional, so I left it blank, but you can provide the </span><strong class="source-inline"><span class="koboSpan" id="kobo.807.1">X-Organization</span></strong><span class="koboSpan" id="kobo.808.1"> value according to your requirements. </span><span class="koboSpan" id="kobo.808.2">All variables are passed to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.809.1">api.thingsV2CreateSketch</span></strong><span class="koboSpan" id="kobo.810.1"> method, which will return the response. </span><span class="koboSpan" id="kobo.810.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.811.1">util.inspect</span></strong><span class="koboSpan" id="kobo.812.1"> method is used to display the JSON response on the console with proper formatting. </span><span class="koboSpan" id="kobo.812.2">Type the following command to execute the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.813.1">create-device.js</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.814.1"> script:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.815.1">
node create-sketch-thing.js</span></pre> <p><span class="koboSpan" id="kobo.816.1">After successful execution of the script, it will print the </span><span class="No-Break"><span class="koboSpan" id="kobo.817.1">following response:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.818.1">
Thing Sketch Created successfully. </span><span class="koboSpan" id="kobo.818.2">Returned data: ArduinoThing {
  href: '/iot/v1/things/d99e244d-f245-4e27-9ead-717e52ac5a96',
  id: 'd99e244d-f245-4e27-9ead-717e52ac5a96',
  name: 'Sense the Env Thing Via API Update',
  timezone: 'Asia/Karachi',
  user_id: 'f067c1e9-3ff8-4b9f-a9b4-f8c5c1d0ceb4',
  created_at: 2023-04-18T16:46:35.767Z,
  device_id: 'e88b84a7-7ad7-4c2b-b79c-ab426e47dc67',
  properties_count: 0,
  sketch_id: '93297fc6-835d-46b3-89bc-1c6738a8ec7b',
  updated_at: 2023-04-18T17:10:34.779Z,
  webhook_active: false
}</span></pre> <p><span class="koboSpan" id="kobo.819.1">In the response, you will see your Thing ID along with some other properties indicating that the sketch for the given Thing has been created successfully. </span><span class="koboSpan" id="kobo.819.2">You can also verify the sketch by navigating to the given Thing on the Arduino </span><span class="No-Break"><span class="koboSpan" id="kobo.820.1">IoT Cloud.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.821.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.822.1">Before sketch creation, it’s important to associate a device with </span><span class="No-Break"><span class="koboSpan" id="kobo.823.1">the Thing.</span></span></p>
<p><span class="koboSpan" id="kobo.824.1">In this section, we created the Sketch for our Thing as the Arduino IoT Cloud will not do this by default. </span><span class="koboSpan" id="kobo.824.2">As a result, it’s mandatory</span><a id="_idIndexMarker682"/><span class="koboSpan" id="kobo.825.1"> to create a Sketch after creating a Thing in the Arduino IoT Cloud. </span><span class="koboSpan" id="kobo.825.2">Next we are going to explore how we can delete a Thing using the Arduino IoT </span><span class="No-Break"><span class="koboSpan" id="kobo.826.1">Cloud API.</span></span></p>
<h2 id="_idParaDest-177"><a id="_idTextAnchor177"/><span class="koboSpan" id="kobo.827.1">Deleting a Thing</span></h2>
<p><span class="koboSpan" id="kobo.828.1">In this section, we are going to explore</span><a id="_idIndexMarker683"/><span class="koboSpan" id="kobo.829.1"> how we can delete a Thing using the Thing ID. </span><span class="koboSpan" id="kobo.829.2">The documentation covering Thing deletion is available at </span><a href="https://www.arduino.cc/reference/en/iot/api/#api-ThingsV2-thingsV2Delete"><span class="koboSpan" id="kobo.830.1">https://www.arduino.cc/reference/en/iot/api/#api-ThingsV2-thingsV2Delete</span></a><span class="koboSpan" id="kobo.831.1">. </span><span class="koboSpan" id="kobo.831.2">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.832.1">delete-thing.js</span></strong><span class="koboSpan" id="kobo.833.1"> file under the </span><strong class="source-inline"><span class="koboSpan" id="kobo.834.1">thing</span></strong><span class="koboSpan" id="kobo.835.1"> folder </span><span class="No-Break"><span class="koboSpan" id="kobo.836.1">in VSCode:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.837.1">
    var api = new AiotApi.ThingsV2Api()
    var id = 'ac9fc5fd-a946-406e-983d-715dcc2571b6'; // {String} The id of the thing
    var opts = {
      'force': true // {Boolean} If true, detach device from the other thing, and attach to this thing
    };
    api.thingsV2Delete(id, opts).then(function(data) {
      console.log('Thing Deleted successfully. </span><span class="koboSpan" id="kobo.837.2">Returned data: ' + data);
    }, function(error) {
      console.error(error);
    });</span></pre> <p><span class="koboSpan" id="kobo.838.1">The preceding code snippet is taken from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.839.1">DeleteThing()</span></strong><span class="koboSpan" id="kobo.840.1"> method. </span><span class="koboSpan" id="kobo.840.2">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.841.1">DeleteThing()</span></strong><span class="koboSpan" id="kobo.842.1"> method, we need to supply the </span><strong class="source-inline"><span class="koboSpan" id="kobo.843.1">id</span></strong><span class="koboSpan" id="kobo.844.1"> (Thing ID) and </span><strong class="source-inline"><span class="koboSpan" id="kobo.845.1">opts</span></strong><span class="koboSpan" id="kobo.846.1"> variables as parameters. </span><strong class="source-inline"><span class="koboSpan" id="kobo.847.1">id</span></strong><span class="koboSpan" id="kobo.848.1"> (Thing ID) is mandatory for the deletion process, while the </span><strong class="source-inline"><span class="koboSpan" id="kobo.849.1">opts</span></strong><span class="koboSpan" id="kobo.850.1"> variable is not. </span><span class="koboSpan" id="kobo.850.2">Execute the following command in </span><span class="No-Break"><span class="koboSpan" id="kobo.851.1">the Terminal:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.852.1">
node delete-thing.js</span></pre> <p><span class="koboSpan" id="kobo.853.1">After successful execution of the script, it will print a response on the console indicating that the device was </span><span class="No-Break"><span class="koboSpan" id="kobo.854.1">deleted</span></span><span class="No-Break"><a id="_idIndexMarker684"/></span><span class="No-Break"><span class="koboSpan" id="kobo.855.1"> successfully.</span></span></p>
<h2 id="_idParaDest-178"><a id="_idTextAnchor178"/><span class="koboSpan" id="kobo.856.1">Listing Things</span></h2>
<p><span class="koboSpan" id="kobo.857.1">In this section, we will list</span><a id="_idIndexMarker685"/><span class="koboSpan" id="kobo.858.1"> all the Things. </span><span class="koboSpan" id="kobo.858.2">Note that there is a difference between </span><em class="italic"><span class="koboSpan" id="kobo.859.1">listing</span></em><span class="koboSpan" id="kobo.860.1"> Things and </span><em class="italic"><span class="koboSpan" id="kobo.861.1">showing</span></em><span class="koboSpan" id="kobo.862.1"> a Thing: listing Things will display all the Things with their properties, while showing a Thing only shows the specific Thing properties related to a given </span><span class="No-Break"><span class="koboSpan" id="kobo.863.1">Thing ID.</span></span></p>
<p><span class="koboSpan" id="kobo.864.1">The relevant documentation on listing Things is available at </span><a href="https://www.arduino.cc/reference/en/iot/api/#api-ThingsV2-thingsV2List"><span class="koboSpan" id="kobo.865.1">https://www.arduino.cc/reference/en/iot/api/#api-ThingsV2-thingsV2List</span></a><span class="koboSpan" id="kobo.866.1">. </span><span class="koboSpan" id="kobo.866.2">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.867.1">list-thing.js</span></strong><span class="koboSpan" id="kobo.868.1"> file under the </span><strong class="source-inline"><span class="koboSpan" id="kobo.869.1">thing</span></strong><span class="koboSpan" id="kobo.870.1"> folder in VSCode. </span><span class="koboSpan" id="kobo.870.2">The following code snippet is taken from the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.871.1">ListThing()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.872.1"> method:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.873.1">
    var api = new AiotApi.ThingsV2Api()
    var opts = {
        'acrossUserIds': false
    };
    api.thingsV2List(opts).then(function(data) {
        for(var i=0;i&lt;data.length;i++){
            console.log("Thing ID:"+data[i].id+" Thing Name:"+data[i].name);
        }
      }, function(error) {
        console.error(error);
      });</span></pre> <p><span class="koboSpan" id="kobo.874.1">Here we need to provide criteria that will be used to filter out the Things and return the response. </span><span class="koboSpan" id="kobo.874.2">In the current code, we have provided only one parameter, </span><strong class="source-inline"><span class="koboSpan" id="kobo.875.1">'acrossUserIds'</span></strong><span class="koboSpan" id="kobo.876.1">, which is </span><strong class="source-inline"><span class="koboSpan" id="kobo.877.1">true</span></strong><span class="koboSpan" id="kobo.878.1"> and so will fetch all types of Things. </span><span class="koboSpan" id="kobo.878.2">But you can also filter Things on the basis of tags, IDs, X-Organization, and so on. </span><span class="koboSpan" id="kobo.878.3">Execute the following command in </span><span class="No-Break"><span class="koboSpan" id="kobo.879.1">the Terminal:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.880.1">
node list-thing.js</span></pre> <p><span class="koboSpan" id="kobo.881.1">After successful execution</span><a id="_idIndexMarker686"/><span class="koboSpan" id="kobo.882.1"> of the script, it will print the response in JSON format with the Thing properties, which will fill the console with an extensive output. </span><span class="koboSpan" id="kobo.882.2">I modified the code to only display the Thing ID and Thing name on </span><span class="No-Break"><span class="koboSpan" id="kobo.883.1">the console:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.884.1">
Thing ID:6b6cd076-5859-4a6d-9b4e-18879893c6cb Thing Name:Tracking and notifying Your Heart Rate
Thing ID:6e3d308c-dfb2-49ad-aa61-998227f214ab Thing Name:Thing Via API-Name-Update
Thing ID:85b04a9c-e335-4842-bf4b-c13f726e0522 Thing Name:AgriStack
Thing ID:8aee742e-4492-423d-9f19-79fec856b917 Thing Name:A portable thing tracker using MKR GSM1400
Thing ID:bf8e11ea-1a78-4f95-b6a0-c6d50b868402 Thing Name:MKR1010 Hello World
Thing ID:d99e244d-f245-4e27-9ead-717e52ac5a96 Thing Name:Sense the Env Thing Via API Update</span></pre> <p><span class="koboSpan" id="kobo.885.1">As can be seen in the preceding output, I am only displaying two parameters on the console but you can choose whichever parameters you would like to be displayed by specifying their names in the for loop. </span><span class="koboSpan" id="kobo.885.2">This way we can send the output in JSON format to a web/mobile client where the information</span><a id="_idIndexMarker687"/><span class="koboSpan" id="kobo.886.1"> will be displayed in either a list box or </span><span class="No-Break"><span class="koboSpan" id="kobo.887.1">in menus.</span></span></p>
<h2 id="_idParaDest-179"><a id="_idTextAnchor179"/><span class="koboSpan" id="kobo.888.1">Showing a Thing</span></h2>
<p><span class="koboSpan" id="kobo.889.1">This is the last subsection</span><a id="_idIndexMarker688"/><span class="koboSpan" id="kobo.890.1"> of the </span><em class="italic"><span class="koboSpan" id="kobo.891.1">Engaging with things – Node.js SDK implementation guide </span></em><span class="koboSpan" id="kobo.892.1">section. </span><span class="koboSpan" id="kobo.892.2">Here we will fetch all the properties regarding a specific Thing by providing the Thing ID. </span><span class="koboSpan" id="kobo.892.3">The documentation covering showing Things is available at </span><a href="https://www.arduino.cc/reference/en/iot/api/#api-ThingsV2-thingsV2Show"><span class="koboSpan" id="kobo.893.1">https://www.arduino.cc/reference/en/iot/api/#api-ThingsV2-thingsV2Show</span></a><span class="koboSpan" id="kobo.894.1">. </span><span class="koboSpan" id="kobo.894.2">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.895.1">show-thing.js</span></strong><span class="koboSpan" id="kobo.896.1"> file under the </span><strong class="source-inline"><span class="koboSpan" id="kobo.897.1">thing</span></strong><span class="koboSpan" id="kobo.898.1"> folder in VSCode. </span><span class="koboSpan" id="kobo.898.2">The following code snippet is taken from the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.899.1">ShowThing()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.900.1"> method:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.901.1">
    var api = new AiotApi.ThingsV2Api()
    var thingid='6b6cd076-5859-4a6d-9b4e-18879893c6cb';
    var opts = {
    };
    api.thingsV2Show(thingid, opts).then(function(data) {
        console.log('API called successfully. </span><span class="koboSpan" id="kobo.901.2">Returned data: ' +util.inspect(data));
      }, function(error) {
        console.error(error);
      });</span></pre> <p><span class="koboSpan" id="kobo.902.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.903.1">thingsV2Show()</span></strong><span class="koboSpan" id="kobo.904.1"> method only takes two parameters: the first one is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.905.1">thingid</span></strong><span class="koboSpan" id="kobo.906.1"> and the second is </span><strong class="source-inline"><span class="koboSpan" id="kobo.907.1">opts</span></strong><span class="koboSpan" id="kobo.908.1">, which include </span><strong class="source-inline"><span class="koboSpan" id="kobo.909.1">X-Organization</span></strong><span class="koboSpan" id="kobo.910.1">. </span><strong class="source-inline"><span class="koboSpan" id="kobo.911.1">thingid</span></strong><span class="koboSpan" id="kobo.912.1"> is mandatory to fetch a proper response, while the </span><strong class="source-inline"><span class="koboSpan" id="kobo.913.1">opts</span></strong><span class="koboSpan" id="kobo.914.1"> variable is not compulsory, hence I passed this variable empty. </span><span class="koboSpan" id="kobo.914.2">Execute the following command in </span><span class="No-Break"><span class="koboSpan" id="kobo.915.1">the Terminal:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.916.1">
node show-thing.js</span></pre> <p><span class="koboSpan" id="kobo.917.1">After successful execution of the script, it will print the response in JSON format containing the device properties</span><a id="_idIndexMarker689"/><span class="koboSpan" id="kobo.918.1"> as well as the details of cloud variables, if any associated variable </span><span class="No-Break"><span class="koboSpan" id="kobo.919.1">is present:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.920.1">
API called successfully. </span><span class="koboSpan" id="kobo.920.2">Returned data: ArduinoThing {
  name: 'Tracking and notifying Your Heart Rate',
  timezone: 'Asia/Karachi',
    ……………………………………..
</span><span class="koboSpan" id="kobo.920.3">  device_fqbn: 'esp32:esp32:XIAO_ESP32C3',
  device_id: '62e8600b-2733-4f24-9654-1fac549af27f',
  device_name: 'XIAO-ESP32C3-Pulse-Sensor',
  device_type: 'login_and_secretkey_wifi',
  properties: [
    ArduinoProperty {
      id: 'b357a513-ad2b-4e1f-a76b-6dac078e36d5',
      name: 'BPM',
      permission: 'READ_ONLY',
      thing_id: '6b6cd076-5859-4a6d-9b4e-18879893c6cb',
      type: 'HEART_BEATS',
      update_strategy: 'ON_CHANGE',
      created_at: 2023-03-31T16:41:33.103Z,
      last_value: 50,
    ……………………………………..
</span><span class="koboSpan" id="kobo.920.4">      variable_name: 'bPM'
    }
  ],
  properties_count: 1,
  sketch_id: 'f490fec5-b62a-41f9-9ff7-2b5c3f2ed7d1',
  updated_at: 2023-04-01T16:42:47.152Z,
  webhook_active: true,
  webhook_uri: 'https://hooks.zapier.com/hooks/catch/14930971/324me7k/'
}</span></pre> <p><span class="koboSpan" id="kobo.921.1">The preceding code snippet shows an edited section from the output response regarding the Thing properties, which includes all the details of the Thing, the device properties, cloud variables such as last value, webhook details (if active), the sketch ID, and </span><span class="No-Break"><span class="koboSpan" id="kobo.922.1">so on.</span></span></p>
<p><span class="koboSpan" id="kobo.923.1">In this section, we explored how we can get the complete details of a specific Arduino IoT Cloud Thing using the Thing ID</span><a id="_idIndexMarker690"/><span class="koboSpan" id="kobo.924.1"> in JSON format. </span><span class="koboSpan" id="kobo.924.2">Next, we will start playing with </span><span class="No-Break"><span class="koboSpan" id="kobo.925.1">cloud variables/properties.</span></span></p>
<h1 id="_idParaDest-180"><a id="_idTextAnchor180"/><span class="koboSpan" id="kobo.926.1">Exploring properties – Node.js SDK interaction techniques</span></h1>
<p><strong class="bold"><span class="koboSpan" id="kobo.927.1">Properties</span></strong><span class="koboSpan" id="kobo.928.1">, also called </span><strong class="bold"><span class="koboSpan" id="kobo.929.1">cloud variables</span></strong><span class="koboSpan" id="kobo.930.1">, are one of the most important ingredients</span><a id="_idIndexMarker691"/><span class="koboSpan" id="kobo.931.1"> for Things in the Arduino IoT Cloud, responsible for storage of sensor data from the device to the cloud or vice versa. </span><span class="koboSpan" id="kobo.931.2">In this section, we will explore how to create, update, delete, and list cloud variables using the </span><span class="No-Break"><span class="koboSpan" id="kobo.932.1">Node.js SDK.</span></span></p>
<h2 id="_idParaDest-181"><a id="_idTextAnchor181"/><span class="koboSpan" id="kobo.933.1">Creating a property</span></h2>
<p><span class="koboSpan" id="kobo.934.1">Firstly, we will start</span><a id="_idIndexMarker692"/><span class="koboSpan" id="kobo.935.1"> with property creation. </span><span class="koboSpan" id="kobo.935.2">The property creation documentation can be found at </span><a href="https://www.arduino.cc/reference/en/iot/api/#api-PropertiesV2-propertiesV2Create"><span class="koboSpan" id="kobo.936.1">https://www.arduino.cc/reference/en/iot/api/#api-PropertiesV2-propertiesV2Create</span></a><span class="koboSpan" id="kobo.937.1">. </span><span class="koboSpan" id="kobo.937.2">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.938.1">create-property.js</span></strong><span class="koboSpan" id="kobo.939.1"> file under the </span><strong class="source-inline"><span class="koboSpan" id="kobo.940.1">properties</span></strong><span class="koboSpan" id="kobo.941.1"> folder </span><span class="No-Break"><span class="koboSpan" id="kobo.942.1">in VSCode.</span></span></p>
<p><span class="koboSpan" id="kobo.943.1">There are two methods in the code: one is </span><strong class="source-inline"><span class="koboSpan" id="kobo.944.1">getToken()</span></strong><span class="koboSpan" id="kobo.945.1">, which is the same method used in all our coding exercises to fetch the authentication token for our requests. </span><span class="koboSpan" id="kobo.945.2">The second method is </span><strong class="source-inline"><span class="koboSpan" id="kobo.946.1">CreateProperty()</span></strong><span class="koboSpan" id="kobo.947.1">, which handles cloud variable creation. </span><span class="koboSpan" id="kobo.947.2">Consulting the documentation, we can</span><a id="_idIndexMarker693"/><span class="koboSpan" id="kobo.948.1"> see that we need to initiate the </span><strong class="source-inline"><span class="koboSpan" id="kobo.949.1">api</span></strong><span class="koboSpan" id="kobo.950.1"> variable with </span><strong class="source-inline"><span class="koboSpan" id="kobo.951.1">AiotApi</span></strong><span class="koboSpan" id="kobo.952.1">, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.953.1">PropertiesV2Api()</span></strong><span class="koboSpan" id="kobo.954.1"> object, which is related </span><span class="No-Break"><span class="koboSpan" id="kobo.955.1">to properties:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.956.1">
    var api = new AiotApi.PropertiesV2Api()
    var thing_id="d99e244d-f245-4e27-9ead-717e52ac5a96";
    var property = {
        'name':'Temperature',
        'variable_name':'temperature',
        'permission':"READ_ONLY",
        'persist':true,
        'type':'TEMPERATURE_C',
        'update_strategy':'ON_CHANGE'
    };
    api.propertiesV2Create(thing_id, property).then(function(data) {
        console.log('Property Created successfully. </span><span class="koboSpan" id="kobo.956.2">Returned data: ' +util.inspect(data));
      }, function(error) {
        console.error(error);
      });</span></pre> <p><strong class="source-inline"><span class="koboSpan" id="kobo.957.1">api.propertiesV2Create</span></strong><span class="koboSpan" id="kobo.958.1"> is the method responsible for property creation and takes two parameters as input. </span><span class="koboSpan" id="kobo.958.2">One is the Thing ID and the other variable contains mandatory details regarding the cloud variable. </span><span class="koboSpan" id="kobo.958.3">The Thing ID is simple and easily fetchable from the Thing metadata, but cloud variables have a variety of different parameters including </span><strong class="source-inline"><span class="koboSpan" id="kobo.959.1">type</span></strong><span class="koboSpan" id="kobo.960.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.961.1">permission</span></strong><span class="koboSpan" id="kobo.962.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.963.1">update_strategy</span></strong><span class="koboSpan" id="kobo.964.1">, available on the official documentation page (the URL was provided at the start of this section). </span><span class="koboSpan" id="kobo.964.2">Both variables are passed to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.965.1">api.devicesV2Create</span></strong><span class="koboSpan" id="kobo.966.1"> method, which returns the response. </span><span class="koboSpan" id="kobo.966.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.967.1">util.inspect</span></strong><span class="koboSpan" id="kobo.968.1"> method is used to display the JSON response with proper formatting on the console. </span><span class="koboSpan" id="kobo.968.2">Type the following command to execute the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.969.1">create-device.js</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.970.1"> script:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.971.1">
node create-property.js</span></pre> <p><span class="koboSpan" id="kobo.972.1">After successful execution</span><a id="_idIndexMarker694"/><span class="koboSpan" id="kobo.973.1"> of the script, it will print the </span><span class="No-Break"><span class="koboSpan" id="kobo.974.1">following response:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.975.1">
Property Created successfully. </span><span class="koboSpan" id="kobo.975.2">Returned data: ArduinoProperty {
  href: '/iot/v1/things/d99e244d-f245-4e27-9ead-717e52ac5a96/properties/c4dc8f92-b62f-44df-9455-74cdd08041bc',
  id: 'c4dc8f92-b62f-44df-9455-74cdd08041bc',
  name: 'Temperature',
  permission: 'READ_ONLY',
  thing_id: 'd99e244d-f245-4e27-9ead-717e52ac5a96',
  type: 'TEMPERATURE_C',
  update_strategy: 'ON_CHANGE',
  created_at: 2023-04-18T23:49:46.610Z,
  persist: true,
  tag: 1,
  updated_at: 2023-04-18T23:49:46.610Z,
  variable_name: 'temperature'
}</span></pre> <p><span class="koboSpan" id="kobo.976.1">In the response, you will get your cloud variable ID, creation date, and update date, along with other details </span><a id="_idIndexMarker695"/><span class="koboSpan" id="kobo.977.1">already mentioned during our cloud variable </span><span class="No-Break"><span class="koboSpan" id="kobo.978.1">creation exercise.</span></span></p>
<h2 id="_idParaDest-182"><a id="_idTextAnchor182"/><span class="koboSpan" id="kobo.979.1">Updating a property</span></h2>
<p><span class="koboSpan" id="kobo.980.1">In this section, we are going</span><a id="_idIndexMarker696"/><span class="koboSpan" id="kobo.981.1"> to explore how we can update a cloud variable using the cloud variable ID. </span><span class="koboSpan" id="kobo.981.2">Suppose we mistakenly added a cloud variable with the wrong data type and some other parameters – in the event of this scenario, we have the option to update it. </span><span class="koboSpan" id="kobo.981.3">The documentation covering updating properties is available at </span><a href="https://www.arduino.cc/reference/en/iot/api/#api-PropertiesV2-propertiesV2Update"><span class="koboSpan" id="kobo.982.1">https://www.arduino.cc/reference/en/iot/api/#api-PropertiesV2-propertiesV2Update</span></a><span class="koboSpan" id="kobo.983.1">. </span><span class="koboSpan" id="kobo.983.2">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.984.1">update-property.js</span></strong><span class="koboSpan" id="kobo.985.1"> file under the </span><strong class="source-inline"><span class="koboSpan" id="kobo.986.1">property</span></strong><span class="koboSpan" id="kobo.987.1"> folder </span><span class="No-Break"><span class="koboSpan" id="kobo.988.1">in VSCode:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.989.1">
   var api = new AiotApi.PropertiesV2Api()
    var thing_id="d99e244d-f245-4e27-9ead-717e52ac5a96";
    var property_id="c4dc8f92-b62f-44df-9455-74cdd08041bc"
    var property = {
        'name':'OutdoorTemperature',
        'variable_name':'outdoorTemperature',
        'permission':"READ_ONLY",
        'persist':true,
        'type':'TEMPERATURE_F',
        'update_strategy':'ON_CHANGE'
    };
    api.propertiesV2Update(thing_id,property_id, property).then(function(data) {
        console.log('Property Updated successfully. </span><span class="koboSpan" id="kobo.989.2">Returned data: ' +util.inspect(data));
      }, function(error) {
        console.error(error);
      });</span></pre> <p><span class="koboSpan" id="kobo.990.1">The preceding code is very similar to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.991.1">create-property</span></strong><span class="koboSpan" id="kobo.992.1"> code. </span><span class="koboSpan" id="kobo.992.2">Here we have one extra variable, </span><strong class="source-inline"><span class="koboSpan" id="kobo.993.1">property_id</span></strong><span class="koboSpan" id="kobo.994.1">, used to update the given property. </span><span class="koboSpan" id="kobo.994.2">Besides that, we have the same cloud variable properties with their updated content. </span><span class="koboSpan" id="kobo.994.3">Lastly, we call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.995.1">api.propertiesV2Update()</span></strong><span class="koboSpan" id="kobo.996.1"> method. </span><span class="koboSpan" id="kobo.996.2">Execute</span><a id="_idIndexMarker697"/><span class="koboSpan" id="kobo.997.1"> the following command in </span><span class="No-Break"><span class="koboSpan" id="kobo.998.1">the Terminal:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.999.1">
node update-property.js</span></pre> <p><span class="koboSpan" id="kobo.1000.1">After successful execution of the script, it will print a response something like </span><span class="No-Break"><span class="koboSpan" id="kobo.1001.1">the following:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1002.1">
Property Updated successfully. </span><span class="koboSpan" id="kobo.1002.2">Returned data: ArduinoProperty {
  href: '/iot/v1/things/d99e244d-f245-4e27-9ead-717e52ac5a96/properties/c4dc8f92-b62f-44df-9455-74cdd08041bc',
  id: 'c4dc8f92-b62f-44df-9455-74cdd08041bc',
  name: 'OutdoorTemperature',
  permission: 'READ_ONLY',
  thing_id: 'd99e244d-f245-4e27-9ead-717e52ac5a96',
  type: 'TEMPERATURE_F',
  update_strategy: 'ON_CHANGE',
  created_at: 2023-04-18T23:49:46.610Z,
  persist: true,
  updated_at: 2023-04-18T23:58:07.496Z,
  variable_name: 'outdoorTemperature'
}</span></pre> <p><span class="koboSpan" id="kobo.1003.1">After the update, the response will return the new content. </span><span class="koboSpan" id="kobo.1003.2">We provided updated information for the name, type, and variable</span><a id="_idIndexMarker698"/><span class="koboSpan" id="kobo.1004.1"> name and this is reflected successfully in </span><span class="No-Break"><span class="koboSpan" id="kobo.1005.1">the response.</span></span></p>
<h2 id="_idParaDest-183"><a id="_idTextAnchor183"/><span class="koboSpan" id="kobo.1006.1">Deleting a property</span></h2>
<p><span class="koboSpan" id="kobo.1007.1">In this section, we are going to explore</span><a id="_idIndexMarker699"/><span class="koboSpan" id="kobo.1008.1"> how to delete a property using the Thing ID and property ID. </span><span class="koboSpan" id="kobo.1008.2">The documentation covering deleting a property is available at </span><a href="https://www.arduino.cc/reference/en/iot/api/#api-PropertiesV2-propertiesV2Delete"><span class="koboSpan" id="kobo.1009.1">https://www.arduino.cc/reference/en/iot/api/#api-PropertiesV2-propertiesV2Delete</span></a><span class="koboSpan" id="kobo.1010.1">. </span><span class="koboSpan" id="kobo.1010.2">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1011.1">delete-property.js</span></strong><span class="koboSpan" id="kobo.1012.1"> file under the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1013.1">property</span></strong><span class="koboSpan" id="kobo.1014.1"> folder </span><span class="No-Break"><span class="koboSpan" id="kobo.1015.1">in VSCode:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1016.1">
    var api = new AiotApi.PropertiesV2Api()
    var thing_id="d99e244d-f245-4e27-9ead-717e52ac5a96";
    var property_id="c4dc8f92-b62f-44df-9455-74cdd08041bc";
    var options = {
        'force':true
    };
    api.propertiesV2Delete(thing_id,property_id, options).then(function(data) {
        console.log('Property Deleted successfully. </span><span class="koboSpan" id="kobo.1016.2">Returned data: ' +data);
      }, function(error) {
        console.error(error);
      });</span></pre> <p><span class="koboSpan" id="kobo.1017.1">The preceding code snippet is taken from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1018.1">DeleteProperty()</span></strong><span class="koboSpan" id="kobo.1019.1"> method from </span><strong class="source-inline"><span class="koboSpan" id="kobo.1020.1">delete-property.js</span></strong><span class="koboSpan" id="kobo.1021.1"> file. </span><span class="koboSpan" id="kobo.1021.2">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1022.1">DeleteProperty()</span></strong><span class="koboSpan" id="kobo.1023.1"> method we need to supply the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1024.1">thing_ID</span></strong><span class="koboSpan" id="kobo.1025.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1026.1">property_id</span></strong><span class="koboSpan" id="kobo.1027.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1028.1">options</span></strong><span class="koboSpan" id="kobo.1029.1"> variables as parameters. </span><strong class="source-inline"><span class="koboSpan" id="kobo.1030.1">thing_id</span></strong><span class="koboSpan" id="kobo.1031.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1032.1">property_id</span></strong><span class="koboSpan" id="kobo.1033.1"> are both mandatory for the deletion process while the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1034.1">options</span></strong><span class="koboSpan" id="kobo.1035.1"> variable is optional. </span><span class="koboSpan" id="kobo.1035.2">Execute the following command in </span><span class="No-Break"><span class="koboSpan" id="kobo.1036.1">the Terminal:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1037.1">
node delete-property.js</span></pre> <p><span class="koboSpan" id="kobo.1038.1">After successful execution</span><a id="_idIndexMarker700"/><span class="koboSpan" id="kobo.1039.1"> of the script, it will print a response on the console reading that the property has been </span><span class="No-Break"><span class="koboSpan" id="kobo.1040.1">deleted successfully.</span></span></p>
<h2 id="_idParaDest-184"><a id="_idTextAnchor184"/><span class="koboSpan" id="kobo.1041.1">Listing properties</span></h2>
<p><span class="koboSpan" id="kobo.1042.1">In this section, we will list</span><a id="_idIndexMarker701"/><span class="koboSpan" id="kobo.1043.1"> all the properties for a given Thing using the Thing ID. </span><span class="koboSpan" id="kobo.1043.2">As previously outlined with devices and Things, there is a difference between </span><em class="italic"><span class="koboSpan" id="kobo.1044.1">listing</span></em><span class="koboSpan" id="kobo.1045.1"> properties and </span><em class="italic"><span class="koboSpan" id="kobo.1046.1">showing</span></em><span class="koboSpan" id="kobo.1047.1"> a property. </span><span class="koboSpan" id="kobo.1047.2">Listing properties means displaying all the cloud variables of a Thing, while showing a property only shows the specific cloud variable properties related to the given Thing ID and </span><span class="No-Break"><span class="koboSpan" id="kobo.1048.1">property ID.</span></span></p>
<p><span class="koboSpan" id="kobo.1049.1">The documentation on listing properties is available at </span><a href="https://www.arduino.cc/reference/en/iot/api/#api-PropertiesV2-propertiesV2List"><span class="koboSpan" id="kobo.1050.1">https://www.arduino.cc/reference/en/iot/api/#api-PropertiesV2-propertiesV2List</span></a><span class="koboSpan" id="kobo.1051.1">. </span><span class="koboSpan" id="kobo.1051.2">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1052.1">list-property.js</span></strong><span class="koboSpan" id="kobo.1053.1"> file under the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1054.1">property</span></strong><span class="koboSpan" id="kobo.1055.1"> folder in VSCode. </span><span class="koboSpan" id="kobo.1055.2">The following code snippet is taken from the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1056.1">ListProperty()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1057.1"> method:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1058.1">
    var api = new AiotApi.PropertiesV2Api()
    var thing_id="6b6cd076-5859-4a6d-9b4e-18879893c6cb";
    var options = {
        'showDeleted':true
    };
    api.propertiesV2List(thing_id, options).then(function(data) {
        console.log('Property Updated successfully. </span><span class="koboSpan" id="kobo.1058.2">Returned data: ' +util.inspect(data));
      }, function(error) {
        console.error(error);
      });</span></pre> <p><span class="koboSpan" id="kobo.1059.1">Here we only need to provide</span><a id="_idIndexMarker702"/><span class="koboSpan" id="kobo.1060.1"> the Thing ID and options to get a complete list of cloud variables associated with the Thing. </span><span class="koboSpan" id="kobo.1060.2">Execute the following command in </span><span class="No-Break"><span class="koboSpan" id="kobo.1061.1">the Terminal:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1062.1">
node list-property.js</span></pre> <p><span class="koboSpan" id="kobo.1063.1">After successful execution of the script, it will print the response in JSON format with the cloud variable’s properties. </span><span class="koboSpan" id="kobo.1063.2">I chose a Thing that only has a single </span><span class="No-Break"><span class="koboSpan" id="kobo.1064.1">cloud variable:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1065.1">
Returned data: [
  ArduinoProperty {
    href: '/iot/v1/things/6b6cd076-5859-4a6d-9b4e-18879893c6cb/properties/b357a513-ad2b-4e1f-a76b-6dac078e36d5',
    id: 'b357a513-ad2b-4e1f-a76b-6dac078e36d5',
    name: 'BPM',
    permission: 'READ_ONLY',
    thing_id: '6b6cd076-5859-4a6d-9b4e-18879893c6cb',
    type: 'HEART_BEATS',
    update_strategy: 'ON_CHANGE',
    created_at: 2023-03-31T16:41:33.103Z,
    last_value: 50,
    persist: true,
    tag: 1,
    thing_name: 'Tracking and notifying Your Heart Rate',
    update_parameter: 0,
    updated_at: 2023-03-31T17:05:19.564Z,
    value_updated_at: 2023-04-01T16:43:12.293Z,
    variable_name: 'bPM'
  }
]</span></pre> <p><span class="koboSpan" id="kobo.1066.1">The preceding response contains all the values related to the cloud variable, such as last value, updated time, and so on. </span><span class="koboSpan" id="kobo.1066.2">If you want to fetch the last value of a cloud variable then this method could be used in your application to </span><span class="No-Break"><span class="koboSpan" id="kobo.1067.1">do so.</span></span></p>
<p><span class="koboSpan" id="kobo.1068.1">Next, we have another API endpoint related to showing the properties of a single cloud variable. </span><span class="koboSpan" id="kobo.1068.2">The code is available in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1069.1">property</span></strong><span class="koboSpan" id="kobo.1070.1"> folder, and the execution of the code along with checking out how it works is left to you as </span><span class="No-Break"><span class="koboSpan" id="kobo.1071.1">an exercise.</span></span></p>
<p><span class="koboSpan" id="kobo.1072.1">In this section, we discussed</span><a id="_idIndexMarker703"/><span class="koboSpan" id="kobo.1073.1"> in depth how to get the complete details of a cloud variable/property in JSON format using the Arduino IoT Cloud API, which provides lot of data including </span><strong class="source-inline"><span class="koboSpan" id="kobo.1074.1">last_value</span></strong><span class="koboSpan" id="kobo.1075.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1076.1">value_update_at</span></strong><span class="koboSpan" id="kobo.1077.1">. </span><span class="koboSpan" id="kobo.1077.2">In the next section, we will start working with dashboards and learn how to perform operations on them using the </span><span class="No-Break"><span class="koboSpan" id="kobo.1078.1">Node.js SDK.</span></span></p>
<h1 id="_idParaDest-185"><a id="_idTextAnchor185"/><span class="koboSpan" id="kobo.1079.1">Crafting dashboards – unleashing potential via the 
Node.js SDK</span></h1>
<p><span class="koboSpan" id="kobo.1080.1">Dashboards</span><a id="_idIndexMarker704"/><span class="koboSpan" id="kobo.1081.1"> are the most important ingredient</span><a id="_idIndexMarker705"/><span class="koboSpan" id="kobo.1082.1"> in the Arduino IoT Cloud pertaining to </span><strong class="bold"><span class="koboSpan" id="kobo.1083.1">data visualization</span></strong><span class="koboSpan" id="kobo.1084.1">. </span><span class="koboSpan" id="kobo.1084.2">In the SDK, we have dashboard-specific methods to perform CRUD operations on dashboards, as well as other operations such as sharing, requesting access, and so on, but here we will only focus on the </span><span class="No-Break"><span class="koboSpan" id="kobo.1085.1">CRUD operations.</span></span></p>
<h2 id="_idParaDest-186"><a id="_idTextAnchor186"/><span class="koboSpan" id="kobo.1086.1">Creating a dashboard</span></h2>
<p><span class="koboSpan" id="kobo.1087.1">Let’s start first with</span><a id="_idIndexMarker706"/><span class="koboSpan" id="kobo.1088.1"> dashboard creation. </span><span class="koboSpan" id="kobo.1088.2">The relevant documentation can be found at </span><a href="https://www.arduino.cc/reference/en/iot/api/#api-DashboardsV2-dashboardsV2Create"><span class="koboSpan" id="kobo.1089.1">https://www.arduino.cc/reference/en/iot/api/#api-DashboardsV2-dashboardsV2Create</span></a><span class="koboSpan" id="kobo.1090.1">. </span><span class="koboSpan" id="kobo.1090.2">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1091.1">create-dashboard.js</span></strong><span class="koboSpan" id="kobo.1092.1"> file under the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1093.1">dashboard</span></strong><span class="koboSpan" id="kobo.1094.1"> folder </span><span class="No-Break"><span class="koboSpan" id="kobo.1095.1">in VSCode.</span></span></p>
<p><span class="koboSpan" id="kobo.1096.1">There are two methods in this code: one is </span><strong class="source-inline"><span class="koboSpan" id="kobo.1097.1">getToken()</span></strong><span class="koboSpan" id="kobo.1098.1">, which is the same method as in all our coding exercises to fetch the authentication token for our requests. </span><span class="koboSpan" id="kobo.1098.2">The second method is </span><strong class="source-inline"><span class="koboSpan" id="kobo.1099.1">CreateDashboard()</span></strong><span class="koboSpan" id="kobo.1100.1">, which is responsible for dashboard creation. </span><span class="koboSpan" id="kobo.1100.2">Referring to the documentation, we can see we need to initiate the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1101.1">api</span></strong><span class="koboSpan" id="kobo.1102.1"> variable with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1103.1">AiotApi.DashboardV2Api()</span></strong><span class="koboSpan" id="kobo.1104.1"> object, which is used to perform operations on </span><span class="No-Break"><span class="koboSpan" id="kobo.1105.1">dashboard objects:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1106.1">
var api = new AiotApi.DashboardsV2Api();
    var dashboardprop = {
        'name':'Dashboard Created via API'
    };
    var opts = { };
    api.dashboardsV2Create(dashboardprop,opts).then(function(data) {
        console.log('Dashboard Created successfully. </span><span class="koboSpan" id="kobo.1106.2">Returned data: ' + util.inspect(data));
        }, function(error) {
        console.error(error);
    });</span></pre> <p><strong class="source-inline"><span class="koboSpan" id="kobo.1107.1">api.dashboardsV2Create</span></strong><span class="koboSpan" id="kobo.1108.1"> is the method responsible for dashboard creation and takes two parameters</span><a id="_idIndexMarker707"/><span class="koboSpan" id="kobo.1109.1"> as input: the first is the dashboard properties and the second variable is </span><strong class="source-inline"><span class="koboSpan" id="kobo.1110.1">opts</span></strong><span class="koboSpan" id="kobo.1111.1">, which is not mandatory, hence I leave it empty. </span><span class="koboSpan" id="kobo.1111.2">Both variables are passed to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1112.1">api.dashboardsV2Create</span></strong><span class="koboSpan" id="kobo.1113.1"> method, which returns the response. </span><span class="koboSpan" id="kobo.1113.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1114.1">util.inspect</span></strong><span class="koboSpan" id="kobo.1115.1"> method is used to display the JSON response on the console with proper formatting. </span><span class="koboSpan" id="kobo.1115.2">Type the following command to execute the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1116.1">create-dashboard.js</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1117.1"> script:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1118.1">
node create-dashboard.js</span></pre> <p><span class="koboSpan" id="kobo.1119.1">After successful execution of the script, it will print a response like </span><span class="No-Break"><span class="koboSpan" id="kobo.1120.1">the following:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1121.1">
Dashboard Created successfully. </span><span class="koboSpan" id="kobo.1121.2">Returned data: ArduinoDashboardv2 {
  id: '5b872702-059c-4895-a677-808981f31588',
  name: 'Dashboard Created via API',
  updated_at: 2023-04-19T17:31:39.487Z,
  created_by: ArduinoDashboardowner {
    user_id: 'f067c1e9-3ff8-4b9f-a9b4-f8c5c1d0ceb4',
    username: 'mafzalattari'
  }
}</span></pre> <p><span class="koboSpan" id="kobo.1122.1">In the response you will get your dashboard ID, creation date, update date, and other things we already covered </span><a id="_idIndexMarker708"/><span class="koboSpan" id="kobo.1123.1">during </span><span class="No-Break"><span class="koboSpan" id="kobo.1124.1">dashboard creation.</span></span></p>
<h2 id="_idParaDest-187"><a id="_idTextAnchor187"/><span class="koboSpan" id="kobo.1125.1">Updating a dashboard</span></h2>
<p><span class="koboSpan" id="kobo.1126.1">In this section, we are going</span><a id="_idIndexMarker709"/><span class="koboSpan" id="kobo.1127.1"> to explore how to update a dashboard using the dashboard ID. </span><span class="koboSpan" id="kobo.1127.2">There is an option to add widgets to a dashboard via an API but it will make the code significantly more complex due to the JSON data involved. </span><span class="koboSpan" id="kobo.1127.3">For this reason, we will just update the dashboard name instead of adding widgets. </span><span class="koboSpan" id="kobo.1127.4">The documentation for updating properties is available at </span><a href="https://www.arduino.cc/reference/en/iot/api/#api-DashboardsV2-dashboardsV2Update"><span class="koboSpan" id="kobo.1128.1">https://www.arduino.cc/reference/en/iot/api/#api-DashboardsV2-dashboardsV2Update</span></a><span class="koboSpan" id="kobo.1129.1">. </span><span class="koboSpan" id="kobo.1129.2">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1130.1">update-dashboard.js</span></strong><span class="koboSpan" id="kobo.1131.1"> file under the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1132.1">dashboard</span></strong><span class="koboSpan" id="kobo.1133.1"> folder </span><span class="No-Break"><span class="koboSpan" id="kobo.1134.1">in VSCode:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1135.1">
  var api = new AiotApi.DashboardsV2Api()
    var dashboard_id="5b872702-059c-4895-a677-808981f31588";
    var dashboardprop = {
        'name':'Dashboard Created via API Update'
    };
    var opts = {
    };
    api.dashboardsV2Update(dashboard_id,dashboardprop, opts).then(function(data) {
      console.log('Dashboard Updated successfully.'+ util.inspect(data));
    }, function(error) {
      console.error(error);
    });</span></pre> <p><span class="koboSpan" id="kobo.1136.1">The preceding code is almost</span><a id="_idIndexMarker710"/><span class="koboSpan" id="kobo.1137.1"> the same as the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1138.1">create-dashboard</span></strong><span class="koboSpan" id="kobo.1139.1"> code. </span><span class="koboSpan" id="kobo.1139.2">Here we have one extra variable, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1140.1">dashboard_id</span></strong><span class="koboSpan" id="kobo.1141.1">, used to update the specific dashboard. </span><span class="koboSpan" id="kobo.1141.2">Besides that, we have the same dashboard properties with their updated content. </span><span class="koboSpan" id="kobo.1141.3">Lastly, we call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1142.1">api.dashboardsV2Update()</span></strong><span class="koboSpan" id="kobo.1143.1"> method. </span><span class="koboSpan" id="kobo.1143.2">Execute the following command in </span><span class="No-Break"><span class="koboSpan" id="kobo.1144.1">the Terminal:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1145.1">
node update-dashboard.js</span></pre> <p><span class="koboSpan" id="kobo.1146.1">After successful execution of the script, it will print a response like </span><span class="No-Break"><span class="koboSpan" id="kobo.1147.1">the following:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1148.1">
Dashboard Updated successfully.ArduinoDashboardv2 {
  id: '5b872702-059c-4895-a677-808981f31588',
  name: 'Dashboard Created via API Update',
  updated_at: 2023-04-19T17:39:28.378Z,
  created_by: ArduinoDashboardowner {
    user_id: 'f067c1e9-3ff8-4b9f-a9b4-f8c5c1d0ceb4',
    username: 'mafzalattari'
  }
}</span></pre> <p><span class="koboSpan" id="kobo.1149.1">After our update, the response</span><a id="_idIndexMarker711"/><span class="koboSpan" id="kobo.1150.1"> will return the new content, reflecting the updated data for the name that </span><span class="No-Break"><span class="koboSpan" id="kobo.1151.1">we provided.</span></span></p>
<h2 id="_idParaDest-188"><a id="_idTextAnchor188"/><span class="koboSpan" id="kobo.1152.1">Deleting a dashboard</span></h2>
<p><span class="koboSpan" id="kobo.1153.1">In this section, we are going</span><a id="_idIndexMarker712"/><span class="koboSpan" id="kobo.1154.1"> to explore how to delete a dashboard using the dashboard ID. </span><span class="koboSpan" id="kobo.1154.2">The relevant documentation on deleting dashboards is available at </span><a href="https://www.arduino.cc/reference/en/iot/api/#api-DashboardsV2-dashboardsV2Delete"><span class="koboSpan" id="kobo.1155.1">https://www.arduino.cc/reference/en/iot/api/#api-DashboardsV2-dashboardsV2Delete</span></a><span class="koboSpan" id="kobo.1156.1">. </span><span class="koboSpan" id="kobo.1156.2">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1157.1">delete-dashboard.js</span></strong><span class="koboSpan" id="kobo.1158.1"> file under the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1159.1">dashboard</span></strong><span class="koboSpan" id="kobo.1160.1"> folder </span><span class="No-Break"><span class="koboSpan" id="kobo.1161.1">in VSCode:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1162.1">
    var api = new AiotApi.DashboardsV2Api()
    var dashboard_id="3681cdbe-ecb2-4237-a834-e3423c6bd8e3";
    var opts = {
    };
    api.dashboardsV2Delete(dashboard_id, opts).then(function(data) {
      console.log('Dashboard Deleted successfully.');
    }, function(error) {
      console.error(error);
    });</span></pre> <p><span class="koboSpan" id="kobo.1163.1">The preceding code snippet is taken from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1164.1">DeleteDashboard()</span></strong><span class="koboSpan" id="kobo.1165.1"> method from </span><strong class="source-inline"><span class="koboSpan" id="kobo.1166.1">delete-dashboard.js</span></strong><span class="koboSpan" id="kobo.1167.1"> file. </span><span class="koboSpan" id="kobo.1167.2">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1168.1">DeleteDashboard()</span></strong><span class="koboSpan" id="kobo.1169.1"> method we need to supply the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1170.1">dashboard_id</span></strong><span class="koboSpan" id="kobo.1171.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1172.1">opts</span></strong><span class="koboSpan" id="kobo.1173.1"> variables as parameters. </span><strong class="source-inline"><span class="koboSpan" id="kobo.1174.1">dashboard_id</span></strong><span class="koboSpan" id="kobo.1175.1"> is mandatory for the deletion process, while the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1176.1">opts</span></strong><span class="koboSpan" id="kobo.1177.1"> variable is optional. </span><span class="koboSpan" id="kobo.1177.2">Execute the following command in </span><span class="No-Break"><span class="koboSpan" id="kobo.1178.1">the Terminal:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1179.1">
node delete-dashboard.js</span></pre> <p><span class="koboSpan" id="kobo.1180.1">After successful execution of the script, it will print the response on the console indicating that the dashboard </span><a id="_idIndexMarker713"/><span class="koboSpan" id="kobo.1181.1">was </span><span class="No-Break"><span class="koboSpan" id="kobo.1182.1">deleted successfully.</span></span></p>
<h2 id="_idParaDest-189"><a id="_idTextAnchor189"/><span class="koboSpan" id="kobo.1183.1">Listing dashboards</span></h2>
<p><span class="koboSpan" id="kobo.1184.1">In this section, we will list all the dashboards</span><a id="_idIndexMarker714"/><span class="koboSpan" id="kobo.1185.1"> with complete details and widgets. </span><span class="koboSpan" id="kobo.1185.2">The difference between listing dashboards and showing a dashboard is that listing dashboards will display all the dashboards available in the Arduino IoT Cloud, while showing a dashboard only shows the specific dashboard properties and widgets related to the given </span><span class="No-Break"><span class="koboSpan" id="kobo.1186.1">dashboard ID.</span></span></p>
<p><span class="koboSpan" id="kobo.1187.1">The documentation for listing dashboards is available at </span><a href="https://www.arduino.cc/reference/en/iot/api/#api-DashboardsV2-dashboardsV2List"><span class="koboSpan" id="kobo.1188.1">https://www.arduino.cc/reference/en/iot/api/#api-DashboardsV2-dashboardsV2List</span></a><span class="koboSpan" id="kobo.1189.1">. </span><span class="koboSpan" id="kobo.1189.2">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.1190.1">list-dashboard.js</span></strong><span class="koboSpan" id="kobo.1191.1"> under the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1192.1">dashboard</span></strong><span class="koboSpan" id="kobo.1193.1"> folder in VSCode. </span><span class="koboSpan" id="kobo.1193.2">The following code snippet is taken from the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1194.1">ListDashboard()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1195.1"> method:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1196.1">
    var api = new AiotApi.DashboardsV2Api()
    var opts = { };
    api.dashboardsV2List().then(function(data) {
      console.log(util.inspect(data));
    }, function(error) {
      console.error(error);
    });</span></pre> <p><span class="koboSpan" id="kobo.1197.1"> Execute the following command in </span><span class="No-Break"><span class="koboSpan" id="kobo.1198.1">the Terminal:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1199.1">
node list-dashboard.js</span></pre> <p><span class="koboSpan" id="kobo.1200.1">After successful execution</span><a id="_idIndexMarker715"/><span class="koboSpan" id="kobo.1201.1"> of the script, it will print the response in JSON format containing the dashboard properties </span><span class="No-Break"><span class="koboSpan" id="kobo.1202.1">and widgets:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1203.1">
[
  ArduinoDashboardv2 {
    id: '36287c03-5034-4a64-b40a-102740c998c6',
    name: 'SmartAgri-Sargodha',
    updated_at: 2023-03-05T11:00:18.395Z,
    created_by: ArduinoDashboardowner {
      user_id: 'f067c1e9-3ff8-4b9f-a9b4-f8c5c1d0ceb4',
      username: 'mafzalattari'
    },
    widgets: [
    ]
  },
  ArduinoDashboardv2 {
    id: '28ea7839-7a81-460e-a871-368d45d82cee',
    name: 'Tracking and notifying Your Heart Rate Dashboard',
    updated_at: 2023-04-19T16:41:36.604Z,
    created_by: ArduinoDashboardowner {
      user_id: 'f067c1e9-3ff8-4b9f-a9b4-f8c5c1d0ceb4',
      username: 'mafzalattari'
    },
    widgets: [ [ArduinoWidgetv2], [ArduinoWidgetv2] ]
  },
]</span></pre> <p><span class="koboSpan" id="kobo.1204.1">The preceding response contains all the properties related to dashboards such as widgets, creation date, update time, and so on. </span><span class="koboSpan" id="kobo.1204.2">Next, we have another API endpoint related to showing a dashboard, which is used to display all the information regarding a single dashboard. </span><span class="koboSpan" id="kobo.1204.3">The code is available in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1205.1">dashboard</span></strong><span class="koboSpan" id="kobo.1206.1"> folder; the execution of the code and checking out how it works is left to you as an </span><span class="No-Break"><span class="koboSpan" id="kobo.1207.1">independent exercise.</span></span></p>
<p><span class="koboSpan" id="kobo.1208.1">In these sub-sections, we discussed how to work programmatically with dashboards, including actions such</span><a id="_idIndexMarker716"/><span class="koboSpan" id="kobo.1209.1"> as dashboard creation, updating, deletion, and showing the list of dashboards via the Arduino IoT Cloud Node.js SDK. </span><span class="koboSpan" id="kobo.1209.2">In the next section, we will explore how we can use the Node.js SDK to fine-tune our </span><span class="No-Break"><span class="koboSpan" id="kobo.1210.1">cloud variables/properties.</span></span></p>
<h1 id="_idParaDest-190"><a id="_idTextAnchor190"/><span class="koboSpan" id="kobo.1211.1">Fine-tuning with the Node.js SDK – property value management</span></h1>
<p><span class="koboSpan" id="kobo.1212.1">In this section, we will look at how we can </span><em class="italic"><span class="koboSpan" id="kobo.1213.1">set</span></em><span class="koboSpan" id="kobo.1214.1">/</span><em class="italic"><span class="koboSpan" id="kobo.1215.1">get</span></em><span class="koboSpan" id="kobo.1216.1"> cloud variable values using the SDK. </span><span class="koboSpan" id="kobo.1216.2">This is very useful for</span><a id="_idIndexMarker717"/><span class="koboSpan" id="kobo.1217.1"> performing bulk operations; for example, if you have 100 lights connected to the Arduino IoT Cloud, it will be difficult to control them all manually from a dashboard. </span><span class="koboSpan" id="kobo.1217.2">Suppose switching one device on/off takes 3 seconds from the dashboard – with 100 devices this will require 300 seconds, a total of 5 minutes, along with the chance of human error (maybe the user misses one device due to bulk processing). </span><span class="koboSpan" id="kobo.1217.3">But with the help of the SDK, we can perform bulk operations on Things, saving time and improving confidence in our ability to reach </span><span class="No-Break"><span class="koboSpan" id="kobo.1218.1">zero-error operations.</span></span></p>
<h2 id="_idParaDest-191"><a id="_idTextAnchor191"/><span class="koboSpan" id="kobo.1219.1">Get a property value</span></h2>
<p><span class="koboSpan" id="kobo.1220.1">Let’s first see how</span><a id="_idIndexMarker718"/><span class="koboSpan" id="kobo.1221.1"> to get the last value of the cloud variable. </span><span class="koboSpan" id="kobo.1221.2">To do this, we need the Thing ID and cloud variable ID. </span><span class="koboSpan" id="kobo.1221.3">More precisely, we will get the complete properties of the cloud variable in JSON format here, but will only fetch </span><strong class="source-inline"><span class="koboSpan" id="kobo.1222.1">last_value</span></strong><span class="koboSpan" id="kobo.1223.1"> of the cloud variable. </span><span class="koboSpan" id="kobo.1223.2">The relevant documentation can be found at </span><a href="https://www.arduino.cc/reference/en/iot/api/#api-PropertiesV2-propertiesV2Show."><span class="koboSpan" id="kobo.1224.1">https://www.arduino.cc/reference/en/iot/api/#api-PropertiesV2-propertiesV2Show.</span></a><span class="koboSpan" id="kobo.1225.1"> Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1226.1">get-prop.js</span></strong><span class="koboSpan" id="kobo.1227.1"> file under</span><a id="_idIndexMarker719"/><span class="koboSpan" id="kobo.1228.1"> the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1229.1">getset</span></strong><span class="koboSpan" id="kobo.1230.1"> folder </span><span class="No-Break"><span class="koboSpan" id="kobo.1231.1">in VSCode:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1232.1">
var api = new IotApi.PropertiesV2Api()
    var thingid = "8aee742e-4492-423d-9f19-79fec856b917"; // {String} The id of the thing
    var propertyid = "182d7319-5c36-4988-a5b8-ace2df7bd08a"; // {String} The id of the property
    var opts = {
    'showDeleted': false // {Boolean} If true, shows the soft deleted properties
    };
    api.propertiesV2Show(thingid, propertyid, opts).then(function(data) {
    console.log('Last Value of Property=' + data.last_value);
    }, function(error) {
    console.error(error);
    });</span></pre> <p><span class="koboSpan" id="kobo.1233.1">The preceding code snippet was taken from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1234.1">GetProperty()</span></strong><span class="koboSpan" id="kobo.1235.1"> method. </span><span class="koboSpan" id="kobo.1235.2">We have defined </span><strong class="source-inline"><span class="koboSpan" id="kobo.1236.1">thingid</span></strong><span class="koboSpan" id="kobo.1237.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1238.1">propertyid</span></strong><span class="koboSpan" id="kobo.1239.1"> and then passed these variables to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1240.1">api.propertiesV2Show</span></strong><span class="koboSpan" id="kobo.1241.1"> method later in the snippet. </span><span class="koboSpan" id="kobo.1241.2">After getting the response in JSON format, we only use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1242.1">last_value</span></strong><span class="koboSpan" id="kobo.1243.1"> property to display its data on the console. </span><span class="koboSpan" id="kobo.1243.2">Run the following command on </span><span class="No-Break"><span class="koboSpan" id="kobo.1244.1">the Terminal:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1245.1">
node get-prop.js</span></pre> <p><span class="koboSpan" id="kobo.1246.1">After successful </span><a id="_idIndexMarker720"/><span class="koboSpan" id="kobo.1247.1">execution, you will get the response with </span><span class="No-Break"><span class="koboSpan" id="kobo.1248.1">the value.</span></span></p>
<h2 id="_idParaDest-192"><a id="_idTextAnchor192"/><span class="koboSpan" id="kobo.1249.1">Set a property value</span></h2>
<p><span class="koboSpan" id="kobo.1250.1">In the previous section, we discussed</span><a id="_idIndexMarker721"/><span class="koboSpan" id="kobo.1251.1"> how to get the last value of a cloud variable, and in this section, we will explore how to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1252.1">set</span></strong><span class="koboSpan" id="kobo.1253.1">/</span><strong class="source-inline"><span class="koboSpan" id="kobo.1254.1">publish</span></strong><span class="koboSpan" id="kobo.1255.1"> the value to a cloud variable. </span><span class="koboSpan" id="kobo.1255.2">The relevant documentation can be found at </span><a href="https://www.arduino.cc/reference/en/iot/api/#api-PropertiesV2-propertiesV2Publish"><span class="koboSpan" id="kobo.1256.1">https://www.arduino.cc/reference/en/iot/api/#api-PropertiesV2-propertiesV2Publish</span></a><span class="koboSpan" id="kobo.1257.1">. </span><span class="koboSpan" id="kobo.1257.2">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1258.1">set-prop.js</span></strong><span class="koboSpan" id="kobo.1259.1"> file under the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1260.1">getset</span></strong><span class="koboSpan" id="kobo.1261.1"> folder </span><span class="No-Break"><span class="koboSpan" id="kobo.1262.1">in VSCode:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1263.1">
var api = new IotApi.PropertiesV2Api()
    var thingid = "8aee742e-4492-423d-9f19-79fec856b917"; // {String} The id of the thing
    var propertyid = "182d7319-5c36-4988-a5b8-ace2df7bd08a"; // {String} The id of the property
    var propertyValue = {
        'device_id':'5aae7e1f-940b-4426-80ac-1c953839cdb2',
        'value':true
    }; // {PropertyValue}
    api.propertiesV2Publish(thingid, propertyid, propertyValue).then(function(data) {
    console.log('Value Published to Property Successfully');
    }, function(error) {
    console.error(error);
    });</span></pre> <p><span class="koboSpan" id="kobo.1264.1">The preceding code snippet was taken from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1265.1">SetProperty()</span></strong><span class="koboSpan" id="kobo.1266.1"> method. </span><span class="koboSpan" id="kobo.1266.2">Here, we provide three variables to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1267.1">api.propertiesV2Publish</span></strong><span class="koboSpan" id="kobo.1268.1"> method. </span><span class="koboSpan" id="kobo.1268.2">The first is </span><strong class="source-inline"><span class="koboSpan" id="kobo.1269.1">thingid</span></strong><span class="koboSpan" id="kobo.1270.1">, the second is </span><strong class="source-inline"><span class="koboSpan" id="kobo.1271.1">propertyid</span></strong><span class="koboSpan" id="kobo.1272.1">, and the third variable contains the two further properties of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1273.1">device_id</span></strong><span class="koboSpan" id="kobo.1274.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1275.1">value</span></strong><span class="koboSpan" id="kobo.1276.1">. </span><span class="koboSpan" id="kobo.1276.2">Run the following command on the Terminal to execute </span><span class="No-Break"><span class="koboSpan" id="kobo.1277.1">the script:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1278.1">
node set-prop.js</span></pre> <p><span class="koboSpan" id="kobo.1279.1">After successful execution, you will get a response indicating that the value has been </span><span class="No-Break"><span class="koboSpan" id="kobo.1280.1">updated successfully.</span></span></p>
<p><span class="koboSpan" id="kobo.1281.1">In the section, we discussed</span><a id="_idIndexMarker722"/><span class="koboSpan" id="kobo.1282.1"> in detail how to get/set the value of a cloud variable programmatically. </span><span class="koboSpan" id="kobo.1282.2">This helps developers to fetch values and display them in their custom dashboards, or set the values of cloud variables to control device operations. </span><span class="koboSpan" id="kobo.1282.3">Next, you have an assignment of an example project for practice, which will help you to refine your skills and </span><span class="No-Break"><span class="koboSpan" id="kobo.1283.1">chapter study.</span></span></p>
<h1 id="_idParaDest-193"><a id="_idTextAnchor193"/><span class="koboSpan" id="kobo.1284.1">Assignment</span></h1>
<p><span class="koboSpan" id="kobo.1285.1">After playing with SDK, it’s now time to do some more experiments so you can apply your learning in new scenarios and solidify your learning. </span><span class="koboSpan" id="kobo.1285.2">For this assignment, you will create a script for Thing automation with the </span><span class="No-Break"><span class="koboSpan" id="kobo.1286.1">following properties:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1287.1">Set up a method for </span><strong class="bold"><span class="koboSpan" id="kobo.1288.1">WeMos D1 Mini</span></strong><span class="koboSpan" id="kobo.1289.1"> device creation. </span><span class="koboSpan" id="kobo.1289.2">This device belongs to the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1290.1">ESP8266</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1291.1"> category.</span></span></li>
<li><span class="koboSpan" id="kobo.1292.1">Set up a Thing named </span><strong class="source-inline"><span class="koboSpan" id="kobo.1293.1">Sense Environment</span></strong><span class="koboSpan" id="kobo.1294.1"> and create a sketch for a Thing. </span><span class="koboSpan" id="kobo.1294.2">Then, associate the previously created device with </span><span class="No-Break"><span class="koboSpan" id="kobo.1295.1">the Thing.</span></span></li>
<li><span class="koboSpan" id="kobo.1296.1">Create three cloud variables/properties for temperature, humidity, and air quality and attach these variables to the previously </span><span class="No-Break"><span class="koboSpan" id="kobo.1297.1">created Thing.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.1298.1">Create the required script in one file containing all the methods, where we just provide the Thing name and it will automatically set up the device, Thing, and sketch, handle device association with the Thing, and take care of variable creation. </span><span class="koboSpan" id="kobo.1298.2">Successfully completing this task will teach you to automate workflows and processes efficiently </span><span class="No-Break"><span class="koboSpan" id="kobo.1299.1">and effectively.</span></span></p>
<h1 id="_idParaDest-194"><a id="_idTextAnchor194"/><span class="koboSpan" id="kobo.1300.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.1301.1">In this chapter, we covered API endpoints, SDKs, and the types of SDK platforms available to us on the Arduino IoT Cloud. </span><span class="koboSpan" id="kobo.1301.2">We also learned how to test APIs with Postman. </span><span class="koboSpan" id="kobo.1301.3">Next, we explored the Node.js SDK by performing different types of operations, particularly CRUD operations, on devices, Things, properties, and dashboards. </span><span class="koboSpan" id="kobo.1301.4">Finally, we saw how to get and set the value of a </span><span class="No-Break"><span class="koboSpan" id="kobo.1302.1">cloud variable.</span></span></p>
<p><span class="koboSpan" id="kobo.1303.1">This chapter was specially designed for backend developers seeking to use the Arduino IoT Cloud as a foundation and wanting to develop a custom frontend for their solution, which is possible when you know how to interact with the Arduino IoT Cloud programmatically using the Node.js SDK. </span><span class="koboSpan" id="kobo.1303.2">Likewise, the ability to create custom services allows us to integrate with third party cloud services </span><span class="No-Break"><span class="koboSpan" id="kobo.1304.1">and applications.</span></span></p>
<p><span class="koboSpan" id="kobo.1305.1">The next chapter will be more interesting as we are going to dive into smart agriculture, implementation a project where you will learn how to measure the soil moisture, soil temperature, and outdoor temperature and humidity. </span><span class="koboSpan" id="kobo.1305.2">We will design a device that will allow us to monitor four different crops/plants. </span><span class="koboSpan" id="kobo.1305.3">You could use this project to monitor your home plants as well as helping your friends working in the field </span><span class="No-Break"><span class="koboSpan" id="kobo.1306.1">of agriculture.</span></span></p>
</div>
</body></html>