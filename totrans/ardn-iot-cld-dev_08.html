<html><head></head><body>
<div><h1 class="chapter-number" id="_idParaDest-158"><a id="_idTextAnchor158"/>8</h1>
<h1 id="_idParaDest-159"><a id="_idTextAnchor159"/>Working with the Arduino IoT Cloud SDK and JavaScript</h1>
<p>Every platform provides <strong class="bold">APIs</strong> and <strong class="bold">SDKs</strong> to make their product compatible with other platforms, and these endpoints are used by developers to create new functionalities to solve real-world issues. Likewise, the <strong class="bold">Arduino IoT Cloud</strong> comes with its own built-in features and functionalities, but there are also three different ways to extend the Arduino IoT Cloud platform’s functionality or make it compatible with other tools and services: namely, <strong class="bold">REST APIs</strong>, <strong class="bold">SDKs</strong>, and <strong class="bold">webhooks</strong>.</p>
<p>In this chapter, we will talk about APIs and SDKs and how they work. Specifically, we will use the <strong class="bold">Node.js SDK</strong> to illustrate different coding exercises. This chapter will cover <strong class="bold">Create, Read, Update, and Delete</strong> (<strong class="bold">CRUD</strong>) operations for devices, Things, properties (aka variables), and dashboards. Beyond that, we will explore some other features such as how to set/get values of properties.</p>
<p>By the end of this chapter, you will understand how to interact with the Arduino IoT Cloud platform via an API or the Node.js SDK to create custom dashboards, interface with the data using other tools/apps, and use the SDK for bulk device creation and management.</p>
<p>In this chapter, we’re going to cover the following main topics:</p>
<ul>
<li>Demystifying the Arduino IoT Cloud SDK – functionality and operation</li>
<li>Securing access – unveiling API keys and authentication</li>
<li>Step-by-step – installing the Arduino Node.js SDK client</li>
<li>Initial exploration – test drive using Postman</li>
<li>Diverse platform compatibility – SDKs for various environments</li>
<li>Interacting with devices – hands-on with the Node.js SDK</li>
<li>Engaging with Things – Node.js SDK implementation guide</li>
<li>Exploring properties – Node.js SDK interaction techniques</li>
<li>Crafting dashboards – unleashing potential via the Node.js SDK</li>
<li>Fine-tuning with the Node.js SDK – property value management</li>
</ul>
<h1 id="_idParaDest-160"><a id="_idTextAnchor160"/>Technical requirements</h1>
<p>There are no specific hardware requirements for this chapter as we are focusing on the SDK and will work through different coding exercises to perform different operations on the Arduino IoT Cloud platform using the Node.js SDK. To follow along with the coding and testing exercises, the following software is required:</p>
<ul>
<li>Node.js</li>
<li>The <strong class="bold">Node.js Arduino IoT Cloud </strong><strong class="bold">module</strong> installed</li>
<li>The <strong class="bold">VSCode editor</strong></li>
<li><strong class="bold">Postman</strong></li>
<li>An Arduino IoT Cloud account</li>
</ul>
<p>Postman will be used for <strong class="bold">cURL testing</strong> and authentication, which will help other developers when doing request and response testing. For SDK coding, we will use Node.js and the VSCode editor. The code for this chapter is available from the book’s official GitHub repository at <a href="https://github.com/PacktPublishing/Arduino-IoT-Cloud-for-Developers">https://github.com/PacktPublishing/Arduino-IoT-Cloud-for-Developers</a>.</p>
<h1 id="_idParaDest-161"><a id="_idTextAnchor161"/>Demystifying the Arduino IoT Cloud SDK – functionality and operation</h1>
<p>The Arduino IoT Cloud<a id="_idIndexMarker605"/> offers a range of features, but there are inevitably situations where developers need to integrate their tools/systems/apps with the Arduino IoT Cloud for improved operations<a id="_idIndexMarker606"/> management and control. To cater to these requirements, the Arduino IoT Cloud provides different techniques and tools that can be used by developers and organizations<a id="_idIndexMarker607"/> to extend the product’s functionality and provide solutions for real-world issues.</p>
<p>As shown in the following diagram, the Arduino IoT Cloud provides three main interfaces<a id="_idIndexMarker608"/> to developers to help meet their requirements. First is webhooks, which we used in the previous chapter to send the data from an Arduino IoT Cloud Thing to a custom <strong class="bold">endpoint</strong> or any well-known platform including <strong class="bold">Zapier</strong> or <strong class="bold">IFTTT</strong> for further integration. Following webhooks, we have the REST API and SDK, both<a id="_idIndexMarker609"/> of which are very handy features for developers to mold<a id="_idIndexMarker610"/> the system according to their requirements.</p>
<div><div><img alt="Figure 8.1 – Arduino IoT Cloud interface" src="img/B19752_08_01.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.1 – Arduino IoT Cloud interface</p>
<p>In this chapter, we are going<a id="_idIndexMarker611"/> to focus specifically on the Node.js SDK. However, it’s important first to give a proper overview of the Arduino IoT Cloud functionalities that can help developers make better decisions during integration with other platforms. The Arduino team has created REST API endpoints for different operations<a id="_idIndexMarker612"/> such as <em class="italic">create</em>, <em class="italic">delete</em>, <em class="italic">list</em>, <em class="italic">update</em>, and so on, and placed them into different categories according to the main terms used on the Arduino IoT Cloud platform, such as Thing, device, property, and so on. The developer can send a request to these endpoints via different methods such as <code>PUT</code>, <code>DELETE</code>, or <code>GET</code> with different parameters, and in return they will get their desired response from the Arduino IoT Cloud in JSON format that they can then use for further product development.</p>
<p>REST APIs are like raw material for developers in that they need to process them by writing code in their preferred language<a id="_idIndexMarker613"/> and sending and receiving requests and responses using the <strong class="bold">cURL library</strong>. On the other hand, the Arduino team offers an SDK, which is basically a programming wrapper for REST API endpoints. This allows us to save time as we get access to a lot of methods and sample code to accomplish our tasks just using library methods. At the time of writing, the Arduino team has developed SDKs for three programming platforms: Node.js, <strong class="bold">Python</strong>, and <strong class="bold">GoLang</strong>.</p>
<p>In this chapter, we will work with the Node.js SDK specifically to create different scripts to perform CRUD operations on Things, devices, properties, and dashboards. We will also develop scripts that allow you to <em class="italic">fetch</em>/<em class="italic">set</em> the latest values of Thing properties and much more. Overall, this chapter <a id="_idIndexMarker614"/>will be fun for developers, as we are going to explore different techniques and methods<a id="_idIndexMarker615"/> that will help us extend IoT operations from small scale to enterprise level.</p>
<p>In this section, we have discussed what type of features the Arduino IoT Cloud API/SDKs provide to developers. In the next section, we will talk about API keys for authentication.</p>
<h1 id="_idParaDest-162"><a id="_idTextAnchor162"/>Securing access – unveiling API keys and authentication</h1>
<p>Before heading into the meat of the chapter, we first need to talk about the authentication<a id="_idIndexMarker616"/> mechanism of the platform. The Arduino IoT Cloud uses a <code>requests</code>/<code>responses</code>.</p>
<p>Before we get started with the SDK installation and testing with Postman, we need to set up the API in the Arduino Cloud that will provide us the Client ID and Secret. In older versions of the interface, the API options are under the <strong class="bold">Integrations</strong> tab, but have now moved<a id="_idIndexMarker619"/> to the Arduino Cloud, which is available at <a href="https://cloud.arduino.cc/home/">https://cloud.arduino.cc/home/</a>.</p>
<p>After visiting the Integration page click on <strong class="bold">API Keys</strong> and you will be taken<a id="_idIndexMarker620"/> to the API page. Click on <strong class="bold">CREATE API KEY</strong>. A popup will appear; provide a name for the API and click on the <strong class="bold">CONTINUE</strong> button. The wizard that appears will take a few seconds to generate the keys and then a new popup will appear displaying<a id="_idIndexMarker621"/> the keys:</p>
<div><div><img alt="Figure 8.2 – API keys" src="img/B19752_08_02.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.2 – API keys</p>
<p>Copy the <strong class="bold">Client ID</strong> and <strong class="bold">Client Secret</strong> values by clicking on the copy icons – never try to copy by manual<a id="_idIndexMarker622"/> selection as the <strong class="bold">Client Secret</strong> is very long, so clicking the copy icon is the best option. Save the both Client ID and Client Secret in a secure location and then click the checkbox confirming that you have saved your keys. Lastly, click on <strong class="bold">DONE</strong> and you will see your API key in the panel – it’s now ready for use.</p>
<p class="callout-heading">Important note</p>
<p class="callout">A single API key is used to give access to all the Things and their variables. Having access to all infrastructure with just one API key is handy, instead of having to create separate API keys for each Thing, but you must take care of your key! This is a big security risk, as if you were to lose the key, a hacker could gain access to your whole account.</p>
<p>In this section, we have set up<a id="_idIndexMarker623"/> and created API authentication keys consisting<a id="_idIndexMarker624"/> of a Client ID and Client Secret. This section is most important, as without these keys we can’t use any APIs. In the next section, we are going to try our first API call using the Postman tool.</p>
<h1 id="_idParaDest-163"><a id="_idTextAnchor163"/>Initial exploration – test drive using Postman</h1>
<p>Before diving<a id="_idIndexMarker625"/> into the SDK, we will try the <strong class="bold">naked REST APIs</strong> endpoints using Postman, a tool that helps developers to debug <em class="italic">requests</em>/<em class="italic">responses</em> for other programming-language<a id="_idIndexMarker626"/> platforms not available as SDKs. Postman is a well-known tool among backend developers and is used to expose API requests/responses without any coding. Postman<a id="_idIndexMarker627"/> also helps developers to analyze responses via a <strong class="bold">graphical user </strong><strong class="bold">interface</strong> (<strong class="bold">GUI</strong>).</p>
<p>Download Postman from <a href="https://www.postman.com/">https://www.postman.com/</a>, choosing the correct version<a id="_idIndexMarker628"/> for your operating system. Before getting to work with Postman, firstly create a new workspace for the Arduino IoT Cloud to put all the requests<a id="_idIndexMarker629"/> in a separate group. To do this, click on <strong class="bold">Workspaces</strong> and then <strong class="bold">Create Workspace</strong>:</p>
<div><div><img alt="Figure 8.3 – Postman workspace" src="img/B19752_08_03.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.3 – Postman workspace</p>
<p>A new window will be opened: provide a workspace<a id="_idIndexMarker630"/> name and description and set the visibility policy according to your requirements. After creating the new workspace, navigate to <strong class="bold">File</strong> &gt; <strong class="bold">New…</strong> and select <strong class="bold">HTTP Request</strong>. Before sending<a id="_idIndexMarker631"/> any request to the Arduino IoT Cloud, an authentication token is mandatory. Refer to the following screenshot: click on the <strong class="bold">Authorization</strong> tab and select <strong class="bold">OAuth 2.0</strong> from the <strong class="bold">Type</strong> dropdown. Scroll down the <strong class="bold">Authorization</strong> page to find the <strong class="bold">Configure New Token</strong> section and click on the <strong class="bold">Configuration Options</strong> tab under this section.</p>
<div><div><img alt="Figure 8.4 – Authorization Configuration Options" src="img/B19752_08_04.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.4 – Authorization Configuration Options</p>
<p>We need to provide three things under <strong class="bold">Configuration Options</strong>. Firstly, add the <a href="https://api2.arduino.cc/iot/v1/clients/token">https://api2.arduino.cc/iot/v1/clients/token</a> URL to the <strong class="bold">Access Token URL</strong> field, then insert the values that we generated previously in the Arduino IoT Cloud API into the <strong class="bold">Client ID</strong> and <strong class="bold">Client Secret</strong> fields. Lastly, select <strong class="bold">Send client credentials in body</strong> from the <strong class="bold">Client Authentication</strong> dropdown. Now click on the <strong class="bold">Advanced Options</strong> tab, where we will set the API audience who will receive the requests.</p>
<p><em class="italic">Figure 8</em><em class="italic">.5</em> shows the <strong class="bold">Advanced Options</strong> where we need<a id="_idIndexMarker632"/> to provide the Arduino IoT Cloud authentication URL with which we can authenticate and authorize requests.</p>
<div><div><img alt="Figure 8.5 – Authorization Advanced Options" src="img/B19752_08_05.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.5 – Authorization Advanced Options</p>
<p>Add the <a href="https://api2.arduino.cc/iot">https://api2.arduino.cc/iot</a> URL into the <strong class="bold">Audience</strong> field. After setting up the configuration, click the <strong class="bold">Get new Access Token</strong> button. It will return either an error or a success message. If there is any error, then please repeat all the steps one by one, ensuring the configuration is as described previously. If you are successful, then click on <strong class="bold">Proceed</strong> and you will get your token for authentication.</p>
<p>After getting the authentication token, it’s time to do some experiments. The Arduino team has documented<a id="_idIndexMarker633"/> all the endpoints with cURL and the Node.js SDK samples in different categories, available at <a href="https://www.arduino.cc/reference/en/iot/api/">https://www.arduino.cc/reference/en/iot/api/</a>. So here, we want to see the list of cloud variables/properties for specific Thing. Open up the preceding API documentation URL, find the <code>https://api2.arduino.cc/iot/v2/things/{id}/properties?show_deleted=</code>. Here we need to replace <code>{id}</code> in the URL with the specific Thing ID (<em class="italic">Figure 8</em><em class="italic">.6</em>). The Thing ID is available under the Thing’s <code>true</code> to the end of the URL just after <code>show_deleted</code>. After adding all the required data to the URL, it will look something like <a href="https://api2.arduino.cc/iot/v2/things/8aee742e-4492-423d-9f19-79fec856b917/properties?show_deleted=true">https://api2.arduino.cc/iot/v2/things/8aee742e-4492-423d-9f19-79fec856b917/properties?show_deleted=true</a>.</p>
<p>Click on <strong class="bold">Send</strong> and you will receive<a id="_idIndexMarker634"/> a response from the Arduino IoT Cloud in JSON format containing all the cloud variables properties of the Thing, including the property ID, name, type, last value of the cloud variable, and so on:</p>
<div><div><img alt="Figure 8.6 – Postman request response" src="img/B19752_08_06.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.6 – Postman request response</p>
<p>The preceding screenshot shows the response in Postman. You can convert the response into plain text as well as other formats including <strong class="bold">XHTML</strong>, <strong class="bold">HTML</strong>, and so on, but Postman has excellent visualization functionality for <strong class="bold">JSON</strong> data responses. This way, developers can easily understand and tweak the nature of the response and prepare the scripts according to their data structure. It also helps developers to choose specific content from the response more quickly, reducing the time and effort required.</p>
<p>In this section, we used Postman to generate our first request to the Arduino IoT Cloud. We began by configuring<a id="_idIndexMarker635"/> the API authentication keys in Postman and then requested the list of cloud variables/properties of Thing. The Arduino IoT Cloud successfully returned the response with all the required data in JSON format. In the following section, we will examine the SDKs available for different platforms.</p>
<h1 id="_idParaDest-164"><a id="_idTextAnchor164"/>Diverse platform compatibility – SDKs for various environments</h1>
<p>After testing <em class="italic">request</em>/<em class="italic">response</em> with Postman, it’s time to explore the SDKs available for the Arduino<a id="_idIndexMarker636"/> IoT Cloud. Earlier I mentioned the Arduino Team has developed official SDKs for three programming platforms, Node.js, Python, and GoLang.</p>
<p>Node.js is a very well-known<a id="_idIndexMarker637"/> language among backend developers<a id="_idIndexMarker638"/> and is used by both web and mobile developers. So, if you are planning to create a mobile or web app for Arduino IoT Cloud automation with custom visualizations, then Node.js is the best language, providing a wide variety of libraries for HTTP services.</p>
<p>On the other hand, Python<a id="_idIndexMarker639"/> is also a very well-known and rapidly<a id="_idIndexMarker640"/> growing language among web, IoT, and <strong class="bold">AI</strong>/<strong class="bold">ML</strong> developers. Python seems to be trending toward AI/ML, and IoT is very close as a field to AI/ML. If you are planning to develop a solution focused on AI/ML, such as <strong class="bold">predictive maintenance</strong>, <strong class="bold">time series analysis</strong>, or predictions then the Python SDK is the best choice to interact with the Arduino IoT Cloud.</p>
<p>GoLang is the last platform<a id="_idIndexMarker641"/> for which an SDK<a id="_idIndexMarker642"/> was developed by the Arduino<a id="_idIndexMarker643"/> team. GoLang was developed by Google and follows the <strong class="bold">C-type syntax</strong>. The GoLang platform is good for operating system and network/API service development. If you are planning to maintain a high-performance system with the Arduino IoT Cloud or planning to run concurrent operations, then GoLang is the better choice.</p>
<p>We discussed here the three different platforms and their specialized domains of application. Node.js is best for <strong class="bold">Web APIs</strong>, Python is good for machine<a id="_idIndexMarker644"/> learning, and GoLang<a id="_idIndexMarker645"/> is an awesome choice for high-performance systems. You can either choose<a id="_idIndexMarker646"/> one SDK platform for your development<a id="_idIndexMarker647"/> or consume<a id="_idIndexMarker648"/> all the SDKs<a id="_idIndexMarker649"/> depending on your project requirements.</p>
<p>In the next section, we will start our journey with the Node.js SDK, beginning by installing the official Arduino IoT Cloud Node.js SDK on our machines.</p>
<h1 id="_idParaDest-165"><a id="_idTextAnchor165"/>Step-by-step – installing the Arduino Node.js SDK client</h1>
<p>From this point, we are going<a id="_idIndexMarker650"/> to use the Node.js SDK for our exercises and experiments. Before moving to the practical exercises, we need to first install the Arduino IoT<a id="_idIndexMarker651"/> Cloud package for Node.js. Download and install Node.js from <a href="https://nodejs.org/">https://nodejs.org/</a>. After the installation of Node.js is complete, open up the Windows/Mac/Linux <strong class="bold">Terminal</strong> and navigate to the directory<a id="_idIndexMarker652"/> where you will set up your coding workspaces using <strong class="bold">VSCode</strong>:</p>
<pre class="console">
npm install @arduino/arduino-iot-client
npm i request-promise</pre> <p>Type the two preceding commands in the <strong class="bold">Terminal</strong> and wait for the installation to complete. After a successful installation, open up VSCode and add the folder (where you have installed the Node.js Arduino IoT Cloud SDK) to the workspace where you installed the Arduino IoT Cloud and request-promise modules.</p>
<p>Navigate to the book’s official GitHub repository and download all the code from this chapter’s folder. Copy the files into the VSCode <code>Workspace</code> folder and extract the downloaded <code>.zip</code> file. Navigate to the <code>start</code> folder and open up the <code>main.js</code> file in VSCode.</p>
<p>Here we have two methods, <code>getToken()</code> and <code>ThingProperty()</code>. The <code>getToken()</code> method will be same across the coding exercises and will be used to fetch the authentication token from the Arduino IoT Cloud on the basis of the Client ID and Client Secret:</p>
<pre class="console">
client_id: '-----Paste ClientID Here-----',             client_secret: '-----Paste Client Secret Here-----',</pre> <p>The preceding code snippet is from the <code>getToken()</code> method. Insert your Client ID in the <code>client_id</code> variable and your Client Secret in the <code>client_secret</code> variable. Likewise, insert your <code>Thing ID</code> and <code>Property ID</code> in the following code snippet under the <code>ThingProperty()</code> method. You can get your Thing ID by navigating to Thing and then the <strong class="bold">Metadata</strong> tab in the Arduino IoT Cloud. The property ID can be found by clicking on the cloud variable on the Thing page in the Arduino IoT Cloud:</p>
<pre class="console">
var id = "Paste -----Thing ID-----"; // {String} The id of the thing
var pid = "-----Property ID-----"; // {String} The id of the property</pre> <p>Open the <code>main.js</code> code and provide a response in the console:</p>
<pre class="console">
node main.js</pre> <p>You will receive the following response in the console if everything works fine:</p>
<pre class="console">
API called successfully. Last Value of Property=259</pre> <p>If you receive a <code>401 error</code>, it means your Client ID and/or Client Secret are not correct. If a <code>404 error</code> is returned, it means you are not using the proper method to fetch property data. If you get a <code>500 error</code>, it means the server is down or there is a network blockage for the Arduino IoT Cloud from your ISP.</p>
<p>In the <em class="italic">First try with Postman</em> section, we discussed how to use Arduino IoT Cloud endpoints with Postman for request/response tasks as well as installing the Node.js module for the cloud and testing it with an example where we fetched the last value of the Thing cloud variable/property.</p>
<p>Building on this foundation, we are going<a id="_idIndexMarker653"/> to start a new journey where we will play around with the Arduino IoT Cloud. Firstly, we will start with devices. In the next section, we will create, update, delete, list, and view a specific device. Later in the<a id="_idIndexMarker654"/> chapter, we will do the same for Things, properties (also known as cloud variables), and dashboards.</p>
<h1 id="_idParaDest-166"><a id="_idTextAnchor166"/>Interacting with devices – hands-on with the Node.js SDK</h1>
<p>In this section, we are going<a id="_idIndexMarker655"/> to get hands-on and practical with devices. We will perform CRUD operations on a device as well as listing all the devices and showing all the parameters of specific devices. Open up VSCode and navigate to this chapter’s example code. Then click on the <code>device</code> folder: here you can find all the code related to device operations.</p>
<h2 id="_idParaDest-167"><a id="_idTextAnchor167"/>Creating a device</h2>
<p>Firstly, we will start<a id="_idIndexMarker656"/> with device creation. The documentation on device creation can be found at <a href="https://www.arduino.cc/reference/en/iot/api/#api-DevicesV2-devicesV2Create">https://www.arduino.cc/reference/en/iot/api/#api-DevicesV2-devicesV2Create</a>. Open <code>create-device.js</code> under the <code>device</code> folder in VSCode.</p>
<p>There are two methods in the code: one is <code>getToken()</code>, which is the same method as in all our coding exercises and helps us to fetch the authentication token for requests. The second method is <code>CreateDevice()</code>, which is responsible for device creation. Consulting the documentation, we can see we need to initiate the <code>api</code> variable with the <code>AiotApi.DevicesV2Api()</code> object, which is related to devices:</p>
<pre class="source-code">
var DeviceProperties = {
        'name':'Sense Home XIAO Series',
        'connection_type':'wifi',
        'fqbn':'esp32:esp32:XIAO_ESP32C3',
        'type':'login_and_secretkey_wifi'
    };
    var options = {
    };
    api.devicesV2Create(DeviceProperties, options).then(function(data) {
      console.log('Device Created successfully. Returned data: ' + util.inspect(data));
    }, function(error) {
      console.error(error);
    });</pre> <p><code>api.devicesV2Create</code> is the method responsible<a id="_idIndexMarker657"/> for device creation and takes two parameters as input. <code>DeviceProperties</code> covers things such as the device name, type, and <code>name</code> first – this could be anything you fancy, but avoid using special characters. Next, we need to provide a choice for <code>connection_type</code>, such as Wi-Fi, GSM, LoRa WAN, and so on. All available types are provided by the documentation. For <code>fqbn</code>, we need<a id="_idIndexMarker658"/> to provide the details of the development board. Taking the <code>esp32:esp32:XIAO_ESP32C3</code>.</p>
<p><code>options</code> are optional, so I left it blank, but you<a id="_idIndexMarker659"/> can provide the <code>X-Organization</code> value according to your requirements. Both arrays are passed to the <code>api.devicesV2Create</code> method, which will return the response. The <code>util.inspect</code> method is used to display the JSON response on the console with proper formatting. Type the following command to execute the <code>create-device.js</code> program:</p>
<pre class="console">
node create-device.js</pre> <p>After successful execution of the script, it will print a response like the following:</p>
<pre class="source-code">
Device Created successfully. Returned data: ArduinoDevicev2 {
  href: '/iot/v2/devices/e88b84a7-7ad7-4c2b-b79c-ab426e47dc67',
  id: 'e88b84a7-7ad7-4c2b-b79c-ab426e47dc67',
  label: 'Login and secret key for wifi device',
  name: 'Sense Home XIAO Series',
  serial: '',
  type: 'login_and_secretkey_wifi',
  user_id: 'f067c1e9-3ff8-4b9f-a9b4-f8c5c1d0ceb4',
  fqbn: 'esp32:esp32:XIAO_ESP32C3'
}</pre> <p>In the response, you will get your device ID, which will be used later in the chapter for Thing creation when we associate the device with the Thing. The remaining properties are the same as already<a id="_idIndexMarker660"/> covered in the code.</p>
<p class="callout-heading">Important note</p>
<p class="callout">If you are unable to get the correct FQBN, then add the device manually from the dashboard, finding and clicking on the device from the dropdown. This will give you the <code>fqbn</code>, <code>type</code>, and <code>connection_type</code> details. You can use these details later in your Node.js script for automated creation of devices.</p>
<h2 id="_idParaDest-168"><a id="_idTextAnchor168"/>Updating a device</h2>
<p>In this section, we are going<a id="_idIndexMarker661"/> to explore how we can update a device using the device ID. Let’s suppose we mistakenly added a device with the wrong FQBN and name. We will update both properties using the device ID. The documentation on updating devices is available at <a href="https://www.arduino.cc/reference/en/iot/api/#api-DevicesV2-devicesV2Update">https://www.arduino.cc/reference/en/iot/api/#api-DevicesV2-devicesV2Update</a>. Open the <code>update-device.js</code> file under the <code>device</code> folder in VSCode:</p>
<pre class="source-code">
var api = new AiotApi.DevicesV2Api();
var DeviceID="e88b84a7-7ad7-4c2b-b79c-ab426e47dc67";
var DeviceProperties = {
        'name':'Sense Home WeMos D1 Mini Series',
        'connection_type':'wifi',
        'fqbn':'esp8266:esp8266:d1_mini',
        'type':'login_and_secretkey_wifi'
};
var options = {
};
api.devicesV2Update(DeviceID,DeviceProperties, options).then(function(data) {
      console.log('Device Created successfully. Returned data: ' + util.inspect(data));
    }, function(error) {
      console.error(error);
});</pre> <p>The preceding code is almost the same as the <code>create-device</code> code. Here we have one extra variable, <code>DeviceID</code>, with which<a id="_idIndexMarker662"/> we will update the specific device. The rest of the code has the same device properties and options as previously. Now, fill in the correct <code>fqbn</code> and <code>name</code> values in the <code>DeviceProperties</code> variable. Lastly, we call the <code>api.devicesV2Update()</code> method. Execute the following command in the Terminal:</p>
<pre class="console">
node update-device.js</pre> <p>After successful execution of the script, it will print a response like the following:</p>
<pre class="source-code">
Device Updated successfully. Returned data: ArduinoDevicev2 {
  href: '/iot/v2/devices/e88b84a7-7ad7-4c2b-b79c-ab426e47dc67',
  id: 'e88b84a7-7ad7-4c2b-b79c-ab426e47dc67',
  label: 'Login and secret key for wifi device',
  name: 'Sense Home WeMos D1 Mini Series',
  serial: '',
  type: 'login_and_secretkey_wifi',
  user_id: 'f067c1e9-3ff8-4b9f-a9b4-f8c5c1d0ceb4',
  created_at: 2023-04-17T00:47:40.700Z,
  fqbn: 'esp8266:esp8266:d1_mini'
}</pre> <p>As we can see, after our update, the response sends back the new content. We provided a change of name and FQBN<a id="_idIndexMarker663"/> and it is reflected successfully in the response.</p>
<h2 id="_idParaDest-169"><a id="_idTextAnchor169"/>Deleting a device</h2>
<p>In this section, we are going to explore <a id="_idIndexMarker664"/>how we can delete a device using the device ID. The documentation for deleting devices is available at <a href="https://www.arduino.cc/reference/en/iot/api/#api-DevicesV2-devicesV2Delete">https://www.arduino.cc/reference/en/iot/api/#api-DevicesV2-devicesV2Delete</a>.</p>
<p>Open the <code>delete-device.js</code> file under the <code>device</code> folder in VSCode:</p>
<pre class="source-code">
    var api = new AiotApi.DevicesV2Api();
    var DeviceID='e88b84a7-7ad7-4c2b-b79c-ab426e47dc67';
    var options = {
    };
    api.devicesV2Delete(DeviceID, options).then(function(data) {
      console.log('Device Deleted successfully. Returned data: ' + data);
    }, function(error) {
      console.error(error);
    });</pre> <p>The preceding code snippet is taken from the <code>DeleteDevice()</code> method. In this method, we need to supply <code>DeviceID</code> and options variables as parameters. <code>DeviceID</code> is mandatory for the deletion process while the <code>options</code> variable is not. Execute the following command in the Terminal:</p>
<pre class="console">
node delete-device.js</pre> <p>After successful execution of the script, it will print a response to the console reporting that the device<a id="_idIndexMarker665"/> has been deleted successfully.</p>
<h2 id="_idParaDest-170"><a id="_idTextAnchor170"/>Listing devices</h2>
<p>In this section, we will list<a id="_idIndexMarker666"/> all the devices. Note that there is a difference between listing devices and showing devices: <em class="italic">listing</em> devices means displaying all the devices with their properties, while <em class="italic">showing</em> a device only returns a specific device’s properties based on the device ID.</p>
<p>The documentation on listing devices is available at <a href="https://www.arduino.cc/reference/en/iot/api/#api-DevicesV2-devicesV2List">https://www.arduino.cc/reference/en/iot/api/#api-DevicesV2-devicesV2List</a>. Open the <code>list-device.js</code> file under the <code>device</code> folder in VSCode. The following code snippet is taken from the <code>ListDevice()</code> method from the <code>list-device.js</code> file:</p>
<pre class="source-code">
   var api = new AiotApi.DevicesV2Api()
   var opts = {
        'acrossUserIds': true // {Boolean} If true, returns all the devices
      };
      api.devicesV2List(opts).then(function(data) {
        for(var i=0;i&lt;data.length;i++){
            console.log("Device ID:"+data[i].id+" Device Name:"+data[i].name);
        }
    }, function(error) {
      console.error(error);
    });</pre> <p>Here we need to provide the criteria that will be used to filter out the devices and return the desired response. In the current code, we only mention one parameter, <code>'acrossUserIds'</code>, which is <code>true</code> to fetch all types of devices. But if required, you can filter the devices listed on the basis of <code>tags</code>, <code>serial</code>, and <code>X-Organization</code>. Execute the following command in the Terminal:</p>
<pre class="console">
node list-device.js</pre> <p>After successful execution of the script, it will print a response in JSON format with the device properties, which will clog up the <strong class="bold">Terminal</strong> console with extensive output. I modified the code to only display<a id="_idIndexMarker667"/> the device ID and device name on the console:</p>
<pre class="source-code">
Device ID:04d8025a-4270-4d7e-aa04-45db87a594f5
Device Name:SmartAgriESP32-Sargodha
Device ID:5aae7e1f-940b-4426-80ac-1c953839cdb2
Device Name:MKR-GSM-1400
Device ID:fae0951d-3169-4d6a-a8e5-739c347eafc1
Device Name:MKR1500
Device ID:ca711f68-6de9-497a-ac45-780219ad2bb8
Device Name:Wemos d1 Mini by API Update
Device ID:64990519-1833-4bba-b035-978fcaa33466
Device Name:MKR1010-Device
Device ID:62e8600b-2733-4f24-9654-1fac549af27f
Device Name:XIAO-ESP32C3-Pulse-Sensor
Device ID:e88b84a7-7ad7-4c2b-b79c-ab426e47dc67
Device Name:Sense Home WeMos D1 Mini Series
Device ID:b9f3ff20-ebf1-4260-ad16-f434466458ac
Device Name:ArduinoNanoRP2040
Device ID:047d8316-dcdb-4bf5-af30-4319bb5a5eb0
Device Name:Delly</pre> <p>In the preceding code, we are displaying two parameters on the console, but you can choose whichever and however many you want by specifying their names in the for loop. Using this, we can send the output in JSON format to a web/mobile client, which will display the information either in a list<a id="_idIndexMarker668"/> box or in menus.</p>
<h2 id="_idParaDest-171"><a id="_idTextAnchor171"/>Showing a device</h2>
<p>This is the second-to-last<a id="_idIndexMarker669"/> subsection of the <em class="italic">Interacting with devices – hands-on with the Node.js SDK</em> section. Here we will fetch all the properties of a specific device by providing the device ID. The documentation on showing devices is available at <a href="https://www.arduino.cc/reference/en/iot/api/#api-DevicesV2-devicesV2Show">https://www.arduino.cc/reference/en/iot/api/#api-DevicesV2-devicesV2Show</a>.</p>
<p>Open the <code>show-device.js</code> file under the <code>device</code> folder in VSCode. The following code snippet is taken from the <code>ShowDevice()</code> method from the <code>show-device.js</code> file:</p>
<pre class="source-code">
var api = new AiotApi.DevicesV2Api()
    var id = '62e8600b-2733-4f24-9654-1fac549af27f'; // {String} The id of the device
    var opts = {
    };
    api.devicesV2Show(id, opts).then(function(data) {
      console.log('Device Created successfully. Returned data: ' + util.inspect(data));
    }, function(error) {
      console.error(error);
    });</pre> <p>The <code>devicesV2Show()</code> method only takes two parameters: the first one is the <code>DeviceID</code> and the second is <code>options</code>, which includes <code>X-Organization</code>. <code>DeviceID</code> is mandatory to fetch a proper response while the <code>opts</code> variable is optional, hence we pass this variable as empty. Execute the following command in the Terminal:</p>
<pre class="console">
node show-device.js</pre> <p>After successful execution of the script, it will print the response in JSON format with the device properties as well as the details of any cloud variables if any associated variable is present:</p>
<pre class="source-code">
ArduinoDevicev2 {
  id: '62e8600b-2733-4f24-9654-1fac549af27f',
  label: 'Login and secret key for wifi device',
  name: 'XIAO-ESP32C3-Pulse-Sensor',
    ……………………………………..
  thing: ArduinoThing {
    id: '6b6cd076-5859-4a6d-9b4e-18879893c6cb',
    name: 'Tracking and notifying Your Heart Rate',
    ……………………………………..
    webhook_active: true,
    webhook_uri: 'https://hooks.zapier.com/hooks/catch/14930971/324me7k/'
  }
}</pre> <p>The preceding code is the edited response of the script regarding device properties, which includes all the details of the given device such as last activity, the cloud variables count, the Thing ID associated with the device, webhook details (if active), sketch ID, and so on.</p>
<p>In this sub-section, we have explored how to get all the devices list from the Arduino IoT Cloud using the Node.js SDK. Next, let’s explore how to get the list of cloud variables/properties<a id="_idIndexMarker670"/> associated with the device.</p>
<h2 id="_idParaDest-172"><a id="_idTextAnchor172"/>Device properties/variables</h2>
<p>Here, we will fetch<a id="_idIndexMarker671"/> all the cloud variable details for a specific device by providing the device ID. The documentation on showing devices is available at <a href="https://www.arduino.cc/reference/en/iot/api/#api-DevicesV2-devicesV2GetProperties">https://www.arduino.cc/reference/en/iot/api/#api-DevicesV2-devicesV2GetProperties</a>.</p>
<p>To begin, open the <code>properties-device.js</code> file under the <code>device</code> folder in VSCode. The following code snippet is taken from the <code>ListPropDevice()</code> method in the <code>properties-device.js</code> file:</p>
<pre class="source-code">
    var api = new AiotApi.DevicesV2Api()
    var id = '62e8600b-2733-4f24-9654-1fac549af27f'; // {String} The id of the device
    var opts = {
    };
    api.devicesV2GetProperties(id, opts).then(function(data) {
      console.log('Device Properties.' + util.inspect(data));
    }, function(error) {
      console.error(error);
    });</pre> <p>The <code>devicesV2GetProperties()</code> method only takes two parameters: the first one is device ID and the second<a id="_idIndexMarker672"/> is options, which includes <code>showDeleted</code> and <code>X-Organization</code>. <code>DeviceID</code> is mandatory to fetch a proper response, while the <code>opts</code> variable is optional, so we leave this variable empty when we pass it. Execute the following command in the Terminal:</p>
<pre class="console">
node properties-device.js</pre> <p>After successful execution of the script, it will print a response in JSON format containing the cloud variable details associated with that particular device ID:</p>
<pre class="source-code">
  Properties: [
    ArduinoProperty {
      href: '/iot/v1/things/6b6cd076-5859-4a6d-9b4e-18879893c6cb/properties/b357a513-ad2b-4e1f-a76b-6dac078e36d5',
      id: 'b357a513-ad2b-4e1f-a76b-6dac078e36d5',
      name: 'BPM',
      permission: 'READ_ONLY',
      thing_id: '6b6cd076-5859-4a6d-9b4e-18879893c6cb',
      type: 'HEART_BEATS',
      update_strategy: 'ON_CHANGE',
      created_at: 2023-03-31T16:41:33.103Z,
      persist: true,
      tag: 1,
      thing_name: 'Tracking and notifying Your Heart Rate',
      update_parameter: 0,
      updated_at: 2023-03-31T17:05:19.564Z,
      variable_name: 'bPM'
    }
  ]</pre> <p>The preceding response is the edited response of the script regarding the device cloud variables, including <code>variable_name</code>, <code>type</code>, <code>permission</code>, <code>thing_id</code>, <code>update_strategy</code>, and so on. We have now<a id="_idIndexMarker673"/> seen how to get the cloud variable details, and in the next section we’ll move on to cover Things.</p>
<h1 id="_idParaDest-173"><a id="_idTextAnchor173"/>Engaging with Things – Node.js SDK implementation guide</h1>
<p>The Thing<a id="_idIndexMarker674"/> is one of the most important elements in the Arduino IoT Cloud, and acts as defined container holding all of its ingredients such as cloud variables, the device, a sketch for the device, and the device’s network configuration. In this section, we will try a range of different coding exercises to get a feel for Thing CRUD operations.</p>
<h2 id="_idParaDest-174"><a id="_idTextAnchor174"/>Creating a Thing</h2>
<p>Firstly, we will<a id="_idIndexMarker675"/> start with Thing creation. The relevant documentation can be found at <a href="https://www.arduino.cc/reference/en/iot/api/#api-ThingsV2-thingsV2Createe">https://www.arduino.cc/reference/en/iot/api/#api-ThingsV2-thingsV2Createe</a>. Open the <code>create-thing.js</code> file under the <code>thing</code> folder in VSCode.</p>
<p>There are two methods in this code: one is <code>getToken()</code>, which is the same method as in all our coding exercises and helps us to fetch an authentication token for our requests. The second method is <code>CreateThing()</code>, which is responsible for Thing creation. Referring to the documentation, we can see that we need to initiate the <code>api</code> variable with the <code>AiotApi.ThingsV2Api()</code> object, which relates to the Arduino IoT Cloud Thing. This object is responsible for performing operations on the Thing:</p>
<pre class="source-code">
    var api = new AiotApi.ThingsV2Api()
    var thingCreate = {'name':' Sense the Env Thing Via API'}; // {ThingCreate}
    var opts = {
      'force': true // {Boolean} If true, detach device from the other thing, and attach to this thing
    };
    api.thingsV2Create(thingCreate, opts).then(function(data) {
      console.log('Thing Created successfully. Returned data: ' + util.inspect(data));
    }, function(error) {
      console.error(error);
    });</pre> <p><code>api.thingsV2Create</code> is the method responsible for Thing creation and takes two parameters as input: <code>name</code> and <code>opts</code>. Firstly, we start with <code>name</code>, which can be anything you like, but make sure to avoid special characters. For now, we provide just the Thing name in the variable, but in the upcoming<a id="_idIndexMarker676"/> update section, we will additionally pass the time zone and device ID parameters.</p>
<p><code>opts</code> here is optional, hence I left it blank, but you can provide the <code>X-Organization</code> value if required. Both variables are passed to the <code>api.thingsV2Create</code> method, which will return the response. The <code>util.inspect</code> method is used to display the JSON response on the console with proper formatting. Type the following command to execute the <code>create-device.js</code> script:</p>
<pre class="console">
node create-thing.js</pre> <p>After successful execution of the script, it will print a response as follows:</p>
<pre class="source-code">
Thing Created successfully. Returned data: ArduinoThing {
  href: '/iot/v1/things/d99e244d-f245-4e27-9ead-717e52ac5a96',
  id: 'd99e244d-f245-4e27-9ead-717e52ac5a96',
  name: 'Sense the Env Thing Via API',
  timezone: 'America/New_York',
  user_id: 'f067c1e9-3ff8-4b9f-a9b4-f8c5c1d0ceb4',
  created_at: 2023-04-18T16:46:35.767Z,
  properties_count: 0,
  updated_at: 2023-04-18T16:46:35.767Z,
  webhook_active: false
}</pre> <p>In the response, you will get your Thing ID, which will be used shortly in the following Thing update/delete operations – so make sure to paste this Thing ID into a Notepad file or something similar. Also returned<a id="_idIndexMarker677"/> are the time zone, properties count, and webhook status.</p>
<h2 id="_idParaDest-175"><a id="_idTextAnchor175"/>Updating a Thing</h2>
<p>In this section, we are going<a id="_idIndexMarker678"/> to explore how to update a Thing using the Thing ID. Let’s suppose we mistakenly added the Thing without setting the proper time zone and without device association. In this scenario, we have the option to update the Thing with new properties. The documentation covering updating devices is available at <a href="https://www.arduino.cc/reference/en/iot/api/#api-ThingsV2-thingsV2Update">https://www.arduino.cc/reference/en/iot/api/#api-ThingsV2-thingsV2Update</a>. Open the <code>update-thing.js</code> file under the <code>device</code> folder in VSCode:</p>
<pre class="source-code">
    var api = new AiotApi.ThingsV2Api()
    var id = 'd99e244d-f245-4e27-9ead-717e52ac5a96'; // {String} The id of the thing
    var thingUpdate = {
        'name':'Sense the Env Thing Via API Update',
        'timezone':'Asia/Karachi',
        'device_id':'e88b84a7-7ad7-4c2b-b79c-ab426e47dc67'
    };
    var opts = {
      'force': true // {Boolean} If true, detach device from the other thing, and attach to this thing
    };
    api.thingsV2Update(id,thingUpdate, opts).then(function(data) {
      console.log('Thing Updated successfully. Returned data: ' + util.inspect(data));
    }, function(error) {
      console.error(error);
    });</pre> <p>The preceding code is similar to the <code>create-thing</code> code. Here we have one extra variable, <code>id</code>, which will help us to update the specific Thing. We also have the <code>timezone</code>, <code>device_id</code>, and <code>name</code> in the <code>thingupdate</code> variable. Lastly, we call the <code>api.thingsV2Update()</code> method. Execute the following command in the Terminal:</p>
<pre class="console">
node update-thing.js</pre> <p>After successful execution of the script, it will print a response like the following:</p>
<pre class="source-code">
Thing Updated successfully. Returned data: ArduinoThing {
  href: '/iot/v1/things/d99e244d-f245-4e27-9ead-717e52ac5a96',
  id: 'd99e244d-f245-4e27-9ead-717e52ac5a96',
  name: 'Sense the Env Thing Via API Update',
  timezone: 'Asia/Karachi',
  user_id: 'f067c1e9-3ff8-4b9f-a9b4-f8c5c1d0ceb4',
  created_at: 2023-04-18T16:46:35.767Z,
  device_id: 'e88b84a7-7ad7-4c2b-b79c-ab426e47dc67',
  properties_count: 0,
  updated_at: 2023-04-18T16:46:35.767Z,
  webhook_active: false
}</pre> <p>After our update, the response will return the new content. We provided new values for <code>name</code> and <code>device_id</code>, along with the correct time zone. Everything is updated successfully and reflected<a id="_idIndexMarker679"/> in the response.</p>
<h2 id="_idParaDest-176"><a id="_idTextAnchor176"/>Creating a Thing sketch</h2>
<p>With Thing creation<a id="_idIndexMarker680"/> out of the way, we now need to create a sketch for the Thing. The relevant documentation can be found at <a href="https://www.arduino.cc/reference/en/iot/api/#api-ThingsV2-thingsV2CreateSketch">https://www.arduino.cc/reference/en/iot/api/#api-ThingsV2-thingsV2CreateSketch</a>. Open the <code>create-sketch-thing.js</code> file under the <code>thing</code> folder in VSCode.</p>
<p>There are two methods in the code: one is <code>getToken()</code>, which is the same method as used in all our coding exercises and fetches the authentication token for our requests. The second method is <code>CreateSketch()</code>, which handles creating the sketch for our specific Thing:</p>
<pre class="source-code">
    var api = new AiotApi.ThingsV2Api()
    var id = 'd99e244d-f245-4e27-9ead-717e52ac5a96'; // {String} The id of the thing
    var thingSketch = {'sketch_version':'v1'}; // {ThingSketch}
    var opts = {
    };
    api.thingsV2CreateSketch(id, thingSketch, opts).then(function(data) {
      console.log('Thing Sketch Created successfully. Returned data: ' + util.inspect(data));
    }, function(error) {
      console.error(error);
    });</pre> <p><code>api.thingsV2CreateSketch</code> is the method<a id="_idIndexMarker681"/> responsible for Thing sketch creation and takes three parameters as input. The Thing ID is the first parameter; the second is the sketch version. <code>opts</code> is optional, so I left it blank, but you can provide the <code>X-Organization</code> value according to your requirements. All variables are passed to the <code>api.thingsV2CreateSketch</code> method, which will return the response. The <code>util.inspect</code> method is used to display the JSON response on the console with proper formatting. Type the following command to execute the <code>create-device.js</code> script:</p>
<pre class="console">
node create-sketch-thing.js</pre> <p>After successful execution of the script, it will print the following response:</p>
<pre class="source-code">
Thing Sketch Created successfully. Returned data: ArduinoThing {
  href: '/iot/v1/things/d99e244d-f245-4e27-9ead-717e52ac5a96',
  id: 'd99e244d-f245-4e27-9ead-717e52ac5a96',
  name: 'Sense the Env Thing Via API Update',
  timezone: 'Asia/Karachi',
  user_id: 'f067c1e9-3ff8-4b9f-a9b4-f8c5c1d0ceb4',
  created_at: 2023-04-18T16:46:35.767Z,
  device_id: 'e88b84a7-7ad7-4c2b-b79c-ab426e47dc67',
  properties_count: 0,
  sketch_id: '93297fc6-835d-46b3-89bc-1c6738a8ec7b',
  updated_at: 2023-04-18T17:10:34.779Z,
  webhook_active: false
}</pre> <p>In the response, you will see your Thing ID along with some other properties indicating that the sketch for the given Thing has been created successfully. You can also verify the sketch by navigating to the given Thing on the Arduino IoT Cloud.</p>
<p class="callout-heading">Important note</p>
<p class="callout">Before sketch creation, it’s important to associate a device with the Thing.</p>
<p>In this section, we created the Sketch for our Thing as the Arduino IoT Cloud will not do this by default. As a result, it’s mandatory<a id="_idIndexMarker682"/> to create a Sketch after creating a Thing in the Arduino IoT Cloud. Next we are going to explore how we can delete a Thing using the Arduino IoT Cloud API.</p>
<h2 id="_idParaDest-177"><a id="_idTextAnchor177"/>Deleting a Thing</h2>
<p>In this section, we are going to explore<a id="_idIndexMarker683"/> how we can delete a Thing using the Thing ID. The documentation covering Thing deletion is available at <a href="https://www.arduino.cc/reference/en/iot/api/#api-ThingsV2-thingsV2Delete">https://www.arduino.cc/reference/en/iot/api/#api-ThingsV2-thingsV2Delete</a>. Open the <code>delete-thing.js</code> file under the <code>thing</code> folder in VSCode:</p>
<pre class="source-code">
    var api = new AiotApi.ThingsV2Api()
    var id = 'ac9fc5fd-a946-406e-983d-715dcc2571b6'; // {String} The id of the thing
    var opts = {
      'force': true // {Boolean} If true, detach device from the other thing, and attach to this thing
    };
    api.thingsV2Delete(id, opts).then(function(data) {
      console.log('Thing Deleted successfully. Returned data: ' + data);
    }, function(error) {
      console.error(error);
    });</pre> <p>The preceding code snippet is taken from the <code>DeleteThing()</code> method. In the <code>DeleteThing()</code> method, we need to supply the <code>id</code> (Thing ID) and <code>opts</code> variables as parameters. <code>id</code> (Thing ID) is mandatory for the deletion process, while the <code>opts</code> variable is not. Execute the following command in the Terminal:</p>
<pre class="console">
node delete-thing.js</pre> <p>After successful execution of the script, it will print a response on the console indicating that the device was deleted<a id="_idIndexMarker684"/> successfully.</p>
<h2 id="_idParaDest-178"><a id="_idTextAnchor178"/>Listing Things</h2>
<p>In this section, we will list<a id="_idIndexMarker685"/> all the Things. Note that there is a difference between <em class="italic">listing</em> Things and <em class="italic">showing</em> a Thing: listing Things will display all the Things with their properties, while showing a Thing only shows the specific Thing properties related to a given Thing ID.</p>
<p>The relevant documentation on listing Things is available at <a href="https://www.arduino.cc/reference/en/iot/api/#api-ThingsV2-thingsV2List">https://www.arduino.cc/reference/en/iot/api/#api-ThingsV2-thingsV2List</a>. Open the <code>list-thing.js</code> file under the <code>thing</code> folder in VSCode. The following code snippet is taken from the <code>ListThing()</code> method:</p>
<pre class="source-code">
    var api = new AiotApi.ThingsV2Api()
    var opts = {
        'acrossUserIds': false
    };
    api.thingsV2List(opts).then(function(data) {
        for(var i=0;i&lt;data.length;i++){
            console.log("Thing ID:"+data[i].id+" Thing Name:"+data[i].name);
        }
      }, function(error) {
        console.error(error);
      });</pre> <p>Here we need to provide criteria that will be used to filter out the Things and return the response. In the current code, we have provided only one parameter, <code>'acrossUserIds'</code>, which is <code>true</code> and so will fetch all types of Things. But you can also filter Things on the basis of tags, IDs, X-Organization, and so on. Execute the following command in the Terminal:</p>
<pre class="console">
node list-thing.js</pre> <p>After successful execution<a id="_idIndexMarker686"/> of the script, it will print the response in JSON format with the Thing properties, which will fill the console with an extensive output. I modified the code to only display the Thing ID and Thing name on the console:</p>
<pre class="source-code">
Thing ID:6b6cd076-5859-4a6d-9b4e-18879893c6cb Thing Name:Tracking and notifying Your Heart Rate
Thing ID:6e3d308c-dfb2-49ad-aa61-998227f214ab Thing Name:Thing Via API-Name-Update
Thing ID:85b04a9c-e335-4842-bf4b-c13f726e0522 Thing Name:AgriStack
Thing ID:8aee742e-4492-423d-9f19-79fec856b917 Thing Name:A portable thing tracker using MKR GSM1400
Thing ID:bf8e11ea-1a78-4f95-b6a0-c6d50b868402 Thing Name:MKR1010 Hello World
Thing ID:d99e244d-f245-4e27-9ead-717e52ac5a96 Thing Name:Sense the Env Thing Via API Update</pre> <p>As can be seen in the preceding output, I am only displaying two parameters on the console but you can choose whichever parameters you would like to be displayed by specifying their names in the for loop. This way we can send the output in JSON format to a web/mobile client where the information<a id="_idIndexMarker687"/> will be displayed in either a list box or in menus.</p>
<h2 id="_idParaDest-179"><a id="_idTextAnchor179"/>Showing a Thing</h2>
<p>This is the last subsection<a id="_idIndexMarker688"/> of the <em class="italic">Engaging with things – Node.js SDK implementation guide </em>section. Here we will fetch all the properties regarding a specific Thing by providing the Thing ID. The documentation covering showing Things is available at <a href="https://www.arduino.cc/reference/en/iot/api/#api-ThingsV2-thingsV2Show">https://www.arduino.cc/reference/en/iot/api/#api-ThingsV2-thingsV2Show</a>. Open the <code>show-thing.js</code> file under the <code>thing</code> folder in VSCode. The following code snippet is taken from the <code>ShowThing()</code> method:</p>
<pre class="source-code">
    var api = new AiotApi.ThingsV2Api()
    var thingid='6b6cd076-5859-4a6d-9b4e-18879893c6cb';
    var opts = {
    };
    api.thingsV2Show(thingid, opts).then(function(data) {
        console.log('API called successfully. Returned data: ' +util.inspect(data));
      }, function(error) {
        console.error(error);
      });</pre> <p>The <code>thingsV2Show()</code> method only takes two parameters: the first one is the <code>thingid</code> and the second is <code>opts</code>, which include <code>X-Organization</code>. <code>thingid</code> is mandatory to fetch a proper response, while the <code>opts</code> variable is not compulsory, hence I passed this variable empty. Execute the following command in the Terminal:</p>
<pre class="console">
node show-thing.js</pre> <p>After successful execution of the script, it will print the response in JSON format containing the device properties<a id="_idIndexMarker689"/> as well as the details of cloud variables, if any associated variable is present:</p>
<pre class="source-code">
API called successfully. Returned data: ArduinoThing {
  name: 'Tracking and notifying Your Heart Rate',
  timezone: 'Asia/Karachi',
    ……………………………………..
  device_fqbn: 'esp32:esp32:XIAO_ESP32C3',
  device_id: '62e8600b-2733-4f24-9654-1fac549af27f',
  device_name: 'XIAO-ESP32C3-Pulse-Sensor',
  device_type: 'login_and_secretkey_wifi',
  properties: [
    ArduinoProperty {
      id: 'b357a513-ad2b-4e1f-a76b-6dac078e36d5',
      name: 'BPM',
      permission: 'READ_ONLY',
      thing_id: '6b6cd076-5859-4a6d-9b4e-18879893c6cb',
      type: 'HEART_BEATS',
      update_strategy: 'ON_CHANGE',
      created_at: 2023-03-31T16:41:33.103Z,
      last_value: 50,
    ……………………………………..
      variable_name: 'bPM'
    }
  ],
  properties_count: 1,
  sketch_id: 'f490fec5-b62a-41f9-9ff7-2b5c3f2ed7d1',
  updated_at: 2023-04-01T16:42:47.152Z,
  webhook_active: true,
  webhook_uri: 'https://hooks.zapier.com/hooks/catch/14930971/324me7k/'
}</pre> <p>The preceding code snippet shows an edited section from the output response regarding the Thing properties, which includes all the details of the Thing, the device properties, cloud variables such as last value, webhook details (if active), the sketch ID, and so on.</p>
<p>In this section, we explored how we can get the complete details of a specific Arduino IoT Cloud Thing using the Thing ID<a id="_idIndexMarker690"/> in JSON format. Next, we will start playing with cloud variables/properties.</p>
<h1 id="_idParaDest-180"><a id="_idTextAnchor180"/>Exploring properties – Node.js SDK interaction techniques</h1>
<p><strong class="bold">Properties</strong>, also called <strong class="bold">cloud variables</strong>, are one of the most important ingredients<a id="_idIndexMarker691"/> for Things in the Arduino IoT Cloud, responsible for storage of sensor data from the device to the cloud or vice versa. In this section, we will explore how to create, update, delete, and list cloud variables using the Node.js SDK.</p>
<h2 id="_idParaDest-181"><a id="_idTextAnchor181"/>Creating a property</h2>
<p>Firstly, we will start<a id="_idIndexMarker692"/> with property creation. The property creation documentation can be found at <a href="https://www.arduino.cc/reference/en/iot/api/#api-PropertiesV2-propertiesV2Create">https://www.arduino.cc/reference/en/iot/api/#api-PropertiesV2-propertiesV2Create</a>. Open the <code>create-property.js</code> file under the <code>properties</code> folder in VSCode.</p>
<p>There are two methods in the code: one is <code>getToken()</code>, which is the same method used in all our coding exercises to fetch the authentication token for our requests. The second method is <code>CreateProperty()</code>, which handles cloud variable creation. Consulting the documentation, we can<a id="_idIndexMarker693"/> see that we need to initiate the <code>api</code> variable with <code>AiotApi</code>, the <code>PropertiesV2Api()</code> object, which is related to properties:</p>
<pre class="source-code">
    var api = new AiotApi.PropertiesV2Api()
    var thing_id="d99e244d-f245-4e27-9ead-717e52ac5a96";
    var property = {
        'name':'Temperature',
        'variable_name':'temperature',
        'permission':"READ_ONLY",
        'persist':true,
        'type':'TEMPERATURE_C',
        'update_strategy':'ON_CHANGE'
    };
    api.propertiesV2Create(thing_id, property).then(function(data) {
        console.log('Property Created successfully. Returned data: ' +util.inspect(data));
      }, function(error) {
        console.error(error);
      });</pre> <p><code>api.propertiesV2Create</code> is the method responsible for property creation and takes two parameters as input. One is the Thing ID and the other variable contains mandatory details regarding the cloud variable. The Thing ID is simple and easily fetchable from the Thing metadata, but cloud variables have a variety of different parameters including <code>type</code>, <code>permission</code>, and <code>update_strategy</code>, available on the official documentation page (the URL was provided at the start of this section). Both variables are passed to the <code>api.devicesV2Create</code> method, which returns the response. The <code>util.inspect</code> method is used to display the JSON response with proper formatting on the console. Type the following command to execute the <code>create-device.js</code> script:</p>
<pre class="console">
node create-property.js</pre> <p>After successful execution<a id="_idIndexMarker694"/> of the script, it will print the following response:</p>
<pre class="source-code">
Property Created successfully. Returned data: ArduinoProperty {
  href: '/iot/v1/things/d99e244d-f245-4e27-9ead-717e52ac5a96/properties/c4dc8f92-b62f-44df-9455-74cdd08041bc',
  id: 'c4dc8f92-b62f-44df-9455-74cdd08041bc',
  name: 'Temperature',
  permission: 'READ_ONLY',
  thing_id: 'd99e244d-f245-4e27-9ead-717e52ac5a96',
  type: 'TEMPERATURE_C',
  update_strategy: 'ON_CHANGE',
  created_at: 2023-04-18T23:49:46.610Z,
  persist: true,
  tag: 1,
  updated_at: 2023-04-18T23:49:46.610Z,
  variable_name: 'temperature'
}</pre> <p>In the response, you will get your cloud variable ID, creation date, and update date, along with other details <a id="_idIndexMarker695"/>already mentioned during our cloud variable creation exercise.</p>
<h2 id="_idParaDest-182"><a id="_idTextAnchor182"/>Updating a property</h2>
<p>In this section, we are going<a id="_idIndexMarker696"/> to explore how we can update a cloud variable using the cloud variable ID. Suppose we mistakenly added a cloud variable with the wrong data type and some other parameters – in the event of this scenario, we have the option to update it. The documentation covering updating properties is available at <a href="https://www.arduino.cc/reference/en/iot/api/#api-PropertiesV2-propertiesV2Update">https://www.arduino.cc/reference/en/iot/api/#api-PropertiesV2-propertiesV2Update</a>. Open the <code>update-property.js</code> file under the <code>property</code> folder in VSCode:</p>
<pre class="source-code">
   var api = new AiotApi.PropertiesV2Api()
    var thing_id="d99e244d-f245-4e27-9ead-717e52ac5a96";
    var property_id="c4dc8f92-b62f-44df-9455-74cdd08041bc"
    var property = {
        'name':'OutdoorTemperature',
        'variable_name':'outdoorTemperature',
        'permission':"READ_ONLY",
        'persist':true,
        'type':'TEMPERATURE_F',
        'update_strategy':'ON_CHANGE'
    };
    api.propertiesV2Update(thing_id,property_id, property).then(function(data) {
        console.log('Property Updated successfully. Returned data: ' +util.inspect(data));
      }, function(error) {
        console.error(error);
      });</pre> <p>The preceding code is very similar to the <code>create-property</code> code. Here we have one extra variable, <code>property_id</code>, used to update the given property. Besides that, we have the same cloud variable properties with their updated content. Lastly, we call the <code>api.propertiesV2Update()</code> method. Execute<a id="_idIndexMarker697"/> the following command in the Terminal:</p>
<pre class="console">
node update-property.js</pre> <p>After successful execution of the script, it will print a response something like the following:</p>
<pre class="source-code">
Property Updated successfully. Returned data: ArduinoProperty {
  href: '/iot/v1/things/d99e244d-f245-4e27-9ead-717e52ac5a96/properties/c4dc8f92-b62f-44df-9455-74cdd08041bc',
  id: 'c4dc8f92-b62f-44df-9455-74cdd08041bc',
  name: 'OutdoorTemperature',
  permission: 'READ_ONLY',
  thing_id: 'd99e244d-f245-4e27-9ead-717e52ac5a96',
  type: 'TEMPERATURE_F',
  update_strategy: 'ON_CHANGE',
  created_at: 2023-04-18T23:49:46.610Z,
  persist: true,
  updated_at: 2023-04-18T23:58:07.496Z,
  variable_name: 'outdoorTemperature'
}</pre> <p>After the update, the response will return the new content. We provided updated information for the name, type, and variable<a id="_idIndexMarker698"/> name and this is reflected successfully in the response.</p>
<h2 id="_idParaDest-183"><a id="_idTextAnchor183"/>Deleting a property</h2>
<p>In this section, we are going to explore<a id="_idIndexMarker699"/> how to delete a property using the Thing ID and property ID. The documentation covering deleting a property is available at <a href="https://www.arduino.cc/reference/en/iot/api/#api-PropertiesV2-propertiesV2Delete">https://www.arduino.cc/reference/en/iot/api/#api-PropertiesV2-propertiesV2Delete</a>. Open the <code>delete-property.js</code> file under the <code>property</code> folder in VSCode:</p>
<pre class="source-code">
    var api = new AiotApi.PropertiesV2Api()
    var thing_id="d99e244d-f245-4e27-9ead-717e52ac5a96";
    var property_id="c4dc8f92-b62f-44df-9455-74cdd08041bc";
    var options = {
        'force':true
    };
    api.propertiesV2Delete(thing_id,property_id, options).then(function(data) {
        console.log('Property Deleted successfully. Returned data: ' +data);
      }, function(error) {
        console.error(error);
      });</pre> <p>The preceding code snippet is taken from the <code>DeleteProperty()</code> method from <code>delete-property.js</code> file. In the <code>DeleteProperty()</code> method we need to supply the <code>thing_ID</code>, <code>property_id</code>, and <code>options</code> variables as parameters. <code>thing_id</code> and <code>property_id</code> are both mandatory for the deletion process while the <code>options</code> variable is optional. Execute the following command in the Terminal:</p>
<pre class="console">
node delete-property.js</pre> <p>After successful execution<a id="_idIndexMarker700"/> of the script, it will print a response on the console reading that the property has been deleted successfully.</p>
<h2 id="_idParaDest-184"><a id="_idTextAnchor184"/>Listing properties</h2>
<p>In this section, we will list<a id="_idIndexMarker701"/> all the properties for a given Thing using the Thing ID. As previously outlined with devices and Things, there is a difference between <em class="italic">listing</em> properties and <em class="italic">showing</em> a property. Listing properties means displaying all the cloud variables of a Thing, while showing a property only shows the specific cloud variable properties related to the given Thing ID and property ID.</p>
<p>The documentation on listing properties is available at <a href="https://www.arduino.cc/reference/en/iot/api/#api-PropertiesV2-propertiesV2List">https://www.arduino.cc/reference/en/iot/api/#api-PropertiesV2-propertiesV2List</a>. Open the <code>list-property.js</code> file under the <code>property</code> folder in VSCode. The following code snippet is taken from the <code>ListProperty()</code> method:</p>
<pre class="source-code">
    var api = new AiotApi.PropertiesV2Api()
    var thing_id="6b6cd076-5859-4a6d-9b4e-18879893c6cb";
    var options = {
        'showDeleted':true
    };
    api.propertiesV2List(thing_id, options).then(function(data) {
        console.log('Property Updated successfully. Returned data: ' +util.inspect(data));
      }, function(error) {
        console.error(error);
      });</pre> <p>Here we only need to provide<a id="_idIndexMarker702"/> the Thing ID and options to get a complete list of cloud variables associated with the Thing. Execute the following command in the Terminal:</p>
<pre class="console">
node list-property.js</pre> <p>After successful execution of the script, it will print the response in JSON format with the cloud variable’s properties. I chose a Thing that only has a single cloud variable:</p>
<pre class="source-code">
Returned data: [
  ArduinoProperty {
    href: '/iot/v1/things/6b6cd076-5859-4a6d-9b4e-18879893c6cb/properties/b357a513-ad2b-4e1f-a76b-6dac078e36d5',
    id: 'b357a513-ad2b-4e1f-a76b-6dac078e36d5',
    name: 'BPM',
    permission: 'READ_ONLY',
    thing_id: '6b6cd076-5859-4a6d-9b4e-18879893c6cb',
    type: 'HEART_BEATS',
    update_strategy: 'ON_CHANGE',
    created_at: 2023-03-31T16:41:33.103Z,
    last_value: 50,
    persist: true,
    tag: 1,
    thing_name: 'Tracking and notifying Your Heart Rate',
    update_parameter: 0,
    updated_at: 2023-03-31T17:05:19.564Z,
    value_updated_at: 2023-04-01T16:43:12.293Z,
    variable_name: 'bPM'
  }
]</pre> <p>The preceding response contains all the values related to the cloud variable, such as last value, updated time, and so on. If you want to fetch the last value of a cloud variable then this method could be used in your application to do so.</p>
<p>Next, we have another API endpoint related to showing the properties of a single cloud variable. The code is available in the <code>property</code> folder, and the execution of the code along with checking out how it works is left to you as an exercise.</p>
<p>In this section, we discussed<a id="_idIndexMarker703"/> in depth how to get the complete details of a cloud variable/property in JSON format using the Arduino IoT Cloud API, which provides lot of data including <code>last_value</code> and <code>value_update_at</code>. In the next section, we will start working with dashboards and learn how to perform operations on them using the Node.js SDK.</p>
<h1 id="_idParaDest-185"><a id="_idTextAnchor185"/>Crafting dashboards – unleashing potential via the 
Node.js SDK</h1>
<p>Dashboards<a id="_idIndexMarker704"/> are the most important ingredient<a id="_idIndexMarker705"/> in the Arduino IoT Cloud pertaining to <strong class="bold">data visualization</strong>. In the SDK, we have dashboard-specific methods to perform CRUD operations on dashboards, as well as other operations such as sharing, requesting access, and so on, but here we will only focus on the CRUD operations.</p>
<h2 id="_idParaDest-186"><a id="_idTextAnchor186"/>Creating a dashboard</h2>
<p>Let’s start first with<a id="_idIndexMarker706"/> dashboard creation. The relevant documentation can be found at <a href="https://www.arduino.cc/reference/en/iot/api/#api-DashboardsV2-dashboardsV2Create">https://www.arduino.cc/reference/en/iot/api/#api-DashboardsV2-dashboardsV2Create</a>. Open the <code>create-dashboard.js</code> file under the <code>dashboard</code> folder in VSCode.</p>
<p>There are two methods in this code: one is <code>getToken()</code>, which is the same method as in all our coding exercises to fetch the authentication token for our requests. The second method is <code>CreateDashboard()</code>, which is responsible for dashboard creation. Referring to the documentation, we can see we need to initiate the <code>api</code> variable with the <code>AiotApi.DashboardV2Api()</code> object, which is used to perform operations on dashboard objects:</p>
<pre class="source-code">
var api = new AiotApi.DashboardsV2Api();
    var dashboardprop = {
        'name':'Dashboard Created via API'
    };
    var opts = { };
    api.dashboardsV2Create(dashboardprop,opts).then(function(data) {
        console.log('Dashboard Created successfully. Returned data: ' + util.inspect(data));
        }, function(error) {
        console.error(error);
    });</pre> <p><code>api.dashboardsV2Create</code> is the method responsible for dashboard creation and takes two parameters<a id="_idIndexMarker707"/> as input: the first is the dashboard properties and the second variable is <code>opts</code>, which is not mandatory, hence I leave it empty. Both variables are passed to the <code>api.dashboardsV2Create</code> method, which returns the response. The <code>util.inspect</code> method is used to display the JSON response on the console with proper formatting. Type the following command to execute the <code>create-dashboard.js</code> script:</p>
<pre class="console">
node create-dashboard.js</pre> <p>After successful execution of the script, it will print a response like the following:</p>
<pre class="source-code">
Dashboard Created successfully. Returned data: ArduinoDashboardv2 {
  id: '5b872702-059c-4895-a677-808981f31588',
  name: 'Dashboard Created via API',
  updated_at: 2023-04-19T17:31:39.487Z,
  created_by: ArduinoDashboardowner {
    user_id: 'f067c1e9-3ff8-4b9f-a9b4-f8c5c1d0ceb4',
    username: 'mafzalattari'
  }
}</pre> <p>In the response you will get your dashboard ID, creation date, update date, and other things we already covered <a id="_idIndexMarker708"/>during dashboard creation.</p>
<h2 id="_idParaDest-187"><a id="_idTextAnchor187"/>Updating a dashboard</h2>
<p>In this section, we are going<a id="_idIndexMarker709"/> to explore how to update a dashboard using the dashboard ID. There is an option to add widgets to a dashboard via an API but it will make the code significantly more complex due to the JSON data involved. For this reason, we will just update the dashboard name instead of adding widgets. The documentation for updating properties is available at <a href="https://www.arduino.cc/reference/en/iot/api/#api-DashboardsV2-dashboardsV2Update">https://www.arduino.cc/reference/en/iot/api/#api-DashboardsV2-dashboardsV2Update</a>. Open the <code>update-dashboard.js</code> file under the <code>dashboard</code> folder in VSCode:</p>
<pre class="source-code">
  var api = new AiotApi.DashboardsV2Api()
    var dashboard_id="5b872702-059c-4895-a677-808981f31588";
    var dashboardprop = {
        'name':'Dashboard Created via API Update'
    };
    var opts = {
    };
    api.dashboardsV2Update(dashboard_id,dashboardprop, opts).then(function(data) {
      console.log('Dashboard Updated successfully.'+ util.inspect(data));
    }, function(error) {
      console.error(error);
    });</pre> <p>The preceding code is almost<a id="_idIndexMarker710"/> the same as the <code>create-dashboard</code> code. Here we have one extra variable, <code>dashboard_id</code>, used to update the specific dashboard. Besides that, we have the same dashboard properties with their updated content. Lastly, we call the <code>api.dashboardsV2Update()</code> method. Execute the following command in the Terminal:</p>
<pre class="console">
node update-dashboard.js</pre> <p>After successful execution of the script, it will print a response like the following:</p>
<pre class="source-code">
Dashboard Updated successfully.ArduinoDashboardv2 {
  id: '5b872702-059c-4895-a677-808981f31588',
  name: 'Dashboard Created via API Update',
  updated_at: 2023-04-19T17:39:28.378Z,
  created_by: ArduinoDashboardowner {
    user_id: 'f067c1e9-3ff8-4b9f-a9b4-f8c5c1d0ceb4',
    username: 'mafzalattari'
  }
}</pre> <p>After our update, the response<a id="_idIndexMarker711"/> will return the new content, reflecting the updated data for the name that we provided.</p>
<h2 id="_idParaDest-188"><a id="_idTextAnchor188"/>Deleting a dashboard</h2>
<p>In this section, we are going<a id="_idIndexMarker712"/> to explore how to delete a dashboard using the dashboard ID. The relevant documentation on deleting dashboards is available at <a href="https://www.arduino.cc/reference/en/iot/api/#api-DashboardsV2-dashboardsV2Delete">https://www.arduino.cc/reference/en/iot/api/#api-DashboardsV2-dashboardsV2Delete</a>. Open the <code>delete-dashboard.js</code> file under the <code>dashboard</code> folder in VSCode:</p>
<pre class="source-code">
    var api = new AiotApi.DashboardsV2Api()
    var dashboard_id="3681cdbe-ecb2-4237-a834-e3423c6bd8e3";
    var opts = {
    };
    api.dashboardsV2Delete(dashboard_id, opts).then(function(data) {
      console.log('Dashboard Deleted successfully.');
    }, function(error) {
      console.error(error);
    });</pre> <p>The preceding code snippet is taken from the <code>DeleteDashboard()</code> method from <code>delete-dashboard.js</code> file. In the <code>DeleteDashboard()</code> method we need to supply the <code>dashboard_id</code> and <code>opts</code> variables as parameters. <code>dashboard_id</code> is mandatory for the deletion process, while the <code>opts</code> variable is optional. Execute the following command in the Terminal:</p>
<pre class="console">
node delete-dashboard.js</pre> <p>After successful execution of the script, it will print the response on the console indicating that the dashboard <a id="_idIndexMarker713"/>was deleted successfully.</p>
<h2 id="_idParaDest-189"><a id="_idTextAnchor189"/>Listing dashboards</h2>
<p>In this section, we will list all the dashboards<a id="_idIndexMarker714"/> with complete details and widgets. The difference between listing dashboards and showing a dashboard is that listing dashboards will display all the dashboards available in the Arduino IoT Cloud, while showing a dashboard only shows the specific dashboard properties and widgets related to the given dashboard ID.</p>
<p>The documentation for listing dashboards is available at <a href="https://www.arduino.cc/reference/en/iot/api/#api-DashboardsV2-dashboardsV2List">https://www.arduino.cc/reference/en/iot/api/#api-DashboardsV2-dashboardsV2List</a>. Open <code>list-dashboard.js</code> under the <code>dashboard</code> folder in VSCode. The following code snippet is taken from the <code>ListDashboard()</code> method:</p>
<pre class="source-code">
    var api = new AiotApi.DashboardsV2Api()
    var opts = { };
    api.dashboardsV2List().then(function(data) {
      console.log(util.inspect(data));
    }, function(error) {
      console.error(error);
    });</pre> <p> Execute the following command in the Terminal:</p>
<pre class="console">
node list-dashboard.js</pre> <p>After successful execution<a id="_idIndexMarker715"/> of the script, it will print the response in JSON format containing the dashboard properties and widgets:</p>
<pre class="source-code">
[
  ArduinoDashboardv2 {
    id: '36287c03-5034-4a64-b40a-102740c998c6',
    name: 'SmartAgri-Sargodha',
    updated_at: 2023-03-05T11:00:18.395Z,
    created_by: ArduinoDashboardowner {
      user_id: 'f067c1e9-3ff8-4b9f-a9b4-f8c5c1d0ceb4',
      username: 'mafzalattari'
    },
    widgets: [
    ]
  },
  ArduinoDashboardv2 {
    id: '28ea7839-7a81-460e-a871-368d45d82cee',
    name: 'Tracking and notifying Your Heart Rate Dashboard',
    updated_at: 2023-04-19T16:41:36.604Z,
    created_by: ArduinoDashboardowner {
      user_id: 'f067c1e9-3ff8-4b9f-a9b4-f8c5c1d0ceb4',
      username: 'mafzalattari'
    },
    widgets: [ [ArduinoWidgetv2], [ArduinoWidgetv2] ]
  },
]</pre> <p>The preceding response contains all the properties related to dashboards such as widgets, creation date, update time, and so on. Next, we have another API endpoint related to showing a dashboard, which is used to display all the information regarding a single dashboard. The code is available in the <code>dashboard</code> folder; the execution of the code and checking out how it works is left to you as an independent exercise.</p>
<p>In these sub-sections, we discussed how to work programmatically with dashboards, including actions such<a id="_idIndexMarker716"/> as dashboard creation, updating, deletion, and showing the list of dashboards via the Arduino IoT Cloud Node.js SDK. In the next section, we will explore how we can use the Node.js SDK to fine-tune our cloud variables/properties.</p>
<h1 id="_idParaDest-190"><a id="_idTextAnchor190"/>Fine-tuning with the Node.js SDK – property value management</h1>
<p>In this section, we will look at how we can <em class="italic">set</em>/<em class="italic">get</em> cloud variable values using the SDK. This is very useful for<a id="_idIndexMarker717"/> performing bulk operations; for example, if you have 100 lights connected to the Arduino IoT Cloud, it will be difficult to control them all manually from a dashboard. Suppose switching one device on/off takes 3 seconds from the dashboard – with 100 devices this will require 300 seconds, a total of 5 minutes, along with the chance of human error (maybe the user misses one device due to bulk processing). But with the help of the SDK, we can perform bulk operations on Things, saving time and improving confidence in our ability to reach zero-error operations.</p>
<h2 id="_idParaDest-191"><a id="_idTextAnchor191"/>Get a property value</h2>
<p>Let’s first see how<a id="_idIndexMarker718"/> to get the last value of the cloud variable. To do this, we need the Thing ID and cloud variable ID. More precisely, we will get the complete properties of the cloud variable in JSON format here, but will only fetch <code>last_value</code> of the cloud variable. The relevant documentation can be found at <a href="https://www.arduino.cc/reference/en/iot/api/#api-PropertiesV2-propertiesV2Show.">https://www.arduino.cc/reference/en/iot/api/#api-PropertiesV2-propertiesV2Show.</a> Open the <code>get-prop.js</code> file under<a id="_idIndexMarker719"/> the <code>getset</code> folder in VSCode:</p>
<pre class="source-code">
var api = new IotApi.PropertiesV2Api()
    var thingid = "8aee742e-4492-423d-9f19-79fec856b917"; // {String} The id of the thing
    var propertyid = "182d7319-5c36-4988-a5b8-ace2df7bd08a"; // {String} The id of the property
    var opts = {
    'showDeleted': false // {Boolean} If true, shows the soft deleted properties
    };
    api.propertiesV2Show(thingid, propertyid, opts).then(function(data) {
    console.log('Last Value of Property=' + data.last_value);
    }, function(error) {
    console.error(error);
    });</pre> <p>The preceding code snippet was taken from the <code>GetProperty()</code> method. We have defined <code>thingid</code> and <code>propertyid</code> and then passed these variables to the <code>api.propertiesV2Show</code> method later in the snippet. After getting the response in JSON format, we only use the <code>last_value</code> property to display its data on the console. Run the following command on the Terminal:</p>
<pre class="console">
node get-prop.js</pre> <p>After successful <a id="_idIndexMarker720"/>execution, you will get the response with the value.</p>
<h2 id="_idParaDest-192"><a id="_idTextAnchor192"/>Set a property value</h2>
<p>In the previous section, we discussed<a id="_idIndexMarker721"/> how to get the last value of a cloud variable, and in this section, we will explore how to <code>set</code>/<code>publish</code> the value to a cloud variable. The relevant documentation can be found at <a href="https://www.arduino.cc/reference/en/iot/api/#api-PropertiesV2-propertiesV2Publish">https://www.arduino.cc/reference/en/iot/api/#api-PropertiesV2-propertiesV2Publish</a>. Open the <code>set-prop.js</code> file under the <code>getset</code> folder in VSCode:</p>
<pre class="source-code">
var api = new IotApi.PropertiesV2Api()
    var thingid = "8aee742e-4492-423d-9f19-79fec856b917"; // {String} The id of the thing
    var propertyid = "182d7319-5c36-4988-a5b8-ace2df7bd08a"; // {String} The id of the property
    var propertyValue = {
        'device_id':'5aae7e1f-940b-4426-80ac-1c953839cdb2',
        'value':true
    }; // {PropertyValue}
    api.propertiesV2Publish(thingid, propertyid, propertyValue).then(function(data) {
    console.log('Value Published to Property Successfully');
    }, function(error) {
    console.error(error);
    });</pre> <p>The preceding code snippet was taken from the <code>SetProperty()</code> method. Here, we provide three variables to the <code>api.propertiesV2Publish</code> method. The first is <code>thingid</code>, the second is <code>propertyid</code>, and the third variable contains the two further properties of <code>device_id</code> and <code>value</code>. Run the following command on the Terminal to execute the script:</p>
<pre class="console">
node set-prop.js</pre> <p>After successful execution, you will get a response indicating that the value has been updated successfully.</p>
<p>In the section, we discussed<a id="_idIndexMarker722"/> in detail how to get/set the value of a cloud variable programmatically. This helps developers to fetch values and display them in their custom dashboards, or set the values of cloud variables to control device operations. Next, you have an assignment of an example project for practice, which will help you to refine your skills and chapter study.</p>
<h1 id="_idParaDest-193"><a id="_idTextAnchor193"/>Assignment</h1>
<p>After playing with SDK, it’s now time to do some more experiments so you can apply your learning in new scenarios and solidify your learning. For this assignment, you will create a script for Thing automation with the following properties:</p>
<ol>
<li>Set up a method for <strong class="bold">WeMos D1 Mini</strong> device creation. This device belongs to the <strong class="bold">ESP8266</strong> category.</li>
<li>Set up a Thing named <code>Sense Environment</code> and create a sketch for a Thing. Then, associate the previously created device with the Thing.</li>
<li>Create three cloud variables/properties for temperature, humidity, and air quality and attach these variables to the previously created Thing.</li>
</ol>
<p>Create the required script in one file containing all the methods, where we just provide the Thing name and it will automatically set up the device, Thing, and sketch, handle device association with the Thing, and take care of variable creation. Successfully completing this task will teach you to automate workflows and processes efficiently and effectively.</p>
<h1 id="_idParaDest-194"><a id="_idTextAnchor194"/>Summary</h1>
<p>In this chapter, we covered API endpoints, SDKs, and the types of SDK platforms available to us on the Arduino IoT Cloud. We also learned how to test APIs with Postman. Next, we explored the Node.js SDK by performing different types of operations, particularly CRUD operations, on devices, Things, properties, and dashboards. Finally, we saw how to get and set the value of a cloud variable.</p>
<p>This chapter was specially designed for backend developers seeking to use the Arduino IoT Cloud as a foundation and wanting to develop a custom frontend for their solution, which is possible when you know how to interact with the Arduino IoT Cloud programmatically using the Node.js SDK. Likewise, the ability to create custom services allows us to integrate with third party cloud services and applications.</p>
<p>The next chapter will be more interesting as we are going to dive into smart agriculture, implementation a project where you will learn how to measure the soil moisture, soil temperature, and outdoor temperature and humidity. We will design a device that will allow us to monitor four different crops/plants. You could use this project to monitor your home plants as well as helping your friends working in the field of agriculture.</p>
</div>
</body></html>