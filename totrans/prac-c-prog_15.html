<html><head></head><body>
        

                            
                    <h1 class="header-title">Improving the Performance of Your Code</h1>
                
            
            
                
<p>In this chapter, we will learn how to speed up the execution of any C program. We will learn to keep the frequently used content in CPU registers, and we will learn how to take input faster from the user. We will also learn to apply loop unrolling in C programs.</p>
<p>The following are the recipes we will work through in this chapter:</p>
<ul>
<li>Using the <kbd>register</kbd> keyword in C code for better efficiency</li>
<li>Taking input faster in C</li>
<li>Applying loop unrolling for faster results</li>
</ul>
<p>Let's begin with the first recipe.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Using the register keyword in C code for better efficiency</h1>
                
            
            
                
<p>The access time when using registers is quite a bit lower than that of accessing content from any memory variable. So, to take advantage of this, content that is frequently used in any program is kept in registers. The <kbd>register</kbd> keyword is used to indicate the content that needs to be kept in these registers.</p>
<p>In this recipe, we will find out the cost of renting a car for a specified distance. The car rent not only depends on the distance but also on the type of car, that is, whether the car has <strong>air conditioning</strong> (<strong>AC</strong>) or not. The rent of the AC car per kilometer, the rent of the non-AC car per kilometer, and the service tax percentage values are all stored in register variables.</p>
<p class="mce-root"/>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<p>The steps for finding total car rent for a specified distance with a specified car type using register variables are as follows:</p>
<ol>
<li>The user is asked to enter the distance of the planned journey.</li>
<li>The user is asked to specify the type of the car, that is, whether the car should have AC or not.</li>
<li>Two register variables are defined to indicate the rent per kilometer for the AC and non-AC car, respectively.</li>
<li>One more register variable is defined that is set to represent the service tax percentage.</li>
<li>On the basis of the type of the car chosen by the user, the distance value is multiplied by the respective register variable to find out the total amount.</li>
<li>The service tax is computed and added to the total amount. The service tax percentage is accessed from the respective register variable.</li>
<li>The total rent of the car is displayed on the screen.</li>
</ol>
<p>The program for computing the total rent of the car for the specified car type and journey length using the register variables is as follows:</p>
<pre>//<strong>tourvehicle.c</strong><br/><br/>#include &lt;stdio.h&gt; <br/>#include &lt;string.h&gt; <br/><br/>int main() { <br/>    int distance;<br/>    char car_type[20]; <br/>    register int Acperkm,Nonacperkm,servicetax; <br/>    float carRent, totalrent; <br/><br/>    printf("How many kilometers? "); <br/>    scanf("%d", &amp;distance); <br/>    printf("AC car or non AC ac/non? "); <br/>    scanf("%s", car_type); <br/>    Acperkm=3; <br/>    Nonacperkm=2; <br/>    servicetax=1; <br/>    if(strcmp(car_type, "ac")==0) <br/>        carRent=distance*Acperkm; <br/>    else <br/>        carRent=distance*Nonacperkm; <br/>    totalrent=carRent + (carRent*servicetax/100); <br/>    printf("The total rent for the car will be $ %.2f\n",totalrent); <br/>    return 0; <br/>}</pre>
<p class="mce-root">Now, let's go behind the scenes to understand the code better.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How it works...</h1>
                
            
            
                
<p>The user is asked to specify how many kilometers the vehicle is required to be rented for. The value entered by the user is assigned to the <kbd>distance</kbd> variable. Thereafter, the user is asked to specify what kind of car they want to rent: an AC car or a non-AC car. The option entered by the user is assigned to the <kbd>car_type</kbd> variable. Three register variables are defined by the names <kbd>Acperkm</kbd>, <kbd>Nonacperkm</kbd>, and <kbd>servicetax</kbd>.</p>
<p>Because the register variables stay closer to the CPU and their access time is very low when compared to accessing content from memory variables, the register variables are used for those values that are frequently required in computation. The three register variables, <kbd>Acperkm</kbd>, <kbd>Nonacperkm</kbd>, and <kbd>servicetax</kbd>, are initialized to 3, 2, and 1, respectively, to indicate that the rate for an AC car is $3 per kilometer and that of a non-AC car is $2 per kilometer. The service tax is assumed to be 1% of the total amount.</p>
<p>String comparison is done to know the type of car that is specified by the user. If the type of car selected is an AC car, the values in the <kbd>distance</kbd> variable and the <kbd>Acperkm</kbd> register variable are multiplied.</p>
<p>Similarly, if the type of car selected is a non-AC car, the values in the <kbd>distance</kbd> and <kbd>Nonacperkm</kbd> variables are multiplied together. The result of the multiplication is the total amount to be assigned to the <kbd>carRent</kbd> variable. To this total amount, a 1% service tax rate is added to find out the total rent. The total rent of the car for the specified distance and type of car is then displayed on the screen.</p>
<p>The program is compiled using GCC, as shown in the following screenshot. Because no errors appear on compilation, that means the <kbd>tourvehicle.c</kbd> program has successfully been compiled into an EXE file, <kbd>tourvehicle.exe</kbd>. On executing the file, the user is prompted to enter the number of kilometers for which the car is required on rent. The user will also be asked to specify the type of car that is required on rent. The program then displays the total rent of the car, as shown in the screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img src="img/9fb9c91b-a0a1-4c7a-83b8-95b09bb6454a.png" style="width:28.58em;height:9.25em;"/></p>
<p>Figure 15.1</p>
<p>Voilà! We have successfully used register variables to speed up processing in C. Now let's move on to the next recipe!</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Taking input faster in C</h1>
                
            
            
                
<p>In this recipe, we will learn to take input faster from the user. We will ask the user to enter a number and the entered number will be displayed on the screen. We will make use of the <kbd>getchar_unlocked()</kbd> function for this purpose.</p>
<p>The <kbd>getchar_unlocked()</kbd> function works similarly to <kbd>getchar()</kbd> function, with the difference that it is not thread-safe. As a result, it overlooks certain input constraints and so is quite a bit faster than <kbd>getchar()</kbd>. It is used for taking long input data in a situation where a single thread is being used for handling input and other streams.</p>
<p class="mce-root"/>
<p class="mce-root"/>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it…</h1>
                
            
            
                
<p>The steps for taking a number from the user using a faster input approach are as follows:</p>
<ol>
<li>The user is asked to enter a number.</li>
<li>The number that will be entered by the user is accepted by the <kbd>getchar_unlocked()</kbd> function. Only one digit at a time is accepted by this function.</li>
<li>The value entered by the user is first checked to ensure that it is a digit only. If it is not, the user is asked to re-enter the value.</li>
<li>If the value entered by the user is a digit, its ASCII value is saved in the variable. This is because <kbd>getchar_unlocked()</kbd> assigns the ASCII value of the entered value to the variable.</li>
<li>From the ASCII of the entered value, 48 is subtracted to convert it into the actual digit that the user has entered.</li>
<li>If the digit is the first digit entered by the user, then it is simply assigned to another variable. But if it is not the first digit, then the existing digit in the variable is multiplied by 10 and the new digit is then added to the variable.</li>
<li><em>Steps 2</em> through <em>7</em> are repeated for every digit entered by the user until the user presses the <em>Enter</em> key.</li>
<li>The number in the variable is the actual number entered by the user and, hence, is displayed on the screen.</li>
</ol>
<p>The program for entering a number using a fast input technique is as follows:</p>
<pre>//<strong>fastinp.c</strong><br/><br/>#include &lt;stdio.h&gt; <br/><br/>int getdata() { <br/>    char cdigit = getchar_unlocked(); <br/>    int cnumb = 0; <br/>    while(cdigit&lt;'0' || cdigit&gt;'9') cdigit = getchar_unlocked(); <br/>    while(cdigit &gt;='0' &amp;&amp; cdigit &lt;='9') { <br/>        cnumb = 10 * cnumb + cdigit - 48; <br/>        cdigit = getchar_unlocked(); <br/>    } <br/>    return cnumb; <br/>} <br/><br/>int main() <br/>{ <br/>    int numb; <br/>    printf("Enter a number "); <br/>    numb=getdata(); <br/>    printf("The number entered is %d\n",numb); <br/>    return 0; <br/>}</pre>
<p class="mce-root">Now, let's go behind the scenes to understand the code better.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How it works...</h1>
                
            
            
                
<p>The user is asked to enter a number. A user-defined <kbd>getdata()</kbd> function is invoked and the value returned by the function is assigned to the <kbd>numb</kbd> variable, which in return is then displayed on the screen. The <kbd>getdata</kbd> function will keep asking for the digits of the number and will return the number when the <em>Enter</em> key is pressed.</p>
<p>Let's assume that the user wants to enter <kbd>20</kbd>. Within the <kbd>getdata</kbd> function, the <kbd>getchar_unlocked()</kbd> function is invoked. So, on entering the first digit, 2 (of the number 20), it will be assigned to the <kbd>cdigit</kbd> variable, which is of the character data type. The ASCII value of 2 is 50, so the value 50 is actually assigned to the <kbd>cdigit</kbd> variable.</p>
<p>Before proceeding further, we ensure that the value entered by the user is a digit, and not a character or some other symbol. If the user enters something other than a digit, the <kbd>getchar_unlocked()</kbd> function is again invoked, asking the user to enter a valid digit. If the value entered is a digit, then 48 is subtracted from its ASCII value to convert it to its actual value. This is because the ASCII value of 2 is 50; on subtracting 48 from 50, the result will be 2, which is the actual digit that was entered by the user. The value of 2 is assigned to the <kbd>cnumb</kbd> variable.</p>
<p>Since the next digit of the number 20 is 0, the <kbd>getchar_unlocked ()</kbd> function is invoked and the value 0 is assigned to the <kbd>cdigit</kbd> variable. Again, it is checked that the value entered by the user is a digit and nothing else. The ASCII value of 0 is 48. From the ASCII value of 0, the value 48 is subtracted to make its value 0. The current value in <kbd>cnumb</kbd> is 2, which is then multiplied by 10 and the value of <kbd>cdigit</kbd> is added to the result. The result of this computation will be 20 and it is assigned to the <kbd>cnumb</kbd> variable. The value in the <kbd>cnumb</kbd> variable is returned to the main function to be displayed.</p>
<p>In short, whatever digit is entered by the user, its ASCII value is assigned to the variable and the numerical value 48 is subtracted from the ASCII value of the digit to convert it into the actual digit that was entered by the user.</p>
<p class="mce-root"/>
<p>The program is compiled using GCC, as shown in the following screenshot. Because no error appears on compilation, that means the <kbd>fastinp.c</kbd> program has successfully been compiled into an EXE file, <kbd>fastinp.exe</kbd>. On executing the file, the user is prompted to enter a number. The number is accepted using a fast input technique. After entering all the digits of the number, when the user presses the <em>Enter</em> key, the entered number is displayed on the screen as shown in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img src="img/6fde6641-6ea1-4041-8752-3f6cd84bb150.png" style="width:24.17em;height:7.83em;"/></p>
<p>Figure 15.2</p>
<p>Voilà! We have successfully configured faster input of numbers in C. Now let's move on to the next recipe!</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Applying loop unrolling for faster results</h1>
                
            
            
                
<p class="mce-root">In this recipe, we will learn to print the sum of a sequence of numbers from 1 to a limit entered by the user using the loop unrolling technique. Loop unrolling means reducing or removing the loops from the program to reduce overheads applied while running the loops. Basically, for running a loop, the operating system has to manage two overheads – the first overhead is to maintain the count of the loop and the second overhead is to do conditional branching. Loop unrolling helps in avoiding these two overheads. Let's see how.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it…</h1>
                
            
            
                
<p>The steps for finding the sum of the first <em>n</em> sequence of numbers using the loop unrolling technique are as follows:</p>
<ol>
<li>The <kbd>sum</kbd> variable in which the addition of sequence numbers will be stored is initialized to 0.</li>
</ol>
<ol start="2">
<li>The user is asked to enter the limit up to which the sum of the sequence of numbers is desired. The value entered by the user is assigned to the <kbd>limit</kbd> variable.</li>
<li>We need to find the number between 9 to 1 that perfectly divides the value in the <kbd>limit</kbd> variable. To find this, we set a <kbd>for</kbd> loop to execute from 9 to 1.</li>
<li>Within the <kbd>for</kbd> loop, the value in the <kbd>limit</kbd> variable is divided by the <kbd>for</kbd> loop variable.</li>
<li>If the number in the <kbd>limit</kbd> variable is divisible by the <kbd>for</kbd> loop variable, the <kbd>for</kbd> loop will break.</li>
<li>If the number in the <kbd>limit</kbd> variable is not divisible by the <kbd>for</kbd> loop variable, the next iteration of the loop is executed with a reduced value, that is, with the value of 8. The steps are repeated until the value in the <kbd>limit</kbd> variable is perfectly divisible by the <kbd>for</kbd> loop variable.</li>
<li>Once we get the integer by which the limit is divisible, we reduce the number of <kbd>for</kbd> loops by that integer, that is, the increment of the <kbd>for</kbd> loop is set to that integer value.</li>
<li>Within the <kbd>for</kbd> loop, a <kbd>while</kbd> loop is used that adds the sequence of numbers into the <kbd>sum</kbd> variable.</li>
<li>Finally, the addition of the sequence of numbers in the <kbd>sum</kbd> variable is displayed on the screen.</li>
</ol>
<p>The program for printing the sum of a sequence of numbers using the loop unrolling technique is as follows:</p>
<pre>//<strong>loopunrolling.c</strong><br/><br/>#include &lt;stdio.h&gt; <br/><br/>int main() { <br/>    int sum,i,limit,rem,quot,incr,x, count; <br/>    sum = 0; <br/>    printf("Enter limit "); <br/>    scanf("%d", &amp;limit); <br/>    for(i=9;i&gt;=1;i--) <br/>    { <br/>        rem=limit % i; <br/>        if (rem==0) break; <br/>    } <br/>    incr=i; <br/>    count=0; <br/>    for(i=1;i&lt;=limit; i+=incr) <br/>    { <br/>        x=0; <br/>        while(x&lt;incr) <br/>        { <br/>            sum += i+x; <br/>            x++; <br/>        } <br/>        count++; <br/>    }<br/>    printf("The sum of first %d sequence numbers is %d\n",limit, sum);<br/>    printf("The loop executed for %d number of times\n",count);<br/>    return 0; <br/>}</pre>
<p class="mce-root">Now, let's go behind the scenes to understand the code better.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How it works...</h1>
                
            
            
                
<p>This program finds the sum of sequence numbers from 1 up to the limit entered by the user. The user is asked to enter the limit, and the value entered by the user is assigned to the <kbd>limit</kbd> variable. For adding the sequence numbers, we will make use of a <kbd>for</kbd> loop. To do loop unrolling or to reduce the number of iterations of the loop, we find the integer by which the limit can be divided. That is, we divide the value in the <kbd>limit</kbd> variable by integers from 9 to 1. Once we get the integer by which the limit is divisible, we reduce the number of <kbd>for</kbd> loops by that integer.</p>
<p>Let's assume that the user enters a limit of 40, which is assigned to the <kbd>limit</kbd> variable. A <kbd>for</kbd> loop is set to run from the values 9 to 1, and every value from 9 to 1 will be used to try to divide the value in the <kbd>limit</kbd> variable. On any division, if the remainder appears as 0, the <kbd>for</kbd> loop will break; else, the next iteration will execute with the decreased value. Currently, the value in the <kbd>limit</kbd> variable is 40 and the value of <kbd>i</kbd> in the first iteration is 9. The remainder of dividing 40 by 9 is a non zero value, so the next iteration of the <kbd>for</kbd> loop will begin with the next decreased value, 8.</p>
<p>Because, on dividing 40 by 8, you get a remainder of 0, the <kbd>for</kbd> loop will break and the control will jump to the statement immediately after the <kbd>for</kbd> loop. The value of <kbd>i</kbd> at that time is 8, so the value of 8 is assigned to the <kbd>incr</kbd> variable. That is, the <kbd>for</kbd> loop will increment by a value of 8. It also means that we are applying loop unrolling by reducing the iterations of the <kbd>for</kbd> loop by 8 times. In other words, the <kbd>for</kbd> loop will be set to run from 1 until the limit, which is 40, with an increment of 8 after every iteration.</p>
<p class="mce-root"/>
<p class="mce-root"/>
<p>In the first iteration, the value of <kbd>i</kbd> is 1. The <kbd>sum</kbd> variable, in which the addition of the sequence of numbers will be computed, is initialized to 0. The value of <kbd>i</kbd> is added to the <kbd>sum</kbd> variable. As said earlier, the next iteration of the <kbd>for</kbd> loop will increment the value of <kbd>i</kbd> by 8. So, within the <kbd>for</kbd> loop, a <kbd>while</kbd> loop is used. Within the <kbd>while</kbd> loop, a variable, <kbd>x</kbd>, is used that executes from 0 to the value of the <kbd>incr</kbd> variable (that is, until the value of 8). In other words, the <kbd>while</kbd> loop will add the sequence of numbers from 1 to 8 into the <kbd>sum</kbd> variable.</p>
<p>Once the sum of the first eight values of the sequence of numbers is computed and assigned to the <kbd>sum</kbd> variable, the next iteration of the <kbd>for</kbd> loop will begin with the value of <kbd>i</kbd> incremented to 9. Again within the <kbd>for</kbd> loop, the <kbd>while</kbd> loop will execute to compute the sum of the sequence of numbers from 9 to 16. Again, the next iteration of the <kbd>for</kbd> loop will increase the value of <kbd>i</kbd> to 17. The process continues until the <kbd>for</kbd> loop completes. In short, the <kbd>for</kbd> loop is unrolled to the value assigned to the <kbd>incr</kbd> variable. Finally, the sum of the sequence of numbers is displayed on the screen.</p>
<p>The program is compiled using GCC, as shown in the following screenshot. Because no error appears on compilation, that means the <kbd>loopunrolling.c</kbd> program has successfully been compiled into an EXE file, <kbd>loopunrolling.exe</kbd>. On executing the file, the user is prompted to enter the limit up to which the sum of the sequence of numbers is desired. The program will not only print the sum of the sequence of numbers but will also print how many loop iterations it took for the sum to be computed, as shown in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img src="img/e620d676-79ab-408a-8c1e-b2142318be78.png" style="width:28.92em;height:8.58em;"/></p>
<p>Figure 15.3</p>
<p>Voilà! We have successfully executed loop unrolling to generate a faster result.</p>


            

            
        
    </body></html>