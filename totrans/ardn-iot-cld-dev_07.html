<html><head></head><body>
<div><h1 class="chapter-number" id="_idParaDest-141"><a id="_idTextAnchor141"/>7</h1>
<h1 id="_idParaDest-142"><a id="_idTextAnchor142"/>Enabling Communication between Different Devices</h1>
<p>This<a id="_idIndexMarker553"/> chapter is dedicated to <strong class="bold">thing-to-thing communication</strong> (<strong class="bold">TTC</strong>), which is a very important concept and requirement in the field of<a id="_idIndexMarker554"/> the <strong class="bold">Internet of Things</strong> (<strong class="bold">IoT</strong>). You can also call it <strong class="bold">Device-to-Device</strong> (<strong class="bold">D2D</strong>) communication. D2D <a id="_idIndexMarker555"/>communication plays a vital role in complex systems where one device’s operations are totally dependent on another device. For example, say you want to control your room’s AC according to outdoor weather conditions; here, D2D communication plays a vital role by sending the outdoor temperature to the room’s AC controller device so it knows whether it needs to cool or heat the room according to the weather outside.</p>
<p>Arduino IoT Cloud<a id="_idIndexMarker556"/> provides a cloud variable synchronization feature across multiple things, as well as for dashboards, which helps us to build complex systems easily. This chapter explains the usage of the synchronization feature for the implementation of<a id="_idIndexMarker557"/> cloud <strong class="bold">graphical user interfaces</strong> (<strong class="bold">GUIs</strong>) and D2D communication purposes.</p>
<p>In this chapter, you will learn how to sync a cloud variable across things using the GUI without writing any complex code. This chapter will help you set up communication between things with just a couple of clicks without writing any lengthy code. It will also help you to develop solutions that are totally dependent upon other device’s sensor data. You will also learn how to create a single dashboard for multiple things so you can display their readings in one place, which helps the user monitor everything from one display without navigating to other dashboards.</p>
<p>In this chapter, we’re going to cover the following main topics:</p>
<ul>
<li>What is D2D communication in the IoT cloud?</li>
<li>The benefits of Arduino IoT Cloud thing-to-thing communication</li>
<li>Hardware components – sensors and development boards</li>
<li>Project architecture</li>
<li>Setting up a Thing</li>
<li>Implementation of GUIs using synchronized cloud variables</li>
<li>Limitations of cloud variable/property synchronization</li>
<li>What next?</li>
</ul>
<h1 id="_idParaDest-143"><a id="_idTextAnchor143"/>Technical requirements</h1>
<p>The following are required to complete this chapter’s exercise:</p>
<ul>
<li>Complete <a href="B19752_04.xhtml#_idTextAnchor085"><em class="italic">Chapter 4</em></a> of this book</li>
<li>MKR Wi-Fi 1010</li>
<li>1x 5 mm red LED and 1x 5 mm green LED</li>
<li>A breadboard</li>
<li>Jumper cables</li>
</ul>
<p>We will use the <strong class="bold">Arduino Web Editor</strong> for<a id="_idIndexMarker558"/> coding, which includes a large collection of development boards and sensor libraries, and <strong class="bold">Arduino IoT Cloud</strong> for<a id="_idIndexMarker559"/> thing and dashboard setup. The chapter code is available in the official book GitHub repository by following this link: <a href="https://github.com/PacktPublishing/Arduino-IoT-Cloud-for-Developers">https://github.com/PacktPublishing/Arduino-IoT-Cloud-for-Developers</a>.</p>
<h1 id="_idParaDest-144"><a id="_idTextAnchor144"/>What is D2D communication in the IoT cloud?</h1>
<p>D2D communication <a id="_idIndexMarker560"/>in the context of IoT and the IoT cloud refers to the ability of IoT devices to directly exchange data or information with each other without relying on a central server or cloud-based service as an intermediary. This form of communication is also known as <strong class="bold">Peer-to-Peer</strong> (<strong class="bold">P2P</strong>) communication<a id="_idIndexMarker561"/> among IoT devices.</p>
<p>Here are some key points to understand about D2D communication in the IoT cloud:</p>
<ul>
<li><strong class="bold">Direct communication</strong>: In <a id="_idIndexMarker562"/>traditional IoT architectures, devices send data to a cloud platform, where it is processed and potentially shared with other devices. D2D communication allows devices to talk to each other directly, bypassing the cloud when necessary.</li>
<li><strong class="bold">Low latency</strong>: D2D <a id="_idIndexMarker563"/>communication can reduce latency because data doesn’t have to travel to a remote server and back. This is crucial in applications where real-time or near-real-time responses are required, such as in industrial automation or connected vehicles.</li>
<li><strong class="bold">Efficiency</strong>: By<a id="_idIndexMarker564"/> enabling devices to communicate directly, it can reduce the load on cloud servers and bandwidth usage, making the IoT system more efficient and cost-effective.</li>
<li><strong class="bold">Offline operation</strong>: D2D<a id="_idIndexMarker565"/> communication can work even when devices are not connected to the internet or the cloud. This can be especially useful in scenarios where intermittent connectivity is common, such as in remote areas or emergency situations.</li>
<li><strong class="bold">Security</strong>: Implementing<a id="_idIndexMarker566"/> direct communication between devices requires robust security measures to protect data and ensure the authenticity of messages. Encryption and authentication mechanisms are essential to prevent unauthorized access.</li>
<li><strong class="bold">Use cases</strong>: D2D communication<a id="_idIndexMarker567"/> can be used in various IoT applications. For example, in a smart home, IoT devices such as thermostats and lights can communicate directly to coordinate actions without needing to send data to a central server. In agriculture, sensors on farm equipment can communicate directly to optimize tasks.</li>
<li><strong class="bold">Protocols</strong>: Various <a id="_idIndexMarker568"/>communication protocols can<a id="_idIndexMarker569"/> facilitate D2D communication in IoT, including <strong class="bold">Message Queuing Telemetry Transport</strong> (<strong class="bold">MQTT</strong>), <strong class="bold">Constrained Application Protocol</strong> (<strong class="bold">CoAP</strong>), Bluetooth, and <strong class="bold">Zigbee</strong>. The choice of protocol depends on <a id="_idIndexMarker570"/>factors<a id="_idIndexMarker571"/> such as range, data volume, and power consumption.</li>
<li><strong class="bold">Challenges</strong>: While <a id="_idIndexMarker572"/>D2D communication provides many benefits, it also presents challenges, such as ensuring interoperability between devices from different manufacturers and managing the complexities of decentralized communication.</li>
</ul>
<p>In summary, D2D communication in IoT cloud environments allows IoT devices to communicate directly with each other, which provides benefits such as reduced latency, improved efficiency, and offline operation. However, it also requires careful planning and security measures to ensure the reliability and integrity of the communication network.</p>
<p>In this section, we explored the benefits and challenges of D2D communication, which is very important in IoT infrastructure and solution development. In the next section, we will explore what type of option Arduino IoT Cloud is providing for TTC.</p>
<h1 id="_idParaDest-145"><a id="_idTextAnchor145"/>The benefits of Arduino IoT Cloud thing-to-thing communication</h1>
<p>Arduino IoT Cloud<a id="_idIndexMarker573"/> is a platform that’s designed to simplify the development and management of IoT projects using Arduino boards and other compatible hardware. When it comes to TTC in the context of Arduino IoT Cloud, there are several benefits:</p>
<ul>
<li><strong class="bold">Ease of integration</strong>: Arduino<a id="_idIndexMarker574"/> IoT Cloud provides a user-friendly interface for connecting and configuring IoT devices, making it easier to establish communication between devices. Users can quickly set up and manage the connections between their Arduino boards and other IoT devices.</li>
<li><strong class="bold">Remote control</strong>: You can use TTC to control one Arduino device from another. For example, you could use one Arduino device to control a light bulb in another room.</li>
<li><strong class="bold">Scalability</strong>: Arduino IoT Cloud allows you to scale your IoT projects easily. You can add new devices to your network and configure their communication parameters without extensive programming, making it suitable for both small-scale and large-scale IoT deployments.</li>
<li><strong class="bold">Reduced latency</strong>: Direct communication between IoT devices within the same network can significantly reduce latency compared to sending data to an external cloud server and back. This is crucial for real-time applications, where low latency is essential.</li>
<li><strong class="bold">Energy efficiency</strong>: Arduino IoT Cloud allows you to optimize the power consumption of your devices by controlling when and how they communicate with each other. This can extend the battery life of battery-powered IoT devices.</li>
<li><strong class="bold">Customizable logic</strong>: You can program custom logic for TTC to suit your specific project requirements. This flexibility enables you to implement complex behaviors and automation in your IoT system.</li>
<li><strong class="bold">Security</strong>: Arduino IoT Cloud provides security features to help protect the communication between your devices, including encryption and authentication mechanisms. This ensures that data exchanged between devices remains secure.</li>
<li><strong class="bold">Cost efficiency</strong>: By reducing the reliance on external cloud services and minimizing data transfer costs, Arduino <a id="_idIndexMarker575"/>IoT Cloud can be a cost-effective solution for IoT projects, especially when dealing with a large number of devices.</li>
<li><strong class="bold">Compatibility</strong>: Arduino IoT Cloud supports a wide range of Arduino boards and compatible hardware, making it accessible to a broad user base. This compatibility simplifies the <a id="_idIndexMarker576"/>process of implementing TTC for Arduino-based IoT projects.</li>
</ul>
<p>In summary, Arduino IoT Cloud simplifies TTC in IoT projects, providing features such as ease of integration, scalability, reduced latency, energy efficiency, offline operation, customization, security, cost efficiency, and broad hardware compatibility. These features make it a valuable platform for developing and managing IoT systems that rely on direct communication between devices.</p>
<p>In this section, we have discussed the benefits of Arduino IoT Cloud TTC. In the next section, we will explore what hardware components we require to do this chapter’s exercise.</p>
<h1 id="_idParaDest-146"><a id="_idTextAnchor146"/>Hardware components – sensors and development boards</h1>
<p>In this chapter, we are going to explore how to sync cloud variables across multiple Arduino IoT Cloud things. So, here we will use the same thing, including a development board and sensors, that was used in <a href="B19752_04.xhtml#_idTextAnchor085"><em class="italic">Chapter 4</em></a>. For this chapter’s demonstration, we are going to use Arduino MKR Wi-Fi 1010 along with two 5 mm LEDs, a red one and a green one. The complete project is summarized in <em class="italic">Figure 7</em><em class="italic">.1.</em></p>
<div><div><img alt="Figure 7.1 – Project architecture" src="img/B19752_07_01.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.1 – Project architecture</p>
<p>As shown in <em class="italic">Figure 7</em><em class="italic">.1</em>, we use one WeMos D1 mini development board, which is based on ESP8266, and the whole project is demonstrated in <a href="B19752_04.xhtml#_idTextAnchor085"><em class="italic">Chapter 4</em></a>. The purpose of using different types of boards in this chapter is to demonstrate how easy it is to sync the cloud variables across different types of development boards. In the next section, we will talk in detail about project architecture.</p>
<h1 id="_idParaDest-147"><a id="_idTextAnchor147"/>Project architecture</h1>
<p>In this section, we will discuss how cloud variable synchronization<a id="_idIndexMarker577"/> works. As shown in <em class="italic">Figure 7</em><em class="italic">.1</em>, we have taken the project from <a href="B19752_04.xhtml#_idTextAnchor085"><em class="italic">Chapter 4</em></a>. In that project, we set up a device that monitors outdoor temperature, humidity, and air quality. Now, we want to share the outdoor temperature with our indoor device, which is the MKR Wi-Fi 1010. To make things easier, we just used LEDs with MKR Wi-Fi 1010, which is shown in <em class="italic">Figure 7</em><em class="italic">.2</em>. Our indoor device will turn on the red LED if the temperature exceeds the specified threshold and turn on the green LED if it comes down below a specified threshold. You can also use relays instead of LEDs to control the heating and cooling system of your room.</p>
<p>We already have one complete thing in Arduino IoT Cloud that is working, but now we need to create another thing for MKR Wi-Fi 1010 <a id="_idIndexMarker578"/>named <strong class="bold">Indoor MKR Wi-Fi 1010</strong> with a bunch of cloud variables. We will then sync the temperature cloud variable of the Indoor MKR Wi-Fi 1010 thing with the Sense the Environment thing, which was created in <a href="B19752_04.xhtml#_idTextAnchor085"><em class="italic">Chapter 4</em></a>.</p>
<p>In the preceding sections, we discussed the module and development board in detail. Now, it’s time to begin the exercise. In hardware development, before we start working with sensors and development boards, we need to develop design concepts to get a better understanding of how things will connect. There is a lot of software available for designing and<a id="_idIndexMarker579"/> developing design concepts for an electronics project, but in this case, we will use <strong class="bold">Fritzing</strong>.</p>
<p>In the following subsection, we will talk about the schematics of a project while explaining how to connect pins with a development board.</p>
<h2 id="_idParaDest-148"><a id="_idTextAnchor148"/>Schematics design and assembly</h2>
<p>The purpose of schematic design is to get a clear understanding of how sensors/LEDs will connect with a development board. This helps engineers to develop a prototype on a breadboard<a id="_idIndexMarker580"/> or a <strong class="bold">Veroboard</strong>. <em class="italic">Figure 7</em><em class="italic">.2</em> shows a schematic diagram of how LEDs are connected to the MKR Wi-Fi 1010 development board.</p>
<div><div><img alt="Figure 7.2 – MKR Wi-Fi 1010 and LEDs schematic diagram" src="img/B19752_07_02.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.2 – MKR Wi-Fi 1010 and LEDs schematic diagram</p>
<p>In <em class="italic">Figure 7</em><em class="italic">.2</em>, we have one common ground from MKR Wi-Fi 1010, which is shared with both LEDs using a yellow line. The red LED is connected to MKR Wi-Fi 1010 by using <em class="italic">Pin #6</em> and the green LED is using <em class="italic">Pin #7</em> of the MKR Wi-Fi 1010 development board.</p>
<p>In this section, we have discussed how cloud sync works and how we connect the LEDs with MKR Wi-Fi 1010. In the next section, we will set up the Thing for MKR Wi-Fi 1010 as well as device association and network configuration; and, most importantly, we will create the cloud variables and sync them with other things.</p>
<h1 id="_idParaDest-149"><a id="_idTextAnchor149"/>Setting up a Thing</h1>
<p>After setting up the hardware, it’s time<a id="_idIndexMarker581"/> to set up a thing in Arduino IoT Cloud. For this project, we need three cloud variables. Later on, we will associate MKR Wi-Fi 1010 with our thing. Next, we will perform the Wi-Fi network configuration. <em class="italic">Figure 7</em><em class="italic">.3</em> shows a complete overview of the Thing:</p>
<div><div><img alt="Figure 7.3 – Indoor device MKR Wi-Fi 1010 thing setup" src="img/B19752_07_03.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.3 – Indoor device MKR Wi-Fi 1010 thing setup</p>
<p>Set up a new thing <a id="_idIndexMarker582"/>called <code>Indoor Device MKR Wi-Fi 1010</code>. In <em class="italic">Figure 7</em><em class="italic">.3</em>, the following steps are marked with red boxes. Follow these steps to create variables, associate a device, configure the network, and, finally, write the code:</p>
<ol>
<li>Firstly, we need to set up three cloud variables for the green LED, the red LED, and temperature (which will be synced with another thing cloud variable). A more detailed discussion of cloud variables is in the upcoming section.</li>
<li>After that, we need to associate the device with the Thing. In the current project, we are using MKR Wi-Fi 1010. More details are available in the <em class="italic">Associating a device</em> subsection of this chapter.</li>
<li>After attaching the device, we need to make the device network-ready by providing an SSID and a password for the Wi-Fi network. Just click on the <strong class="bold">Configure</strong> button (if the network is empty, then you will see the <strong class="bold">Configure</strong> button. Otherwise, you will see the <strong class="bold">Change</strong> button) and you will see the popup for network<a id="_idIndexMarker583"/> settings.</li>
</ol>
<p>We have discussed the process of setting up a thing, and all these steps will be explained in detail in the proceeding subsections. We will start with the <em class="italic">Cloud variables</em> subsection, where we will create cloud variables for our thing as well as synchronize them.</p>
<h2 id="_idParaDest-150"><a id="_idTextAnchor150"/>Cloud variables</h2>
<p>The following table describes all the<a id="_idIndexMarker584"/> properties of the cloud variables that we need to configure. For this project, we need three cloud variables, as listed in <em class="italic">Table 7.1</em>. Next, make sure each variable matches the <strong class="bold">Declaration</strong> in the table; otherwise, you need to modify the example code according to your naming.</p>
<p>When we created the cloud variables, we made the permission read-only for all variables except <code>Temperature</code> because we need this cloud variable to sync with the <code>Temperature</code> cloud variable of the Sense the Environment thing in <a href="B19752_04.xhtml#_idTextAnchor085"><em class="italic">Chapter 4</em></a>. That’s why this variable’s permissions are set to <strong class="bold">Read &amp; Write</strong>. <strong class="bold">Update Policy</strong> is set to <strong class="bold">On change</strong> for all variables.</p>
<table class="No-Table-Style _idGenTablePara-1" id="table001-4">
<colgroup>
<col/>
<col/>
<col/>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="bold">S#</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Variable Name</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Variable Type</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Declaration</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Permission</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Update </strong><strong class="bold">Policy</strong></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p><code>GreenLed</code></p>
</td>
<td class="No-Table-Style">
<p>Boolean</p>
</td>
<td class="No-Table-Style">
<p><code>greenLed</code></p>
</td>
<td class="No-Table-Style">
<p>Read Only</p>
</td>
<td class="No-Table-Style">
<p>On change</p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>2</p>
</td>
<td class="No-Table-Style">
<p><code>RedLed</code></p>
</td>
<td class="No-Table-Style">
<p>Boolean</p>
</td>
<td class="No-Table-Style">
<p><code>redLed</code></p>
</td>
<td class="No-Table-Style">
<p>Read Only</p>
</td>
<td class="No-Table-Style">
<p>On change</p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>3</p>
</td>
<td class="No-Table-Style">
<p><code>Temperature</code></p>
</td>
<td class="No-Table-Style">
<p>Temperature sensor</p>
</td>
<td class="No-Table-Style">
<p><code>Temperature</code></p>
</td>
<td class="No-Table-Style">
<p>Read &amp; Write</p>
</td>
<td class="No-Table-Style">
<p>On change</p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 7.1 – Cloud variables list for things</p>
<p>Use <em class="italic">Table 7.1</em> to create the <code>GreenLed</code> and <code>RedLed</code> cloud variables. The creation of the <code>Temperature</code> cloud variable will be discussed step by step; we are going to sync this cloud variable with the Thing cloud variable from <a href="B19752_04.xhtml#_idTextAnchor085"><em class="italic">Chapter 4</em></a>. <em class="italic">Figure 7</em><em class="italic">.4</em> shows the first step of creating<a id="_idIndexMarker585"/> the <code>Temperature</code> cloud variable.</p>
<div><div><img alt="Figure 7.4 – Temperature cloud variable step 1" src="img/B19752_07_04.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.4 – Temperature cloud variable step 1</p>
<p>In this step, we will<a id="_idIndexMarker586"/> assign a name to the cloud variable, which is shown in <em class="italic">Figure 7</em><em class="italic">.4</em>. Next, we will click on <strong class="bold">Sync with other Things</strong>. This will open a new popup, which is shown in <em class="italic">Figure 7</em><em class="italic">.5</em>.</p>
<div><div><img alt="Figure 7.5 – Temperature cloud variable step 2" src="img/B19752_07_05.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.5 – Temperature cloud variable step 2</p>
<p>In this popup, you will find <a id="_idIndexMarker587"/>a complete list of cloud variables across all the things that are available in your Arduino IoT Cloud. To prevent complexity and errors, select a specific thing. We selected the <strong class="bold">Sense the Environment</strong> thing from the dropdown, which is marked by a red box in <em class="italic">Figure 7</em><em class="italic">.5</em>. After selecting the Thing from drop down, you will only see the associated cloud variable of that thing in popup. Click on the <strong class="bold">Temperature</strong> cloud variable checkbox and then click on the <strong class="bold">SYNCHRONIZE VARIABLES</strong> button. <em class="italic">Figure 7</em><em class="italic">.6</em> shows the final popup, where you will find the final status of the cloud variable sync status.</p>
<div><div><img alt="Figure 7.6 – Temperature cloud variable step 3" src="img/B19752_07_06.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.6 – Temperature cloud variable step 3</p>
<p>In <em class="italic">Figure 7</em><em class="italic">.6</em>, you will see<a id="_idIndexMarker588"/> the status of the cloud variable sync status, which is marked by a red box. Remember that for sync variables, you must choose <strong class="bold">Read &amp; Write</strong> permission or it will not work properly. Then save the cloud variable, and we are good to go. After going through these steps, you should have an idea of how easy it is to sync cloud variables across multiple things within seconds by just using a simple interface.</p>
<p class="callout-heading">Important note</p>
<p class="callout">Remember that for sync variables, you must choose the <strong class="bold">Read &amp; Write</strong> permission or it will not work properly.</p>
<p>In this section, we discussed the types of cloud variables that are required for this project. We listed three cloud variables of different types and also discussed in detail how to sync the cloud variable from one thing to another thing. Next, we are going to associate the MKR Wi-Fi 1010 with the Thing.</p>
<h2 id="_idParaDest-151"><a id="_idTextAnchor151"/>Associating a device</h2>
<p>After creating the variables, it’s <a id="_idIndexMarker589"/>time to add the device and associate it with the Thing:</p>
<ol>
<li>Before adding the<a id="_idIndexMarker590"/> device, connect the development board to the computer and open the <strong class="bold">Arduino Create Agent</strong> application. <em class="italic">Figure 7</em><em class="italic">.7</em> shows a popup where we have two options: either select the existing device for association or set up the new device if it is not available in the list:</li>
</ol>
<div><div><img alt="Figure 7.7 – Associate device – select device" src="img/B19752_07_07.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.7 – Associate device – select device</p>
<p class="list-inset">In our case, we already<a id="_idIndexMarker591"/> have different devices in the portal, but we want to add a new MKR Wi-Fi 1010. Just click on <strong class="bold">SET UP NEW DEVICE</strong> to configure a new device in the account.</p>
<ol>
<li value="2">Next, you will see the three options in the popup. The first option is <strong class="bold">Arduino board</strong> and the second option is <strong class="bold">Third party device</strong>. The third option is <strong class="bold">Any Device</strong>, which is for non-compatible devices. It means you can use any type of Arduino device, as well <a id="_idIndexMarker592"/>as third-party devices with Arduino IoT Cloud, which supports Python, MicroPython, and JavaScript.</li>
</ol>
<div><div><img alt="Figure 7.8 – Choosing a development device" src="img/B19752_07_08.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.8 – Choosing a development device</p>
<ol>
<li value="3">Select the right option from the popup for your project. For this example, click on <strong class="bold">Arduino board</strong> because in this chapter, we are using an MKR Wi-Fi 1010 board. Before<a id="_idIndexMarker593"/> adding the device, make sure <strong class="bold">Arduino Create Agent</strong> is running on your machine. <em class="italic">Figure 7</em><em class="italic">.9</em> shows that Arduino IoT Cloud detected the MKR Wi-Fi 1010 device.</li>
</ol>
<div><div><img alt="Figure 7.9 – Device found" src="img/B19752_07_09.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.9 – Device found</p>
<p class="list-inset">When the popup displays that it has found the device, just click on the <strong class="bold">CONFIGURE</strong> button, which will take you to the next configuration step, where you will provide the name of the device, and later, another popup will perform some configuration on your development board and associate the development board with Arduino IoT Cloud. Once this is done, a successful device association message will be displayed.</p>
<ol>
<li value="4">When the<a id="_idIndexMarker594"/> device is configured successfully, you will see a popup saying congratulations. Just click on the <strong class="bold">DONE</strong> button and your device will be associated with your thing.</li>
</ol>
<p>In this section, we associated the MKR Wi-Fi 1010 device with our thing, and in the upcoming sections, we will talk about the network and code.</p>
<h2 id="_idParaDest-152"><a id="_idTextAnchor152"/>Network</h2>
<p>After attaching the device to <a id="_idIndexMarker595"/>the Thing, we can see that the device is offline. To bring it online, we need to provide Wi-Fi details. The following screenshot shows the network configuration popup, which only consists of two fields:</p>
<div><div><img alt="Figure 7.10 – Network configuration" src="img/B19752_07_10.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.10 – Network configuration</p>
<p>On the Thing page, shown<a id="_idIndexMarker596"/> in <em class="italic">Figure 7</em><em class="italic">.10</em>, on the <strong class="bold">Network</strong> tab, click on the <strong class="bold">CONFIGURE</strong> button, which will take you to the <strong class="bold">Configure network</strong> popup with two fields, <strong class="bold">Wi-Fi Name</strong> and <strong class="bold">Password</strong>. Type the Wi-Fi SSID and password, and then click on the <strong class="bold">SAVE</strong> button.</p>
<p>In this section, we have configured the network for our device, which is MKR Wi-Fi 1010. In the next subsection, we will create the cloud variable.</p>
<h2 id="_idParaDest-153"><a id="_idTextAnchor153"/>Coding</h2>
<p>This chapter’s code is available in the official GitHub repository for the book. Download <code>Indoor_Device_MKR_Wi-Fi_1010_sep07a.zip</code> and import it into your Arduino Web Editor.</p>
<p>You can download the code and put it into your thing by navigating to the <code>RLED</code> and <code>GLED</code> in the following snippet and assigned them pin numbers <code>6</code> and <code>7</code>, respectively:</p>
<pre class="source-code">
#define RLED 6
#define GLED 7</pre> <p>Then, we initialize all the<a id="_idIndexMarker597"/> required pins and methods in the <code>setup()</code> method. Specifically, we are changing the modes of the pins to output by using the <code>pinMode()</code> method:</p>
<pre class="source-code">
void setup() {
  pinMode(RLED, OUTPUT);
  pinMode(GLED, OUTPUT);
  // Initialize serial and wait for port to open:
  Serial.begin(9600);
  // This delay gives the chance to wait for a Serial Monitor without blocking if none is found
  delay(1500);
  // Defined in thingProperties.h
  initProperties();
  // Connect to Arduino IoT Cloud
  ArduinoCloud.begin(ArduinoIoTPreferredConnection);
  setDebugMessageLevel(2);
  ArduinoCloud.printDebugInfo();
}</pre> <p>The next important method is <code>onTemperatureChange()</code>. Whenever the value of the <code>Temperature</code> cloud variable changes on the Sense the Environment thing, it will be automatically synced with the <code>Temperature</code> cloud variable of the Indoor Device MKR Wi-Fi 1010 thing. Then, when<a id="_idIndexMarker598"/> the value changes, this method will be called:</p>
<pre class="source-code">
void onTemperatureChange()  {
  // Add your code here to act upon Temperature change
  if(temperature&gt;30)
    {
      //if Temperature is more then 30 then turn on the Red LED and turn off Green LED
      redLed=true;
      greenLed=false;
    }else{
      //If Temperature is 30 or less then turn on Green LED and turn off Red LED
      redLed=false;
      greenLed=true;
    }
    digitalWrite(RLED,redLed);
    digitalWrite(GLED,greenLed);
}</pre> <p>In the preceding code snippet, we have defined the manual threshold for <code>temperature</code>. If the <code>temperature</code> value is greater than 30 degrees Celsius, then assign <code>redLed</code> the <code>true</code> value and <code>greenLed</code> the <code>false</code> value; otherwise, assign <code>redLed</code> with <code>false</code> and <code>greenLed</code> with <code>true</code>. At the end of the method, we are controlling the LEDs according to the <code>redLed</code> and <code>greenLed</code> values. Here, you can use relays instead of LEDs to control the heating and cooling system of your indoor environment.</p>
<p>Upload the code to the<a id="_idIndexMarker599"/> device and you will see that either the red or green LED will be turned on, depending on the temperature. After successfully uploading data to the cloud, it’s time to set up a beautiful dashboard for web and mobile for the users. This time, we will create a dashboard that will show the values of two things’ cloud variables.</p>
<p class="callout-heading">Important note</p>
<p class="callout">If you used different <em class="italic">naming</em> in the variable declaration, then update the code according to your naming scheme. But it’s better if you first follow all the steps according to the book and later change the cloud variable names and modify your code.</p>
<p>Never try to use the <code>delay()</code> method, which will create a block for the <code>ArduinoCloud.update()</code> method. Also, don’t put the code in an end-of-loop method as it will create a delay in the pulse sensor readings.</p>
<p>In this section, we have explored the code, and we are using the <code>Temperature</code> cloud variable, which is synced with the <code>Temperature</code> cloud variable in <a href="B19752_04.xhtml#_idTextAnchor085"><em class="italic">Chapter 4</em></a>, and we are turning on and off the LEDs according to temperature value. In the next section, we will explore how to display the cloud variables of multiple things on a single dashboard.</p>
<h1 id="_idParaDest-154"><a id="_idTextAnchor154"/>Implementation of GUI using synchronized cloud variables</h1>
<p>After uploading the<a id="_idIndexMarker600"/> code to the device, it’s time to set up a dashboard for web and mobile to visualize the data with different widgets. <em class="italic">Figure 7</em><em class="italic">.11</em> demonstrates the visualization of readings with different widgets.</p>
<div><div><img alt="Figure 7.11 – Thing dashboard" src="img/B19752_07_11.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.11 – Thing dashboard</p>
<p>We have three <a id="_idIndexMarker601"/>different readings, <strong class="bold">Temperature</strong>, <strong class="bold">Humidity</strong>, and <strong class="bold">Air Quality</strong>, from the Sense the Environment thing and two readings, <strong class="bold">RedLED</strong> and <strong class="bold">GreenLED</strong>, from the Indoor Device MKR Wi-Fi 1010 thing. As the temperature from the Indoor Device MKR Wi-Fi 1010 thing is synced with the Sense the Environment thing, we are only displaying one temperature value here. For every reading, we use different widget controls to demonstrate how they all work. But for the LED status, we used an LED widget control.</p>
<p>The main thing to note about this dashboard is that we are using values from two different things but the same dashboard to visualize the values. This example demonstrates that we can display the values from multiple things on a single dashboard. <em class="italic">Figure 7</em><em class="italic">.12</em> shows how easy it is to link any cloud variable to a widget control.</p>
<div><div><img alt="Figure 7.12 – Linking a cloud variable to a widget control" src="img/B19752_07_12.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.12 – Linking a cloud variable to a widget control</p>
<p><em class="italic">Figure 7</em><em class="italic">.12</em> shows how <a id="_idIndexMarker602"/>to link the <strong class="bold">RedLed</strong> cloud variable from <strong class="bold">Indoor Device MKR Wi-Fi 1010</strong> to a widget. But, as you can see, you can select any cloud variable from any thing and link it with the widget control. So, we can see how the Arduino IoT Cloud dashboard allows us to create a single dashboard for multiple things easily.</p>
<p>In this section, we discussed how to set up a dashboard that contains widgets attached to multiple things. In the next section, we will discuss limits and cloud variable synchronization in detail.</p>
<h1 id="_idParaDest-155"><a id="_idTextAnchor155"/>Limitations of cloud variable/property synchronization</h1>
<p>Arduino IoT Cloud offers a platform for IoT device management and communication, including TTC between devices. While it provides valuable features for connecting and managing IoT devices, there are <a id="_idIndexMarker603"/>some drawbacks to consider:</p>
<ul>
<li><strong class="bold">Latency</strong>: TTC can introduce latency, which is the delay between when a change is made to a variable on one device and when it is reflected on the other device. This can be a problem for applications that require very low latency, such as controlling a robot in real time.</li>
<li><strong class="bold">Offline device challenges</strong>: Devices that are temporarily offline may miss important messages or updates from other devices. Ensuring that devices can catch up on missed communications when they reconnect to the network can be complex to implement.</li>
<li><strong class="bold">Dependency on internet connectivity</strong>: Arduino IoT Cloud relies on an internet connection for communication between devices. If the internet connection goes down, the devices may lose their ability to communicate with each other.</li>
<li><strong class="bold">Limited functionality</strong>: TTC is not as flexible as some other IoT communication protocols. For example, you cannot use TTC to send arbitrary data between devices.</li>
<li><strong class="bold">Dependency on the cloud</strong>: TTC relies on Arduino IoT Cloud to function. This means that if the cloud is <a id="_idIndexMarker604"/>unavailable, your TTC connections will not work.</li>
</ul>
<p>When considering Arduino IoT Cloud for TTC in your IoT project, it’s essential to weigh these drawbacks against the platform’s benefits and assess whether it aligns with your specific project requirements and constraints. Additionally, exploring alternative IoT platforms and communication solutions may be necessary to ensure the best fit for your needs.</p>
<p>In this section, we have discussed in detail the limitations of Arduino IoT Cloud TTC. In the next section, we will explore how you can use TTC for different types of cloud variables.</p>
<h1 id="_idParaDest-156"><a id="_idTextAnchor156"/>What next?</h1>
<p>We still have a lot of options available to explore, but now it’s your turn to use different sensors and development boards to do some more experiments and learn from them. In this chapter, we have only used one <code>Temperature</code> cloud variable synced between two things, but you can try using this feature to sync multiple cloud variables with multiple things. Next, create a dashboard for multiple things to visualize all the values in one place. We configured simple LEDs to turn on and off according to the temperature, but you can also use relays to control the heating/cooling system of your indoor home/office and warehouse environment, or you can create an alarm in case of a temperature increase using this TTC feature.</p>
<h1 id="_idParaDest-157"><a id="_idTextAnchor157"/>Summary</h1>
<p>In this chapter, we explored D2D communication and the benefits of Arduino IoT Cloud for thing-to-thing communication. We discussed how to develop a solution for thing-to-thing communication. We also explored how easy it is to sync the cloud variable with other things just using a GUI. We set up a dashboard, where we linked the widget controls with multiple thing cloud variables. Finally, we discussed the limits of Arduino IoT Cloud thing-to-thing communication in detail.</p>
<p>In the next chapter, we are going to explore how to use the Arduino IoT Cloud SDK. This chapter is for developers who are eager to learn how to use Arduino IoT Cloud programmatically and develop custom solutions using Arduino IoT Cloud or integrate Arduino IoT Cloud with third-party platforms.</p>
</div>
</body></html>