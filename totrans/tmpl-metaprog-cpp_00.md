# 前言

C++编程语言是世界上使用最广泛的编程语言之一，并且已经如此几十年了。它的成功并不仅仅是因为它提供的性能，也许是因为它的易用性，尽管许多人会对此提出异议，但可能是因为它的多功能性。C++是一种通用、多范式的编程语言，它结合了过程式、函数式和泛型编程。

**泛型编程**是一种编写代码的范例，其中函数和类等实体是以后来指定的类型编写的。这些泛型实体仅在需要为特定类型（作为参数指定）时实例化。在 C++中，这些泛型实体被称为模板。

**元编程**是一种编程技术，使用模板（以及 C++中的 constexpr 函数）在编译时生成代码，然后将生成的代码与源代码的其余部分合并以编译最终程序。元编程意味着至少输入或输出是一个类型。

C++中的模板以其“相当糟糕”而闻名，正如 C++核心指南（由 Bjarne Stroustrup 和 Herb Sutter 维护的关于应该做什么和不应该做什么的文档）中所述。然而，它们使得泛型库成为可能，例如 C++标准库，这是 C++开发者经常使用的。无论您是编写自己的模板还是仅使用他人编写的模板（例如标准容器或算法），模板很可能构成了您日常代码的一部分。

本书旨在全面了解 C++中所有可用的模板（从其基本语法到 C++20 中的概念）。这将是本书前两部分的焦点。第三部分和最后一部分将帮助您将新获得的知识应用于使用模板进行元编程。

# 本书面向谁？

本书面向希望了解模板元编程的初学者到中级 C++开发者，以及希望掌握与模板和 C++20 相关的新特性以及各种惯用和模式的先进 C++开发者。要开始阅读本书，需要具备基本的 C++编码经验。

# 本书涵盖的内容

*第一章*，*模板简介*，介绍了 C++中模板元编程的概念，包括几个简单示例，以及讨论了为什么我们需要模板以及使用模板的优缺点。

*第二章*，*模板基础*，探讨了 C++中所有形式的模板：函数模板、类模板、变量模板和别名模板。对于这些中的每一个，我们讨论了它们的语法以及它们如何工作的细节。此外，还讨论了模板实例化和特殊化的关键概念。

*第三章*，*可变参数模板*，完全致力于可变参数模板，这些模板具有可变数量的模板参数。我们详细讨论了可变函数模板、可变类模板、可变别名模板和可变变量模板，参数包及其展开方式，以及帮助我们简化可变模板编写的折叠表达式。

*第四章*，*高级模板概念*，将一系列高级模板概念如依赖名称和名称查找、模板参数推导、模板递归、完美转发、泛型和模板 lambda 等分组。通过理解这些主题，读者将能够极大地扩展他们可以阅读或编写的模板的多样性。

*第五章*，*类型特性和条件编译*，致力于类型特性。读者将了解类型特性、标准库提供的特性以及如何使用它们来解决不同的问题。

*第六章*，*概念和约束*，介绍了 C++20 中用于定义模板参数要求的新的概念和约束机制。你将了解指定约束的各种方法。此外，我们还提供了 C++20 标准概念库内容的概述。

*第七章*，*模式和惯用法*，探讨了将到目前为止学到的知识应用于实现各种模式的一系列不相关的先进主题。我们探讨了静态多态、类型擦除、标签分派等概念，以及诸如好奇的递归模板模式、表达式模板、混入和类型列表等模式。

*第八章*，*范围和算法*，致力于理解容器、迭代器和算法，这些是标准模板库的核心组件。在这里，你将学习如何为它编写一个泛型容器和迭代器类型，以及一个通用算法。

*第九章*，*范围库*，探讨了新的 C++20 范围库及其关键特性，如范围、范围适配器和约束算法。这些特性使我们能够编写更简单的代码来处理范围。此外，你还将学习如何编写自己的范围适配器。

*附录* 是一个简短的结语，提供了本书的总结。

*作业答案* 包含了所有章节的所有问题的答案。

# 为了充分利用本书

要开始学习本书，您需要对 C++ 编程语言有一些基本了解。您需要了解语法以及关于类、函数、运算符、函数重载、继承、虚函数等方面的基础知识。然而，不需要模板知识，因为本书将从零开始教授您所有内容。

本书中的所有代码示例都是跨平台的。这意味着您可以使用任何编译器来构建和运行它们。然而，尽管许多代码片段与 C++11 编译器兼容，但也有片段需要 C++17 或 C++20 兼容的编译器。因此，我们建议您使用支持 C++20 的编译器版本，以便运行所有示例。本书中的示例已使用 **MSVC 19.30**（**Visual Studio 2022**）、**GCC 12.1/13** 和 **Clang 13/14** 进行测试。如果您机器上没有这样的 C++20 兼容编译器，您可以在网上尝试一个。我们推荐以下之一：

+   Compiler Explorer ([`godbolt.org/`](https://godbolt.org/))

+   Wandbox ([`wandbox.org/`](https://wandbox.org/))

+   C++ Insights ([`cppinsights.io/`](https://cppinsights.io/))

书中将多次提及 C++ Insights 在线工具，用于分析编译器生成的代码。

如果您想检查编译器对不同版本 C++ 标准的支持情况，请参考页面 [`en.cppreference.com/w/cpp/compiler_support`](https://en.cppreference.com/w/cpp/compiler_support)。

**如果您使用的是本书的电子版，我们建议您亲自输入代码或从本书的 GitHub 仓库（下一节中提供链接）获取代码。这样做将有助于避免与代码复制粘贴相关的任何潜在错误。**

# 提及和进一步阅读

在本书中，我们多次提到了 C++ 标准。这份文件由 **国际标准化组织** 版权所有。官方 C++ 标准文档可以从这里购买：[`www.iso.org/standard/79358.html`](https://www.iso.org/standard/79358.html)。然而，C++ 标准的多个草案以及生成它们的源代码在 GitHub 上免费提供，网址为 [`github.com/cplusplus/draft`](https://github.com/cplusplus/draft)。您可以在 [`isocpp.org/std/the-standard`](https://isocpp.org/std/the-standard) 找到有关 C++ 标准的更多信息。

对于 C++ 开发者来说，一个极好的在线资源是 C++ Reference 网站，网址为 [`en.cppreference.com/`](https://en.cppreference.com/)。该网站提供了直接从 C++ 标准派生的详尽文档。本书中多次引用了 C++ Reference 的内容。C++ Reference 的内容受 CC-BY-SA 许可协议保护，[`en.cppreference.com/w/Cppreference:Copyright/CC-BY-SA`](https://en.cppreference.com/w/Cppreference:Copyright/CC-BY-SA)。

每章末尾，您将找到一个名为*进一步阅读*的部分。本部分包含用作参考文献的阅读列表，并推荐用于深化您对所呈现主题的了解。

# 下载示例代码文件

您可以从 GitHub 下载本书的示例代码文件[`github.com/PacktPublishing/Template-Metaprogramming-with-CPP`](https://github.com/PacktPublishing/Template-Metaprogramming-with-CPP)。如果代码有更新，它将在 GitHub 仓库中更新。

我们还有其他来自我们丰富图书和视频目录的代码包，可在[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)找到。查看它们！

# 下载彩色图像

我们还提供了一份包含本书中使用的截图和图表彩色图像的 PDF 文件。您可以从这里下载：[`packt.link/Un8j5`](https://packt.link/Un8j5)。

# 使用的约定

本书使用了多种文本约定。

`文本中的代码`：表示文本中的代码单词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 昵称。以下是一个示例：“可以通过将`init`设置为依赖名称来修复此问题。”

代码块应如下设置：

```cpp
template <typename T>
```

```cpp
struct parser : base_parser<T>
```

```cpp
{
```

```cpp
   void parse()
```

```cpp
   {
```

```cpp
      this->init(); // OK
```

```cpp
      std::cout << "parse\n";
```

```cpp
   }
```

```cpp
};
```

任何命令行输入或输出都应如下编写：

```cpp
fatal error: recursive template instantiation exceeded maximum
depth of 1024
use -ftemplate-depth=N to increase recursive template
instantiation depth
```

**粗体**：表示新术语、重要单词或您在屏幕上看到的单词。例如，菜单或对话框中的单词以**粗体**显示。以下是一个示例：“容量为 8，大小为 0，**头**和**尾**都指向索引**0**。”

小贴士或重要注意事项

看起来像这样。

# 联系我们

欢迎读者反馈。

**一般反馈**：如果您对本书的任何方面有疑问，请通过 mailto:customercare@packtpub.com 发送电子邮件，并在邮件主题中提及书名。

**勘误**：尽管我们已经尽最大努力确保内容的准确性，但错误仍然可能发生。如果您在这本书中发现了错误，我们非常感谢您能向我们报告。请访问[www.packtpub.com/support/errata](http://www.packtpub.com/support/errata)并填写表格。

**盗版**：如果您在互联网上以任何形式遇到我们作品的非法副本，如果您能提供位置地址或网站名称，我们将不胜感激。请通过 mailto:copyright@packt.com 与我们联系，并提供材料的链接。

**如果您有兴趣成为作者**：如果您在某个主题上具有专业知识，并且您有兴趣撰写或为书籍做出贡献，请访问[authors.packtpub.com](http://authors.packtpub.com)。

# 分享您的想法

一旦您阅读了《使用 C++的模板元编程》，我们很乐意听听您的想法！请[点击此处直接进入此书的亚马逊评论页面](https://packt.link/r/1803243457)并分享您的反馈。

您的评论对我们和科技社区都非常重要，并将帮助我们确保我们提供高质量的内容。
