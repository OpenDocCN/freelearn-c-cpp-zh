<html><head></head><body>
<div id="_idContainer103">
<h1 class="chapter-number" id="_idParaDest-145"><a id="_idTextAnchor145"/><span class="koboSpan" id="kobo.1.1">6</span></h1>
<h1 id="_idParaDest-146"><a id="_idTextAnchor146"/><span class="koboSpan" id="kobo.2.1">Transitioning from Qt 5 to Qt 6</span></h1>
<p><span class="koboSpan" id="kobo.3.1">In this chapter, we will learn about the changes that have been made in </span><strong class="bold"><span class="koboSpan" id="kobo.4.1">Qt 6</span></strong><span class="koboSpan" id="kobo.5.1"> and how you can upgrade your existing Qt 5 project to Qt 6. </span><span class="koboSpan" id="kobo.5.2">Unlike previous updates, Qt 6 is almost a complete rewrite of the entire Qt code base from the ground up, including all the underlying classes. </span><span class="koboSpan" id="kobo.5.3">Such major changes may break your existing Qt 5 project if you simply switch over to </span><span class="No-Break"><span class="koboSpan" id="kobo.6.1">Qt 6.</span></span></p>
<p><span class="koboSpan" id="kobo.7.1">In this chapter, we’re going to cover the following </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">main topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.9.1">Changes in </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">C++ classes</span></span></li>
<li><span class="koboSpan" id="kobo.11.1">Using </span><strong class="bold"><span class="koboSpan" id="kobo.12.1">Clazy checks</span></strong><span class="koboSpan" id="kobo.13.1"> for Clang </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">and C++</span></span></li>
<li><span class="koboSpan" id="kobo.15.1">Changes in </span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">QML types</span></span></li>
</ul>
<h1 id="_idParaDest-147"><a id="_idTextAnchor147"/><span class="koboSpan" id="kobo.17.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.18.1">The technical requirements for this chapter include Qt 6.6.1 MinGW 64-bit, Qt 5.15.2 MinGW 64-bit, and Qt Creator 12.0.2. </span><span class="koboSpan" id="kobo.18.2">All the code used in this chapter can be downloaded from the following GitHub </span><span class="No-Break"><span class="koboSpan" id="kobo.19.1">repository: </span></span><a href="https://github.com/PacktPublishing/QT6-C-GUI-Programming-Cookbook---Third-Edition-/tree/main/Chapter06"><span class="No-Break"><span class="koboSpan" id="kobo.20.1">https://github.com/PacktPublishing/QT6-C-GUI-Programming-Cookbook---Third-Edition-/tree/main/Chapter06</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.21.1">.</span></span></p>
<h1 id="_idParaDest-148"><a id="_idTextAnchor148"/><span class="koboSpan" id="kobo.22.1">Changes in C++ classes</span></h1>
<p><span class="koboSpan" id="kobo.23.1">In</span><a id="_idIndexMarker444"/><span class="koboSpan" id="kobo.24.1"> this recipe, we will learn what the changes in Qt6’s C++ </span><span class="No-Break"><span class="koboSpan" id="kobo.25.1">classes are.</span></span></p>
<h2 id="_idParaDest-149"><a id="_idTextAnchor149"/><span class="koboSpan" id="kobo.26.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.27.1">Follow these</span><a id="_idIndexMarker445"/><span class="koboSpan" id="kobo.28.1"> steps to learn about C++ classes </span><span class="No-Break"><span class="koboSpan" id="kobo.29.1">in Qt6:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.30.1">Create a new </span><strong class="bold"><span class="koboSpan" id="kobo.31.1">Qt Console Application</span></strong><span class="koboSpan" id="kobo.32.1"> by going to </span><strong class="bold"><span class="koboSpan" id="kobo.33.1">File</span></strong><span class="koboSpan" id="kobo.34.1"> | </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.35.1">New Project</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.36.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.37.1">We will open up the </span><strong class="source-inline"><span class="koboSpan" id="kobo.38.1">main.cpp</span></strong><span class="koboSpan" id="kobo.39.1"> file and add the </span><span class="No-Break"><span class="koboSpan" id="kobo.40.1">following headers:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.41.1">
#include &lt;QCoreApplication&gt;
#include &lt;QDebug&gt;
#include &lt;QLinkedList&gt;
#include &lt;QRegExp&gt;
#include &lt;QStringView&gt;
#include &lt;QTextCodec&gt;
#include &lt;QTextEncoder&gt;
#include &lt;QTextDecoder&gt;</span></pre></li> <li><span class="koboSpan" id="kobo.42.1">After that, add the following code for demonstrating the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.43.1">QLinkedList</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.44.1"> class:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.45.1">
int main(int argc, char *argv[])
{
    QCoreApplication a(argc, argv);
    </span><strong class="bold"><span class="koboSpan" id="kobo.46.1">// QLinkedList</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.47.1">    QLinkedList&lt;QString&gt; list;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.48.1">    list &lt;&lt; "string1" &lt;&lt; "string2" &lt;&lt; "string3";</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.49.1">    QLinkedList&lt;QString&gt;::iterator it;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.50.1">    for (it = list.begin(); it != list.end(); ++it)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.51.1">    {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.52.1">        qDebug() &lt;&lt; "QLinkedList:" &lt;&lt; *it;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.53.1">    }</span></strong></pre></li> <li><span class="koboSpan" id="kobo.54.1">Then, we</span><a id="_idIndexMarker446"/><span class="koboSpan" id="kobo.55.1"> continue to add the following code to demonstrate how to extract numbers from a string by using the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.56.1">QRegExp</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.57.1"> class:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.58.1">
// QRegExp
QRegExp rx("\\d+");
QString text = "Jacky has 3 carrots, 15 apples, 9 oranges and 12 grapes.";
QStringList myList;
int pos = 0;
while ((pos = rx.indexIn(text, pos)) != -1)
{
    // Separate all numbers from the sentence
    myList &lt;&lt; rx.cap(0);
    pos += rx.matchedLength();
}
qDebug() &lt;&lt; "QRegExp:" &lt;&lt; myList;</span></pre></li> <li><span class="koboSpan" id="kobo.59.1">We then follow by adding the following code at the bottom of the preceding code to demonstrate the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.60.1">QStringView</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.61.1"> class:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.62.1">
// QStringView
QStringView x = QString("Good afternoon");
QStringView y = x.mid(5, 5);
QStringView z = x.mid(5);
qDebug() &lt;&lt; "QStringView:" &lt;&lt; y; // after
qDebug() &lt;&lt; "QStringView:" &lt;&lt; z; // afternoon</span></pre></li> <li><span class="koboSpan" id="kobo.63.1">Not only that, but </span><a id="_idIndexMarker447"/><span class="koboSpan" id="kobo.64.1">we are also adding the following code to demonstrate the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.65.1">QTextCodec</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.66.1"> class:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.67.1">
// QTextCodec
QByteArray data = "\xCE\xB1\xCE\xB2\xCE\xB3"; // Alpha, beta, gamma symbols
QTextCodec *codec = QTextCodec::codecForName("UTF-8");
QString str = codec-&gt;toUnicode(data);</span></pre></li> </ol>
<pre class="source-code"><span class="koboSpan" id="kobo.68.1">
qDebug() &lt;&lt; "QTextCodec:" &lt;&lt; str;</span></pre> <ol>
<li value="7"><span class="koboSpan" id="kobo.69.1">Next, add the following code, which demonstrates how to convert hexadecimal code to a character using the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.70.1">QTextEncoder</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.71.1"> class:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.72.1">
// QTextEncoder
QString str2 = QChar(0x41); // Character "A"
QTextCodec *locale = QTextCodec::codecForLocale();
QTextEncoder *encoder = locale-&gt;makeEncoder();
QByteArray encoded = encoder-&gt;fromUnicode(str2);
qDebug() &lt;&lt; "QTextEncoder:" &lt;&lt; encoded.data();</span></pre></li> <li><span class="koboSpan" id="kobo.73.1">Let’s also add the following code to demonstrate how to convert a line of text from Shift JIS format to Unicode by using the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.74.1">QTextDecoder</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.75.1"> class:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.76.1">
// QTextDecoder
QByteArray data2 = "\x82\xB1\x82\xF1\x82\xC9\x82\xBF\x82\xCD\x90\xA2\x8A\x45"; // "Hello world" in Japanese
QTextCodec *codec2 = QTextCodec::codecForName("Shift-JIS");
QTextDecoder *decoder = codec2-&gt;makeDecoder();
QString decoded = decoder-&gt;toUnicode(data2);
qDebug() &lt;&lt; "QTextDecoder:" &lt;&lt; decoded;</span></pre></li> <li><span class="koboSpan" id="kobo.77.1">Now that we’re done with the code, let’s try and compile the project using Qt 5 for now and see what will happen. </span><span class="koboSpan" id="kobo.77.2">Your program should compile just fine and give you the </span><a id="_idIndexMarker448"/><span class="koboSpan" id="kobo.78.1">following results in the </span><span class="No-Break"><span class="koboSpan" id="kobo.79.1">output window:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.80.1">
QLinkedList: "string1"
QLinkedList: "string2"
QLinkedList: "string3"
QRegExp: ("3", "15", "9", "12")
QStringView: "after"
QStringView: "afternoon"
QTextCodec: "αβγ"
QTextEncoder: A
QTextDecoder: "こんにちは世界"</span></pre></li> <li><span class="koboSpan" id="kobo.81.1">Now, let’s change to Qt 6 and compile the project again, you should get errors </span><span class="No-Break"><span class="koboSpan" id="kobo.82.1">like this:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.83.1">
QLinkedList: No such file or directory
fatal error: QLinkedList: No such file or directory</span></pre></li> <li><span class="koboSpan" id="kobo.84.1">Open up your project file (</span><strong class="source-inline"><span class="koboSpan" id="kobo.85.1">.pro</span></strong><span class="koboSpan" id="kobo.86.1">) and add the following code at </span><span class="No-Break"><span class="koboSpan" id="kobo.87.1">the top:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.88.1">
QT += core5compat</span></pre></li> <li><span class="koboSpan" id="kobo.89.1">Finally, compile the project again with Qt 6. </span><span class="koboSpan" id="kobo.89.2">You should be able to run it this time. </span><strong class="source-inline"><span class="koboSpan" id="kobo.90.1">core5compat</span></strong><span class="koboSpan" id="kobo.91.1"> is just a temporary solution for transitioning from Qt 5 to Qt 6. </span><span class="koboSpan" id="kobo.91.2">You may change to use </span><strong class="source-inline"><span class="koboSpan" id="kobo.92.1">std::list</span></strong><span class="koboSpan" id="kobo.93.1"> to replace </span><strong class="source-inline"><span class="koboSpan" id="kobo.94.1">QLinkedList</span></strong><span class="koboSpan" id="kobo.95.1"> since it will be deprecated in </span><span class="No-Break"><span class="koboSpan" id="kobo.96.1">the future.</span></span></li>
</ol>
<h2 id="_idParaDest-150"><a id="_idTextAnchor150"/><span class="koboSpan" id="kobo.97.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.98.1">We don’t need any GUIs since we are just testing out some of the C++ classes, so the </span><strong class="bold"><span class="koboSpan" id="kobo.99.1">Qt Console Application</span></strong><span class="koboSpan" id="kobo.100.1"> is sufficient for this project. </span><span class="koboSpan" id="kobo.100.2">We needed the </span><strong class="source-inline"><span class="koboSpan" id="kobo.101.1">QDebug</span></strong><span class="koboSpan" id="kobo.102.1"> class to print out the results in the </span><span class="No-Break"><span class="koboSpan" id="kobo.103.1">output window.</span></span></p>
<p><span class="koboSpan" id="kobo.104.1">In the preceding example, we used some of the classes that have been deprecated in Qt 6, namely </span><strong class="source-inline"><span class="koboSpan" id="kobo.105.1">QLinkedList</span></strong><span class="koboSpan" id="kobo.106.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.107.1">QRegExp</span></strong><span class="koboSpan" id="kobo.108.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.109.1">QStringView</span></strong><span class="koboSpan" id="kobo.110.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.111.1">QTextCodec</span></strong><span class="koboSpan" id="kobo.112.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.113.1">QTextEncoder</span></strong><span class="koboSpan" id="kobo.114.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.115.1">QTextDecoder</span></strong><span class="koboSpan" id="kobo.116.1">. </span><span class="koboSpan" id="kobo.116.2">These are just some of the common classes that we will encounter when using Qt, which have been rewritten in Qt 6. </span><span class="koboSpan" id="kobo.116.3">If you are porting your project from Qt 5 to 6, the best way is to add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.117.1">Core5Compat</span></strong><span class="koboSpan" id="kobo.118.1"> module to your project so that Qt 5 classes can continue to run under Qt 6. </span><span class="koboSpan" id="kobo.118.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.119.1">Core5Compat</span></strong><span class="koboSpan" id="kobo.120.1"> module is a temporary measure for supporting Qt 5 classes under Qt 6 projects so that Qt programmers can safely move their projects to Qt 6 and take their time to slowly port their code over to Qt </span><span class="No-Break"><span class="koboSpan" id="kobo.121.1">6 classes.</span></span></p>
<p><span class="koboSpan" id="kobo.122.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.123.1">Core5Compat</span></strong><span class="koboSpan" id="kobo.124.1"> module</span><a id="_idIndexMarker449"/><span class="koboSpan" id="kobo.125.1"> will stop working when you move to Qt 7, so it’s not recommended to keep using the deprecated classes for </span><span class="No-Break"><span class="koboSpan" id="kobo.126.1">too long.</span></span></p>
<h2 id="_idParaDest-151"><a id="_idTextAnchor151"/><span class="koboSpan" id="kobo.127.1">There’s more…</span></h2>
<p><span class="koboSpan" id="kobo.128.1">In Qt 6, a lot of the core functionality has been rewritten from scratch to keep the library up to date with the modern computing architecture and workflow. </span><span class="koboSpan" id="kobo.128.2">Thus, Qt 6 is considered a transitional phase where some classes have been completed and some </span><span class="No-Break"><span class="koboSpan" id="kobo.129.1">have not.</span></span></p>
<p><span class="koboSpan" id="kobo.130.1">In order for it to work, Qt developers introduced the </span><strong class="source-inline"><span class="koboSpan" id="kobo.131.1">Core5Compat</span></strong><span class="koboSpan" id="kobo.132.1"> module</span><a id="_idIndexMarker450"/><span class="koboSpan" id="kobo.133.1"> to make it easier for Qt programmers to keep their projects going while slowly transitioning over to the new classes. </span><span class="koboSpan" id="kobo.133.2">You can check out what the replacements for these classes are from the official </span><span class="No-Break"><span class="koboSpan" id="kobo.134.1">online documentation.</span></span></p>
<p><span class="koboSpan" id="kobo.135.1">Lastly, Qt 6 is now leveraging on C++ 17. </span><span class="koboSpan" id="kobo.135.2">It’s highly recommended for your project to adhere to C++ 17 standards so that your code can work nicely with </span><span class="No-Break"><span class="koboSpan" id="kobo.136.1">Qt 6.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.137.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.138.1">There are many other C++ classes that have been deprecated or are being rewritten in Qt 6; please refer to this link to check the full list of C++ classes that have been changed or deprecated in Qt 6: </span><a href="https://doc.qt.io/qt-6/obsoleteclasses.html"><span class="koboSpan" id="kobo.139.1">https://doc.qt.io/qt-6/obsoleteclasses.html</span></a><span class="koboSpan" id="kobo.140.1">. </span><span class="koboSpan" id="kobo.140.2">You may also add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.141.1">QT_DISABLE_DEPRECATED_UP_TO</span></strong><span class="koboSpan" id="kobo.142.1"> macro to your Qt project to disable the use of deprecated C++ APIs in your project. </span><span class="koboSpan" id="kobo.142.2">For example, adding </span><strong class="source-inline"><span class="koboSpan" id="kobo.143.1">DEFINES += QT_DISABLE_DEPRECATED_UP_TO=0x050F00</span></strong><span class="koboSpan" id="kobo.144.1"> to your profile will disable all C++ APIs deprecated in </span><span class="No-Break"><span class="koboSpan" id="kobo.145.1">Qt 5.15.</span></span></p>
<h1 id="_idParaDest-152"><a id="_idTextAnchor152"/><span class="koboSpan" id="kobo.146.1">Using Clazy checks for Clang and C++</span></h1>
<p><span class="koboSpan" id="kobo.147.1">In this</span><a id="_idIndexMarker451"/><span class="koboSpan" id="kobo.148.1"> chapter, we will learn how to use the Clazy checks from the Clang toolset to automatically display warnings when obsolete Qt 5 classes and functions are detected in your </span><span class="No-Break"><span class="koboSpan" id="kobo.149.1">Qt project.</span></span></p>
<h2 id="_idParaDest-153"><a id="_idTextAnchor153"/><span class="koboSpan" id="kobo.150.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.151.1">Let’s get started by following </span><span class="No-Break"><span class="koboSpan" id="kobo.152.1">these steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.153.1">We will use the same project from the preceding example. </span><span class="koboSpan" id="kobo.153.2">Then, proceed to open up the preferences window by going to </span><strong class="bold"><span class="koboSpan" id="kobo.154.1">Edit</span></strong><span class="koboSpan" id="kobo.155.1"> | </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.156.1">Preferences…</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.157.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.158.1">After that, go to the </span><strong class="bold"><span class="koboSpan" id="kobo.159.1">Analyzer</span></strong><span class="koboSpan" id="kobo.160.1"> page and click on the button beside </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.161.1">Diagnostic configuration</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.162.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer094">
<span class="koboSpan" id="kobo.163.1"><img alt="Figure 6.1 – Open up the Diagnostic configuration window" src="image/B20976_06_001.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.164.1">Figure 6.1 – Open up the Diagnostic configuration window</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.165.1">Select the </span><strong class="bold"><span class="koboSpan" id="kobo.166.1">Default Clang-Tidy and Clazy checks</span></strong><span class="koboSpan" id="kobo.167.1"> option at the top and click the </span><strong class="bold"><span class="koboSpan" id="kobo.168.1">Copy…</span></strong><span class="koboSpan" id="kobo.169.1"> button, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.170.1">Figure 6</span></em></span><em class="italic"><span class="koboSpan" id="kobo.171.1">.2</span></em><span class="koboSpan" id="kobo.172.1">. </span><span class="koboSpan" id="kobo.172.2">Give it a name and click </span><strong class="bold"><span class="koboSpan" id="kobo.173.1">OK</span></strong><span class="koboSpan" id="kobo.174.1">. </span><span class="koboSpan" id="kobo.174.2">The new option will now</span><a id="_idIndexMarker452"/><span class="koboSpan" id="kobo.175.1"> appear under the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.176.1">Custom</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.177.1"> category:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer095">
<span class="koboSpan" id="kobo.178.1"><img alt="Figure 6.2 - Click on the Copy button" src="image/B20976_06_002.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.179.1">Figure 6.2 - Click on the Copy button</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.180.1">Then, open the </span><strong class="bold"><span class="koboSpan" id="kobo.181.1">Clazy Checks</span></strong><span class="koboSpan" id="kobo.182.1"> tab, enable the following options, and </span><span class="No-Break"><span class="koboSpan" id="kobo.183.1">click </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.184.1">OK</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.185.1">:</span></span><ul><li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.186.1">qt6-deprecated-api-fixes</span></strong></span></li><li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.187.1">qt6-header-fixes</span></strong></span></li><li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.188.1">qt6-qhash-signature</span></strong></span></li><li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.189.1">qt6-fwd-fixes</span></strong></span></li><li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.190.1">missing-qobject-macro</span></strong></span></li></ul></li>
<li><span class="koboSpan" id="kobo.191.1">Once you’re done, close the preference window and go to </span><strong class="bold"><span class="koboSpan" id="kobo.192.1">Analyze</span></strong><span class="koboSpan" id="kobo.193.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.194.1">Clang-Tidy and Clazy...</span></strong><span class="koboSpan" id="kobo.195.1">. </span><span class="koboSpan" id="kobo.195.2">The </span><strong class="bold"><span class="koboSpan" id="kobo.196.1">Files to Analyze</span></strong><span class="koboSpan" id="kobo.197.1"> window will pop up with all the source files being displayed on the window. </span><span class="koboSpan" id="kobo.197.2">We will just stick to the default option and proceed by clicking the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.198.1">Analyze</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.199.1"> button:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer096">
<span class="koboSpan" id="kobo.200.1"><img alt="Figure 6.3 – Choose All Files and press the Analyze button" src="image/B20976_06_003.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="IMG---Caption-Char"><span class="koboSpan" id="kobo.201.1">Figure 6.3 – Choose All Files and press the Analyze button</span></span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.202.1">After the </span><a id="_idIndexMarker453"/><span class="koboSpan" id="kobo.203.1">Clang-Tidy and Clazy tools finish analyzing the project, you should see the results displayed on a separate panel under the Qt Creator. </span><span class="koboSpan" id="kobo.203.2">It will show you the lines of code that have been deprecated in Qt 6 and give you suggestions on what to replace </span><span class="No-Break"><span class="koboSpan" id="kobo.204.1">them with:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer097">
<span class="koboSpan" id="kobo.205.1"><img alt="Figure 6.4 – Results from the analysis" src="image/B20976_06_004.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.206.1">Figure 6.4 – Results from the analysis</span></p>
<h2 id="_idParaDest-154"><a id="_idTextAnchor154"/><span class="koboSpan" id="kobo.207.1">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.208.1">The Tidy and Clazy tool came with Clang packages so there is no need to install it separately. </span><span class="koboSpan" id="kobo.208.2">It is a powerful tool that can be used to check for many things, such as using deprecated functions in your code, placing a container inside a loop, marking a non-void slot as constant, registering QML type that starts with lowercase, and </span><span class="No-Break"><span class="koboSpan" id="kobo.209.1">so on.</span></span></p>
<p><span class="koboSpan" id="kobo.210.1">It’s a tool that</span><a id="_idIndexMarker454"/><span class="koboSpan" id="kobo.211.1"> helps you to inspect and improve the quality of your code with ease. </span><span class="koboSpan" id="kobo.211.2">It should be widely promoted and used more frequently by </span><span class="No-Break"><span class="koboSpan" id="kobo.212.1">Qt programmers.</span></span></p>
<h1 id="_idParaDest-155"><a id="_idTextAnchor155"/><span class="koboSpan" id="kobo.213.1">Changes in QML types</span></h1>
<p><span class="koboSpan" id="kobo.214.1">In this chapter, we will learn </span><a id="_idIndexMarker455"/><span class="koboSpan" id="kobo.215.1">what changes have been made in Qt 6 compared to </span><span class="No-Break"><span class="koboSpan" id="kobo.216.1">Qt 5.</span></span></p>
<h2 id="_idParaDest-156"><a id="_idTextAnchor156"/><span class="koboSpan" id="kobo.217.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.218.1">Let’s get started by following </span><span class="No-Break"><span class="koboSpan" id="kobo.219.1">these steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.220.1">Create a new </span><strong class="bold"><span class="koboSpan" id="kobo.221.1">Qt Quick Application</span></strong><span class="koboSpan" id="kobo.222.1"> by going to </span><strong class="bold"><span class="koboSpan" id="kobo.223.1">File</span></strong><span class="koboSpan" id="kobo.224.1"> | </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.225.1">New Project</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.226.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.227.1">Select the </span><strong class="bold"><span class="koboSpan" id="kobo.228.1">Qt 6.2</span></strong><span class="koboSpan" id="kobo.229.1"> option for </span><strong class="bold"><span class="koboSpan" id="kobo.230.1">Minimum required Qt version</span></strong><span class="koboSpan" id="kobo.231.1"> when defining </span><span class="No-Break"><span class="koboSpan" id="kobo.232.1">project details.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer098">
<span class="koboSpan" id="kobo.233.1"><img alt="Figure 6.5 – Select Qt 6.2 as Minimum required Qt version" src="image/B20976_06_005.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.234.1">Figure 6.5 – Select Qt 6.2 as Minimum required Qt version</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.235.1">Once you have created the project, open up </span><strong class="source-inline"><span class="koboSpan" id="kobo.236.1">main.qml</span></strong><span class="koboSpan" id="kobo.237.1"> and add these properties to </span><span class="No-Break"><span class="koboSpan" id="kobo.238.1">the file:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.239.1">
import QtQuick
Window {
    width: 640
    height: 480
    visible: true
    title: qsTr("Hello World")
    </span><strong class="bold"><span class="koboSpan" id="kobo.240.1">property variant myColor: "red"</span></strong><span class="koboSpan" id="kobo.241.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.242.1">property url imageFolder: "/images"</span></strong></pre></li> <li><span class="koboSpan" id="kobo.243.1">Next, add</span><a id="_idIndexMarker456"/><span class="koboSpan" id="kobo.244.1"> a </span><strong class="source-inline"><span class="koboSpan" id="kobo.245.1">Rectangle</span></strong><span class="koboSpan" id="kobo.246.1"> object to </span><strong class="source-inline"><span class="koboSpan" id="kobo.247.1">main.qml</span></strong><span class="koboSpan" id="kobo.248.1">, as shown in </span><span class="No-Break"><span class="koboSpan" id="kobo.249.1">the following:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.250.1">
Rectangle {
    id: rect
    x: 100
    y: 100
    width: 100
    height: 100
    color: myColor
}</span></pre></li> <li><span class="koboSpan" id="kobo.251.1">After that, we’re going to add another </span><strong class="source-inline"><span class="koboSpan" id="kobo.252.1">Image</span></strong><span class="koboSpan" id="kobo.253.1"> object below </span><span class="No-Break"><span class="koboSpan" id="kobo.254.1">the rectangle:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.255.1">
Image {
    id: img
    x: 300
    y: 100
    width: 150
    height: 180
    source: imageFolder + "/tux.png"
}</span></pre></li> <li><span class="koboSpan" id="kobo.256.1">Next, we</span><a id="_idIndexMarker457"/><span class="koboSpan" id="kobo.257.1"> create a new resource file for our project by going to </span><strong class="bold"><span class="koboSpan" id="kobo.258.1">File</span></strong><span class="koboSpan" id="kobo.259.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.260.1">New File…</span></strong><span class="koboSpan" id="kobo.261.1"> and selecting </span><strong class="bold"><span class="koboSpan" id="kobo.262.1">Qt Resource File</span></strong><span class="koboSpan" id="kobo.263.1"> under the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.264.1">Qt</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.265.1"> template.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer099">
<span class="koboSpan" id="kobo.266.1"><img alt="Figure 6.6 – Create a new Qt Resource File" src="image/B20976_06_006.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.267.1">Figure 6.6 – Create a new Qt Resource File</span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.268.1">Then, create a folder called </span><strong class="source-inline"><span class="koboSpan" id="kobo.269.1">images</span></strong><span class="koboSpan" id="kobo.270.1"> in the resource file and add </span><strong class="source-inline"><span class="koboSpan" id="kobo.271.1">tux.png</span></strong><span class="koboSpan" id="kobo.272.1"> into the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.273.1">images</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.274.1"> folder.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer100">
<span class="koboSpan" id="kobo.275.1"><img alt="Figure 6.7 – Add tux.png to the images folder" src="image/B20976_06_007.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.276.1">Figure 6.7 – Add tux.png to the images folder</span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.277.1">Build and run the project now, and you should similar results </span><span class="No-Break"><span class="koboSpan" id="kobo.278.1">as follows:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer101">
<span class="koboSpan" id="kobo.279.1"><img alt="Figure 6.8 – The Hello World demo in Qt Quick 6" src="image/B20976_06_008.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.280.1">Figure 6.8 – The Hello World demo in Qt Quick 6</span></p>
<h2 id="_idParaDest-157"><a id="_idTextAnchor157"/><span class="koboSpan" id="kobo.281.1">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.282.1">Qt 6 introduces </span><a id="_idIndexMarker458"/><span class="koboSpan" id="kobo.283.1">many changes to Qt Quick as well but they are mostly underlying functions that do not affect much of the QML language and objects. </span><span class="koboSpan" id="kobo.283.2">Therefore, there are not many changes you need to make to your QML scripts when transitioning from Qt 5 to Qt 6. </span><span class="koboSpan" id="kobo.283.3">However, there are still some minor changes to how the project is structured and slight differences in </span><span class="No-Break"><span class="koboSpan" id="kobo.284.1">the code.</span></span></p>
<p><span class="koboSpan" id="kobo.285.1">One of the most obvious differences is that QML scripts are now listed under the </span><strong class="source-inline"><span class="koboSpan" id="kobo.286.1">QML</span></strong><span class="koboSpan" id="kobo.287.1"> category under the project structure instead of under </span><strong class="source-inline"><span class="koboSpan" id="kobo.288.1">Resources</span></strong><span class="koboSpan" id="kobo.289.1"> like how it used to be in </span><span class="No-Break"><span class="koboSpan" id="kobo.290.1">Qt 5.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer102">
<span class="koboSpan" id="kobo.291.1"><img alt="Figure 6.9 – QML files have their own category now" src="image/B20976_06_009.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.292.1">Figure 6.9 – QML files have their own category now</span></p>
<p><span class="koboSpan" id="kobo.293.1">Hence, when we load the </span><strong class="source-inline"><span class="koboSpan" id="kobo.294.1">main.qml</span></strong><span class="koboSpan" id="kobo.295.1"> file in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.296.1">main.cpp</span></strong><span class="koboSpan" id="kobo.297.1"> C++ source code, we will use </span><span class="No-Break"><span class="koboSpan" id="kobo.298.1">the following:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.299.1">
const QUrl url(u"qrc:/qt6_qml_new/main.qml"_qs);</span></pre> <p><span class="koboSpan" id="kobo.300.1">There are slight differences compared to how we did it in </span><span class="No-Break"><span class="koboSpan" id="kobo.301.1">Qt 5:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.302.1">
const QUrl url(QStringLiteral("qrc:/main.qml"));</span></pre> <p><span class="koboSpan" id="kobo.303.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.304.1">u</span></strong><span class="koboSpan" id="kobo.305.1"> preceding the string</span><a id="_idIndexMarker459"/><span class="koboSpan" id="kobo.306.1"> creates a 16-bit string literal and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.307.1">_qs</span></strong><span class="koboSpan" id="kobo.308.1"> after the string converts it to a </span><strong class="source-inline"><span class="koboSpan" id="kobo.309.1">QString</span></strong><span class="koboSpan" id="kobo.310.1">. </span><span class="koboSpan" id="kobo.310.2">These operators are similar to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.311.1">QStringLiteral</span></strong><span class="koboSpan" id="kobo.312.1"> macro used in Qt 5 but are easier to convert to the exact string format you want while complying with the C++ 17 </span><span class="No-Break"><span class="koboSpan" id="kobo.313.1">coding style.</span></span></p>
<p><span class="koboSpan" id="kobo.314.1">Another big difference in Qt 6 is that the </span><strong class="bold"><span class="koboSpan" id="kobo.315.1">Qt Quick Controls 1</span></strong><span class="koboSpan" id="kobo.316.1"> module is completely deleted from Qt Quick. </span><span class="koboSpan" id="kobo.316.2">Qt Quick now only supports </span><strong class="bold"><span class="koboSpan" id="kobo.317.1">Qt Quick Controls</span></strong><span class="koboSpan" id="kobo.318.1"> (formerly known as </span><strong class="bold"><span class="koboSpan" id="kobo.319.1">Qt Quick Controls 2</span></strong><span class="koboSpan" id="kobo.320.1">) with some slight changes. </span><span class="koboSpan" id="kobo.320.2">Let’s open up </span><strong class="source-inline"><span class="koboSpan" id="kobo.321.1">main.qml</span></strong><span class="koboSpan" id="kobo.322.1"> from the preceding example to see </span><span class="No-Break"><span class="koboSpan" id="kobo.323.1">the differences:</span></span></p>
<pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.324.1">import QtQuick</span></strong><span class="koboSpan" id="kobo.325.1">
Window {
    width: 640
    height: 480
    visible: true
    title: qsTr("Hello World")</span></pre> <p><span class="koboSpan" id="kobo.326.1">As you can see from the highlighted part in the preceding code block, the version number is now optional when importing a Qt Quick module. </span><span class="koboSpan" id="kobo.326.2">Qt will pick the latest version available </span><span class="No-Break"><span class="koboSpan" id="kobo.327.1">by default.</span></span></p>
<p><span class="koboSpan" id="kobo.328.1">Now, let’s look at the properties we declared in </span><span class="No-Break"><span class="koboSpan" id="kobo.329.1">the example:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.330.1">
property variant myColor: "red"
property url imageFolder: "/images"</span></pre> <p><span class="koboSpan" id="kobo.331.1">Even though the preceding code will run fine, it’s recommended to use Qt functions such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.332.1">Qt.color()</span></strong><span class="koboSpan" id="kobo.333.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.334.1">Qt.resolvedUrl()</span></strong><span class="koboSpan" id="kobo.335.1"> to return properties with the correct types, instead of just passing </span><span class="No-Break"><span class="koboSpan" id="kobo.336.1">a string:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.337.1">
property variant myColor: Qt.color("red")
property url imageFolder: Qt.resolvedUrl("/images")</span></pre> <p><span class="koboSpan" id="kobo.338.1">Another small difference that you may or may not notice is the way Qt treats relative paths. </span><span class="koboSpan" id="kobo.338.2">Previously in Qt 5, we would write relative path as </span><strong class="source-inline"><span class="koboSpan" id="kobo.339.1">./images</span></strong><span class="koboSpan" id="kobo.340.1">, which will return as </span><strong class="source-inline"><span class="koboSpan" id="kobo.341.1">qrc:/images</span></strong><span class="koboSpan" id="kobo.342.1">. </span><span class="koboSpan" id="kobo.342.2">In </span><a id="_idIndexMarker460"/><span class="koboSpan" id="kobo.343.1">Qt 6, however, </span><strong class="source-inline"><span class="koboSpan" id="kobo.344.1">./images</span></strong><span class="koboSpan" id="kobo.345.1"> will return as </span><strong class="source-inline"><span class="koboSpan" id="kobo.346.1">qrc:/[project_name]/images/tux.png</span></strong><span class="koboSpan" id="kobo.347.1">, which is not correct. </span><span class="koboSpan" id="kobo.347.2">We must use </span><strong class="source-inline"><span class="koboSpan" id="kobo.348.1">/images</span></strong><span class="koboSpan" id="kobo.349.1"> without the preceding </span><span class="No-Break"><span class="koboSpan" id="kobo.350.1">dot instead.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.351.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.352.1">For more information regarding</span><a id="_idIndexMarker461"/><span class="koboSpan" id="kobo.353.1"> the full changes of Qt Quick in Qt 6, please </span><span class="No-Break"><span class="koboSpan" id="kobo.354.1">visit </span></span><a href="https://doc.qt.io/qt-6/qtquickcontrols-changes-qt6.html"><span class="No-Break"><span class="koboSpan" id="kobo.355.1">https://doc.qt.io/qt-6/qtquickcontrols-changes-qt6.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.356.1">.</span></span></p>
</div>
</body></html>