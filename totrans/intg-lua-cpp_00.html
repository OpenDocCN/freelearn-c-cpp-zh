<html><head></head><body>
<div id="sbo-rt-content"><div id="_idContainer004">
<h1 id="_idParaDest-5"><a id="_idTextAnchor004"/>Preface</h1>
<p>This book teaches you how to integrate Lua <span class="No-Break">into C++.</span></p>
<p>Lua is a simple and efficient scripting language that has been widely adopted in the gaming industry and embedded systems. In those two fields, a large portion of the control programs and applications are written <span class="No-Break">in C++.</span></p>
<p>By bridging Lua and C++ together, you can open more doors and opportunities <span class="No-Break">for yourself.</span></p>
<h1 id="_idParaDest-6"><a id="_idTextAnchor005"/>Who this book is for</h1>
<p>This book is for C++ programmers who are willing to learn how to integrate Lua into their projects. This book can also benefit Lua programmers who want to learn C++ by combining exercises on C++ with <span class="No-Break">relevant topics.</span></p>
<p>A basic understanding of the C++ programming language is required to fully understand and engage with the book. Although a deeper understanding of C++ may make the book easier to read, you can learn the advanced C++ techniques you encounter in this book on your own through <span class="No-Break">online research.</span></p>
<p>No prior knowledge of the Lua programming language is needed, although some Lua experience might be beneficial. You can refer to the Lua reference manual frequently to learn the Lua programming language as you progress through <span class="No-Break">this book.</span></p>
<h1 id="_idParaDest-7"><a id="_idTextAnchor006"/>What this book covers</h1>
<p><span class="No-Break"><em class="italic">Chapter 1</em></span>, <em class="italic">Getting Your C++ Project </em><em class="italic">Lua-Ready</em>, explores how to get and compile Lua source code for use in your <span class="No-Break">own project.</span></p>
<p><span class="No-Break"><em class="italic">Chapter 2</em></span>, <em class="italic">Lua Fundamentals</em>, provides an introduction to the Lua <span class="No-Break">programming language.</span></p>
<p><span class="No-Break"><em class="italic">Chapter 3</em></span>, <em class="italic">How to Call Lua from C++</em>, guides you on how to load Lua scripts and call Lua functions <span class="No-Break">from C++.</span></p>
<p><span class="No-Break"><em class="italic">Chapter 4</em></span>, <em class="italic">Mapping Lua Types to C++</em>, delves into the mechanism of passing arguments to Lua functions and retrieving return values <span class="No-Break">in C++.</span></p>
<p><span class="No-Break"><em class="italic">Chapter 5</em></span>, <em class="italic">Working with Lua Tables</em>, trains you on how to work with Lua tables <span class="No-Break">in C++.</span></p>
<p><span class="No-Break"><em class="italic">Chapter 6</em></span>, <em class="italic">How to Call C++ from Lua</em>, breaks down the process of calling C++ code <span class="No-Break">from Lua.</span></p>
<p><span class="No-Break"><em class="italic">Chapter 7</em></span>, <em class="italic">Working with C++ Types</em>, delves into exporting C++ classes <span class="No-Break">to Lua.</span></p>
<p><span class="No-Break"><em class="italic">Chapter 8</em></span>, <em class="italic">Abstracting a C++ Type Exporter</em>, guides you on how to build a template class that can export any C++ class <span class="No-Break">to Lua.</span></p>
<p><span class="No-Break"><em class="italic">Chapter 9</em></span>, <em class="italic">Recapping Lua-C++ Communication Mechanisms</em>, reviews and summarizes the mechanisms to integrate Lua <span class="No-Break">with</span><span class="No-Break"> C++.</span></p>
<p><span class="No-Break"><em class="italic">Chapter 10</em></span>, <em class="italic">Managing Resources</em>, explores some advanced memory management techniques and resource <span class="No-Break">management principles.</span></p>
<p><span class="No-Break"><em class="italic">Chapter 11</em></span>, <em class="italic">Multithreading with Lua</em>, enables you to work with Lua in a <span class="No-Break">multithreaded environment.</span></p>
<h1 id="_idParaDest-8"><a id="_idTextAnchor007"/>To get the most out of this book</h1>
<p>This book will build a Lua executor. Each chapter will focus on one area and add one feature group to the executor. The exercises at the end of the chapter, if provided, are a crucial part to prepare for the next chapter. For the more experienced readers among you, this is why some code might not get implemented optimally in the initial chapters. This will help you stay focused on the topics <span class="No-Break">at hand.</span></p>
<p>This book assumes that you know C++ and are willing to learn about Lua. If you have no intention of being a Lua programmer, you only need to focus on the related Lua concepts rather than <span class="No-Break">Lua coding.</span></p>
<p>Because this is not a dedicated book to teach either of the programming languages, when you see the usage of a certain API that you are not familiar with, you can get more information from a Lua or a C++ reference manual. You can enrich your learning journey by frequently bridging your knowledge gaps through <span class="No-Break">online research.</span></p>
<p>Depending on your style of learning, you can either type all the examples yourself to be more hands-on or download the source code from GitHub, quickly skipping through the chapters and reverting to a specific chapter as needed when you start to implement your <span class="No-Break">own project.</span></p>
<p><em class="italic">If you are using the digital version of this book, we advise you to type the code yourself or access the code from the book’s GitHub repository (a link is available in the next section). Doing so will help you avoid any potential errors related to the copying and pasting </em><span class="No-Break"><em class="italic">of code.</em></span></p>
<h1 id="_idParaDest-9"><a id="_idTextAnchor008"/>Download the example code files</h1>
<p>You can download the example code files for this book from GitHub at <a href="https://github.com/PacktPublishing/Integrate-Lua-with-CPP">https://github.com/PacktPublishing/Integrate-Lua-with-CPP</a>. If there’s an update to the code, it will be updated in the <span class="No-Break">GitHub repository.</span></p>
<p>We also have other code bundles from our rich catalog of books and videos available at <a href="https://github.com/PacktPublishing/">https://github.com/PacktPublishing/</a>. Check <span class="No-Break">them out!</span></p>
<h1 id="_idParaDest-10"><a id="_idTextAnchor009"/>Conventions used</h1>
<p>There are a number of text conventions used throughout <span class="No-Break">this book.</span></p>
<p><strong class="source-inline">Code in text</strong>: Indicates code words in text, folder names, filenames, file extensions, pathnames, user input and <span class="No-Break">program output.</span></p>
<p>Here is an example: “Then you create a union type with <strong class="source-inline">std::variant</strong>, saying that this union type may be and can only be from the pre-defined <span class="No-Break">Lua mappings.”</span></p>
<p>A block of code is set <span class="No-Break">as follows:</span></p>
<pre class="source-code">
void LuaExecutor::setRegistry(const LuaValue &amp;key,
                              const LuaValue &amp;value)
{
    pushValue(key);
    pushValue(value);
    lua_settable(L, LUA_REGISTRYINDEX);
}</pre>
<p>When we wish to draw your attention to a particular part of a code block, the relevant lines or items are set <span class="No-Break">in bold:</span></p>
<pre class="source-code">
int luaNew(lua_State *L)
{
    ....
    if (type == LUA_TNIL)
    {
        ...
        <strong class="bold">lua_pushcfunction(L, luaDelete);</strong>
        <strong class="bold">lua_setfield(L, -2, "__gc");</strong>
    }
    ...
}</pre>
<p><strong class="bold">Bold</strong>: Indicates a new term, an important concept, or crucial software. Here is an example: “All systems with graphic user interfaces will also provide an application in which to start a shell. Often, those applications are called a <strong class="bold">terminal</strong> or <span class="No-Break">a </span><span class="No-Break"><strong class="bold">console</strong></span><span class="No-Break">.”</span></p>
<p class="callout-heading">Tips or important notes</p>
<p class="callout">Appear like this.</p>
<h1 id="_idParaDest-11"><a id="_idTextAnchor010"/>Get in touch</h1>
<p>Feedback from our readers is <span class="No-Break">always welcome.</span></p>
<p><strong class="bold">General feedback</strong>: If you have questions about any aspect of this book, email us at <strong class="source-inline">customercare@packtpub.com</strong> and mention the book title in the subject of <span class="No-Break">your message.</span></p>
<p><strong class="bold">Errata</strong>: Although we have taken every care to ensure the accuracy of our content, mistakes do happen. If you have found a mistake in this book, we would be grateful if you would report this to us. Please visit <a href="http://www.packtpub.com/support/errata">www.packtpub.com/support/errata</a> and fill in <span class="No-Break">the form.</span></p>
<p><strong class="bold">Piracy</strong>: If you come across any illegal copies of our works in any form on the internet, we would be grateful if you would provide us with the location address or website name. Please contact us at <strong class="source-inline">copyright@packt.com</strong> with a link to <span class="No-Break">the material.</span></p>
<p><strong class="bold">If you are interested in becoming an author</strong>: If there is a topic that you have expertise in and you are interested in either writing or contributing to a book, please <span class="No-Break">visit </span><a href="http://authors.packtpub.com"><span class="No-Break">authors.packtpub.com</span></a><span class="No-Break">.</span></p>
<h1 id="_idParaDest-12"><a id="_idTextAnchor011"/>Share Your Thoughts</h1>
<p>Once you’ve read <em class="italic">Integrate Lua to C++</em>, we’d love to hear your thoughts! Please <a href="">click here to go straight to the Amazon review page</a> for this book and share <span class="No-Break">your feedback.</span></p>
<p>Your review is important to us and the tech community and will help us make sure we’re delivering excellent <span class="No-Break">quality content.</span></p>
<h1 id="_idParaDest-13"><a id="_idTextAnchor012"/>Download a free PDF copy of this book</h1>
<p>Thanks for purchasing <span class="No-Break">this book!</span></p>
<p>Do you like to read on the go but are unable to carry your print <span class="No-Break">books everywhere?</span></p>
<p>Is your eBook purchase not compatible with the device of <span class="No-Break">your choice?</span></p>
<p>Don’t worry, now with every Packt book you get a DRM-free PDF version of that book at <span class="No-Break">no cost.</span></p>
<p>Read anywhere, any place, on any device. Search, copy, and paste code from your favorite technical books directly into your application. </p>
<p>The perks don’t stop there, you can get exclusive access to discounts, newsletters, and great free content in your <span class="No-Break">inbox daily</span></p>
<p>Follow these simple steps to get <span class="No-Break">the benefits:</span></p>
<ol>
<li>Scan the QR code or visit the <span class="No-Break">link below</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer003">
<img alt="" height="200" role="presentation" src="image/B20927_QR_Free_PDF.jpg" width="200"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><a href="https://packt.link/free-ebook/9781805128618">https://packt.link/free-ebook/9781805128618</a></p>
<ol>
<li value="2">Submit your proof <span class="No-Break">of purchase</span></li>
<li>That’s it! We’ll send your free PDF and other benefits to your <span class="No-Break">email directly</span></li>
</ol>
</div>
</div>

<div id="sbo-rt-content"><div class="Content" id="_idContainer005">
<h1 id="_idParaDest-14" lang="en-US" xml:lang="en-US"><a id="_idTextAnchor013"/>Part 1 – Lua Basics</h1>
<p>This part of the book will guide you through the process of getting and compiling Lua from the source code. Then, you will explore some options to set up your C++ projects to use Lua. This will be followed by a brief introduction to the Lua <span class="No-Break">programming language.</span></p>
<p>Hence, the aim of this part is to prepare you for the real work of integrating Lua into C++. Feel free to skip through some of the topics if you are already familiar <span class="No-Break">with them.</span></p>
<p>This part comprises the <span class="No-Break">following chapters:</span></p>
<ul>
<li><em class="italic">Chapter 1</em>, <em class="italic">Getting Your C++ Project Lua-Ready</em></li>
<li><em class="italic">Chapter 2</em>, <em class="italic">Lua Fundamentals</em></li>
</ul>
</div>
<div>
<div id="_idContainer006">
</div>
</div>
<div>
<div id="_idContainer007">
</div>
</div>
<div>
<div id="_idContainer008">
</div>
</div>
<div>
<div id="_idContainer009">
</div>
</div>
<div>
<div id="_idContainer010">
</div>
</div>
<div>
<div class="Basic-Graphics-Frame" id="_idContainer011">
</div>
</div>
<div>
<div class="Basic-Graphics-Frame" id="_idContainer012">
</div>
</div>
<div>
<div id="_idContainer013">
</div>
</div>
<div>
<div id="_idContainer014">
</div>
</div>
<div>
<div class="Basic-Graphics-Frame" id="_idContainer015">
</div>
</div>
</div></body></html>