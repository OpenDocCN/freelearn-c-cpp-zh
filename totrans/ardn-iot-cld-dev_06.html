<html><head></head><body>
<div id="_idContainer110">
<p> </p>
<h1 class="chapter-number" id="_idParaDest-120"><a id="_idTextAnchor120"/><span class="koboSpan" id="kobo.1.1">6</span></h1>
<h1 id="_idParaDest-121"><a id="_idTextAnchor121"/><span class="koboSpan" id="kobo.2.1">Project #3 – a Remote Asset Tracking Application with LoRaWAN</span></h1>
<p><span class="koboSpan" id="kobo.3.1">This chapter is dedicated to </span><strong class="bold"><span class="koboSpan" id="kobo.4.1">smart transportation</span></strong><span class="koboSpan" id="kobo.5.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.6.1">smart remote monitoring</span></strong><span class="koboSpan" id="kobo.7.1"> using low-power and</span><a id="_idIndexMarker481"/><span class="koboSpan" id="kobo.8.1"> long-range communication</span><a id="_idIndexMarker482"/><span class="koboSpan" id="kobo.9.1"> technology. </span><span class="koboSpan" id="kobo.9.2">The project in this chapter will take you through the implementation</span><a id="_idIndexMarker483"/><span class="koboSpan" id="kobo.10.1"> and deployment of a remote alarming application based on </span><strong class="bold"><span class="koboSpan" id="kobo.11.1">Long Range Wide Area Network</span></strong><span class="koboSpan" id="kobo.12.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.13.1">LoRaWAN</span></strong><span class="koboSpan" id="kobo.14.1">), connected to the public, global, and decentralized The Things Network. </span><span class="koboSpan" id="kobo.14.2">The project in this chapter provides localization features by using a GPS module. </span><span class="koboSpan" id="kobo.14.3">The </span><strong class="bold"><span class="koboSpan" id="kobo.15.1">Arduino IoT Cloud</span></strong><span class="koboSpan" id="kobo.16.1"> will be used for data visualization and remote configuration of the device. </span><span class="koboSpan" id="kobo.16.2">The application will be used in real use cases, showing the benefits offered by LoRaWAN technologies compared to other </span><span class="No-Break"><span class="koboSpan" id="kobo.17.1">wireless technologies.</span></span></p>
<p><span class="koboSpan" id="kobo.18.1">Here, we will practically explore LoRaWAN </span><a id="_idIndexMarker484"/><span class="koboSpan" id="kobo.19.1">technologies, which are very useful</span><a id="_idIndexMarker485"/><span class="koboSpan" id="kobo.20.1"> in remote monitoring and control, whether it’s </span><strong class="bold"><span class="koboSpan" id="kobo.21.1">asset tracking</span></strong><span class="koboSpan" id="kobo.22.1"> or </span><strong class="bold"><span class="koboSpan" id="kobo.23.1">remote operation monitoring</span></strong><span class="koboSpan" id="kobo.24.1">. </span><span class="koboSpan" id="kobo.24.2">This project uses the </span><strong class="bold"><span class="koboSpan" id="kobo.25.1">Arduino MKR WAN 1300</span></strong><span class="koboSpan" id="kobo.26.1"> development board, which is equipped with the latest </span><a id="_idIndexMarker486"/><span class="koboSpan" id="kobo.27.1">communication frequencies, 433/868/915 MHz US/EU. </span><span class="koboSpan" id="kobo.27.2">It is specially designed for </span><strong class="bold"><span class="koboSpan" id="kobo.28.1">Internet of Things</span></strong><span class="koboSpan" id="kobo.29.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.30.1">IoT</span></strong><span class="koboSpan" id="kobo.31.1">) and </span><strong class="bold"><span class="koboSpan" id="kobo.32.1">Industry 4.0</span></strong><span class="koboSpan" id="kobo.33.1"> use cases. </span><span class="koboSpan" id="kobo.33.2">This project explains</span><a id="_idIndexMarker487"/><span class="koboSpan" id="kobo.34.1"> how you can practically develop</span><a id="_idIndexMarker488"/><span class="koboSpan" id="kobo.35.1"> a tracking solution based on LoRaWAN communication for different </span><span class="No-Break"><span class="koboSpan" id="kobo.36.1">use cases.</span></span></p>
<p><span class="koboSpan" id="kobo.37.1">In this chapter, we will cover the following </span><span class="No-Break"><span class="koboSpan" id="kobo.38.1">main topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.39.1">Understanding LoRaWAN and its </span><span class="No-Break"><span class="koboSpan" id="kobo.40.1">IoT applications</span></span></li>
<li><span class="koboSpan" id="kobo.41.1">LoRaWAN versus other </span><span class="No-Break"><span class="koboSpan" id="kobo.42.1">communication technologies</span></span></li>
<li><span class="koboSpan" id="kobo.43.1">Components of a LoRaWAN </span><span class="No-Break"><span class="koboSpan" id="kobo.44.1">IoT application</span></span></li>
<li><span class="koboSpan" id="kobo.45.1">Essential hardware – sensors and </span><span class="No-Break"><span class="koboSpan" id="kobo.46.1">development boards</span></span></li>
<li><span class="koboSpan" id="kobo.47.1">Designing the </span><span class="No-Break"><span class="koboSpan" id="kobo.48.1">project architecture</span></span></li>
<li><span class="koboSpan" id="kobo.49.1">Setting up the Thing, adding devices, cloud variables, </span><span class="No-Break"><span class="koboSpan" id="kobo.50.1">and code</span></span></li>
<li><span class="koboSpan" id="kobo.51.1">Configuring the The Things </span><span class="No-Break"><span class="koboSpan" id="kobo.52.1">Indoor Gateway</span></span></li>
<li><span class="koboSpan" id="kobo.53.1">Creating web and </span><span class="No-Break"><span class="koboSpan" id="kobo.54.1">mobile dashboards</span></span></li>
</ul>
<h1 id="_idParaDest-122"><a id="_idTextAnchor122"/><span class="koboSpan" id="kobo.55.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.56.1">The following hardware components are required to complete the exercise in </span><span class="No-Break"><span class="koboSpan" id="kobo.57.1">this chapter:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.58.1">MKR WAN 1300 or MKR </span><span class="No-Break"><span class="koboSpan" id="kobo.59.1">WAN 1310</span></span></li>
<li><span class="koboSpan" id="kobo.60.1">The Things </span><span class="No-Break"><span class="koboSpan" id="kobo.61.1">Indoor Gateway</span></span></li>
<li><span class="koboSpan" id="kobo.62.1">The NEO-6M u-blox </span><span class="No-Break"><span class="koboSpan" id="kobo.63.1">GPS module</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.64.1">A breadboard</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.65.1">Jumper cables</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.66.1">To code, we will use the </span><strong class="bold"><span class="koboSpan" id="kobo.67.1">Arduino Web Editor</span></strong><span class="koboSpan" id="kobo.68.1">, which includes a large collection of development boards and sensor libraries, and the Arduino IoT Cloud for the Thing and dashboard setup. </span><span class="koboSpan" id="kobo.68.2">To develop hardware and sensor designs, we need the </span><strong class="bold"><span class="koboSpan" id="kobo.69.1">Fritzing</span></strong><span class="koboSpan" id="kobo.70.1"> desktop software, and we need the </span><strong class="bold"><span class="koboSpan" id="kobo.71.1">Arduino IDE</span></strong><span class="koboSpan" id="kobo.72.1"> for GPS </span><span class="No-Break"><span class="koboSpan" id="kobo.73.1">module testing.</span></span></p>
<p><span class="koboSpan" id="kobo.74.1">In this chapter, we will use the </span><strong class="bold"><span class="koboSpan" id="kobo.75.1">The Things Indoor Gateway </span></strong><span class="koboSpan" id="kobo.76.1">for LoRaWAN communication. </span><span class="koboSpan" id="kobo.76.2">The code used in the chapter is available in the book’s official GitHub repository by following this </span><span class="No-Break"><span class="koboSpan" id="kobo.77.1">link: </span></span><a href="https://github.com/PacktPublishing/Arduino-IoT-Cloud-for-Developers"><span class="No-Break"><span class="koboSpan" id="kobo.78.1">https://github.com/PacktPublishing/Arduino-IoT-Cloud-for-Developers</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.79.1">.</span></span></p>
<h1 id="_idParaDest-123"><a id="_idTextAnchor123"/><span class="koboSpan" id="kobo.80.1">Understanding LoRaWAN and its IoT applications</span></h1>
<p><span class="koboSpan" id="kobo.81.1">LoRaWAN is a wireless</span><a id="_idIndexMarker489"/><span class="koboSpan" id="kobo.82.1"> communication protocol</span><a id="_idIndexMarker490"/><span class="koboSpan" id="kobo.83.1"> and network architecture specifically designed for </span><strong class="bold"><span class="koboSpan" id="kobo.84.1">Low-Power Wide Area Networks</span></strong><span class="koboSpan" id="kobo.85.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.86.1">LPWANs</span></strong><span class="koboSpan" id="kobo.87.1">), enabling long-range communication between devices in the context of the IoT. </span><span class="koboSpan" id="kobo.87.2">LoRaWAN technology is optimized for applications that require low data rates, long battery life, and long communication ranges, making it well-suited</span><a id="_idIndexMarker491"/><span class="koboSpan" id="kobo.88.1"> for various IoT </span><span class="No-Break"><span class="koboSpan" id="kobo.89.1">use cases.</span></span></p>
<h2 id="_idParaDest-124"><a id="_idTextAnchor124"/><span class="koboSpan" id="kobo.90.1">Usage in IoT</span></h2>
<p><span class="koboSpan" id="kobo.91.1">LoRaWAN has been widely </span><a id="_idIndexMarker492"/><span class="koboSpan" id="kobo.92.1">adopted in various IoT applications due</span><a id="_idIndexMarker493"/><span class="koboSpan" id="kobo.93.1"> to its unique features. </span><span class="koboSpan" id="kobo.93.2">Some common use cases include </span><span class="No-Break"><span class="koboSpan" id="kobo.94.1">the following:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.95.1">Smart agriculture</span></strong><span class="koboSpan" id="kobo.96.1">: LoRaWAN can be used for soil moisture monitoring, crop health monitoring, livestock tracking, and precision farming, allowing farmers to optimize their operations and </span><span class="No-Break"><span class="koboSpan" id="kobo.97.1">increase yield</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.98.1">Smart cities</span></strong><span class="koboSpan" id="kobo.99.1">: LoRaWAN can enable smart street lighting, waste management, parking management, and environmental monitoring, helping cities become more efficient </span><span class="No-Break"><span class="koboSpan" id="kobo.100.1">and sustainable</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.101.1">Industrial monitoring</span></strong><span class="koboSpan" id="kobo.102.1">: LoRaWAN can monitor equipment health, track assets, and improve supply chain management in industrial settings, leading to better maintenance practices and </span><span class="No-Break"><span class="koboSpan" id="kobo.103.1">reduced downtime</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.104.1">Utilities</span></strong><span class="koboSpan" id="kobo.105.1">: LoRaWAN can be used for smart meters and to remotely monitor utility infrastructure, such as water and gas meters, improving billing accuracy and </span><span class="No-Break"><span class="koboSpan" id="kobo.106.1">resource management</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.107.1">Environmental monitoring</span></strong><span class="koboSpan" id="kobo.108.1">: LoRaWAN can support applications such as air quality monitoring, water quality monitoring, and wildlife tracking, helping researchers and organizations gather valuable </span><span class="No-Break"><span class="koboSpan" id="kobo.109.1">environmental data</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.110.1">Asset tracking</span></strong><span class="koboSpan" id="kobo.111.1">: LoRaWAN enables real-time tracking of assets, such as shipping containers, vehicles, and valuable equipment, ensuring their security and </span><span class="No-Break"><span class="koboSpan" id="kobo.112.1">efficient utilization</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.113.1">Overall, LoRaWAN’s combination of long communication ranges, low power consumption, and scalability makes it a powerful technology to build IoT networks that cover large areas and connect a wide range of devices for </span><span class="No-Break"><span class="koboSpan" id="kobo.114.1">various applications.</span></span></p>
<p><span class="koboSpan" id="kobo.115.1">In this section, we have discussed the different use cases of LoRaWAN in the field of IoT, and in the next section, we will discuss why to choose LoRaWAN over other </span><span class="No-Break"><span class="koboSpan" id="kobo.116.1">communication technologies.</span></span></p>
<h1 id="_idParaDest-125"><a id="_idTextAnchor125"/><span class="koboSpan" id="kobo.117.1">LoRaWAN versus other communication technologies</span></h1>
<p><span class="koboSpan" id="kobo.118.1">LoRaWAN offers several advantages over other communication technologies, making it a preferred choice for certain IoT applications. </span><span class="koboSpan" id="kobo.118.2">Here are some reasons why LoRaWAN might be chosen over </span><span class="No-Break"><span class="koboSpan" id="kobo.119.1">other alternatives:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.120.1">Long range</span></strong><span class="koboSpan" id="kobo.121.1">: LoRaWAN provides</span><a id="_idIndexMarker494"/><span class="koboSpan" id="kobo.122.1"> exceptional long-range communication capabilities, enabling devices to communicate over several kilometers in open areas. </span><span class="koboSpan" id="kobo.122.2">This is particularly useful for applications that require connectivity over large distances, such as agriculture, environmental monitoring, and </span><span class="No-Break"><span class="koboSpan" id="kobo.123.1">asset tracking.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.124.1">Low power consumption</span></strong><span class="koboSpan" id="kobo.125.1">: Devices using LoRaWAN can operate on very low power, extending battery life for years. </span><span class="koboSpan" id="kobo.125.2">This is crucial for remote or hard-to-reach locations where changing or recharging batteries is impractical </span><span class="No-Break"><span class="koboSpan" id="kobo.126.1">or costly.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.127.1">Deep indoor penetration</span></strong><span class="koboSpan" id="kobo.128.1">: LoRaWAN can penetrate buildings and other obstacles effectively, ensuring connectivity even in challenging environments. </span><span class="koboSpan" id="kobo.128.2">This makes it suitable for applications such as smart building management and indoor </span><span class="No-Break"><span class="koboSpan" id="kobo.129.1">asset tracking.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.130.1">Cost-effective</span></strong><span class="koboSpan" id="kobo.131.1">: Implementing and maintaining a LoRaWAN network is often more cost-effective than deploying traditional cellular networks. </span><span class="koboSpan" id="kobo.131.2">This makes LoRaWAN a viable option for businesses and organizations looking to deploy IoT solutions on a </span><span class="No-Break"><span class="koboSpan" id="kobo.132.1">larger scale.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.133.1">Scalability</span></strong><span class="koboSpan" id="kobo.134.1">: LoRaWAN networks can handle a massive number of devices within a single network. </span><span class="koboSpan" id="kobo.134.2">This scalability is essential for IoT applications that involve a high density of devices, such as smart </span><span class="No-Break"><span class="koboSpan" id="kobo.135.1">city deployments.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.136.1">Low data rate applications</span></strong><span class="koboSpan" id="kobo.137.1">: LoRaWAN is optimized for applications that transmit small amounts of data at low data rates. </span><span class="koboSpan" id="kobo.137.2">For IoT use cases involving sensor data, meter readings, and periodic updates, LoRaWAN provides a suitable and efficient </span><span class="No-Break"><span class="koboSpan" id="kobo.138.1">communication solution.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.139.1">Network flexibility</span></strong><span class="koboSpan" id="kobo.140.1">: LoRaWAN supports both public and private network deployments. </span><span class="koboSpan" id="kobo.140.2">Organizations can choose to set up their own private LoRaWAN network or use existing public networks, giving them flexibility in terms of ownership </span><span class="No-Break"><span class="koboSpan" id="kobo.141.1">and control.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.142.1">Adaptive data rate</span></strong><span class="koboSpan" id="kobo.143.1">: LoRaWAN devices can adjust their data rate based on signal strength and interference, optimizing communication for the current conditions. </span><span class="koboSpan" id="kobo.143.2">This adaptive feature enhances reliability and ensures the efficient use of </span><span class="No-Break"><span class="koboSpan" id="kobo.144.1">available resources.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.145.1">Global standard</span></strong><span class="koboSpan" id="kobo.146.1">: LoRaWAN is a global standard, and devices designed to work with it can operate seamlessly across different regions and countries. </span><span class="koboSpan" id="kobo.146.2">This standardization simplifies device development and deployment for </span><span class="No-Break"><span class="koboSpan" id="kobo.147.1">international projects.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.148.1">Diverse applications</span></strong><span class="koboSpan" id="kobo.149.1">: LoRaWAN’s versatility enables its use in various application domains, from agriculture and industrial monitoring to smart cities and </span><span class="No-Break"><span class="koboSpan" id="kobo.150.1">environmental sensing.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.151.1">While LoRaWAN offers these</span><a id="_idIndexMarker495"/><span class="koboSpan" id="kobo.152.1"> advantages, it’s important to note that no single communication technology is universally superior. </span><span class="koboSpan" id="kobo.152.2">The choice between LoRaWAN and other technologies (such as cellular, Wi-Fi, Bluetooth, or Zigbee) depends on the specific requirements of the IoT application, including factors such as range, power consumption, data rate, cost, and scalability. </span><span class="koboSpan" id="kobo.152.3">Each technology has its strengths and weaknesses, and the selection should be based on a careful analysis of a </span><span class="No-Break"><span class="koboSpan" id="kobo.153.1">project’s needs.</span></span></p>
<p><span class="koboSpan" id="kobo.154.1">In this section, we have discussed the benefits of using LoRaWAN. </span><span class="koboSpan" id="kobo.154.2">In the next section, we will explore the important components </span><span class="No-Break"><span class="koboSpan" id="kobo.155.1">of LoRaWAN.</span></span></p>
<h1 id="_idParaDest-126"><a id="_idTextAnchor126"/><span class="koboSpan" id="kobo.156.1">Components of a LoRaWAN IoT application</span></h1>
<p><span class="koboSpan" id="kobo.157.1">LoRaWAN is a wireless communication</span><a id="_idIndexMarker496"/><span class="koboSpan" id="kobo.158.1"> protocol and network architecture designed to enable long-range, low-power communication between IoT devices. </span><span class="koboSpan" id="kobo.158.2">It’s specifically tailored to connect devices that require extended battery life, reliable long-distance communication, and efficient use of the wireless spectrum. </span><span class="koboSpan" id="kobo.158.3">LoRaWAN is one of the key technologies in the realm of LPWANs. </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.159.1">Figure 6</span></em></span><em class="italic"><span class="koboSpan" id="kobo.160.1">.1</span></em><span class="koboSpan" id="kobo.161.1"> illustrates the whole architecture of the LoRaWAN solution, including the end nodes, gateway, network server, and </span><span class="No-Break"><span class="koboSpan" id="kobo.162.1">application server.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer086">
<span class="koboSpan" id="kobo.163.1"><img alt="Figure 6.1 – The components of a LoRaWAN network" src="image/B19752_06_01.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.164.1">Figure 6.1 – The components of a LoRaWAN network</span></p>
<p><span class="koboSpan" id="kobo.165.1">The LoRaWAN architecture consists of four </span><span class="No-Break"><span class="koboSpan" id="kobo.166.1">main components:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.167.1">End nodes/devices</span></strong><span class="koboSpan" id="kobo.168.1">: These are the IoT devices that gather data from sensors or perform specific tasks. </span><span class="koboSpan" id="kobo.168.2">They communicate with gateways using the LoRa modulation technique, sending data packets at low </span><span class="No-Break"><span class="koboSpan" id="kobo.169.1">data rates.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.170.1">Gateways</span></strong><span class="koboSpan" id="kobo.171.1">: Gateways serve as intermediate points that receive data packets from end devices and transmit them to a centralized network server. </span><span class="koboSpan" id="kobo.171.2">They are typically connected to the internet via wired or </span><span class="No-Break"><span class="koboSpan" id="kobo.172.1">wireless connections.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.173.1">Network server</span></strong><span class="koboSpan" id="kobo.174.1">: The network server manages communication between gateways and end devices. </span><span class="koboSpan" id="kobo.174.2">It handles functions such as authentication, encryption, and the routing of data packets to their respective </span><span class="No-Break"><span class="koboSpan" id="kobo.175.1">application servers.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.176.1">Application server</span></strong><span class="koboSpan" id="kobo.177.1">: The application server is responsible for processing data received from the network server and performing specific actions based on the data. </span><span class="koboSpan" id="kobo.177.2">It interfaces with an end user’s application or backend system to present data, trigger alerts, perform analytics, or control devices. </span><span class="koboSpan" id="kobo.177.3">The application server can be hosted on the cloud </span><span class="No-Break"><span class="koboSpan" id="kobo.178.1">or on-premises.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.179.1">In this section, we have</span><a id="_idIndexMarker497"/><span class="koboSpan" id="kobo.180.1"> discussed LoRaWAN components in detail, and in the next section, we are going to explore the hardware and sensors that are required to execute the practical exercise of </span><span class="No-Break"><span class="koboSpan" id="kobo.181.1">this chapter.</span></span></p>
<h1 id="_idParaDest-127"><a id="_idTextAnchor127"/><span class="koboSpan" id="kobo.182.1">Essential hardware – sensors and development boards</span></h1>
<p><span class="koboSpan" id="kobo.183.1">The Arduino series has a wide collection</span><a id="_idIndexMarker498"/><span class="koboSpan" id="kobo.184.1"> of development</span><a id="_idIndexMarker499"/><span class="koboSpan" id="kobo.185.1"> boards that vary in size, pins, and communication technologies. </span><span class="koboSpan" id="kobo.185.2">In this chapter, we will use the Arduino MKR WAN 1300 development board, as it’s compact, battery-enabled, and provides support for different frequencies from different regions around the world, including 433/868/915 MHz. </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.186.1">Figure 6</span></em></span><em class="italic"><span class="koboSpan" id="kobo.187.1">.2</span></em><span class="koboSpan" id="kobo.188.1"> shows a pinout diagram of the MKR </span><span class="No-Break"><span class="koboSpan" id="kobo.189.1">WAN 1300.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer087">
<span class="koboSpan" id="kobo.190.1"><img alt="Figure 6.2 – Arduino MKR WAN 1300" src="image/B19752_06_02.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.191.1">Figure 6.2 – Arduino MKR WAN 1300</span></p>
<p><span class="koboSpan" id="kobo.192.1">The Arduino MKR WAN 1300 provides seven analog pins, which start with </span><strong class="bold"><span class="koboSpan" id="kobo.193.1">A</span></strong><span class="koboSpan" id="kobo.194.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.195.1">A0</span></strong><span class="koboSpan" id="kobo.196.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.197.1">A1</span></strong><span class="koboSpan" id="kobo.198.1">, and so on), and eight digital input/output pins, which start with </span><strong class="bold"><span class="koboSpan" id="kobo.199.1">D</span></strong><span class="koboSpan" id="kobo.200.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.201.1">D0</span></strong><span class="koboSpan" id="kobo.202.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.203.1">D1</span></strong><span class="koboSpan" id="kobo.204.1">, and so on), with built-in battery charging and a </span><strong class="bold"><span class="koboSpan" id="kobo.205.1">lithium polymer</span></strong><span class="koboSpan" id="kobo.206.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.207.1">LiPo</span></strong><span class="koboSpan" id="kobo.208.1">) battery connector for standby power, which helps developers build prototypes and solutions for remote monitoring/operations</span><a id="_idIndexMarker500"/><span class="koboSpan" id="kobo.209.1"> without worrying about power</span><a id="_idIndexMarker501"/><span class="koboSpan" id="kobo.210.1"> backups. </span><span class="koboSpan" id="kobo.210.2">For further updates and the latest product development news, please visit the official website </span><span class="No-Break"><span class="koboSpan" id="kobo.211.1">at </span></span><a href="https://store.arduino.cc/products/arduino-mkr-wan-1300-lora-connectivity"><span class="No-Break"><span class="koboSpan" id="kobo.212.1">https://store.arduino.cc/products/arduino-mkr-wan-1300-lora-connectivity</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.213.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.214.1">Arduino’s latest development board is the MKR WAN 1310, which contains the same processor and module</span><a id="_idIndexMarker502"/><span class="koboSpan" id="kobo.215.1"> for LoRa communication as the MKR WAN 1300. </span><span class="koboSpan" id="kobo.215.2">However, the MKR WAN 1310 has an updated in-battery charger, 2 MB of </span><strong class="bold"><span class="koboSpan" id="kobo.216.1">Serial Peripheral Interface</span></strong><span class="koboSpan" id="kobo.217.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.218.1">SPI</span></strong><span class="koboSpan" id="kobo.219.1">) flash, and enhanced power consumption. </span><span class="koboSpan" id="kobo.219.2">This board is specially designed for IoT devices and is quickly growing in popularity in different regions. </span><span class="koboSpan" id="kobo.219.3">For its complete details and specifications, </span><span class="No-Break"><span class="koboSpan" id="kobo.220.1">visit </span></span><a href="https://store.arduino.cc/products/arduino-mkr-wan-1310"><span class="No-Break"><span class="koboSpan" id="kobo.221.1">https://store.arduino.cc/products/arduino-mkr-wan-1310</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.222.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.223.1">In this chapter, we will track the device via GPS coordinates. </span><span class="koboSpan" id="kobo.223.2">To get the GPS coordinates, we will use the GY-GPS6MV2 GPS module, which is based on the NEO-6M u-blox chip. </span><span class="koboSpan" id="kobo.223.3">The GPS module operates on both a software serial and a hardware serial, but the MKR WAN 1300 provides a built-in hardware serial, so we will use </span><em class="italic"><span class="koboSpan" id="kobo.224.1">ins 13</span></em><span class="koboSpan" id="kobo.225.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.226.1">14</span></em><span class="koboSpan" id="kobo.227.1"> to communicate with the GPS module shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.228.1">Figure 6</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.229.1">.3</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.230.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.231.1">The GPS module provides </span><a id="_idIndexMarker503"/><span class="koboSpan" id="kobo.232.1">latitude, longitude, satellite count, altitude feet, and speed-per-mile properties. </span><span class="koboSpan" id="kobo.232.2">These properties will be displayed on a dashboard</span><a id="_idIndexMarker504"/><span class="koboSpan" id="kobo.233.1"> for proper asset tracking. </span><span class="koboSpan" id="kobo.233.2">This module was developed in China and is available at affordable prices, but many other organizations are developing GPS modules that are also based on the NEO-6M u-blox chip, such as SparkFun, Seeed Studio, and Adafruit. </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.234.1">Figure 6</span></em></span><em class="italic"><span class="koboSpan" id="kobo.235.1">.3</span></em><span class="koboSpan" id="kobo.236.1"> shows a NEO-6M u-blox GPS module and its </span><span class="No-Break"><span class="koboSpan" id="kobo.237.1">pinout diagram:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer088">
<span class="koboSpan" id="kobo.238.1"><img alt="Figure 6.3 – The GY-GPS6MV2 NEO6MV2 GPS module and a pinout diagram" src="image/B19752_06_03.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.239.1">Figure 6.3 – The GY-GPS6MV2 NEO6MV2 GPS module and a pinout diagram</span></p>
<p><span class="koboSpan" id="kobo.240.1">The preceding diagram describes the pinout layout of the GPS module. </span><em class="italic"><span class="koboSpan" id="kobo.241.1">Pin #1</span></em><span class="koboSpan" id="kobo.242.1"> is the </span><strong class="bold"><span class="koboSpan" id="kobo.243.1">GND</span></strong><span class="koboSpan" id="kobo.244.1"> pin that connects with the onboard GND pin of the MKR WAN 1300. </span><em class="italic"><span class="koboSpan" id="kobo.245.1">Pin #2</span></em><span class="koboSpan" id="kobo.246.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.247.1">Pin #3</span></em><span class="koboSpan" id="kobo.248.1"> are </span><strong class="bold"><span class="koboSpan" id="kobo.249.1">TX</span></strong><span class="koboSpan" id="kobo.250.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.251.1">RX</span></strong><span class="koboSpan" id="kobo.252.1">, respectively, and will connect to </span><em class="italic"><span class="koboSpan" id="kobo.253.1">Pin #13</span></em><span class="koboSpan" id="kobo.254.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.255.1">Pin #14</span></em><span class="koboSpan" id="kobo.256.1"> of the MKR WAN 1300, respectively. </span><em class="italic"><span class="koboSpan" id="kobo.257.1">Pin #4</span></em><span class="koboSpan" id="kobo.258.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.259.1">VCC</span></strong><span class="koboSpan" id="kobo.260.1">, works with both an onboard VCC and the 5V pins of the MKR WAN 1300. </span><span class="koboSpan" id="kobo.260.2">You can solder the male headers with the GPS module or directly solder the cables without any </span><span class="No-Break"><span class="koboSpan" id="kobo.261.1">header pins.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.262.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.263.1">The GPS module</span><a id="_idIndexMarker505"/><span class="koboSpan" id="kobo.264.1"> works best in an outdoor environment. </span><span class="koboSpan" id="kobo.264.2">Make sure there are no rooftops above during testing and deployment to properly receive a signal </span><span class="No-Break"><span class="koboSpan" id="kobo.265.1">from satellites.</span></span></p>
<p class="callout"><span class="koboSpan" id="kobo.266.1">If you are using the module in the lab, then there will be a chance that the GPS module will not work properly. </span><span class="koboSpan" id="kobo.266.2">Remember that there is a built-in light on the GPS module that starts blinking when you receive signals </span><span class="No-Break"><span class="koboSpan" id="kobo.267.1">from satellites.</span></span></p>
<p><span class="koboSpan" id="kobo.268.1">In this section, we have discussed the development board and GPS</span><a id="_idIndexMarker506"/><span class="koboSpan" id="kobo.269.1"> module in detail, including</span><a id="_idIndexMarker507"/><span class="koboSpan" id="kobo.270.1"> their pinout diagrams. </span><span class="koboSpan" id="kobo.270.2">In the next section, we will start exploring how to connect the GPS module with the MKR </span><span class="No-Break"><span class="koboSpan" id="kobo.271.1">WAN 1300.</span></span></p>
<h1 id="_idParaDest-128"><a id="_idTextAnchor128"/><span class="koboSpan" id="kobo.272.1">Designing the project architecture</span></h1>
<p><span class="koboSpan" id="kobo.273.1">In the preceding sections, we discussed</span><a id="_idIndexMarker508"/><span class="koboSpan" id="kobo.274.1"> the module and development board in detail. </span><span class="koboSpan" id="kobo.274.2">Now, it’s time to cook the recipe. </span><span class="koboSpan" id="kobo.274.3">In hardware development, before getting to work with sensors and development boards, we need to develop the design concepts to get a better understanding of how things will connect. </span><span class="koboSpan" id="kobo.274.4">There is a lot of software that is available to design and develop design concepts for an electronics project, but in this case, we will </span><span class="No-Break"><span class="koboSpan" id="kobo.275.1">use Fritzing.</span></span></p>
<p><span class="koboSpan" id="kobo.276.1">In the following two subsections, we will talk about schematics and designing a project, while explaining how to connect pins with a development board and soldering. </span><span class="koboSpan" id="kobo.276.2">Then, we will do some tests to fetch GPS coordinates, which is very important before sending data to the Arduino </span><span class="No-Break"><span class="koboSpan" id="kobo.277.1">IoT Cloud.</span></span></p>
<h2 id="_idParaDest-129"><a id="_idTextAnchor129"/><span class="koboSpan" id="kobo.278.1">Schematics design and assembly</span></h2>
<p><span class="koboSpan" id="kobo.279.1">The purpose of your schematic design</span><a id="_idIndexMarker509"/><span class="koboSpan" id="kobo.280.1"> is to get a clear understanding</span><a id="_idIndexMarker510"/><span class="koboSpan" id="kobo.281.1"> of how sensors will connect with a development board. </span><span class="koboSpan" id="kobo.281.2">This helps engineers develop a prototype on a breadboard or Veroboard, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.282.1">Figure 6</span></em></span><em class="italic"><span class="koboSpan" id="kobo.283.1">.4</span></em><span class="koboSpan" id="kobo.284.1">. </span><span class="koboSpan" id="kobo.284.2">Another major benefit of designing is that Fritzing builds hardware schematics and PCB design in the background according to your design, which can be adjusted according to system requirements. </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.285.1">Figure 6</span></em></span><em class="italic"><span class="koboSpan" id="kobo.286.1">.4</span></em><span class="koboSpan" id="kobo.287.1"> shows a schematic diagram of how to connect the MKR WAN 1300 with the NEO-6M u-blox </span><span class="No-Break"><span class="koboSpan" id="kobo.288.1">GPS module:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer089">
<span class="koboSpan" id="kobo.289.1"><img alt="Figure 6.4 – The MKR WAN 1300 and GPS module schematic" src="image/B19752_06_04.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.290.1">Figure 6.4 – The MKR WAN 1300 and GPS module schematic</span></p>
<p><span class="koboSpan" id="kobo.291.1">While </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.292.1">Figure 6</span></em></span><em class="italic"><span class="koboSpan" id="kobo.293.1">.4</span></em><span class="koboSpan" id="kobo.294.1"> illustrates the design of the MKR WAN 1300 and GPS module, we have created </span><em class="italic"><span class="koboSpan" id="kobo.295.1">Table 6.1</span></em><span class="koboSpan" id="kobo.296.1"> for easier understanding, which illustrates (in row format) how to </span><span class="No-Break"><span class="koboSpan" id="kobo.297.1">connect pins.</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table001-3">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.298.1">MKR </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.299.1">WAN 1300</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.300.1">NEO-6M u-blox </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.301.1">GPS module</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.302.1">14 (TX)</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.303.1">RX</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.304.1">13 (RX)</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.305.1">TX</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.306.1">VCC</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.307.1">VCC</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.308.1">GND</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.309.1">GND</span></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.310.1">Table 6.1 – MKR WAN 1300 to GPS module pinout</span></p>
<p><span class="koboSpan" id="kobo.311.1">The preceding design provides</span><a id="_idIndexMarker511"/><span class="koboSpan" id="kobo.312.1"> a full overview of how you can connect</span><a id="_idIndexMarker512"/><span class="koboSpan" id="kobo.313.1"> a module to a development board. </span><span class="koboSpan" id="kobo.313.2">According to our design, we have 5V and GND pins going from the development board to the GPS module. </span><span class="koboSpan" id="kobo.313.3">The GPS module </span><strong class="bold"><span class="koboSpan" id="kobo.314.1">TX</span></strong><span class="koboSpan" id="kobo.315.1"> pin is connected to the </span><strong class="bold"><span class="koboSpan" id="kobo.316.1">RX</span></strong><span class="koboSpan" id="kobo.317.1"> pin (</span><em class="italic"><span class="koboSpan" id="kobo.318.1">Pin #13</span></em><span class="koboSpan" id="kobo.319.1">), and the GPS module </span><strong class="bold"><span class="koboSpan" id="kobo.320.1">RX</span></strong><span class="koboSpan" id="kobo.321.1"> pin is connected to the </span><strong class="bold"><span class="koboSpan" id="kobo.322.1">TX</span></strong><span class="koboSpan" id="kobo.323.1"> pin (</span><em class="italic"><span class="koboSpan" id="kobo.324.1">Pin #14</span></em><span class="koboSpan" id="kobo.325.1">) of the development board. </span><span class="koboSpan" id="kobo.325.2">Finally, we built our prototype by using a breadboard, which is shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.326.1">Figure 6</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.327.1">.5</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.328.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer090">
<span class="koboSpan" id="kobo.329.1"><img alt="Figure 6.5 – The final prototype MKR WAN 1300 and GPS module" src="image/B19752_06_05.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.330.1">Figure 6.5 – The final prototype MKR WAN 1300 and GPS module</span></p>
<p><span class="koboSpan" id="kobo.331.1">After soldering the male headers</span><a id="_idIndexMarker513"/><span class="koboSpan" id="kobo.332.1"> to the GPS module, connect the pins</span><a id="_idIndexMarker514"/><span class="koboSpan" id="kobo.333.1"> according to the schematic diagram. </span><span class="koboSpan" id="kobo.333.2">There is only one sensor, so there is no requirement for the Veroboard. </span><span class="koboSpan" id="kobo.333.3">Next, we will test the GPS module using Arduino’s </span><strong class="bold"><span class="koboSpan" id="kobo.334.1">Serial Monitor</span></strong><span class="koboSpan" id="kobo.335.1"> tool to verify that our GPS module </span><a id="_idIndexMarker515"/><span class="koboSpan" id="kobo.336.1">works properly and gets values from </span><span class="No-Break"><span class="koboSpan" id="kobo.337.1">GPS satellites.</span></span></p>
<h2 id="_idParaDest-130"><a id="_idTextAnchor130"/><span class="koboSpan" id="kobo.338.1">Testing GPS module data</span></h2>
<p><span class="koboSpan" id="kobo.339.1">Before moving toward</span><a id="_idIndexMarker516"/><span class="koboSpan" id="kobo.340.1"> the Arduino IoT Cloud, firstly, we need to verify that our GPS module is working. </span><span class="koboSpan" id="kobo.340.2">So, in this section, we will test the GPS module by using the Arduino IDE and its Serial Monitor tool to observe the readings from the GPS module. </span><span class="koboSpan" id="kobo.340.3">The following steps will guide you on how we will set up the </span><span class="No-Break"><span class="koboSpan" id="kobo.341.1">testing environment:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.342.1">For module testing, we need the Serial Monitor tool to verify whether the GPS module works properly or not. </span><span class="koboSpan" id="kobo.342.2">Click on the </span><strong class="bold"><span class="koboSpan" id="kobo.343.1">Tools</span></strong><span class="koboSpan" id="kobo.344.1"> menu and select </span><strong class="bold"><span class="koboSpan" id="kobo.345.1">Serial Monitor</span></strong><span class="koboSpan" id="kobo.346.1">. </span><span class="koboSpan" id="kobo.346.2">Select the Arduino MKR WAN 1300 board from </span><strong class="bold"><span class="koboSpan" id="kobo.347.1">Tools</span></strong><span class="koboSpan" id="kobo.348.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.349.1">Board</span></strong><span class="koboSpan" id="kobo.350.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.351.1">Arduino SAMD</span></strong><span class="koboSpan" id="kobo.352.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.353.1">Arduino MKR WAN 1300</span></strong><span class="koboSpan" id="kobo.354.1"> in the </span><span class="No-Break"><span class="koboSpan" id="kobo.355.1">Arduino IDE.</span></span></li>
<li><span class="koboSpan" id="kobo.356.1">Select the port of the MKR </span><span class="No-Break"><span class="koboSpan" id="kobo.357.1">WAN 1300.</span></span></li>
<li><span class="koboSpan" id="kobo.358.1">Next, we need to install the library for the GPS module in the Arduino IDE. </span><span class="koboSpan" id="kobo.358.2">Navigate to </span><strong class="bold"><span class="koboSpan" id="kobo.359.1">Sketch</span></strong><span class="koboSpan" id="kobo.360.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.361.1">Include Library</span></strong><span class="koboSpan" id="kobo.362.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.363.1">Manage Libraries</span></strong><span class="koboSpan" id="kobo.364.1">. </span><span class="koboSpan" id="kobo.364.2">Type </span><strong class="source-inline"><span class="koboSpan" id="kobo.365.1">tinygps</span></strong><span class="koboSpan" id="kobo.366.1"> into the </span><span class="No-Break"><span class="koboSpan" id="kobo.367.1">search bar.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer091">
<span class="koboSpan" id="kobo.368.1"><img alt="Figure 6.6 – The TinyGPSPlus library" src="image/B19752_06_06.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.369.1">Figure 6.6 – The TinyGPSPlus library</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.370.1">After searching, the Library</span><a id="_idIndexMarker517"/><span class="koboSpan" id="kobo.371.1"> Manager brings up a lot of libraries. </span><span class="koboSpan" id="kobo.371.2">Select the </span><strong class="bold"><span class="koboSpan" id="kobo.372.1">TinyGPSPlus</span></strong><span class="koboSpan" id="kobo.373.1"> library and install its latest version. </span><span class="koboSpan" id="kobo.373.2">The library comes with a lot of examples, and all of them are based on a software serial. </span><span class="koboSpan" id="kobo.373.3">However, Arduino SAMD boards provide a hardware serial. </span><span class="koboSpan" id="kobo.373.4">Therefore, I’ve modified the code to use a hardware serial to communicate with the </span><span class="No-Break"><span class="koboSpan" id="kobo.374.1">GPS module.</span></span></li>
<li><span class="koboSpan" id="kobo.375.1">Download the code from the book’s official GitHub repository, and under the </span><strong class="source-inline"><span class="koboSpan" id="kobo.376.1">chapter#6</span></strong><span class="koboSpan" id="kobo.377.1"> folder, open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.378.1">MKR-WAN-1300-NEO-6M-GPS-Module</span></strong><span class="koboSpan" id="kobo.379.1"> ZIP folder, extract it, and upload the code to the </span><span class="No-Break"><span class="koboSpan" id="kobo.380.1">development board:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.381.1">
while(Serial1.available()&gt;0)//While there are characters to come from the GPS
  {
    gps.encode(Serial1.read());//This feeds the serial NMEA data into the library one char at a time
  }
  if(gps.location.isUpdated())//This will pretty much be fired all the time anyway but will at least reduce it to only after a package of NMEA data comes in
  {
    //Get the latest info from the gps object which it derived from the data sent by the GPS unit
    Serial.println("Satellite Count:");
    Serial.println(gps.satellites.value());
    Serial.println("Latitude:");
    Serial.println(gps.location.lat(), 6);
    Serial.println("Longitude:");
    Serial.println(gps.location.lng(), 6);
    Serial.println("Speed MPH:");
    Serial.println(gps.speed.mph());
    Serial.println("Altitude Feet:");
    Serial.println(gps.altitude.feet());
    Serial.println("");
  }</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.382.1">In the setup, we have</span><a id="_idIndexMarker518"/><span class="koboSpan" id="kobo.383.1"> initialized </span><strong class="source-inline"><span class="koboSpan" id="kobo.384.1">Serial</span></strong><span class="koboSpan" id="kobo.385.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.386.1">Serial1</span></strong><span class="koboSpan" id="kobo.387.1">. </span><strong class="source-inline"><span class="koboSpan" id="kobo.388.1">Serial</span></strong><span class="koboSpan" id="kobo.389.1"> is used to display the content to the Serial Monitor (the magnifier icon in the top right of the Arduino IDE) on screen, while </span><strong class="source-inline"><span class="koboSpan" id="kobo.390.1">Serial1</span></strong><span class="koboSpan" id="kobo.391.1"> is the hardware serial that is used to communicate with the GPS module. </span><span class="koboSpan" id="kobo.391.2">The preceding code belongs to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.392.1">loop()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.393.1"> method.</span></span></p>
<p><span class="koboSpan" id="kobo.394.1">First, the GPS module will read data from satellites using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.395.1">Serial1.read()</span></strong><span class="koboSpan" id="kobo.396.1"> method and encode it via the </span><strong class="source-inline"><span class="koboSpan" id="kobo.397.1">gps.encode()</span></strong><span class="koboSpan" id="kobo.398.1"> method. </span><strong class="source-inline"><span class="koboSpan" id="kobo.399.1">Serial1</span></strong><span class="koboSpan" id="kobo.400.1"> only reads one character at a time, so it will take a little bit of time for the updated values. </span><span class="koboSpan" id="kobo.400.2">Then, we will verify whether there is any update in </span><strong class="source-inline"><span class="koboSpan" id="kobo.401.1">Latitude</span></strong><span class="koboSpan" id="kobo.402.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.403.1">Longitude</span></strong><span class="koboSpan" id="kobo.404.1"> coordinates by using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.405.1">gps.location.isUpdated()</span></strong><span class="koboSpan" id="kobo.406.1"> method. </span><span class="koboSpan" id="kobo.406.2">If there is a change, then the data will be printed on the </span><span class="No-Break"><span class="koboSpan" id="kobo.407.1">Serial</span></span><span class="No-Break"><a id="_idIndexMarker519"/></span><span class="No-Break"><span class="koboSpan" id="kobo.408.1"> Monitor.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.409.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.410.1">Make sure your GPS module is placed in an open environment where you have a clear sky, without any obstruction such as a roof or anything that stops you from receiving proper signals </span><span class="No-Break"><span class="koboSpan" id="kobo.411.1">from satellites.</span></span></p>
<p class="callout"><span class="koboSpan" id="kobo.412.1">The GPS module has an onboard built-in LED that starts blinking when it starts receiving data from </span><span class="No-Break"><span class="koboSpan" id="kobo.413.1">GPS satellites.</span></span></p>
<p class="callout"><span class="koboSpan" id="kobo.414.1">The same code will work with the MKR WAN 1310 without </span><span class="No-Break"><span class="koboSpan" id="kobo.415.1">any modification.</span></span></p>
<p><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.416.1">Figure 6</span></em></span><em class="italic"><span class="koboSpan" id="kobo.417.1">.7</span></em><span class="koboSpan" id="kobo.418.1"> shows the Serial Monitor with values from the GPS, which includes </span><strong class="source-inline"><span class="koboSpan" id="kobo.419.1">Latitude</span></strong><span class="koboSpan" id="kobo.420.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.421.1">Longitude</span></strong><span class="koboSpan" id="kobo.422.1">, and </span><span class="No-Break"><span class="koboSpan" id="kobo.423.1">other parameters:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer092">
<span class="koboSpan" id="kobo.424.1"><img alt="Figure 6.7 – The GPS module data on the Serial Monitor" src="image/B19752_06_07.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.425.1">Figure 6.7 – The GPS module data on the Serial Monitor</span></p>
<p><span class="koboSpan" id="kobo.426.1">The preceding figure shows the data that is received by the GPS module from GPS satellites and printed on the Serial Monitor. </span><span class="koboSpan" id="kobo.426.2">The data includes the satellite count, the latitude and longitude that represent the location coordinates, the speed in MPH based on current and previous GPS coordinates, and the altitude </span><span class="No-Break"><span class="koboSpan" id="kobo.427.1">in feet.</span></span></p>
<p><span class="koboSpan" id="kobo.428.1">In this section, we tested the NEO-6M u-blox GPS module in the Arduino IDE. </span><span class="koboSpan" id="kobo.428.2">First, we installed the </span><strong class="source-inline"><span class="koboSpan" id="kobo.429.1">TinyGPSPlus</span></strong><span class="koboSpan" id="kobo.430.1"> library for the module, and later, we used the aforementioned code for the development</span><a id="_idIndexMarker520"/><span class="koboSpan" id="kobo.431.1"> board, which shows the readings on the Serial Monitor. </span><span class="koboSpan" id="kobo.431.2">In the next section, we will start with the Thing setup in the Arduino </span><span class="No-Break"><span class="koboSpan" id="kobo.432.1">IoT Cloud.</span></span></p>
<h1 id="_idParaDest-131"><a id="_idTextAnchor131"/><span class="koboSpan" id="kobo.433.1">Setting up the Thing, device association, cloud variables, and code</span></h1>
<p><span class="koboSpan" id="kobo.434.1">After setting up the hardware, it’s time</span><a id="_idIndexMarker521"/><span class="koboSpan" id="kobo.435.1"> to set up the Thing in the Arduino IoT Cloud. </span><span class="koboSpan" id="kobo.435.2">For this project, we need four cloud variables to fetch different properties from the device. </span><span class="koboSpan" id="kobo.435.3">The device association settings will be different due to the LoRa series board. </span><span class="koboSpan" id="kobo.435.4">Also, network configuration will happen automatically when we upload the code/sketch to the MKR WAN 1300. </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.436.1">Figure 6</span></em></span><em class="italic"><span class="koboSpan" id="kobo.437.1">.8</span></em><span class="koboSpan" id="kobo.438.1"> shows a complete overview of </span><span class="No-Break"><span class="koboSpan" id="kobo.439.1">the Thing:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer093">
<span class="koboSpan" id="kobo.440.1"><img alt="Figure 6.8 – Remote asset tracking using the LoRaWAN Thing setup" src="image/B19752_06_08.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.441.1">Figure 6.8 – Remote asset tracking using the LoRaWAN Thing setup</span></p>
<p><span class="koboSpan" id="kobo.442.1">Set up a new Thing with the name </span><strong class="bold"><span class="koboSpan" id="kobo.443.1">A remote asset tracking using LoRaWAN</span></strong><span class="koboSpan" id="kobo.444.1">, and then follow the next steps, which will take you to the next subsections to create variables, an associate </span><a id="_idIndexMarker522"/><span class="koboSpan" id="kobo.445.1">device network configuration, and finally, code. </span><span class="koboSpan" id="kobo.445.2">We have marked the preceding figure with red boxes and numbers according to the </span><span class="No-Break"><span class="koboSpan" id="kobo.446.1">following steps.</span></span></p>
<p><span class="koboSpan" id="kobo.447.1">Firstly, we need to set up four cloud variables – </span><strong class="source-inline"><span class="koboSpan" id="kobo.448.1">Location</span></strong><span class="koboSpan" id="kobo.449.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.450.1">AltitudeFeet</span></strong><span class="koboSpan" id="kobo.451.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.452.1">SatelliteCount</span></strong><span class="koboSpan" id="kobo.453.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.454.1">Speed</span></strong><span class="koboSpan" id="kobo.455.1">. </span><span class="koboSpan" id="kobo.455.2">The complete details regarding cloud variables are available in the </span><span class="No-Break"><span class="koboSpan" id="kobo.456.1">following subsection.</span></span></p>
<p><span class="koboSpan" id="kobo.457.1">After that, we need to associate the device with the Thing. </span><span class="koboSpan" id="kobo.457.2">In the current project, we will use the MKR WAN 1300, so the process will be the same as the one used for Arduino boards, but here, we will see some different options due to LoRaWAN. </span><span class="koboSpan" id="kobo.457.3">The complete details</span><a id="_idIndexMarker523"/><span class="koboSpan" id="kobo.458.1"> are available in the </span><em class="italic"><span class="koboSpan" id="kobo.459.1">Associating a </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.460.1">device</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.461.1"> section.</span></span></p>
<h2 id="_idParaDest-132"><a id="_idTextAnchor132"/><span class="koboSpan" id="kobo.462.1">Cloud variables</span></h2>
<p><span class="koboSpan" id="kobo.463.1">The following table explains</span><a id="_idIndexMarker524"/><span class="koboSpan" id="kobo.464.1"> all the properties of the variables that we need to create. </span><span class="koboSpan" id="kobo.464.2">For the location, we need two different variables to store the latitude and longitude, but thanks to the Arduino IoT Cloud extended group of variables, we have a </span><strong class="source-inline"><span class="koboSpan" id="kobo.465.1">Location</span></strong><span class="koboSpan" id="kobo.466.1">-type variable. </span><span class="koboSpan" id="kobo.466.2">Then, make sure each variable matches the declaration in the table; otherwise, you will need to modify the example code according to </span><span class="No-Break"><span class="koboSpan" id="kobo.467.1">your naming.</span></span></p>
<p><span class="koboSpan" id="kobo.468.1">As shown in </span><em class="italic"><span class="koboSpan" id="kobo.469.1">Table 6.2</span></em><span class="koboSpan" id="kobo.470.1">, when creating the cloud variables, we set the permission to </span><strong class="bold"><span class="koboSpan" id="kobo.471.1">Read-Only</span></strong><span class="koboSpan" id="kobo.472.1">. </span><span class="koboSpan" id="kobo.472.2">Although we have the </span><em class="italic"><span class="koboSpan" id="kobo.473.1">Read</span></em><span class="koboSpan" id="kobo.474.1">/</span><em class="italic"><span class="koboSpan" id="kobo.475.1">Write</span></em><span class="koboSpan" id="kobo.476.1"> option, in this project, we only want to receive data from the device instead of modifying the data via the dashboard. </span><span class="koboSpan" id="kobo.476.2">That’s why </span><strong class="bold"><span class="koboSpan" id="kobo.477.1">read-only</span></strong><span class="koboSpan" id="kobo.478.1"> mode is used – to avoid issues in data consistency. </span><strong class="bold"><span class="koboSpan" id="kobo.479.1">Update policy</span></strong><span class="koboSpan" id="kobo.480.1"> is set to </span><strong class="bold"><span class="koboSpan" id="kobo.481.1">On Change</span></strong><span class="koboSpan" id="kobo.482.1">, as the device will send the data when the GPS module receives new data </span><span class="No-Break"><span class="koboSpan" id="kobo.483.1">from satellites.</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table002-2">
<colgroup>
<col/>
<col/>
<col/>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.484.1">S#</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.485.1">Variable name</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.486.1">Variable type</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.487.1">Declaration</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.488.1">Permission</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.489.1">Update </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.490.1">policy</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.491.1">1</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.492.1">AltitudeFeet</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.493.1">Float</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.494.1">altitudeFeet</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.495.1">Read-Only</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.496.1">On Change</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.497.1">2</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.498.1">Location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.499.1">CloudLocation</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.500.1">location</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.501.1">Read-Only</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.502.1">On Change</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.503.1">3</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.504.1">SatelliteCount</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.505.1">Int</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.506.1">satelliteCount</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.507.1">Read-Only</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.508.1">On Change</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.509.1">4</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.510.1">Speed</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.511.1">Float</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.512.1">speed</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.513.1">Read-Only</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.514.1">On Change</span></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.515.1">Table 6.2 – The cloud variables list for the Thing</span></p>
<p><span class="koboSpan" id="kobo.516.1">In this section, we discussed what type of cloud variables are required for this project. </span><span class="koboSpan" id="kobo.516.2">Here, we listed four cloud variables of different types but in </span><strong class="bold"><span class="koboSpan" id="kobo.517.1">read-only</span></strong><span class="koboSpan" id="kobo.518.1"> mode, as we only want to extract the values from the device. </span><span class="koboSpan" id="kobo.518.2">In the next subsection, we will associate the MKR WAN 1300 with</span><a id="_idIndexMarker525"/> <span class="No-Break"><span class="koboSpan" id="kobo.519.1">the Thing.</span></span></p>
<h2 id="_idParaDest-133"><a id="_idTextAnchor133"/><span class="koboSpan" id="kobo.520.1">Associating a device</span></h2>
<p><span class="koboSpan" id="kobo.521.1">After creating the variables, it’s time to add the device </span><a id="_idIndexMarker526"/><span class="koboSpan" id="kobo.522.1">and associate it with </span><span class="No-Break"><span class="koboSpan" id="kobo.523.1">the Thing:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.524.1">Before adding the device, connect </span><a id="_idIndexMarker527"/><span class="koboSpan" id="kobo.525.1">the development board to the computer and open the </span><strong class="bold"><span class="koboSpan" id="kobo.526.1">Arduino Create Agent</span></strong><span class="koboSpan" id="kobo.527.1"> application. </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.528.1">Figure 6</span></em></span><em class="italic"><span class="koboSpan" id="kobo.529.1">.9</span></em><span class="koboSpan" id="kobo.530.1"> shows a popup in which we have options to either select the existing device for association or set up a new device that is not available on </span><span class="No-Break"><span class="koboSpan" id="kobo.531.1">the list.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer094">
<span class="koboSpan" id="kobo.532.1"><img alt="Figure 6.9 – Associate device – selecting a device" src="image/B19752_06_09.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.533.1">Figure 6.9 – Associate device – selecting a device</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.534.1">In our case, we already have different</span><a id="_idIndexMarker528"/><span class="koboSpan" id="kobo.535.1"> devices in the portal, but we want to add a new one, MKR WAN 1300, so just click on </span><strong class="bold"><span class="koboSpan" id="kobo.536.1">SET UP NEW DEVICE</span></strong><span class="koboSpan" id="kobo.537.1"> to configure the new device in </span><span class="No-Break"><span class="koboSpan" id="kobo.538.1">the account.</span></span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.539.1">Then, you will see three options in the popup. </span><span class="koboSpan" id="kobo.539.2">The first option is </span><strong class="bold"><span class="koboSpan" id="kobo.540.1">Arduino board</span></strong><span class="koboSpan" id="kobo.541.1">, the second option is </span><strong class="bold"><span class="koboSpan" id="kobo.542.1">Third party device</span></strong><span class="koboSpan" id="kobo.543.1">, and the third option is </span><strong class="bold"><span class="koboSpan" id="kobo.544.1">Any Device</span></strong><span class="koboSpan" id="kobo.545.1">, which is for non-compatible devices. </span><span class="koboSpan" id="kobo.545.2">This means you can now use all types of Arduino devices</span><a id="_idIndexMarker529"/><span class="koboSpan" id="kobo.546.1"> as well as third-party devices with the Arduino IoT Cloud, which supports Python, MicroPython, </span><span class="No-Break"><span class="koboSpan" id="kobo.547.1">and JavaScript.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer095">
<span class="koboSpan" id="kobo.548.1"><img alt="Figure 6.10 – Choosing a development device" src="image/B19752_06_10.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.549.1">Figure 6.10 – Choosing a development device</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.550.1">Click on </span><strong class="bold"><span class="koboSpan" id="kobo.551.1">Arduino board</span></strong><span class="koboSpan" id="kobo.552.1"> (marked with a red box in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.553.1">Figure 6</span></em></span><em class="italic"><span class="koboSpan" id="kobo.554.1">.10</span></em><span class="koboSpan" id="kobo.555.1">) and the next step will automatically detect the MKR WAN 1300 board, which we are using in this chapter. </span><span class="koboSpan" id="kobo.555.2">Before adding the device, make sure that </span><strong class="bold"><span class="koboSpan" id="kobo.556.1">Arduino Create Agent</span></strong><span class="koboSpan" id="kobo.557.1"> is running</span><a id="_idIndexMarker530"/><span class="koboSpan" id="kobo.558.1"> on your machine. </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.559.1">Figure 6</span></em></span><em class="italic"><span class="koboSpan" id="kobo.560.1">.11</span></em><span class="koboSpan" id="kobo.561.1"> shows that the Arduino IoT Cloud detected the MKR </span><span class="No-Break"><span class="koboSpan" id="kobo.562.1">WAN 1300.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer096">
<span class="koboSpan" id="kobo.563.1"><img alt="Figure 6.11 – The device found" src="image/B19752_06_11.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.564.1">Figure 6.11 – The device found</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.565.1">When the popup finds the device, click on the </span><strong class="bold"><span class="koboSpan" id="kobo.566.1">CONFIGURE</span></strong><span class="koboSpan" id="kobo.567.1"> button, which will take you to the </span><span class="No-Break"><span class="koboSpan" id="kobo.568.1">next screen.</span></span></p>
<ol>
<li value="4"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.569.1">Figure 6</span></em></span><em class="italic"><span class="koboSpan" id="kobo.570.1">.12</span></em><span class="koboSpan" id="kobo.571.1"> shows a screen</span><a id="_idIndexMarker531"/><span class="koboSpan" id="kobo.572.1"> that provides some details about the </span><strong class="bold"><span class="koboSpan" id="kobo.573.1">The Things Stack</span></strong><span class="koboSpan" id="kobo.574.1"> portal link. </span><span class="koboSpan" id="kobo.574.2">You will also see a message saying that you need an active LoRaWAN gateway for the MKR WAN 1300 to communicate with the Arduino </span><span class="No-Break"><span class="koboSpan" id="kobo.575.1">IoT Cloud.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer097">
<span class="koboSpan" id="kobo.576.1"><img alt="Figure 6.12 – The active LoRaWAN gateway" src="image/B19752_06_12.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.577.1">Figure 6.12 – The active LoRaWAN gateway</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.578.1">If you already have the gateway</span><a id="_idIndexMarker532"/><span class="koboSpan" id="kobo.579.1"> set up, then that’s fine; otherwise, in the </span><em class="italic"><span class="koboSpan" id="kobo.580.1">Configuring the The Things Indoor Gateway </span></em><span class="koboSpan" id="kobo.581.1">section, read up on how to set up the The Things Indoor Gateway, which will provide connectivity to your MKR WAN 1300 </span><span class="No-Break"><span class="koboSpan" id="kobo.582.1">development board.</span></span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.583.1">This message also informs you that the Arduino IoT Cloud will automatically configure your device in the The Things </span><span class="No-Break"><span class="koboSpan" id="kobo.584.1">Stack portal.</span></span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.585.1">After associating</span><a id="_idIndexMarker533"/><span class="koboSpan" id="kobo.586.1"> the device, you will receive an email with a username and password, as well as a URL for the The Things Stack portal login, which contains all the information about LoRaWAN nodes. </span><span class="koboSpan" id="kobo.586.2">Here, the Arduino IoT Cloud will automatically add the MKR WAN 1300 to the The Things Stack portal after the final steps. </span><span class="koboSpan" id="kobo.586.3">Next, </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.587.1">Figure 6</span></em></span><em class="italic"><span class="koboSpan" id="kobo.588.1">.13</span></em><span class="koboSpan" id="kobo.589.1"> shows that we need to select a frequency for </span><span class="No-Break"><span class="koboSpan" id="kobo.590.1">our device.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer098">
<span class="koboSpan" id="kobo.591.1"><img alt="Figure 6.13 – The MKR WAN 1300 frequency selection" src="image/B19752_06_13.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.592.1">Figure 6.13 – The MKR WAN 1300 frequency selection</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.593.1">As we discussed earlier, LoRaWAN operates on different frequencies according to region. </span><span class="koboSpan" id="kobo.593.2">So, from the dropdown, select the specific frequency according to your region. </span><span class="koboSpan" id="kobo.593.3">I selected </span><strong class="bold"><span class="koboSpan" id="kobo.594.1">Europe 863-870 MHZ (SF9 for RX2 - recommended)</span></strong><span class="koboSpan" id="kobo.595.1"> according to my LoRaWAN gateway. </span><span class="koboSpan" id="kobo.595.2">After selecting the frequency from the dropdown, click on the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.596.1">NEXT</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.597.1"> button.</span></span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.598.1">Now, we need to provide </span><a id="_idIndexMarker534"/><span class="koboSpan" id="kobo.599.1">a name for the device, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.600.1">Figure 6</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.601.1">.14</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.602.1">.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer099">
<span class="koboSpan" id="kobo.603.1"><img alt="Figure 6.14 – Assigning a name to the MKR WAN 1300" src="image/B19752_06_14.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.604.1">Figure 6.14 – Assigning a name to the MKR WAN 1300</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.605.1">Here, I assigned the name </span><strong class="source-inline"><span class="koboSpan" id="kobo.606.1">LoRaWanGPSTracker</span></strong><span class="koboSpan" id="kobo.607.1"> to the device, but you can use any name related to your project structure. </span><span class="koboSpan" id="kobo.607.2">After assigning the name, click on the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.608.1">NEXT</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.609.1"> button.</span></span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.610.1">Then, another popup</span><a id="_idIndexMarker535"/><span class="koboSpan" id="kobo.611.1"> will appear, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.612.1">Figure 6</span></em></span><em class="italic"><span class="koboSpan" id="kobo.613.1">.15</span></em><span class="koboSpan" id="kobo.614.1">, which will prepare your device for the Arduino </span><span class="No-Break"><span class="koboSpan" id="kobo.615.1">IoT Cloud.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer100">
<span class="koboSpan" id="kobo.616.1"><img alt="Figure 6.15 – MKR WAN 1300 configuration" src="image/B19752_06_15.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.617.1">Figure 6.15 – MKR WAN 1300 configuration</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.618.1">Here, the Arduino IoT Cloud configures the MKR WAN 1300 via </span><strong class="bold"><span class="koboSpan" id="kobo.619.1">Arduino Create Agent</span></strong><span class="koboSpan" id="kobo.620.1">. </span><span class="koboSpan" id="kobo.620.2">It will take one to two minutes to set up the development board with the </span><span class="No-Break"><span class="koboSpan" id="kobo.621.1">necessary configuration.</span></span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.622.1">When the device has been configured </span><a id="_idIndexMarker536"/><span class="koboSpan" id="kobo.623.1">successfully, you will see the following popup. </span><span class="koboSpan" id="kobo.623.2">Just click on the </span><strong class="bold"><span class="koboSpan" id="kobo.624.1">DONE</span></strong><span class="koboSpan" id="kobo.625.1"> button and your device will be associated with </span><span class="No-Break"><span class="koboSpan" id="kobo.626.1">your Thing.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer101">
<span class="koboSpan" id="kobo.627.1"><img alt="Figure 6.16 – A successful device setup" src="image/B19752_06_16.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.628.1">Figure 6.16 – A successful device setup</span></p>
<p><span class="koboSpan" id="kobo.629.1">In this section, we have associated</span><a id="_idIndexMarker537"/><span class="koboSpan" id="kobo.630.1"> the MKR WAN 1300 with our Thing. </span><span class="koboSpan" id="kobo.630.2">We have also seen a lot of new options regarding LoRaWAN such as frequency, gateway, and so on. </span><span class="koboSpan" id="kobo.630.3">In the upcoming sections, we will discuss the network </span><span class="No-Break"><span class="koboSpan" id="kobo.631.1">and code.</span></span></p>
<h2 id="_idParaDest-134"><a id="_idTextAnchor134"/><span class="koboSpan" id="kobo.632.1">Network</span></h2>
<p><span class="koboSpan" id="kobo.633.1">In previous chapters, after</span><a id="_idIndexMarker538"/><span class="koboSpan" id="kobo.634.1"> associating the device with the Thing, we configured the network settings for device communication. </span><span class="koboSpan" id="kobo.634.2">However, this time, we don’t need to configure any network settings, as the device will be configured automatically when we upload the sketch to the MKR WAN 1300 development board. </span><span class="koboSpan" id="kobo.634.3">At first, you will see an empty area in the </span><strong class="bold"><span class="koboSpan" id="kobo.635.1">Network</span></strong><span class="koboSpan" id="kobo.636.1"> configuration, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.637.1">Figure 6</span></em></span><em class="italic"><span class="koboSpan" id="kobo.638.1">.8</span></em><span class="koboSpan" id="kobo.639.1">, but after the sketch uploads, you will see the LoRaWAN network </span><span class="No-Break"><span class="koboSpan" id="kobo.640.1">configuration parameters.</span></span></p>
<h2 id="_idParaDest-135"><a id="_idTextAnchor135"/><span class="koboSpan" id="kobo.641.1">Coding</span></h2>
<p><span class="koboSpan" id="kobo.642.1">The code for this</span><a id="_idIndexMarker539"/><span class="koboSpan" id="kobo.643.1"> chapter is available in the book’s official GitHub repository. </span><span class="koboSpan" id="kobo.643.2">Download the </span><strong class="source-inline"><span class="koboSpan" id="kobo.644.1">A_remote_asset_tracking_using_LoRaWAN_aug30a.zip</span></strong><span class="koboSpan" id="kobo.645.1"> file and import it into your Arduino </span><span class="No-Break"><span class="koboSpan" id="kobo.646.1">Web Editor.</span></span></p>
<p><span class="koboSpan" id="kobo.647.1">You can download the code and put it into your Thing by navigating to the </span><strong class="bold"><span class="koboSpan" id="kobo.648.1">Sketch</span></strong><span class="koboSpan" id="kobo.649.1"> tab. </span><span class="koboSpan" id="kobo.649.2">Here, I will explain the main workflow in which we are initializing all the variables and serial instances in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.650.1">setup()</span></strong><span class="koboSpan" id="kobo.651.1"> method. </span><span class="koboSpan" id="kobo.651.2">Remember to never try to use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.652.1">delay()</span></strong><span class="koboSpan" id="kobo.653.1"> method, as it will block the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.654.1">ArduinoCloud.update()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.655.1"> method:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.656.1">
TinyGPSPlus gps;
unsigned long previousMillis = 0;
const long interval = 30000; //milliseconds</span></pre> <p><span class="koboSpan" id="kobo.657.1">In the preceding code snippet, we declare the </span><strong class="source-inline"><span class="koboSpan" id="kobo.658.1">gps</span></strong><span class="koboSpan" id="kobo.659.1"> instance and two variables, which wait for </span><strong class="source-inline"><span class="koboSpan" id="kobo.660.1">30000</span></strong><span class="koboSpan" id="kobo.661.1"> milliseconds (30 seconds) before the next readings are taken without blocking </span><span class="No-Break"><span class="koboSpan" id="kobo.662.1">the code.</span></span></p>
<p><span class="koboSpan" id="kobo.663.1">Now, we will explore the </span><strong class="source-inline"><span class="koboSpan" id="kobo.664.1">loop()</span></strong><span class="koboSpan" id="kobo.665.1"> method. </span><span class="koboSpan" id="kobo.665.2">Here, we call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.666.1">FetchGPS()</span></strong><span class="koboSpan" id="kobo.667.1"> method every 30 minutes, which will be carried out by comparing </span><strong class="source-inline"><span class="koboSpan" id="kobo.668.1">currentMillis</span></strong><span class="koboSpan" id="kobo.669.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.670.1">previousMillis</span></strong><span class="koboSpan" id="kobo.671.1"> without the use </span><span class="No-Break"><span class="koboSpan" id="kobo.672.1">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.673.1">delay()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.674.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.675.1">
  unsigned long currentMillis = millis();
  if (currentMillis - previousMillis &gt;= interval) {
    //speed=currentMillis;
    FetchGPS();
    previousMillis = currentMillis;
  }</span></pre> <p><span class="koboSpan" id="kobo.676.1">In the following snippet, I have just picked a small part of the code from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.677.1">FetchGPS()</span></strong><span class="koboSpan" id="kobo.678.1"> method. </span><span class="koboSpan" id="kobo.678.2">Here, I assign the latest values from the GPS module to the Arduino cloud variables, which will be used to send data to the cloud as well as print it on the </span><span class="No-Break"><span class="koboSpan" id="kobo.679.1">Serial Monitor:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.680.1">
if (gps.location.isUpdated())
  {
    altitudeFeet = gps.altitude.feet();
    satelliteCount = gps.satellites.value();
    speed = gps.speed.mph();
    location = Location(gps.location.lat(), gps.location.lng());
    Location cordinates = location.getValue();
 .
 </span><span class="koboSpan" id="kobo.680.2">.
 </span><span class="koboSpan" id="kobo.680.3">.
</span><span class="koboSpan" id="kobo.680.4">}</span></pre> <p><span class="koboSpan" id="kobo.681.1">Upload the code to the device, and open up the Arduino Web Editor Serial Monitor to verify the values. </span><span class="koboSpan" id="kobo.681.2">After successfully uploading the data to the cloud, it’s time to set up a beautiful dashboard for web</span><a id="_idIndexMarker540"/><span class="koboSpan" id="kobo.682.1"> and mobile for </span><span class="No-Break"><span class="koboSpan" id="kobo.683.1">end users.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.684.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.685.1">If you used different </span><em class="italic"><span class="koboSpan" id="kobo.686.1">naming</span></em><span class="koboSpan" id="kobo.687.1"> when declaring the variables, update the code according to your naming scheme. </span><span class="koboSpan" id="kobo.687.2">However, it’s recommended to first follow all the steps in the book and change the cloud variable names later, modifying your </span><span class="No-Break"><span class="koboSpan" id="kobo.688.1">code respectively.</span></span></p>
<p class="callout"><span class="koboSpan" id="kobo.689.1">Never try to use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.690.1">delay()</span></strong><span class="koboSpan" id="kobo.691.1"> method, which will create a block for the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.692.1">ArduinoCloud.update()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.693.1"> method.</span></span></p>
<p class="callout"><span class="koboSpan" id="kobo.694.1">The Arduino IoT Cloud only updates values on its dashboard whenever the variable value changes. </span><span class="koboSpan" id="kobo.694.2">For example, if the GPS location is the same after some time, then it means an asset has not moved from its original location. </span><span class="koboSpan" id="kobo.694.3">Then, the Arduino IoT Cloud will not record the value, so don’t get confused if values don’t change on the map. </span><span class="koboSpan" id="kobo.694.4">Another benefit of this feature is you will not get duplicate data when you export </span><span class="No-Break"><span class="koboSpan" id="kobo.695.1">the content.</span></span></p>
<p class="callout"><span class="koboSpan" id="kobo.696.1">The same code will work with the MKR WAN 1310 without any modification. </span><span class="koboSpan" id="kobo.696.2">However, in this instance, you need to associate the MKR WAN 1310 device with the Thing instead of the MKR </span><span class="No-Break"><span class="koboSpan" id="kobo.697.1">WAN 1300.</span></span></p>
<p><span class="koboSpan" id="kobo.698.1">In this section, we have explored our code step by step to understand how it works. </span><span class="koboSpan" id="kobo.698.2">In the next section, we will set up the The Things Indoor Gateway. </span><span class="koboSpan" id="kobo.698.3">If you already have the gateway in your region/area, then you can skip this, but if you don’t have any gateway near your location, then you need to set up the gateway; otherwise, your MKR WAN 1300 will not be able</span><a id="_idIndexMarker541"/><span class="koboSpan" id="kobo.699.1"> to communicate with the Arduino </span><span class="No-Break"><span class="koboSpan" id="kobo.700.1">IoT Cloud.</span></span></p>
<h1 id="_idParaDest-136"><a id="_idTextAnchor136"/><span class="koboSpan" id="kobo.701.1">Configuring the The Things Indoor Gateway</span></h1>
<p><span class="koboSpan" id="kobo.702.1">In this section, we will </span><a id="_idIndexMarker542"/><span class="koboSpan" id="kobo.703.1">set up the The Things Indoor Gateway. </span><span class="koboSpan" id="kobo.703.2">It is available in different frequencies but I have a gateway with the EU868 MHz frequency. </span><span class="koboSpan" id="kobo.703.3">If you already have the LoRaWAN gateway in your area and want to skip this section, you’re good to go, but if you don’t have the gateway in your area, then this section is mandatory for MKR WAN 1300 communication. </span><span class="koboSpan" id="kobo.703.4">Without the gateway, your module will not communicate with the Arduino IoT Cloud. </span><span class="koboSpan" id="kobo.703.5">To set up the gateway, please follow </span><span class="No-Break"><span class="koboSpan" id="kobo.704.1">these steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.705.1">Open your gateway box, set it up with a power cable, and turn on the gateway. </span><span class="koboSpan" id="kobo.705.2">If you are using a brand-new gateway, then it will be in setup mode; otherwise, you can put the gateway into setup mode by pressing the </span><strong class="bold"><span class="koboSpan" id="kobo.706.1">SETUP</span></strong><span class="koboSpan" id="kobo.707.1"> button for a few seconds when the orange and green lights start blinking. </span><span class="koboSpan" id="kobo.707.2">This means the gateway has entered </span><span class="No-Break"><span class="koboSpan" id="kobo.708.1">setup mode.</span></span></li>
<li><span class="koboSpan" id="kobo.709.1">Select the Wi-Fi network of your the The Things Indoor Gateway, and connect to it. </span><span class="koboSpan" id="kobo.709.2">The Wi-Fi password is written on the back of the device. </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.710.1">Figure 6</span></em></span><em class="italic"><span class="koboSpan" id="kobo.711.1">.17</span></em><span class="koboSpan" id="kobo.712.1"> shows the </span><strong class="bold"><span class="koboSpan" id="kobo.713.1">Setup</span></strong><span class="koboSpan" id="kobo.714.1"> page for the The Things</span><a id="_idIndexMarker543"/> <span class="No-Break"><span class="koboSpan" id="kobo.715.1">Indoor Gateway.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer102">
<span class="koboSpan" id="kobo.716.1"><img alt="Figure 6.17 – The Things Indoor Gateway setup page" src="image/B19752_06_17.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.717.1">Figure 6.17 – The Things Indoor Gateway setup page</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.718.1">After connecting to the indoor gateway, open up your browser and type </span><strong class="source-inline"><span class="koboSpan" id="kobo.719.1">http://192.168.4.1</span></strong><span class="koboSpan" id="kobo.720.1">. </span><span class="koboSpan" id="kobo.720.2">This will open up the </span><strong class="bold"><span class="koboSpan" id="kobo.721.1">MiniHub Setup</span></strong><span class="koboSpan" id="kobo.722.1"> page, as shown in the preceding figure. </span><span class="koboSpan" id="kobo.722.2">Click on the plus icon (</span><strong class="bold"><span class="koboSpan" id="kobo.723.1">+</span></strong><span class="koboSpan" id="kobo.724.1">) to select the Wi-Fi network that is connected to the internet, and provide its Wi-Fi password. </span><span class="koboSpan" id="kobo.724.2">Then, click on the </span><strong class="bold"><span class="koboSpan" id="kobo.725.1">SAVE &amp; REBOOT</span></strong><span class="koboSpan" id="kobo.726.1"> button. </span><span class="koboSpan" id="kobo.726.2">It will take some seconds to restart, and eventually, your LoRaWAN indoor gateway will be connected to the internet via your selected </span><span class="No-Break"><span class="koboSpan" id="kobo.727.1">Wi-Fi network.</span></span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.728.1">Now, it’s time</span><a id="_idIndexMarker544"/><span class="koboSpan" id="kobo.729.1"> to configure the LoRaWAN gateway in the </span><strong class="bold"><span class="koboSpan" id="kobo.730.1">The Things Stack</span></strong><span class="koboSpan" id="kobo.731.1"> portal, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.732.1">Figure 6</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.733.1">.18</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.734.1">.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer103">
<span class="koboSpan" id="kobo.735.1"><img alt="Figure 6.18 – LoRaWAN gateway registration – step 1" src="image/B19752_06_18.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.736.1">Figure 6.18 – LoRaWAN gateway registration – step 1</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.737.1">When you associate the MKR WAN 1300 to the Thing in the Arduino IoT Cloud, you will receive an email from the The Things Stack Cloud that contains the portal URL, along with your username and password details. </span><span class="koboSpan" id="kobo.737.2">Log in to the portal, where you will be given a clusters list to add your gateway to a recommended cluster. </span><span class="koboSpan" id="kobo.737.3">In the </span><em class="italic"><span class="koboSpan" id="kobo.738.1">Associating a device</span></em><span class="koboSpan" id="kobo.739.1"> section, I chose the </span><strong class="bold"><span class="koboSpan" id="kobo.740.1">Europe 863-870 MHZ (SF9 for RX2 - recommended)</span></strong><span class="koboSpan" id="kobo.741.1"> frequency for the MKR WAN 1300, so here, I will choose </span><strong class="bold"><span class="koboSpan" id="kobo.742.1">Europe 1</span></strong><span class="koboSpan" id="kobo.743.1"> for my gateway. </span><span class="koboSpan" id="kobo.743.2">This way, my gateway and MKR WAN 1300 development board both sit under the </span><span class="No-Break"><span class="koboSpan" id="kobo.744.1">same cluster.</span></span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.745.1">After choosing the cluster, you will be redirected to the main page of the portal. </span><span class="koboSpan" id="kobo.745.2">From here, we will start adding the gateway, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.746.1">Figure 6</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.747.1">.19</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.748.1">.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer104">
<span class="koboSpan" id="kobo.749.1"><img alt="Figure 6.19 – LoRaWAN gateway registration – step 2" src="image/B19752_06_19.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.750.1">Figure 6.19 – LoRaWAN gateway registration – step 2</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.751.1">On the main page, we have some menus and two big icons, as shown in the preceding figure. </span><span class="koboSpan" id="kobo.751.2">From there, click on the </span><strong class="bold"><span class="koboSpan" id="kobo.752.1">Go to </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.753.1">gateways</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.754.1"> icon.</span></span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.755.1">Then, we will be</span><a id="_idIndexMarker545"/><span class="koboSpan" id="kobo.756.1"> on the page that shows the complete list of gateways, as well as the option to register a new gateway, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.757.1">Figure 6</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.758.1">.20</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.759.1">.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer105">
<span class="koboSpan" id="kobo.760.1"><img alt="Figure 6.20 – LoRaWAN gateway registration – step 3" src="image/B19752_06_20.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.761.1">Figure 6.20 – LoRaWAN gateway registration – step 3</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.762.1">Click on the blue </span><strong class="bold"><span class="koboSpan" id="kobo.763.1">+ Register </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.764.1">gateway</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.765.1"> button.</span></span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.766.1">This will take us</span><a id="_idIndexMarker546"/><span class="koboSpan" id="kobo.767.1"> to a new page where we can add a gateway to the the The Things Stack network, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.768.1">Figure 6</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.769.1">.21</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.770.1">.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer106">
<span class="koboSpan" id="kobo.771.1"><img alt="Figure 6.21 – LoRaWAN gateway registration – step 4" src="image/B19752_06_21.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.772.1">Figure 6.21 – LoRaWAN gateway registration – step 4</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.773.1">Firstly, we need to select the owner from the </span><strong class="bold"><span class="koboSpan" id="kobo.774.1">Owner</span></strong><span class="koboSpan" id="kobo.775.1"> dropdown. </span><span class="koboSpan" id="kobo.775.2">Here, you will see two names. </span><span class="koboSpan" id="kobo.775.3">One is your personal username, and the other is </span><strong class="bold"><span class="koboSpan" id="kobo.776.1">arduino-iot-cloud-user</span></strong><span class="koboSpan" id="kobo.777.1">. </span><span class="koboSpan" id="kobo.777.2">Just select your personal username, as you are the main person adding the gateway. </span><span class="koboSpan" id="kobo.777.3">In the next field, insert the </span><strong class="bold"><span class="koboSpan" id="kobo.778.1">Gateway EUI</span></strong><span class="koboSpan" id="kobo.779.1"> details. </span><span class="koboSpan" id="kobo.779.2">The EUI will be written on the back of the gateway. </span><span class="koboSpan" id="kobo.779.3">After that, click on the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.780.1">Confirm</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.781.1"> button.</span></span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.782.1">Now, we will verify our gateway and select the frequency plan, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.783.1">Figure 6</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.784.1">.22</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.785.1">.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer107">
<span class="koboSpan" id="kobo.786.1"><img alt="Figure 6.22 – LoRaWAN gateway registration – step 5" src="image/B19752_06_22.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.787.1">Figure 6.22 – LoRaWAN gateway registration – step 5</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.788.1">You will see the </span><strong class="bold"><span class="koboSpan" id="kobo.789.1">Claim authentication code</span></strong><span class="koboSpan" id="kobo.790.1"> field at the top. </span><span class="koboSpan" id="kobo.790.2">Here, we need to provide the gateway with a Wi-Fi password for authentication. </span><span class="koboSpan" id="kobo.790.3">You can get the gateway Wi-Fi password</span><a id="_idIndexMarker547"/><span class="koboSpan" id="kobo.791.1"> from the back of the gateway, from where you previously took it to connect with the device’s </span><span class="No-Break"><span class="koboSpan" id="kobo.792.1">Wi-Fi network.</span></span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.793.1">Now, we need to select the frequency plan for our gateway. </span><span class="koboSpan" id="kobo.793.2">We already selected </span><strong class="bold"><span class="koboSpan" id="kobo.794.1">Europe 863-870 MHZ (SF9 for RX2 - recommended)</span></strong><span class="koboSpan" id="kobo.795.1"> during the MKR WAN 1300 association, so we will select the same frequency from the dropdown. </span><span class="koboSpan" id="kobo.795.2">After selecting the frequency, click on the </span><strong class="bold"><span class="koboSpan" id="kobo.796.1">Claim </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.797.1">gateway</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.798.1"> button.</span></span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.799.1">After successfully registering the gateway, we will see a page like the one in the following figure, which provides you with the gateway connectivity status, as well as </span><strong class="bold"><span class="koboSpan" id="kobo.800.1">Live data</span></strong><span class="koboSpan" id="kobo.801.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.802.1">Created at</span></strong><span class="koboSpan" id="kobo.803.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.804.1">Last updated at</span></strong><span class="koboSpan" id="kobo.805.1">, and lots of </span><span class="No-Break"><span class="koboSpan" id="kobo.806.1">other information.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer108">
<span class="koboSpan" id="kobo.807.1"><img alt="Figure 6.23 – The LoRaWAN gateway successfully registered on The Things Network" src="image/B19752_06_23.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.808.1">Figure 6.23 – The LoRaWAN gateway successfully registered on The Things Network</span></p>
<p><span class="koboSpan" id="kobo.809.1">In this section, we explored</span><a id="_idIndexMarker548"/><span class="koboSpan" id="kobo.810.1"> how to set up the The Things Indoor Gateway step by step. </span><span class="koboSpan" id="kobo.810.2">In the next section, we will create a dashboard for our Thing on mobile and web to track </span><span class="No-Break"><span class="koboSpan" id="kobo.811.1">our assets.</span></span></p>
<h1 id="_idParaDest-137"><a id="_idTextAnchor137"/><span class="koboSpan" id="kobo.812.1">Creating web and mobile dashboards</span></h1>
<p><span class="koboSpan" id="kobo.813.1">After uploading the code</span><a id="_idIndexMarker549"/><span class="koboSpan" id="kobo.814.1"> to the device, it’s time to set up a dashboard</span><a id="_idIndexMarker550"/><span class="koboSpan" id="kobo.815.1"> for web and mobile to visualize data with different widgets. </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.816.1">Figure 6</span></em></span><em class="italic"><span class="koboSpan" id="kobo.817.1">.24</span></em><span class="koboSpan" id="kobo.818.1"> demonstrates the visualization of readings with </span><span class="No-Break"><span class="koboSpan" id="kobo.819.1">different widgets.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer109">
<span class="koboSpan" id="kobo.820.1"><img alt="Figure 6.24 – The Thing dashboard" src="image/B19752_06_24.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.821.1">Figure 6.24 – The Thing dashboard</span></p>
<p><span class="koboSpan" id="kobo.822.1">We have four readings from the GPS module to visualize. </span><span class="koboSpan" id="kobo.822.2">Here, I have used four widgets: one gauge, two values, and one map. </span><span class="koboSpan" id="kobo.822.3">The gauge widget shows </span><strong class="bold"><span class="koboSpan" id="kobo.823.1">Speed Per Mile</span></strong><span class="koboSpan" id="kobo.824.1">, while the two value widgets have been used to display </span><strong class="bold"><span class="koboSpan" id="kobo.825.1">Altitude Feet</span></strong><span class="koboSpan" id="kobo.826.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.827.1">Satellite Count</span></strong><span class="koboSpan" id="kobo.828.1">. </span><span class="koboSpan" id="kobo.828.2">The map widget was used to display </span><strong class="bold"><span class="koboSpan" id="kobo.829.1">Location</span></strong><span class="koboSpan" id="kobo.830.1"> based on the latitude and longitude coordinates, which are stored in a cloud-based </span><strong class="source-inline"><span class="koboSpan" id="kobo.831.1">location</span></strong><span class="koboSpan" id="kobo.832.1"> variable. </span><span class="koboSpan" id="kobo.832.2">Currently, the map widget is only capable of displaying the location of the asset device based on coordinates; if you have multiple assets to track, then you need to set up multiple map widgets according to the number of </span><span class="No-Break"><span class="koboSpan" id="kobo.833.1">tracking devices.</span></span></p>
<p><span class="koboSpan" id="kobo.834.1">Well, this is the last section</span><a id="_idIndexMarker551"/><span class="koboSpan" id="kobo.835.1"> of our chapter. </span><span class="koboSpan" id="kobo.835.2">Here, we created </span><a id="_idIndexMarker552"/><span class="koboSpan" id="kobo.836.1">a stunning dashboard for GPS tracking that shows </span><strong class="bold"><span class="koboSpan" id="kobo.837.1">Location</span></strong><span class="koboSpan" id="kobo.838.1"> using a map widget on the dashboard, </span><strong class="bold"><span class="koboSpan" id="kobo.839.1">Speed Per Mile</span></strong><span class="koboSpan" id="kobo.840.1">, and some </span><span class="No-Break"><span class="koboSpan" id="kobo.841.1">other parameters.</span></span></p>
<h1 id="_idParaDest-138"><a id="_idTextAnchor138"/><span class="koboSpan" id="kobo.842.1">What next?</span></h1>
<p><span class="koboSpan" id="kobo.843.1">We still have a lot of options available to explore, but now it’s your turn to use different sensors and development boards to do some more experiments and learn from them. </span><span class="koboSpan" id="kobo.843.2">In this chapter, we only used one GPS module, which gave us only four parameters, but there are a lot of GPS modules on the market that provide a wide variety of functionalities, such as working under a roof and </span><span class="No-Break"><span class="koboSpan" id="kobo.844.1">accuracy features.</span></span></p>
<p><span class="koboSpan" id="kobo.845.1">While monitoring the location of assets, some other parameters are very important to monitor in different industries, such as temperature and humidity, which are very important in food and medical products. </span><span class="koboSpan" id="kobo.845.2">CO2 and </span><strong class="bold"><span class="koboSpan" id="kobo.846.1">liquefied petroleum gas</span></strong><span class="koboSpan" id="kobo.847.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.848.1">LPG</span></strong><span class="koboSpan" id="kobo.849.1">) gases are very important to monitor during fuel transportation. </span><span class="koboSpan" id="kobo.849.2">Try using different sensors with a GPS module to set up different tracking prototypes for </span><span class="No-Break"><span class="koboSpan" id="kobo.850.1">different industries.</span></span></p>
<h1 id="_idParaDest-139"><a id="_idTextAnchor139"/><span class="koboSpan" id="kobo.851.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.852.1">In this chapter, we explored how to develop an asset-tracking system using LoRaWAN and a GPS module. </span><span class="koboSpan" id="kobo.852.2">We set up the Thing, which included cloud variable creation, device association, the The Things Indoor Gateway, and coding a development board. </span><span class="koboSpan" id="kobo.852.3">Then, we created a dashboard to visualize the Thing readings with different types of widgets to display current readings. </span><span class="koboSpan" id="kobo.852.4">The most important widget of the chapter is the map widget, which is very interesting and important for plotting the current location of </span><span class="No-Break"><span class="koboSpan" id="kobo.853.1">the device.</span></span></p>
<p><span class="koboSpan" id="kobo.854.1">GPS tracking is a very important topic that helps us to develop a device for our assets, assisting us in asset tracking and monitoring. </span><span class="koboSpan" id="kobo.854.2">We can use LoRaWAN for a specific region, as it has a longer range, but that range only operates in a specific area, unlike other wireless technologies. </span><span class="koboSpan" id="kobo.854.3">This chapter demonstrated how we can display the location of a device on a dashboard, giving you more confidence to build more </span><span class="No-Break"><span class="koboSpan" id="kobo.855.1">asset-tracking solutions.</span></span></p>
<p><span class="koboSpan" id="kobo.856.1">In the next chapter, </span><em class="italic"><span class="koboSpan" id="kobo.857.1">Enabling Communication between Different Devices</span></em><span class="koboSpan" id="kobo.858.1">, we will explore how the Arduino IoT Cloud makes it easy to send data between devices. </span><span class="koboSpan" id="kobo.858.2">Using this method, we will sync IoT nodes with each other for </span><span class="No-Break"><span class="koboSpan" id="kobo.859.1">seamless operations.</span></span></p>
</div>


<div class="Content" id="_idContainer111">
<h1 id="_idParaDest-140" lang="en-US" xml:lang="en-US"><a id="_idTextAnchor140"/><span class="koboSpan" id="kobo.1.1">Part 3: Exchanging Data between Nodes and Cloud Applications</span></h1>
<p><span class="koboSpan" id="kobo.2.1">This third part of the book describes how to exchange data between IoT nodes provisioned on the Arduino IoT Cloud and between the Arduino IoT Cloud and external </span><span class="No-Break"><span class="koboSpan" id="kobo.3.1">cloud applications.</span></span></p>
<p><span class="koboSpan" id="kobo.4.1">These functionalities are required in many real cases to build a distributed and reliable network, to implement some interdependent visualization and logic on the IoT application, and to expand the functionalities of the Arduino IoT Cloud with </span><span class="No-Break"><span class="koboSpan" id="kobo.5.1">external tools.</span></span></p>
<p><span class="koboSpan" id="kobo.6.1">This part has the </span><span class="No-Break"><span class="koboSpan" id="kobo.7.1">following chapters:</span></span></p>
<ul>
<li><a href="B19752_07.xhtml#_idTextAnchor141"><em class="italic"><span class="koboSpan" id="kobo.8.1">Chapter 7</span></em></a><span class="koboSpan" id="kobo.9.1">, </span><em class="italic"><span class="koboSpan" id="kobo.10.1">Enabling Communication between Different Devices</span></em></li>
<li><a href="B19752_08.xhtml#_idTextAnchor158"><em class="italic"><span class="koboSpan" id="kobo.11.1">Chapter 8</span></em></a><span class="koboSpan" id="kobo.12.1">, </span><em class="italic"><span class="koboSpan" id="kobo.13.1">Working with the Arduino IoT Cloud SDK and JavaScript</span></em></li>
<li><a href="B19752_09.xhtml#_idTextAnchor195"><em class="italic"><span class="koboSpan" id="kobo.14.1">Chapter 9</span></em></a><span class="koboSpan" id="kobo.15.1">, </span><em class="italic"><span class="koboSpan" id="kobo.16.1">Project #4 – Collecting Data from the Soil and Environment for Smart Farming</span></em></li>
<li><a href="B19752_10.xhtml#_idTextAnchor211"><em class="italic"><span class="koboSpan" id="kobo.17.1">Chapter 10</span></em></a><span class="koboSpan" id="kobo.18.1">, </span><em class="italic"><span class="koboSpan" id="kobo.19.1">Project #5 – Making Your Homes Smarter with a Voice Assistant</span></em></li>
</ul>
</div>
<div>
<div id="_idContainer112">
</div>
</div>
<div>
<div class="Basic-Graphics-Frame" id="_idContainer113">
</div>
</div>
</body></html>