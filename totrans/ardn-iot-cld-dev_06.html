<html><head></head><body>
<div><p> </p>
<h1 class="chapter-number" id="_idParaDest-120"><a id="_idTextAnchor120"/>6</h1>
<h1 id="_idParaDest-121"><a id="_idTextAnchor121"/>Project #3 – a Remote Asset Tracking Application with LoRaWAN</h1>
<p>This chapter is dedicated to <strong class="bold">smart transportation</strong> and <strong class="bold">smart remote monitoring</strong> using low-power and<a id="_idIndexMarker481"/> long-range communication<a id="_idIndexMarker482"/> technology. The project in this chapter will take you through the implementation<a id="_idIndexMarker483"/> and deployment of a remote alarming application based on <strong class="bold">Long Range Wide Area Network</strong> (<strong class="bold">LoRaWAN</strong>), connected to the public, global, and decentralized The Things Network. The project in this chapter provides localization features by using a GPS module. The <strong class="bold">Arduino IoT Cloud</strong> will be used for data visualization and remote configuration of the device. The application will be used in real use cases, showing the benefits offered by LoRaWAN technologies compared to other wireless technologies.</p>
<p>Here, we will practically explore LoRaWAN <a id="_idIndexMarker484"/>technologies, which are very useful<a id="_idIndexMarker485"/> in remote monitoring and control, whether it’s <strong class="bold">asset tracking</strong> or <strong class="bold">remote operation monitoring</strong>. This project uses the <strong class="bold">Arduino MKR WAN 1300</strong> development board, which is equipped with the latest <a id="_idIndexMarker486"/>communication frequencies, 433/868/915 MHz US/EU. It is specially designed for <strong class="bold">Internet of Things</strong> (<strong class="bold">IoT</strong>) and <strong class="bold">Industry 4.0</strong> use cases. This project explains<a id="_idIndexMarker487"/> how you can practically develop<a id="_idIndexMarker488"/> a tracking solution based on LoRaWAN communication for different use cases.</p>
<p>In this chapter, we will cover the following main topics:</p>
<ul>
<li>Understanding LoRaWAN and its IoT applications</li>
<li>LoRaWAN versus other communication technologies</li>
<li>Components of a LoRaWAN IoT application</li>
<li>Essential hardware – sensors and development boards</li>
<li>Designing the project architecture</li>
<li>Setting up the Thing, adding devices, cloud variables, and code</li>
<li>Configuring the The Things Indoor Gateway</li>
<li>Creating web and mobile dashboards</li>
</ul>
<h1 id="_idParaDest-122"><a id="_idTextAnchor122"/>Technical requirements</h1>
<p>The following hardware components are required to complete the exercise in this chapter:</p>
<ul>
<li>MKR WAN 1300 or MKR WAN 1310</li>
<li>The Things Indoor Gateway</li>
<li>The NEO-6M u-blox GPS module</li>
<li>A breadboard</li>
<li>Jumper cables</li>
</ul>
<p>To code, we will use the <strong class="bold">Arduino Web Editor</strong>, which includes a large collection of development boards and sensor libraries, and the Arduino IoT Cloud for the Thing and dashboard setup. To develop hardware and sensor designs, we need the <strong class="bold">Fritzing</strong> desktop software, and we need the <strong class="bold">Arduino IDE</strong> for GPS module testing.</p>
<p>In this chapter, we will use the <strong class="bold">The Things Indoor Gateway </strong>for LoRaWAN communication. The code used in the chapter is available in the book’s official GitHub repository by following this link: <a href="https://github.com/PacktPublishing/Arduino-IoT-Cloud-for-Developers">https://github.com/PacktPublishing/Arduino-IoT-Cloud-for-Developers</a>.</p>
<h1 id="_idParaDest-123"><a id="_idTextAnchor123"/>Understanding LoRaWAN and its IoT applications</h1>
<p>LoRaWAN is a wireless<a id="_idIndexMarker489"/> communication protocol<a id="_idIndexMarker490"/> and network architecture specifically designed for <strong class="bold">Low-Power Wide Area Networks</strong> (<strong class="bold">LPWANs</strong>), enabling long-range communication between devices in the context of the IoT. LoRaWAN technology is optimized for applications that require low data rates, long battery life, and long communication ranges, making it well-suited<a id="_idIndexMarker491"/> for various IoT use cases.</p>
<h2 id="_idParaDest-124"><a id="_idTextAnchor124"/>Usage in IoT</h2>
<p>LoRaWAN has been widely <a id="_idIndexMarker492"/>adopted in various IoT applications due<a id="_idIndexMarker493"/> to its unique features. Some common use cases include the following:</p>
<ul>
<li><strong class="bold">Smart agriculture</strong>: LoRaWAN can be used for soil moisture monitoring, crop health monitoring, livestock tracking, and precision farming, allowing farmers to optimize their operations and increase yield</li>
<li><strong class="bold">Smart cities</strong>: LoRaWAN can enable smart street lighting, waste management, parking management, and environmental monitoring, helping cities become more efficient and sustainable</li>
<li><strong class="bold">Industrial monitoring</strong>: LoRaWAN can monitor equipment health, track assets, and improve supply chain management in industrial settings, leading to better maintenance practices and reduced downtime</li>
<li><strong class="bold">Utilities</strong>: LoRaWAN can be used for smart meters and to remotely monitor utility infrastructure, such as water and gas meters, improving billing accuracy and resource management</li>
<li><strong class="bold">Environmental monitoring</strong>: LoRaWAN can support applications such as air quality monitoring, water quality monitoring, and wildlife tracking, helping researchers and organizations gather valuable environmental data</li>
<li><strong class="bold">Asset tracking</strong>: LoRaWAN enables real-time tracking of assets, such as shipping containers, vehicles, and valuable equipment, ensuring their security and efficient utilization</li>
</ul>
<p>Overall, LoRaWAN’s combination of long communication ranges, low power consumption, and scalability makes it a powerful technology to build IoT networks that cover large areas and connect a wide range of devices for various applications.</p>
<p>In this section, we have discussed the different use cases of LoRaWAN in the field of IoT, and in the next section, we will discuss why to choose LoRaWAN over other communication technologies.</p>
<h1 id="_idParaDest-125"><a id="_idTextAnchor125"/>LoRaWAN versus other communication technologies</h1>
<p>LoRaWAN offers several advantages over other communication technologies, making it a preferred choice for certain IoT applications. Here are some reasons why LoRaWAN might be chosen over other alternatives:</p>
<ul>
<li><strong class="bold">Long range</strong>: LoRaWAN provides<a id="_idIndexMarker494"/> exceptional long-range communication capabilities, enabling devices to communicate over several kilometers in open areas. This is particularly useful for applications that require connectivity over large distances, such as agriculture, environmental monitoring, and asset tracking.</li>
<li><strong class="bold">Low power consumption</strong>: Devices using LoRaWAN can operate on very low power, extending battery life for years. This is crucial for remote or hard-to-reach locations where changing or recharging batteries is impractical or costly.</li>
<li><strong class="bold">Deep indoor penetration</strong>: LoRaWAN can penetrate buildings and other obstacles effectively, ensuring connectivity even in challenging environments. This makes it suitable for applications such as smart building management and indoor asset tracking.</li>
<li><strong class="bold">Cost-effective</strong>: Implementing and maintaining a LoRaWAN network is often more cost-effective than deploying traditional cellular networks. This makes LoRaWAN a viable option for businesses and organizations looking to deploy IoT solutions on a larger scale.</li>
<li><strong class="bold">Scalability</strong>: LoRaWAN networks can handle a massive number of devices within a single network. This scalability is essential for IoT applications that involve a high density of devices, such as smart city deployments.</li>
<li><strong class="bold">Low data rate applications</strong>: LoRaWAN is optimized for applications that transmit small amounts of data at low data rates. For IoT use cases involving sensor data, meter readings, and periodic updates, LoRaWAN provides a suitable and efficient communication solution.</li>
<li><strong class="bold">Network flexibility</strong>: LoRaWAN supports both public and private network deployments. Organizations can choose to set up their own private LoRaWAN network or use existing public networks, giving them flexibility in terms of ownership and control.</li>
<li><strong class="bold">Adaptive data rate</strong>: LoRaWAN devices can adjust their data rate based on signal strength and interference, optimizing communication for the current conditions. This adaptive feature enhances reliability and ensures the efficient use of available resources.</li>
<li><strong class="bold">Global standard</strong>: LoRaWAN is a global standard, and devices designed to work with it can operate seamlessly across different regions and countries. This standardization simplifies device development and deployment for international projects.</li>
<li><strong class="bold">Diverse applications</strong>: LoRaWAN’s versatility enables its use in various application domains, from agriculture and industrial monitoring to smart cities and environmental sensing.</li>
</ul>
<p>While LoRaWAN offers these<a id="_idIndexMarker495"/> advantages, it’s important to note that no single communication technology is universally superior. The choice between LoRaWAN and other technologies (such as cellular, Wi-Fi, Bluetooth, or Zigbee) depends on the specific requirements of the IoT application, including factors such as range, power consumption, data rate, cost, and scalability. Each technology has its strengths and weaknesses, and the selection should be based on a careful analysis of a project’s needs.</p>
<p>In this section, we have discussed the benefits of using LoRaWAN. In the next section, we will explore the important components of LoRaWAN.</p>
<h1 id="_idParaDest-126"><a id="_idTextAnchor126"/>Components of a LoRaWAN IoT application</h1>
<p>LoRaWAN is a wireless communication<a id="_idIndexMarker496"/> protocol and network architecture designed to enable long-range, low-power communication between IoT devices. It’s specifically tailored to connect devices that require extended battery life, reliable long-distance communication, and efficient use of the wireless spectrum. LoRaWAN is one of the key technologies in the realm of LPWANs. <em class="italic">Figure 6</em><em class="italic">.1</em> illustrates the whole architecture of the LoRaWAN solution, including the end nodes, gateway, network server, and application server.</p>
<div><div><img alt="Figure 6.1 – The components of a LoRaWAN network" src="img/B19752_06_01.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.1 – The components of a LoRaWAN network</p>
<p>The LoRaWAN architecture consists of four main components:</p>
<ul>
<li><strong class="bold">End nodes/devices</strong>: These are the IoT devices that gather data from sensors or perform specific tasks. They communicate with gateways using the LoRa modulation technique, sending data packets at low data rates.</li>
<li><strong class="bold">Gateways</strong>: Gateways serve as intermediate points that receive data packets from end devices and transmit them to a centralized network server. They are typically connected to the internet via wired or wireless connections.</li>
<li><strong class="bold">Network server</strong>: The network server manages communication between gateways and end devices. It handles functions such as authentication, encryption, and the routing of data packets to their respective application servers.</li>
<li><strong class="bold">Application server</strong>: The application server is responsible for processing data received from the network server and performing specific actions based on the data. It interfaces with an end user’s application or backend system to present data, trigger alerts, perform analytics, or control devices. The application server can be hosted on the cloud or on-premises.</li>
</ul>
<p>In this section, we have<a id="_idIndexMarker497"/> discussed LoRaWAN components in detail, and in the next section, we are going to explore the hardware and sensors that are required to execute the practical exercise of this chapter.</p>
<h1 id="_idParaDest-127"><a id="_idTextAnchor127"/>Essential hardware – sensors and development boards</h1>
<p>The Arduino series has a wide collection<a id="_idIndexMarker498"/> of development<a id="_idIndexMarker499"/> boards that vary in size, pins, and communication technologies. In this chapter, we will use the Arduino MKR WAN 1300 development board, as it’s compact, battery-enabled, and provides support for different frequencies from different regions around the world, including 433/868/915 MHz. <em class="italic">Figure 6</em><em class="italic">.2</em> shows a pinout diagram of the MKR WAN 1300.</p>
<div><div><img alt="Figure 6.2 – Arduino MKR WAN 1300" src="img/B19752_06_02.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.2 – Arduino MKR WAN 1300</p>
<p>The Arduino MKR WAN 1300 provides seven analog pins, which start with <strong class="bold">A</strong> (<strong class="bold">A0</strong>, <strong class="bold">A1</strong>, and so on), and eight digital input/output pins, which start with <strong class="bold">D</strong> (<strong class="bold">D0</strong>, <strong class="bold">D1</strong>, and so on), with built-in battery charging and a <strong class="bold">lithium polymer</strong> (<strong class="bold">LiPo</strong>) battery connector for standby power, which helps developers build prototypes and solutions for remote monitoring/operations<a id="_idIndexMarker500"/> without worrying about power<a id="_idIndexMarker501"/> backups. For further updates and the latest product development news, please visit the official website at <a href="https://store.arduino.cc/products/arduino-mkr-wan-1300-lora-connectivity">https://store.arduino.cc/products/arduino-mkr-wan-1300-lora-connectivity</a>.</p>
<p>Arduino’s latest development board is the MKR WAN 1310, which contains the same processor and module<a id="_idIndexMarker502"/> for LoRa communication as the MKR WAN 1300. However, the MKR WAN 1310 has an updated in-battery charger, 2 MB of <strong class="bold">Serial Peripheral Interface</strong> (<strong class="bold">SPI</strong>) flash, and enhanced power consumption. This board is specially designed for IoT devices and is quickly growing in popularity in different regions. For its complete details and specifications, visit <a href="https://store.arduino.cc/products/arduino-mkr-wan-1310">https://store.arduino.cc/products/arduino-mkr-wan-1310</a>.</p>
<p>In this chapter, we will track the device via GPS coordinates. To get the GPS coordinates, we will use the GY-GPS6MV2 GPS module, which is based on the NEO-6M u-blox chip. The GPS module operates on both a software serial and a hardware serial, but the MKR WAN 1300 provides a built-in hardware serial, so we will use <em class="italic">ins 13</em> and <em class="italic">14</em> to communicate with the GPS module shown in <em class="italic">Figure 6</em><em class="italic">.3</em>.</p>
<p>The GPS module provides <a id="_idIndexMarker503"/>latitude, longitude, satellite count, altitude feet, and speed-per-mile properties. These properties will be displayed on a dashboard<a id="_idIndexMarker504"/> for proper asset tracking. This module was developed in China and is available at affordable prices, but many other organizations are developing GPS modules that are also based on the NEO-6M u-blox chip, such as SparkFun, Seeed Studio, and Adafruit. <em class="italic">Figure 6</em><em class="italic">.3</em> shows a NEO-6M u-blox GPS module and its pinout diagram:</p>
<div><div><img alt="Figure 6.3 – The GY-GPS6MV2 NEO6MV2 GPS module and a pinout diagram" src="img/B19752_06_03.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.3 – The GY-GPS6MV2 NEO6MV2 GPS module and a pinout diagram</p>
<p>The preceding diagram describes the pinout layout of the GPS module. <em class="italic">Pin #1</em> is the <strong class="bold">GND</strong> pin that connects with the onboard GND pin of the MKR WAN 1300. <em class="italic">Pin #2</em> and <em class="italic">Pin #3</em> are <strong class="bold">TX</strong> and <strong class="bold">RX</strong>, respectively, and will connect to <em class="italic">Pin #13</em> and <em class="italic">Pin #14</em> of the MKR WAN 1300, respectively. <em class="italic">Pin #4</em>, <strong class="bold">VCC</strong>, works with both an onboard VCC and the 5V pins of the MKR WAN 1300. You can solder the male headers with the GPS module or directly solder the cables without any header pins.</p>
<p class="callout-heading">Important note</p>
<p class="callout">The GPS module<a id="_idIndexMarker505"/> works best in an outdoor environment. Make sure there are no rooftops above during testing and deployment to properly receive a signal from satellites.</p>
<p class="callout">If you are using the module in the lab, then there will be a chance that the GPS module will not work properly. Remember that there is a built-in light on the GPS module that starts blinking when you receive signals from satellites.</p>
<p>In this section, we have discussed the development board and GPS<a id="_idIndexMarker506"/> module in detail, including<a id="_idIndexMarker507"/> their pinout diagrams. In the next section, we will start exploring how to connect the GPS module with the MKR WAN 1300.</p>
<h1 id="_idParaDest-128"><a id="_idTextAnchor128"/>Designing the project architecture</h1>
<p>In the preceding sections, we discussed<a id="_idIndexMarker508"/> the module and development board in detail. Now, it’s time to cook the recipe. In hardware development, before getting to work with sensors and development boards, we need to develop the design concepts to get a better understanding of how things will connect. There is a lot of software that is available to design and develop design concepts for an electronics project, but in this case, we will use Fritzing.</p>
<p>In the following two subsections, we will talk about schematics and designing a project, while explaining how to connect pins with a development board and soldering. Then, we will do some tests to fetch GPS coordinates, which is very important before sending data to the Arduino IoT Cloud.</p>
<h2 id="_idParaDest-129"><a id="_idTextAnchor129"/>Schematics design and assembly</h2>
<p>The purpose of your schematic design<a id="_idIndexMarker509"/> is to get a clear understanding<a id="_idIndexMarker510"/> of how sensors will connect with a development board. This helps engineers develop a prototype on a breadboard or Veroboard, as shown in <em class="italic">Figure 6</em><em class="italic">.4</em>. Another major benefit of designing is that Fritzing builds hardware schematics and PCB design in the background according to your design, which can be adjusted according to system requirements. <em class="italic">Figure 6</em><em class="italic">.4</em> shows a schematic diagram of how to connect the MKR WAN 1300 with the NEO-6M u-blox GPS module:</p>
<div><div><img alt="Figure 6.4 – The MKR WAN 1300 and GPS module schematic" src="img/B19752_06_04.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.4 – The MKR WAN 1300 and GPS module schematic</p>
<p>While <em class="italic">Figure 6</em><em class="italic">.4</em> illustrates the design of the MKR WAN 1300 and GPS module, we have created <em class="italic">Table 6.1</em> for easier understanding, which illustrates (in row format) how to connect pins.</p>
<table class="No-Table-Style _idGenTablePara-1" id="table001-3">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="bold">MKR </strong><strong class="bold">WAN 1300</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">NEO-6M u-blox </strong><strong class="bold">GPS module</strong></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>14 (TX)</p>
</td>
<td class="No-Table-Style">
<p>RX</p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>13 (RX)</p>
</td>
<td class="No-Table-Style">
<p>TX</p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>VCC</p>
</td>
<td class="No-Table-Style">
<p>VCC</p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>GND</p>
</td>
<td class="No-Table-Style">
<p>GND</p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 6.1 – MKR WAN 1300 to GPS module pinout</p>
<p>The preceding design provides<a id="_idIndexMarker511"/> a full overview of how you can connect<a id="_idIndexMarker512"/> a module to a development board. According to our design, we have 5V and GND pins going from the development board to the GPS module. The GPS module <strong class="bold">TX</strong> pin is connected to the <strong class="bold">RX</strong> pin (<em class="italic">Pin #13</em>), and the GPS module <strong class="bold">RX</strong> pin is connected to the <strong class="bold">TX</strong> pin (<em class="italic">Pin #14</em>) of the development board. Finally, we built our prototype by using a breadboard, which is shown in <em class="italic">Figure 6</em><em class="italic">.5</em>:</p>
<div><div><img alt="Figure 6.5 – The final prototype MKR WAN 1300 and GPS module" src="img/B19752_06_05.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.5 – The final prototype MKR WAN 1300 and GPS module</p>
<p>After soldering the male headers<a id="_idIndexMarker513"/> to the GPS module, connect the pins<a id="_idIndexMarker514"/> according to the schematic diagram. There is only one sensor, so there is no requirement for the Veroboard. Next, we will test the GPS module using Arduino’s <strong class="bold">Serial Monitor</strong> tool to verify that our GPS module <a id="_idIndexMarker515"/>works properly and gets values from GPS satellites.</p>
<h2 id="_idParaDest-130"><a id="_idTextAnchor130"/>Testing GPS module data</h2>
<p>Before moving toward<a id="_idIndexMarker516"/> the Arduino IoT Cloud, firstly, we need to verify that our GPS module is working. So, in this section, we will test the GPS module by using the Arduino IDE and its Serial Monitor tool to observe the readings from the GPS module. The following steps will guide you on how we will set up the testing environment:</p>
<ol>
<li>For module testing, we need the Serial Monitor tool to verify whether the GPS module works properly or not. Click on the <strong class="bold">Tools</strong> menu and select <strong class="bold">Serial Monitor</strong>. Select the Arduino MKR WAN 1300 board from <strong class="bold">Tools</strong> | <strong class="bold">Board</strong> | <strong class="bold">Arduino SAMD</strong> | <strong class="bold">Arduino MKR WAN 1300</strong> in the Arduino IDE.</li>
<li>Select the port of the MKR WAN 1300.</li>
<li>Next, we need to install the library for the GPS module in the Arduino IDE. Navigate to <code>tinygps</code> into the search bar.</li>
</ol>
<div><div><img alt="Figure 6.6 – The TinyGPSPlus library" src="img/B19752_06_06.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.6 – The TinyGPSPlus library</p>
<ol>
<li value="4">After searching, the Library<a id="_idIndexMarker517"/> Manager brings up a lot of libraries. Select the <strong class="bold">TinyGPSPlus</strong> library and install its latest version. The library comes with a lot of examples, and all of them are based on a software serial. However, Arduino SAMD boards provide a hardware serial. Therefore, I’ve modified the code to use a hardware serial to communicate with the GPS module.</li>
<li>Download the code from the book’s official GitHub repository, and under the <code>chapter#6</code> folder, open the <code>MKR-WAN-1300-NEO-6M-GPS-Module</code> ZIP folder, extract it, and upload the code to the development board:<pre class="source-code">
while(Serial1.available()&gt;0)//While there are characters to come from the GPS
  {
    gps.encode(Serial1.read());//This feeds the serial NMEA data into the library one char at a time
  }
  if(gps.location.isUpdated())//This will pretty much be fired all the time anyway but will at least reduce it to only after a package of NMEA data comes in
  {
    //Get the latest info from the gps object which it derived from the data sent by the GPS unit
    Serial.println("Satellite Count:");
    Serial.println(gps.satellites.value());
    Serial.println("Latitude:");
    Serial.println(gps.location.lat(), 6);
    Serial.println("Longitude:");
    Serial.println(gps.location.lng(), 6);
    Serial.println("Speed MPH:");
    Serial.println(gps.speed.mph());
    Serial.println("Altitude Feet:");
    Serial.println(gps.altitude.feet());
    Serial.println("");
  }</pre></li> </ol>
<p>In the setup, we have<a id="_idIndexMarker518"/> initialized <code>Serial</code> and <code>Serial1</code>. <code>Serial</code> is used to display the content to the Serial Monitor (the magnifier icon in the top right of the Arduino IDE) on screen, while <code>Serial1</code> is the hardware serial that is used to communicate with the GPS module. The preceding code belongs to the <code>loop()</code> method.</p>
<p>First, the GPS module will read data from satellites using the <code>Serial1.read()</code> method and encode it via the <code>gps.encode()</code> method. <code>Serial1</code> only reads one character at a time, so it will take a little bit of time for the updated values. Then, we will verify whether there is any update in <code>Latitude</code> and <code>Longitude</code> coordinates by using the <code>gps.location.isUpdated()</code> method. If there is a change, then the data will be printed on the Serial<a id="_idIndexMarker519"/> Monitor.</p>
<p class="callout-heading">Important note</p>
<p class="callout">Make sure your GPS module is placed in an open environment where you have a clear sky, without any obstruction such as a roof or anything that stops you from receiving proper signals from satellites.</p>
<p class="callout">The GPS module has an onboard built-in LED that starts blinking when it starts receiving data from GPS satellites.</p>
<p class="callout">The same code will work with the MKR WAN 1310 without any modification.</p>
<p><em class="italic">Figure 6</em><em class="italic">.7</em> shows the Serial Monitor with values from the GPS, which includes <code>Latitude</code>, <code>Longitude</code>, and other parameters:</p>
<div><div><img alt="Figure 6.7 – The GPS module data on the Serial Monitor" src="img/B19752_06_07.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.7 – The GPS module data on the Serial Monitor</p>
<p>The preceding figure shows the data that is received by the GPS module from GPS satellites and printed on the Serial Monitor. The data includes the satellite count, the latitude and longitude that represent the location coordinates, the speed in MPH based on current and previous GPS coordinates, and the altitude in feet.</p>
<p>In this section, we tested the NEO-6M u-blox GPS module in the Arduino IDE. First, we installed the <code>TinyGPSPlus</code> library for the module, and later, we used the aforementioned code for the development<a id="_idIndexMarker520"/> board, which shows the readings on the Serial Monitor. In the next section, we will start with the Thing setup in the Arduino IoT Cloud.</p>
<h1 id="_idParaDest-131"><a id="_idTextAnchor131"/>Setting up the Thing, device association, cloud variables, and code</h1>
<p>After setting up the hardware, it’s time<a id="_idIndexMarker521"/> to set up the Thing in the Arduino IoT Cloud. For this project, we need four cloud variables to fetch different properties from the device. The device association settings will be different due to the LoRa series board. Also, network configuration will happen automatically when we upload the code/sketch to the MKR WAN 1300. <em class="italic">Figure 6</em><em class="italic">.8</em> shows a complete overview of the Thing:</p>
<div><div><img alt="Figure 6.8 – Remote asset tracking using the LoRaWAN Thing setup" src="img/B19752_06_08.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.8 – Remote asset tracking using the LoRaWAN Thing setup</p>
<p>Set up a new Thing with the name <strong class="bold">A remote asset tracking using LoRaWAN</strong>, and then follow the next steps, which will take you to the next subsections to create variables, an associate <a id="_idIndexMarker522"/>device network configuration, and finally, code. We have marked the preceding figure with red boxes and numbers according to the following steps.</p>
<p>Firstly, we need to set up four cloud variables – <code>Location</code>, <code>AltitudeFeet</code>, <code>SatelliteCount</code>, and <code>Speed</code>. The complete details regarding cloud variables are available in the following subsection.</p>
<p>After that, we need to associate the device with the Thing. In the current project, we will use the MKR WAN 1300, so the process will be the same as the one used for Arduino boards, but here, we will see some different options due to LoRaWAN. The complete details<a id="_idIndexMarker523"/> are available in the <em class="italic">Associating a </em><em class="italic">device</em> section.</p>
<h2 id="_idParaDest-132"><a id="_idTextAnchor132"/>Cloud variables</h2>
<p>The following table explains<a id="_idIndexMarker524"/> all the properties of the variables that we need to create. For the location, we need two different variables to store the latitude and longitude, but thanks to the Arduino IoT Cloud extended group of variables, we have a <code>Location</code>-type variable. Then, make sure each variable matches the declaration in the table; otherwise, you will need to modify the example code according to your naming.</p>
<p>As shown in <em class="italic">Table 6.2</em>, when creating the cloud variables, we set the permission to <strong class="bold">Read-Only</strong>. Although we have the <em class="italic">Read</em>/<em class="italic">Write</em> option, in this project, we only want to receive data from the device instead of modifying the data via the dashboard. That’s why <strong class="bold">read-only</strong> mode is used – to avoid issues in data consistency. <strong class="bold">Update policy</strong> is set to <strong class="bold">On Change</strong>, as the device will send the data when the GPS module receives new data from satellites.</p>
<table class="No-Table-Style _idGenTablePara-1" id="table002-2">
<colgroup>
<col/>
<col/>
<col/>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="bold">S#</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Variable name</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Variable type</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Declaration</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Permission</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Update </strong><strong class="bold">policy</strong></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>1</p>
</td>
<td class="No-Table-Style">
<p><code>AltitudeFeet</code></p>
</td>
<td class="No-Table-Style">
<p><code>Float</code></p>
</td>
<td class="No-Table-Style">
<p><code>altitudeFeet</code></p>
</td>
<td class="No-Table-Style">
<p>Read-Only</p>
</td>
<td class="No-Table-Style">
<p>On Change</p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>2</p>
</td>
<td class="No-Table-Style">
<p><code>Location</code></p>
</td>
<td class="No-Table-Style">
<p><code>CloudLocation</code></p>
</td>
<td class="No-Table-Style">
<p><code>location</code></p>
</td>
<td class="No-Table-Style">
<p>Read-Only</p>
</td>
<td class="No-Table-Style">
<p>On Change</p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>3</p>
</td>
<td class="No-Table-Style">
<p><code>SatelliteCount</code></p>
</td>
<td class="No-Table-Style">
<p><code>Int</code></p>
</td>
<td class="No-Table-Style">
<p><code>satelliteCount</code></p>
</td>
<td class="No-Table-Style">
<p>Read-Only</p>
</td>
<td class="No-Table-Style">
<p>On Change</p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>4</p>
</td>
<td class="No-Table-Style">
<p><code>Speed</code></p>
</td>
<td class="No-Table-Style">
<p><code>Float</code></p>
</td>
<td class="No-Table-Style">
<p><code>speed</code></p>
</td>
<td class="No-Table-Style">
<p>Read-Only</p>
</td>
<td class="No-Table-Style">
<p>On Change</p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 6.2 – The cloud variables list for the Thing</p>
<p>In this section, we discussed what type of cloud variables are required for this project. Here, we listed four cloud variables of different types but in <strong class="bold">read-only</strong> mode, as we only want to extract the values from the device. In the next subsection, we will associate the MKR WAN 1300 with<a id="_idIndexMarker525"/> the Thing.</p>
<h2 id="_idParaDest-133"><a id="_idTextAnchor133"/>Associating a device</h2>
<p>After creating the variables, it’s time to add the device <a id="_idIndexMarker526"/>and associate it with the Thing:</p>
<ol>
<li>Before adding the device, connect <a id="_idIndexMarker527"/>the development board to the computer and open the <strong class="bold">Arduino Create Agent</strong> application. <em class="italic">Figure 6</em><em class="italic">.9</em> shows a popup in which we have options to either select the existing device for association or set up a new device that is not available on the list.</li>
</ol>
<div><div><img alt="Figure 6.9 – Associate device – selecting a device" src="img/B19752_06_09.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.9 – Associate device – selecting a device</p>
<p class="list-inset">In our case, we already have different<a id="_idIndexMarker528"/> devices in the portal, but we want to add a new one, MKR WAN 1300, so just click on <strong class="bold">SET UP NEW DEVICE</strong> to configure the new device in the account.</p>
<ol>
<li value="2">Then, you will see three options in the popup. The first option is <strong class="bold">Arduino board</strong>, the second option is <strong class="bold">Third party device</strong>, and the third option is <strong class="bold">Any Device</strong>, which is for non-compatible devices. This means you can now use all types of Arduino devices<a id="_idIndexMarker529"/> as well as third-party devices with the Arduino IoT Cloud, which supports Python, MicroPython, and JavaScript.</li>
</ol>
<div><div><img alt="Figure 6.10 – Choosing a development device" src="img/B19752_06_10.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.10 – Choosing a development device</p>
<ol>
<li value="3">Click on <strong class="bold">Arduino board</strong> (marked with a red box in <em class="italic">Figure 6</em><em class="italic">.10</em>) and the next step will automatically detect the MKR WAN 1300 board, which we are using in this chapter. Before adding the device, make sure that <strong class="bold">Arduino Create Agent</strong> is running<a id="_idIndexMarker530"/> on your machine. <em class="italic">Figure 6</em><em class="italic">.11</em> shows that the Arduino IoT Cloud detected the MKR WAN 1300.</li>
</ol>
<div><div><img alt="Figure 6.11 – The device found" src="img/B19752_06_11.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.11 – The device found</p>
<p class="list-inset">When the popup finds the device, click on the <strong class="bold">CONFIGURE</strong> button, which will take you to the next screen.</p>
<ol>
<li value="4"><em class="italic">Figure 6</em><em class="italic">.12</em> shows a screen<a id="_idIndexMarker531"/> that provides some details about the <strong class="bold">The Things Stack</strong> portal link. You will also see a message saying that you need an active LoRaWAN gateway for the MKR WAN 1300 to communicate with the Arduino IoT Cloud.</li>
</ol>
<div><div><img alt="Figure 6.12 – The active LoRaWAN gateway" src="img/B19752_06_12.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.12 – The active LoRaWAN gateway</p>
<p class="list-inset">If you already have the gateway<a id="_idIndexMarker532"/> set up, then that’s fine; otherwise, in the <em class="italic">Configuring the The Things Indoor Gateway </em>section, read up on how to set up the The Things Indoor Gateway, which will provide connectivity to your MKR WAN 1300 development board.</p>
<p class="list-inset">This message also informs you that the Arduino IoT Cloud will automatically configure your device in the The Things Stack portal.</p>
<ol>
<li value="5">After associating<a id="_idIndexMarker533"/> the device, you will receive an email with a username and password, as well as a URL for the The Things Stack portal login, which contains all the information about LoRaWAN nodes. Here, the Arduino IoT Cloud will automatically add the MKR WAN 1300 to the The Things Stack portal after the final steps. Next, <em class="italic">Figure 6</em><em class="italic">.13</em> shows that we need to select a frequency for our device.</li>
</ol>
<div><div><img alt="Figure 6.13 – The MKR WAN 1300 frequency selection" src="img/B19752_06_13.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.13 – The MKR WAN 1300 frequency selection</p>
<p class="list-inset">As we discussed earlier, LoRaWAN operates on different frequencies according to region. So, from the dropdown, select the specific frequency according to your region. I selected <strong class="bold">Europe 863-870 MHZ (SF9 for RX2 - recommended)</strong> according to my LoRaWAN gateway. After selecting the frequency from the dropdown, click on the <strong class="bold">NEXT</strong> button.</p>
<ol>
<li value="6">Now, we need to provide <a id="_idIndexMarker534"/>a name for the device, as shown in <em class="italic">Figure 6</em><em class="italic">.14</em>.</li>
</ol>
<div><div><img alt="Figure 6.14 – Assigning a name to the MKR WAN 1300" src="img/B19752_06_14.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.14 – Assigning a name to the MKR WAN 1300</p>
<p class="list-inset">Here, I assigned the name <code>LoRaWanGPSTracker</code> to the device, but you can use any name related to your project structure. After assigning the name, click on the <strong class="bold">NEXT</strong> button.</p>
<ol>
<li value="7">Then, another popup<a id="_idIndexMarker535"/> will appear, as shown in <em class="italic">Figure 6</em><em class="italic">.15</em>, which will prepare your device for the Arduino IoT Cloud.</li>
</ol>
<div><div><img alt="Figure 6.15 – MKR WAN 1300 configuration" src="img/B19752_06_15.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.15 – MKR WAN 1300 configuration</p>
<p class="list-inset">Here, the Arduino IoT Cloud configures the MKR WAN 1300 via <strong class="bold">Arduino Create Agent</strong>. It will take one to two minutes to set up the development board with the necessary configuration.</p>
<ol>
<li value="8">When the device has been configured <a id="_idIndexMarker536"/>successfully, you will see the following popup. Just click on the <strong class="bold">DONE</strong> button and your device will be associated with your Thing.</li>
</ol>
<div><div><img alt="Figure 6.16 – A successful device setup" src="img/B19752_06_16.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.16 – A successful device setup</p>
<p>In this section, we have associated<a id="_idIndexMarker537"/> the MKR WAN 1300 with our Thing. We have also seen a lot of new options regarding LoRaWAN such as frequency, gateway, and so on. In the upcoming sections, we will discuss the network and code.</p>
<h2 id="_idParaDest-134"><a id="_idTextAnchor134"/>Network</h2>
<p>In previous chapters, after<a id="_idIndexMarker538"/> associating the device with the Thing, we configured the network settings for device communication. However, this time, we don’t need to configure any network settings, as the device will be configured automatically when we upload the sketch to the MKR WAN 1300 development board. At first, you will see an empty area in the <strong class="bold">Network</strong> configuration, as shown in <em class="italic">Figure 6</em><em class="italic">.8</em>, but after the sketch uploads, you will see the LoRaWAN network configuration parameters.</p>
<h2 id="_idParaDest-135"><a id="_idTextAnchor135"/>Coding</h2>
<p>The code for this<a id="_idIndexMarker539"/> chapter is available in the book’s official GitHub repository. Download the <code>A_remote_asset_tracking_using_LoRaWAN_aug30a.zip</code> file and import it into your Arduino Web Editor.</p>
<p>You can download the code and put it into your Thing by navigating to the <code>setup()</code> method. Remember to never try to use the <code>delay()</code> method, as it will block the <code>ArduinoCloud.update()</code> method:</p>
<pre class="source-code">
TinyGPSPlus gps;
unsigned long previousMillis = 0;
const long interval = 30000; //milliseconds</pre> <p>In the preceding code snippet, we declare the <code>gps</code> instance and two variables, which wait for <code>30000</code> milliseconds (30 seconds) before the next readings are taken without blocking the code.</p>
<p>Now, we will explore the <code>loop()</code> method. Here, we call the <code>FetchGPS()</code> method every 30 minutes, which will be carried out by comparing <code>currentMillis</code> and <code>previousMillis</code> without the use of <code>delay()</code>:</p>
<pre class="source-code">
  unsigned long currentMillis = millis();
  if (currentMillis - previousMillis &gt;= interval) {
    //speed=currentMillis;
    FetchGPS();
    previousMillis = currentMillis;
  }</pre> <p>In the following snippet, I have just picked a small part of the code from the <code>FetchGPS()</code> method. Here, I assign the latest values from the GPS module to the Arduino cloud variables, which will be used to send data to the cloud as well as print it on the Serial Monitor:</p>
<pre class="source-code">
if (gps.location.isUpdated())
  {
    altitudeFeet = gps.altitude.feet();
    satelliteCount = gps.satellites.value();
    speed = gps.speed.mph();
    location = Location(gps.location.lat(), gps.location.lng());
    Location cordinates = location.getValue();
 .
 .
 .
}</pre> <p>Upload the code to the device, and open up the Arduino Web Editor Serial Monitor to verify the values. After successfully uploading the data to the cloud, it’s time to set up a beautiful dashboard for web<a id="_idIndexMarker540"/> and mobile for end users.</p>
<p class="callout-heading">Important note</p>
<p class="callout">If you used different <em class="italic">naming</em> when declaring the variables, update the code according to your naming scheme. However, it’s recommended to first follow all the steps in the book and change the cloud variable names later, modifying your code respectively.</p>
<p class="callout">Never try to use the <code>delay()</code> method, which will create a block for the <code>ArduinoCloud.update()</code> method.</p>
<p class="callout">The Arduino IoT Cloud only updates values on its dashboard whenever the variable value changes. For example, if the GPS location is the same after some time, then it means an asset has not moved from its original location. Then, the Arduino IoT Cloud will not record the value, so don’t get confused if values don’t change on the map. Another benefit of this feature is you will not get duplicate data when you export the content.</p>
<p class="callout">The same code will work with the MKR WAN 1310 without any modification. However, in this instance, you need to associate the MKR WAN 1310 device with the Thing instead of the MKR WAN 1300.</p>
<p>In this section, we have explored our code step by step to understand how it works. In the next section, we will set up the The Things Indoor Gateway. If you already have the gateway in your region/area, then you can skip this, but if you don’t have any gateway near your location, then you need to set up the gateway; otherwise, your MKR WAN 1300 will not be able<a id="_idIndexMarker541"/> to communicate with the Arduino IoT Cloud.</p>
<h1 id="_idParaDest-136"><a id="_idTextAnchor136"/>Configuring the The Things Indoor Gateway</h1>
<p>In this section, we will <a id="_idIndexMarker542"/>set up the The Things Indoor Gateway. It is available in different frequencies but I have a gateway with the EU868 MHz frequency. If you already have the LoRaWAN gateway in your area and want to skip this section, you’re good to go, but if you don’t have the gateway in your area, then this section is mandatory for MKR WAN 1300 communication. Without the gateway, your module will not communicate with the Arduino IoT Cloud. To set up the gateway, please follow these steps:</p>
<ol>
<li>Open your gateway box, set it up with a power cable, and turn on the gateway. If you are using a brand-new gateway, then it will be in setup mode; otherwise, you can put the gateway into setup mode by pressing the <strong class="bold">SETUP</strong> button for a few seconds when the orange and green lights start blinking. This means the gateway has entered setup mode.</li>
<li>Select the Wi-Fi network of your the The Things Indoor Gateway, and connect to it. The Wi-Fi password is written on the back of the device. <em class="italic">Figure 6</em><em class="italic">.17</em> shows the <strong class="bold">Setup</strong> page for the The Things<a id="_idIndexMarker543"/> Indoor Gateway.</li>
</ol>
<div><div><img alt="Figure 6.17 – The Things Indoor Gateway setup page" src="img/B19752_06_17.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.17 – The Things Indoor Gateway setup page</p>
<p class="list-inset">After connecting to the indoor gateway, open up your browser and type <code>http://192.168.4.1</code>. This will open up the <strong class="bold">MiniHub Setup</strong> page, as shown in the preceding figure. Click on the plus icon (<strong class="bold">+</strong>) to select the Wi-Fi network that is connected to the internet, and provide its Wi-Fi password. Then, click on the <strong class="bold">SAVE &amp; REBOOT</strong> button. It will take some seconds to restart, and eventually, your LoRaWAN indoor gateway will be connected to the internet via your selected Wi-Fi network.</p>
<ol>
<li value="3">Now, it’s time<a id="_idIndexMarker544"/> to configure the LoRaWAN gateway in the <strong class="bold">The Things Stack</strong> portal, as shown in <em class="italic">Figure 6</em><em class="italic">.18</em>.</li>
</ol>
<div><div><img alt="Figure 6.18 – LoRaWAN gateway registration – step 1" src="img/B19752_06_18.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.18 – LoRaWAN gateway registration – step 1</p>
<p class="list-inset">When you associate the MKR WAN 1300 to the Thing in the Arduino IoT Cloud, you will receive an email from the The Things Stack Cloud that contains the portal URL, along with your username and password details. Log in to the portal, where you will be given a clusters list to add your gateway to a recommended cluster. In the <em class="italic">Associating a device</em> section, I chose the <strong class="bold">Europe 863-870 MHZ (SF9 for RX2 - recommended)</strong> frequency for the MKR WAN 1300, so here, I will choose <strong class="bold">Europe 1</strong> for my gateway. This way, my gateway and MKR WAN 1300 development board both sit under the same cluster.</p>
<ol>
<li value="4">After choosing the cluster, you will be redirected to the main page of the portal. From here, we will start adding the gateway, as shown in <em class="italic">Figure 6</em><em class="italic">.19</em>.</li>
</ol>
<div><div><img alt="Figure 6.19 – LoRaWAN gateway registration – step 2" src="img/B19752_06_19.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.19 – LoRaWAN gateway registration – step 2</p>
<p class="list-inset">On the main page, we have some menus and two big icons, as shown in the preceding figure. From there, click on the <strong class="bold">Go to </strong><strong class="bold">gateways</strong> icon.</p>
<ol>
<li value="5">Then, we will be<a id="_idIndexMarker545"/> on the page that shows the complete list of gateways, as well as the option to register a new gateway, as shown in <em class="italic">Figure 6</em><em class="italic">.20</em>.</li>
</ol>
<div><div><img alt="Figure 6.20 – LoRaWAN gateway registration – step 3" src="img/B19752_06_20.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.20 – LoRaWAN gateway registration – step 3</p>
<p class="list-inset">Click on the blue <strong class="bold">+ Register </strong><strong class="bold">gateway</strong> button.</p>
<ol>
<li value="6">This will take us<a id="_idIndexMarker546"/> to a new page where we can add a gateway to the the The Things Stack network, as shown in <em class="italic">Figure 6</em><em class="italic">.21</em>.</li>
</ol>
<div><div><img alt="Figure 6.21 – LoRaWAN gateway registration – step 4" src="img/B19752_06_21.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.21 – LoRaWAN gateway registration – step 4</p>
<p class="list-inset">Firstly, we need to select the owner from the <strong class="bold">Owner</strong> dropdown. Here, you will see two names. One is your personal username, and the other is <strong class="bold">arduino-iot-cloud-user</strong>. Just select your personal username, as you are the main person adding the gateway. In the next field, insert the <strong class="bold">Gateway EUI</strong> details. The EUI will be written on the back of the gateway. After that, click on the <strong class="bold">Confirm</strong> button.</p>
<ol>
<li value="7">Now, we will verify our gateway and select the frequency plan, as shown in <em class="italic">Figure 6</em><em class="italic">.22</em>.</li>
</ol>
<div><div><img alt="Figure 6.22 – LoRaWAN gateway registration – step 5" src="img/B19752_06_22.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.22 – LoRaWAN gateway registration – step 5</p>
<p class="list-inset">You will see the <strong class="bold">Claim authentication code</strong> field at the top. Here, we need to provide the gateway with a Wi-Fi password for authentication. You can get the gateway Wi-Fi password<a id="_idIndexMarker547"/> from the back of the gateway, from where you previously took it to connect with the device’s Wi-Fi network.</p>
<p class="list-inset">Now, we need to select the frequency plan for our gateway. We already selected <strong class="bold">Europe 863-870 MHZ (SF9 for RX2 - recommended)</strong> during the MKR WAN 1300 association, so we will select the same frequency from the dropdown. After selecting the frequency, click on the <strong class="bold">Claim </strong><strong class="bold">gateway</strong> button.</p>
<ol>
<li value="8">After successfully registering the gateway, we will see a page like the one in the following figure, which provides you with the gateway connectivity status, as well as <strong class="bold">Live data</strong>, <strong class="bold">Created at</strong>, <strong class="bold">Last updated at</strong>, and lots of other information.</li>
</ol>
<div><div><img alt="Figure 6.23 – The LoRaWAN gateway successfully registered on The Things Network" src="img/B19752_06_23.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.23 – The LoRaWAN gateway successfully registered on The Things Network</p>
<p>In this section, we explored<a id="_idIndexMarker548"/> how to set up the The Things Indoor Gateway step by step. In the next section, we will create a dashboard for our Thing on mobile and web to track our assets.</p>
<h1 id="_idParaDest-137"><a id="_idTextAnchor137"/>Creating web and mobile dashboards</h1>
<p>After uploading the code<a id="_idIndexMarker549"/> to the device, it’s time to set up a dashboard<a id="_idIndexMarker550"/> for web and mobile to visualize data with different widgets. <em class="italic">Figure 6</em><em class="italic">.24</em> demonstrates the visualization of readings with different widgets.</p>
<div><div><img alt="Figure 6.24 – The Thing dashboard" src="img/B19752_06_24.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.24 – The Thing dashboard</p>
<p>We have four readings from the GPS module to visualize. Here, I have used four widgets: one gauge, two values, and one map. The gauge widget shows <code>location</code> variable. Currently, the map widget is only capable of displaying the location of the asset device based on coordinates; if you have multiple assets to track, then you need to set up multiple map widgets according to the number of tracking devices.</p>
<p>Well, this is the last section<a id="_idIndexMarker551"/> of our chapter. Here, we created <a id="_idIndexMarker552"/>a stunning dashboard for GPS tracking that shows <strong class="bold">Location</strong> using a map widget on the dashboard, <strong class="bold">Speed Per Mile</strong>, and some other parameters.</p>
<h1 id="_idParaDest-138"><a id="_idTextAnchor138"/>What next?</h1>
<p>We still have a lot of options available to explore, but now it’s your turn to use different sensors and development boards to do some more experiments and learn from them. In this chapter, we only used one GPS module, which gave us only four parameters, but there are a lot of GPS modules on the market that provide a wide variety of functionalities, such as working under a roof and accuracy features.</p>
<p>While monitoring the location of assets, some other parameters are very important to monitor in different industries, such as temperature and humidity, which are very important in food and medical products. CO2 and <strong class="bold">liquefied petroleum gas</strong> (<strong class="bold">LPG</strong>) gases are very important to monitor during fuel transportation. Try using different sensors with a GPS module to set up different tracking prototypes for different industries.</p>
<h1 id="_idParaDest-139"><a id="_idTextAnchor139"/>Summary</h1>
<p>In this chapter, we explored how to develop an asset-tracking system using LoRaWAN and a GPS module. We set up the Thing, which included cloud variable creation, device association, the The Things Indoor Gateway, and coding a development board. Then, we created a dashboard to visualize the Thing readings with different types of widgets to display current readings. The most important widget of the chapter is the map widget, which is very interesting and important for plotting the current location of the device.</p>
<p>GPS tracking is a very important topic that helps us to develop a device for our assets, assisting us in asset tracking and monitoring. We can use LoRaWAN for a specific region, as it has a longer range, but that range only operates in a specific area, unlike other wireless technologies. This chapter demonstrated how we can display the location of a device on a dashboard, giving you more confidence to build more asset-tracking solutions.</p>
<p>In the next chapter, <em class="italic">Enabling Communication between Different Devices</em>, we will explore how the Arduino IoT Cloud makes it easy to send data between devices. Using this method, we will sync IoT nodes with each other for seamless operations.</p>
</div>


<div><h1 id="_idParaDest-140" lang="en-US" xml:lang="en-US"><a id="_idTextAnchor140"/>Part 3: Exchanging Data between Nodes and Cloud Applications</h1>
<p>This third part of the book describes how to exchange data between IoT nodes provisioned on the Arduino IoT Cloud and between the Arduino IoT Cloud and external cloud applications.</p>
<p>These functionalities are required in many real cases to build a distributed and reliable network, to implement some interdependent visualization and logic on the IoT application, and to expand the functionalities of the Arduino IoT Cloud with external tools.</p>
<p>This part has the following chapters:</p>
<ul>
<li><a href="B19752_07.xhtml#_idTextAnchor141"><em class="italic">Chapter 7</em></a>, <em class="italic">Enabling Communication between Different Devices</em></li>
<li><a href="B19752_08.xhtml#_idTextAnchor158"><em class="italic">Chapter 8</em></a>, <em class="italic">Working with the Arduino IoT Cloud SDK and JavaScript</em></li>
<li><a href="B19752_09.xhtml#_idTextAnchor195"><em class="italic">Chapter 9</em></a>, <em class="italic">Project #4 – Collecting Data from the Soil and Environment for Smart Farming</em></li>
<li><a href="B19752_10.xhtml#_idTextAnchor211"><em class="italic">Chapter 10</em></a>, <em class="italic">Project #5 – Making Your Homes Smarter with a Voice Assistant</em></li>
</ul>
</div>
<div><div></div>
</div>
<div><div></div>
</div>
</body></html>