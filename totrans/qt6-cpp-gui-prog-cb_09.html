<html><head></head><body>
<div id="_idContainer159">
<h1 class="chapter-number" id="_idParaDest-185"><a id="_idTextAnchor185"/><span class="koboSpan" id="kobo.1.1">9</span></h1>
<h1 id="_idParaDest-186"><a id="_idTextAnchor186"/><span class="koboSpan" id="kobo.2.1">Building a Touch Screen Application with Qt 6</span></h1>
<p><span class="koboSpan" id="kobo.3.1">Qt is not only a cross-platform software development kit for PC platforms; it also supports mobile platforms, such as iOS and Android. </span><span class="koboSpan" id="kobo.3.2">The developers of Qt introduced </span><strong class="bold"><span class="koboSpan" id="kobo.4.1">Qt Quick</span></strong><span class="koboSpan" id="kobo.5.1"> back in </span><a id="_idIndexMarker571"/><span class="koboSpan" id="kobo.6.1">2010, which provides an easy way to build custom user interfaces that are highly dynamic, where users can easily create fluid transitions and effects with only </span><span class="No-Break"><span class="koboSpan" id="kobo.7.1">minimal coding.</span></span></p>
<p><span class="koboSpan" id="kobo.8.1">Qt Quick uses a declarative scripting language</span><a id="_idIndexMarker572"/><span class="koboSpan" id="kobo.9.1"> called </span><strong class="bold"><span class="koboSpan" id="kobo.10.1">QML</span></strong><span class="koboSpan" id="kobo.11.1">, which is similar to the </span><strong class="bold"><span class="koboSpan" id="kobo.12.1">JavaScript</span></strong><span class="koboSpan" id="kobo.13.1"> language</span><a id="_idIndexMarker573"/><span class="koboSpan" id="kobo.14.1"> used in web development. </span><span class="koboSpan" id="kobo.14.2">Advanced users can also create custom functions in C++ and port them over to Qt Quick to enhance their functionality. </span><span class="koboSpan" id="kobo.14.3">At the moment, Qt Quick supports multiple platforms, such as Windows, Linux, macOS, iOS, </span><span class="No-Break"><span class="koboSpan" id="kobo.15.1">and Android.</span></span></p>
<p><span class="koboSpan" id="kobo.16.1">This chapter will cover the </span><span class="No-Break"><span class="koboSpan" id="kobo.17.1">following recipes:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.18.1">Setting up Qt for </span><span class="No-Break"><span class="koboSpan" id="kobo.19.1">mobile applications</span></span></li>
<li><span class="koboSpan" id="kobo.20.1">Designing a basic user interface </span><span class="No-Break"><span class="koboSpan" id="kobo.21.1">with QML</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.22.1">Touch events</span></span></li>
<li><span class="koboSpan" id="kobo.23.1">Animation </span><span class="No-Break"><span class="koboSpan" id="kobo.24.1">in QML</span></span></li>
<li><span class="koboSpan" id="kobo.25.1">Displaying information </span><span class="No-Break"><span class="koboSpan" id="kobo.26.1">using model/view</span></span></li>
<li><span class="koboSpan" id="kobo.27.1">Integrating QML </span><span class="No-Break"><span class="koboSpan" id="kobo.28.1">and C++</span></span></li>
</ul>
<h1 id="_idParaDest-187"><a id="_idTextAnchor187"/><span class="koboSpan" id="kobo.29.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.30.1">The technical requirements for this chapter include Qt 6.6.1, Qt Creator 12.0.2, Android </span><strong class="bold"><span class="koboSpan" id="kobo.31.1">Software Development Kit</span></strong><span class="koboSpan" id="kobo.32.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.33.1">SDK</span></strong><span class="koboSpan" id="kobo.34.1">), Android </span><strong class="bold"><span class="koboSpan" id="kobo.35.1">Native Development Kit</span></strong><span class="koboSpan" id="kobo.36.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.37.1">NDK</span></strong><span class="koboSpan" id="kobo.38.1">), </span><strong class="bold"><span class="koboSpan" id="kobo.39.1">Java Development Kit</span></strong><span class="koboSpan" id="kobo.40.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.41.1">JDK</span></strong><span class="koboSpan" id="kobo.42.1">), and Apache Ant. </span><span class="koboSpan" id="kobo.42.2">All the code used in this chapter can be downloaded from the following GitHub </span><span class="No-Break"><span class="koboSpan" id="kobo.43.1">repository: </span></span><a href="https://github.com/PacktPublishing/QT6-C-GUI-Programming-Cookbook---Third-Edition-/tree/main/Chapter09"><span class="No-Break"><span class="koboSpan" id="kobo.44.1">https://github.com/PacktPublishing/QT6-C-GUI-Programming-Cookbook---Third-Edition-/tree/main/Chapter09</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.45.1">.</span></span></p>
<h1 id="_idParaDest-188"><a id="_idTextAnchor188"/><span class="koboSpan" id="kobo.46.1">Setting up Qt for mobile applications</span></h1>
<p><span class="koboSpan" id="kobo.47.1">In this </span><a id="_idIndexMarker574"/><span class="koboSpan" id="kobo.48.1">example, we </span><a id="_idIndexMarker575"/><span class="koboSpan" id="kobo.49.1">will learn how to set up our Qt project in Qt Quick and enable it to be built and exported to </span><span class="No-Break"><span class="koboSpan" id="kobo.50.1">mobile devices.</span></span></p>
<h2 id="_idParaDest-189"><a id="_idTextAnchor189"/><span class="koboSpan" id="kobo.51.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.52.1">Let’s get started and learn how to create our first mobile application using </span><span class="No-Break"><span class="koboSpan" id="kobo.53.1">Qt 6:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.54.1">First of all, let’s create a new project by going to </span><strong class="bold"><span class="koboSpan" id="kobo.55.1">File</span></strong><span class="koboSpan" id="kobo.56.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.57.1">New Project…</span></strong><span class="koboSpan" id="kobo.58.1">. </span><span class="koboSpan" id="kobo.58.2">Then, a window will pop up for you to choose a project template. </span><span class="koboSpan" id="kobo.58.3">Select </span><strong class="bold"><span class="koboSpan" id="kobo.59.1">Qt Quick Application</span></strong><span class="koboSpan" id="kobo.60.1"> and click the </span><strong class="bold"><span class="koboSpan" id="kobo.61.1">Choose...</span></strong><span class="koboSpan" id="kobo.62.1"> button, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.63.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer124">
<span class="koboSpan" id="kobo.64.1"><img alt="Figure 9.1 – Create a Qt Quick application project" src="image/B20976_09_001.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.65.1">Figure 9.1 – Create a Qt Quick application project</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.66.1">After that, insert the project name and select the project location. </span><span class="koboSpan" id="kobo.66.2">Click the </span><strong class="bold"><span class="koboSpan" id="kobo.67.1">Next</span></strong><span class="koboSpan" id="kobo.68.1"> button, and it will ask you to select the minimum Qt version required for </span><span class="No-Break"><span class="koboSpan" id="kobo.69.1">your project.</span></span></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.70.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.71.1">Please make sure that you select a version that exists on your computer. </span><span class="koboSpan" id="kobo.71.2">Otherwise, you won’t be able to run </span><span class="No-Break"><span class="koboSpan" id="kobo.72.1">it properly.</span></span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.73.1">Once you have done that, proceed by clicking the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.74.1">Next</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.75.1"> button.</span></span></li>
<li><span class="koboSpan" id="kobo.76.1">Then, Qt Creator will ask you which kit you want to use for your project. </span><span class="koboSpan" id="kobo.76.2">These </span><strong class="bold"><span class="koboSpan" id="kobo.77.1">kits</span></strong><span class="koboSpan" id="kobo.78.1"> are </span><a id="_idIndexMarker576"/><span class="koboSpan" id="kobo.79.1">basically </span><a id="_idIndexMarker577"/><span class="koboSpan" id="kobo.80.1">different compilers that you can use to compile your project for different platforms. </span><span class="koboSpan" id="kobo.80.2">Since we’re making an application for a mobile platform, we will enable the Android kit (or the iOS kit if you’re running a Mac) to build and export your app to your mobile device, as shown in the following screenshot. </span><span class="koboSpan" id="kobo.80.3">You can also enable one of the desktop kits so you can test your program on the desktop beforehand. </span><span class="koboSpan" id="kobo.80.4">Do note that you need to configure the Android kit if you’re using it for the first time so that Qt can find the directory of the Android SDK. </span><span class="koboSpan" id="kobo.80.5">Click </span><strong class="bold"><span class="koboSpan" id="kobo.81.1">Next</span></strong><span class="koboSpan" id="kobo.82.1"> once you’re done </span><span class="No-Break"><span class="koboSpan" id="kobo.83.1">with it:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer125">
<span class="koboSpan" id="kobo.84.1"><img alt="Figure 9.2 – Create an Android Kit for this project" src="image/B20976_09_002.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.85.1">Figure 9.2 – Create an Android Kit for this project</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.86.1">Once the project has been created, Qt Creator will automatically open up a file from your project called </span><strong class="source-inline"><span class="koboSpan" id="kobo.87.1">Main.qml</span></strong><span class="koboSpan" id="kobo.88.1">. </span><span class="koboSpan" id="kobo.88.2">You will see a different type of script, as shown in the</span><a id="_idIndexMarker578"/><span class="koboSpan" id="kobo.89.1"> following</span><a id="_idIndexMarker579"/><span class="koboSpan" id="kobo.90.1"> code, that is very different from your usual </span><span class="No-Break"><span class="koboSpan" id="kobo.91.1">C/C++ projects:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.92.1">
import QtQuick
import QtQuick.Window
Window {
    visible: true
    width: 640
    height: 480
    title: qsTr("Hello World")
}</span></pre></li> <li><span class="koboSpan" id="kobo.93.1">Build and run the project now by clicking on the green arrow button located at the bottom-left corner of your Qt Creator, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.94.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.95.1">.3</span></em><span class="koboSpan" id="kobo.96.1">. </span><span class="koboSpan" id="kobo.96.2">If you set the default kit to one of the desktop kits, an empty window will pop up once the project has </span><span class="No-Break"><span class="koboSpan" id="kobo.97.1">been compiled:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer126">
<span class="koboSpan" id="kobo.98.1"><img alt="Figure 9.3 – Press the triangle button to build and run" src="image/B20976_09_003.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.99.1">Figure 9.3 – Press the triangle button to build and run</span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.100.1">As shown in the </span><a id="_idIndexMarker580"/><span class="koboSpan" id="kobo.101.1">next</span><a id="_idIndexMarker581"/><span class="koboSpan" id="kobo.102.1"> screenshot, We can switch between different kits by going to the Projects interface and selecting the kit you want your project to be built with. </span><span class="koboSpan" id="kobo.102.2">You can also manage all the kits available on your computer or add a new kit to your project from the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.103.1">Projects</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.104.1"> interface:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer127">
<span class="koboSpan" id="kobo.105.1"><img alt="Figure 9.4 – Change to any kits in the Projects interface" src="image/B20976_09_004.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.106.1">Figure 9.4 – Change to any kits in the Projects interface</span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.107.1">If this is your first</span><a id="_idIndexMarker582"/><span class="koboSpan" id="kobo.108.1"> time</span><a id="_idIndexMarker583"/><span class="koboSpan" id="kobo.109.1"> building and running your project, you need to create a template for the Android kit under the </span><strong class="bold"><span class="koboSpan" id="kobo.110.1">Build</span></strong><span class="koboSpan" id="kobo.111.1"> settings. </span><span class="koboSpan" id="kobo.111.2">Once you have clicked the </span><strong class="bold"><span class="koboSpan" id="kobo.112.1">Create Templates</span></strong><span class="koboSpan" id="kobo.113.1"> button under the </span><strong class="bold"><span class="koboSpan" id="kobo.114.1">Build Android APK</span></strong><span class="koboSpan" id="kobo.115.1"> tab, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.116.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.117.1">.5</span></em><span class="koboSpan" id="kobo.118.1">, Qt will generate all the files required to run your app on an Android device. </span><span class="koboSpan" id="kobo.118.2">If you don’t plan to use Gradle in your project, disable the </span><strong class="bold"><span class="koboSpan" id="kobo.119.1">Copy the Gradle files to Android directory</span></strong><span class="koboSpan" id="kobo.120.1"> option. </span><span class="koboSpan" id="kobo.120.2">Otherwise, you may encounter problems when trying to compile and deploy your app to your </span><span class="No-Break"><span class="koboSpan" id="kobo.121.1">mobile device:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer128">
<span class="koboSpan" id="kobo.122.1"><img alt="Figure 9.5 – Click the Create Templates button to create an Android template file" src="image/B20976_09_005.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.123.1">Figure 9.5 – Click the Create Templates button to create an Android template file</span></p>
<ol>
<li value="9"><span class="koboSpan" id="kobo.124.1">Once you </span><a id="_idIndexMarker584"/><span class="koboSpan" id="kobo.125.1">click </span><a id="_idIndexMarker585"/><span class="koboSpan" id="kobo.126.1">the </span><strong class="bold"><span class="koboSpan" id="kobo.127.1">Create Templates</span></strong><span class="koboSpan" id="kobo.128.1"> button, several files will be added to your project by Qt. </span><span class="koboSpan" id="kobo.128.2">These files are specifically for Android projects, including </span><strong class="source-inline"><span class="koboSpan" id="kobo.129.1">AndroidManifest.xml</span></strong><span class="koboSpan" id="kobo.130.1">, Gradle-related files, and other resources that are required by the Android platform. </span><span class="koboSpan" id="kobo.130.2">Let’s open up the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.131.1">AndroidManifest.xml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.132.1"> file:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer129">
<span class="koboSpan" id="kobo.133.1"><img alt="Figure 9.6 – Set your app’s settings in AndroidManifest.xml" src="image/B20976_09_006.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.134.1">Figure 9.6 – Set your app’s settings in AndroidManifest.xml</span></p>
<ol>
<li value="10"><span class="koboSpan" id="kobo.135.1">Once you have opened </span><strong class="source-inline"><span class="koboSpan" id="kobo.136.1">AndroidManifest.xml</span></strong><span class="koboSpan" id="kobo.137.1">, you can set your app’s package name, version code, app icon, and permissions before exporting the app. </span><span class="koboSpan" id="kobo.137.2">To build and test your Android app, click on the </span><strong class="bold"><span class="koboSpan" id="kobo.138.1">Run</span></strong><span class="koboSpan" id="kobo.139.1"> button on Qt Creator. </span><span class="koboSpan" id="kobo.139.2">You should now see the following window pop up, asking which device it should </span><span class="No-Break"><span class="koboSpan" id="kobo.140.1">export to.</span></span></li>
<li><span class="koboSpan" id="kobo.141.1">Select the device that</span><a id="_idIndexMarker586"/><span class="koboSpan" id="kobo.142.1"> is </span><a id="_idIndexMarker587"/><span class="koboSpan" id="kobo.143.1">currently connected to your computer and press the </span><strong class="bold"><span class="koboSpan" id="kobo.144.1">OK</span></strong><span class="koboSpan" id="kobo.145.1"> button. </span><span class="koboSpan" id="kobo.145.2">Wait for a while for it to build the project, and you should be able to get a blank app running on your </span><span class="No-Break"><span class="koboSpan" id="kobo.146.1">mobile device.</span></span></li>
</ol>
<h2 id="_idParaDest-190"><a id="_idTextAnchor190"/><span class="koboSpan" id="kobo.147.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.148.1">A Qt Quick application project is quite different from a widget application project. </span><span class="koboSpan" id="kobo.148.2">You will be writing</span><a id="_idIndexMarker588"/><span class="koboSpan" id="kobo.149.1"> QML</span><a id="_idIndexMarker589"/><span class="koboSpan" id="kobo.150.1"> script most of the time instead of writing C/C++ code. </span><strong class="bold"><span class="koboSpan" id="kobo.151.1">Android Software Development Kit</span></strong><span class="koboSpan" id="kobo.152.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.153.1">SDK</span></strong><span class="koboSpan" id="kobo.154.1">), </span><strong class="bold"><span class="koboSpan" id="kobo.155.1">Android Native Development Kit</span></strong><span class="koboSpan" id="kobo.156.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.157.1">NDK</span></strong><span class="koboSpan" id="kobo.158.1">), </span><strong class="bold"><span class="koboSpan" id="kobo.159.1">Java Development Kit</span></strong><span class="koboSpan" id="kobo.160.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.161.1">JDK</span></strong><span class="koboSpan" id="kobo.162.1">), and </span><strong class="bold"><span class="koboSpan" id="kobo.163.1">Apache Ant</span></strong><span class="koboSpan" id="kobo.164.1"> are required to build and export </span><a id="_idIndexMarker590"/><span class="koboSpan" id="kobo.165.1">your </span><a id="_idIndexMarker591"/><span class="koboSpan" id="kobo.166.1">app to the </span><span class="No-Break"><span class="koboSpan" id="kobo.167.1">Android platform.</span></span></p>
<p><span class="koboSpan" id="kobo.168.1">Alternatively, you can also use Gradle instead of Apache Ant for your Android kit. </span><span class="koboSpan" id="kobo.168.2">All you need to do is enable the </span><strong class="bold"><span class="koboSpan" id="kobo.169.1">Use Gradle</span></strong><span class="koboSpan" id="kobo.170.1"> instead of Ant option and provide Qt with Gradle’s installation path. </span><span class="koboSpan" id="kobo.170.2">Note that Android Studio is currently (at the time of authoring this book) not supported by </span><span class="No-Break"><span class="koboSpan" id="kobo.171.1">Qt Creator:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer130">
<span class="koboSpan" id="kobo.172.1"><img alt="Figure 9.7 – Set up your Android settings in the Android tab in the Preferences window" src="image/B20976_09_007.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.173.1">Figure 9.7 – Set up your Android settings in the Android tab in the Preferences window</span></p>
<p><span class="koboSpan" id="kobo.174.1">If you’re running the app on</span><a id="_idIndexMarker592"/><span class="koboSpan" id="kobo.175.1"> an </span><a id="_idIndexMarker593"/><span class="koboSpan" id="kobo.176.1">Android device, make sure that you have </span><strong class="bold"><span class="koboSpan" id="kobo.177.1">USB debugging mode</span></strong><span class="koboSpan" id="kobo.178.1"> enabled. </span><span class="koboSpan" id="kobo.178.2">To enable USB debugging mode, you need to first enable the developer options on your Android device by going to </span><strong class="bold"><span class="koboSpan" id="kobo.179.1">Settings | About Phone</span></strong><span class="koboSpan" id="kobo.180.1"> and tapping </span><strong class="bold"><span class="koboSpan" id="kobo.181.1">Build Number</span></strong><span class="koboSpan" id="kobo.182.1"> seven times. </span><span class="koboSpan" id="kobo.182.2">After that, go to </span><strong class="bold"><span class="koboSpan" id="kobo.183.1">Settings | Developer Options</span></strong><span class="koboSpan" id="kobo.184.1">, and you will see the </span><strong class="bold"><span class="koboSpan" id="kobo.185.1">USB debugging</span></strong><span class="koboSpan" id="kobo.186.1"> option in the menu. </span><span class="koboSpan" id="kobo.186.2">Enable that option, and you can now export your app to your device </span><span class="No-Break"><span class="koboSpan" id="kobo.187.1">for testing.</span></span></p>
<p><span class="koboSpan" id="kobo.188.1">To build for the iOS platform, you need to run Qt Creator on a Mac and make sure the latest </span><strong class="bold"><span class="koboSpan" id="kobo.189.1">Xcode</span></strong><span class="koboSpan" id="kobo.190.1"> is installed on your Mac as well. </span><span class="koboSpan" id="kobo.190.2">To test your app on an iOS device, you need to register a developer account with Apple, register your device at the developer portal, and install the provisioning to your </span><strong class="bold"><span class="koboSpan" id="kobo.191.1">Xcode</span></strong><span class="koboSpan" id="kobo.192.1">, which is a lot trickier than Android. </span><span class="koboSpan" id="kobo.192.2">You will be given access </span><a id="_idIndexMarker594"/><span class="koboSpan" id="kobo.193.1">to</span><a id="_idIndexMarker595"/><span class="koboSpan" id="kobo.194.1"> the developer portal once you have obtained a developer account </span><span class="No-Break"><span class="koboSpan" id="kobo.195.1">from Apple.</span></span></p>
<h1 id="_idParaDest-191"><a id="_idTextAnchor191"/><span class="koboSpan" id="kobo.196.1">Designing a basic user interface with QML</span></h1>
<p><span class="koboSpan" id="kobo.197.1">This example</span><a id="_idIndexMarker596"/><span class="koboSpan" id="kobo.198.1"> will teach us how to use Qt Design Studio to design our program’s </span><span class="No-Break"><span class="koboSpan" id="kobo.199.1">user interface.</span></span></p>
<h2 id="_idParaDest-192"><a id="_idTextAnchor192"/><span class="koboSpan" id="kobo.200.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.201.1">Let’s follow these steps to </span><span class="No-Break"><span class="koboSpan" id="kobo.202.1">get started:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.203.1">First of all, create a new </span><strong class="bold"><span class="koboSpan" id="kobo.204.1">Qt Quick application</span></strong><span class="koboSpan" id="kobo.205.1"> project, just like we did in the previous recipe. </span><span class="koboSpan" id="kobo.205.2">This time, however, make sure you check on the </span><strong class="bold"><span class="koboSpan" id="kobo.206.1">Creates a project that you can open in Qt Design Studio</span></strong><span class="koboSpan" id="kobo.207.1"> option </span><span class="No-Break"><span class="koboSpan" id="kobo.208.1">as well:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer131">
<span class="koboSpan" id="kobo.209.1"><img alt="Figure 9.8 – Make sure your project can be opened by Qt Design Studio" src="image/B20976_09_008.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.210.1">Figure 9.8 – Make sure your project can be opened by Qt Design Studio</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.211.1">You will see a QML file in your project resources called </span><strong class="source-inline"><span class="koboSpan" id="kobo.212.1">main.qml</span></strong><span class="koboSpan" id="kobo.213.1">. </span><span class="koboSpan" id="kobo.213.2">This is where we implement the logic for our application, but we will also need another QML file where we define our </span><span class="No-Break"><span class="koboSpan" id="kobo.214.1">user interface.</span></span></li>
<li><span class="koboSpan" id="kobo.215.1">Before we proceed to design our program’s user interface, let’s download and install </span><strong class="bold"><span class="koboSpan" id="kobo.216.1">Qt Design Studio</span></strong><span class="koboSpan" id="kobo.217.1"> from Qt’s </span><a id="_idIndexMarker597"/><span class="koboSpan" id="kobo.218.1">official website: </span><a href="https://www.qt.io/product/ui-design-tools"><span class="koboSpan" id="kobo.219.1">https://www.qt.io/product/ui-design-tools</span></a><span class="koboSpan" id="kobo.220.1">. </span><span class="koboSpan" id="kobo.220.2">This is a new editor created by Qt for UI/UX designers to design user interfaces for their Qt </span><span class="No-Break"><span class="koboSpan" id="kobo.221.1">Quick projects.</span></span></li>
<li><span class="koboSpan" id="kobo.222.1">Once you have installed </span><strong class="bold"><span class="koboSpan" id="kobo.223.1">Qt Design Studio</span></strong><span class="koboSpan" id="kobo.224.1">, open up the editor and open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.225.1">.qmlproject</span></strong><span class="koboSpan" id="kobo.226.1"> file in</span><a id="_idIndexMarker598"/><span class="koboSpan" id="kobo.227.1"> your project directory by pressing the </span><strong class="bold"><span class="koboSpan" id="kobo.228.1">Open </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.229.1">Project…</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.230.1"> button:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer132">
<span class="koboSpan" id="kobo.231.1"><img alt="Figure 9.9 – Click the Open Project … button" src="image/B20976_09_009.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.232.1">Figure 9.9 – Click the Open Project … button</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.233.1">After that, a default QML UI file called </span><strong class="source-inline"><span class="koboSpan" id="kobo.234.1">Sreen01.ui.qml</span></strong><span class="koboSpan" id="kobo.235.1"> will be opened by </span><strong class="bold"><span class="koboSpan" id="kobo.236.1">Qt Design Studio</span></strong><span class="koboSpan" id="kobo.237.1">. </span><span class="koboSpan" id="kobo.237.2">You will see an entirely different user interface editor compared to the one we used in </span><span class="No-Break"><span class="koboSpan" id="kobo.238.1">previous chapters.</span></span></li>
<li><span class="koboSpan" id="kobo.239.1">Since Qt 6, the Qt team released the </span><strong class="bold"><span class="koboSpan" id="kobo.240.1">Qt Design Studio</span></strong><span class="koboSpan" id="kobo.241.1">, which is a new editor used specifically to </span><a id="_idIndexMarker599"/><span class="koboSpan" id="kobo.242.1">design user interfaces for Qt Quick projects. </span><span class="koboSpan" id="kobo.242.2">The components of this editor are described </span><span class="No-Break"><span class="koboSpan" id="kobo.243.1">as follows:</span></span><ul><li><strong class="bold"><span class="koboSpan" id="kobo.244.1">Components</span></strong><span class="koboSpan" id="kobo.245.1">: The </span><strong class="bold"><span class="koboSpan" id="kobo.246.1">Components</span></strong><span class="koboSpan" id="kobo.247.1"> window displays all the predefined QML types that you can add to your user interface canvas. </span><span class="koboSpan" id="kobo.247.2">You can also create custom Qt Quick components from the Create Component button and display </span><span class="No-Break"><span class="koboSpan" id="kobo.248.1">them here.</span></span></li><li><strong class="bold"><span class="koboSpan" id="kobo.249.1">Navigator</span></strong><span class="koboSpan" id="kobo.250.1">: The </span><strong class="bold"><span class="koboSpan" id="kobo.251.1">Navigator</span></strong><span class="koboSpan" id="kobo.252.1"> window displays the items in the current QML file in a </span><span class="No-Break"><span class="koboSpan" id="kobo.253.1">tree structure.</span></span></li><li><strong class="bold"><span class="koboSpan" id="kobo.254.1">Connections</span></strong><span class="koboSpan" id="kobo.255.1">: You can use the tools provided in the </span><strong class="bold"><span class="koboSpan" id="kobo.256.1">Connections</span></strong><span class="koboSpan" id="kobo.257.1"> window to connect objects to signals, specify dynamic properties for objects, and create bindings between the properties of </span><span class="No-Break"><span class="koboSpan" id="kobo.258.1">two objects.</span></span></li><li><strong class="bold"><span class="koboSpan" id="kobo.259.1">States</span></strong><span class="koboSpan" id="kobo.260.1">: The </span><strong class="bold"><span class="koboSpan" id="kobo.261.1">States</span></strong><span class="koboSpan" id="kobo.262.1"> window displays the different states of an item. </span><span class="koboSpan" id="kobo.262.2">You can add a new</span><a id="_idIndexMarker600"/><span class="koboSpan" id="kobo.263.1"> state for an item by clicking on the </span><strong class="bold"><span class="koboSpan" id="kobo.264.1">+</span></strong><span class="koboSpan" id="kobo.265.1"> button on the right of the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.266.1">State</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.267.1"> window.</span></span></li><li><strong class="bold"><span class="koboSpan" id="kobo.268.1">2D/3D Canvas</span></strong><span class="koboSpan" id="kobo.269.1">: The canvas is where you design your program’s user interface. </span><span class="koboSpan" id="kobo.269.2">You can drag and drop a </span><strong class="bold"><span class="koboSpan" id="kobo.270.1">Qt Quick</span></strong><span class="koboSpan" id="kobo.271.1"> component from the </span><strong class="bold"><span class="koboSpan" id="kobo.272.1">Components</span></strong><span class="koboSpan" id="kobo.273.1"> window onto the canvas and instantly see what it will look like in the program. </span><span class="koboSpan" id="kobo.273.2">You can create a 2D or 3D canvas for different types </span><span class="No-Break"><span class="koboSpan" id="kobo.274.1">of applications.</span></span></li><li><strong class="bold"><span class="koboSpan" id="kobo.275.1">Properties</span></strong><span class="koboSpan" id="kobo.276.1">: This is where you change the properties of a </span><span class="No-Break"><span class="koboSpan" id="kobo.277.1">selected item.</span></span></li></ul></li>
<li><span class="koboSpan" id="kobo.278.1">You can also select pre-defined workspaces for your </span><strong class="bold"><span class="koboSpan" id="kobo.279.1">Qt Design Studio</span></strong><span class="koboSpan" id="kobo.280.1"> editor by selecting from the drop-down box in the </span><span class="No-Break"><span class="koboSpan" id="kobo.281.1">top-right corner:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer133">
<span class="koboSpan" id="kobo.282.1"><img alt="Figure 9.10 – Select a pre-defined workspace" src="image/B20976_09_010.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.283.1">Figure 9.10 – Select a pre-defined workspace</span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.284.1">We’re about to</span><a id="_idIndexMarker601"/><span class="koboSpan" id="kobo.285.1"> make a simple login screen. </span><span class="koboSpan" id="kobo.285.2">First, delete the editing components from the 2D canvas. </span><span class="koboSpan" id="kobo.285.3">Then, from the </span><strong class="bold"><span class="koboSpan" id="kobo.286.1">Components</span></strong><span class="koboSpan" id="kobo.287.1"> window, drag two text widgets onto </span><span class="No-Break"><span class="koboSpan" id="kobo.288.1">the canvas.</span></span></li>
<li><span class="koboSpan" id="kobo.289.1">Set the </span><strong class="bold"><span class="koboSpan" id="kobo.290.1">Text</span></strong><span class="koboSpan" id="kobo.291.1"> properties of both the text widgets to </span><strong class="source-inline"><span class="koboSpan" id="kobo.292.1">Username:</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.293.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.294.1">Password:</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.295.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer134">
<span class="koboSpan" id="kobo.296.1"><img alt="Figure 9.11 – Set the Text property" src="image/B20976_09_011.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.297.1">Figure 9.11 – Set the Text property</span></p>
<ol>
<li value="10"><span class="koboSpan" id="kobo.298.1">Drag two rectangles from the </span><strong class="bold"><span class="koboSpan" id="kobo.299.1">Components</span></strong><span class="koboSpan" id="kobo.300.1"> window to the canvas, then drag two text input </span><a id="_idIndexMarker602"/><span class="koboSpan" id="kobo.301.1">widgets onto the canvas and parent each of them to the rectangles you just added to the canvas. </span><span class="koboSpan" id="kobo.301.2">Set the </span><strong class="bold"><span class="koboSpan" id="kobo.302.1">Border</span></strong><span class="koboSpan" id="kobo.303.1"> property of the rectangles to </span><strong class="source-inline"><span class="koboSpan" id="kobo.304.1">1</span></strong><span class="koboSpan" id="kobo.305.1"> and the </span><strong class="bold"><span class="koboSpan" id="kobo.306.1">Radius</span></strong><span class="koboSpan" id="kobo.307.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.308.1">5</span></strong><span class="koboSpan" id="kobo.309.1">. </span><span class="koboSpan" id="kobo.309.2">Then, set the echo mode of one of the text fields </span><span class="No-Break"><span class="koboSpan" id="kobo.310.1">to </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.311.1">Password</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.312.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.313.1">Now, we’re going to manually create a button widget by combining a mouse area widget with a rectangle and a text widget. </span><span class="koboSpan" id="kobo.313.2">Drag a mouse area widget onto the canvas, then drag a rectangle and a text widget onto the canvas and parent them both to the mouse area. </span><span class="koboSpan" id="kobo.313.3">Set the color of the rectangle to </span><strong class="source-inline"><span class="koboSpan" id="kobo.314.1">#bdbdbd</span></strong><span class="koboSpan" id="kobo.315.1">, then set its </span><strong class="bold"><span class="koboSpan" id="kobo.316.1">Border</span></strong><span class="koboSpan" id="kobo.317.1"> property to </span><strong class="source-inline"><span class="koboSpan" id="kobo.318.1">1</span></strong><span class="koboSpan" id="kobo.319.1"> and its </span><strong class="bold"><span class="koboSpan" id="kobo.320.1">Radius</span></strong><span class="koboSpan" id="kobo.321.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.322.1">5</span></strong><span class="koboSpan" id="kobo.323.1">. </span><span class="koboSpan" id="kobo.323.2">Then, set the </span><strong class="bold"><span class="koboSpan" id="kobo.324.1">text</span></strong><span class="koboSpan" id="kobo.325.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.326.1">Login</span></strong><span class="koboSpan" id="kobo.327.1"> and make sure the size of the mouse area is the same as </span><span class="No-Break"><span class="koboSpan" id="kobo.328.1">the rectangle.</span></span></li>
<li><span class="koboSpan" id="kobo.329.1">After that, drag another rectangle onto the canvas to act as the container for the login form so that it will look neat. </span><span class="koboSpan" id="kobo.329.2">Set its </span><strong class="bold"><span class="koboSpan" id="kobo.330.1">Border Color</span></strong><span class="koboSpan" id="kobo.331.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.332.1">#5e5858</span></strong><span class="koboSpan" id="kobo.333.1"> and its </span><strong class="bold"><span class="koboSpan" id="kobo.334.1">Border</span></strong><span class="koboSpan" id="kobo.335.1"> property to </span><strong class="source-inline"><span class="koboSpan" id="kobo.336.1">2</span></strong><span class="koboSpan" id="kobo.337.1">. </span><span class="koboSpan" id="kobo.337.2">Then, set its </span><strong class="bold"><span class="koboSpan" id="kobo.338.1">Radius</span></strong><span class="koboSpan" id="kobo.339.1"> property to </span><strong class="source-inline"><span class="koboSpan" id="kobo.340.1">5</span></strong><span class="koboSpan" id="kobo.341.1"> to make its corners look a </span><span class="No-Break"><span class="koboSpan" id="kobo.342.1">little rounded.</span></span></li>
<li><span class="koboSpan" id="kobo.343.1">Make sure the rectangle that we added in the previous step is positioned at the top of the hierarchy in the </span><strong class="bold"><span class="koboSpan" id="kobo.344.1">Navigator</span></strong><span class="koboSpan" id="kobo.345.1"> window so that it appears behind all the other widgets. </span><span class="koboSpan" id="kobo.345.2">You can arrange the widget positions within the hierarchy by pressing the arrow buttons located at the top of the </span><strong class="bold"><span class="koboSpan" id="kobo.346.1">Navigator</span></strong><span class="koboSpan" id="kobo.347.1"> window </span><span class="No-Break"><span class="koboSpan" id="kobo.348.1">as follows:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer135">
<span class="koboSpan" id="kobo.349.1"><img alt="Figure 9.12 – Click the Move up button" src="image/B20976_09_012.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.350.1">Figure 9.12 – Click the Move up button</span></p>
<ol>
<li value="14"><span class="koboSpan" id="kobo.351.1">Next, we will</span><a id="_idIndexMarker603"/><span class="koboSpan" id="kobo.352.1"> export three widgets: mouse area and the two text input widgets as the alias properties of the root item so that later on, we can access these widgets from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.353.1">App.qml</span></strong><span class="koboSpan" id="kobo.354.1"> file. </span><span class="koboSpan" id="kobo.354.2">The widgets can be exported by clicking on the small icon behind the widget name and making sure the icon changes to the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.355.1">On</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.356.1"> status.</span></span></li>
<li><span class="koboSpan" id="kobo.357.1">By now, your user interface should look something </span><span class="No-Break"><span class="koboSpan" id="kobo.358.1">like this:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer136">
<span class="koboSpan" id="kobo.359.1"><img alt="Figure 9.13 – A simple login screen" src="image/B20976_09_013.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.360.1">Figure 9.13 – A simple login screen</span></p>
<ol>
<li value="16"><span class="koboSpan" id="kobo.361.1">Now, let’s open up </span><strong class="source-inline"><span class="koboSpan" id="kobo.362.1">App.qml</span></strong><span class="koboSpan" id="kobo.363.1">. </span><span class="koboSpan" id="kobo.363.2">Qt Creator will not open this file in </span><strong class="bold"><span class="koboSpan" id="kobo.364.1">Qt Design Studio</span></strong><span class="koboSpan" id="kobo.365.1"> by default; instead, it</span><a id="_idIndexMarker604"/><span class="koboSpan" id="kobo.366.1"> will be opened with the script editor. </span><span class="koboSpan" id="kobo.366.2">This is because all the user interface design-related tasks were carried out in </span><strong class="source-inline"><span class="koboSpan" id="kobo.367.1">Screen01.ui.qml</span></strong><span class="koboSpan" id="kobo.368.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.369.1">App.qml</span></strong><span class="koboSpan" id="kobo.370.1"> is only used for defining the logic and functions that will be applied to the UI. </span><span class="koboSpan" id="kobo.370.2">You can, however, open it with Qt Design Studio to preview the user interface by clicking on the </span><strong class="bold"><span class="koboSpan" id="kobo.371.1">Design</span></strong><span class="koboSpan" id="kobo.372.1"> button located in the sidebar on the left of </span><span class="No-Break"><span class="koboSpan" id="kobo.373.1">the editor.</span></span></li>
<li><span class="koboSpan" id="kobo.374.1">At the top of the script, add the third line to import the dialog module to </span><strong class="source-inline"><span class="koboSpan" id="kobo.375.1">App.qml</span></strong><span class="koboSpan" id="kobo.376.1">, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.377.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.378.1">
import QtQuick
import QtQuick.Dialogs
import yourprojectname</span></pre></li> <li><span class="koboSpan" id="kobo.379.1">After that, replace the following code </span><span class="No-Break"><span class="koboSpan" id="kobo.380.1">with this:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.381.1">
Window {
    visible: true
    title: "Hello World"
    width: 360
    height: 360
    Screen01 {
        anchors.fill: parent
        loginButton.onClicked: {
        messageDialog.text = "Username is " +
        userInput.text + " and password is " + passInput.text
        messageDialog.visible = true
        }
    }</span></pre></li> <li><span class="koboSpan" id="kobo.382.1">We continue </span><a id="_idIndexMarker605"/><span class="koboSpan" id="kobo.383.1">to define </span><strong class="source-inline"><span class="koboSpan" id="kobo.384.1">messageDialog</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.385.1">as follows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.386.1">
    MessageDialog {
        id: messageDialog
        title: "Fake login"
        text: ""
        onAccepted: {
        console.log("You have clicked the login button")
        Qt.quit()
        }
    }
}</span></pre></li> <li><span class="koboSpan" id="kobo.387.1">Build and run this program on your PC, and you should get a simple program that shows a message box when you click on the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.388.1">Login</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.389.1"> button:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer137">
<span class="koboSpan" id="kobo.390.1"><img alt="Figure 9.14 – A message box showing after clicking on the Login button" src="image/B20976_09_014.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.391.1">Figure 9.14 – A message box showing after clicking on the Login button</span></p>
<h2 id="_idParaDest-193"><a id="_idTextAnchor193"/><span class="koboSpan" id="kobo.392.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.393.1">Since Qt 5.4, a new file extension called </span><strong class="source-inline"><span class="koboSpan" id="kobo.394.1">.ui.qml</span></strong><span class="koboSpan" id="kobo.395.1"> has been introduced. </span><span class="koboSpan" id="kobo.395.2">The QML engine handles it like </span><a id="_idIndexMarker606"/><span class="koboSpan" id="kobo.396.1">the normal </span><strong class="source-inline"><span class="koboSpan" id="kobo.397.1">.qml</span></strong><span class="koboSpan" id="kobo.398.1"> files but forbids any logic implementation from being written in it. </span><span class="koboSpan" id="kobo.398.2">It serves as the user interface definition template that can be reused in different </span><strong class="source-inline"><span class="koboSpan" id="kobo.399.1">.qml</span></strong><span class="koboSpan" id="kobo.400.1"> files. </span><span class="koboSpan" id="kobo.400.2">The separation of UI definition and logic implementation improves the maintainability of QML code and creates a </span><span class="No-Break"><span class="koboSpan" id="kobo.401.1">better workflow.</span></span></p>
<p><span class="koboSpan" id="kobo.402.1">Since Qt 6, </span><strong class="source-inline"><span class="koboSpan" id="kobo.403.1">.ui.qml</span></strong><span class="koboSpan" id="kobo.404.1"> files have no longer been handled by Qt Creator. </span><span class="koboSpan" id="kobo.404.2">Instead, Qt provides you with another program called Qt Design Studio to edit your Qt Quick UI. </span><span class="koboSpan" id="kobo.404.3">They intend to give programmers and designers their separate tools that fit </span><span class="No-Break"><span class="koboSpan" id="kobo.405.1">their workflow.</span></span></p>
<p><span class="koboSpan" id="kobo.406.1">All the widgets under </span><strong class="bold"><span class="koboSpan" id="kobo.407.1">Basic</span></strong><span class="koboSpan" id="kobo.408.1"> are the most basic widgets that we can use to mix and match and create a new type of widget, </span><span class="No-Break"><span class="koboSpan" id="kobo.409.1">as follows:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer138">
<span class="koboSpan" id="kobo.410.1"><img alt="Figure 9.15 – Drag and drop widgets from here" src="image/B20976_09_015.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.411.1">Figure 9.15 – Drag and drop widgets from here</span></p>
<p><span class="koboSpan" id="kobo.412.1">In the previous example, we learned how to put three widgets together—a text, a mouse area, and a </span><a id="_idIndexMarker607"/><span class="koboSpan" id="kobo.413.1">rectangle—to form a button widget. </span><span class="koboSpan" id="kobo.413.2">You can also create your custom component by clicking the </span><strong class="bold"><span class="koboSpan" id="kobo.414.1">Create Component</span></strong><span class="koboSpan" id="kobo.415.1"> button at the top </span><span class="No-Break"><span class="koboSpan" id="kobo.416.1">right corner:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer139">
<span class="koboSpan" id="kobo.417.1"><img alt="Figure 9.16 – You can also create your custom component" src="image/B20976_09_016.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.418.1">Figure 9.16 – You can also create your custom component</span></p>
<p><span class="koboSpan" id="kobo.419.1">We imported the </span><strong class="source-inline"><span class="koboSpan" id="kobo.420.1">QtQuick.Dialogs</span></strong><span class="koboSpan" id="kobo.421.1"> module in </span><strong class="source-inline"><span class="koboSpan" id="kobo.422.1">App.qml</span></strong><span class="koboSpan" id="kobo.423.1"> and created a message box that displays the username and password filled in by the user when the </span><strong class="bold"><span class="koboSpan" id="kobo.424.1">Login</span></strong><span class="koboSpan" id="kobo.425.1"> button is pressed so that we can prove that the user interface function is working. </span><span class="koboSpan" id="kobo.425.2">If the widgets are not exported from </span><strong class="source-inline"><span class="koboSpan" id="kobo.426.1">Screen01.ui.qml</span></strong><span class="koboSpan" id="kobo.427.1">, we will not be able to access their properties </span><span class="No-Break"><span class="koboSpan" id="kobo.428.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.429.1">App.qml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.430.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.431.1">At this point, we can export the program to iOS and Android, but the user interface may not look accurate on some of the devices that have a higher resolution or a higher </span><strong class="bold"><span class="koboSpan" id="kobo.432.1">density-per-pixel</span></strong><span class="koboSpan" id="kobo.433.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.434.1">DPI</span></strong><span class="koboSpan" id="kobo.435.1">) unit. </span><span class="koboSpan" id="kobo.435.2">We </span><a id="_idIndexMarker608"/><span class="koboSpan" id="kobo.436.1">will cover this</span><a id="_idIndexMarker609"/><span class="koboSpan" id="kobo.437.1"> issue later on in </span><span class="No-Break"><span class="koboSpan" id="kobo.438.1">this chapter.</span></span></p>
<h1 id="_idParaDest-194"><a id="_idTextAnchor194"/><span class="koboSpan" id="kobo.439.1">Touch events</span></h1>
<p><span class="koboSpan" id="kobo.440.1">In this section, we </span><a id="_idIndexMarker610"/><span class="koboSpan" id="kobo.441.1">will learn how to develop a touch-driven</span><a id="_idIndexMarker611"/><span class="koboSpan" id="kobo.442.1"> application that runs on mobile devices using </span><span class="No-Break"><span class="koboSpan" id="kobo.443.1">Qt Quick.</span></span></p>
<h2 id="_idParaDest-195"><a id="_idTextAnchor195"/><span class="koboSpan" id="kobo.444.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.445.1">Let’s get started by following this </span><span class="No-Break"><span class="koboSpan" id="kobo.446.1">step-by-step guide:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.447.1">Create a new </span><strong class="bold"><span class="koboSpan" id="kobo.448.1">Qt Quick </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.449.1">application</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.450.1"> project.</span></span></li>
<li><span class="koboSpan" id="kobo.451.1">In Qt Design Studio, click on the </span><strong class="bold"><span class="koboSpan" id="kobo.452.1">+</span></strong><span class="koboSpan" id="kobo.453.1"> button on the </span><strong class="bold"><span class="koboSpan" id="kobo.454.1">Assets</span></strong><span class="koboSpan" id="kobo.455.1"> Window. </span><span class="koboSpan" id="kobo.455.2">Then, select </span><strong class="source-inline"><span class="koboSpan" id="kobo.456.1">tux.png</span></strong><span class="koboSpan" id="kobo.457.1"> and add it to the project </span><span class="No-Break"><span class="koboSpan" id="kobo.458.1">as follows:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer140">
<span class="koboSpan" id="kobo.459.1"><img alt="Figure 9.17 – Import tux.png into your project" src="image/B20976_09_017.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.460.1">Figure 9.17 – Import tux.png into your project</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.461.1">Next, open up </span><strong class="source-inline"><span class="koboSpan" id="kobo.462.1">Screen01.ui.qml</span></strong><span class="koboSpan" id="kobo.463.1">. </span><span class="koboSpan" id="kobo.463.2">Drag an image widget from the </span><strong class="bold"><span class="koboSpan" id="kobo.464.1">Components</span></strong><span class="koboSpan" id="kobo.465.1"> window to the canvas. </span><span class="koboSpan" id="kobo.465.2">Then, set the source of the image to </span><strong class="source-inline"><span class="koboSpan" id="kobo.466.1">tux.png</span></strong><span class="koboSpan" id="kobo.467.1"> and set its </span><strong class="bold"><span class="koboSpan" id="kobo.468.1">fillMode</span></strong><span class="koboSpan" id="kobo.469.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.470.1">PreserveAspectFit</span></strong><span class="koboSpan" id="kobo.471.1">. </span><span class="koboSpan" id="kobo.471.2">After that, set its </span><strong class="bold"><span class="koboSpan" id="kobo.472.1">width</span></strong><span class="koboSpan" id="kobo.473.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.474.1">200</span></strong><span class="koboSpan" id="kobo.475.1"> and its </span><strong class="bold"><span class="koboSpan" id="kobo.476.1">height</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.477.1">to 2</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.478.1">20</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.479.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.480.1">Make sure that both the mouse area widget and the image widget are exported as the alias properties of the root item by clicking on the small icon beside their respective </span><span class="No-Break"><span class="koboSpan" id="kobo.481.1">widget name.</span></span></li>
<li><span class="koboSpan" id="kobo.482.1">After that, switch over to the script editor by clicking on the </span><strong class="bold"><span class="koboSpan" id="kobo.483.1">Edit</span></strong><span class="koboSpan" id="kobo.484.1"> button on the sidebar located on the left side of the editor. </span><span class="koboSpan" id="kobo.484.2">We need to change the mouse area widget </span><a id="_idIndexMarker612"/><span class="koboSpan" id="kobo.485.1">to</span><a id="_idIndexMarker613"/><span class="koboSpan" id="kobo.486.1"> a </span><a id="_idIndexMarker614"/><span class="koboSpan" id="kobo.487.1">multi-point touch area widget, as in the </span><span class="No-Break"><span class="koboSpan" id="kobo.488.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.489.1">
MultiPointTouchArea {
    id: touchArea
    anchors.fill: parent
    touchPoints: [
        TouchPoint { id: point1 },
        TouchPoint { id: point2 }
    ]
}</span></pre></li> <li><span class="koboSpan" id="kobo.490.1">We also set the </span><strong class="bold"><span class="koboSpan" id="kobo.491.1">Image</span></strong><span class="koboSpan" id="kobo.492.1"> widget</span><a id="_idIndexMarker615"/><span class="koboSpan" id="kobo.493.1"> to</span><a id="_idIndexMarker616"/><span class="koboSpan" id="kobo.494.1"> be automatically placed at the center of the window by default, </span><span class="No-Break"><span class="koboSpan" id="kobo.495.1">as follows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.496.1">
Image {
    id: tux
    x: (window.width / 2) - (tux.width / 2)
    y: (window.height / 2) - (tux.height / 2)
    width: 200
    height: 220
    fillMode: Image.PreserveAspectFit
    source: "tux.png"
}</span></pre></li> <li><span class="koboSpan" id="kobo.497.1">The final user interface should look something </span><span class="No-Break"><span class="koboSpan" id="kobo.498.1">like this:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer141">
<span class="koboSpan" id="kobo.499.1"><img alt="Figure 9.18 – Place the penguin in your application window" src="image/B20976_09_018.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.500.1">Figure 9.18 – Place the penguin in your application window</span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.501.1">Once </span><a id="_idIndexMarker617"/><span class="koboSpan" id="kobo.502.1">you’re</span><a id="_idIndexMarker618"/><span class="koboSpan" id="kobo.503.1"> done with that, let’s open up </span><strong class="source-inline"><span class="koboSpan" id="kobo.504.1">App.qml</span></strong><span class="koboSpan" id="kobo.505.1">. </span><span class="koboSpan" id="kobo.505.2">First, clear</span><a id="_idIndexMarker619"/><span class="koboSpan" id="kobo.506.1"> everything within the </span><strong class="bold"><span class="koboSpan" id="kobo.507.1">Screen01</span></strong><span class="koboSpan" id="kobo.508.1"> object except </span><strong class="source-inline"><span class="koboSpan" id="kobo.509.1">anchors.fill: parent</span></strong><span class="koboSpan" id="kobo.510.1">, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.511.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.512.1">
import QtQuick
import QtQuick.Window
Window {
    visible: true
    Screen01 {
        anchors.fill: parent
    }
}</span></pre></li> <li><span class="koboSpan" id="kobo.513.1">After that, declare several variables within the </span><strong class="bold"><span class="koboSpan" id="kobo.514.1">MainForm</span></strong><span class="koboSpan" id="kobo.515.1"> object that will be used to rescale the image widget. </span><span class="koboSpan" id="kobo.515.2">If you want to know more about the property keyword used in the following code, check out the </span><strong class="bold"><span class="koboSpan" id="kobo.516.1">There’s more…</span></strong><span class="koboSpan" id="kobo.517.1"> section at the end of </span><span class="No-Break"><span class="koboSpan" id="kobo.518.1">this example:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.519.1">
property int prevPointX: 0
property int prevPointY: 0
property int curPointX: 0
property int curPointY: 0
property int prevDistX: 0
property int prevDistY: 0
property int curDistX: 0
property int curDistY: 0
property int tuxWidth: tux.width
property int tuxHeight: tux.height</span></pre></li> <li><span class="koboSpan" id="kobo.520.1">Using the </span><a id="_idIndexMarker620"/><span class="koboSpan" id="kobo.521.1">following code, we will define what will </span><a id="_idIndexMarker621"/><span class="koboSpan" id="kobo.522.1">happen when our finger touches the multi-point area widget. </span><span class="koboSpan" id="kobo.522.2">In this case, we will save the positions of the first and second touch points if more than one finger touches the multi-point touch area. </span><span class="koboSpan" id="kobo.522.3">We also save the width and height of the image widget so that, later on, we can use these variables to calculate the scale of the image when the fingers start </span><span class="No-Break"><span class="koboSpan" id="kobo.523.1">to move:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.524.1">
touchArea.onPressed: {
    if (touchArea.touchPoints[1].pressed) {
        if (touchArea.touchPoints[1].x &lt; touchArea.touchPoints[0].x)
            prevDistX = touchArea.touchPoints[1].x -    touchArea.touchPoints[0].x
        else
            prevDistX = touchArea.touchPoints[0].x -
            touchArea.touchPoints[1].x
        if (touchArea.touchPoints[1].y &lt; touchArea.touchPoints[0].y)
            prevDistY = touchArea.touchPoints[1].y -
            touchArea.touchPoints[0].y
        else
            prevDistY = touchArea.touchPoints[0].y -
            touchArea.touchPoints[1].y
            tuxWidth = tux.width
            tuxHeight = tux.height
        }
    }</span></pre></li> <li><span class="koboSpan" id="kobo.525.1">The following</span><a id="_idIndexMarker622"/><span class="koboSpan" id="kobo.526.1"> diagram shows the example of touch </span><a id="_idIndexMarker623"/><span class="koboSpan" id="kobo.527.1">points being registered when two fingers are touching the screen within the </span><strong class="source-inline"><span class="koboSpan" id="kobo.528.1">touchArea</span></strong><span class="koboSpan" id="kobo.529.1"> boundary. </span><span class="koboSpan" id="kobo.529.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.530.1">touchArea.touchPoints[0]</span></strong><span class="koboSpan" id="kobo.531.1"> is the first registered touch point, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.532.1">touchArea.touchPoints[1]</span></strong><span class="koboSpan" id="kobo.533.1"> is the second. </span><span class="koboSpan" id="kobo.533.2">We then calculate the X and Y distance between the two touch points and save them as </span><strong class="source-inline"><span class="koboSpan" id="kobo.534.1">prevDistX</span></strong><span class="koboSpan" id="kobo.535.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.536.1">prevDistY</span></strong><span class="koboSpan" id="kobo.537.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.538.1">as follows:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer142">
<span class="koboSpan" id="kobo.539.1"><img alt="Figure 9.19 – Calculate the distances between two touch points" src="image/B20976_09_019.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.540.1">Figure 9.19 – Calculate the distances between two touch points</span></p>
<ol>
<li value="12"><span class="koboSpan" id="kobo.541.1">After that, we will define what will happen when our fingers move while remaining in contact with the screen and still within the boundary of the touch area using the</span><a id="_idIndexMarker624"/><span class="koboSpan" id="kobo.542.1"> following code. </span><span class="koboSpan" id="kobo.542.2">At this point, we</span><a id="_idIndexMarker625"/><span class="koboSpan" id="kobo.543.1"> will calculate the scale of the image by using the variables we saved in the previous step. </span><span class="koboSpan" id="kobo.543.2">At the same time, if we detect that only a single touch is found, then we will move the image instead of altering </span><span class="No-Break"><span class="koboSpan" id="kobo.544.1">its scale:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.545.1">
        touchArea.onUpdated: {
            if (!touchArea.touchPoints[1].pressed) {
                tux.x += touchArea.touchPoints[0].x -
        touchArea.touchPoints[0].previousX
                tux.y += touchArea.touchPoints[0].y -
        touchArea.touchPoints[0].previousY
            }
            else {
                if (touchArea.touchPoints[1].x &lt;
                touchArea.touchPoints[0].x)
                    curDistX = touchArea.touchPoints[1].x - touchArea.touchPoints[0].x
                else
                    curDistX = touchArea.touchPoints[0].x - touchArea.touchPoints[1].x
                if (touchArea.touchPoints[1].y &lt;
                touchArea.touchPoints[0].y)
                    curDistY = touchArea.touchPoints[1].y - touchArea.touchPoints[0].y
                else
                    curDistY = touchArea.touchPoints[0].y - touchArea.touchPoints[1].y
                tux.width = tuxWidth + prevDistX - curDistX
                tux.height = tuxHeight + prevDistY - curDistY
            }
        }</span></pre></li> <li><span class="koboSpan" id="kobo.546.1">The </span><a id="_idIndexMarker626"/><span class="koboSpan" id="kobo.547.1">following </span><a id="_idIndexMarker627"/><span class="koboSpan" id="kobo.548.1">diagram shows the example of moving touch points; </span><strong class="source-inline"><span class="koboSpan" id="kobo.549.1">touchArea.touchPoints[0]</span></strong><span class="koboSpan" id="kobo.550.1"> moved from point A to point B, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.551.1">touchArea.touchPoints[1]</span></strong><span class="koboSpan" id="kobo.552.1"> moved from point C to point D. </span><span class="koboSpan" id="kobo.552.2">We can then determine how many units have the touch points moved by looking at the differences between the previous X, and Y variables with the </span><span class="No-Break"><span class="koboSpan" id="kobo.553.1">current ones:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer143">
<span class="koboSpan" id="kobo.554.1"><img alt="Figure 9.20 – Compare two sets of touch points to determine movement" src="image/B20976_09_020.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.555.1">Figure 9.20 – Compare two sets of touch points to determine movement</span></p>
<ol>
<li value="14"><span class="koboSpan" id="kobo.556.1">You can now build and export the program to your mobile device. </span><span class="koboSpan" id="kobo.556.2">You will not be able to test</span><a id="_idIndexMarker628"/><span class="koboSpan" id="kobo.557.1"> this program on a platform that </span><a id="_idIndexMarker629"/><span class="koboSpan" id="kobo.558.1">does not </span><span class="No-Break"><span class="koboSpan" id="kobo.559.1">support multi-touch.</span></span></li>
<li><span class="koboSpan" id="kobo.560.1">Once the program is running on the mobile device (or a desktop/laptop that supports multi-touch), try two things—put only one finger on the screen and move it around, and put two fingers on the screen and move them in opposite directions. </span><span class="koboSpan" id="kobo.560.2">What you should see is that the penguin will be moved to another place if you use only one finger, and it will be scaled up or down if you use two fingers, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.561.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer144">
<span class="koboSpan" id="kobo.562.1"><img alt="Figure 9.21 – Scaling up and down using your fingers" src="image/B20976_09_021.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.563.1">Figure 9.21 – Scaling up and down using your fingers</span></p>
<h2 id="_idParaDest-196"><a id="_idTextAnchor196"/><span class="koboSpan" id="kobo.564.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.565.1">When a finger touches the screen of the device, the multi-point touch area widget triggers the </span><strong class="source-inline"><span class="koboSpan" id="kobo.566.1">onPressed</span></strong><span class="koboSpan" id="kobo.567.1"> event and registers the position of each of the touch points in an internal array. </span><span class="koboSpan" id="kobo.567.2">We</span><a id="_idIndexMarker630"/><span class="koboSpan" id="kobo.568.1"> can get these data by telling Qt which</span><a id="_idIndexMarker631"/><span class="koboSpan" id="kobo.569.1"> touch point we want to get access to. </span><span class="koboSpan" id="kobo.569.2">The first touch will bear the index number of 0, the second touch will be 1, and so on. </span><span class="koboSpan" id="kobo.569.3">We will then save these data into variables so that we can retrieve them later to calculate the scaling of the penguin image. </span><span class="koboSpan" id="kobo.569.4">Other than </span><strong class="source-inline"><span class="koboSpan" id="kobo.570.1">onPressed</span></strong><span class="koboSpan" id="kobo.571.1">, you can also use </span><strong class="source-inline"><span class="koboSpan" id="kobo.572.1">onReleased</span></strong><span class="koboSpan" id="kobo.573.1"> if you want the event to be triggered when the user releases his/her finger from the </span><span class="No-Break"><span class="koboSpan" id="kobo.574.1">touch area.</span></span></p>
<p><span class="koboSpan" id="kobo.575.1">When one or more fingers remain in contact with the screen while moving, a multi-point touch area will trigger the </span><strong class="source-inline"><span class="koboSpan" id="kobo.576.1">onUpdated</span></strong><span class="koboSpan" id="kobo.577.1"> event. </span><span class="koboSpan" id="kobo.577.2">We will then check how many touches there are; if only one touch is found, we will just move the penguin image based on how much our finger has moved. </span><span class="koboSpan" id="kobo.577.3">If there is more than one touch, we will compare the distance between the two touches and compare this with the previous variables we have saved to determine how much we should rescale </span><span class="No-Break"><span class="koboSpan" id="kobo.578.1">the image.</span></span></p>
<p><span class="koboSpan" id="kobo.579.1">The diagram shows tapping your finger on the screen will trigger the </span><strong class="source-inline"><span class="koboSpan" id="kobo.580.1">onPressed</span></strong><span class="koboSpan" id="kobo.581.1"> event, while swiping your finger on the screen will trigger the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.582.1">onUpdated</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.583.1"> event:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer145">
<span class="koboSpan" id="kobo.584.1"><img alt="Figure 9.22 – Difference between onPressed and onUpdated" src="image/B20976_09_022.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.585.1">Figure 9.22 – Difference between onPressed and onUpdated</span></p>
<p><span class="koboSpan" id="kobo.586.1">We must also check whether the first touch is on the left side or if the second touch is on the right side. </span><span class="koboSpan" id="kobo.586.2">In this way, we can prevent the image from being scaled in the inverse direction of the finger movement and producing an inaccurate result. </span><span class="koboSpan" id="kobo.586.3">As for the movement of the penguin, we will just get the difference between the current touch position and the previous one and add that to the coordinate of the penguin; after this, it’s done. </span><span class="koboSpan" id="kobo.586.4">A </span><a id="_idIndexMarker632"/><span class="koboSpan" id="kobo.587.1">single </span><a id="_idIndexMarker633"/><span class="koboSpan" id="kobo.588.1">touch event is usually a lot more straightforward than a </span><span class="No-Break"><span class="koboSpan" id="kobo.589.1">multi-touch event.</span></span></p>
<h2 id="_idParaDest-197"><a id="_idTextAnchor197"/><span class="koboSpan" id="kobo.590.1">There’s more…</span></h2>
<p><span class="koboSpan" id="kobo.591.1">In Qt Quick, all its components have built-in properties, such as </span><strong class="bold"><span class="koboSpan" id="kobo.592.1">width</span></strong><span class="koboSpan" id="kobo.593.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.594.1">height</span></strong><span class="koboSpan" id="kobo.595.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.596.1">color</span></strong><span class="koboSpan" id="kobo.597.1">, that are attached to the components by default. </span><span class="koboSpan" id="kobo.597.2">However, Qt Quick also allows you to create your custom properties and attach them to the components you declared in your QML script. </span><span class="koboSpan" id="kobo.597.3">A custom property of an object type may be defined in an object declaration in a QML document by adding the property keyword before the type (</span><strong class="source-inline"><span class="koboSpan" id="kobo.598.1">int</span></strong><span class="koboSpan" id="kobo.599.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.600.1">float</span></strong><span class="koboSpan" id="kobo.601.1">, and so on) keyword; here is </span><span class="No-Break"><span class="koboSpan" id="kobo.602.1">an example:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.603.1">
property int myValue;</span></pre> <p><span class="koboSpan" id="kobo.604.1">You can also bind the custom </span><strong class="source-inline"><span class="koboSpan" id="kobo.605.1">property</span></strong><span class="koboSpan" id="kobo.606.1"> to a value by using a colon (</span><strong class="source-inline"><span class="koboSpan" id="kobo.607.1">:</span></strong><span class="koboSpan" id="kobo.608.1">) before the value, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.609.1">following code:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.610.1">
property int myValue: 100;</span></pre> <p class="callout-heading"><span class="koboSpan" id="kobo.611.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.612.1">To learn more about the</span><a id="_idIndexMarker634"/><span class="koboSpan" id="kobo.613.1"> property types supported by Qt Quick, check out this </span><span class="No-Break"><span class="koboSpan" id="kobo.614.1">link: </span></span><a href="http://doc.qt.io/qt-6/qtqml-typesystem-basictypes.html"><span class="No-Break"><span class="koboSpan" id="kobo.615.1">http://doc.qt.io/qt-6/qtqml-typesystem-basictypes.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.616.1">.</span></span></p>
<h1 id="_idParaDest-198"><a id="_idTextAnchor198"/><span class="koboSpan" id="kobo.617.1">Animation in QML</span></h1>
<p><span class="koboSpan" id="kobo.618.1">Qt allows us to </span><a id="_idIndexMarker635"/><span class="koboSpan" id="kobo.619.1">easily animate a user interface component without writing </span><a id="_idIndexMarker636"/><span class="koboSpan" id="kobo.620.1">a bunch of code. </span><span class="koboSpan" id="kobo.620.2">In this example, we will learn how to make our program’s user interface more interesting by applying animations </span><span class="No-Break"><span class="koboSpan" id="kobo.621.1">to it.</span></span></p>
<h2 id="_idParaDest-199"><a id="_idTextAnchor199"/><span class="koboSpan" id="kobo.622.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.623.1">Let’s learn how to add animation to our Qt Quick application by following </span><span class="No-Break"><span class="koboSpan" id="kobo.624.1">these steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.625.1">Once again, we will start everything from scratch. </span><span class="koboSpan" id="kobo.625.2">Therefore, create a new </span><strong class="bold"><span class="koboSpan" id="kobo.626.1">Qt Quick application</span></strong><span class="koboSpan" id="kobo.627.1"> project in Qt Creator and open the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.628.1">Screen01.ui.qml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.629.1"> file.</span></span></li>
<li><span class="koboSpan" id="kobo.630.1">Open up </span><strong class="source-inline"><span class="koboSpan" id="kobo.631.1">Screen01.ui.qml</span></strong><span class="koboSpan" id="kobo.632.1"> and go to the </span><strong class="bold"><span class="koboSpan" id="kobo.633.1">+</span></strong><span class="koboSpan" id="kobo.634.1"> button in the </span><strong class="bold"><span class="koboSpan" id="kobo.635.1">Components</span></strong><span class="koboSpan" id="kobo.636.1"> window and add a Qt Quick module called </span><strong class="source-inline"><span class="koboSpan" id="kobo.637.1">QtQuick.Controls</span></strong><span class="koboSpan" id="kobo.638.1"> to </span><span class="No-Break"><span class="koboSpan" id="kobo.639.1">your project.</span></span></li>
<li><span class="koboSpan" id="kobo.640.1">After that, you will see a new category appear in the </span><strong class="bold"><span class="koboSpan" id="kobo.641.1">QML Types</span></strong><span class="koboSpan" id="kobo.642.1"> tab called </span><strong class="bold"><span class="koboSpan" id="kobo.643.1">QtQuick Controls</span></strong><span class="koboSpan" id="kobo.644.1">, which contains many new widgets that can be placed on </span><span class="No-Break"><span class="koboSpan" id="kobo.645.1">the canvas.</span></span></li>
<li><span class="koboSpan" id="kobo.646.1">Next, drag three button widgets to the canvas and set their </span><strong class="bold"><span class="koboSpan" id="kobo.647.1">height</span></strong><span class="koboSpan" id="kobo.648.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.649.1">45</span></strong><span class="koboSpan" id="kobo.650.1">. </span><span class="koboSpan" id="kobo.650.2">Then, go to the </span><strong class="bold"><span class="koboSpan" id="kobo.651.1">Layout</span></strong><span class="koboSpan" id="kobo.652.1"> tab on the </span><strong class="bold"><span class="koboSpan" id="kobo.653.1">Properties</span></strong><span class="koboSpan" id="kobo.654.1"> window and enable both the left and right anchors for all three button widgets. </span><span class="koboSpan" id="kobo.654.2">Make sure the target for the anchors is set to </span><strong class="bold"><span class="koboSpan" id="kobo.655.1">Parent</span></strong><span class="koboSpan" id="kobo.656.1"> and the margins remain as </span><strong class="source-inline"><span class="koboSpan" id="kobo.657.1">0</span></strong><span class="koboSpan" id="kobo.658.1">. </span><span class="koboSpan" id="kobo.658.2">This will make the buttons resize horizontally according to the width of the main window. </span><span class="koboSpan" id="kobo.658.3">After that, set the y value of the first button to </span><strong class="source-inline"><span class="koboSpan" id="kobo.659.1">0</span></strong><span class="koboSpan" id="kobo.660.1">, the second to </span><strong class="source-inline"><span class="koboSpan" id="kobo.661.1">45</span></strong><span class="koboSpan" id="kobo.662.1">, and the third to </span><strong class="source-inline"><span class="koboSpan" id="kobo.663.1">90</span></strong><span class="koboSpan" id="kobo.664.1">. </span><span class="koboSpan" id="kobo.664.2">The user interface should now look </span><span class="No-Break"><span class="koboSpan" id="kobo.665.1">like this:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer146">
<span class="koboSpan" id="kobo.666.1"><img alt="Figure 9.23 – Add three buttons to the layout" src="image/B20976_09_023.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.667.1">Figure 9.23 – Add three buttons to the layout</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.668.1">Now, open up the </span><strong class="bold"><span class="koboSpan" id="kobo.669.1">Assets</span></strong><span class="koboSpan" id="kobo.670.1"> window and add </span><strong class="source-inline"><span class="koboSpan" id="kobo.671.1">fan.png</span></strong><span class="koboSpan" id="kobo.672.1"> to the project, </span><span class="No-Break"><span class="koboSpan" id="kobo.673.1">as follows:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer147">
<span class="koboSpan" id="kobo.674.1"><img alt="Figure 9.24 – Add fan.png to your project" src="image/B20976_09_024.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.675.1">Figure 9.24 – Add fan.png to your project</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.676.1">Then, add </span><a id="_idIndexMarker637"/><span class="koboSpan" id="kobo.677.1">two </span><a id="_idIndexMarker638"/><span class="koboSpan" id="kobo.678.1">mouse area widgets to the canvas. </span><span class="koboSpan" id="kobo.678.2">After that, drag a </span><strong class="bold"><span class="koboSpan" id="kobo.679.1">Rectangle</span></strong><span class="koboSpan" id="kobo.680.1"> widget and an </span><strong class="bold"><span class="koboSpan" id="kobo.681.1">Image</span></strong><span class="koboSpan" id="kobo.682.1"> widget onto the canvas. </span><span class="koboSpan" id="kobo.682.2">Parent the rectangle and image to the mouse areas we have just added </span><span class="No-Break"><span class="koboSpan" id="kobo.683.1">before this.</span></span></li>
<li><span class="koboSpan" id="kobo.684.1">Set the </span><strong class="bold"><span class="koboSpan" id="kobo.685.1">color</span></strong><span class="koboSpan" id="kobo.686.1"> of the rectangle to </span><strong class="source-inline"><span class="koboSpan" id="kobo.687.1">#0000ff</span></strong><span class="koboSpan" id="kobo.688.1"> and apply </span><strong class="source-inline"><span class="koboSpan" id="kobo.689.1">fan.png</span></strong><span class="koboSpan" id="kobo.690.1"> to the image widget. </span><span class="koboSpan" id="kobo.690.2">Your user interface should now look </span><span class="No-Break"><span class="koboSpan" id="kobo.691.1">like this:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer148">
<span class="koboSpan" id="kobo.692.1"><img alt="Figure 9.25 – Place a rectangle and the fan image in the layout" src="image/B20976_09_025.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.693.1">Figure 9.25 – Place a rectangle and the fan image in the layout</span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.694.1">After that, export all the widgets in your </span><strong class="source-inline"><span class="koboSpan" id="kobo.695.1">Screen01.ui.qml</span></strong><span class="koboSpan" id="kobo.696.1"> as alias properties of the </span><a id="_idIndexMarker639"/><span class="koboSpan" id="kobo.697.1">root</span><a id="_idIndexMarker640"/><span class="koboSpan" id="kobo.698.1"> item by clicking on the icons located to the right of the widget name, </span><span class="No-Break"><span class="koboSpan" id="kobo.699.1">as follows:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer149">
<span class="koboSpan" id="kobo.700.1"><img alt="Figure 9.26 – Adding aliases to the widgets" src="image/B20976_09_026.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.701.1">Figure 9.26 – Adding aliases to the widgets</span></p>
<ol>
<li value="9"><span class="koboSpan" id="kobo.702.1">Next, we will apply animation and logic to the user interface, but we won’t be doing it in </span><strong class="source-inline"><span class="koboSpan" id="kobo.703.1">Screen01.ui.qml</span></strong><span class="koboSpan" id="kobo.704.1">. </span><span class="koboSpan" id="kobo.704.2">Instead, we will do it all </span><span class="No-Break"><span class="koboSpan" id="kobo.705.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.706.1">App.qml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.707.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.708.1">In </span><strong class="source-inline"><span class="koboSpan" id="kobo.709.1">App.qml</span></strong><span class="koboSpan" id="kobo.710.1">, remove the default code for the mouse area and add in a </span><strong class="bold"><span class="koboSpan" id="kobo.711.1">width</span></strong><span class="koboSpan" id="kobo.712.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.713.1">height</span></strong><span class="koboSpan" id="kobo.714.1"> for the window so that we get more space to preview, </span><span class="No-Break"><span class="koboSpan" id="kobo.715.1">as follows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.716.1">
import QtQuick
import QtQuick.Window
Window {
    visible: true
    width: 480
    height: 550
    Screen01 {
        anchors.fill: parent
    }
}</span></pre></li> <li><span class="koboSpan" id="kobo.717.1">After that, add </span><a id="_idIndexMarker641"/><span class="koboSpan" id="kobo.718.1">the </span><a id="_idIndexMarker642"/><span class="koboSpan" id="kobo.719.1">following code that defines the behavior of the buttons in the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.720.1">Screen01</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.721.1"> widget:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.722.1">
        button1 {
            Behavior on y { SpringAnimation { spring: 2; damping: 0.2 } }
            onClicked: {
                button1.y = button1.y + (45 * 3)
            }
        }
        button2 {
                Behavior on y { SpringAnimation { spring: 2; damping: 0.2 } }
            onClicked: {
                button2.y = button2.y + (45 * 3)
            }
        }</span></pre></li> <li><span class="koboSpan" id="kobo.723.1">In the following code, we continue to </span><span class="No-Break"><span class="koboSpan" id="kobo.724.1">define </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.725.1">button3</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.726.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.727.1">
        button3 {
            Behavior on y { SpringAnimation { spring: 2; damping: 0.2 } }
            onClicked: {
                button3.y = button3.y + (45 * 3)
            }
        }</span></pre></li> <li><span class="koboSpan" id="kobo.728.1">Then, follow this</span><a id="_idIndexMarker643"/><span class="koboSpan" id="kobo.729.1"> with </span><a id="_idIndexMarker644"/><span class="koboSpan" id="kobo.730.1">the behavior of the fan image and the mouse area widget it is attached to </span><span class="No-Break"><span class="koboSpan" id="kobo.731.1">as follows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.732.1">
        fan {
            RotationAnimation on rotation {
                id: anim01
                loops: Animation.Infinite
                from: 0
                to: -360
                duration: 1000
            }
        }</span></pre></li> <li><span class="koboSpan" id="kobo.733.1">In the following code, we then </span><span class="No-Break"><span class="koboSpan" id="kobo.734.1">define </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.735.1">mouseArea1</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.736.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.737.1">
        mouseArea1 {
            onPressed: {
                if (anim01.paused)
                    anim01.resume()
                else
                    anim01.pause()
            }
        }</span></pre></li> <li><span class="koboSpan" id="kobo.738.1">Last but not least, add the behavior of the rectangle and the mouse area widget it’s attached to </span><span class="No-Break"><span class="koboSpan" id="kobo.739.1">as follows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.740.1">
        rectangle2 {
            id: rect2
            state: "BLUE"
            states: [
                State {
                    name: "BLUE"
                    PropertyChanges {
                        target: rect2
                        color: "blue"
            }
        },</span></pre></li> <li><span class="koboSpan" id="kobo.741.1">In the</span><a id="_idIndexMarker645"/><span class="koboSpan" id="kobo.742.1"> following </span><a id="_idIndexMarker646"/><span class="koboSpan" id="kobo.743.1">code, we continue to add the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.744.1">RED</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.745.1"> state:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.746.1">
                State {
                    name: "RED"
                    PropertyChanges {
                        target: rect2
                        color: "red"
                    }
                }
            ]
        }</span></pre></li> <li><span class="koboSpan" id="kobo.747.1">We then finish the code by defining </span><strong class="source-inline"><span class="koboSpan" id="kobo.748.1">mouseArea2</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.749.1">as follows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.750.1">
        mouseArea2 {
            SequentialAnimation on x {
                loops: Animation.Infinite
                PropertyAnimation { to: 150; duration: 1500 }
                PropertyAnimation { to: 50; duration: 500 }
            }
            onClicked: {
                if (rect2.state == "BLUE")
                    rect2.state = "RED"
                else
                    rect2.state = "BLUE"
            }
        }</span></pre></li> <li><span class="koboSpan" id="kobo.751.1">If you compile</span><a id="_idIndexMarker647"/><span class="koboSpan" id="kobo.752.1"> and</span><a id="_idIndexMarker648"/><span class="koboSpan" id="kobo.753.1"> run the program now, you should see three buttons at the top of the window and a moving rectangle at the bottom left, followed by a spinning fan at the bottom right, as demonstrated in the following screenshot. </span><span class="koboSpan" id="kobo.753.2">If you click any of the buttons, they will move slightly downward with a nice, smooth animation. </span><span class="koboSpan" id="kobo.753.3">If you click on the rectangle, it will change color from </span><strong class="bold"><span class="koboSpan" id="kobo.754.1">blue</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.755.1">to </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.756.1">red</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.757.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.758.1">Meanwhile, the fan image will pause its animation if you click on it while it’s animating, and it will resume the animation if you click on </span><span class="No-Break"><span class="koboSpan" id="kobo.759.1">it again:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer150">
<span class="koboSpan" id="kobo.760.1"><img alt="Figure 9.27 – You can now control the animation and color of the widgets" src="image/B20976_09_027.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.761.1">Figure 9.27 – You can now control the animation and color of the widgets</span></p>
<h2 id="_idParaDest-200"><a id="_idTextAnchor200"/><span class="koboSpan" id="kobo.762.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.763.1">Most of the </span><a id="_idIndexMarker649"/><span class="koboSpan" id="kobo.764.1">animation</span><a id="_idIndexMarker650"/><span class="koboSpan" id="kobo.765.1"> elements supported by the C++ version of Qt, such as transition, sequential animation, and parallel animation, are also available in Qt Quick. </span><span class="koboSpan" id="kobo.765.2">If you are familiar with the Qt animation framework in C++, you should be able to grasp this </span><span class="No-Break"><span class="koboSpan" id="kobo.766.1">pretty easily.</span></span></p>
<p><span class="koboSpan" id="kobo.767.1">In this example, we added a spring animation element to all three buttons that specifically tracked their respective y-axes. </span><span class="koboSpan" id="kobo.767.2">If Qt detects that the y value has changed, the widget will not instantly pop to the new position; instead, it will be interpolated, move across the canvas, and perform a little shaking animation when reaching its destination that simulates the spring effect. </span><span class="koboSpan" id="kobo.767.3">We just have to write one line of code and leave the rest </span><span class="No-Break"><span class="koboSpan" id="kobo.768.1">to Qt.</span></span></p>
<p><span class="koboSpan" id="kobo.769.1">As for the fan image, we added a rotation animation element to it and set the duration to </span><strong class="source-inline"><span class="koboSpan" id="kobo.770.1">1000 milliseconds</span></strong><span class="koboSpan" id="kobo.771.1">, which means it will complete a full rotation in one second. </span><span class="koboSpan" id="kobo.771.2">We also set it to loop its animation infinitely. </span><span class="koboSpan" id="kobo.771.3">When we clicked on the mouse area widget it’s attached to, we just called </span><strong class="source-inline"><span class="koboSpan" id="kobo.772.1">pause()</span></strong><span class="koboSpan" id="kobo.773.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.774.1">resume()</span></strong><span class="koboSpan" id="kobo.775.1"> to enable or disable </span><span class="No-Break"><span class="koboSpan" id="kobo.776.1">the animation.</span></span></p>
<p><span class="koboSpan" id="kobo.777.1">Next, for the rectangle widget, we added two states to it, one called </span><strong class="bold"><span class="koboSpan" id="kobo.778.1">BLUE</span></strong><span class="koboSpan" id="kobo.779.1"> and one called </span><strong class="bold"><span class="koboSpan" id="kobo.780.1">RED</span></strong><span class="koboSpan" id="kobo.781.1">, each of which carries a </span><strong class="bold"><span class="koboSpan" id="kobo.782.1">color</span></strong><span class="koboSpan" id="kobo.783.1"> property that will be applied to the rectangle upon state change. </span><span class="koboSpan" id="kobo.783.2">At the same time, we added </span><strong class="bold"><span class="koboSpan" id="kobo.784.1">sequential animation group</span></strong><span class="koboSpan" id="kobo.785.1"> to the mouse area widget that the rectangle is attached to and then added two </span><strong class="bold"><span class="koboSpan" id="kobo.786.1">property animation</span></strong><span class="koboSpan" id="kobo.787.1"> elements to </span><a id="_idIndexMarker651"/><span class="koboSpan" id="kobo.788.1">the</span><a id="_idIndexMarker652"/><span class="koboSpan" id="kobo.789.1"> group. </span><span class="koboSpan" id="kobo.789.2">You can also mix different types of group animation; Qt can handle this </span><span class="No-Break"><span class="koboSpan" id="kobo.790.1">very well.</span></span></p>
<h1 id="_idParaDest-201"><a id="_idTextAnchor201"/><span class="koboSpan" id="kobo.791.1">Displaying information using model/view</span></h1>
<p><span class="koboSpan" id="kobo.792.1">Qt includes a </span><strong class="bold"><span class="koboSpan" id="kobo.793.1">model/view framework</span></strong><span class="koboSpan" id="kobo.794.1"> that maintains separation between the way data are </span><a id="_idIndexMarker653"/><span class="koboSpan" id="kobo.795.1">organized and managed and the way that they are presented to the user. </span><span class="koboSpan" id="kobo.795.2">In this section, we will learn how to make use of the model/view; in particular, by using the list view to display information and, at the same time, apply our own customization to make it </span><span class="No-Break"><span class="koboSpan" id="kobo.796.1">look slick.</span></span></p>
<h2 id="_idParaDest-202"><a id="_idTextAnchor202"/><span class="koboSpan" id="kobo.797.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.798.1">Let’s get started by following </span><span class="No-Break"><span class="koboSpan" id="kobo.799.1">these steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.800.1">Create a new </span><strong class="bold"><span class="koboSpan" id="kobo.801.1">Qt Quick application</span></strong><span class="koboSpan" id="kobo.802.1"> project and open up the </span><strong class="bold"><span class="koboSpan" id="kobo.803.1">Assets</span></strong><span class="koboSpan" id="kobo.804.1"> window in Qt Design Studio. </span><span class="koboSpan" id="kobo.804.2">Add six images, </span><strong class="source-inline"><span class="koboSpan" id="kobo.805.1">home.png</span></strong><span class="koboSpan" id="kobo.806.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.807.1">map.png</span></strong><span class="koboSpan" id="kobo.808.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.809.1">profile.png</span></strong><span class="koboSpan" id="kobo.810.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.811.1">search.png</span></strong><span class="koboSpan" id="kobo.812.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.813.1">settings.png</span></strong><span class="koboSpan" id="kobo.814.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.815.1">arrow.png</span></strong><span class="koboSpan" id="kobo.816.1"> to the project, </span><span class="No-Break"><span class="koboSpan" id="kobo.817.1">as follows:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer151">
<span class="koboSpan" id="kobo.818.1"><img alt="Figure 9.28 – Adding more images to the project" src="image/B20976_09_028.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.819.1">Figure 9.28 – Adding more images to the project</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.820.1">After that, create </span><a id="_idIndexMarker654"/><span class="koboSpan" id="kobo.821.1">and open </span><strong class="source-inline"><span class="koboSpan" id="kobo.822.1">Screen01.ui.qml</span></strong><span class="koboSpan" id="kobo.823.1">, as we did in all previous examples. </span><span class="koboSpan" id="kobo.823.2">Drag a </span><strong class="bold"><span class="koboSpan" id="kobo.824.1">List View</span></strong><span class="koboSpan" id="kobo.825.1"> widget from under the </span><strong class="bold"><span class="koboSpan" id="kobo.826.1">Qt Quick – Views</span></strong><span class="koboSpan" id="kobo.827.1"> category in the </span><strong class="bold"><span class="koboSpan" id="kobo.828.1">Components</span></strong><span class="koboSpan" id="kobo.829.1"> window and place it onto the canvas. </span><span class="koboSpan" id="kobo.829.2">Then, set its </span><strong class="bold"><span class="koboSpan" id="kobo.830.1">Anchors</span></strong><span class="koboSpan" id="kobo.831.1"> setting to fill the parent size by clicking on the button located in the middle of the </span><strong class="bold"><span class="koboSpan" id="kobo.832.1">Layout</span></strong><span class="koboSpan" id="kobo.833.1"> window, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.834.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer152">
<span class="koboSpan" id="kobo.835.1"><img alt="Figure 9.29 – Set the layout anchor as a fill parent" src="image/B20976_09_029.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.836.1">Figure 9.29 – Set the layout anchor as a fill parent</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.837.1">Next, switch over</span><a id="_idIndexMarker655"/><span class="koboSpan" id="kobo.838.1"> to the script editor, as we will define what the list view will look like </span><span class="No-Break"><span class="koboSpan" id="kobo.839.1">as follows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.840.1">
import QtQuick
Rectangle {
    id: rectangle1
    property alias listView1: listView1
    property double sizeMultiplier: width / 480</span></pre></li> <li><span class="koboSpan" id="kobo.841.1">We will continue to write the code by adding the following </span><span class="No-Break"><span class="koboSpan" id="kobo.842.1">list view:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.843.1">
    ListView {
        id: listView1
        y: 0
        height: 160
        orientation: ListView.Vertical
        boundsBehavior: Flickable.StopAtBounds
        anchors.fill: parent
        delegate: Item {
            width: 80 * sizeMultiplier
            height: 55 * sizeMultiplier</span></pre></li> <li><span class="koboSpan" id="kobo.844.1">We will continue to add rows to the list view, </span><span class="No-Break"><span class="koboSpan" id="kobo.845.1">as follows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.846.1">
            Row {
                id: row1
                Rectangle {
                    width: listView1.width
                    height: 55 * sizeMultiplier
                    gradient: Gradient {
                        GradientStop { position: 0.0; color: "#ffffff" }
                        GradientStop { position: 1.0; color: "#f0f0f0" }
                    }
                    opacity: 1.0</span></pre></li> <li><span class="koboSpan" id="kobo.847.1">We then add a</span><a id="_idIndexMarker656"/><span class="koboSpan" id="kobo.848.1"> mouse area and an image, as shown in the following </span><span class="No-Break"><span class="koboSpan" id="kobo.849.1">code snippet:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.850.1">
                    MouseArea {
                        id: mouseArea
                        anchors.fill: parent
                    }
                    Image {
                        anchors.verticalCenter: parent.verticalCenter
                        x: 15 * sizeMultiplier
                        width: 30 * sizeMultiplier
                        height: 30 * sizeMultiplier
                        source: icon
                    }</span></pre></li> <li><span class="koboSpan" id="kobo.851.1">Then, continue </span><a id="_idIndexMarker657"/><span class="koboSpan" id="kobo.852.1">to add two text objects, </span><span class="No-Break"><span class="koboSpan" id="kobo.853.1">as follows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.854.1">
                    Text {
                        text: title
                        font.family: "Courier"
                        font.pixelSize: 17 * sizeMultiplier
                        x: 55 * sizeMultiplier
                        y: 10 * sizeMultiplier
                    }
                    Text {
                        text: subtitle
                        font.family: "Verdana"
                        font.pixelSize: 9 * sizeMultiplier
                        x: 55 * sizeMultiplier
                        y: 30 * sizeMultiplier
                    }</span></pre></li> <li><span class="koboSpan" id="kobo.855.1">After that, add an image object, </span><span class="No-Break"><span class="koboSpan" id="kobo.856.1">as follows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.857.1">
                    Image {
                        anchors.verticalCenter: parent.verticalCenter
                        x: parent.width - 35 * sizeMultiplier
                        width: 30 * sizeMultiplier
                        height: 30 * sizeMultiplier
                        source: "images/arrow.png"
                    }
                }
            }
        }</span></pre></li> <li><span class="koboSpan" id="kobo.858.1">Using the following code, we will then define the </span><span class="No-Break"><span class="koboSpan" id="kobo.859.1">list model:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.860.1">
        model: ListModel {
            ListElement {
                title: "Home"
                subtitle: "Go back to dashboard"
                icon: "images/home.png"
            }
            ListElement {
                title: "Map"
                subtitle: "Help navigate to your destination"
                icon: "images/map.png"
            }</span></pre></li> <li><span class="koboSpan" id="kobo.861.1">We will </span><a id="_idIndexMarker658"/><span class="koboSpan" id="kobo.862.1">continue to write </span><span class="No-Break"><span class="koboSpan" id="kobo.863.1">the code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.864.1">
            ListElement {
                title: "Profile"
                subtitle: "Customize your profile picture"
                icon: "images/profile.png"
            }
            ListElement {
                title: "Search"
                subtitle: "Search for nearby places"
                icon: "images/search.png"
            }</span></pre></li> <li><span class="koboSpan" id="kobo.865.1">We will now add the final list element, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.866.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.867.1">
            ListElement {
                title: "Settings"
                subtitle: "Customize your app settings"
                icon: "images/settings.png"
            }
        }
    }
}</span></pre></li> <li><span class="koboSpan" id="kobo.868.1">After that, open</span><a id="_idIndexMarker659"/><span class="koboSpan" id="kobo.869.1"> up </span><strong class="source-inline"><span class="koboSpan" id="kobo.870.1">App.qml</span></strong><span class="koboSpan" id="kobo.871.1"> and replace the code with </span><span class="No-Break"><span class="koboSpan" id="kobo.872.1">the following:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.873.1">
import QtQuick
import QtQuick.Window
Window {
    visible: true
    width: 480
    height: 480
    Screen01 {
        anchors.fill: parent
            MouseArea {
                onPressed: row1.opacity = 0.5
                onReleased: row1.opacity = 1.0
            }
        }
}</span></pre></li> <li><span class="koboSpan" id="kobo.874.1">Build and run the program, and now your program should look </span><span class="No-Break"><span class="koboSpan" id="kobo.875.1">like this:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer153">
<span class="koboSpan" id="kobo.876.1"><img alt="Figure 9.30 – Navigation menu with different fonts and icons" src="image/B20976_09_030.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.877.1">Figure 9.30 – Navigation menu with different fonts and icons</span></p>
<h2 id="_idParaDest-203"><a id="_idTextAnchor203"/><span class="koboSpan" id="kobo.878.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.879.1">Qt Quick allows us </span><a id="_idIndexMarker660"/><span class="koboSpan" id="kobo.880.1">to customize the look of each row of the list view with ease. </span><span class="koboSpan" id="kobo.880.2">The delegate defines what each row will look like, and the model is where you store the data that will be displayed on the </span><span class="No-Break"><span class="koboSpan" id="kobo.881.1">list view.</span></span></p>
<p><span class="koboSpan" id="kobo.882.1">In this example, we added a background with a gradient on each row, and then we also added an icon on each side of the item, a title, a description, and a mouse area widget that makes each row of the list view clickable. </span><span class="koboSpan" id="kobo.882.2">The delegate is not static, as we allow the model to change the title, description, and icon to make each row </span><span class="No-Break"><span class="koboSpan" id="kobo.883.1">look unique.</span></span></p>
<p><span class="koboSpan" id="kobo.884.1">In </span><strong class="source-inline"><span class="koboSpan" id="kobo.885.1">App.qml</span></strong><span class="koboSpan" id="kobo.886.1">, we defined the behavior of the mouse area widget that will halve its own opacity value when pressed and return to fully opaque when released. </span><span class="koboSpan" id="kobo.886.2">Since all other elements, such as title and icon, are all the children of the mouse area widget, all will also automatically follow their parent widget’s behavior and </span><span class="No-Break"><span class="koboSpan" id="kobo.887.1">become semi-transparent.</span></span></p>
<p><span class="koboSpan" id="kobo.888.1">Additionally, we have finally solved the display problem on mobile devices with high resolution and DPI. </span><span class="koboSpan" id="kobo.888.2">It’s a very simple trick; first, we defined a variable called </span><strong class="source-inline"><span class="koboSpan" id="kobo.889.1">sizeMultiplier</span></strong><span class="koboSpan" id="kobo.890.1">. </span><span class="koboSpan" id="kobo.890.2">The value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.891.1">sizeMultiplier</span></strong><span class="koboSpan" id="kobo.892.1"> is the result of dividing the width of the window by a predefined value, say 480, which is the current window width we used for the PC. </span><span class="koboSpan" id="kobo.892.2">Then, multiply </span><strong class="source-inline"><span class="koboSpan" id="kobo.893.1">sizeMultiplier</span></strong><span class="koboSpan" id="kobo.894.1"> by all the widget variables that are related to size and position, including font size. </span><span class="koboSpan" id="kobo.894.2">Do note that, in this case, you should use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.895.1">pixelSize</span></strong><span class="koboSpan" id="kobo.896.1"> property for text instead of </span><strong class="source-inline"><span class="koboSpan" id="kobo.897.1">pointSize</span></strong><span class="koboSpan" id="kobo.898.1">, so that you will get the correct display when multiplying by </span><strong class="source-inline"><span class="koboSpan" id="kobo.899.1">sizeMultiplier</span></strong><span class="koboSpan" id="kobo.900.1">. </span><span class="koboSpan" id="kobo.900.2">The following screenshot shows you what the app</span><a id="_idIndexMarker661"/><span class="koboSpan" id="kobo.901.1"> looks like on the mobile device with and </span><span class="No-Break"><span class="koboSpan" id="kobo.902.1">without </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.903.1">sizeMultiplier</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.904.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer154">
<span class="koboSpan" id="kobo.905.1"><img alt="Figure 9.31 – Correcting size using size multiplier" src="image/B20976_09_031.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.906.1">Figure 9.31 – Correcting size using size multiplier</span></p>
<p><span class="koboSpan" id="kobo.907.1">Notice that you may get a messed-up user interface in the editor once you multiply everything by the </span><strong class="source-inline"><span class="koboSpan" id="kobo.908.1">sizeMultiplier</span></strong><span class="koboSpan" id="kobo.909.1"> variable. </span><span class="koboSpan" id="kobo.909.2">This is because the width variable may return as </span><strong class="source-inline"><span class="koboSpan" id="kobo.910.1">0</span></strong><span class="koboSpan" id="kobo.911.1"> in the editor. </span><span class="koboSpan" id="kobo.911.2">Hence, by multiplying 0 by 480, you may get the result </span><strong class="source-inline"><span class="koboSpan" id="kobo.912.1">0</span></strong><span class="koboSpan" id="kobo.913.1">, which makes the entire user interface look funny. </span><span class="koboSpan" id="kobo.913.2">However, it will look fine when running the actual program. </span><span class="koboSpan" id="kobo.913.3">If you want to preview the user interface on the editor, temporarily</span><a id="_idIndexMarker662"/><span class="koboSpan" id="kobo.914.1"> set </span><strong class="bold"><span class="koboSpan" id="kobo.915.1">sizeMultiplier</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.916.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.917.1">1</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.918.1">.</span></span></p>
<h1 id="_idParaDest-204"><a id="_idTextAnchor204"/><span class="koboSpan" id="kobo.919.1">Integrating QML and C++</span></h1>
<p><span class="koboSpan" id="kobo.920.1">Qt supports</span><a id="_idIndexMarker663"/><span class="koboSpan" id="kobo.921.1"> bridging between C++ classes with the QML engine. </span><span class="koboSpan" id="kobo.921.2">This combination allows developers to take advantage of both the simplicity of QML and the flexibility of C++. </span><span class="koboSpan" id="kobo.921.3">You can even integrate features that are not supported by Qt from external components, then pass the resulting data to Qt Quick to be displayed in the UI. </span><span class="koboSpan" id="kobo.921.4">In this example, we will learn how to export our user interface components from QML to the C++ framework and manipulate their properties before displaying them </span><span class="No-Break"><span class="koboSpan" id="kobo.922.1">on screen.</span></span></p>
<h2 id="_idParaDest-205"><a id="_idTextAnchor205"/><span class="koboSpan" id="kobo.923.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.924.1">Let’s go through the </span><span class="No-Break"><span class="koboSpan" id="kobo.925.1">following steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.926.1">Once again, we will start everything from scratch. </span><span class="koboSpan" id="kobo.926.2">Therefore, create a new </span><strong class="bold"><span class="koboSpan" id="kobo.927.1">Qt Quick application</span></strong><span class="koboSpan" id="kobo.928.1"> project in Qt Creator and open up </span><strong class="source-inline"><span class="koboSpan" id="kobo.929.1">Screen01.ui.qml</span></strong><span class="koboSpan" id="kobo.930.1"> with Qt Design Studio. </span><span class="koboSpan" id="kobo.930.2">Then, open </span><span class="No-Break"><span class="koboSpan" id="kobo.931.1">up </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.932.1">Screen01.ui.qml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.933.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.934.1">We can keep the mouse area and text widget but place the text widget at the bottom of the window. </span><span class="koboSpan" id="kobo.934.2">Change the </span><strong class="source-inline"><span class="koboSpan" id="kobo.935.1">Text</span></strong><span class="koboSpan" id="kobo.936.1"> property of the text widget to </span><strong class="bold"><span class="koboSpan" id="kobo.937.1">Change this text</span></strong><span class="koboSpan" id="kobo.938.1"> using C++ and set its </span><strong class="bold"><span class="koboSpan" id="kobo.939.1">font size</span></strong><span class="koboSpan" id="kobo.940.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.941.1">18</span></strong><span class="koboSpan" id="kobo.942.1">. </span><span class="koboSpan" id="kobo.942.2">After that, go to the </span><strong class="bold"><span class="koboSpan" id="kobo.943.1">Layout</span></strong><span class="koboSpan" id="kobo.944.1"> tab and enable both </span><strong class="bold"><span class="koboSpan" id="kobo.945.1">Vertical center anchor</span></strong><span class="koboSpan" id="kobo.946.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.947.1">Horizontal center anchor</span></strong><span class="koboSpan" id="kobo.948.1"> to ensure it’s always somewhere in the middle of the window, regardless of how you rescale the window. </span><span class="koboSpan" id="kobo.948.2">Set the </span><strong class="bold"><span class="koboSpan" id="kobo.949.1">Margin</span></strong><span class="koboSpan" id="kobo.950.1"> for the </span><strong class="bold"><span class="koboSpan" id="kobo.951.1">Vertical center anchor</span></strong><span class="koboSpan" id="kobo.952.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.953.1">120</span></strong><span class="koboSpan" id="kobo.954.1">, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.955.1">following screenshot:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer155">
<span class="koboSpan" id="kobo.956.1"><img alt="Figure 9.32 – Place it at the center of the layout" src="image/B20976_09_032.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.957.1">Figure 9.32 – Place it at the center of the layout</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.958.1">Next, drag a rectangle widget from the </span><strong class="bold"><span class="koboSpan" id="kobo.959.1">Components</span></strong><span class="koboSpan" id="kobo.960.1"> window to the canvas and set its color to </span><strong class="source-inline"><span class="koboSpan" id="kobo.961.1">#ff0d0d</span></strong><span class="koboSpan" id="kobo.962.1">. </span><span class="koboSpan" id="kobo.962.2">Set its </span><strong class="bold"><span class="koboSpan" id="kobo.963.1">Width</span></strong><span class="koboSpan" id="kobo.964.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.965.1">Height</span></strong><span class="koboSpan" id="kobo.966.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.967.1">200</span></strong><span class="koboSpan" id="kobo.968.1"> and enable both the vertical </span><a id="_idIndexMarker664"/><span class="koboSpan" id="kobo.969.1">and horizontal center anchor. </span><span class="koboSpan" id="kobo.969.2">After that, set the </span><strong class="bold"><span class="koboSpan" id="kobo.970.1">Margin</span></strong><span class="koboSpan" id="kobo.971.1"> of the horizontal center anchor to </span><strong class="source-inline"><span class="koboSpan" id="kobo.972.1">-14</span></strong><span class="koboSpan" id="kobo.973.1">. </span><span class="koboSpan" id="kobo.973.2">Your UI should now look something </span><span class="No-Break"><span class="koboSpan" id="kobo.974.1">like this:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer156">
<span class="koboSpan" id="kobo.975.1"><img alt="Figure 9.33 – Place the square and text as they are positioned in this image" src="image/B20976_09_033.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.976.1">Figure 9.33 – Place the square and text as they are positioned in this image</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.977.1">Once you are done with that, right-click on your project</span><a id="_idIndexMarker665"/><span class="koboSpan" id="kobo.978.1"> directory in </span><strong class="bold"><span class="koboSpan" id="kobo.979.1">Qt Creator</span></strong><span class="koboSpan" id="kobo.980.1"> and choose </span><strong class="bold"><span class="koboSpan" id="kobo.981.1">File | New File...</span></strong><span class="koboSpan" id="kobo.982.1">. </span><span class="koboSpan" id="kobo.982.2">Then, a window will pop up and let you pick a file template. </span><span class="koboSpan" id="kobo.982.3">Select </span><strong class="bold"><span class="koboSpan" id="kobo.983.1">C++ Class</span></strong><span class="koboSpan" id="kobo.984.1"> and press </span><strong class="bold"><span class="koboSpan" id="kobo.985.1">Choose…</span></strong><span class="koboSpan" id="kobo.986.1">. </span><span class="koboSpan" id="kobo.986.2">After that, it will ask you to define the C++ class by filling in the information for the class. </span><span class="koboSpan" id="kobo.986.3">In this case, insert </span><strong class="bold"><span class="koboSpan" id="kobo.987.1">MyClass</span></strong><span class="koboSpan" id="kobo.988.1"> in the </span><strong class="bold"><span class="koboSpan" id="kobo.989.1">Class Name</span></strong><span class="koboSpan" id="kobo.990.1"> field and select </span><strong class="bold"><span class="koboSpan" id="kobo.991.1">QObject</span></strong><span class="koboSpan" id="kobo.992.1"> as the </span><strong class="bold"><span class="koboSpan" id="kobo.993.1">Base class</span></strong><span class="koboSpan" id="kobo.994.1">. </span><span class="koboSpan" id="kobo.994.2">Then, make sure the </span><strong class="bold"><span class="koboSpan" id="kobo.995.1">Include</span></strong> <strong class="bold"><span class="koboSpan" id="kobo.996.1">QObject</span></strong><span class="koboSpan" id="kobo.997.1"> option is ticked, and you can now click the </span><strong class="bold"><span class="koboSpan" id="kobo.998.1">Next</span></strong><span class="koboSpan" id="kobo.999.1"> button, followed by the </span><strong class="bold"><span class="koboSpan" id="kobo.1000.1">Finish</span></strong><span class="koboSpan" id="kobo.1001.1"> button. </span><span class="koboSpan" id="kobo.1001.2">Two files—</span><strong class="source-inline"><span class="koboSpan" id="kobo.1002.1">myclass.h</span></strong><span class="koboSpan" id="kobo.1003.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1004.1">myclass.cpp</span></strong><span class="koboSpan" id="kobo.1005.1">—will </span><a id="_idIndexMarker666"/><span class="koboSpan" id="kobo.1006.1">now be created and added to </span><span class="No-Break"><span class="koboSpan" id="kobo.1007.1">your project:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer157">
<span class="koboSpan" id="kobo.1008.1"><img alt="Figure 9.34 – Create a new custom class" src="image/B20976_09_034.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1009.1">Figure 9.34 – Create a new custom class</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.1010.1">Now, open up </span><strong class="source-inline"><span class="koboSpan" id="kobo.1011.1">myclass.h</span></strong><span class="koboSpan" id="kobo.1012.1"> and add a variable and function under the class constructor, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1013.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1014.1">
#ifndef MYCLASS_H
#define MYCLASS_H
#include &lt;QObject&gt;
class MyClass : public QObject
{
    Q_OBJECT
public:
    explicit MyClass(QObject *parent = 0);
    // Object pointer
    QObject* my Object;
    // Must call Q_INVOKABLE so that this function can be used in QML
    Q_INVOKABLE void setMyObject(QObject* obj);
};
#endif // MYCLASS_H</span></pre></li> <li><span class="koboSpan" id="kobo.1015.1">After that, open</span><a id="_idIndexMarker667"/><span class="koboSpan" id="kobo.1016.1"> up </span><strong class="source-inline"><span class="koboSpan" id="kobo.1017.1">myclass.cpp</span></strong><span class="koboSpan" id="kobo.1018.1"> and define the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1019.1">setMyObject()</span></strong><span class="koboSpan" id="kobo.1020.1"> function, </span><span class="No-Break"><span class="koboSpan" id="kobo.1021.1">as follows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1022.1">
#include "myclass.h"
MyClass::MyClass(QObject *parent) : Qobject(parent)
{
}
void MyClass::setMyObject(Qobject* obj)
{
    // Set the object pointer
    my Object = obj;
}</span></pre></li> <li><span class="koboSpan" id="kobo.1023.1">We can now close </span><strong class="source-inline"><span class="koboSpan" id="kobo.1024.1">myclass.cpp</span></strong><span class="koboSpan" id="kobo.1025.1"> and open up </span><strong class="source-inline"><span class="koboSpan" id="kobo.1026.1">App.qml</span></strong><span class="koboSpan" id="kobo.1027.1">. </span><span class="koboSpan" id="kobo.1027.2">At the top of the file, import the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1028.1">MyClassLib</span></strong><span class="koboSpan" id="kobo.1029.1"> components that we just created </span><span class="No-Break"><span class="koboSpan" id="kobo.1030.1">in C++:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1031.1">
import QtQuick
import QtQuick.Window
</span><strong class="bold"><span class="koboSpan" id="kobo.1032.1">import MyClassLib</span></strong></pre></li> <li><span class="koboSpan" id="kobo.1033.1">Then, define </span><strong class="source-inline"><span class="koboSpan" id="kobo.1034.1">MyClass</span></strong><span class="koboSpan" id="kobo.1035.1"> in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1036.1">Window</span></strong><span class="koboSpan" id="kobo.1037.1"> object and call its </span><strong class="source-inline"><span class="koboSpan" id="kobo.1038.1">setMyObject()</span></strong><span class="koboSpan" id="kobo.1039.1"> function within the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1040.1">MainForm</span></strong><span class="koboSpan" id="kobo.1041.1"> object, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1042.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1043.1">
Window {
    visible: true
    width: 480
    height: 320
    MyClass {
        id: myclass
    }
    Screen01 {
        anchors.fill: parent
        mouseArea.onClicked: {
            Qt.quit();
        }
        </span><strong class="bold"><span class="koboSpan" id="kobo.1044.1">Component.onCompleted:</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1045.1">myclass.setMyObject(messageText);</span></strong><span class="koboSpan" id="kobo.1046.1">
    }
}</span></pre></li> <li><span class="koboSpan" id="kobo.1047.1">Lastly, open </span><a id="_idIndexMarker668"/><span class="koboSpan" id="kobo.1048.1">up </span><strong class="source-inline"><span class="koboSpan" id="kobo.1049.1">main.cpp</span></strong><span class="koboSpan" id="kobo.1050.1"> and register the custom class to the QML engine. </span><span class="koboSpan" id="kobo.1050.2">We will also change the properties of the text widget and the rectangle here using C++ code, </span><span class="No-Break"><span class="koboSpan" id="kobo.1051.1">as follows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1052.1">
#include &lt;QGuiApplication&gt;
#include &lt;QQmlApplicationEngine&gt;
#include &lt;QtQml&gt;
#include &lt;QQuickView&gt;
#include &lt;QQuickItem&gt;
#include &lt;QQuickView&gt;
#include "myclass.h"
int main(int argc, char *argv[])
{
    // Register your class to QML
    qmlRegisterType&lt;MyClass&gt;("MyClassLib", 1, 0, "MyClass");</span></pre></li> <li><span class="koboSpan" id="kobo.1053.1">Then, proceed to create the objects, just like the highlighted section in the </span><span class="No-Break"><span class="koboSpan" id="kobo.1054.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1055.1">
    QGuiApplication app(argc, argv);
    QQmlApplicationEngine engine;
    engine.load(QUrl(QStringLiteral("qrc:/content/App.qml")));
    QObject* root = engine.rootObjects().value(0);
    QObject* messageText =
root-&gt;findChild&lt;QObject*&gt;("messageText");
    messageText-&gt;setProperty("text", QVariant("C++ is now in control!"));
    messageText-&gt;setProperty("color", QVariant("green"));
    QObject* square = root-&gt;findChild&lt;QObject*&gt;("square");
    square-&gt;setProperty("color", QVariant("blue"));
    return app.exec();
}</span></pre></li> <li><span class="koboSpan" id="kobo.1056.1">Now, build and run </span><a id="_idIndexMarker669"/><span class="koboSpan" id="kobo.1057.1">the program, and you should see that the colors of the rectangle and the text are completely different from what you defined earlier in Qt Quick, as shown in the following screenshot. </span><span class="koboSpan" id="kobo.1057.2">This is because their properties have been changed by the </span><span class="No-Break"><span class="koboSpan" id="kobo.1058.1">C++ code:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer158">
<span class="koboSpan" id="kobo.1059.1"><img alt="Figure 9.35 – Text and color can now be changed by C++" src="image/B20976_09_035.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1060.1">Figure 9.35 – Text and color can now be changed by C++</span></p>
<h2 id="_idParaDest-206"><a id="_idTextAnchor206"/><span class="koboSpan" id="kobo.1061.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.1062.1">QML is designed to be easily extendable through C++ code. </span><span class="koboSpan" id="kobo.1062.2">The classes in the Qt QML module enable QML</span><a id="_idIndexMarker670"/><span class="koboSpan" id="kobo.1063.1"> objects to be loaded and manipulated </span><span class="No-Break"><span class="koboSpan" id="kobo.1064.1">from C++.</span></span></p>
<p><span class="koboSpan" id="kobo.1065.1">Only classes that are inherited from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1066.1">QObject</span></strong><span class="koboSpan" id="kobo.1067.1"> base class can be integrated with QML, as it is part of the Qt ecosystem. </span><span class="koboSpan" id="kobo.1067.2">Once the class has been registered with the QML engine, we get the root item from the QML engine and use it to find the objects we want </span><span class="No-Break"><span class="koboSpan" id="kobo.1068.1">to manipulate.</span></span></p>
<p><span class="koboSpan" id="kobo.1069.1">After that, use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1070.1">setProperty()</span></strong><span class="koboSpan" id="kobo.1071.1"> function to change any of the properties belonging to the widget. </span><span class="koboSpan" id="kobo.1071.2">Other than </span><strong class="source-inline"><span class="koboSpan" id="kobo.1072.1">setProperty()</span></strong><span class="koboSpan" id="kobo.1073.1">, you may also use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1074.1">Q_PROPERTY()</span></strong><span class="koboSpan" id="kobo.1075.1"> macro in a class that inherits </span><strong class="source-inline"><span class="koboSpan" id="kobo.1076.1">QObject</span></strong><span class="koboSpan" id="kobo.1077.1"> to declare a property. </span><span class="koboSpan" id="kobo.1077.2">Here is </span><span class="No-Break"><span class="koboSpan" id="kobo.1078.1">an example:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.1079.1">
Q_PROPERTY(QString text MEMBER m_text NOTIFY textChanged)</span></pre> <p><span class="koboSpan" id="kobo.1080.1">Notice that the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1081.1">Q_INVOKABLE</span></strong><span class="koboSpan" id="kobo.1082.1"> macro needs to be placed in front of the function that you intend to call in QML. </span><span class="koboSpan" id="kobo.1082.2">Without it, Qt will not expose the function to Qt Quick, and you will not be able to </span><span class="No-Break"><span class="koboSpan" id="kobo.1083.1">call it.</span></span></p>
</div>
</body></html>