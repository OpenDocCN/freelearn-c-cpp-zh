<html><head></head><body>
<div><h1 class="chapter-number" id="_idParaDest-185"><a id="_idTextAnchor185"/>9</h1>
<h1 id="_idParaDest-186"><a id="_idTextAnchor186"/>Building a Touch Screen Application with Qt 6</h1>
<p>Qt is not only a cross-platform software development kit for PC platforms; it also supports mobile platforms, such as iOS and Android. The developers of Qt introduced <strong class="bold">Qt Quick</strong> back in <a id="_idIndexMarker571"/>2010, which provides an easy way to build custom user interfaces that are highly dynamic, where users can easily create fluid transitions and effects with only minimal coding.</p>
<p>Qt Quick uses a declarative scripting language<a id="_idIndexMarker572"/> called <strong class="bold">QML</strong>, which is similar to the <strong class="bold">JavaScript</strong> language<a id="_idIndexMarker573"/> used in web development. Advanced users can also create custom functions in C++ and port them over to Qt Quick to enhance their functionality. At the moment, Qt Quick supports multiple platforms, such as Windows, Linux, macOS, iOS, and Android.</p>
<p>This chapter will cover the following recipes:</p>
<ul>
<li>Setting up Qt for mobile applications</li>
<li>Designing a basic user interface with QML</li>
<li>Touch events</li>
<li>Animation in QML</li>
<li>Displaying information using model/view</li>
<li>Integrating QML and C++</li>
</ul>
<h1 id="_idParaDest-187"><a id="_idTextAnchor187"/>Technical requirements</h1>
<p>The technical requirements for this chapter include Qt 6.6.1, Qt Creator 12.0.2, Android <strong class="bold">Software Development Kit</strong> (<strong class="bold">SDK</strong>), Android <strong class="bold">Native Development Kit</strong> (<strong class="bold">NDK</strong>), <strong class="bold">Java Development Kit</strong> (<strong class="bold">JDK</strong>), and Apache Ant. All the code used in this chapter can be downloaded from the following GitHub repository: <a href="https://github.com/PacktPublishing/QT6-C-GUI-Programming-Cookbook---Third-Edition-/tree/main/Chapter09">https://github.com/PacktPublishing/QT6-C-GUI-Programming-Cookbook---Third-Edition-/tree/main/Chapter09</a>.</p>
<h1 id="_idParaDest-188"><a id="_idTextAnchor188"/>Setting up Qt for mobile applications</h1>
<p>In this <a id="_idIndexMarker574"/>example, we <a id="_idIndexMarker575"/>will learn how to set up our Qt project in Qt Quick and enable it to be built and exported to mobile devices.</p>
<h2 id="_idParaDest-189"><a id="_idTextAnchor189"/>How to do it…</h2>
<p>Let’s get started and learn how to create our first mobile application using Qt 6:</p>
<ol>
<li>First of all, let’s create a new project by going to <strong class="bold">File</strong> | <strong class="bold">New Project…</strong>. Then, a window will pop up for you to choose a project template. Select <strong class="bold">Qt Quick Application</strong> and click the <strong class="bold">Choose...</strong> button, as shown in the following screenshot:</li>
</ol>
<div><div><img alt="Figure 9.1 – Create a Qt Quick application project" src="img/B20976_09_001.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.1 – Create a Qt Quick application project</p>
<ol>
<li value="2">After that, insert the project name and select the project location. Click the <strong class="bold">Next</strong> button, and it will ask you to select the minimum Qt version required for your project.</li>
</ol>
<p class="callout-heading">Important note</p>
<p class="callout">Please make sure that you select a version that exists on your computer. Otherwise, you won’t be able to run it properly.</p>
<ol>
<li value="3">Once you have done that, proceed by clicking the <strong class="bold">Next</strong> button.</li>
<li>Then, Qt Creator will ask you which kit you want to use for your project. These <strong class="bold">kits</strong> are <a id="_idIndexMarker576"/>basically <a id="_idIndexMarker577"/>different compilers that you can use to compile your project for different platforms. Since we’re making an application for a mobile platform, we will enable the Android kit (or the iOS kit if you’re running a Mac) to build and export your app to your mobile device, as shown in the following screenshot. You can also enable one of the desktop kits so you can test your program on the desktop beforehand. Do note that you need to configure the Android kit if you’re using it for the first time so that Qt can find the directory of the Android SDK. Click <strong class="bold">Next</strong> once you’re done with it:</li>
</ol>
<div><div><img alt="Figure 9.2 – Create an Android Kit for this project" src="img/B20976_09_002.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.2 – Create an Android Kit for this project</p>
<ol>
<li value="5">Once the project has been created, Qt Creator will automatically open up a file from your project called <code>Main.qml</code>. You will see a different type of script, as shown in the<a id="_idIndexMarker578"/> following<a id="_idIndexMarker579"/> code, that is very different from your usual C/C++ projects:<pre class="source-code">
import QtQuick
import QtQuick.Window
Window {
    visible: true
    width: 640
    height: 480
    title: qsTr("Hello World")
}</pre></li> <li>Build and run the project now by clicking on the green arrow button located at the bottom-left corner of your Qt Creator, as shown in <em class="italic">Figure 9</em><em class="italic">.3</em>. If you set the default kit to one of the desktop kits, an empty window will pop up once the project has been compiled:</li>
</ol>
<div><div><img alt="Figure 9.3 – Press the triangle button to build and run" src="img/B20976_09_003.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.3 – Press the triangle button to build and run</p>
<ol>
<li value="7">As shown in the <a id="_idIndexMarker580"/>next<a id="_idIndexMarker581"/> screenshot, We can switch between different kits by going to the Projects interface and selecting the kit you want your project to be built with. You can also manage all the kits available on your computer or add a new kit to your project from the <strong class="bold">Projects</strong> interface:</li>
</ol>
<div><div><img alt="Figure 9.4 – Change to any kits in the Projects interface" src="img/B20976_09_004.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.4 – Change to any kits in the Projects interface</p>
<ol>
<li value="8">If this is your first<a id="_idIndexMarker582"/> time<a id="_idIndexMarker583"/> building and running your project, you need to create a template for the Android kit under the <strong class="bold">Build</strong> settings. Once you have clicked the <strong class="bold">Create Templates</strong> button under the <strong class="bold">Build Android APK</strong> tab, as shown in <em class="italic">Figure 9</em><em class="italic">.5</em>, Qt will generate all the files required to run your app on an Android device. If you don’t plan to use Gradle in your project, disable the <strong class="bold">Copy the Gradle files to Android directory</strong> option. Otherwise, you may encounter problems when trying to compile and deploy your app to your mobile device:</li>
</ol>
<div><div><img alt="Figure 9.5 – Click the Create Templates button to create an Android template file" src="img/B20976_09_005.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.5 – Click the Create Templates button to create an Android template file</p>
<ol>
<li value="9">Once you <a id="_idIndexMarker584"/>click <a id="_idIndexMarker585"/>the <code>AndroidManifest.xml</code>, Gradle-related files, and other resources that are required by the Android platform. Let’s open up the <code>AndroidManifest.xml</code> file:</li>
</ol>
<div><div><img alt="Figure 9.6 – Set your app’s settings in AndroidManifest.xml" src="img/B20976_09_006.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.6 – Set your app’s settings in AndroidManifest.xml</p>
<ol>
<li value="10">Once you have opened <code>AndroidManifest.xml</code>, you can set your app’s package name, version code, app icon, and permissions before exporting the app. To build and test your Android app, click on the <strong class="bold">Run</strong> button on Qt Creator. You should now see the following window pop up, asking which device it should export to.</li>
<li>Select the device that<a id="_idIndexMarker586"/> is <a id="_idIndexMarker587"/>currently connected to your computer and press the <strong class="bold">OK</strong> button. Wait for a while for it to build the project, and you should be able to get a blank app running on your mobile device.</li>
</ol>
<h2 id="_idParaDest-190"><a id="_idTextAnchor190"/>How it works…</h2>
<p>A Qt Quick application project is quite different from a widget application project. You will be writing<a id="_idIndexMarker588"/> QML<a id="_idIndexMarker589"/> script most of the time instead of writing C/C++ code. <strong class="bold">Android Software Development Kit</strong> (<strong class="bold">SDK</strong>), <strong class="bold">Android Native Development Kit</strong> (<strong class="bold">NDK</strong>), <strong class="bold">Java Development Kit</strong> (<strong class="bold">JDK</strong>), and <strong class="bold">Apache Ant</strong> are required to build and export <a id="_idIndexMarker590"/>your <a id="_idIndexMarker591"/>app to the Android platform.</p>
<p>Alternatively, you can also use Gradle instead of Apache Ant for your Android kit. All you need to do is enable the <strong class="bold">Use Gradle</strong> instead of Ant option and provide Qt with Gradle’s installation path. Note that Android Studio is currently (at the time of authoring this book) not supported by Qt Creator:</p>
<div><div><img alt="Figure 9.7 – Set up your Android settings in the Android tab in the Preferences window" src="img/B20976_09_007.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.7 – Set up your Android settings in the Android tab in the Preferences window</p>
<p>If you’re running the app on<a id="_idIndexMarker592"/> an <a id="_idIndexMarker593"/>Android device, make sure that you have <strong class="bold">USB debugging mode</strong> enabled. To enable USB debugging mode, you need to first enable the developer options on your Android device by going to <strong class="bold">Settings | About Phone</strong> and tapping <strong class="bold">Build Number</strong> seven times. After that, go to <strong class="bold">Settings | Developer Options</strong>, and you will see the <strong class="bold">USB debugging</strong> option in the menu. Enable that option, and you can now export your app to your device for testing.</p>
<p>To build for the iOS platform, you need to run Qt Creator on a Mac and make sure the latest <strong class="bold">Xcode</strong> is installed on your Mac as well. To test your app on an iOS device, you need to register a developer account with Apple, register your device at the developer portal, and install the provisioning to your <strong class="bold">Xcode</strong>, which is a lot trickier than Android. You will be given access <a id="_idIndexMarker594"/>to<a id="_idIndexMarker595"/> the developer portal once you have obtained a developer account from Apple.</p>
<h1 id="_idParaDest-191"><a id="_idTextAnchor191"/>Designing a basic user interface with QML</h1>
<p>This example<a id="_idIndexMarker596"/> will teach us how to use Qt Design Studio to design our program’s user interface.</p>
<h2 id="_idParaDest-192"><a id="_idTextAnchor192"/>How to do it…</h2>
<p>Let’s follow these steps to get started:</p>
<ol>
<li>First of all, create a new <strong class="bold">Qt Quick application</strong> project, just like we did in the previous recipe. This time, however, make sure you check on the <strong class="bold">Creates a project that you can open in Qt Design Studio</strong> option as well:</li>
</ol>
<div><div><img alt="Figure 9.8 – Make sure your project can be opened by Qt Design Studio" src="img/B20976_09_008.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.8 – Make sure your project can be opened by Qt Design Studio</p>
<ol>
<li value="2">You will see a QML file in your project resources called <code>main.qml</code>. This is where we implement the logic for our application, but we will also need another QML file where we define our user interface.</li>
<li>Before we proceed to design our program’s user interface, let’s download and install <strong class="bold">Qt Design Studio</strong> from Qt’s <a id="_idIndexMarker597"/>official website: <a href="https://www.qt.io/product/ui-design-tools">https://www.qt.io/product/ui-design-tools</a>. This is a new editor created by Qt for UI/UX designers to design user interfaces for their Qt Quick projects.</li>
<li>Once you have installed <code>.qmlproject</code> file in<a id="_idIndexMarker598"/> your project directory by pressing the <strong class="bold">Open </strong><strong class="bold">Project…</strong> button:</li>
</ol>
<div><div><img alt="Figure 9.9 – Click the Open Project … button" src="img/B20976_09_009.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.9 – Click the Open Project … button</p>
<ol>
<li value="5">After that, a default QML UI file called <code>Sreen01.ui.qml</code> will be opened by <strong class="bold">Qt Design Studio</strong>. You will see an entirely different user interface editor compared to the one we used in previous chapters.</li>
<li>Since Qt 6, the Qt team released the <strong class="bold">Qt Design Studio</strong>, which is a new editor used specifically to <a id="_idIndexMarker599"/>design user interfaces for Qt Quick projects. The components of this editor are described as follows:<ul><li><strong class="bold">Components</strong>: The <strong class="bold">Components</strong> window displays all the predefined QML types that you can add to your user interface canvas. You can also create custom Qt Quick components from the Create Component button and display them here.</li><li><strong class="bold">Navigator</strong>: The <strong class="bold">Navigator</strong> window displays the items in the current QML file in a tree structure.</li><li><strong class="bold">Connections</strong>: You can use the tools provided in the <strong class="bold">Connections</strong> window to connect objects to signals, specify dynamic properties for objects, and create bindings between the properties of two objects.</li><li><strong class="bold">States</strong>: The <strong class="bold">States</strong> window displays the different states of an item. You can add a new<a id="_idIndexMarker600"/> state for an item by clicking on the <strong class="bold">+</strong> button on the right of the <strong class="bold">State</strong> window.</li><li><strong class="bold">2D/3D Canvas</strong>: The canvas is where you design your program’s user interface. You can drag and drop a <strong class="bold">Qt Quick</strong> component from the <strong class="bold">Components</strong> window onto the canvas and instantly see what it will look like in the program. You can create a 2D or 3D canvas for different types of applications.</li><li><strong class="bold">Properties</strong>: This is where you change the properties of a selected item.</li></ul></li>
<li>You can also select pre-defined workspaces for your <strong class="bold">Qt Design Studio</strong> editor by selecting from the drop-down box in the top-right corner:</li>
</ol>
<div><div><img alt="Figure 9.10 – Select a pre-defined workspace" src="img/B20976_09_010.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.10 – Select a pre-defined workspace</p>
<ol>
<li value="8">We’re about to<a id="_idIndexMarker601"/> make a simple login screen. First, delete the editing components from the 2D canvas. Then, from the <strong class="bold">Components</strong> window, drag two text widgets onto the canvas.</li>
<li>Set the <code>Username:</code> and <code>Password:</code>:</li>
</ol>
<div><div><img alt="Figure 9.11 – Set the Text property" src="img/B20976_09_011.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.11 – Set the Text property</p>
<ol>
<li value="10">Drag two rectangles from the <code>1</code> and the <code>5</code>. Then, set the echo mode of one of the text fields to <strong class="bold">Password</strong>.</li>
<li>Now, we’re going to manually create a button widget by combining a mouse area widget with a rectangle and a text widget. Drag a mouse area widget onto the canvas, then drag a rectangle and a text widget onto the canvas and parent them both to the mouse area. Set the color of the rectangle to <code>#bdbdbd</code>, then set its <code>1</code> and its <code>5</code>. Then, set the <code>Login</code> and make sure the size of the mouse area is the same as the rectangle.</li>
<li>After that, drag another rectangle onto the canvas to act as the container for the login form so that it will look neat. Set its <code>#5e5858</code> and its <code>2</code>. Then, set its <code>5</code> to make its corners look a little rounded.</li>
<li>Make sure the rectangle that we added in the previous step is positioned at the top of the hierarchy in the <strong class="bold">Navigator</strong> window so that it appears behind all the other widgets. You can arrange the widget positions within the hierarchy by pressing the arrow buttons located at the top of the <strong class="bold">Navigator</strong> window as follows:</li>
</ol>
<div><div><img alt="Figure 9.12 – Click the Move up button" src="img/B20976_09_012.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.12 – Click the Move up button</p>
<ol>
<li value="14">Next, we will<a id="_idIndexMarker603"/> export three widgets: mouse area and the two text input widgets as the alias properties of the root item so that later on, we can access these widgets from the <code>App.qml</code> file. The widgets can be exported by clicking on the small icon behind the widget name and making sure the icon changes to the <strong class="bold">On</strong> status.</li>
<li>By now, your user interface should look something like this:</li>
</ol>
<div><div><img alt="Figure 9.13 – A simple login screen" src="img/B20976_09_013.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.13 – A simple login screen</p>
<ol>
<li value="16">Now, let’s open up <code>App.qml</code>. Qt Creator will not open this file in <code>Screen01.ui.qml</code>, and <code>App.qml</code> is only used for defining the logic and functions that will be applied to the UI. You can, however, open it with Qt Design Studio to preview the user interface by clicking on the <strong class="bold">Design</strong> button located in the sidebar on the left of the editor.</li>
<li>At the top of the script, add the third line to import the dialog module to <code>App.qml</code>, as shown in the following code:<pre class="source-code">
import QtQuick
import QtQuick.Dialogs
import yourprojectname</pre></li> <li>After that, replace the following code with this:<pre class="source-code">
Window {
    visible: true
    title: "Hello World"
    width: 360
    height: 360
    Screen01 {
        anchors.fill: parent
        loginButton.onClicked: {
        messageDialog.text = "Username is " +
        userInput.text + " and password is " + passInput.text
        messageDialog.visible = true
        }
    }</pre></li> <li>We continue <a id="_idIndexMarker605"/>to define <code>messageDialog</code> as follows:<pre class="source-code">
    MessageDialog {
        id: messageDialog
        title: "Fake login"
        text: ""
        onAccepted: {
        console.log("You have clicked the login button")
        Qt.quit()
        }
    }
}</pre></li> <li>Build and run this program on your PC, and you should get a simple program that shows a message box when you click on the <strong class="bold">Login</strong> button:</li>
</ol>
<div><div><img alt="Figure 9.14 – A message box showing after clicking on the Login button" src="img/B20976_09_014.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.14 – A message box showing after clicking on the Login button</p>
<h2 id="_idParaDest-193"><a id="_idTextAnchor193"/>How it works…</h2>
<p>Since Qt 5.4, a new file extension called <code>.ui.qml</code> has been introduced. The QML engine handles it like <a id="_idIndexMarker606"/>the normal <code>.qml</code> files but forbids any logic implementation from being written in it. It serves as the user interface definition template that can be reused in different <code>.qml</code> files. The separation of UI definition and logic implementation improves the maintainability of QML code and creates a better workflow.</p>
<p>Since Qt 6, <code>.ui.qml</code> files have no longer been handled by Qt Creator. Instead, Qt provides you with another program called Qt Design Studio to edit your Qt Quick UI. They intend to give programmers and designers their separate tools that fit their workflow.</p>
<p>All the widgets under <strong class="bold">Basic</strong> are the most basic widgets that we can use to mix and match and create a new type of widget, as follows:</p>
<div><div><img alt="Figure 9.15 – Drag and drop widgets from here" src="img/B20976_09_015.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.15 – Drag and drop widgets from here</p>
<p>In the previous example, we learned how to put three widgets together—a text, a mouse area, and a <a id="_idIndexMarker607"/>rectangle—to form a button widget. You can also create your custom component by clicking the <strong class="bold">Create Component</strong> button at the top right corner:</p>
<div><div><img alt="Figure 9.16 – You can also create your custom component" src="img/B20976_09_016.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.16 – You can also create your custom component</p>
<p>We imported the <code>QtQuick.Dialogs</code> module in <code>App.qml</code> and created a message box that displays the username and password filled in by the user when the <code>Screen01.ui.qml</code>, we will not be able to access their properties in <code>App.qml</code>.</p>
<p>At this point, we can export the program to iOS and Android, but the user interface may not look accurate on some of the devices that have a higher resolution or a higher <strong class="bold">density-per-pixel</strong> (<strong class="bold">DPI</strong>) unit. We <a id="_idIndexMarker608"/>will cover this<a id="_idIndexMarker609"/> issue later on in this chapter.</p>
<h1 id="_idParaDest-194"><a id="_idTextAnchor194"/>Touch events</h1>
<p>In this section, we <a id="_idIndexMarker610"/>will learn how to develop a touch-driven<a id="_idIndexMarker611"/> application that runs on mobile devices using Qt Quick.</p>
<h2 id="_idParaDest-195"><a id="_idTextAnchor195"/>How to do it…</h2>
<p>Let’s get started by following this step-by-step guide:</p>
<ol>
<li>Create a new <strong class="bold">Qt Quick </strong><strong class="bold">application</strong> project.</li>
<li>In Qt Design Studio, click on the <code>tux.png</code> and add it to the project as follows:</li>
</ol>
<div><div><img alt="Figure 9.17 – Import tux.png into your project" src="img/B20976_09_017.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.17 – Import tux.png into your project</p>
<ol>
<li value="3">Next, open up <code>Screen01.ui.qml</code>. Drag an image widget from the <code>tux.png</code> and set its <code>200</code> and its <code>20</code>.</li>
<li>Make sure that both the mouse area widget and the image widget are exported as the alias properties of the root item by clicking on the small icon beside their respective widget name.</li>
<li>After that, switch over to the script editor by clicking on the <strong class="bold">Edit</strong> button on the sidebar located on the left side of the editor. We need to change the mouse area widget <a id="_idIndexMarker612"/>to<a id="_idIndexMarker613"/> a <a id="_idIndexMarker614"/>multi-point touch area widget, as in the following code:<pre class="source-code">
MultiPointTouchArea {
    id: touchArea
    anchors.fill: parent
    touchPoints: [
        TouchPoint { id: point1 },
        TouchPoint { id: point2 }
    ]
}</pre></li> <li>We also set the <strong class="bold">Image</strong> widget<a id="_idIndexMarker615"/> to<a id="_idIndexMarker616"/> be automatically placed at the center of the window by default, as follows:<pre class="source-code">
Image {
    id: tux
    x: (window.width / 2) - (tux.width / 2)
    y: (window.height / 2) - (tux.height / 2)
    width: 200
    height: 220
    fillMode: Image.PreserveAspectFit
    source: "tux.png"
}</pre></li> <li>The final user interface should look something like this:</li>
</ol>
<div><div><img alt="Figure 9.18 – Place the penguin in your application window" src="img/B20976_09_018.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.18 – Place the penguin in your application window</p>
<ol>
<li value="8">Once <a id="_idIndexMarker617"/>you’re<a id="_idIndexMarker618"/> done with that, let’s open up <code>App.qml</code>. First, clear<a id="_idIndexMarker619"/> everything within the <code>anchors.fill: parent</code>, as shown in the following code:<pre class="source-code">
import QtQuick
import QtQuick.Window
Window {
    visible: true
    Screen01 {
        anchors.fill: parent
    }
}</pre></li> <li>After that, declare several variables within the <strong class="bold">MainForm</strong> object that will be used to rescale the image widget. If you want to know more about the property keyword used in the following code, check out the <strong class="bold">There’s more…</strong> section at the end of this example:<pre class="source-code">
property int prevPointX: 0
property int prevPointY: 0
property int curPointX: 0
property int curPointY: 0
property int prevDistX: 0
property int prevDistY: 0
property int curDistX: 0
property int curDistY: 0
property int tuxWidth: tux.width
property int tuxHeight: tux.height</pre></li> <li>Using the <a id="_idIndexMarker620"/>following code, we will define what will <a id="_idIndexMarker621"/>happen when our finger touches the multi-point area widget. In this case, we will save the positions of the first and second touch points if more than one finger touches the multi-point touch area. We also save the width and height of the image widget so that, later on, we can use these variables to calculate the scale of the image when the fingers start to move:<pre class="source-code">
touchArea.onPressed: {
    if (touchArea.touchPoints[1].pressed) {
        if (touchArea.touchPoints[1].x &lt; touchArea.touchPoints[0].x)
            prevDistX = touchArea.touchPoints[1].x -    touchArea.touchPoints[0].x
        else
            prevDistX = touchArea.touchPoints[0].x -
            touchArea.touchPoints[1].x
        if (touchArea.touchPoints[1].y &lt; touchArea.touchPoints[0].y)
            prevDistY = touchArea.touchPoints[1].y -
            touchArea.touchPoints[0].y
        else
            prevDistY = touchArea.touchPoints[0].y -
            touchArea.touchPoints[1].y
            tuxWidth = tux.width
            tuxHeight = tux.height
        }
    }</pre></li> <li>The following<a id="_idIndexMarker622"/> diagram shows the example of touch <a id="_idIndexMarker623"/>points being registered when two fingers are touching the screen within the <code>touchArea</code> boundary. The <code>touchArea.touchPoints[0]</code> is the first registered touch point, and <code>touchArea.touchPoints[1]</code> is the second. We then calculate the X and Y distance between the two touch points and save them as <code>prevDistX</code> and <code>prevDistY</code>, as follows:</li>
</ol>
<div><div><img alt="Figure 9.19 – Calculate the distances between two touch points" src="img/B20976_09_019.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.19 – Calculate the distances between two touch points</p>
<ol>
<li value="12">After that, we will define what will happen when our fingers move while remaining in contact with the screen and still within the boundary of the touch area using the<a id="_idIndexMarker624"/> following code. At this point, we<a id="_idIndexMarker625"/> will calculate the scale of the image by using the variables we saved in the previous step. At the same time, if we detect that only a single touch is found, then we will move the image instead of altering its scale:<pre class="source-code">
        touchArea.onUpdated: {
            if (!touchArea.touchPoints[1].pressed) {
                tux.x += touchArea.touchPoints[0].x -
        touchArea.touchPoints[0].previousX
                tux.y += touchArea.touchPoints[0].y -
        touchArea.touchPoints[0].previousY
            }
            else {
                if (touchArea.touchPoints[1].x &lt;
                touchArea.touchPoints[0].x)
                    curDistX = touchArea.touchPoints[1].x - touchArea.touchPoints[0].x
                else
                    curDistX = touchArea.touchPoints[0].x - touchArea.touchPoints[1].x
                if (touchArea.touchPoints[1].y &lt;
                touchArea.touchPoints[0].y)
                    curDistY = touchArea.touchPoints[1].y - touchArea.touchPoints[0].y
                else
                    curDistY = touchArea.touchPoints[0].y - touchArea.touchPoints[1].y
                tux.width = tuxWidth + prevDistX - curDistX
                tux.height = tuxHeight + prevDistY - curDistY
            }
        }</pre></li> <li>The <a id="_idIndexMarker626"/>following <a id="_idIndexMarker627"/>diagram shows the example of moving touch points; <code>touchArea.touchPoints[0]</code> moved from point A to point B, and <code>touchArea.touchPoints[1]</code> moved from point C to point D. We can then determine how many units have the touch points moved by looking at the differences between the previous X, and Y variables with the current ones:</li>
</ol>
<div><div><img alt="Figure 9.20 – Compare two sets of touch points to determine movement" src="img/B20976_09_020.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.20 – Compare two sets of touch points to determine movement</p>
<ol>
<li value="14">You can now build and export the program to your mobile device. You will not be able to test<a id="_idIndexMarker628"/> this program on a platform that <a id="_idIndexMarker629"/>does not support multi-touch.</li>
<li>Once the program is running on the mobile device (or a desktop/laptop that supports multi-touch), try two things—put only one finger on the screen and move it around, and put two fingers on the screen and move them in opposite directions. What you should see is that the penguin will be moved to another place if you use only one finger, and it will be scaled up or down if you use two fingers, as shown in the following screenshot:</li>
</ol>
<div><div><img alt="Figure 9.21 – Scaling up and down using your fingers" src="img/B20976_09_021.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.21 – Scaling up and down using your fingers</p>
<h2 id="_idParaDest-196"><a id="_idTextAnchor196"/>How it works…</h2>
<p>When a finger touches the screen of the device, the multi-point touch area widget triggers the <code>onPressed</code> event and registers the position of each of the touch points in an internal array. We<a id="_idIndexMarker630"/> can get these data by telling Qt which<a id="_idIndexMarker631"/> touch point we want to get access to. The first touch will bear the index number of 0, the second touch will be 1, and so on. We will then save these data into variables so that we can retrieve them later to calculate the scaling of the penguin image. Other than <code>onPressed</code>, you can also use <code>onReleased</code> if you want the event to be triggered when the user releases his/her finger from the touch area.</p>
<p>When one or more fingers remain in contact with the screen while moving, a multi-point touch area will trigger the <code>onUpdated</code> event. We will then check how many touches there are; if only one touch is found, we will just move the penguin image based on how much our finger has moved. If there is more than one touch, we will compare the distance between the two touches and compare this with the previous variables we have saved to determine how much we should rescale the image.</p>
<p>The diagram shows tapping your finger on the screen will trigger the <code>onPressed</code> event, while swiping your finger on the screen will trigger the <code>onUpdated</code> event:</p>
<div><div><img alt="Figure 9.22 – Difference between onPressed and onUpdated" src="img/B20976_09_022.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.22 – Difference between onPressed and onUpdated</p>
<p>We must also check whether the first touch is on the left side or if the second touch is on the right side. In this way, we can prevent the image from being scaled in the inverse direction of the finger movement and producing an inaccurate result. As for the movement of the penguin, we will just get the difference between the current touch position and the previous one and add that to the coordinate of the penguin; after this, it’s done. A <a id="_idIndexMarker632"/>single <a id="_idIndexMarker633"/>touch event is usually a lot more straightforward than a multi-touch event.</p>
<h2 id="_idParaDest-197"><a id="_idTextAnchor197"/>There’s more…</h2>
<p>In Qt Quick, all its components have built-in properties, such as <code>int</code>, <code>float</code>, and so on) keyword; here is an example:</p>
<pre class="source-code">
property int myValue;</pre> <p>You can also bind the custom <code>property</code> to a value by using a colon (<code>:</code>) before the value, as shown in the following code:</p>
<pre class="source-code">
property int myValue: 100;</pre> <p class="callout-heading">Important note</p>
<p class="callout">To learn more about the<a id="_idIndexMarker634"/> property types supported by Qt Quick, check out this link: <a href="http://doc.qt.io/qt-6/qtqml-typesystem-basictypes.html">http://doc.qt.io/qt-6/qtqml-typesystem-basictypes.html</a>.</p>
<h1 id="_idParaDest-198"><a id="_idTextAnchor198"/>Animation in QML</h1>
<p>Qt allows us to <a id="_idIndexMarker635"/>easily animate a user interface component without writing <a id="_idIndexMarker636"/>a bunch of code. In this example, we will learn how to make our program’s user interface more interesting by applying animations to it.</p>
<h2 id="_idParaDest-199"><a id="_idTextAnchor199"/>How to do it…</h2>
<p>Let’s learn how to add animation to our Qt Quick application by following these steps:</p>
<ol>
<li>Once again, we will start everything from scratch. Therefore, create a new <code>Screen01.ui.qml</code> file.</li>
<li>Open up <code>Screen01.ui.qml</code> and go to the <code>QtQuick.Controls</code> to your project.</li>
<li>After that, you will see a new category appear in the <strong class="bold">QML Types</strong> tab called <strong class="bold">QtQuick Controls</strong>, which contains many new widgets that can be placed on the canvas.</li>
<li>Next, drag three button widgets to the canvas and set their <code>45</code>. Then, go to the <code>0</code>. This will make the buttons resize horizontally according to the width of the main window. After that, set the y value of the first button to <code>0</code>, the second to <code>45</code>, and the third to <code>90</code>. The user interface should now look like this:</li>
</ol>
<div><div><img alt="Figure 9.23 – Add three buttons to the layout" src="img/B20976_09_023.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.23 – Add three buttons to the layout</p>
<ol>
<li value="5">Now, open up the <code>fan.png</code> to the project, as follows:</li>
</ol>
<div><div><img alt="Figure 9.24 – Add fan.png to your project" src="img/B20976_09_024.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.24 – Add fan.png to your project</p>
<ol>
<li value="6">Then, add <a id="_idIndexMarker637"/>two <a id="_idIndexMarker638"/>mouse area widgets to the canvas. After that, drag a <strong class="bold">Rectangle</strong> widget and an <strong class="bold">Image</strong> widget onto the canvas. Parent the rectangle and image to the mouse areas we have just added before this.</li>
<li>Set the <code>#0000ff</code> and apply <code>fan.png</code> to the image widget. Your user interface should now look like this:</li>
</ol>
<div><div><img alt="Figure 9.25 – Place a rectangle and the fan image in the layout" src="img/B20976_09_025.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.25 – Place a rectangle and the fan image in the layout</p>
<ol>
<li value="8">After that, export all the widgets in your <code>Screen01.ui.qml</code> as alias properties of the <a id="_idIndexMarker639"/>root<a id="_idIndexMarker640"/> item by clicking on the icons located to the right of the widget name, as follows:</li>
</ol>
<div><div><img alt="Figure 9.26 – Adding aliases to the widgets" src="img/B20976_09_026.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.26 – Adding aliases to the widgets</p>
<ol>
<li value="9">Next, we will apply animation and logic to the user interface, but we won’t be doing it in <code>Screen01.ui.qml</code>. Instead, we will do it all in <code>App.qml</code>.</li>
<li>In <code>App.qml</code>, remove the default code for the mouse area and add in a <strong class="bold">width</strong> and <strong class="bold">height</strong> for the window so that we get more space to preview, as follows:<pre class="source-code">
import QtQuick
import QtQuick.Window
Window {
    visible: true
    width: 480
    height: 550
    Screen01 {
        anchors.fill: parent
    }
}</pre></li> <li>After that, add <a id="_idIndexMarker641"/>the <a id="_idIndexMarker642"/>following code that defines the behavior of the buttons in the <strong class="bold">Screen01</strong> widget:<pre class="source-code">
        button1 {
            Behavior on y { SpringAnimation { spring: 2; damping: 0.2 } }
            onClicked: {
                button1.y = button1.y + (45 * 3)
            }
        }
        button2 {
                Behavior on y { SpringAnimation { spring: 2; damping: 0.2 } }
            onClicked: {
                button2.y = button2.y + (45 * 3)
            }
        }</pre></li> <li>In the following code, we continue to define <code>button3</code>:<pre class="source-code">
        button3 {
            Behavior on y { SpringAnimation { spring: 2; damping: 0.2 } }
            onClicked: {
                button3.y = button3.y + (45 * 3)
            }
        }</pre></li> <li>Then, follow this<a id="_idIndexMarker643"/> with <a id="_idIndexMarker644"/>the behavior of the fan image and the mouse area widget it is attached to as follows:<pre class="source-code">
        fan {
            RotationAnimation on rotation {
                id: anim01
                loops: Animation.Infinite
                from: 0
                to: -360
                duration: 1000
            }
        }</pre></li> <li>In the following code, we then define <code>mouseArea1</code>:<pre class="source-code">
        mouseArea1 {
            onPressed: {
                if (anim01.paused)
                    anim01.resume()
                else
                    anim01.pause()
            }
        }</pre></li> <li>Last but not least, add the behavior of the rectangle and the mouse area widget it’s attached to as follows:<pre class="source-code">
        rectangle2 {
            id: rect2
            state: "BLUE"
            states: [
                State {
                    name: "BLUE"
                    PropertyChanges {
                        target: rect2
                        color: "blue"
            }
        },</pre></li> <li>In the<a id="_idIndexMarker645"/> following <a id="_idIndexMarker646"/>code, we continue to add the <code>RED</code> state:<pre class="source-code">
                State {
                    name: "RED"
                    PropertyChanges {
                        target: rect2
                        color: "red"
                    }
                }
            ]
        }</pre></li> <li>We then finish the code by defining <code>mouseArea2</code> as follows:<pre class="source-code">
        mouseArea2 {
            SequentialAnimation on x {
                loops: Animation.Infinite
                PropertyAnimation { to: 150; duration: 1500 }
                PropertyAnimation { to: 50; duration: 500 }
            }
            onClicked: {
                if (rect2.state == "BLUE")
                    rect2.state = "RED"
                else
                    rect2.state = "BLUE"
            }
        }</pre></li> <li>If you compile<a id="_idIndexMarker647"/> and<a id="_idIndexMarker648"/> run the program now, you should see three buttons at the top of the window and a moving rectangle at the bottom left, followed by a spinning fan at the bottom right, as demonstrated in the following screenshot. If you click any of the buttons, they will move slightly downward with a nice, smooth animation. If you click on the rectangle, it will change color from <strong class="bold">blue</strong> to <strong class="bold">red</strong>.</li>
<li>Meanwhile, the fan image will pause its animation if you click on it while it’s animating, and it will resume the animation if you click on it again:</li>
</ol>
<div><div><img alt="Figure 9.27 – You can now control the animation and color of the widgets" src="img/B20976_09_027.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.27 – You can now control the animation and color of the widgets</p>
<h2 id="_idParaDest-200"><a id="_idTextAnchor200"/>How it works…</h2>
<p>Most of the <a id="_idIndexMarker649"/>animation<a id="_idIndexMarker650"/> elements supported by the C++ version of Qt, such as transition, sequential animation, and parallel animation, are also available in Qt Quick. If you are familiar with the Qt animation framework in C++, you should be able to grasp this pretty easily.</p>
<p>In this example, we added a spring animation element to all three buttons that specifically tracked their respective y-axes. If Qt detects that the y value has changed, the widget will not instantly pop to the new position; instead, it will be interpolated, move across the canvas, and perform a little shaking animation when reaching its destination that simulates the spring effect. We just have to write one line of code and leave the rest to Qt.</p>
<p>As for the fan image, we added a rotation animation element to it and set the duration to <code>1000 milliseconds</code>, which means it will complete a full rotation in one second. We also set it to loop its animation infinitely. When we clicked on the mouse area widget it’s attached to, we just called <code>pause()</code> or <code>resume()</code> to enable or disable the animation.</p>
<p>Next, for the rectangle widget, we added two states to it, one called <strong class="bold">BLUE</strong> and one called <strong class="bold">RED</strong>, each of which carries a <strong class="bold">color</strong> property that will be applied to the rectangle upon state change. At the same time, we added <strong class="bold">sequential animation group</strong> to the mouse area widget that the rectangle is attached to and then added two <strong class="bold">property animation</strong> elements to <a id="_idIndexMarker651"/>the<a id="_idIndexMarker652"/> group. You can also mix different types of group animation; Qt can handle this very well.</p>
<h1 id="_idParaDest-201"><a id="_idTextAnchor201"/>Displaying information using model/view</h1>
<p>Qt includes a <strong class="bold">model/view framework</strong> that maintains separation between the way data are <a id="_idIndexMarker653"/>organized and managed and the way that they are presented to the user. In this section, we will learn how to make use of the model/view; in particular, by using the list view to display information and, at the same time, apply our own customization to make it look slick.</p>
<h2 id="_idParaDest-202"><a id="_idTextAnchor202"/>How to do it…</h2>
<p>Let’s get started by following these steps:</p>
<ol>
<li>Create a new <code>home.png</code>, <code>map.png</code>, <code>profile.png</code>, <code>search.png</code>, <code>settings.png</code>, and <code>arrow.png</code> to the project, as follows:</li>
</ol>
<div><div><img alt="Figure 9.28 – Adding more images to the project" src="img/B20976_09_028.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.28 – Adding more images to the project</p>
<ol>
<li value="2">After that, create <a id="_idIndexMarker654"/>and open <code>Screen01.ui.qml</code>, as we did in all previous examples. Drag a <strong class="bold">List View</strong> widget from under the <strong class="bold">Qt Quick – Views</strong> category in the <strong class="bold">Components</strong> window and place it onto the canvas. Then, set its <strong class="bold">Anchors</strong> setting to fill the parent size by clicking on the button located in the middle of the <strong class="bold">Layout</strong> window, as shown in the following screenshot:</li>
</ol>
<div><div><img alt="Figure 9.29 – Set the layout anchor as a fill parent" src="img/B20976_09_029.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.29 – Set the layout anchor as a fill parent</p>
<ol>
<li value="3">Next, switch over<a id="_idIndexMarker655"/> to the script editor, as we will define what the list view will look like as follows:<pre class="source-code">
import QtQuick
Rectangle {
    id: rectangle1
    property alias listView1: listView1
    property double sizeMultiplier: width / 480</pre></li> <li>We will continue to write the code by adding the following list view:<pre class="source-code">
    ListView {
        id: listView1
        y: 0
        height: 160
        orientation: ListView.Vertical
        boundsBehavior: Flickable.StopAtBounds
        anchors.fill: parent
        delegate: Item {
            width: 80 * sizeMultiplier
            height: 55 * sizeMultiplier</pre></li> <li>We will continue to add rows to the list view, as follows:<pre class="source-code">
            Row {
                id: row1
                Rectangle {
                    width: listView1.width
                    height: 55 * sizeMultiplier
                    gradient: Gradient {
                        GradientStop { position: 0.0; color: "#ffffff" }
                        GradientStop { position: 1.0; color: "#f0f0f0" }
                    }
                    opacity: 1.0</pre></li> <li>We then add a<a id="_idIndexMarker656"/> mouse area and an image, as shown in the following code snippet:<pre class="source-code">
                    MouseArea {
                        id: mouseArea
                        anchors.fill: parent
                    }
                    Image {
                        anchors.verticalCenter: parent.verticalCenter
                        x: 15 * sizeMultiplier
                        width: 30 * sizeMultiplier
                        height: 30 * sizeMultiplier
                        source: icon
                    }</pre></li> <li>Then, continue <a id="_idIndexMarker657"/>to add two text objects, as follows:<pre class="source-code">
                    Text {
                        text: title
                        font.family: "Courier"
                        font.pixelSize: 17 * sizeMultiplier
                        x: 55 * sizeMultiplier
                        y: 10 * sizeMultiplier
                    }
                    Text {
                        text: subtitle
                        font.family: "Verdana"
                        font.pixelSize: 9 * sizeMultiplier
                        x: 55 * sizeMultiplier
                        y: 30 * sizeMultiplier
                    }</pre></li> <li>After that, add an image object, as follows:<pre class="source-code">
                    Image {
                        anchors.verticalCenter: parent.verticalCenter
                        x: parent.width - 35 * sizeMultiplier
                        width: 30 * sizeMultiplier
                        height: 30 * sizeMultiplier
                        source: "images/arrow.png"
                    }
                }
            }
        }</pre></li> <li>Using the following code, we will then define the list model:<pre class="source-code">
        model: ListModel {
            ListElement {
                title: "Home"
                subtitle: "Go back to dashboard"
                icon: "images/home.png"
            }
            ListElement {
                title: "Map"
                subtitle: "Help navigate to your destination"
                icon: "images/map.png"
            }</pre></li> <li>We will <a id="_idIndexMarker658"/>continue to write the code:<pre class="source-code">
            ListElement {
                title: "Profile"
                subtitle: "Customize your profile picture"
                icon: "images/profile.png"
            }
            ListElement {
                title: "Search"
                subtitle: "Search for nearby places"
                icon: "images/search.png"
            }</pre></li> <li>We will now add the final list element, as shown in the following code:<pre class="source-code">
            ListElement {
                title: "Settings"
                subtitle: "Customize your app settings"
                icon: "images/settings.png"
            }
        }
    }
}</pre></li> <li>After that, open<a id="_idIndexMarker659"/> up <code>App.qml</code> and replace the code with the following:<pre class="source-code">
import QtQuick
import QtQuick.Window
Window {
    visible: true
    width: 480
    height: 480
    Screen01 {
        anchors.fill: parent
            MouseArea {
                onPressed: row1.opacity = 0.5
                onReleased: row1.opacity = 1.0
            }
        }
}</pre></li> <li>Build and run the program, and now your program should look like this:</li>
</ol>
<div><div><img alt="Figure 9.30 – Navigation menu with different fonts and icons" src="img/B20976_09_030.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.30 – Navigation menu with different fonts and icons</p>
<h2 id="_idParaDest-203"><a id="_idTextAnchor203"/>How it works…</h2>
<p>Qt Quick allows us <a id="_idIndexMarker660"/>to customize the look of each row of the list view with ease. The delegate defines what each row will look like, and the model is where you store the data that will be displayed on the list view.</p>
<p>In this example, we added a background with a gradient on each row, and then we also added an icon on each side of the item, a title, a description, and a mouse area widget that makes each row of the list view clickable. The delegate is not static, as we allow the model to change the title, description, and icon to make each row look unique.</p>
<p>In <code>App.qml</code>, we defined the behavior of the mouse area widget that will halve its own opacity value when pressed and return to fully opaque when released. Since all other elements, such as title and icon, are all the children of the mouse area widget, all will also automatically follow their parent widget’s behavior and become semi-transparent.</p>
<p>Additionally, we have finally solved the display problem on mobile devices with high resolution and DPI. It’s a very simple trick; first, we defined a variable called <code>sizeMultiplier</code>. The value of <code>sizeMultiplier</code> is the result of dividing the width of the window by a predefined value, say 480, which is the current window width we used for the PC. Then, multiply <code>sizeMultiplier</code> by all the widget variables that are related to size and position, including font size. Do note that, in this case, you should use the <code>pixelSize</code> property for text instead of <code>pointSize</code>, so that you will get the correct display when multiplying by <code>sizeMultiplier</code>. The following screenshot shows you what the app<a id="_idIndexMarker661"/> looks like on the mobile device with and without <code>sizeMultiplier</code>:</p>
<div><div><img alt="Figure 9.31 – Correcting size using size multiplier" src="img/B20976_09_031.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.31 – Correcting size using size multiplier</p>
<p>Notice that you may get a messed-up user interface in the editor once you multiply everything by the <code>sizeMultiplier</code> variable. This is because the width variable may return as <code>0</code> in the editor. Hence, by multiplying 0 by 480, you may get the result <code>0</code>, which makes the entire user interface look funny. However, it will look fine when running the actual program. If you want to preview the user interface on the editor, temporarily<a id="_idIndexMarker662"/> set <code>1</code>.</p>
<h1 id="_idParaDest-204"><a id="_idTextAnchor204"/>Integrating QML and C++</h1>
<p>Qt supports<a id="_idIndexMarker663"/> bridging between C++ classes with the QML engine. This combination allows developers to take advantage of both the simplicity of QML and the flexibility of C++. You can even integrate features that are not supported by Qt from external components, then pass the resulting data to Qt Quick to be displayed in the UI. In this example, we will learn how to export our user interface components from QML to the C++ framework and manipulate their properties before displaying them on screen.</p>
<h2 id="_idParaDest-205"><a id="_idTextAnchor205"/>How to do it…</h2>
<p>Let’s go through the following steps:</p>
<ol>
<li>Once again, we will start everything from scratch. Therefore, create a new <code>Screen01.ui.qml</code> with Qt Design Studio. Then, open up <code>Screen01.ui.qml</code>.</li>
<li>We can keep the mouse area and text widget but place the text widget at the bottom of the window. Change the <code>Text</code> property of the text widget to <code>18</code>. After that, go to the <code>120</code>, as shown in the following screenshot:</li>
</ol>
<div><div><img alt="Figure 9.32 – Place it at the center of the layout" src="img/B20976_09_032.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.32 – Place it at the center of the layout</p>
<ol>
<li value="3">Next, drag a rectangle widget from the <code>#ff0d0d</code>. Set its <code>200</code> and enable both the vertical <a id="_idIndexMarker664"/>and horizontal center anchor. After that, set the <code>-14</code>. Your UI should now look something like this:</li>
</ol>
<div><div><img alt="Figure 9.33 – Place the square and text as they are positioned in this image" src="img/B20976_09_033.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.33 – Place the square and text as they are positioned in this image</p>
<ol>
<li value="4">Once you are done with that, right-click on your project<a id="_idIndexMarker665"/> directory in <code>myclass.h</code> and <code>myclass.cpp</code>—will <a id="_idIndexMarker666"/>now be created and added to your project:</li>
</ol>
<div><div><img alt="Figure 9.34 – Create a new custom class" src="img/B20976_09_034.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.34 – Create a new custom class</p>
<ol>
<li value="5">Now, open up <code>myclass.h</code> and add a variable and function under the class constructor, as shown in the following code:<pre class="source-code">
#ifndef MYCLASS_H
#define MYCLASS_H
#include &lt;QObject&gt;
class MyClass : public QObject
{
    Q_OBJECT
public:
    explicit MyClass(QObject *parent = 0);
    // Object pointer
    QObject* my Object;
    // Must call Q_INVOKABLE so that this function can be used in QML
    Q_INVOKABLE void setMyObject(QObject* obj);
};
#endif // MYCLASS_H</pre></li> <li>After that, open<a id="_idIndexMarker667"/> up <code>myclass.cpp</code> and define the <code>setMyObject()</code> function, as follows:<pre class="source-code">
#include "myclass.h"
MyClass::MyClass(QObject *parent) : Qobject(parent)
{
}
void MyClass::setMyObject(Qobject* obj)
{
    // Set the object pointer
    my Object = obj;
}</pre></li> <li>We can now close <code>myclass.cpp</code> and open up <code>App.qml</code>. At the top of the file, import the <code>MyClassLib</code> components that we just created in C++:<pre class="source-code">
import QtQuick
import QtQuick.Window
<code>MyClass</code> in the <code>Window</code> object and call its <code>setMyObject()</code> function within the <code>MainForm</code> object, as shown in the following code:<pre class="source-code">
Window {
    visible: true
    width: 480
    height: 320
    MyClass {
        id: myclass
    }
    Screen01 {
        anchors.fill: parent
        mouseArea.onClicked: {
            Qt.quit();
        }
        <strong class="bold">Component.onCompleted:</strong>
<strong class="bold">myclass.setMyObject(messageText);</strong>
    }
}</pre></li> <li>Lastly, open <a id="_idIndexMarker668"/>up <code>main.cpp</code> and register the custom class to the QML engine. We will also change the properties of the text widget and the rectangle here using C++ code, as follows:<pre class="source-code">
#include &lt;QGuiApplication&gt;
#include &lt;QQmlApplicationEngine&gt;
#include &lt;QtQml&gt;
#include &lt;QQuickView&gt;
#include &lt;QQuickItem&gt;
#include &lt;QQuickView&gt;
#include "myclass.h"
int main(int argc, char *argv[])
{
    // Register your class to QML
    qmlRegisterType&lt;MyClass&gt;("MyClassLib", 1, 0, "MyClass");</pre></li> <li>Then, proceed to create the objects, just like the highlighted section in the following code:<pre class="source-code">
    QGuiApplication app(argc, argv);
    QQmlApplicationEngine engine;
    engine.load(QUrl(QStringLiteral("qrc:/content/App.qml")));
    QObject* root = engine.rootObjects().value(0);
    QObject* messageText =
root-&gt;findChild&lt;QObject*&gt;("messageText");
    messageText-&gt;setProperty("text", QVariant("C++ is now in control!"));
    messageText-&gt;setProperty("color", QVariant("green"));
    QObject* square = root-&gt;findChild&lt;QObject*&gt;("square");
    square-&gt;setProperty("color", QVariant("blue"));
    return app.exec();
}</pre></li> <li>Now, build and run <a id="_idIndexMarker669"/>the program, and you should see that the colors of the rectangle and the text are completely different from what you defined earlier in Qt Quick, as shown in the following screenshot. This is because their properties have been changed by the C++ code:</li>
</ol>
<div><div><img alt="Figure 9.35 – Text and color can now be changed by C++" src="img/B20976_09_035.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 9.35 – Text and color can now be changed by C++</p>
<h2 id="_idParaDest-206"><a id="_idTextAnchor206"/>How it works…</h2>
<p>QML is designed to be easily extendable through C++ code. The classes in the Qt QML module enable QML<a id="_idIndexMarker670"/> objects to be loaded and manipulated from C++.</p>
<p>Only classes that are inherited from the <code>QObject</code> base class can be integrated with QML, as it is part of the Qt ecosystem. Once the class has been registered with the QML engine, we get the root item from the QML engine and use it to find the objects we want to manipulate.</p>
<p>After that, use the <code>setProperty()</code> function to change any of the properties belonging to the widget. Other than <code>setProperty()</code>, you may also use the <code>Q_PROPERTY()</code> macro in a class that inherits <code>QObject</code> to declare a property. Here is an example:</p>
<pre class="console">
Q_PROPERTY(QString text MEMBER m_text NOTIFY textChanged)</pre> <p>Notice that the <code>Q_INVOKABLE</code> macro needs to be placed in front of the function that you intend to call in QML. Without it, Qt will not expose the function to Qt Quick, and you will not be able to call it.</p>
</div>
</body></html>