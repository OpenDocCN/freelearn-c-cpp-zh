<html><head></head><body>
<div id="_idContainer151">
<h1 class="chapter-number" id="_idParaDest-195"><a id="_idTextAnchor195"/><span class="koboSpan" id="kobo.1.1">9</span></h1>
<h1 id="_idParaDest-196"><a id="_idTextAnchor196"/><span class="koboSpan" id="kobo.2.1">Project 4 – Collecting Data from the Soil and Environment for Smart Farming</span></h1>
<p><span class="koboSpan" id="kobo.3.1">This chapter is dedicated to </span><strong class="bold"><span class="koboSpan" id="kobo.4.1">smart agriculture</span></strong><span class="koboSpan" id="kobo.5.1">. </span><span class="koboSpan" id="kobo.5.2">Our population is growing rapidly and food consumption is directly </span><a id="_idIndexMarker723"/><span class="koboSpan" id="kobo.6.1">proportional to population. </span><span class="koboSpan" id="kobo.6.2">Fortunately, we have the latest tools and technologies that help us to boost our crop yields by using fewer natural resources. </span><span class="koboSpan" id="kobo.6.3">In smart agriculture, there are different parameters to monitor, but we will only focus on soil moisture and soil temperature as both are linked to water consumption; access to clean water is another issue with the rapid growth of industries </span><span class="No-Break"><span class="koboSpan" id="kobo.7.1">and population.</span></span></p>
<p><span class="koboSpan" id="kobo.8.1">In this chapter, we will practically explore smart agriculture by monitoring the soil moisture level, soil temperature, and outdoor temperature and humidity, which will help us to understand how our soil responds to changes in the outside environment and for how many days the soil retains moisture after watering the crop. </span><span class="koboSpan" id="kobo.8.2">Our smart agriculture device will send all the data to the Arduino IoT Cloud, where we will monitor it in real time and make decisions that will help us to use controlled watering for crops, which will save water and improve the </span><span class="No-Break"><span class="koboSpan" id="kobo.9.1">soil quality.</span></span></p>
<p><span class="koboSpan" id="kobo.10.1">In this chapter, we are going to use open source and cost-effective sensors to carry out experiments in labs as well as in the field. </span><span class="koboSpan" id="kobo.10.2">For the development board, we are using the </span><strong class="bold"><span class="koboSpan" id="kobo.11.1">ESP32</span></strong><span class="koboSpan" id="kobo.12.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.13.1">ADS1115</span></strong> <strong class="bold"><span class="koboSpan" id="kobo.14.1">analog-to-digital converter</span></strong><span class="koboSpan" id="kobo.15.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.16.1">ADC</span></strong><span class="koboSpan" id="kobo.17.1">) modules in combination with four capacitive soil moisture and four </span><strong class="bold"><span class="koboSpan" id="kobo.18.1">DS18B20</span></strong><span class="koboSpan" id="kobo.19.1"> sensors for soil temperature monitoring, as well as a </span><strong class="bold"><span class="koboSpan" id="kobo.20.1">DHT22</span></strong><span class="koboSpan" id="kobo.21.1"> module for outdoor temperature and humidity monitoring. </span><span class="koboSpan" id="kobo.21.2">This project will help you optimize your crops with precision farming, tunnel farming, and drip irrigation, as well as be useful for </span><span class="No-Break"><span class="koboSpan" id="kobo.22.1">home gardening.</span></span></p>
<p><span class="koboSpan" id="kobo.23.1">In this chapter, we will cover the </span><span class="No-Break"><span class="koboSpan" id="kobo.24.1">following topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.25.1">Smart farming </span><span class="No-Break"><span class="koboSpan" id="kobo.26.1">with IoT</span></span></li>
<li><span class="koboSpan" id="kobo.27.1">Essential hardware for your </span><span class="No-Break"><span class="koboSpan" id="kobo.28.1">agri-tech project</span></span></li>
<li><span class="koboSpan" id="kobo.29.1">Architecting your agriculture </span><span class="No-Break"><span class="koboSpan" id="kobo.30.1">IoT system</span></span></li>
<li><span class="koboSpan" id="kobo.31.1">Perfecting </span><span class="No-Break"><span class="koboSpan" id="kobo.32.1">sensor calibration</span></span></li>
<li><span class="koboSpan" id="kobo.33.1">Setting up things, networks, and </span><span class="No-Break"><span class="koboSpan" id="kobo.34.1">cloud variables</span></span></li>
<li><span class="koboSpan" id="kobo.35.1">Creating web and </span><span class="No-Break"><span class="koboSpan" id="kobo.36.1">mobile dashboards</span></span></li>
</ul>
<h1 id="_idParaDest-197"><a id="_idTextAnchor197"/><span class="koboSpan" id="kobo.37.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.38.1">The following hardware components are required to complete </span><span class="No-Break"><span class="koboSpan" id="kobo.39.1">this chapter:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.40.1">ESP32 </span><span class="No-Break"><span class="koboSpan" id="kobo.41.1">development board</span></span></li>
<li><span class="koboSpan" id="kobo.42.1">ADS1115 </span><span class="No-Break"><span class="koboSpan" id="kobo.43.1">ADC module</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.44.1">DHT22 module</span></span></li>
<li><span class="koboSpan" id="kobo.45.1">Soil moisture </span><span class="No-Break"><span class="koboSpan" id="kobo.46.1">sensor x4</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.47.1">DS18B20 x4</span></span></li>
<li><span class="koboSpan" id="kobo.48.1">PCB (link is available in the </span><em class="italic"><span class="koboSpan" id="kobo.49.1">PCB design and the assembly of hardware </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.50.1">components</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.51.1"> section)</span></span></li>
<li><span class="koboSpan" id="kobo.52.1">2.54 mm </span><span class="No-Break"><span class="koboSpan" id="kobo.53.1">three-pin connectors</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.54.1">Female headers</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.55.1">Jumper cables</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.56.1">For coding, we will use the Arduino Web Editor, which includes a large collection of development board and sensor libraries, and we will use the Arduino IoT Cloud for Thing and dashboard setup. </span><span class="koboSpan" id="kobo.56.2">To develop hardware and sensor designs, we need the Fritzing </span><span class="No-Break"><span class="koboSpan" id="kobo.57.1">desktop software.</span></span></p>
<p><span class="koboSpan" id="kobo.58.1">The chapter code is available in the book’s official GitHub repository, or you can directly download the code </span><span class="No-Break"><span class="koboSpan" id="kobo.59.1">at </span></span><a href="https://github.com/PacktPublishing/Arduino-IoT-Cloud-for-Developers"><span class="No-Break"><span class="koboSpan" id="kobo.60.1">https://github.com/PacktPublishing/Arduino-IoT-Cloud-for-Developers</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.61.1">.</span></span></p>
<h1 id="_idParaDest-198"><a id="_idTextAnchor198"/><span class="koboSpan" id="kobo.62.1">Smart farming with IoT</span></h1>
<p><strong class="bold"><span class="koboSpan" id="kobo.63.1">Internet of Things</span></strong><span class="koboSpan" id="kobo.64.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.65.1">IoT</span></strong><span class="koboSpan" id="kobo.66.1">) technology is used in smart agriculture</span><a id="_idIndexMarker724"/><span class="koboSpan" id="kobo.67.1"> to optimize farm operations, improve crop yields, reduce waste, and increase profits. </span><span class="koboSpan" id="kobo.67.2">Here are some examples </span><a id="_idIndexMarker725"/><span class="koboSpan" id="kobo.68.1">of how IoT is used</span><a id="_idIndexMarker726"/><span class="koboSpan" id="kobo.69.1"> in </span><span class="No-Break"><span class="koboSpan" id="kobo.70.1">smart agriculture:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.71.1">Automated irrigation</span></strong><span class="koboSpan" id="kobo.72.1">: IoT sensors can be used to monitor soil moisture levels and weather</span><a id="_idIndexMarker727"/><span class="koboSpan" id="kobo.73.1"> conditions to determine when to irrigate crops. </span><span class="koboSpan" id="kobo.73.2">Automated irrigation systems can then be triggered to deliver the right amount of water to crops, which can reduce water wastage and increase </span><span class="No-Break"><span class="koboSpan" id="kobo.74.1">crop yields.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.75.1">Livestock management</span></strong><span class="koboSpan" id="kobo.76.1">: IoT sensors can be used to monitor the health and behavior of livestock, such</span><a id="_idIndexMarker728"/><span class="koboSpan" id="kobo.77.1"> as their movement, feeding habits, and sleeping patterns. </span><span class="koboSpan" id="kobo.77.2">This data can be used to detect early signs of illness, track breeding cycles, and ensure optimal conditions for </span><span class="No-Break"><span class="koboSpan" id="kobo.78.1">the livestock.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.79.1">Crop monitoring</span></strong><span class="koboSpan" id="kobo.80.1">: IoT sensors can be used to monitor crop growth, detect pests and</span><a id="_idIndexMarker729"/><span class="koboSpan" id="kobo.81.1"> diseases, and identify areas that need attention. </span><span class="koboSpan" id="kobo.81.2">This data can be used to make timely interventions and improve </span><span class="No-Break"><span class="koboSpan" id="kobo.82.1">crop yields.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.83.1">Precision farming</span></strong><span class="koboSpan" id="kobo.84.1">: IoT sensors can be used to gather data on individual plants</span><a id="_idIndexMarker730"/><span class="koboSpan" id="kobo.85.1"> or crops, enabling farmers to optimize their use of resources, such as water, fertilizers, and pesticides. </span><span class="koboSpan" id="kobo.85.2">This can help reduce waste, improve yields, and </span><span class="No-Break"><span class="koboSpan" id="kobo.86.1">save money.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.87.1">Smart harvesting</span></strong><span class="koboSpan" id="kobo.88.1">: IoT sensors can be used to monitor crop ripeness and determine</span><a id="_idIndexMarker731"/><span class="koboSpan" id="kobo.89.1"> the optimal time for harvesting. </span><span class="koboSpan" id="kobo.89.2">This can help reduce waste and improve the quality of </span><span class="No-Break"><span class="koboSpan" id="kobo.90.1">harvested crops.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.91.1">Weather monitoring</span></strong><span class="koboSpan" id="kobo.92.1">: IoT sensors can be used to monitor weather conditions such </span><a id="_idIndexMarker732"/><span class="koboSpan" id="kobo.93.1">as temperature, humidity, and rainfall. </span><span class="koboSpan" id="kobo.93.2">This data can be used to make informed decisions about planting, harvesting, and other </span><span class="No-Break"><span class="koboSpan" id="kobo.94.1">farming</span></span><span class="No-Break"><a id="_idIndexMarker733"/></span><span class="No-Break"><span class="koboSpan" id="kobo.95.1"> operations.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.96.1">Overall, IoT technology is transforming the way that agriculture is practiced. </span><span class="koboSpan" id="kobo.96.2">By using real-time data and analytics, farmers can make better decisions and achieve better outcomes, ultimately leading to a more sustainable food supply for </span><span class="No-Break"><span class="koboSpan" id="kobo.97.1">the world.</span></span></p>
<p><span class="koboSpan" id="kobo.98.1">In this section, we have discussed smart agriculture and different terms and techniques that are common in smart agriculture. </span><span class="koboSpan" id="kobo.98.2">In the next section, we will discuss the hardware components that we are going to use in this </span><span class="No-Break"><span class="koboSpan" id="kobo.99.1">chapter’s project.</span></span></p>
<h1 id="_idParaDest-199"><a id="_idTextAnchor199"/><span class="koboSpan" id="kobo.100.1">Essential hardware for your agri-tech project</span></h1>
<p><span class="koboSpan" id="kobo.101.1">In this project, we have chosen open</span><a id="_idIndexMarker734"/><span class="koboSpan" id="kobo.102.1"> source and easily available hardware</span><a id="_idIndexMarker735"/><span class="koboSpan" id="kobo.103.1"> components. </span><span class="koboSpan" id="kobo.103.2">To demonstrate how the Arduino IoT Cloud works with ESP32 series development boards, we have chosen the following hardware. </span><span class="koboSpan" id="kobo.103.3">In the ESP32 series, we have a wide selection of development </span><a id="_idIndexMarker736"/><span class="koboSpan" id="kobo.104.1">boards that vary in size and number of pins. </span><span class="koboSpan" id="kobo.104.2">In this chapter, we are using </span><strong class="bold"><span class="koboSpan" id="kobo.105.1">ESP32-DevKit V1</span></strong><span class="koboSpan" id="kobo.106.1"> as it’s very compact and smaller in size compared to other</span><a id="_idIndexMarker737"/><span class="koboSpan" id="kobo.107.1"> boards. </span><span class="koboSpan" id="kobo.107.2">It is, of course, also cheaper and provides a 5V pin, which is also</span><a id="_idIndexMarker738"/><span class="koboSpan" id="kobo.108.1"> known as VIN, as well as having the option of a 3.3V pin. </span><span class="koboSpan" id="kobo.108.2">The following figure shows the </span><strong class="bold"><span class="koboSpan" id="kobo.109.1">pin layout</span></strong><span class="koboSpan" id="kobo.110.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.111.1">pinout</span></strong><span class="koboSpan" id="kobo.112.1">) diagram of </span><span class="No-Break"><span class="koboSpan" id="kobo.113.1">ESP32 V1.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer134">
<span class="koboSpan" id="kobo.114.1"><img alt="Figure 9.1: ESP32-DevKit V1" src="image/B19752_09_01.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.115.1">Figure 9.1: ESP32-DevKit V1</span></p>
<p><span class="koboSpan" id="kobo.116.1">ESP32 provides multiple</span><a id="_idIndexMarker739"/><span class="koboSpan" id="kobo.117.1"> pins for digital and analog input/output. </span><span class="koboSpan" id="kobo.117.2">If you want</span><a id="_idIndexMarker740"/><span class="koboSpan" id="kobo.118.1"> to use multiple analog sensors, then ADCs are available. </span><span class="koboSpan" id="kobo.118.2">One of the most well-known ADCs is the ADS1115/ADS1015 module, which provides four analog pins and is good when you need to add additional analog pins to your project. </span><span class="koboSpan" id="kobo.118.3">In this project, four analog pins are required to fetch soil moisture sensor values; this board has enough analog pins but I am using ADS1115 to demonstrate how we can use the ADC module to add extra analog pins to </span><span class="No-Break"><span class="koboSpan" id="kobo.119.1">our projects.</span></span></p>
<p><span class="koboSpan" id="kobo.120.1">In the current project, we need five digital pins for the DHT22 module and DS18B20 temperature probe and four analog pins for the capacitive soil moisture sensors. </span><span class="koboSpan" id="kobo.120.2">One of the good features of this development board is that it provides a 5V power pin, which is not available in most ESP32 series </span><span class="No-Break"><span class="koboSpan" id="kobo.121.1">development boards.</span></span></p>
<p><span class="koboSpan" id="kobo.122.1">Next, we are using the DHT22 module to sense outdoor temperature and humidity, but you can also use the DHT11 sensor, depending on your requirements. </span><span class="koboSpan" id="kobo.122.2">If specifically talking about features, then the DHT22 provides a broader range of sensors compared to the DHT11, but it costs more. </span><span class="koboSpan" id="kobo.122.3">The following figure shows the DHT22 module, and we have labeled the pins for </span><span class="No-Break"><span class="koboSpan" id="kobo.123.1">better understanding.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer135">
<span class="koboSpan" id="kobo.124.1"><img alt="Figure 9.2: DHT22 and DHT11 module pinout" src="image/B19752_09_02.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.125.1">Figure 9.2: DHT22 and DHT11 module pinout</span></p>
<p><span class="koboSpan" id="kobo.126.1">The preceding figure shows</span><a id="_idIndexMarker741"/><span class="koboSpan" id="kobo.127.1"> the pinout of the DHT22/DHT11 sensor</span><a id="_idIndexMarker742"/><span class="koboSpan" id="kobo.128.1"> module; the complete pin connection configuration can be seen in </span><em class="italic"><span class="koboSpan" id="kobo.129.1">Table 9.3</span></em><span class="koboSpan" id="kobo.130.1">. </span><span class="koboSpan" id="kobo.130.2">The first pin (</span><strong class="bold"><span class="koboSpan" id="kobo.131.1">VCC</span></strong><span class="koboSpan" id="kobo.132.1">) works with both 3.3V and 5V. </span><span class="koboSpan" id="kobo.132.2">The second pin is the </span><strong class="bold"><span class="koboSpan" id="kobo.133.1">DATA</span></strong><span class="koboSpan" id="kobo.134.1"> pin, which connects with any digital pin of ESP32-DevKit V1. </span><span class="koboSpan" id="kobo.134.2">The third pin is the </span><strong class="bold"><span class="koboSpan" id="kobo.135.1">GND</span></strong><span class="koboSpan" id="kobo.136.1"> pin, which connects with the GND pin of the </span><span class="No-Break"><span class="koboSpan" id="kobo.137.1">development board.</span></span></p>
<p><span class="koboSpan" id="kobo.138.1">Before moving on, the following table explains all the specification differences between the DHT22 and DHT11. </span><span class="koboSpan" id="kobo.138.2">The most notable things are the sensing range and </span><span class="No-Break"><span class="koboSpan" id="kobo.139.1">sensing period:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table001-5">
<colgroup>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.140.1">Feature</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.141.1">DHT22</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.142.1">DHT11</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.143.1">Power supply</span></span></p>
</td>
<td class="No-Table-Style" colspan="2">
<p><span class="koboSpan" id="kobo.144.1">3.3 </span><span class="No-Break"><span class="koboSpan" id="kobo.145.1">to 5V</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.146.1">Output signal</span></span></p>
</td>
<td class="No-Table-Style" colspan="2">
<p><span class="koboSpan" id="kobo.147.1">Digital signal via a </span><span class="No-Break"><span class="koboSpan" id="kobo.148.1">single bus</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.149.1">Sensing element</span></span></p>
</td>
<td class="No-Table-Style" colspan="2">
<p><span class="No-Break"><span class="koboSpan" id="kobo.150.1">Polymer capacitor</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.151.1">Sensing range</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.152.1">Humidity 0-100% Relative </span><span class="No-Break"><span class="koboSpan" id="kobo.153.1">Humidity (RH)</span></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.154.1">Temperature 40-0°C</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.155.1">Humidity </span><span class="No-Break"><span class="koboSpan" id="kobo.156.1">20-90% RH</span></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.157.1">Temperature 0-50°C</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.158.1">Accuracy</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.159.1">Humidity: +-2% RH (max +-</span><span class="No-Break"><span class="koboSpan" id="kobo.160.1">5% RH)</span></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.161.1">Temperature: &lt;+-0.5°C</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.162.1">Humidity: 1% RH (max </span><span class="No-Break"><span class="koboSpan" id="kobo.163.1">5% RH)</span></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.164.1">Temperature: &lt;2°C</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.165.1">Sensing period</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.166.1">Average </span><span class="No-Break"><span class="koboSpan" id="kobo.167.1">2 s</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.168.1">Average </span><span class="No-Break"><span class="koboSpan" id="kobo.169.1">1 s</span></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.170.1">Table 9.1: DHT22 and DHT11 sensor specification</span></p>
<p><span class="koboSpan" id="kobo.171.1">The main sensor of the project is a capacitive soil moisture sensor and it is used to monitor the soil moisture of a specific area. </span><span class="koboSpan" id="kobo.171.2">It is a low-cost soil moisture monitoring sensor and is rustproof due to its use of PCB (PCB sheets use plastic and paint, making them rustproof). </span><span class="koboSpan" id="kobo.171.3">It senses the soil moisture by passing a small amount of electric current into the soil moisture sensors, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.172.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.173.1">.3</span></em><span class="koboSpan" id="kobo.174.1">, and determining the soil moisture based on the returned</span><a id="_idIndexMarker743"/><span class="koboSpan" id="kobo.175.1"> current. </span><span class="koboSpan" id="kobo.175.2">If the sensor receives a higher </span><a id="_idIndexMarker744"/><span class="koboSpan" id="kobo.176.1">current, then it means the moisture is high; if it receives a low current, then there is little or no moisture content in </span><span class="No-Break"><span class="koboSpan" id="kobo.177.1">the soil.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer136">
<span class="koboSpan" id="kobo.178.1"><img alt="Figure 9.3: Capacitive soil moisture sensor pinout" src="image/B19752_09_03.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.179.1">Figure 9.3: Capacitive soil moisture sensor pinout</span></p>
<p><span class="koboSpan" id="kobo.180.1">The soil moisture sensor consists of three pins: </span><strong class="bold"><span class="koboSpan" id="kobo.181.1">GND</span></strong><span class="koboSpan" id="kobo.182.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.183.1">VCC</span></strong><span class="koboSpan" id="kobo.184.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.185.1">AOUT</span></strong><span class="koboSpan" id="kobo.186.1">. </span><span class="koboSpan" id="kobo.186.2">The sensor provides readings in analog format. </span><span class="koboSpan" id="kobo.186.3">These values will later be converted into percentages using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.187.1">map()</span></strong><span class="koboSpan" id="kobo.188.1"> method under the </span><strong class="source-inline"><span class="koboSpan" id="kobo.189.1">FetchSoilMoisture()</span></strong><span class="koboSpan" id="kobo.190.1"> method. </span><span class="koboSpan" id="kobo.190.2">The complete code is available on GitHub in the folder for this chapter. </span><span class="koboSpan" id="kobo.190.3">The sensor operates with both 5V power as well as 3.3V, but 5V </span><span class="No-Break"><span class="koboSpan" id="kobo.191.1">is recommended.</span></span></p>
<p><span class="koboSpan" id="kobo.192.1">The other main sensor of this project is the DS18B20 waterproof temperature sensor probe, which is used to monitor the soil temperature of a specific area, along with soil moisture levels. </span><span class="koboSpan" id="kobo.192.2">It is a low-cost</span><a id="_idIndexMarker745"/><span class="koboSpan" id="kobo.193.1"> waterproof temperature monitoring sensor and is rustproof due to its steel </span><a id="_idIndexMarker746"/><span class="koboSpan" id="kobo.194.1">enclosure. </span><span class="koboSpan" id="kobo.194.2">The following figure shows the DS18B20 waterproof temperature probe and its pinout and connection diagram with </span><span class="No-Break"><span class="koboSpan" id="kobo.195.1">ESP32-DevKit V1.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer137">
<span class="koboSpan" id="kobo.196.1"><img alt="Figure 9.4: DS18B20 waterproof temperature probe" src="image/B19752_09_04.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.197.1">Figure 9.4: DS18B20 waterproof temperature probe</span></p>
<p><span class="koboSpan" id="kobo.198.1">The preceding figure shows the sensor and its pinout diagram. </span><span class="koboSpan" id="kobo.198.2">DS18B20 contains three colored wires: the black wire is used for GND, the red wire is used to connect VCC either with 3.3V or 5V, and the yellow wire is used to connect with any digital pin but with a 4.7k pull resistor, as shown in the figure. </span><span class="koboSpan" id="kobo.198.3">If we’re talking about sensor specifications, then its temperature sensing range is good – it is capable of measuring a temperature from -55 to 125°C. </span><span class="koboSpan" id="kobo.198.4">All the other details are given in the following table for </span><span class="No-Break"><span class="koboSpan" id="kobo.199.1">further exploration:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table002-3">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.200.1">Feature</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.201.1">DS18B20</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.202.1">Power supply</span></span></p>
</td>
<td class="No-Table-Style">
<p><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.203.1">3.3 </span></span><span class="No-Break" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.204.1">to 5V</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.205.1">Output signal</span></span></p>
</td>
<td class="No-Table-Style">
<p><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.206.1">Digital </span></span><span class="No-Break" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.207.1">signal/one wire</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.208.1">Temperature </span><span class="No-Break"><span class="koboSpan" id="kobo.209.1">sensing range</span></span></p>
</td>
<td class="No-Table-Style">
<p><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.210.1">-</span></span><span class="No-Break" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.211.1">55~125</span></span><span class="No-Break"><span class="koboSpan" id="kobo.212.1">°C</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.213.1">Temperature accuracy</span></span></p>
</td>
<td class="No-Table-Style">
<p><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.214.1">Temperature </span></span><span class="koboSpan" id="kobo.215.1">±</span><span lang="en-US" xml:lang="en-US"> </span><span class="No-Break" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.216.1">0.5</span></span><span class="No-Break"><span class="koboSpan" id="kobo.217.1">°C</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.218.1">Sensing period</span></span></p>
</td>
<td class="No-Table-Style">
<p><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.219.1">&lt;</span></span><span class="No-Break" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.220.1">750 ms</span></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.221.1">Table 9.2 – DS18B20 specification table</span></p>
<p><span class="koboSpan" id="kobo.222.1">In this section, we have discussed </span><a id="_idIndexMarker747"/><span class="koboSpan" id="kobo.223.1">development boards and sensors in detail, with complete specifications </span><a id="_idIndexMarker748"/><span class="koboSpan" id="kobo.224.1">and pinout diagrams. </span><span class="koboSpan" id="kobo.224.2">In the next section, we will talk about how these sensors connect to ESP32-DevKit V1 as well as the PCB design of </span><span class="No-Break"><span class="koboSpan" id="kobo.225.1">the project.</span></span></p>
<h1 id="_idParaDest-200"><a id="_idTextAnchor200"/><span class="koboSpan" id="kobo.226.1">Architecting your agriculture IoT system</span></h1>
<p><span class="koboSpan" id="kobo.227.1">In the previous sections, we discussed </span><a id="_idIndexMarker749"/><span class="koboSpan" id="kobo.228.1">the sensors and development board in detail. </span><span class="koboSpan" id="kobo.228.2">Now it’s time to put things into practice. </span><span class="koboSpan" id="kobo.228.3">In hardware development, before starting to work with sensors and development boards, we need to develop the design concepts to get a better understanding of how things will be connected. </span><span class="koboSpan" id="kobo.228.4">There are many pieces of software available</span><a id="_idIndexMarker750"/><span class="koboSpan" id="kobo.229.1"> to design and develop design concepts for electronic projects, but we are going to </span><span class="No-Break"><span class="koboSpan" id="kobo.230.1">use </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.231.1">Fritzing</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.232.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.233.1">In the following two subsections, we will first talk about the schematics and design of the project and explain how to connect the pins with the development board. </span><span class="koboSpan" id="kobo.233.2">Then, we will talk about PCB design and its implementation to make the product ready for deployment in </span><span class="No-Break"><span class="koboSpan" id="kobo.234.1">the field.</span></span></p>
<h2 id="_idParaDest-201"><a id="_idTextAnchor201"/><span class="koboSpan" id="kobo.235.1">Schematics and design</span></h2>
<p><span class="koboSpan" id="kobo.236.1">The purpose of the design</span><a id="_idIndexMarker751"/><span class="koboSpan" id="kobo.237.1"> is to get a clear understanding of how sensors will connect with the development board. </span><span class="koboSpan" id="kobo.237.2">It helps engineers develop prototypes on a breadboard or Veroboard by basing them on these design files. </span><span class="koboSpan" id="kobo.237.3">A major benefit of designing using Fritzing is that it builds hardware schematics and PCB design in the background according to your design, which can be adjusted by designers according to the system requirements. </span><span class="koboSpan" id="kobo.237.4">The following figure shows the whole project diagram, illustrating how the sensors and ADS1115 module connect to the ESP32-DevKit </span><span class="No-Break"><span class="koboSpan" id="kobo.238.1">V1 board.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer138">
<span class="koboSpan" id="kobo.239.1"><img alt="Figure 9.5: Smart agriculture system design" src="image/B19752_09_05.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.240.1">Figure 9.5: Smart agriculture system design</span></p>
<p><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.241.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.242.1">.5</span></em><span class="koboSpan" id="kobo.243.1"> depicts the whole project</span><a id="_idIndexMarker752"/><span class="koboSpan" id="kobo.244.1"> schematic diagram, which also includes the pin numbers. </span><span class="koboSpan" id="kobo.244.2">But to make it easier for you, we have provided the following tables with all the pin numbers. </span><em class="italic"><span class="koboSpan" id="kobo.245.1">Table 9.3</span></em><span class="koboSpan" id="kobo.246.1"> contains the pin configuration for DHT22 </span><span class="No-Break"><span class="koboSpan" id="kobo.247.1">with ESP32:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table003-1">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.248.1">ESP32</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.249.1">DHT22</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.250.1">D13</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.251.1">Data (I/O)</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.252.1">GND</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.253.1">GND</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.254.1">3.3V</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.255.1">VCC</span></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.256.1">Table 9.3: ESP32 and DHT22 pinout table</span></p>
<p><em class="italic"><span class="koboSpan" id="kobo.257.1">Table 9.4</span></em><span class="koboSpan" id="kobo.258.1"> contains the pin configuration for DS18B20 temperature probes with ESP32. </span><span class="koboSpan" id="kobo.258.2">Here, we are using four DS18B20 temperature probes, and in each column of sensors, we have mentioned the ESP32 pin</span><a id="_idIndexMarker753"/><span class="koboSpan" id="kobo.259.1"> number that will connect with the DS18B20 data pin. </span><span class="koboSpan" id="kobo.259.2">GND and VCC pins of ESP32 development board will be common to </span><span class="No-Break"><span class="koboSpan" id="kobo.260.1">all sensors:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table004">
<colgroup>
<col/>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.261.1">Soil Temperature </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.262.1">Sensor #1</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.263.1">Soil Temperature </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.264.1">Sensor #2</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.265.1">Soil Temperature </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.266.1">Sensor #3</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.267.1">Soil Temperature </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.268.1">Sensor #4</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.269.1">Data pin with </span><span class="No-Break"><span class="koboSpan" id="kobo.270.1">ESP32 (D32)</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.271.1">Data pin with </span><span class="No-Break"><span class="koboSpan" id="kobo.272.1">ESP32 (D33)</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.273.1">Data pin with </span><span class="No-Break"><span class="koboSpan" id="kobo.274.1">ESP32 (D25)</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.275.1">Data pin with </span><span class="No-Break"><span class="koboSpan" id="kobo.276.1">ESP32 (D26)</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.277.1">ESP32 GND </span><span class="No-Break"><span class="koboSpan" id="kobo.278.1">to GND</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.279.1">ESP32 GND </span><span class="No-Break"><span class="koboSpan" id="kobo.280.1">to GND</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.281.1">ESP32 GND </span><span class="No-Break"><span class="koboSpan" id="kobo.282.1">to GND</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.283.1">ESP32 GND </span><span class="No-Break"><span class="koboSpan" id="kobo.284.1">to GND</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.285.1">ESP32 3.3V </span><span class="No-Break"><span class="koboSpan" id="kobo.286.1">to VCC</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.287.1">ESP32 3.3V </span><span class="No-Break"><span class="koboSpan" id="kobo.288.1">to VCC</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.289.1">ESP32 3.3V </span><span class="No-Break"><span class="koboSpan" id="kobo.290.1">to VCC</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.291.1">ESP32 3.3V </span><span class="No-Break"><span class="koboSpan" id="kobo.292.1">to VCC</span></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.293.1">Table 9.4: ESP32 and DS18B20 temperature probes pinout table</span></p>
<p><em class="italic"><span class="koboSpan" id="kobo.294.1">Table 9.5</span></em><span class="koboSpan" id="kobo.295.1"> illustrates ESP32 to ADS1115 pin configuration. </span><span class="koboSpan" id="kobo.295.2">The rest of the soil moisture sensors will connect to the system via ADS1115 analog pins, which are explained in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.296.1">Table 9.6</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.297.1">:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table005">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.298.1">ESP32</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.299.1">ADS1115</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.300.1">D22</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.301.1">SCL</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.302.1">D21</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.303.1">SDA</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.304.1">3.3V</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.305.1">VCC</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.306.1">GND</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.307.1">GND</span></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.308.1">Table 9.5: ESP32 and ADS1115 pinout table</span></p>
<p><span class="koboSpan" id="kobo.309.1">In </span><em class="italic"><span class="koboSpan" id="kobo.310.1">Table 9.6</span></em><span class="koboSpan" id="kobo.311.1">, you will see how we have attached soil moisture</span><a id="_idIndexMarker754"/><span class="koboSpan" id="kobo.312.1"> sensors to the system using ADS1115. </span><span class="koboSpan" id="kobo.312.2">The second row of the table states which pin of ADS1115 will be used to connect soil moisture sensors to </span><span class="No-Break"><span class="koboSpan" id="kobo.313.1">the system:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table006">
<colgroup>
<col/>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.314.1">Soil Moisture </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.315.1">Sensor #1</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.316.1">Soil Moisture </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.317.1">Sensor #2</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.318.1">Soil Moisture </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.319.1">Sensor #3</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.320.1">Soil Moisture </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.321.1">Sensor #4</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.322.1">Soil moisture analog pin to </span><span class="No-Break"><span class="koboSpan" id="kobo.323.1">ADS1115 (A0)</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.324.1">Soil moisture analog pin to </span><span class="No-Break"><span class="koboSpan" id="kobo.325.1">ADS1115 (A1)</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.326.1">Soil moisture analog pin to </span><span class="No-Break"><span class="koboSpan" id="kobo.327.1">ADS1115 (A2)</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.328.1">Soil moisture analog pin to </span><span class="No-Break"><span class="koboSpan" id="kobo.329.1">ADS1115 (A3)</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.330.1">ESP32 GND </span><span class="No-Break"><span class="koboSpan" id="kobo.331.1">to GND</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.332.1">ESP32 GND </span><span class="No-Break"><span class="koboSpan" id="kobo.333.1">to GND</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.334.1">ESP32 GND </span><span class="No-Break"><span class="koboSpan" id="kobo.335.1">to GND</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.336.1">ESP32 GND </span><span class="No-Break"><span class="koboSpan" id="kobo.337.1">to GND</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.338.1">ESP32 VCC </span><span class="No-Break"><span class="koboSpan" id="kobo.339.1">to VCC</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.340.1">ESP32 VCC </span><span class="No-Break"><span class="koboSpan" id="kobo.341.1">to VCC</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.342.1">ESP32 VCC </span><span class="No-Break"><span class="koboSpan" id="kobo.343.1">to VCC</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.344.1">ESP32 VCC </span><span class="No-Break"><span class="koboSpan" id="kobo.345.1">to VCC</span></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.346.1">Table 9.6: ADS1115 and soil moisture sensors pinout table</span></p>
<p><span class="koboSpan" id="kobo.347.1">The preceding design provides a full overview showing how you can connect the sensors to the development board. </span><span class="koboSpan" id="kobo.347.2">According to the design, we have only one 5V and one GND from the development board, which will be used across all the sensors. </span><span class="koboSpan" id="kobo.347.3">Soil moisture sensors are analog sensors, so we connected all the sensors with ADS1115 module pins from the AO pin to the A4 pin, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.348.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.349.1">.5</span></em><span class="koboSpan" id="kobo.350.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.351.1">Table 9.6</span></em><span class="koboSpan" id="kobo.352.1">, while the DHT22 module and DS18B20 are digital sensors and are connected to the D12, D32, D33, D25, and D26 pins of ESP32, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.353.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.354.1">.5</span></em><span class="koboSpan" id="kobo.355.1"> and in </span><em class="italic"><span class="koboSpan" id="kobo.356.1">Table 9.3</span></em><span class="koboSpan" id="kobo.357.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.358.1">Table 9.4</span></em><span class="koboSpan" id="kobo.359.1">, respectively. </span><span class="koboSpan" id="kobo.359.2">The ESP32 to ADS1115 pinout</span><a id="_idIndexMarker755"/><span class="koboSpan" id="kobo.360.1"> is shown in </span><em class="italic"><span class="koboSpan" id="kobo.361.1">Table 9.5</span></em><span class="koboSpan" id="kobo.362.1"> as well as in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.363.1">Figure 9</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.364.1">.5</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.365.1">.</span></span></p>
<h2 id="_idParaDest-202"><a id="_idTextAnchor202"/><span class="koboSpan" id="kobo.366.1">PCB design and the assembly of hardware components</span></h2>
<p><span class="koboSpan" id="kobo.367.1">In the preceding section, we saw</span><a id="_idIndexMarker756"/><span class="koboSpan" id="kobo.368.1"> a design that is good for creating prototypes using</span><a id="_idIndexMarker757"/><span class="koboSpan" id="kobo.369.1"> a breadboard or Veroboard, but what if we want to deploy that solution in the field? </span><span class="koboSpan" id="kobo.369.2">Fritzing is a great tool that provides the option to design a PCB, and when you develop the design, it automatically creates the PCB design in the backend, which is accessible in the Fritzing software via the </span><strong class="bold"><span class="koboSpan" id="kobo.370.1">PCB Design</span></strong><span class="koboSpan" id="kobo.371.1"> tab. </span><span class="koboSpan" id="kobo.371.2">Automatic PCB design is just a basic functionality and is not suitable for direct production, so it’s mandatory to review and rearrange the design according to professional practices. </span><span class="koboSpan" id="kobo.371.3">The following figure shows the PCB design for the </span><span class="No-Break"><span class="koboSpan" id="kobo.372.1">current project.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer139">
<span class="koboSpan" id="kobo.373.1"><img alt="Figure 9.6: Smart agriculture system PCB design" src="image/B19752_09_06.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.374.1">Figure 9.6: Smart agriculture system PCB design</span></p>
<p><span class="koboSpan" id="kobo.375.1">The preceding figure shows</span><a id="_idIndexMarker758"/><span class="koboSpan" id="kobo.376.1"> the final PCB design of the project. </span><span class="koboSpan" id="kobo.376.2">(I was able to create this design easily thanks to Fritzing.) There are many different</span><a id="_idIndexMarker759"/><span class="koboSpan" id="kobo.377.1"> tools </span><a id="_idIndexMarker760"/><span class="koboSpan" id="kobo.378.1">available for PCB design, such as </span><strong class="bold"><span class="koboSpan" id="kobo.379.1">EasyEDA</span></strong><span class="koboSpan" id="kobo.380.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.381.1">Circuit Maker</span></strong><span class="koboSpan" id="kobo.382.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.383.1">Altium</span></strong><span class="koboSpan" id="kobo.384.1">. </span><span class="koboSpan" id="kobo.384.2">It’s easy to develop a PCB; just make </span><a id="_idIndexMarker761"/><span class="koboSpan" id="kobo.385.1">sure that the connection line</span><a id="_idIndexMarker762"/><span class="koboSpan" id="kobo.386.1"> on the PCB doesn’t intersect with other </span><span class="No-Break"><span class="koboSpan" id="kobo.387.1">connection lines.</span></span></p>
<p><span class="koboSpan" id="kobo.388.1">After the PCB design, you have two options: either develop the PCB yourself using the DIY method (which is good for learning purposes but not suitable for large-scale products) or choose a professional organization that will manufacture the PCB professionally. </span><span class="koboSpan" id="kobo.388.2">Many organizations in China provide PCB manufacturing and fabrication services, such as Seeed Studio, JLCPCB, and PCBWay. </span><span class="koboSpan" id="kobo.388.3">We tried PCBWay and were impressed with their working and delivery time. </span><span class="koboSpan" id="kobo.388.4">We have uploaded the PCB design to the PCBWay project repository, and from there, you can select the PCB design and order </span><span class="No-Break"><span class="koboSpan" id="kobo.389.1">easily: </span></span><a href="https://www.pcbway.com/project/shareproject/ESP32_Based_Smart_Agriculture_Node_11223e5a.html"><span class="No-Break"><span class="koboSpan" id="kobo.390.1">https://www.pcbway.com/project/shareproject/ESP32_Based_Smart_Agriculture_Node_11223e5a.html</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.391.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.392.1">After getting the PCBs, it’s time</span><a id="_idIndexMarker763"/><span class="koboSpan" id="kobo.393.1"> to solder the female headers and 2.54 mm three-pin</span><a id="_idIndexMarker764"/><span class="koboSpan" id="kobo.394.1"> connectors for development boards and sensors. </span><span class="koboSpan" id="kobo.394.2">Never solder the development board and sensors directly on a PCB so that if anything stops working, then it’s easy to detach and replace. </span><span class="koboSpan" id="kobo.394.3">The following figure shows the final face of the PCB which contains 2.5mm three-pin connectors in white color for soil moisture sensors, DS18B20 &amp; DHT22 while black female headers are used to insert the ESP32-DevKit V1 and </span><span class="No-Break"><span class="koboSpan" id="kobo.395.1">ADS1115 module.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer140">
<span class="koboSpan" id="kobo.396.1"><img alt="Figure 9.7: Smart agriculture system PCB" src="image/B19752_09_07.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.397.1">Figure 9.7: Smart agriculture system PCB</span></p>
<p><span class="koboSpan" id="kobo.398.1">The preceding figure shows how the PCB</span><a id="_idIndexMarker765"/><span class="koboSpan" id="kobo.399.1"> looks after soldering the three-pin 2.54 mm connectors</span><a id="_idIndexMarker766"/><span class="koboSpan" id="kobo.400.1"> and female headers. </span><span class="koboSpan" id="kobo.400.2">Soil moisture connectors are marked with </span><strong class="bold"><span class="koboSpan" id="kobo.401.1">SM</span></strong><span class="koboSpan" id="kobo.402.1"> while DS18B20 connectors are marked with </span><strong class="bold"><span class="koboSpan" id="kobo.403.1">T</span></strong><span class="koboSpan" id="kobo.404.1"> and resistances are marked with </span><strong class="bold"><span class="koboSpan" id="kobo.405.1">R</span></strong><span class="koboSpan" id="kobo.406.1">, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.407.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.408.1">.7</span></em><span class="koboSpan" id="kobo.409.1">. </span><span class="koboSpan" id="kobo.409.2">Now it’s time to plug all the connectors to get our smart agriculture node ready for further procedures. </span><span class="koboSpan" id="kobo.409.3">But wait – by default, soil moisture sensors come with a very small length of wire, which is not enough, so here you need to extend the cable lengths by putting 2.54 mm female connectors on both ends, as soil moisture sensors also use the same connectors for connectivity. </span><span class="koboSpan" id="kobo.409.4">DS18B20 also comes with a naked terminal but we plugged a 2.54 mm female connector for easy and clean connectivity. </span><span class="koboSpan" id="kobo.409.5">The following figure shows the complete setup with all the sensors and </span><span class="No-Break"><span class="koboSpan" id="kobo.410.1">cabling arrangement.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer141">
<span class="koboSpan" id="kobo.411.1"><img alt="Figure 9.8: Smart agriculture system with all sensors and modules" src="image/B19752_09_08.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.412.1">Figure 9.8: Smart agriculture system with all sensors and modules</span></p>
<p><span class="koboSpan" id="kobo.413.1">The preceding figure shows all the components stacked on the PCB. </span><span class="koboSpan" id="kobo.413.2">We can see that soil moisture sensors are extended with custom cabling with the help of connectors, while the DS18B20 naked terminal is connected to female connectors, and the same for the DHT22 module. </span><span class="koboSpan" id="kobo.413.3">After hardware</span><a id="_idIndexMarker767"/><span class="koboSpan" id="kobo.414.1"> assembly, we need to calibrate the soil moisture</span><a id="_idIndexMarker768"/><span class="koboSpan" id="kobo.415.1"> and DS18B20 temperature before deploying the node into </span><span class="No-Break"><span class="koboSpan" id="kobo.416.1">the field.</span></span></p>
<h1 id="_idParaDest-203"><a id="_idTextAnchor203"/><span class="koboSpan" id="kobo.417.1">Perfecting sensor calibration</span></h1>
<p><span class="koboSpan" id="kobo.418.1">Sensor calibration is a very important</span><a id="_idIndexMarker769"/><span class="koboSpan" id="kobo.419.1"> aspect of product development, especially when you have a plan to deploy your product in a real-time environment. </span><span class="koboSpan" id="kobo.419.2">So, before moving on, first we need to calibrate the capacitive soil moisture and DS18B20 sensors. </span><span class="koboSpan" id="kobo.419.3">The soil moisture sensor operation varies from area to area due to air humidity and </span><span class="No-Break"><span class="koboSpan" id="kobo.420.1">water levels.</span></span></p>
<p><span class="koboSpan" id="kobo.421.1">So firstly, we will calibrate the soil moisture sensor by taking the values of sensors in the air and then putting sensors in the water. </span><span class="koboSpan" id="kobo.421.2">These values will be used to bind the final readings and, finally, we will convert the soil moisture sensor value from 0 to 100% via the map method. </span><span class="koboSpan" id="kobo.421.3">The soil</span><a id="_idIndexMarker770"/><span class="koboSpan" id="kobo.422.1"> moisture sensor is an analog sensor, so there</span><a id="_idIndexMarker771"/><span class="koboSpan" id="kobo.423.1"> is no requirement for an extra helping library, except the </span><strong class="bold"><span class="koboSpan" id="kobo.424.1">ADS module library</span></strong><span class="koboSpan" id="kobo.425.1">, which is shown in the following figure with the name </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.426.1">Adafruit ADS1X15</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.427.1">.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer142">
<span class="koboSpan" id="kobo.428.1"><img alt="Figure 9.9 – ADS1115 library" src="image/B19752_09_09.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.429.1">Figure 9.9 – ADS1115 library</span></p>
<p><span class="koboSpan" id="kobo.430.1">Here, we need to install a library for ADS1115/ADS1015 in the Arduino IDE so we can use the ADS module. </span><span class="koboSpan" id="kobo.430.2">Navigate to </span><strong class="bold"><span class="koboSpan" id="kobo.431.1">Sketch</span></strong><span class="koboSpan" id="kobo.432.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.433.1">Include Library</span></strong><span class="koboSpan" id="kobo.434.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.435.1">Manage Libraries…</span></strong><span class="koboSpan" id="kobo.436.1">, type </span><strong class="source-inline"><span class="koboSpan" id="kobo.437.1">Adafruit ADS1X15</span></strong><span class="koboSpan" id="kobo.438.1">, and install the latest version, which is shown in the preceding figure. </span><span class="koboSpan" id="kobo.438.2">After installation of the library, download the code from the official GitHub book repository and open the code from the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.439.1">Soil-Moisture-Calibration</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.440.1"> folder:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.441.1">
int AirValue[]={0,0,0,0};
int WaterValue[]={0,0,0,0};</span></pre> <p><span class="koboSpan" id="kobo.442.1">The preceding code snippet contains two arrays: one for air values and one for sensor values when they are dipped into the water. </span><span class="koboSpan" id="kobo.442.2">For soil sensor calibration, we need to get </span><strong class="source-inline"><span class="koboSpan" id="kobo.443.1">AirValue</span></strong><span class="koboSpan" id="kobo.444.1"> and then </span><strong class="source-inline"><span class="koboSpan" id="kobo.445.1">WaterValue</span></strong><span class="koboSpan" id="kobo.446.1"> values only by one time. </span><span class="koboSpan" id="kobo.446.2">Upload the code to the development board and make sure your soil moisture sensors are dry. </span><span class="koboSpan" id="kobo.446.3">Open the serial monitor and note down the </span><strong class="source-inline"><span class="koboSpan" id="kobo.447.1">AirValue</span></strong><span class="koboSpan" id="kobo.448.1"> value for each sensor. </span><span class="koboSpan" id="kobo.448.2">After that, dip the sensors into a pot of water and note down the </span><strong class="source-inline"><span class="koboSpan" id="kobo.449.1">WaterValue</span></strong><span class="koboSpan" id="kobo.450.1"> value of </span><span class="No-Break"><span class="koboSpan" id="kobo.451.1">the sensors.</span></span></p>
<p><span class="koboSpan" id="kobo.452.1">Let’s look at the </span><strong class="source-inline"><span class="koboSpan" id="kobo.453.1">AirValue</span></strong><span class="koboSpan" id="kobo.454.1">s of AIN0, AIN1, AIN2, and AIN3, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.455.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.456.1">.10</span></em><span class="koboSpan" id="kobo.457.1">. </span><strong class="bold"><span class="koboSpan" id="kobo.458.1">AIN</span></strong><span class="koboSpan" id="kobo.459.1"> is short for </span><strong class="bold"><span class="koboSpan" id="kobo.460.1">Analog Input</span></strong><span class="koboSpan" id="kobo.461.1"> and the proceeding 0, 1, 2, and 3 are the pin</span><a id="_idIndexMarker772"/><span class="koboSpan" id="kobo.462.1"> numbers of the ADC1115 module where soil moisture</span><a id="_idIndexMarker773"/><span class="koboSpan" id="kobo.463.1"> sensors </span><span class="No-Break"><span class="koboSpan" id="kobo.464.1">are connected:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer143">
<span class="koboSpan" id="kobo.465.1"><img alt="Figure 9.10: Air values of soil moisture sensors" src="image/B19752_09_10.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.466.1">Figure 9.10: Air values of soil moisture sensors</span></p>
<p><span class="koboSpan" id="kobo.467.1">Now let’s look at the </span><strong class="source-inline"><span class="koboSpan" id="kobo.468.1">WaterValue</span></strong><span class="koboSpan" id="kobo.469.1">s after putting the soil moisture sensors in </span><span class="No-Break"><span class="koboSpan" id="kobo.470.1">the water:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer144">
<span class="koboSpan" id="kobo.471.1"><img alt="Figure 9.11: Water values of soil moisture sensors" src="image/B19752_09_11.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.472.1">Figure 9.11: Water values of soil moisture sensors</span></p>
<p><span class="koboSpan" id="kobo.473.1">Wait for some time and note down</span><a id="_idIndexMarker774"/><span class="koboSpan" id="kobo.474.1"> the values when they become stable. </span><span class="koboSpan" id="kobo.474.2">After fetching the </span><strong class="source-inline"><span class="koboSpan" id="kobo.475.1">Air</span></strong><span class="koboSpan" id="kobo.476.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.477.1">Water</span></strong><span class="koboSpan" id="kobo.478.1"> values, put these values into the preceding arrays and upload the code again to the development board. </span><span class="koboSpan" id="kobo.478.2">Verify the values of the soil moisture percentage levels by putting the sensors into the water and then cleaning them. </span><span class="koboSpan" id="kobo.478.3">Here, you will get 100% when sensors are deeply in water and 0% when they </span><span class="No-Break"><span class="koboSpan" id="kobo.479.1">are dry.</span></span></p>
<p><span class="koboSpan" id="kobo.480.1">After the soil moisture levels, it’s time to verify the DS18B20 temperature probe sensor readings. </span><span class="koboSpan" id="kobo.480.2">Firstly, we need to install a library for the DS18B20 temperature sensor. </span><span class="koboSpan" id="kobo.480.3">Navigate to </span><strong class="bold"><span class="koboSpan" id="kobo.481.1">Sketch</span></strong><span class="koboSpan" id="kobo.482.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.483.1">Include Library</span></strong><span class="koboSpan" id="kobo.484.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.485.1">Manage Libraries…</span></strong><span class="koboSpan" id="kobo.486.1">, type </span><strong class="source-inline"><span class="koboSpan" id="kobo.487.1">Dallas Temperature by Miles Burton</span></strong><span class="koboSpan" id="kobo.488.1">, and install the latest version. </span><span class="koboSpan" id="kobo.488.2">After installation of the library, download the code from the official GitHub book repository and open the code from the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.489.1">DS18B20-Calibration</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.490.1"> folder:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.491.1">
OneWire ds18x20[] = {32,33,25,26};</span></pre> <p><span class="koboSpan" id="kobo.492.1">In the preceding code, we have mentioned digital pin numbers, which are reserved on the PCB to connect DS18B20 sensors. </span><span class="koboSpan" id="kobo.492.2">If you are using different pins on the breadboard, then update the pin number according to your selection. </span><span class="koboSpan" id="kobo.492.3">Upload the code on the development board, then after uploading, open up the serial monitor and see whether you are getting the values from the sensors or not. </span><span class="koboSpan" id="kobo.492.4">The following figure shows the DS18B20 temperature probe readings on the serial monitor for </span><span class="No-Break"><span class="koboSpan" id="kobo.493.1">calibration purposes.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer145">
<span class="koboSpan" id="kobo.494.1"><img alt="Figure 9.12: DS18B20 temperature sensor values on the Serial Monitor" src="image/B19752_09_12.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.495.1">Figure 9.12: DS18B20 temperature sensor values on the Serial Monitor</span></p>
<p><span class="koboSpan" id="kobo.496.1">The preceding figure shows that</span><a id="_idIndexMarker775"/><span class="koboSpan" id="kobo.497.1"> the DS18B20 temperature sensors are working fine and the values are stabilized. </span><span class="koboSpan" id="kobo.497.2">Now, we can move forward with </span><span class="No-Break"><span class="koboSpan" id="kobo.498.1">lab calibration.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.499.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.500.1">A 4.7k </span><strong class="bold"><span class="koboSpan" id="kobo.501.1">pull resistor</span></strong><span class="koboSpan" id="kobo.502.1"> is mandatory for DS18B20. </span><span class="koboSpan" id="kobo.502.2">Without </span><a id="_idIndexMarker776"/><span class="koboSpan" id="kobo.503.1">pull-up resistor, you will not get </span><span class="No-Break"><span class="koboSpan" id="kobo.504.1">the values.</span></span></p>
<p><span class="koboSpan" id="kobo.505.1">After the soil moisture sensors have tested with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.506.1">Air</span></strong><span class="koboSpan" id="kobo.507.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.508.1">Water</span></strong><span class="koboSpan" id="kobo.509.1"> values, it’s time to calibrate both sensors in the lab. </span><span class="koboSpan" id="kobo.509.2">For moisture testing, we used the hot air oven method to verify the accuracy of the soil moisture sensor. </span><span class="koboSpan" id="kobo.509.3">We added water to soil, sand, and salt at different levels and measured it with sensors. </span><span class="koboSpan" id="kobo.509.4">After that, we inserted these samples into a hot air oven and compared the sensor readings between the two methods; the results were incredible: only a ±0.5 difference. </span><span class="koboSpan" id="kobo.509.5">For DS18B20, we used a calibrated analog thermometer and observed only a ±0.5 difference. </span><span class="koboSpan" id="kobo.509.6">The following figure shows a photo of the lab where we calibrated the soil moisture and DS18B20 sensors to </span><span class="No-Break"><span class="koboSpan" id="kobo.510.1">industry standards.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer146">
<span class="koboSpan" id="kobo.511.1"><img alt="Figure 9.13: Moisture sensor and temperature sensor calibration in the lab" src="image/B19752_09_13.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.512.1">Figure 9.13: Moisture sensor and temperature sensor calibration in the lab</span></p>
<p><span class="koboSpan" id="kobo.513.1">The preceding figure shows the calibration of sensors in the lab. </span><span class="koboSpan" id="kobo.513.2">Here, we have tested the sensors with soil, sand, </span><span class="No-Break"><span class="koboSpan" id="kobo.514.1">and salt.</span></span></p>
<p><span class="koboSpan" id="kobo.515.1">In this section, we discussed sensors and their connection to ES32-DevKit V1 using a schematic diagram, as well as PCB design and its implementation. </span><span class="koboSpan" id="kobo.515.2">After that, we discussed soil moisture and DS18B20 sensor</span><a id="_idIndexMarker777"/><span class="koboSpan" id="kobo.516.1"> calibration. </span><span class="koboSpan" id="kobo.516.2">In the upcoming section, we will set up things, network credentials, and cloud variables and look into </span><span class="No-Break"><span class="koboSpan" id="kobo.517.1">the code.</span></span></p>
<h1 id="_idParaDest-204"><a id="_idTextAnchor204"/><span class="koboSpan" id="kobo.518.1">Setting up things, networks, and cloud variables</span></h1>
<p><span class="koboSpan" id="kobo.519.1">After setting up the hardware, it’s time</span><a id="_idIndexMarker778"/><span class="koboSpan" id="kobo.520.1"> to set up a thing in the</span><a id="_idIndexMarker779"/><span class="koboSpan" id="kobo.521.1"> Arduino IoT Cloud. </span><span class="koboSpan" id="kobo.521.2">For this project, we need 10 cloud variables</span><a id="_idIndexMarker780"/><span class="koboSpan" id="kobo.522.1"> to fetch monitoring parameters from the device; the network settings will be different due to the ESP series board. </span><span class="koboSpan" id="kobo.522.2">The following figure gives a complete overview of the </span><strong class="bold"><span class="koboSpan" id="kobo.523.1">AgriStack</span></strong><span class="koboSpan" id="kobo.524.1"> Thing we will </span><span class="No-Break"><span class="koboSpan" id="kobo.525.1">set up.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer147">
<span class="koboSpan" id="kobo.526.1"><img alt="Figure 9.14: Smart agriculture system thing setup" src="image/B19752_09_14.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.527.1">Figure 9.14: Smart agriculture system thing setup</span></p>
<p><span class="koboSpan" id="kobo.528.1">Set up a new thing with the name </span><strong class="source-inline"><span class="koboSpan" id="kobo.529.1">AgriStack</span></strong><span class="koboSpan" id="kobo.530.1">. </span><span class="koboSpan" id="kobo.530.2">Follow these steps to create variables, an associated device, network configuration, and, finally, the code. </span><span class="koboSpan" id="kobo.530.3">We have marked the preceding figure with different red boxes</span><a id="_idIndexMarker781"/><span class="koboSpan" id="kobo.531.1"> and assigned numbers. </span><span class="koboSpan" id="kobo.531.2">These numbers correspond </span><a id="_idIndexMarker782"/><span class="koboSpan" id="kobo.532.1">to the following </span><a id="_idIndexMarker783"/><span class="koboSpan" id="kobo.533.1">steps, which will help you to set up </span><span class="No-Break"><span class="koboSpan" id="kobo.534.1">the Thing:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.535.1">Firstly, we need to set up 10 cloud variables, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.536.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.537.1">.14</span></em><span class="koboSpan" id="kobo.538.1">. </span><span class="koboSpan" id="kobo.538.2">There are two cloud variables for outdoor temperature and humidity; these values will be taken from DHT22. </span><span class="koboSpan" id="kobo.538.3">There are four cloud variables for soil moisture and four variables for soil temperature. </span><span class="koboSpan" id="kobo.538.4">The previous four will use soil moisture sensor and the latter four will use the DS18B20 temperature probe. </span><span class="koboSpan" id="kobo.538.5">More details about cloud variables are available in the </span><span class="No-Break"><span class="koboSpan" id="kobo.539.1">next subsection.</span></span></li>
<li><span class="koboSpan" id="kobo.540.1">After that, we need to associate the device with the Thing. </span><span class="koboSpan" id="kobo.540.2">In the current project, we are going to use ESP32-DevKit V1, so the wizard will be different compared to Arduino boards. </span><span class="koboSpan" id="kobo.540.3">Complete details are available in the </span><em class="italic"><span class="koboSpan" id="kobo.541.1">Associating a </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.542.1">device</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.543.1"> section.</span></span></li>
<li><span class="koboSpan" id="kobo.544.1">Finally, we need to set up the network configuration for the device, but this time, we need to provide a security key for ESP series boards to make the connection secure, whereas Arduino-compatible boards are configured by the Arduino IoT Cloud</span><a id="_idIndexMarker784"/><span class="koboSpan" id="kobo.545.1"> automatically during </span><a id="_idIndexMarker785"/><span class="koboSpan" id="kobo.546.1">the device </span><span class="No-Break"><span class="koboSpan" id="kobo.547.1">setup </span></span><span class="No-Break"><a id="_idIndexMarker786"/></span><span class="No-Break"><span class="koboSpan" id="kobo.548.1">wizard.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.549.1">Here, we have discussed the different steps that help us to set up our thing. </span><span class="koboSpan" id="kobo.549.2">In the proceeding section, we will start looking into </span><span class="No-Break"><span class="koboSpan" id="kobo.550.1">cloud variables.</span></span></p>
<h2 id="_idParaDest-205"><a id="_idTextAnchor205"/><span class="koboSpan" id="kobo.551.1">Cloud variables</span></h2>
<p><span class="koboSpan" id="kobo.552.1">The following table explains</span><a id="_idIndexMarker787"/><span class="koboSpan" id="kobo.553.1"> all the properties of variables</span><a id="_idIndexMarker788"/><span class="koboSpan" id="kobo.554.1"> that we need to use during cloud variable creation. </span><span class="koboSpan" id="kobo.554.2">An integer (</span><strong class="source-inline"><span class="koboSpan" id="kobo.555.1">int</span></strong><span class="koboSpan" id="kobo.556.1">) is a very famous data type, but here you will observe two new variable types regarding humidity and temperature, which take values in percentage and Celsius, respectively. </span><span class="koboSpan" id="kobo.556.2">Also, ensure you have the same variable declaration as per the table; otherwise, you will need to modify the example code according to </span><span class="No-Break"><span class="koboSpan" id="kobo.557.1">your naming.</span></span></p>
<p><span class="koboSpan" id="kobo.558.1">We have set the permission of all cloud variables to </span><strong class="bold"><span class="koboSpan" id="kobo.559.1">Read Only</span></strong><span class="koboSpan" id="kobo.560.1">, but we also have the </span><strong class="bold"><span class="koboSpan" id="kobo.561.1">Read/Write</span></strong><span class="koboSpan" id="kobo.562.1"> option. </span><span class="koboSpan" id="kobo.562.2">In this project, we only want to receive data from the device instead of sending data from dashboard, which is why </span><strong class="bold"><span class="koboSpan" id="kobo.563.1">Read Only</span></strong><span class="koboSpan" id="kobo.564.1"> mode is used, to avoid issues with data consistency. </span><strong class="bold"><span class="koboSpan" id="kobo.565.1">Update Policy</span></strong><span class="koboSpan" id="kobo.566.1"> is set to </span><strong class="bold"><span class="koboSpan" id="kobo.567.1">On change</span></strong><span class="koboSpan" id="kobo.568.1">, as the device will send the data after five minutes, so this option is more appropriate compared to </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.569.1">Periodically update</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.570.1">:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table007">
<colgroup>
<col/>
<col/>
<col/>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.571.1">Serial </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.572.1">no.</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.573.1">Variable Name</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.574.1">Variable Type</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.575.1">Declaration</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.576.1">Permission</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.577.1">Update </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.578.1">Policy</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.579.1">1</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.580.1">Humidity</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.581.1">CloudRelativeHumidity</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.582.1">humidity</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.583.1">Read Only</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.584.1">On change</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.585.1">2</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.586.1">Temperature</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.587.1">CloudTemperatureSensor</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.588.1">temperature</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.589.1">Read Only</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.590.1">On change</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.591.1">3</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.592.1">SM1</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.593.1">int</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.594.1">sM1</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.595.1">Read Only</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.596.1">On change</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.597.1">4</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.598.1">SM2</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.599.1">int</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.600.1">sM2</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.601.1">Read Only</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.602.1">On change</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.603.1">5</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.604.1">SM3</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.605.1">int</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.606.1">sM3</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.607.1">Read Only</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.608.1">On change</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.609.1">6</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.610.1">SM4</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.611.1">int</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.612.1">sM4</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.613.1">Read Only</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.614.1">On change</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.615.1">7</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.616.1">ST1</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.617.1">int</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.618.1">sT1</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.619.1">Read Only</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.620.1">On change</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.621.1">8</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.622.1">ST2</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.623.1">int</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.624.1">sT2</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.625.1">Read Only</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.626.1">On change</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.627.1">9</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.628.1">ST3</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.629.1">int</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.630.1">sT3</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.631.1">Read Only</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.632.1">On change</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.633.1">10</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.634.1">ST4</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.635.1">int</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.636.1">sT4</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.637.1">Read Only</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.638.1">On change</span></strong></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.639.1">Table 9.7: Cloud variables list with complete parameters</span></p>
<p><span class="koboSpan" id="kobo.640.1">After the successful creation</span><a id="_idIndexMarker789"/><span class="koboSpan" id="kobo.641.1"> of cloud variables, we will proceed further with the device association step, where we will add and associate the ESP32-DevKit V1 with</span><a id="_idIndexMarker790"/> <span class="No-Break"><span class="koboSpan" id="kobo.642.1">our thing.</span></span></p>
<h3><span class="koboSpan" id="kobo.643.1">Associating a device</span></h3>
<p><span class="koboSpan" id="kobo.644.1">After variable</span><a id="_idIndexMarker791"/><span class="koboSpan" id="kobo.645.1"> creation, it’s time to add a device and associate it with the Thing. </span><span class="koboSpan" id="kobo.645.2">Before adding the device, connect the development board to the computer, and open the </span><strong class="bold"><span class="koboSpan" id="kobo.646.1">Arduino Create Agent</span></strong><span class="koboSpan" id="kobo.647.1"> application. </span><span class="koboSpan" id="kobo.647.2">We discussed the Arduino Create Agent in </span><a href="B19752_02.xhtml#_idTextAnchor038"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.648.1">Chapter 2</span></em></span></a><span class="koboSpan" id="kobo.649.1">, in the </span><em class="italic"><span class="koboSpan" id="kobo.650.1">What is the Arduino Create </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.651.1">Agent?</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.652.1"> section.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer148">
<span class="koboSpan" id="kobo.653.1"><img alt="Figure 9.15: Device selection wizard" src="image/B19752_09_15.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.654.1">Figure 9.15: Device selection wizard</span></p>
<p><span class="koboSpan" id="kobo.655.1">Click on the </span><strong class="bold"><span class="koboSpan" id="kobo.656.1">Select Device</span></strong><span class="koboSpan" id="kobo.657.1"> button under the </span><strong class="bold"><span class="koboSpan" id="kobo.658.1">Associated Device</span></strong><span class="koboSpan" id="kobo.659.1"> section on the Thing page. </span><span class="koboSpan" id="kobo.659.2">A popup will appear where you can see all the devices that are already available. </span><span class="koboSpan" id="kobo.659.3">If you have already added your WeMos D1 mini, select it. </span><span class="koboSpan" id="kobo.659.4">Otherwise, click on </span><strong class="bold"><span class="koboSpan" id="kobo.660.1">SET UP NEW DEVICE</span></strong><span class="koboSpan" id="kobo.661.1">. </span><span class="koboSpan" id="kobo.661.2">Next, click on the </span><strong class="bold"><span class="koboSpan" id="kobo.662.1">Set up a 3rd party device</span></strong><span class="koboSpan" id="kobo.663.1"> option. </span><span class="koboSpan" id="kobo.663.2">Select </span><strong class="bold"><span class="koboSpan" id="kobo.664.1">ESP32</span></strong><span class="koboSpan" id="kobo.665.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.666.1">DOIT ESP32 DEVKIT V1</span></strong><span class="koboSpan" id="kobo.667.1"> from the dropdown and click on the </span><strong class="bold"><span class="koboSpan" id="kobo.668.1">CONTINUE</span></strong><span class="koboSpan" id="kobo.669.1"> button. </span><span class="koboSpan" id="kobo.669.2">Provide the device name and click on the </span><strong class="bold"><span class="koboSpan" id="kobo.670.1">Next</span></strong><span class="koboSpan" id="kobo.671.1"> button. </span><span class="koboSpan" id="kobo.671.2">In the final wizard, the </span><strong class="bold"><span class="koboSpan" id="kobo.672.1">Device ID</span></strong><span class="koboSpan" id="kobo.673.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.674.1">Secret Key</span></strong><span class="koboSpan" id="kobo.675.1"> details will be displayed. </span><span class="koboSpan" id="kobo.675.2">Copy the secret key to a safe place as it will be used during</span><a id="_idIndexMarker792"/><span class="koboSpan" id="kobo.676.1"> the </span><span class="No-Break"><span class="koboSpan" id="kobo.677.1">network configuration.</span></span></p>
<h2 id="_idParaDest-206"><a id="_idTextAnchor206"/><span class="koboSpan" id="kobo.678.1">Network configuration</span></h2>
<p><span class="koboSpan" id="kobo.679.1">After associating</span><a id="_idIndexMarker793"/><span class="koboSpan" id="kobo.680.1"> the device with the Thing, it is time to configure the Wi-Fi settings for device communication, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.681.1">Figure 9</span></em></span><em class="italic"><span class="koboSpan" id="kobo.682.1">.14</span></em><span class="koboSpan" id="kobo.683.1">, in the area marked </span><em class="italic"><span class="koboSpan" id="kobo.684.1">3</span></em><span class="koboSpan" id="kobo.685.1">. </span><span class="koboSpan" id="kobo.685.2">Under </span><strong class="bold"><span class="koboSpan" id="kobo.686.1">Network</span></strong><span class="koboSpan" id="kobo.687.1">, you will find the option to fill in the form with the Wi-Fi name and password. </span><span class="koboSpan" id="kobo.687.2">In the last field, you will find a new field for the secret key. </span><span class="koboSpan" id="kobo.687.3">Paste the secret key that we received from the system during </span><span class="No-Break"><span class="koboSpan" id="kobo.688.1">device creation.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer149">
<span class="koboSpan" id="kobo.689.1"><img alt="Figure 9.16: Network configuration for the Thing" src="image/B19752_09_16.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.690.1">Figure 9.16: Network configuration for the Thing</span></p>
<p><span class="koboSpan" id="kobo.691.1">After network configuration, we are done with our main task; now, the coding task remains, and in the</span><a id="_idIndexMarker794"/><span class="koboSpan" id="kobo.692.1"> next section, we will go </span><span class="No-Break"><span class="koboSpan" id="kobo.693.1">through it.</span></span></p>
<h2 id="_idParaDest-207"><a id="_idTextAnchor207"/><span class="koboSpan" id="kobo.694.1">Coding</span></h2>
<p><span class="koboSpan" id="kobo.695.1">The project code</span><a id="_idIndexMarker795"/><span class="koboSpan" id="kobo.696.1"> is available in the book’s official GitHub repository in a ZIP file named </span><strong class="source-inline"><span class="koboSpan" id="kobo.697.1">AgriStack_mar05a</span></strong><span class="koboSpan" id="kobo.698.1">. </span><span class="koboSpan" id="kobo.698.2">Download it and import it to your Arduino </span><span class="No-Break"><span class="koboSpan" id="kobo.699.1">Web Editor.</span></span></p>
<p><span class="koboSpan" id="kobo.700.1">You can download the code and put it into your thing by navigating to the </span><strong class="bold"><span class="koboSpan" id="kobo.701.1">Sketch</span></strong><span class="koboSpan" id="kobo.702.1"> tab. </span><span class="koboSpan" id="kobo.702.2">I am not going to discuss that code as you will get the idea after reading it. </span><span class="koboSpan" id="kobo.702.3">But here, I will explain the main workflow: we initialize all the things in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.703.1">setup</span></strong><span class="koboSpan" id="kobo.704.1"> method and use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.705.1">timer</span></strong><span class="koboSpan" id="kobo.706.1"> library to delay calling; remember, never try to use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.707.1">delay</span></strong><span class="koboSpan" id="kobo.708.1"> method as it will block the </span><strong class="source-inline"><span class="koboSpan" id="kobo.709.1">ArduinoCloud.update()</span></strong><span class="koboSpan" id="kobo.710.1"> method. </span><span class="koboSpan" id="kobo.710.2">Then, a method called </span><strong class="source-inline"><span class="koboSpan" id="kobo.711.1">SmartAgri()</span></strong><span class="koboSpan" id="kobo.712.1"> is called every five minutes. </span><span class="koboSpan" id="kobo.712.2">The following is the complete </span><strong class="source-inline"><span class="koboSpan" id="kobo.713.1">SmartAgri()</span></strong><span class="koboSpan" id="kobo.714.1"> method. </span><span class="koboSpan" id="kobo.714.2">After this, we will explore what operations are carried out by </span><span class="No-Break"><span class="koboSpan" id="kobo.715.1">this method:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.716.1">
bool SmartAgri(void *){
  //Fetch Soil Moisture
  FetchSoilMoisture();
  //Fetch Soil Temperature
  FetchTemperature();
  //Fetch DHT Temp &amp; Humiditiy
  FetchDHTTempHum();
  //Send Data To Arduino IoT Cloud
  SendToArduinoIoTCloud();
  //Print The Readings on Serial Port
  PrintTheReadingsSerialPort();
  return true;
}</span></pre> <p><span class="koboSpan" id="kobo.717.1">In this project, we have divided all the operations into different methods for easiness. </span><span class="koboSpan" id="kobo.717.2">So, firstly, we are calling </span><strong class="source-inline"><span class="koboSpan" id="kobo.718.1">FetchSoilMoisture()</span></strong><span class="koboSpan" id="kobo.719.1">, which is responsible for fetching soil moisture readings from sensors and storing them in an array. </span><span class="koboSpan" id="kobo.719.2">Before storing the data in an array, it maps the value for the percentage. </span><span class="koboSpan" id="kobo.719.3">Next, we have the </span><strong class="source-inline"><span class="koboSpan" id="kobo.720.1">FetchTemperature()</span></strong><span class="koboSpan" id="kobo.721.1"> method, which is responsible for fetching the temperatures from all DS18B20 sensors and saving them into the soil temperature array for further usage. </span><span class="koboSpan" id="kobo.721.2">Finally, we call </span><strong class="source-inline"><span class="koboSpan" id="kobo.722.1">FetchDHTTempHum()</span></strong><span class="koboSpan" id="kobo.723.1"> to fetch the outdoor temperature and humidity values from the DHT22 module, which will be stored in two variables. </span><span class="koboSpan" id="kobo.723.2">Now, we will explore how we get the values</span><a id="_idIndexMarker796"/><span class="koboSpan" id="kobo.724.1"> from the soil moisture sensors in the </span><span class="No-Break"><span class="koboSpan" id="kobo.725.1">following method:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.726.1">
float getSoilMoisture(int Pin){
  float SoilMoisture=0;
    //loop 10 times for averaging
  for(int j = 0; j &lt; 5; j++){
    delay(1000);
    SoilMoisture+= ads.readADC_SingleEnded(Pin);
  }
  //divide by 5 to get the average
  SoilMoisture /= 5;
  return SoilMoisture;
 }</span></pre> <p><span class="koboSpan" id="kobo.727.1">The preceding technique is used in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.728.1">FetchSoilMoisture()</span></strong><span class="koboSpan" id="kobo.729.1"> method to fetch the readings for soil moisture. </span><span class="koboSpan" id="kobo.729.2">Here, you will see that the method takes values from the sensor five times with a delay of one second and adds them to the variable; then later, it divides the sensor readings by 5 to get the average. </span><span class="koboSpan" id="kobo.729.3">The benefit of this technique is that you will get the best possible value from the </span><span class="No-Break"><span class="koboSpan" id="kobo.730.1">soil sensor.</span></span></p>
<p><span class="koboSpan" id="kobo.731.1">The previous three methods have been used to fetch values from different sensors and store them in global variables and arrays. </span><span class="koboSpan" id="kobo.731.2">Now it’s time to send these values to the Arduino IoT Cloud; for that reason, we have the </span><strong class="source-inline"><span class="koboSpan" id="kobo.732.1">SendToArduinoIoTCloud()</span></strong><span class="koboSpan" id="kobo.733.1"> method, which assigns all the values of sensors to cloud variables, and these values will be updated on the cloud with the help of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.734.1">ArduinoCloud.update()</span></strong><span class="koboSpan" id="kobo.735.1"> method. </span><span class="koboSpan" id="kobo.735.2">At the end, we have the </span><strong class="source-inline"><span class="koboSpan" id="kobo.736.1">PrintTheReadingsSerialPort()</span></strong><span class="koboSpan" id="kobo.737.1"> method, which is optional for use at runtime and is used to display all the sensor values on the </span><span class="No-Break"><span class="koboSpan" id="kobo.738.1">serial monitor.</span></span></p>
<p><span class="koboSpan" id="kobo.739.1">Upload the code to the device</span><a id="_idIndexMarker797"/><span class="koboSpan" id="kobo.740.1"> and verify the connectivity and readings. </span><span class="koboSpan" id="kobo.740.2">If you want to change the reading time, then just modify the </span><strong class="source-inline"><span class="koboSpan" id="kobo.741.1">timer.every(600000, SmartAgri);</span></strong><span class="koboSpan" id="kobo.742.1"> value. </span><span class="koboSpan" id="kobo.742.2">Make sure you are providing the time in milliseconds, where 1 second equals </span><span class="No-Break"><span class="koboSpan" id="kobo.743.1">1,000 milliseconds.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.744.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.745.1">If you used a different naming scheme in the variable declaration, then update the code according to your naming scheme. </span><span class="koboSpan" id="kobo.745.2">But first, you should follow all the steps according to the book and then you can later change the cloud variable names and modify your </span><span class="No-Break"><span class="koboSpan" id="kobo.746.1">code, respectively.</span></span></p>
<p class="callout"><span class="koboSpan" id="kobo.747.1">Never try to use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.748.1">delay</span></strong><span class="koboSpan" id="kobo.749.1"> method, as it will block the </span><strong class="source-inline"><span class="koboSpan" id="kobo.750.1">ArduinoCloud.update()</span></strong><span class="koboSpan" id="kobo.751.1"> method. </span><span class="koboSpan" id="kobo.751.2">Always use milliseconds to calculate the waiting time. </span><span class="koboSpan" id="kobo.751.3">Review the </span><strong class="source-inline"><span class="koboSpan" id="kobo.752.1">loop()</span></strong><span class="koboSpan" id="kobo.753.1"> method to call the other methods after </span><span class="No-Break"><span class="koboSpan" id="kobo.754.1">five minutes.</span></span></p>
<p class="callout"><span class="koboSpan" id="kobo.755.1">The Arduino IoT Cloud only updates the value on the dashboard whenever the variable value is changed. </span><span class="koboSpan" id="kobo.755.2">For example, if the temperature is 30°C and it’s the same after five minutes, then the Arduino IoT Cloud will not record the value, so don’t get confused if values are not changing on the graph. </span><span class="koboSpan" id="kobo.755.3">Another benefit of this feature is you will not get duplicated data when you are exporting </span><span class="No-Break"><span class="koboSpan" id="kobo.756.1">the content.</span></span></p>
<p><span class="koboSpan" id="kobo.757.1">After successfully discussing the different methods in the code and uploading the code to ESP32-DevKit V1, it’s time</span><a id="_idIndexMarker798"/><span class="koboSpan" id="kobo.758.1"> to explore how to visualize all the data using awesome Arduino IoT Cloud </span><span class="No-Break"><span class="koboSpan" id="kobo.759.1">dashboard widgets.</span></span></p>
<h1 id="_idParaDest-208"><a id="_idTextAnchor208"/><span class="koboSpan" id="kobo.760.1">Creating web and mobile dashboards</span></h1>
<p><span class="koboSpan" id="kobo.761.1">After uploading the code</span><a id="_idIndexMarker799"/><span class="koboSpan" id="kobo.762.1"> to the device, it’s time to set up a dashboard for web and mobile</span><a id="_idIndexMarker800"/><span class="koboSpan" id="kobo.763.1"> to visualize the data with different widgets. </span><span class="koboSpan" id="kobo.763.2">The following figure shows the visualization of readings with </span><span class="No-Break"><span class="koboSpan" id="kobo.764.1">different widgets:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer150">
<span class="koboSpan" id="kobo.765.1"><img alt="Figure 9.17: Thing dashboard" src="image/B19752_09_17.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.766.1">Figure 9.17: Thing dashboard</span></p>
<p><span class="koboSpan" id="kobo.767.1">We have 10 different readings: </span><strong class="bold"><span class="koboSpan" id="kobo.768.1">Outdoor Temperature</span></strong><span class="koboSpan" id="kobo.769.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.770.1">Outdoor Humidity</span></strong><span class="koboSpan" id="kobo.771.1">, four </span><strong class="bold"><span class="koboSpan" id="kobo.772.1">Soil Moisture</span></strong><span class="koboSpan" id="kobo.773.1"> readings, and four </span><strong class="bold"><span class="koboSpan" id="kobo.774.1">Soil Temperature</span></strong><span class="koboSpan" id="kobo.775.1"> readings. </span><span class="koboSpan" id="kobo.775.2">For every reading, we are using the gauge widget control, and advanced charts have been used to compare </span><strong class="bold"><span class="koboSpan" id="kobo.776.1">Soil Moisture</span></strong><span class="koboSpan" id="kobo.777.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.778.1">Soil Temperature</span></strong><span class="koboSpan" id="kobo.779.1"> to visualize the proper correlation between these two attributes. </span><span class="koboSpan" id="kobo.779.2">But we also want to monitor historical data; graphs are the best widgets to display live as well as older data. </span><span class="koboSpan" id="kobo.779.3">Here, as seen in the lower part of the preceding figure, we have used four graphs, and each graph is connected to a specific </span><span class="No-Break"><span class="koboSpan" id="kobo.780.1">cloud variable.</span></span></p>
<p><span class="koboSpan" id="kobo.781.1">In this section, we have successfully</span><a id="_idIndexMarker801"/><span class="koboSpan" id="kobo.782.1"> created a dashboard for a smart agriculture</span><a id="_idIndexMarker802"/><span class="koboSpan" id="kobo.783.1"> thing that shows all the sensor readings in text format, as well as used graphs for </span><span class="No-Break"><span class="koboSpan" id="kobo.784.1">comparison purposes.</span></span></p>
<h1 id="_idParaDest-209"><a id="_idTextAnchor209"/><span class="koboSpan" id="kobo.785.1">What next?</span></h1>
<p><span class="koboSpan" id="kobo.786.1">We still have a lot of options available to explore, but now it’s your turn to use different sensors and development boards to do some more experiments and learn from them. </span><span class="koboSpan" id="kobo.786.2">In this chapter, we used 10 sensors but only 3 different types, that is, moisture, temperature, and outdoor temperature and humidity. </span><span class="koboSpan" id="kobo.786.3">However, on the market, there are a lot of sensors that provide a wide variety of functionalities for soil, such as </span><strong class="bold"><span class="koboSpan" id="kobo.787.1">NPK</span></strong><span class="koboSpan" id="kobo.788.1"> (which stands for </span><strong class="bold"><span class="koboSpan" id="kobo.789.1">nitrogen, phosphorus, and potassium</span></strong><span class="koboSpan" id="kobo.790.1">), </span><strong class="bold"><span class="koboSpan" id="kobo.791.1">EC</span></strong><span class="koboSpan" id="kobo.792.1"> (which stands for </span><strong class="bold"><span class="koboSpan" id="kobo.793.1">electrical conductivity</span></strong><span class="koboSpan" id="kobo.794.1">), and pH sensors and different gas sensors for </span><span class="No-Break"><span class="koboSpan" id="kobo.795.1">outdoor measurement.</span></span></p>
<p><span class="koboSpan" id="kobo.796.1">Try the following sensors to enhance your practical knowledge and compare them with other sensors in terms of features, ranges, </span><span class="No-Break"><span class="koboSpan" id="kobo.797.1">and cost:</span></span></p>
<ul>
<li><span class="No-Break"><span class="koboSpan" id="kobo.798.1">NPK sensor</span></span></li>
<li><span class="koboSpan" id="kobo.799.1">Soil </span><span class="No-Break"><span class="koboSpan" id="kobo.800.1">EC sensor</span></span></li>
<li><span class="koboSpan" id="kobo.801.1">Soil </span><span class="No-Break"><span class="koboSpan" id="kobo.802.1">pH sensor</span></span></li>
<li><span class="koboSpan" id="kobo.803.1">MQ series sensors, which are designed to sense specific gases, including MQ-2, MQ-3, MQ-4, MQ-5, MQ-7, MQ-8, and MQ-9, to find the correlation of gases and their effects on soil </span><span class="No-Break"><span class="koboSpan" id="kobo.804.1">and crops</span></span></li>
<li><span class="koboSpan" id="kobo.805.1">Seeed Studio SCD30 (temperature, humidity, and CO</span><span class="subscript"><span class="koboSpan" id="kobo.806.1">2</span></span><span class="koboSpan" id="kobo.807.1">) for </span><span class="No-Break"><span class="koboSpan" id="kobo.808.1">outdoor monitoring</span></span></li>
</ul>
<h1 id="_idParaDest-210"><a id="_idTextAnchor210"/><span class="koboSpan" id="kobo.809.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.810.1">In this chapter, we explored how to develop a smart agriculture monitoring system using DHT22, capacitive soil moisture sensors, a DS18B20 probe for soil temperature, and an ESP32 development board along with the ADS1115 ADC module. </span><span class="koboSpan" id="kobo.810.2">We calibrated soil moisture and temperature sensors in the lab before using them in the field. </span><span class="koboSpan" id="kobo.810.3">We also set up a thing, which included creating cloud variables, device association, network configuration, and coding of the development board. </span><span class="koboSpan" id="kobo.810.4">Then, we created a dashboard to visualize the Thing’s sensor readings with different types of widgets to display current readings as well as historical data with the help </span><span class="No-Break"><span class="koboSpan" id="kobo.811.1">of graphs.</span></span></p>
<p><span class="koboSpan" id="kobo.812.1">This project will help you and give you the confidence to collaborate with agriculture researchers and soil scientists to work on a more advanced level. </span><span class="koboSpan" id="kobo.812.2">It will help you to add IoT systems to real fields and tunnel farms, as well as help you in </span><span class="No-Break"><span class="koboSpan" id="kobo.813.1">home gardening.</span></span></p>
<p><span class="koboSpan" id="kobo.814.1">In the next chapter, we will work on a smart home project where we will develop a smart RGB LED light that will be connected to the Amazon Alexa Voice assistant and help you to understand and develop smart </span><span class="No-Break"><span class="koboSpan" id="kobo.815.1">home solutions.</span></span></p>
</div>
</body></html>