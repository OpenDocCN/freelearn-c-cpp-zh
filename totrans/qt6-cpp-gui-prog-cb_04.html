<html><head></head><body>
<div id="_idContainer079">
<h1 class="chapter-number" id="_idParaDest-89"><a id="_idTextAnchor089"/><span class="koboSpan" id="kobo.1.1">4</span></h1>
<h1 id="_idParaDest-90"><a id="_idTextAnchor090"/><span class="koboSpan" id="kobo.2.1">QPainter and 2D Graphics</span></h1>
<p><span class="koboSpan" id="kobo.3.1">In this chapter, we will learn how to render 2D graphics on screen with Qt. </span><span class="koboSpan" id="kobo.3.2">Internally, Qt uses a low-level class called </span><strong class="source-inline"><span class="koboSpan" id="kobo.4.1">QPainter</span></strong><span class="koboSpan" id="kobo.5.1"> to render its widgets on the main window. </span><span class="koboSpan" id="kobo.5.2">Qt allows us to access and use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.6.1">QPainter</span></strong><span class="koboSpan" id="kobo.7.1"> class for drawing vector graphics, text, 2D images, and even </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">3D graphics.</span></span></p>
<p><span class="koboSpan" id="kobo.9.1">You can make use of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.10.1">QPainter</span></strong><span class="koboSpan" id="kobo.11.1"> class to create your own custom widgets or to create programs that rely heavily on rendering computer graphics such as video games, photo editors, and 3D </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">modeling tools.</span></span></p>
<p><span class="koboSpan" id="kobo.13.1">In this chapter, we’re going to cover the following </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">main topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.15.1">Drawing basic shapes on </span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">the screen</span></span></li>
<li><span class="koboSpan" id="kobo.17.1">Exporting shapes to </span><strong class="bold"><span class="koboSpan" id="kobo.18.1">Scalable Vector Graphics</span></strong><span class="koboSpan" id="kobo.19.1"> (</span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.20.1">SVG</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.21.1">) files</span></span></li>
<li><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.22.1">Coordinate transformation</span></strong></span></li>
<li><span class="koboSpan" id="kobo.23.1">Displaying images </span><span class="No-Break"><span class="koboSpan" id="kobo.24.1">on screen</span></span></li>
<li><span class="koboSpan" id="kobo.25.1">Applying image effects </span><span class="No-Break"><span class="koboSpan" id="kobo.26.1">to graphics</span></span></li>
<li><span class="koboSpan" id="kobo.27.1">Creating a basic </span><span class="No-Break"><span class="koboSpan" id="kobo.28.1">paint program</span></span></li>
<li><span class="koboSpan" id="kobo.29.1">Rendering a 2D canvas </span><span class="No-Break"><span class="koboSpan" id="kobo.30.1">in QML</span></span></li>
</ul>
<h1 id="_idParaDest-91"><a id="_idTextAnchor091"/><span class="koboSpan" id="kobo.31.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.32.1">The technical requirements for this chapter include </span><strong class="bold"><span class="koboSpan" id="kobo.33.1">Qt 6.6.1 MinGW 64-bit</span></strong><span class="koboSpan" id="kobo.34.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.35.1">Qt Creator 12.0.2</span></strong><span class="koboSpan" id="kobo.36.1">. </span><span class="koboSpan" id="kobo.36.2">All the code used in this chapter can be downloaded from the following GitHub </span><span class="No-Break"><span class="koboSpan" id="kobo.37.1">repository: </span></span><a href="https://github.com/PacktPublishing/QT6-C-GUI-Programming-Cookbook---Third-Edition-/tree/main/Chapter04"><span class="No-Break"><span class="koboSpan" id="kobo.38.1">https://github.com/PacktPublishing/QT6-C-GUI-Programming-Cookbook---Third-Edition-/tree/main/Chapter04</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.39.1">.</span></span></p>
<h1 id="_idParaDest-92"><a id="_idTextAnchor092"/><span class="koboSpan" id="kobo.40.1">Drawing basic shapes on the screen</span></h1>
<p><span class="koboSpan" id="kobo.41.1">In this section, we will learn how to draw </span><a id="_idIndexMarker275"/><span class="koboSpan" id="kobo.42.1">simple vector shapes (a line, a rectangle, a circle, and so on) and display text on the main window using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.43.1">QPainter</span></strong><span class="koboSpan" id="kobo.44.1"> class. </span><span class="koboSpan" id="kobo.44.2">We will also learn how to change the drawing style of these vector shapes using the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.45.1">QPen</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.46.1"> class.</span></span></p>
<h2 id="_idParaDest-93"><a id="_idTextAnchor093"/><span class="koboSpan" id="kobo.47.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.48.1">Let’s follow the steps listed here to display basic shapes in our </span><span class="No-Break"><span class="koboSpan" id="kobo.49.1">Qt window:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.50.1">First, let’s create a new </span><strong class="bold"><span class="koboSpan" id="kobo.51.1">Qt Widgets </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.52.1">Application</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.53.1"> project.</span></span></li>
<li><span class="koboSpan" id="kobo.54.1">Open up </span><strong class="source-inline"><span class="koboSpan" id="kobo.55.1">mainwindow.ui</span></strong><span class="koboSpan" id="kobo.56.1"> and remove the </span><strong class="source-inline"><span class="koboSpan" id="kobo.57.1">menuBar</span></strong><span class="koboSpan" id="kobo.58.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.59.1">mainToolBar</span></strong><span class="koboSpan" id="kobo.60.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.61.1">statusBar</span></strong><span class="koboSpan" id="kobo.62.1"> objects so that we get a clean, empty main window. </span><span class="koboSpan" id="kobo.62.2">Right-click on the bar widgets and select </span><strong class="bold"><span class="koboSpan" id="kobo.63.1">Remove Menu Bar</span></strong><span class="koboSpan" id="kobo.64.1"> from the </span><span class="No-Break"><span class="koboSpan" id="kobo.65.1">pop-up menu:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer058">
<span class="koboSpan" id="kobo.66.1"><img alt="Figure 4.1 – Removing the menu bar from the main window" src="image/B20976_04_001.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.67.1">Figure 4.1 – Removing the menu bar from the main window</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.68.1">Then, open up the </span><strong class="source-inline"><span class="koboSpan" id="kobo.69.1">mainwindow.h</span></strong><span class="koboSpan" id="kobo.70.1"> file and add the following code to include the </span><strong class="source-inline"><span class="koboSpan" id="kobo.71.1">QPainter</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.72.1">header file:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.73.1">
#include &lt;QMainWindow&gt;
#include &lt;QPainter&gt;</span></pre></li> <li><span class="koboSpan" id="kobo.74.1">Then, declare the </span><strong class="source-inline"><span class="koboSpan" id="kobo.75.1">paintEvent()</span></strong><span class="koboSpan" id="kobo.76.1"> event handler below the </span><span class="No-Break"><span class="koboSpan" id="kobo.77.1">class destructor:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.78.1">
public:
explicit MainWindow(QWidget *parent = 0);
~MainWindow();
</span><strong class="bold"><span class="koboSpan" id="kobo.79.1">virtual void paintEvent(QPaintEvent *event);</span></strong></pre></li> <li><span class="koboSpan" id="kobo.80.1">Next, open up the </span><strong class="source-inline"><span class="koboSpan" id="kobo.81.1">mainwindow.cpp</span></strong><span class="koboSpan" id="kobo.82.1"> file and define the </span><strong class="source-inline"><span class="koboSpan" id="kobo.83.1">paintEvent()</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.84.1">event handler:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.85.1">
void MainWindow::paintEvent(QPaintEvent *event) {}</span></pre></li> <li><span class="koboSpan" id="kobo.86.1">After that, we will add</span><a id="_idIndexMarker276"/><span class="koboSpan" id="kobo.87.1"> text to the screen using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.88.1">QPainter</span></strong><span class="koboSpan" id="kobo.89.1"> class inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.90.1">paintEvent()</span></strong><span class="koboSpan" id="kobo.91.1"> event handler. </span><span class="koboSpan" id="kobo.91.2">We set the text font settings before drawing it on the screen at the position of </span><strong class="source-inline"><span class="koboSpan" id="kobo.92.1">(</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.93.1">20, 30)</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.94.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.95.1">
QPainter textPainter;
textPainter.begin(this);
</span><strong class="bold"><span class="koboSpan" id="kobo.96.1">textPainter.setFont(QFont("Times", 14, QFont::Bold));</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.97.1">textPainter.drawText(QPoint(20, 30), "Testing");</span></strong><span class="koboSpan" id="kobo.98.1">
textPainter.end();</span></pre></li> <li><span class="koboSpan" id="kobo.99.1">Then, we will draw a straight line that starts from </span><strong class="source-inline"><span class="koboSpan" id="kobo.100.1">(50, 60)</span></strong><span class="koboSpan" id="kobo.101.1"> and ends at </span><strong class="source-inline"><span class="koboSpan" id="kobo.102.1">(</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.103.1">100, 100)</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.104.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.105.1">
QPainter linePainter;
linePainter.begin(this);
</span><strong class="bold"><span class="koboSpan" id="kobo.106.1">linePainter.drawLine(QPoint(50, 60), QPoint(100, 100));</span></strong><span class="koboSpan" id="kobo.107.1">
linePainter.end();</span></pre></li> <li><span class="koboSpan" id="kobo.108.1">We can also easily draw a rectangle by calling the </span><strong class="source-inline"><span class="koboSpan" id="kobo.109.1">drawRect()</span></strong><span class="koboSpan" id="kobo.110.1"> function using a </span><strong class="source-inline"><span class="koboSpan" id="kobo.111.1">QPainter</span></strong><span class="koboSpan" id="kobo.112.1"> class. </span><span class="koboSpan" id="kobo.112.2">This time, however, we also apply a background pattern to the shape before </span><span class="No-Break"><span class="koboSpan" id="kobo.113.1">drawing it:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.114.1">
QPainter rectPainter;
rectPainter.begin(this);
</span><strong class="bold"><span class="koboSpan" id="kobo.115.1">rectPainter.setBrush(Qt::BDiagPattern);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.116.1">rectPainter.drawRect(QRect(40, 120, 80, 30));</span></strong><span class="koboSpan" id="kobo.117.1">
rectPainter.end();</span></pre></li> <li><span class="koboSpan" id="kobo.118.1">Next, declare a </span><strong class="source-inline"><span class="koboSpan" id="kobo.119.1">QPen</span></strong><span class="koboSpan" id="kobo.120.1"> class, set its color to </span><strong class="source-inline"><span class="koboSpan" id="kobo.121.1">red</span></strong><span class="koboSpan" id="kobo.122.1">, and set its drawing style to </span><strong class="source-inline"><span class="koboSpan" id="kobo.123.1">Qt::DashDotLine</span></strong><span class="koboSpan" id="kobo.124.1">. </span><span class="koboSpan" id="kobo.124.2">Then, apply</span><a id="_idIndexMarker277"/><span class="koboSpan" id="kobo.125.1"> the </span><strong class="source-inline"><span class="koboSpan" id="kobo.126.1">QPen</span></strong><span class="koboSpan" id="kobo.127.1"> class to </span><strong class="source-inline"><span class="koboSpan" id="kobo.128.1">QPainter</span></strong><span class="koboSpan" id="kobo.129.1"> and draw an ellipse shape at </span><strong class="source-inline"><span class="koboSpan" id="kobo.130.1">(80, 200)</span></strong><span class="koboSpan" id="kobo.131.1"> with a horizontal radius of </span><strong class="source-inline"><span class="koboSpan" id="kobo.132.1">50</span></strong><span class="koboSpan" id="kobo.133.1"> and a vertical radius </span><span class="No-Break"><span class="koboSpan" id="kobo.134.1">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.135.1">20</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.136.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.137.1">
QPen ellipsePen;
ellipsePen.setColor(Qt::red);
ellipsePen.setStyle(Qt::DashDotLine);
QPainter ellipsePainter;
ellipsePainter.begin(this);
ellipsePainter.setPen(ellipsePen);
ellipsePainter.drawEllipse(QPoint(80, 200), 50, 20);
ellipsePainter.end();</span></pre></li> <li><span class="koboSpan" id="kobo.138.1">We can also use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.139.1">QPainterPath</span></strong><span class="koboSpan" id="kobo.140.1"> class to define a shape before passing it over to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.141.1">QPainter</span></strong><span class="koboSpan" id="kobo.142.1"> class </span><span class="No-Break"><span class="koboSpan" id="kobo.143.1">for rendering:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.144.1">
QPainterPath rectPath;
rectPath.addRect(QRect(150, 20, 100, 50));
QPainter pathPainter;
pathPainter.begin(this);
pathPainter.setPen(QPen(Qt::red, 1, Qt::DashDotLine,
Qt::FlatCap, Qt::MiterJoin));
pathPainter.setBrush(Qt::yellow);
pathPainter.drawPath(rectPath);
pathPainter.end();</span></pre></li> <li><span class="koboSpan" id="kobo.145.1">You can also draw any </span><a id="_idIndexMarker278"/><span class="koboSpan" id="kobo.146.1">other shapes by using </span><strong class="source-inline"><span class="koboSpan" id="kobo.147.1">QPainterPath</span></strong><span class="koboSpan" id="kobo.148.1">, such as </span><span class="No-Break"><span class="koboSpan" id="kobo.149.1">an ellipse:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.150.1">
QPainterPath ellipsePath;
ellipsePath.addEllipse(QPoint(200, 120), 50, 20);
QPainter ellipsePathPainter;
ellipsePathPainter.begin(this);
ellipsePathPainter.setPen(QPen(QColor(79, 106, 25), 5,
Qt::SolidLine, Qt::FlatCap, Qt::MiterJoin));
ellipsePathPainter.setBrush(QColor(122, 163, 39));
ellipsePathPainter.drawPath(ellipsePath);
ellipsePathPainter.end();</span></pre></li> <li><strong class="source-inline"><span class="koboSpan" id="kobo.151.1">QPainter</span></strong><span class="koboSpan" id="kobo.152.1"> can also be used to draw an image file onto the screen. </span><span class="koboSpan" id="kobo.152.2">In the following example, we load an image file called </span><strong class="source-inline"><span class="koboSpan" id="kobo.153.1">tux.png</span></strong><span class="koboSpan" id="kobo.154.1"> and draw it on the screen at the </span><strong class="source-inline"><span class="koboSpan" id="kobo.155.1">(100, </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.156.1">150)</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.157.1"> position:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.158.1">
QImage image;
image.load("tux.png");
QPainter imagePainter(this);
imagePainter.begin(this);
imagePainter.drawImage(QPoint(100, 150), image);
imagePainter.end();</span></pre></li> <li><span class="koboSpan" id="kobo.159.1">The final result should look something </span><span class="No-Break"><span class="koboSpan" id="kobo.160.1">like this:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer059">
<span class="koboSpan" id="kobo.161.1"><img alt="Figure 4.2 – Tux the penguin is overwhelmed by the shapes and lines" src="image/B20976_04_002.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.162.1">Figure 4.2 – Tux the penguin is overwhelmed by the shapes and lines</span></p>
<h2 id="_idParaDest-94"><a id="_idTextAnchor094"/><span class="koboSpan" id="kobo.163.1">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.164.1">If you want to draw something on screen using </span><strong class="source-inline"><span class="koboSpan" id="kobo.165.1">QPainter</span></strong><span class="koboSpan" id="kobo.166.1">, all you need to do is tell it what type of graphics it should be drawing (as in text, a vector shape, an image, a polygon) with the desired position and size. </span><span class="koboSpan" id="kobo.166.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.167.1">QPen</span></strong><span class="koboSpan" id="kobo.168.1"> class determines what the outline of the graphic should</span><a id="_idIndexMarker279"/><span class="koboSpan" id="kobo.169.1"> look like, such as its color, line width, line style (solid, dashed, or dotted), cap style, join style, and so on. </span><span class="koboSpan" id="kobo.169.2">On the other hand, </span><strong class="source-inline"><span class="koboSpan" id="kobo.170.1">QBrush</span></strong><span class="koboSpan" id="kobo.171.1"> sets the style of the background of the graphics, such as the background color, pattern (solid color, gradient, dense brush, and crossing diagonal lines), </span><span class="No-Break"><span class="koboSpan" id="kobo.172.1">and pixmap.</span></span></p>
<p><span class="koboSpan" id="kobo.173.1">The options for the graphics should be set before calling a </span><strong class="source-inline"><span class="koboSpan" id="kobo.174.1">draw</span></strong><span class="koboSpan" id="kobo.175.1"> function (such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.176.1">drawLine()</span></strong><span class="koboSpan" id="kobo.177.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.178.1">drawRect()</span></strong><span class="koboSpan" id="kobo.179.1">, or </span><strong class="source-inline"><span class="koboSpan" id="kobo.180.1">drawEllipse()</span></strong><span class="koboSpan" id="kobo.181.1">). </span><span class="koboSpan" id="kobo.181.2">If your graphics do not appear on the screen and you see warnings such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.182.1">QPainter::setPen: Painter not active</span></strong><span class="koboSpan" id="kobo.183.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.184.1">QPainter::setBrush: Painter not active</span></strong><span class="koboSpan" id="kobo.185.1"> appearing on the application output window in Qt Creator, it means that the </span><strong class="source-inline"><span class="koboSpan" id="kobo.186.1">QPainter</span></strong><span class="koboSpan" id="kobo.187.1"> class is not currently active and your program will not trigger its paint event. </span><span class="koboSpan" id="kobo.187.2">To solve this problem, set the main window as the parent of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.188.1">QPainter</span></strong><span class="koboSpan" id="kobo.189.1"> class. </span><span class="koboSpan" id="kobo.189.2">Usually, if you’re writing code in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.190.1">mainwindow.cpp</span></strong><span class="koboSpan" id="kobo.191.1"> file, all you need to do is to put </span><strong class="source-inline"><span class="koboSpan" id="kobo.192.1">this</span></strong><span class="koboSpan" id="kobo.193.1"> in the brackets when initializing </span><strong class="source-inline"><span class="koboSpan" id="kobo.194.1">QPainter</span></strong><span class="koboSpan" id="kobo.195.1">. </span><span class="koboSpan" id="kobo.195.2">For example, note </span><span class="No-Break"><span class="koboSpan" id="kobo.196.1">the following:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.197.1">
QPainter linePainter(this);</span></pre> <p><strong class="source-inline"><span class="koboSpan" id="kobo.198.1">QImage</span></strong><span class="koboSpan" id="kobo.199.1"> can load images from both the computer directories and from the </span><span class="No-Break"><span class="koboSpan" id="kobo.200.1">program resources.</span></span></p>
<h2 id="_idParaDest-95"><a id="_idTextAnchor095"/><span class="koboSpan" id="kobo.201.1">There’s more…</span></h2>
<p><span class="koboSpan" id="kobo.202.1">Think of </span><strong class="source-inline"><span class="koboSpan" id="kobo.203.1">QPainter</span></strong><span class="koboSpan" id="kobo.204.1"> as a robot</span><a id="_idIndexMarker280"/><span class="koboSpan" id="kobo.205.1"> with a pen and an empty canvas. </span><span class="koboSpan" id="kobo.205.2">You just have to tell the</span><a id="_idIndexMarker281"/><span class="koboSpan" id="kobo.206.1"> robot what type of shape it should be drawing and its location on the canvas, then the robot will do its job based on </span><span class="No-Break"><span class="koboSpan" id="kobo.207.1">your description.</span></span></p>
<p><span class="koboSpan" id="kobo.208.1">To make your life easier, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.209.1">QPainter</span></strong><span class="koboSpan" id="kobo.210.1"> class also provides numerous functions, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.211.1">drawArc()</span></strong><span class="koboSpan" id="kobo.212.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.213.1">drawEllipse()</span></strong><span class="koboSpan" id="kobo.214.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.215.1">drawLine()</span></strong><span class="koboSpan" id="kobo.216.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.217.1">drawRect()</span></strong><span class="koboSpan" id="kobo.218.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.219.1">drawPie()</span></strong><span class="koboSpan" id="kobo.220.1">, which allow you to easily render a predefined shape. </span><span class="koboSpan" id="kobo.220.2">In Qt, all the widget classes (including the main window) have an event handler called </span><strong class="source-inline"><span class="koboSpan" id="kobo.221.1">QWidget::paintEvent()</span></strong><span class="koboSpan" id="kobo.222.1">. </span><span class="koboSpan" id="kobo.222.2">This event handler will be triggered whenever the operating system thinks that the main window should re-draw its widgets. </span><span class="koboSpan" id="kobo.222.3">Many things can lead to that decision, such as the main window being scaled, a widget changing its state (that is, a button being pressed), or functions such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.223.1">repaint()</span></strong><span class="koboSpan" id="kobo.224.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.225.1">update()</span></strong><span class="koboSpan" id="kobo.226.1"> being invoked manually in the code. </span><span class="koboSpan" id="kobo.226.2">Different operating systems may behave differently when it comes to deciding whether or not to trigger the update event on the same set of conditions. </span><span class="koboSpan" id="kobo.226.3">If you’re making a program that requires continuous and consistent graphical updates, call </span><strong class="source-inline"><span class="koboSpan" id="kobo.227.1">repaint()</span></strong><span class="koboSpan" id="kobo.228.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.229.1">update()</span></strong><span class="koboSpan" id="kobo.230.1"> manually with </span><span class="No-Break"><span class="koboSpan" id="kobo.231.1">a timer.</span></span></p>
<h1 id="_idParaDest-96"><a id="_idTextAnchor096"/><span class="koboSpan" id="kobo.232.1">Exporting shapes to SVG files</span></h1>
<p><span class="koboSpan" id="kobo.233.1">SVG is an XML-based language for </span><a id="_idIndexMarker282"/><span class="koboSpan" id="kobo.234.1">describing 2D vector graphics. </span><span class="koboSpan" id="kobo.234.2">Qt provides classes for </span><a id="_idIndexMarker283"/><span class="koboSpan" id="kobo.235.1">saving vector shapes as SVG files. </span><span class="koboSpan" id="kobo.235.2">This feature can be used to create a simple vector graphics editor similar to Adobe Illustrator and Inkscape. </span><span class="koboSpan" id="kobo.235.3">In the next example, we will continue using the same project file from the </span><span class="No-Break"><span class="koboSpan" id="kobo.236.1">previous example.</span></span></p>
<h2 id="_idParaDest-97"><a id="_idTextAnchor097"/><span class="koboSpan" id="kobo.237.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.238.1">Let’s learn how to create a simple program that displays SVG graphics </span><span class="No-Break"><span class="koboSpan" id="kobo.239.1">on screen:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.240.1">First of all, let’s create a </span><a id="_idIndexMarker284"/><span class="koboSpan" id="kobo.241.1">menu bar by right-clicking the main window widget on the hierarchy window </span><a id="_idIndexMarker285"/><span class="koboSpan" id="kobo.242.1">and selecting the </span><strong class="bold"><span class="koboSpan" id="kobo.243.1">Create Menu Bar</span></strong><span class="koboSpan" id="kobo.244.1"> option from the pop-up menu. </span><span class="koboSpan" id="kobo.244.2">After that, add a </span><strong class="bold"><span class="koboSpan" id="kobo.245.1">File</span></strong><span class="koboSpan" id="kobo.246.1"> option to the menu bar and a </span><strong class="bold"><span class="koboSpan" id="kobo.247.1">Save as SVG</span></strong><span class="koboSpan" id="kobo.248.1"> action </span><span class="No-Break"><span class="koboSpan" id="kobo.249.1">underneath it:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer060">
<span class="koboSpan" id="kobo.250.1"><img alt="Figure 4.3 – Create a Save as SVG option on the menu bar" src="image/B20976_04_003.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.251.1">Figure 4.3 – Create a Save as SVG option on the menu bar</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.252.1">After that, you will see an item called </span><strong class="bold"><span class="koboSpan" id="kobo.253.1">actionSave_as_SVG</span></strong><span class="koboSpan" id="kobo.254.1"> in the </span><strong class="bold"><span class="koboSpan" id="kobo.255.1">Action Editor</span></strong><span class="koboSpan" id="kobo.256.1"> window at the bottom of the Qt Creator window. </span><span class="koboSpan" id="kobo.256.2">Right-click on the item and choose </span><strong class="bold"><span class="koboSpan" id="kobo.257.1">Go to slot…</span></strong><span class="koboSpan" id="kobo.258.1"> from the pop-up menu. </span><span class="koboSpan" id="kobo.258.2">A window will now appear, which carries a list of slots available for the particular action. </span><span class="koboSpan" id="kobo.258.3">Choose the default signal, which is called </span><strong class="source-inline"><span class="koboSpan" id="kobo.259.1">triggered()</span></strong><span class="koboSpan" id="kobo.260.1">, and click the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.261.1">OK</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.262.1"> button:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer061">
<span class="koboSpan" id="kobo.263.1"><img alt="Figure 4.4 – Creating a slot function for the triggered() signal" src="image/B20976_04_004.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.264.1">Figure 4.4 – Creating a slot function for the triggered() signal</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.265.1">Once you have clicked</span><a id="_idIndexMarker286"/><span class="koboSpan" id="kobo.266.1"> the </span><strong class="bold"><span class="koboSpan" id="kobo.267.1">OK</span></strong><span class="koboSpan" id="kobo.268.1"> button, Qt Creator will switch over to the script editor. </span><span class="koboSpan" id="kobo.268.2">You will realize</span><a id="_idIndexMarker287"/><span class="koboSpan" id="kobo.269.1"> that a slot called </span><strong class="source-inline"><span class="koboSpan" id="kobo.270.1">on_actionSave_as_SVG_triggered()</span></strong><span class="koboSpan" id="kobo.271.1"> has been automatically added to your main window class. </span><span class="koboSpan" id="kobo.271.2">At the bottom of your </span><strong class="source-inline"><span class="koboSpan" id="kobo.272.1">mainwindow.h</span></strong><span class="koboSpan" id="kobo.273.1"> file, you will see something </span><span class="No-Break"><span class="koboSpan" id="kobo.274.1">like this:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.275.1">
void MainWindow::on_actionSave_as_SVG_triggered() {}</span></pre></li> <li><span class="koboSpan" id="kobo.276.1">The preceding function is called when you click on the </span><strong class="bold"><span class="koboSpan" id="kobo.277.1">Save as SVG</span></strong><span class="koboSpan" id="kobo.278.1"> option from the menu bar. </span><span class="koboSpan" id="kobo.278.2">We will write our code within this function to save all the vector graphics into an SVG file. </span><span class="koboSpan" id="kobo.278.3">To do that, first of all, we need to include a class header called </span><strong class="source-inline"><span class="koboSpan" id="kobo.279.1">QSvgGenerator</span></strong><span class="koboSpan" id="kobo.280.1"> at the top of our source file. </span><span class="koboSpan" id="kobo.280.2">This header is very important as it’s required for generating SVG files. </span><span class="koboSpan" id="kobo.280.3">Then, we also need to include another class header called </span><strong class="source-inline"><span class="koboSpan" id="kobo.281.1">QFileDialog</span></strong><span class="koboSpan" id="kobo.282.1">, which will be used to open the </span><span class="No-Break"><span class="koboSpan" id="kobo.283.1">save dialog:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.284.1">
#include &lt;QtSvg/QSvgGenerator&gt;
#include &lt;QFileDialog&gt;</span></pre></li> <li><span class="koboSpan" id="kobo.285.1">We also need to add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.286.1">svg</span></strong><span class="koboSpan" id="kobo.287.1"> module to our project file, </span><span class="No-Break"><span class="koboSpan" id="kobo.288.1">like so:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.289.1">
QT += core gui </span><strong class="bold"><span class="koboSpan" id="kobo.290.1">svg</span></strong></pre></li> <li><span class="koboSpan" id="kobo.291.1">Then, create a new function called </span><strong class="source-inline"><span class="koboSpan" id="kobo.292.1">paintAll()</span></strong><span class="koboSpan" id="kobo.293.1"> within the </span><strong class="source-inline"><span class="koboSpan" id="kobo.294.1">mainwindow.h</span></strong><span class="koboSpan" id="kobo.295.1"> file, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.296.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.297.1">
public:
    explicit MainWindow(QWidget *parent = 0);
    ~MainWindow();
    virtual void paintEvent(QPaintEvent *event);
</span><strong class="bold"><span class="koboSpan" id="kobo.298.1">    void paintAll(QSvgGenerator *generator = 0);</span></strong></pre></li> <li><span class="koboSpan" id="kobo.299.1">After that, in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.300.1">mainwindow.cpp</span></strong><span class="koboSpan" id="kobo.301.1"> file, move all the code from </span><strong class="source-inline"><span class="koboSpan" id="kobo.302.1">paintEvent()</span></strong><span class="koboSpan" id="kobo.303.1"> to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.304.1">paintAll()</span></strong><span class="koboSpan" id="kobo.305.1"> function. </span><span class="koboSpan" id="kobo.305.2">Then, replace all the individual </span><strong class="source-inline"><span class="koboSpan" id="kobo.306.1">QPainter</span></strong><span class="koboSpan" id="kobo.307.1"> objects</span><a id="_idIndexMarker288"/><span class="koboSpan" id="kobo.308.1"> with a single, unified </span><strong class="source-inline"><span class="koboSpan" id="kobo.309.1">QPainter</span></strong><span class="koboSpan" id="kobo.310.1"> for drawing all the</span><a id="_idIndexMarker289"/><span class="koboSpan" id="kobo.311.1"> graphics. </span><span class="koboSpan" id="kobo.311.2">Also, call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.312.1">begin()</span></strong><span class="koboSpan" id="kobo.313.1"> function before drawing anything and call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.314.1">end()</span></strong><span class="koboSpan" id="kobo.315.1"> function after finishing drawing. </span><span class="koboSpan" id="kobo.315.2">The code should look </span><span class="No-Break"><span class="koboSpan" id="kobo.316.1">like this:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.317.1">
void MainWindow::paintAll(QSvgGenerator *generator) {
    </span><strong class="bold"><span class="koboSpan" id="kobo.318.1">QPainter painter;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.319.1">     if (engine)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.320.1">         painter.begin(engine);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.321.1">     else</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.322.1">         painter.begin(this);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.323.1">     painter.setFont(QFont("Times", 14, QFont::Bold));</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.324.1">     painter.drawText(QPoint(20, 30), "Testing");</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.325.1">     painter.drawLine(QPoint(50, 60), QPoint(100, 100));</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.326.1">     painter.setBrush(Qt::BDiagPattern);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.327.1">     painter.drawRect(QRect(40, 120, 80, 30));</span></strong></pre></li> <li><span class="koboSpan" id="kobo.328.1">We go on to create </span><strong class="bold"><span class="koboSpan" id="kobo.329.1">ellipsePen</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.330.1">and </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.331.1">rectPath</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.332.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.333.1">
    QPen ellipsePen;
    ellipsePen.setColor(Qt::red);
ellipsePen.setStyle(Qt::DashDotLine);
    painter.setPen(ellipsePen);
    painter.drawEllipse(QPoint(80, 200), 50, 20);
    QPainterPath rectPath;
    rectPath.addRect(QRect(150, 20, 100, 50));
    painter.setPen(QPen(Qt::red, 1, Qt::DashDotLine, Qt::FlatCap, Qt::MiterJoin));
    painter.setBrush(Qt::yellow);
    painter.drawPath(rectPath);</span></pre></li> <li><span class="koboSpan" id="kobo.334.1">Then, we go </span><a id="_idIndexMarker290"/><span class="koboSpan" id="kobo.335.1">on to create </span><strong class="source-inline"><span class="koboSpan" id="kobo.336.1">ellipsePath</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.337.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.338.1">image</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.339.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.340.1">
    QPainterPath ellipsePath;
    ellipsePath.addEllipse(QPoint(200, 120), 50, 20);
    painter.setPen(QPen(QColor(79, 106, 25), 5, Qt::SolidLine, Qt::FlatCap, Qt::MiterJoin));
    painter.setBrush(QColor(122, 163, 39));
    painter.drawPath(ellipsePath);
    QImage image;
    image.load("tux.png");
    painter.drawImage(QPoint(100, 150), image);
    painter.end();
}</span></pre></li> <li><span class="koboSpan" id="kobo.341.1">Since we have </span><a id="_idIndexMarker291"/><span class="koboSpan" id="kobo.342.1">moved all the code from </span><strong class="source-inline"><span class="koboSpan" id="kobo.343.1">paintEvent()</span></strong><span class="koboSpan" id="kobo.344.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.345.1">paintAll()</span></strong><span class="koboSpan" id="kobo.346.1">, we shall now call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.347.1">paintAll()</span></strong><span class="koboSpan" id="kobo.348.1"> function inside </span><strong class="source-inline"><span class="koboSpan" id="kobo.349.1">paintEvent()</span></strong><span class="koboSpan" id="kobo.350.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.351.1">like so:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.352.1">
void MainWindow::paintEvent(QPaintEvent *event) {
    </span><strong class="bold"><span class="koboSpan" id="kobo.353.1">paintAll();</span></strong><span class="koboSpan" id="kobo.354.1">
}</span></pre></li> <li><span class="koboSpan" id="kobo.355.1">Then, we will write the</span><a id="_idIndexMarker292"/><span class="koboSpan" id="kobo.356.1"> code for exporting the graphics as an SVG file. </span><span class="koboSpan" id="kobo.356.2">The</span><a id="_idIndexMarker293"/><span class="koboSpan" id="kobo.357.1"> code will be written inside the slot function called </span><strong class="source-inline"><span class="koboSpan" id="kobo.358.1">on_actionSave_as_SVG_triggered()</span></strong><span class="koboSpan" id="kobo.359.1">, which was generated by Qt. </span><span class="koboSpan" id="kobo.359.2">We start by calling the save file dialog and obtain the directory path with the desired filename from </span><span class="No-Break"><span class="koboSpan" id="kobo.360.1">the user:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.361.1">
void MainWindow::on_actionSave_as_SVG_triggered() {
    </span><strong class="bold"><span class="koboSpan" id="kobo.362.1">QString filePath = QFileDialog::getSaveFileName(this, «Save SVG», «», «SVG files (*.svg)»);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.363.1">    if (filePath == "")</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.364.1">        return;</span></strong><span class="koboSpan" id="kobo.365.1">
}</span></pre></li> <li><span class="koboSpan" id="kobo.366.1">After that, create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.367.1">QSvgGenerator</span></strong><span class="koboSpan" id="kobo.368.1"> object and save the graphics to an SVG file by passing the </span><strong class="source-inline"><span class="koboSpan" id="kobo.369.1">QSvgGenerator</span></strong><span class="koboSpan" id="kobo.370.1"> object to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.371.1">paintAll()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.372.1"> function:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.373.1">
void MainWindow::on_actionSave_as_SVG_triggered() {
    QString filePath = QFileDialog::getSaveFileName(this, "Save
SVG", "", "SVG files (*.svg)");
    if (filePath == "")
        return;
    </span><strong class="bold"><span class="koboSpan" id="kobo.374.1">QSvgGenerator generator;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.375.1">    generator.setFileName(filePath);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.376.1">    generator.setSize(QSize(this-&gt;width(), this-&gt;height()));</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.377.1">    generator.setViewBox(QRect(0, 0, this-&gt;width(), this-&gt;height()));</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.378.1">    generator.setTitle("SVG Example");</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.379.1">    generator.setDescription("This SVG file is generated by Qt.");</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.380.1">    paintAll(&amp;generator);</span></strong><span class="koboSpan" id="kobo.381.1">
}</span></pre></li> <li><span class="koboSpan" id="kobo.382.1">Now, compile and </span><a id="_idIndexMarker294"/><span class="koboSpan" id="kobo.383.1">run the program and you should be able to </span><a id="_idIndexMarker295"/><span class="koboSpan" id="kobo.384.1">export the graphics by going to </span><strong class="bold"><span class="koboSpan" id="kobo.385.1">File</span></strong><span class="koboSpan" id="kobo.386.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.387.1">Save </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.388.1">as SVG</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.389.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer062">
<span class="koboSpan" id="kobo.390.1"><img alt="Figure 4.5 – Comparing the results between our program and the SVG file on a web browser" src="image/B20976_04_005.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.391.1">Figure 4.5 – Comparing the results between our program and the SVG file on a web browser</span></p>
<h2 id="_idParaDest-98"><a id="_idTextAnchor098"/><span class="koboSpan" id="kobo.392.1">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.393.1">By default, </span><strong class="source-inline"><span class="koboSpan" id="kobo.394.1">QPainter</span></strong><span class="koboSpan" id="kobo.395.1"> will use the paint engine from its parent object to draw the graphics assigned to it. </span><span class="koboSpan" id="kobo.395.2">If you don’t assign any parent to </span><strong class="source-inline"><span class="koboSpan" id="kobo.396.1">QPainter</span></strong><span class="koboSpan" id="kobo.397.1">, you can manually assign a paint engine to it, which is what we have done in </span><span class="No-Break"><span class="koboSpan" id="kobo.398.1">this example.</span></span></p>
<p><span class="koboSpan" id="kobo.399.1">The reason why we placed the code into </span><strong class="source-inline"><span class="koboSpan" id="kobo.400.1">paintAll()</span></strong><span class="koboSpan" id="kobo.401.1"> is that we want to reuse the same code for two different purposes: for displaying the graphics on the window and exporting the graphics to an SVG </span><a id="_idIndexMarker296"/><span class="koboSpan" id="kobo.402.1">file. </span><span class="koboSpan" id="kobo.402.2">You can see that the default value of the generator variable in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.403.1">paintAll()</span></strong><span class="koboSpan" id="kobo.404.1"> function is set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.405.1">0</span></strong><span class="koboSpan" id="kobo.406.1">, which means no </span><strong class="source-inline"><span class="koboSpan" id="kobo.407.1">QSvgGenerator</span></strong><span class="koboSpan" id="kobo.408.1"> object is required to run</span><a id="_idIndexMarker297"/><span class="koboSpan" id="kobo.409.1"> the function unless specified. </span><span class="koboSpan" id="kobo.409.2">Later on, in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.410.1">paintAll()</span></strong><span class="koboSpan" id="kobo.411.1"> function, we check whether the generator object exists. </span><span class="koboSpan" id="kobo.411.2">If it does exist, use it as the paint engine for the painter, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.412.1">following code:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.413.1">
if (engine)
    painter.begin(engine);
else
    painter.begin(this);</span></pre> <p><span class="koboSpan" id="kobo.414.1">Otherwise, pass the main window to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.415.1">begin()</span></strong><span class="koboSpan" id="kobo.416.1"> function (since we’re writing the code in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.417.1">mainwindow.cpp</span></strong><span class="koboSpan" id="kobo.418.1"> file, we can directly use this to refer to the main window’s pointer) so that it will use the paint engine of the main window itself, which means the graphics will be drawn onto the surface of the main window. </span><span class="koboSpan" id="kobo.418.2">In this example, it’s required to use a single </span><strong class="source-inline"><span class="koboSpan" id="kobo.419.1">QPainter</span></strong><span class="koboSpan" id="kobo.420.1"> object to save the graphics into the SVG file. </span><span class="koboSpan" id="kobo.420.2">If you use multiple </span><strong class="source-inline"><span class="koboSpan" id="kobo.421.1">QPainter</span></strong><span class="koboSpan" id="kobo.422.1"> objects, the resulting SVG file will contain multiple XML header definitions, and thus the file will be deemed to be invalid by any graphics editor software </span><span class="No-Break"><span class="koboSpan" id="kobo.423.1">out there.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.424.1">QFileDialog::getSaveFileName()</span></strong><span class="koboSpan" id="kobo.425.1"> will open up the native save file dialog for the user to choose the save directory and set a desired filename. </span><span class="koboSpan" id="kobo.425.2">Once the user is done with that, the full path will be returned as a string, and we will be able to pass that information to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.426.1">QSvgGenerator</span></strong><span class="koboSpan" id="kobo.427.1"> object to export </span><span class="No-Break"><span class="koboSpan" id="kobo.428.1">the graphics.</span></span></p>
<p><span class="koboSpan" id="kobo.429.1">Notice that in the previous screenshot, the penguin in the SVG file has been cropped. </span><span class="koboSpan" id="kobo.429.2">This is because the canvas size of the SVG was set to follow the size of the main window. </span><span class="koboSpan" id="kobo.429.3">To help the poor penguin get its body back, scale the window bigger before exporting the </span><span class="No-Break"><span class="koboSpan" id="kobo.430.1">SVG file.</span></span></p>
<h2 id="_idParaDest-99"><a id="_idTextAnchor099"/><span class="koboSpan" id="kobo.431.1">There’s more…</span></h2>
<p><span class="koboSpan" id="kobo.432.1">SVG defines the graphics in XML format. </span><span class="koboSpan" id="kobo.432.2">Since it is a form of vector graphics, SVG files do not lose any quality if they are </span><a id="_idIndexMarker298"/><span class="koboSpan" id="kobo.433.1">zoomed in on or resized. </span><span class="koboSpan" id="kobo.433.2">The SVG format not only allows you to store vector graphics in </span><a id="_idIndexMarker299"/><span class="koboSpan" id="kobo.434.1">the working file, but it also allows you to store raster graphics and text, which is more or less similar to Adobe Illustrator’s format. </span><span class="koboSpan" id="kobo.434.2">The SVG also allows you to group, style, transform, and composite graphical objects into previously </span><span class="No-Break"><span class="koboSpan" id="kobo.435.1">rendered objects.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.436.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.437.1">You can check out the full specification of SVG graphics </span><span class="No-Break"><span class="koboSpan" id="kobo.438.1">at </span></span><a href="https://www.w3.org/TR/SVG"><span class="No-Break"><span class="koboSpan" id="kobo.439.1">https://www.w3.org/TR/SVG</span></span></a><span class="No-Break"><span class="P---Callout-Char"><span class="koboSpan" id="kobo.440.1">.</span></span></span></p>
<h1 id="_idParaDest-100"><a id="_idTextAnchor100"/><span class="koboSpan" id="kobo.441.1">Coordinate transformation</span></h1>
<p><span class="koboSpan" id="kobo.442.1">In this example, we will learn </span><a id="_idIndexMarker300"/><span class="koboSpan" id="kobo.443.1">how to use coordinate transformation and a timer to create a real-time </span><span class="No-Break"><span class="koboSpan" id="kobo.444.1">clock display.</span></span></p>
<h2 id="_idParaDest-101"><a id="_idTextAnchor101"/><span class="koboSpan" id="kobo.445.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.446.1">To create our first graphical clock display, let’s follow </span><span class="No-Break"><span class="koboSpan" id="kobo.447.1">these steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.448.1">First, create a new </span><strong class="bold"><span class="koboSpan" id="kobo.449.1">Qt Widgets Application</span></strong><span class="koboSpan" id="kobo.450.1"> project. </span><span class="koboSpan" id="kobo.450.2">Then, open up </span><strong class="source-inline"><span class="koboSpan" id="kobo.451.1">mainwindow.ui</span></strong><span class="koboSpan" id="kobo.452.1"> and remove the </span><strong class="source-inline"><span class="koboSpan" id="kobo.453.1">menuBar</span></strong><span class="koboSpan" id="kobo.454.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.455.1">mainToolBar</span></strong><span class="koboSpan" id="kobo.456.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.457.1">statusBar</span></strong><span class="koboSpan" id="kobo.458.1"> as we </span><span class="No-Break"><span class="koboSpan" id="kobo.459.1">did before.</span></span></li>
<li><span class="koboSpan" id="kobo.460.1">After that, open up the </span><strong class="source-inline"><span class="koboSpan" id="kobo.461.1">mainwindow.h</span></strong><span class="koboSpan" id="kobo.462.1"> file and include the </span><span class="No-Break"><span class="koboSpan" id="kobo.463.1">following headers:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.464.1">
#include &lt;QTime&gt;
#include &lt;QTimer&gt;
#include &lt;QPainter&gt;</span></pre></li> <li><span class="koboSpan" id="kobo.465.1">Then, declare the </span><strong class="source-inline"><span class="koboSpan" id="kobo.466.1">paintEvent()</span></strong><span class="koboSpan" id="kobo.467.1"> function, </span><span class="No-Break"><span class="koboSpan" id="kobo.468.1">like so:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.469.1">
public:
    explicit MainWindow(QWidget *parent = 0);
    ~MainWindow();
    </span><strong class="bold"><span class="koboSpan" id="kobo.470.1">virtual void paintEvent(QPaintEvent *event);</span></strong></pre></li> <li><span class="koboSpan" id="kobo.471.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.472.1">mainwindow.cpp</span></strong><span class="koboSpan" id="kobo.473.1"> file, create three arrays to store the shapes of the hour hand, minute hand, and </span><a id="_idIndexMarker301"/><span class="koboSpan" id="kobo.474.1">second hand, where each of the arrays contains three sets </span><span class="No-Break"><span class="koboSpan" id="kobo.475.1">of coordinates:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.476.1">
void MainWindow::paintEvent(QPaintEvent *event) {
    </span><strong class="bold"><span class="koboSpan" id="kobo.477.1">static const QPoint hourHand[3] = {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.478.1">        QPoint(4, 4),</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.479.1">        QPoint(-4, 4),</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.480.1">        QPoint(0, -40)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.481.1">    </span></strong><strong class="bold"><span class="koboSpan" id="kobo.482.1">};</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.483.1">    static const QPoint minuteHand[3] = {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.484.1">        QPoint(4, 4),</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.485.1">        QPoint(-4, 4),</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.486.1">        QPoint(0, -70)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.487.1">    };</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.488.1">    static const QPoint secondHand[3] = {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.489.1">        QPoint(2, 2),</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.490.1">        QPoint(-2, 2),</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.491.1">        QPoint(0, -90)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.492.1">    </span></strong><strong class="bold"><span class="koboSpan" id="kobo.493.1">};</span></strong><span class="koboSpan" id="kobo.494.1">
}</span></pre></li> <li><span class="koboSpan" id="kobo.495.1">After that, add the following code below the arrays to create the painter and move it to the center of the main window. </span><span class="koboSpan" id="kobo.495.2">Also, we adjust the size of the painter so that it fits nicely in the main window, even when the window is </span><span class="No-Break"><span class="koboSpan" id="kobo.496.1">being resized:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.497.1">
int side = qMin(width(), height());
QPainter painter(this);
painter.setRenderHint(QPainter::Antialiasing);
painter.translate(width() / 2, height() / 2);
painter.scale(side / 250.0, side / 250.0);</span></pre></li> <li><span class="koboSpan" id="kobo.498.1">Once you are done with that, we will start drawing the dials by using a for loop. </span><span class="koboSpan" id="kobo.498.2">Each dial is rotated by </span><a id="_idIndexMarker302"/><span class="koboSpan" id="kobo.499.1">an increment of 6 degrees, so 60 dials would complete a full circle. </span><span class="koboSpan" id="kobo.499.2">Also, the dial will look slightly longer at every </span><span class="No-Break"><span class="koboSpan" id="kobo.500.1">five minutes:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.501.1">
for (int i = 0; i &lt; 60; ++i) {
    if ((i % 5) != 0)
        painter.drawLine(92, 0, 96, 0);
    else
        painter.drawLine(86, 0, 96, 0);
    painter.rotate(6.0);
}</span></pre></li> <li><span class="koboSpan" id="kobo.502.1">Then, we proceed with drawing the hands of the clock. </span><span class="koboSpan" id="kobo.502.2">Each hand’s rotation is calculated according to the current time and its respective equivalent location over </span><span class="No-Break"><span class="koboSpan" id="kobo.503.1">360 degrees:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.504.1">
QTime time = QTime::currentTime();
// Draw hour hand
painter.save();
painter.rotate((time.hour() * 360) / 12);
painter.setPen(Qt::NoPen);
painter.setBrush(Qt::black);
painter.drawConvexPolygon(hourHand, 3);
painter.restore();</span></pre></li> <li><span class="koboSpan" id="kobo.505.1">Let’s draw the minute hand of </span><span class="No-Break"><span class="koboSpan" id="kobo.506.1">the clock:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.507.1">
// Draw minute hand
painter.save();
painter.rotate((time.minute() * 360) / 60);
painter.setPen(Qt::NoPen);
painter.setBrush(Qt::black);
painter.drawConvexPolygon(minuteHand, 3);
painter.restore();</span></pre></li> <li><span class="koboSpan" id="kobo.508.1">Then, we also draw the </span><a id="_idIndexMarker303"/><span class="koboSpan" id="kobo.509.1">hand </span><span class="No-Break"><span class="koboSpan" id="kobo.510.1">for seconds:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.511.1">
// Draw second hand
painter.save();
painter.rotate((time.second() * 360) / 60);
painter.setPen(Qt::NoPen);
painter.setBrush(Qt::black);
painter.drawConvexPolygon(secondHand, 3);
painter.restore();</span></pre></li> <li><span class="koboSpan" id="kobo.512.1">Last, but not least, create a timer to refresh the graphics every second so that the program will work like a </span><span class="No-Break"><span class="koboSpan" id="kobo.513.1">real clock:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.514.1">
MainWindow::MainWindow(QWidget *parent) : QMainWindow(parent),
ui(new Ui::MainWindow) {
    ui-&gt;setupUi(this);
    </span><strong class="bold"><span class="koboSpan" id="kobo.515.1">QTimer* timer = new QTimer(this);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.516.1">    timer-&gt;start(1000);</span></strong><span class="koboSpan" id="kobo.517.1">
    connect(timer, QTimer::timeout, this, MainWindow::update);
}</span></pre></li> <li><span class="koboSpan" id="kobo.518.1">Compile and run the</span><a id="_idIndexMarker304"/><span class="koboSpan" id="kobo.519.1"> program now, and you should see something </span><span class="No-Break"><span class="koboSpan" id="kobo.520.1">like this:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer063">
<span class="koboSpan" id="kobo.521.1"><img alt="Figure 4.6 – A real-time analog clock displayed on the Qt application" src="image/B20976_04_006.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.522.1">Figure 4.6 – A real-time analog clock displayed on the Qt application</span></p>
<h2 id="_idParaDest-102"><a id="_idTextAnchor102"/><span class="koboSpan" id="kobo.523.1">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.524.1">Each of the arrays contains three </span><strong class="source-inline"><span class="koboSpan" id="kobo.525.1">QPoint</span></strong><span class="koboSpan" id="kobo.526.1"> data instances, which form the shape of an elongated triangle. </span><span class="koboSpan" id="kobo.526.2">The arrays are then passed to the painter and rendered as a convex polygon using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.527.1">drawConvexPolygon()</span></strong><span class="koboSpan" id="kobo.528.1"> function. </span><span class="koboSpan" id="kobo.528.2">Before drawing each of the clock hands, we use </span><strong class="source-inline"><span class="koboSpan" id="kobo.529.1">painter.save()</span></strong><span class="koboSpan" id="kobo.530.1"> to save the state of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.531.1">QPainter</span></strong><span class="koboSpan" id="kobo.532.1"> object and then proceed with drawing the hand using </span><span class="No-Break"><span class="koboSpan" id="kobo.533.1">coordinate transformation.</span></span></p>
<p><span class="koboSpan" id="kobo.534.1">Once we’re done with the drawing, we restore the painter to its previous state by calling </span><strong class="source-inline"><span class="koboSpan" id="kobo.535.1">painter.restore()</span></strong><span class="koboSpan" id="kobo.536.1">. </span><span class="koboSpan" id="kobo.536.2">This function will undo all the transformations before </span><strong class="source-inline"><span class="koboSpan" id="kobo.537.1">painter. </span><span class="koboSpan" id="kobo.537.2">restore()</span></strong><span class="koboSpan" id="kobo.538.1"> so that the next clock hand will not inherit the transformations of the previous one. </span><span class="koboSpan" id="kobo.538.2">Without using </span><strong class="source-inline"><span class="koboSpan" id="kobo.539.1">painter.save()</span></strong><span class="koboSpan" id="kobo.540.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.541.1">painter.restore()</span></strong><span class="koboSpan" id="kobo.542.1">, we will have to manually change the position, rotation, and scale before drawing the </span><span class="No-Break"><span class="koboSpan" id="kobo.543.1">next hand.</span></span></p>
<p><span class="koboSpan" id="kobo.544.1">A good example of not using </span><strong class="source-inline"><span class="koboSpan" id="kobo.545.1">painter.save()</span></strong><span class="koboSpan" id="kobo.546.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.547.1">painter.restore()</span></strong><span class="koboSpan" id="kobo.548.1"> is when drawing the dials. </span><span class="koboSpan" id="kobo.548.2">Since each dial’s rotation is an increment of six degrees from the previous one, we don’t need to save the painter’s state at all. </span><span class="koboSpan" id="kobo.548.3">We just have to call </span><strong class="source-inline"><span class="koboSpan" id="kobo.549.1">painter.rotate(6.0)</span></strong><span class="koboSpan" id="kobo.550.1"> in a loop and each dial will inherit the previous dial’s rotation. </span><span class="koboSpan" id="kobo.550.2">We also use a modulus operator (</span><strong class="source-inline"><span class="koboSpan" id="kobo.551.1">%</span></strong><span class="koboSpan" id="kobo.552.1">) to check whether the unit represented by the dial can be divided by five. </span><span class="koboSpan" id="kobo.552.2">If it can, then we draw it </span><span class="No-Break"><span class="koboSpan" id="kobo.553.1">slightly longer.</span></span></p>
<p><span class="koboSpan" id="kobo.554.1">Without using a timer to </span><a id="_idIndexMarker305"/><span class="koboSpan" id="kobo.555.1">constantly call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.556.1">update()</span></strong><span class="koboSpan" id="kobo.557.1"> slot, the clock will not function properly. </span><span class="koboSpan" id="kobo.557.2">This is because </span><strong class="source-inline"><span class="koboSpan" id="kobo.558.1">paintEvent()</span></strong><span class="koboSpan" id="kobo.559.1"> will not be called by Qt when there is no change to the state of the parent widget, which in this case is the main window. </span><span class="koboSpan" id="kobo.559.2">Therefore, we need to manually tell Qt that we need to refresh the graphics by calling </span><strong class="source-inline"><span class="koboSpan" id="kobo.560.1">update()</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.561.1">every second.</span></span></p>
<p><span class="koboSpan" id="kobo.562.1">We used the </span><strong class="source-inline"><span class="koboSpan" id="kobo.563.1">painter.setRenderHint(QPainter::Antialiasing)</span></strong><span class="koboSpan" id="kobo.564.1"> function to enable anti-aliasing when rendering the clock. </span><span class="koboSpan" id="kobo.564.2">Without anti-aliasing, the graphics will look very jagged </span><span class="No-Break"><span class="koboSpan" id="kobo.565.1">and pixelated:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer064">
<span class="koboSpan" id="kobo.566.1"><img alt="Figure 4.7 – Anti-aliasing produces a smoother result" src="image/B20976_04_007.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.567.1">Figure 4.7 – Anti-aliasing produces a smoother result</span></p>
<h2 id="_idParaDest-103"><a id="_idTextAnchor103"/><span class="koboSpan" id="kobo.568.1">There’s more…</span></h2>
<p><span class="koboSpan" id="kobo.569.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.570.1">QPainter</span></strong><span class="koboSpan" id="kobo.571.1"> class uses the coordinate system to determine the position and size of the graphics before rendering them on screen. </span><span class="koboSpan" id="kobo.571.2">This information can be altered to make the graphics appear at a different position, rotation, and size. </span><span class="koboSpan" id="kobo.571.3">This process of altering the coordinate information of a graphic is what we call coordinate transformation. </span><span class="koboSpan" id="kobo.571.4">There are</span><a id="_idIndexMarker306"/><span class="koboSpan" id="kobo.572.1"> several types</span><a id="_idIndexMarker307"/><span class="koboSpan" id="kobo.573.1"> of transformation: among</span><a id="_idIndexMarker308"/><span class="koboSpan" id="kobo.574.1"> them </span><a id="_idIndexMarker309"/><span class="koboSpan" id="kobo.575.1">are </span><strong class="bold"><span class="koboSpan" id="kobo.576.1">translation</span></strong><span class="koboSpan" id="kobo.577.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.578.1">rotation</span></strong><span class="koboSpan" id="kobo.579.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.580.1">scaling</span></strong><span class="koboSpan" id="kobo.581.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.582.1">and </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.583.1">shearing</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.584.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer065">
<span class="koboSpan" id="kobo.585.1"><img alt="Figure 4.8 – Different types of transformations" src="image/B20976_04_008.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.586.1">Figure 4.8 – Different types of transformations</span></p>
<p><span class="koboSpan" id="kobo.587.1">Qt uses a coordinate system that has its origin at the top-left corner, meaning the </span><em class="italic"><span class="koboSpan" id="kobo.588.1">x</span></em><span class="koboSpan" id="kobo.589.1"> values increase to the right and the </span><em class="italic"><span class="koboSpan" id="kobo.590.1">y</span></em><span class="koboSpan" id="kobo.591.1"> values increase downward. </span><span class="koboSpan" id="kobo.591.2">This coordinate system might be different from the coordinate system used by the physical device, such as a computer screen. </span><span class="koboSpan" id="kobo.591.3">Qt handles </span><a id="_idIndexMarker310"/><span class="koboSpan" id="kobo.592.1">this automatically by using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.593.1">QPaintDevice</span></strong><span class="koboSpan" id="kobo.594.1"> class, which maps Qt’s logical coordinates to the </span><span class="No-Break"><span class="koboSpan" id="kobo.595.1">physical coordinates.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.596.1">QPainter</span></strong><span class="koboSpan" id="kobo.597.1"> provides four transform operations to perform different types </span><span class="No-Break"><span class="koboSpan" id="kobo.598.1">of transformation:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.599.1">QPainter::translate()</span></strong><span class="koboSpan" id="kobo.600.1">: This offsets the graphic’s position by a given set </span><span class="No-Break"><span class="koboSpan" id="kobo.601.1">of units</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.602.1">QPainter::rotate()</span></strong><span class="koboSpan" id="kobo.603.1">: This rotates the graphics around the origin in a </span><span class="No-Break"><span class="koboSpan" id="kobo.604.1">clockwise direction</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.605.1">QPainter::scale()</span></strong><span class="koboSpan" id="kobo.606.1">: This offsets the graphic’s size by a </span><span class="No-Break"><span class="koboSpan" id="kobo.607.1">given factor</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.608.1">QPainter::shear()</span></strong><span class="koboSpan" id="kobo.609.1">: This twists the graphic’s coordinate system around </span><span class="No-Break"><span class="koboSpan" id="kobo.610.1">the origin</span></span></li>
</ul>
<h1 id="_idParaDest-104"><a id="_idTextAnchor104"/><span class="koboSpan" id="kobo.611.1">Displaying images on screen</span></h1>
<p><span class="koboSpan" id="kobo.612.1">Qt not only allows us to draw shapes and images on screen, but it also allows us to overlay multiple images on top of</span><a id="_idIndexMarker311"/><span class="koboSpan" id="kobo.613.1"> each other and combine the pixel information from all the layers using different types of algorithms to create very interesting results. </span><span class="koboSpan" id="kobo.613.2">In this example, we will learn how to overlay images on top of each other and apply different composition effects </span><span class="No-Break"><span class="koboSpan" id="kobo.614.1">to them.</span></span></p>
<h2 id="_idParaDest-105"><a id="_idTextAnchor105"/><span class="koboSpan" id="kobo.615.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.616.1">Let’s create a simple demo that shows the effect of different image compositions by following </span><span class="No-Break"><span class="koboSpan" id="kobo.617.1">these steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.618.1">First, set up a new </span><strong class="bold"><span class="koboSpan" id="kobo.619.1">Qt Widgets Application</span></strong><span class="koboSpan" id="kobo.620.1"> project and remove the </span><strong class="source-inline"><span class="koboSpan" id="kobo.621.1">menuBar</span></strong><span class="koboSpan" id="kobo.622.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.623.1">mainToolBar</span></strong><span class="koboSpan" id="kobo.624.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.625.1">statusBar</span></strong><span class="koboSpan" id="kobo.626.1">, as we did in the </span><span class="No-Break"><span class="koboSpan" id="kobo.627.1">first recipe.</span></span></li>
<li><span class="koboSpan" id="kobo.628.1">Next, add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.629.1">QPainter</span></strong><span class="koboSpan" id="kobo.630.1"> class header to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.631.1">mainwindow.h</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.632.1"> file:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.633.1">
#include &lt;QPainter&gt;</span></pre></li> <li><span class="koboSpan" id="kobo.634.1">After that, declare the </span><strong class="source-inline"><span class="koboSpan" id="kobo.635.1">paintEvent()</span></strong><span class="koboSpan" id="kobo.636.1"> virtual function, </span><span class="No-Break"><span class="koboSpan" id="kobo.637.1">like so:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.638.1">
virtual void paintEvent(QPaintEvent* event);</span></pre></li> <li><span class="koboSpan" id="kobo.639.1">In </span><strong class="source-inline"><span class="koboSpan" id="kobo.640.1">mainwindow.cpp</span></strong><span class="koboSpan" id="kobo.641.1">, we will first load several image files using the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.642.1">QImage</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.643.1"> class:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.644.1">
void MainWindow::paintEvent(QPaintEvent* event) {
    </span><strong class="bold"><span class="koboSpan" id="kobo.645.1">QImage image;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.646.1">    image.load("checker.png");</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.647.1">    QImage image2;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.648.1">    image2.load("tux.png");</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.649.1">    QImage image3;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.650.1">    image3.load("butterfly.png");</span></strong><span class="koboSpan" id="kobo.651.1">
}</span></pre></li> <li><span class="koboSpan" id="kobo.652.1">Then, create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.653.1">QPainter</span></strong><span class="koboSpan" id="kobo.654.1"> object and use it to draw two pairs of images, where one image is on top of </span><span class="No-Break"><span class="koboSpan" id="kobo.655.1">the other:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.656.1">
QPainter painter(this);
painter.drawImage(QPoint(10, 10), image);
painter.drawImage(QPoint(10, 10), image2);
painter.drawImage(QPoint(300, 10), image);
painter.drawImage(QPoint(300, 40), image3);</span></pre></li> <li><span class="koboSpan" id="kobo.657.1">Now, compile and run</span><a id="_idIndexMarker312"/><span class="koboSpan" id="kobo.658.1"> the program and you should see something </span><span class="No-Break"><span class="koboSpan" id="kobo.659.1">like this:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer066">
<span class="koboSpan" id="kobo.660.1"><img alt="Figure 4.9 – Displaying images normally" src="image/B20976_04_009.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.661.1">Figure 4.9 – Displaying images normally</span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.662.1">Next, we will set the composition mode before drawing each image </span><span class="No-Break"><span class="koboSpan" id="kobo.663.1">on screen:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.664.1">
QPainter painter(this);
painter.setCompositionMode(QPainter::CompositionMode_Difference);
painter.drawImage(QPoint(10, 10), image);
painter.setCompositionMode(QPainter::CompositionMode_Multiply);
painter.drawImage(QPoint(10, 10), image2);
painter.setCompositionMode(QPainter::CompositionMode_Xor);
painter.drawImage(QPoint(300, 10), image);
painter.setCompositionMode(QPainter::CompositionMode_SoftLight);
painter.drawImage(QPoint(300, 40), image3);</span></pre></li> <li><span class="koboSpan" id="kobo.665.1">Compile and run the</span><a id="_idIndexMarker313"/><span class="koboSpan" id="kobo.666.1"> program again and you will now see something </span><span class="No-Break"><span class="koboSpan" id="kobo.667.1">like this:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer067">
<span class="koboSpan" id="kobo.668.1"><img alt="Figure 4.10 – Applying different composition modes to the images" src="image/B20976_04_010.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.669.1">Figure 4.10 – Applying different composition modes to the images</span></p>
<h2 id="_idParaDest-106"><a id="_idTextAnchor106"/><span class="koboSpan" id="kobo.670.1">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.671.1">When drawing images with Qt, the sequence of calling the </span><strong class="source-inline"><span class="koboSpan" id="kobo.672.1">drawImage()</span></strong><span class="koboSpan" id="kobo.673.1"> function will determine which image is being rendered first and which one is rendered later. </span><span class="koboSpan" id="kobo.673.2">This will affect the depth order of the images and yield </span><span class="No-Break"><span class="koboSpan" id="kobo.674.1">different outcomes.</span></span></p>
<p><span class="koboSpan" id="kobo.675.1">In the previous example, we called the </span><strong class="source-inline"><span class="koboSpan" id="kobo.676.1">drawImage()</span></strong><span class="koboSpan" id="kobo.677.1"> function four times to draw four different images on screen. </span><span class="koboSpan" id="kobo.677.2">The first </span><strong class="source-inline"><span class="koboSpan" id="kobo.678.1">drawImage()</span></strong><span class="koboSpan" id="kobo.679.1"> function renders </span><strong class="source-inline"><span class="koboSpan" id="kobo.680.1">checker.png</span></strong><span class="koboSpan" id="kobo.681.1">, and the second </span><strong class="source-inline"><span class="koboSpan" id="kobo.682.1">drawImage()</span></strong><span class="koboSpan" id="kobo.683.1"> function renders </span><strong class="source-inline"><span class="koboSpan" id="kobo.684.1">tux.png</span></strong><span class="koboSpan" id="kobo.685.1"> (the penguin). </span><span class="koboSpan" id="kobo.685.2">The image that gets rendered later will always appear in front of the others, which is why the penguin is showing in front of the checkered pattern. </span><span class="koboSpan" id="kobo.685.3">The same goes for the butterfly and the checkered pattern on the right. </span><span class="koboSpan" id="kobo.685.4">The reason why you can still see the checkered pattern even though the butterfly is rendered in front of it is because the butterfly image is not </span><span class="No-Break"><span class="koboSpan" id="kobo.686.1">fully opaque.</span></span></p>
<p><span class="koboSpan" id="kobo.687.1">Now, let’s invert the render</span><a id="_idIndexMarker314"/><span class="koboSpan" id="kobo.688.1"> sequence and see what happens. </span><span class="koboSpan" id="kobo.688.2">We will try to render the penguin first, followed by the checkered box. </span><span class="koboSpan" id="kobo.688.3">The same goes for the other pair of images on the right: the butterfly gets rendered first, followed by the </span><span class="No-Break"><span class="koboSpan" id="kobo.689.1">checkered box:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer068">
<span class="koboSpan" id="kobo.690.1"><img alt="Figure 4.11 – Both the penguin and butterfly are covered by the checkered boxes" src="image/B20976_04_011.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.691.1">Figure 4.11 – Both the penguin and butterfly are covered by the checkered boxes</span></p>
<p><span class="koboSpan" id="kobo.692.1">To apply a composition effect to the image, we’ll have to set the painter’s composition mode before drawing the image, by calling the </span><strong class="source-inline"><span class="koboSpan" id="kobo.693.1">painter.setCompositionMode()</span></strong><span class="koboSpan" id="kobo.694.1"> function. </span><span class="koboSpan" id="kobo.694.2">You can pick a desired composition mode from the auto-complete menu by </span><span class="No-Break"><span class="koboSpan" id="kobo.695.1">typing </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.696.1">QPainter::CompositionMode</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.697.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.698.1">In the previous example, we applied </span><strong class="source-inline"><span class="koboSpan" id="kobo.699.1">QPainter::CompositionMode_Difference</span></strong><span class="koboSpan" id="kobo.700.1"> to the checkered box on the left, which inverted its color. </span><span class="koboSpan" id="kobo.700.2">Next, we applied </span><strong class="source-inline"><span class="koboSpan" id="kobo.701.1">QPainter::CompositionMode_Overlay</span></strong><span class="koboSpan" id="kobo.702.1"> to the penguin, which makes it blend with the checkered pattern, and were able to see both images overlaying each other. </span><span class="koboSpan" id="kobo.702.2">On the right-hand side, we applied </span><strong class="source-inline"><span class="koboSpan" id="kobo.703.1">QPainter::CompositionMode_Xor</span></strong><span class="koboSpan" id="kobo.704.1"> to the checkered box, where, if differences exist between the source and destination, colors are shown; otherwise, it will be </span><span class="No-Break"><span class="koboSpan" id="kobo.705.1">rendered black.</span></span></p>
<p><span class="koboSpan" id="kobo.706.1">Since it’s comparing differences with the white background, the non-transparent part of the checkered box becomes completely black. </span><span class="koboSpan" id="kobo.706.2">We also applied </span><strong class="source-inline"><span class="koboSpan" id="kobo.707.1">QPainter::CompositionMode_SoftLight</span></strong><span class="koboSpan" id="kobo.708.1"> to the butterfly image. </span><span class="koboSpan" id="kobo.708.2">This blends the pixels with the background with reduced contrast. </span><span class="koboSpan" id="kobo.708.3">If you want to disable the composition mode that </span><a id="_idIndexMarker315"/><span class="koboSpan" id="kobo.709.1">you’ve just set for the previous rendering before proceeding to the next, simply set it back to the default mode, which </span><span class="No-Break"><span class="koboSpan" id="kobo.710.1">is </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.711.1">QPainter::CompositionMode_SourceOver</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.712.1">.</span></span></p>
<h2 id="_idParaDest-107"><a id="_idTextAnchor107"/><span class="koboSpan" id="kobo.713.1">There’s more…</span></h2>
<p><span class="koboSpan" id="kobo.714.1">For example, we can overlay multiple images on top of each other and use Qt’s </span><strong class="bold"><span class="koboSpan" id="kobo.715.1">Image Composition</span></strong><span class="koboSpan" id="kobo.716.1"> feature to merge </span><a id="_idIndexMarker316"/><span class="koboSpan" id="kobo.717.1">them together and calculate the resulting pixels on screen, based on the composition mode we used. </span><span class="koboSpan" id="kobo.717.2">This is often used in image editing software such as Photoshop and GIMP to composite </span><span class="No-Break"><span class="koboSpan" id="kobo.718.1">image layers.</span></span></p>
<p><span class="koboSpan" id="kobo.719.1">There are more than 30 types of composition </span><a id="_idIndexMarker317"/><span class="koboSpan" id="kobo.720.1">modes available in Qt. </span><span class="koboSpan" id="kobo.720.2">Some of the most commonly used modes are </span><span class="No-Break"><span class="koboSpan" id="kobo.721.1">as follows:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.722.1">Clear</span></strong><span class="koboSpan" id="kobo.723.1">: The pixels in the destination are set to fully transparent, independent of </span><span class="No-Break"><span class="koboSpan" id="kobo.724.1">the source.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.725.1">Source</span></strong><span class="koboSpan" id="kobo.726.1">: The output is the source pixel. </span><span class="koboSpan" id="kobo.726.2">This mode is the inverse </span><span class="No-Break"><span class="koboSpan" id="kobo.727.1">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.728.1">CompositionMode_Destination</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.729.1">.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.730.1">Destination</span></strong><span class="koboSpan" id="kobo.731.1">: The output is the destination pixel. </span><span class="koboSpan" id="kobo.731.2">This means that the blending has no effect. </span><span class="koboSpan" id="kobo.731.3">This mode is the inverse </span><span class="No-Break"><span class="koboSpan" id="kobo.732.1">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.733.1">CompositionMode_Source</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.734.1">.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.735.1">Source Over</span></strong><span class="koboSpan" id="kobo.736.1">: This is often referred to as </span><strong class="bold"><span class="koboSpan" id="kobo.737.1">alpha blending</span></strong><span class="koboSpan" id="kobo.738.1">. </span><span class="koboSpan" id="kobo.738.2">The alpha of the source is used to blend the pixel on </span><a id="_idIndexMarker318"/><span class="koboSpan" id="kobo.739.1">top of the destination. </span><span class="koboSpan" id="kobo.739.2">This is the default mode used </span><span class="No-Break"><span class="koboSpan" id="kobo.740.1">by </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.741.1">QPainter</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.742.1">.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.743.1">Destination Over</span></strong><span class="koboSpan" id="kobo.744.1">: The output is the blend between the alpha of the destination on top of the source pixels. </span><span class="koboSpan" id="kobo.744.2">The opposite of this mode </span><span class="No-Break"><span class="koboSpan" id="kobo.745.1">is </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.746.1">CompositionMode_SourceOver</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.747.1">.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.748.1">Source In</span></strong><span class="koboSpan" id="kobo.749.1">: The output is the source, where the alpha is reduced by that of </span><span class="No-Break"><span class="koboSpan" id="kobo.750.1">the destination.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.751.1">Destination In</span></strong><span class="koboSpan" id="kobo.752.1">: The output is the destination, where the alpha is reduced by that of the source. </span><span class="koboSpan" id="kobo.752.2">This mode is the inverse </span><span class="No-Break"><span class="koboSpan" id="kobo.753.1">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.754.1">CompositionMode_SourceIn</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.755.1">.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.756.1">Source Out</span></strong><span class="koboSpan" id="kobo.757.1">: The output is the</span><a id="_idIndexMarker319"/><span class="koboSpan" id="kobo.758.1"> source, where the alpha is reduced by the inverse of </span><span class="No-Break"><span class="koboSpan" id="kobo.759.1">the destination.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.760.1">Destination Out</span></strong><span class="koboSpan" id="kobo.761.1">: The output is the destination, where the alpha is reduced by the inverse of the source. </span><span class="koboSpan" id="kobo.761.2">This mode is the inverse </span><span class="No-Break"><span class="koboSpan" id="kobo.762.1">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.763.1">CompositionMode_SourceOut</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.764.1">.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.765.1">Source Atop</span></strong><span class="koboSpan" id="kobo.766.1">: The source pixel is blended on top of the destination, with the alpha of the source pixel reduced by the alpha of the </span><span class="No-Break"><span class="koboSpan" id="kobo.767.1">destination pixel.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.768.1">Destination Atop</span></strong><span class="koboSpan" id="kobo.769.1">: The destination pixel is blended on top of the source, with the alpha of the source pixel reduced by the alpha of the destination pixel. </span><span class="koboSpan" id="kobo.769.2">This mode is the inverse </span><span class="No-Break"><span class="koboSpan" id="kobo.770.1">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.771.1">CompositionMode_SourceAtop</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.772.1">.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.773.1">Xor</span></strong><span class="koboSpan" id="kobo.774.1">: This is short for </span><strong class="source-inline"><span class="koboSpan" id="kobo.775.1">Exclusive OR</span></strong><span class="koboSpan" id="kobo.776.1">, which is an advanced blending mode that is primarily used for image analysis. </span><span class="koboSpan" id="kobo.776.2">Using this is much more complicated with this composition mode. </span><span class="koboSpan" id="kobo.776.3">First, the alpha of the source is reduced by the inverse of the destination alpha. </span><span class="koboSpan" id="kobo.776.4">Then, the alpha of the destination is reduced by the inverse of the source alpha. </span><span class="koboSpan" id="kobo.776.5">Finally, both the source and destination are then merged to produce </span><span class="No-Break"><span class="koboSpan" id="kobo.777.1">the output.</span></span></li>
</ul>
<p class="callout-heading"><span class="koboSpan" id="kobo.778.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.779.1">For more information, you can visit this </span><span class="No-Break"><span class="koboSpan" id="kobo.780.1">link: </span></span><a href="https://pyside.github.io"><span class="No-Break"><span class="koboSpan" id="kobo.781.1">https://pyside.github.io</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.782.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.783.1">The following figure shows the outcome of overlaying two images with different </span><span class="No-Break"><span class="koboSpan" id="kobo.784.1">composition modes:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer069">
<span class="koboSpan" id="kobo.785.1"><img alt="Figure 4.12 – Different types of composition modes" src="image/B20976_04_012.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.786.1">Figure 4.12 – Different types of composition modes</span></p>
<h1 id="_idParaDest-108"><a id="_idTextAnchor108"/><span class="koboSpan" id="kobo.787.1">Applying image effects to graphics</span></h1>
<p><span class="koboSpan" id="kobo.788.1">Qt provides an easy way to </span><a id="_idIndexMarker320"/><span class="koboSpan" id="kobo.789.1">add image effects to any graphics drawn using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.790.1">QPainter</span></strong><span class="koboSpan" id="kobo.791.1"> class. </span><span class="koboSpan" id="kobo.791.2">In this example, we will learn how to apply different image effects, such as </span><a id="_idIndexMarker321"/><span class="koboSpan" id="kobo.792.1">drop shadow, blur, colorize, and opacity effects, to a graphic before displaying it </span><span class="No-Break"><span class="koboSpan" id="kobo.793.1">on screen.</span></span></p>
<h2 id="_idParaDest-109"><a id="_idTextAnchor109"/><span class="koboSpan" id="kobo.794.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.795.1">Let’s learn how to apply image effects to text and graphics by following </span><span class="No-Break"><span class="koboSpan" id="kobo.796.1">these steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.797.1">Create a new </span><strong class="bold"><span class="koboSpan" id="kobo.798.1">Qt Widgets Application</span></strong><span class="koboSpan" id="kobo.799.1"> project and remove the </span><strong class="source-inline"><span class="koboSpan" id="kobo.800.1">menuBar</span></strong><span class="koboSpan" id="kobo.801.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.802.1">mainToolBar</span></strong><span class="koboSpan" id="kobo.803.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.804.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.805.1">StatusBar</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.806.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.807.1">Create a new resource file by going to </span><strong class="bold"><span class="koboSpan" id="kobo.808.1">File</span></strong><span class="koboSpan" id="kobo.809.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.810.1">New File or Project</span></strong><span class="koboSpan" id="kobo.811.1"> and add all the images required by </span><span class="No-Break"><span class="koboSpan" id="kobo.812.1">the project:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer070">
<span class="koboSpan" id="kobo.813.1"><img alt="Figure 4.13 – Creating a new Qt resource file" src="image/B20976_04_013.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.814.1">Figure 4.13 – Creating a new Qt resource file</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.815.1">Next, open up </span><strong class="source-inline"><span class="koboSpan" id="kobo.816.1">mainwindow.ui</span></strong><span class="koboSpan" id="kobo.817.1"> and</span><a id="_idIndexMarker322"/><span class="koboSpan" id="kobo.818.1"> add four labels to the window. </span><span class="koboSpan" id="kobo.818.2">Two of </span><a id="_idIndexMarker323"/><span class="koboSpan" id="kobo.819.1">the labels will be text, and the two others we will load with the images we have just added to the </span><span class="No-Break"><span class="koboSpan" id="kobo.820.1">resource file:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer071">
<span class="koboSpan" id="kobo.821.1"><img alt="Figure 4.14 – Application filled with text and images" src="image/B20976_04_014.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.822.1">Figure 4.14 – Application filled with text and images</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.823.1">You may already notice that</span><a id="_idIndexMarker324"/><span class="koboSpan" id="kobo.824.1"> the font sizes are way bigger than the default size. </span><span class="koboSpan" id="kobo.824.2">That can be achieved </span><a id="_idIndexMarker325"/><span class="koboSpan" id="kobo.825.1">by adding a style sheet to the label widget, for example, </span><span class="No-Break"><span class="koboSpan" id="kobo.826.1">as follows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.827.1">
font: 26pt "MS Gothic";</span></pre></li> <li><span class="koboSpan" id="kobo.828.1">After that, open up </span><strong class="source-inline"><span class="koboSpan" id="kobo.829.1">mainwindow.cpp</span></strong><span class="koboSpan" id="kobo.830.1"> and include the following headers at the top of the </span><span class="No-Break"><span class="koboSpan" id="kobo.831.1">source code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.832.1">
#include &lt;QGraphicsBlurEffect&gt;
#include &lt;QGraphicsDropShadowEffect&gt;
#include &lt;QGraphicsColorizeEffect&gt;
#include &lt;QGraphicsOpacityEffect&gt;</span></pre></li> <li><span class="koboSpan" id="kobo.833.1">Then, within the constructor of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.834.1">MainWindow</span></strong><span class="koboSpan" id="kobo.835.1"> class, add the following code to create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.836.1">DropShadowEffect</span></strong><span class="koboSpan" id="kobo.837.1">, and apply it to one of </span><span class="No-Break"><span class="koboSpan" id="kobo.838.1">the labels:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.839.1">
MainWindow::MainWindow(QWidget *parent) : QMainWindow(parent),
ui(new Ui::MainWindow) {
ui-&gt;setupUi(this);
</span><strong class="bold"><span class="koboSpan" id="kobo.840.1">QGraphicsDropShadowEffect* shadow = new QGraphicsDropShadowEffect();</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.841.1">shadow-&gt;setXOffset(4);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.842.1">shadow-&gt;setYOffset(4);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.843.1">ui-&gt;label-&gt;setGraphicsEffect(shadow);</span></strong><span class="koboSpan" id="kobo.844.1">
}</span></pre></li> <li><span class="koboSpan" id="kobo.845.1">Next, we will create </span><strong class="source-inline"><span class="koboSpan" id="kobo.846.1">ColorizedEffect</span></strong><span class="koboSpan" id="kobo.847.1"> and apply it to one of the images, in this case, the </span><a id="_idIndexMarker326"/><span class="koboSpan" id="kobo.848.1">butterfly. </span><span class="koboSpan" id="kobo.848.2">We also set the effect color </span><span class="No-Break"><span class="koboSpan" id="kobo.849.1">to</span></span><span class="No-Break"><a id="_idIndexMarker327"/></span><span class="No-Break"><span class="koboSpan" id="kobo.850.1"> red:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.851.1">
QGraphicsColorizeEffect* colorize = new
QGraphicsColorizeEffect();
colorize-&gt;setColor(QColor(255, 0, 0));
ui-&gt;butterfly-&gt;setGraphicsEffect(colorize);</span></pre></li> <li><span class="koboSpan" id="kobo.852.1">Once we’re done with that, create </span><strong class="source-inline"><span class="koboSpan" id="kobo.853.1">BlurEffect</span></strong><span class="koboSpan" id="kobo.854.1"> and set its radius to </span><strong class="source-inline"><span class="koboSpan" id="kobo.855.1">12</span></strong><span class="koboSpan" id="kobo.856.1">. </span><span class="koboSpan" id="kobo.856.2">Then, apply the graphics effect to the </span><span class="No-Break"><span class="koboSpan" id="kobo.857.1">other label:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.858.1">
QGraphicsBlurEffect* blur = new QGraphicsBlurEffect();
blur-&gt;setBlurRadius(12);
ui-&gt;label2-&gt;setGraphicsEffect(blur);</span></pre></li> <li><span class="koboSpan" id="kobo.859.1">Lastly, create an alpha effect and apply it to the penguin image. </span><span class="koboSpan" id="kobo.859.2">We set the opacity value to </span><strong class="source-inline"><span class="koboSpan" id="kobo.860.1">0.2</span></strong><span class="koboSpan" id="kobo.861.1">, which means </span><span class="No-Break"><span class="koboSpan" id="kobo.862.1">20% opacity:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.863.1">
QGraphicsOpacityEffect* alpha = new QGraphicsOpacityEffect();
alpha-&gt;setOpacity(0.2);
ui-&gt;penguin-&gt;setGraphicsEffect(alpha);</span></pre></li> <li><span class="koboSpan" id="kobo.864.1">Now, compile and run the program and you should be able to see something </span><span class="No-Break"><span class="koboSpan" id="kobo.865.1">like this:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer072">
<span class="koboSpan" id="kobo.866.1"><img alt="Figure 4.15 – Different types of graphics effects being applied to the texts and images" src="image/B20976_04_015.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.867.1">Figure 4.15 – Different types of graphics effects being applied to the texts and images</span></p>
<h2 id="_idParaDest-110"><a id="_idTextAnchor110"/><span class="koboSpan" id="kobo.868.1">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.869.1">Each of the graphic effects is a class of its </span><a id="_idIndexMarker328"/><span class="koboSpan" id="kobo.870.1">own that inherits the </span><strong class="source-inline"><span class="koboSpan" id="kobo.871.1">QGraphicsEffect</span></strong><span class="koboSpan" id="kobo.872.1"> parent class. </span><span class="koboSpan" id="kobo.872.2">You can create</span><a id="_idIndexMarker329"/><span class="koboSpan" id="kobo.873.1"> your own custom effect by creating a new class that inherits </span><strong class="source-inline"><span class="koboSpan" id="kobo.874.1">QGraphicsEffect</span></strong><span class="koboSpan" id="kobo.875.1"> and re-implementing some of the functions </span><span class="No-Break"><span class="koboSpan" id="kobo.876.1">in it.</span></span></p>
<p><span class="koboSpan" id="kobo.877.1">Each effect has its own set of variables that are specifically created for it. </span><span class="koboSpan" id="kobo.877.2">For example, you can set the color of the colorized effect, but there is no such variable in the blur effect. </span><span class="koboSpan" id="kobo.877.3">This is because each effect is vastly different from the others, which is also why it needs to be a class of its own rather than using the same class for all the </span><span class="No-Break"><span class="koboSpan" id="kobo.878.1">different effects.</span></span></p>
<p><span class="koboSpan" id="kobo.879.1">It’s only possible to add a single graphics effect to a widget at a time. </span><span class="koboSpan" id="kobo.879.2">If you add more than one effect, only the last one will be applied to the widget, as it replaces the previous one. </span><span class="koboSpan" id="kobo.879.3">Other than that, be aware that if you create a graphics effect, for example, the drop shadow effect, you can’t assign it to two different widgets, as it will only get assigned to the last widget you applied it to. </span><span class="koboSpan" id="kobo.879.4">If you need to apply the same type of effect to several different widgets, create a few graphics effects of the same type and apply each of them to their </span><span class="No-Break"><span class="koboSpan" id="kobo.880.1">respective widgets.</span></span></p>
<h2 id="_idParaDest-111"><a id="_idTextAnchor111"/><span class="koboSpan" id="kobo.881.1">There’s more…</span></h2>
<p><span class="koboSpan" id="kobo.882.1">Currently, Qt supports blur, drop shadow, colorize, and opacity effects. </span><span class="koboSpan" id="kobo.882.2">These effects can be used by calling the following classes: </span><strong class="source-inline"><span class="koboSpan" id="kobo.883.1">QGraphicsBlurEffect</span></strong><span class="koboSpan" id="kobo.884.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.885.1">QGraphicsDropShadowEffect</span></strong><span class="koboSpan" id="kobo.886.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.887.1">QGraphicsColorizeEffect</span></strong><span class="koboSpan" id="kobo.888.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.889.1">QGraphicsOpacityEffect</span></strong><span class="koboSpan" id="kobo.890.1">. </span><span class="koboSpan" id="kobo.890.2">All these classes are inherited from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.891.1">QGraphicsEffect</span></strong><span class="koboSpan" id="kobo.892.1"> class. </span><span class="koboSpan" id="kobo.892.2">You can also create</span><a id="_idIndexMarker330"/><span class="koboSpan" id="kobo.893.1"> your own custom image effect by creating a subclass of </span><strong class="source-inline"><span class="koboSpan" id="kobo.894.1">QGrapicsEffect</span></strong><span class="koboSpan" id="kobo.895.1"> (or any other existing effects) and re-implementing the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.896.1">draw()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.897.1"> function.</span></span></p>
<p><span class="koboSpan" id="kobo.898.1">The graphics effect changes only</span><a id="_idIndexMarker331"/><span class="koboSpan" id="kobo.899.1"> the bounding rectangle of the source. </span><span class="koboSpan" id="kobo.899.2">If you want to increase the margin of the bounding rectangle, re-implement the virtual </span><strong class="source-inline"><span class="koboSpan" id="kobo.900.1">boundingRectFor()</span></strong><span class="koboSpan" id="kobo.901.1"> function, and call </span><strong class="source-inline"><span class="koboSpan" id="kobo.902.1">updateBoundingRect()</span></strong><span class="koboSpan" id="kobo.903.1"> to notify the framework whenever this </span><span class="No-Break"><span class="koboSpan" id="kobo.904.1">rectangle changes.</span></span></p>
<h1 id="_idParaDest-112"><a id="_idTextAnchor112"/><span class="koboSpan" id="kobo.905.1">Creating a basic paint program</span></h1>
<p><span class="koboSpan" id="kobo.906.1">Since we have learned so much about the </span><strong class="source-inline"><span class="koboSpan" id="kobo.907.1">QPainter</span></strong><span class="koboSpan" id="kobo.908.1"> class and how to use it to display graphics on screen, I guess</span><a id="_idIndexMarker332"/><span class="koboSpan" id="kobo.909.1"> it’s time for us to do something fun where we can put our knowledge </span><span class="No-Break"><span class="koboSpan" id="kobo.910.1">into practice.</span></span></p>
<p><span class="koboSpan" id="kobo.911.1">In this recipe, we will learn how to make a basic paint program that allows us to draw lines on a canvas with different brush sizes and colors. </span><span class="koboSpan" id="kobo.911.2">We will also learn how to use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.912.1">QImage</span></strong><span class="koboSpan" id="kobo.913.1"> class and mouse events in order to construct the </span><span class="No-Break"><span class="koboSpan" id="kobo.914.1">paint program.</span></span></p>
<h2 id="_idParaDest-113"><a id="_idTextAnchor113"/><span class="koboSpan" id="kobo.915.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.916.1">Let’s start our fun project with the </span><span class="No-Break"><span class="koboSpan" id="kobo.917.1">following steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.918.1">Again, we start by creating a new </span><strong class="bold"><span class="koboSpan" id="kobo.919.1">Qt Widgets Application</span></strong><span class="koboSpan" id="kobo.920.1"> project and removing the toolbar and status bar. </span><span class="koboSpan" id="kobo.920.2">We will keep the menu bar </span><span class="No-Break"><span class="koboSpan" id="kobo.921.1">this time.</span></span></li>
<li><span class="koboSpan" id="kobo.922.1">After that, set up the menu bar </span><span class="No-Break"><span class="koboSpan" id="kobo.923.1">like so:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer073">
<span class="koboSpan" id="kobo.924.1"><img alt="Figure 4.16 – Setting up the menu bar" src="image/B20976_04_016.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.925.1">Figure 4.16 – Setting up the menu bar</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.926.1">We will leave the menu bar as it is for the moment, so let’s proceed to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.927.1">mainwindow.h</span></strong><span class="koboSpan" id="kobo.928.1"> file. </span><span class="koboSpan" id="kobo.928.2">First, include</span><a id="_idIndexMarker333"/><span class="koboSpan" id="kobo.929.1"> the following header files, as they are required for </span><span class="No-Break"><span class="koboSpan" id="kobo.930.1">the project:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.931.1">
#include &lt;QPainter&gt;
#include &lt;QMouseEvent&gt;
#include &lt;QFileDialog&gt;</span></pre></li> <li><span class="koboSpan" id="kobo.932.1">Next, declare the variables that we’ll be using for this project, </span><span class="No-Break"><span class="koboSpan" id="kobo.933.1">like so:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.934.1">
private:
    Ui::MainWindow *ui;
    </span><strong class="bold"><span class="koboSpan" id="kobo.935.1">QImage image;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.936.1">    bool drawing;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.937.1">    QPoint lastPoint;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.938.1">    int brushSize;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.939.1">    QColor brushColor;</span></strong></pre></li> <li><span class="koboSpan" id="kobo.940.1">Then, declare the event callback functions, which are inherited from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.941.1">QWidget</span></strong><span class="koboSpan" id="kobo.942.1"> class. </span><span class="koboSpan" id="kobo.942.2">These functions will be triggered by Qt when the respective event happens. </span><span class="koboSpan" id="kobo.942.3">We will override these functions and tell Qt what to do when these events </span><span class="No-Break"><span class="koboSpan" id="kobo.943.1">get called:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.944.1">
public:
    explicit MainWindow(QWidget *parent = 0);
    ~MainWindow();
    </span><strong class="bold"><span class="koboSpan" id="kobo.945.1">virtual void mousePressEvent(QMouseEvent *event);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.946.1">    virtual void mouseMoveEvent(QMouseEvent *event);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.947.1">    virtual void mouseReleaseEvent(QMouseEvent *event);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.948.1">    virtual void paintEvent(QPaintEvent *event);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.949.1">    virtual void resizeEvent(QResizeEvent *event);</span></strong></pre></li> <li><span class="koboSpan" id="kobo.950.1">After that, go to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.951.1">mainwindow.cpp</span></strong><span class="koboSpan" id="kobo.952.1"> file and add the following code to the class constructor to set up some </span><a id="_idIndexMarker334"/><span class="koboSpan" id="kobo.953.1">of </span><span class="No-Break"><span class="koboSpan" id="kobo.954.1">the variables:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.955.1">
MainWindow::MainWindow(QWidget *parent) : QMainWindow(parent),
ui(new Ui::MainWindow) {
    ui-&gt;setupUi(this);
    </span><strong class="bold"><span class="koboSpan" id="kobo.956.1">image = QImage(this-&gt;size(), QImage::Format_RGB32);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.957.1">    </span></strong><strong class="bold"><span class="koboSpan" id="kobo.958.1">image.fill(Qt::white);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.959.1">    drawing = false;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.960.1">    brushColor = Qt::black;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.961.1">    brushSize = 2;</span></strong><span class="koboSpan" id="kobo.962.1">
}</span></pre></li> <li><span class="koboSpan" id="kobo.963.1">Next, we will construct the </span><strong class="source-inline"><span class="koboSpan" id="kobo.964.1">mousePressEvent()</span></strong><span class="koboSpan" id="kobo.965.1"> event and tell Qt what to do when the left mouse button </span><span class="No-Break"><span class="koboSpan" id="kobo.966.1">is pressed:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.967.1">
void MainWindow::mousePressEvent(QMouseEvent *event) {
    </span><strong class="bold"><span class="koboSpan" id="kobo.968.1">if (event-&gt;button() == Qt::LeftButton) {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.969.1">        drawing = true;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.970.1">        lastPoint = event-&gt;pos();</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.971.1">    }</span></strong><span class="koboSpan" id="kobo.972.1">
}</span></pre></li> <li><span class="koboSpan" id="kobo.973.1">Then, we will construct the </span><strong class="source-inline"><span class="koboSpan" id="kobo.974.1">mouseMoveEvent()</span></strong><span class="koboSpan" id="kobo.975.1"> event and tell Qt what to do when the mouse is moving. </span><span class="koboSpan" id="kobo.975.2">In this case, we want to draw the lines on the canvas if the left mouse button is</span><a id="_idIndexMarker335"/> <span class="No-Break"><span class="koboSpan" id="kobo.976.1">being held:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.977.1">
void MainWindow::mouseMoveEvent(QMouseEvent *event) {
    </span><strong class="bold"><span class="koboSpan" id="kobo.978.1">if ((event-&gt;buttons() &amp; Qt::LeftButton) &amp;&amp; drawing) {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.979.1">        QPainter painter(&amp;image);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.980.1">        painter.setPen(QPen(brushColor, brushSize, Qt::SolidLine, Qt::RoundCap, Qt::RoundJoin));</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.981.1">        painter.drawLine(lastPoint, event-&gt;pos());</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.982.1">lastPoint = event-&gt;pos();</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.983.1">         this-&gt;update();</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.984.1">    }</span></strong><span class="koboSpan" id="kobo.985.1">
}</span></pre></li> <li><span class="koboSpan" id="kobo.986.1">After that, we will also construct the </span><strong class="source-inline"><span class="koboSpan" id="kobo.987.1">mouseReleaseEvent()</span></strong><span class="koboSpan" id="kobo.988.1"> event, which will be triggered when the mouse button </span><span class="No-Break"><span class="koboSpan" id="kobo.989.1">is released:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.990.1">
void MainWindow::mouseReleaseEvent(QMouseEvent *event) {
    </span><strong class="bold"><span class="koboSpan" id="kobo.991.1">if (event-&gt;button() == Qt::LeftButton) {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.992.1">        drawing = false;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.993.1">    }</span></strong><span class="koboSpan" id="kobo.994.1">
}</span></pre></li> <li><span class="koboSpan" id="kobo.995.1">Once you’re done with that, we will proceed to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.996.1">paintEvent()</span></strong><span class="koboSpan" id="kobo.997.1"> event, which is surprisingly simple compared to the other examples we have seen in </span><span class="No-Break"><span class="koboSpan" id="kobo.998.1">previous sections:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.999.1">
void MainWindow::paintEvent(QPaintEvent *event) {
    </span><strong class="bold"><span class="koboSpan" id="kobo.1000.1">QPainter canvasPainter(this);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1001.1">    canvasPainter.drawImage(this-&gt;rect(), image, image.rect());</span></strong><span class="koboSpan" id="kobo.1002.1">
}</span></pre></li> <li><span class="koboSpan" id="kobo.1003.1">Remember how we have a</span><a id="_idIndexMarker336"/><span class="koboSpan" id="kobo.1004.1"> menu bar sitting around doing nothing? </span><span class="koboSpan" id="kobo.1004.2">Let’s right-click on each of the actions below the GUI editor and select </span><strong class="bold"><span class="koboSpan" id="kobo.1005.1">Go to slot…</span></strong><span class="koboSpan" id="kobo.1006.1"> in the pop-up menu. </span><span class="koboSpan" id="kobo.1006.2">We want to tell Qt what to do when each of these options on the menu bar </span><span class="No-Break"><span class="koboSpan" id="kobo.1007.1">is selected:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer074">
<span class="koboSpan" id="kobo.1008.1"><img alt="Figure 4.17 – Creating slot function for each of the menu actions" src="image/B20976_04_017.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1009.1">Figure 4.17 – Creating slot function for each of the menu actions</span></p>
<ol>
<li value="12"><span class="koboSpan" id="kobo.1010.1">Then, select the default slot called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1011.1">triggered()</span></strong><span class="koboSpan" id="kobo.1012.1"> and press the </span><strong class="bold"><span class="koboSpan" id="kobo.1013.1">OK</span></strong><span class="koboSpan" id="kobo.1014.1"> button. </span><span class="koboSpan" id="kobo.1014.2">Qt will automatically generate a new slot function in both your </span><strong class="source-inline"><span class="koboSpan" id="kobo.1015.1">mainwindow.h</span></strong><span class="koboSpan" id="kobo.1016.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1017.1">mainwindow.cpp</span></strong><span class="koboSpan" id="kobo.1018.1"> files. </span><span class="koboSpan" id="kobo.1018.2">Once you are done with all the actions, you should see something like this in your </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1019.1">mainwindow.h</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1020.1"> file:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1021.1">
private slots:
    void on_actionSave_triggered();
    void on_actionClear_triggered();
    void on_action2px_triggered();
    void on_action5px_triggered();
    void on_action10px_triggered();
    void on_actionBlack_triggered();
    void on_actionWhite_triggered();
    void on_actionRed_triggered();
    void on_actionGreen_triggered();
    void on_actionBlue_triggered();</span></pre></li> <li><span class="koboSpan" id="kobo.1022.1">Next, we will tell Qt what </span><a id="_idIndexMarker337"/><span class="koboSpan" id="kobo.1023.1">to do when each of these slots </span><span class="No-Break"><span class="koboSpan" id="kobo.1024.1">is triggered:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1025.1">
void MainWindow::on_actionSave_triggered() {
    </span><strong class="bold"><span class="koboSpan" id="kobo.1026.1">QString filePath = QFileDialog::getSaveFileName(this, «Save Image», «», «PNG (*.png);;JPEG (*.jpg *.jpeg);;All files</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1027.1">(*.*)»);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1028.1">    if (filePath == "")</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1029.1">        </span></strong><strong class="bold"><span class="koboSpan" id="kobo.1030.1">return;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1031.1">    image.save(filePath);</span></strong><span class="koboSpan" id="kobo.1032.1">
}
void MainWindow::on_actionClear_triggered() {
    </span><strong class="bold"><span class="koboSpan" id="kobo.1033.1">image.fill(Qt::white);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1034.1">    this-&gt;update();</span></strong><span class="koboSpan" id="kobo.1035.1">
}</span></pre></li> <li><span class="koboSpan" id="kobo.1036.1">Then, we continue to</span><a id="_idIndexMarker338"/><span class="koboSpan" id="kobo.1037.1"> implement the </span><span class="No-Break"><span class="koboSpan" id="kobo.1038.1">other slots:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1039.1">
void MainWindow::on_action2px_triggered() {
    </span><strong class="bold"><span class="koboSpan" id="kobo.1040.1">brushSize = 2;</span></strong><span class="koboSpan" id="kobo.1041.1">
}
void MainWindow::on_action5px_triggered() {
    </span><strong class="bold"><span class="koboSpan" id="kobo.1042.1">brushSize = 5;</span></strong><span class="koboSpan" id="kobo.1043.1">
}
void MainWindow::on_action10px_triggered() {
    </span><strong class="bold"><span class="koboSpan" id="kobo.1044.1">brushSize = 10;</span></strong><span class="koboSpan" id="kobo.1045.1">
}
void MainWindow::on_actionBlack_triggered() {
    </span><strong class="bold"><span class="koboSpan" id="kobo.1046.1">brushColor = Qt::black;</span></strong><span class="koboSpan" id="kobo.1047.1">
}</span></pre></li> <li><span class="koboSpan" id="kobo.1048.1">Finally, we implement the rest of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1049.1">slot functions:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1050.1">
void MainWindow::on_actionWhite_triggered() {
    </span><strong class="bold"><span class="koboSpan" id="kobo.1051.1">brushColor = Qt::white;</span></strong><span class="koboSpan" id="kobo.1052.1">
}
void MainWindow::on_actionRed_triggered() {
    </span><strong class="bold"><span class="koboSpan" id="kobo.1053.1">brushColor = Qt::red;</span></strong><span class="koboSpan" id="kobo.1054.1">
}
void MainWindow::on_actionGreen_triggered() {
    </span><strong class="bold"><span class="koboSpan" id="kobo.1055.1">brushColor = Qt::green;</span></strong><span class="koboSpan" id="kobo.1056.1">
}
void MainWindow::on_actionBlue_triggered() {
    </span><strong class="bold"><span class="koboSpan" id="kobo.1057.1">brushColor = Qt::blue;</span></strong><span class="koboSpan" id="kobo.1058.1">
}</span></pre></li> <li><span class="koboSpan" id="kobo.1059.1">If we compile and run the </span><a id="_idIndexMarker339"/><span class="koboSpan" id="kobo.1060.1">program now, we will get a simple but usable </span><span class="No-Break"><span class="koboSpan" id="kobo.1061.1">paint program:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer075">
<span class="koboSpan" id="kobo.1062.1"><img alt="Figure 4.18 – Our lovely paint program in action!" src="image/B20976_04_018.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1063.1">Figure 4.18 – Our lovely paint program in action!</span></p>
<h2 id="_idParaDest-114"><a id="_idTextAnchor114"/><span class="koboSpan" id="kobo.1064.1">How it works...</span></h2>
<p><span class="koboSpan" id="kobo.1065.1">In this example, we created a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1066.1">QImage</span></strong><span class="koboSpan" id="kobo.1067.1"> widget when the program started. </span><span class="koboSpan" id="kobo.1067.2">This widget acts as the canvas and will follow the size of the window whenever the window gets resized. </span><span class="koboSpan" id="kobo.1067.3">In order to draw something on the canvas, we will need to use the mouse events provided by Qt. </span><span class="koboSpan" id="kobo.1067.4">These events will tell us the position of the cursor, and we will be able to use this information to change the pixels on </span><span class="No-Break"><span class="koboSpan" id="kobo.1068.1">the canvas.</span></span></p>
<p><span class="koboSpan" id="kobo.1069.1">We use a Boolean variable called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1070.1">drawing</span></strong><span class="koboSpan" id="kobo.1071.1"> to let the program know whether it should start drawing when a mouse button is pressed. </span><span class="koboSpan" id="kobo.1071.2">In this case, when the left mouse button is pressed, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1072.1">drawing</span></strong><span class="koboSpan" id="kobo.1073.1"> variable will be set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1074.1">true</span></strong><span class="koboSpan" id="kobo.1075.1">. </span><span class="koboSpan" id="kobo.1075.2">We also save the current cursor position to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1076.1">lastPoint</span></strong><span class="koboSpan" id="kobo.1077.1"> variable when the left mouse button is pressed, so that Qt will know where it should start drawing. </span><span class="koboSpan" id="kobo.1077.2">When the mouse moves, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1078.1">mouseMoveEvent()</span></strong><span class="koboSpan" id="kobo.1079.1"> event will be triggered by Qt. </span><span class="koboSpan" id="kobo.1079.2">This is where we need to check whether the drawing variable is set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1080.1">true</span></strong><span class="koboSpan" id="kobo.1081.1">. </span><span class="koboSpan" id="kobo.1081.2">If it is, then </span><strong class="source-inline"><span class="koboSpan" id="kobo.1082.1">QPainter</span></strong><span class="koboSpan" id="kobo.1083.1"> can start drawing the lines onto the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1084.1">QImage</span></strong><span class="koboSpan" id="kobo.1085.1"> widget based on the brush settings that we provide. </span><span class="koboSpan" id="kobo.1085.2">The brush settings consist of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1086.1">brushColor</span></strong><span class="koboSpan" id="kobo.1087.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1088.1">brushSize</span></strong><span class="koboSpan" id="kobo.1089.1">. </span><span class="koboSpan" id="kobo.1089.2">These settings are saved as variables and can be altered by selecting a different setting from the </span><span class="No-Break"><span class="koboSpan" id="kobo.1090.1">menu bar.</span></span></p>
<p><span class="koboSpan" id="kobo.1091.1">Please remember to call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1092.1">update()</span></strong><span class="koboSpan" id="kobo.1093.1"> function when the user is drawing on the canvas. </span><span class="koboSpan" id="kobo.1093.2">Otherwise, the canvas will remain empty even though we have changed the pixel information of the canvas. </span><span class="koboSpan" id="kobo.1093.3">We also have to call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1094.1">update()</span></strong><span class="koboSpan" id="kobo.1095.1"> function when we select </span><strong class="bold"><span class="koboSpan" id="kobo.1096.1">File</span></strong><span class="koboSpan" id="kobo.1097.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.1098.1">Clear</span></strong><span class="koboSpan" id="kobo.1099.1"> from the menu bar to reset </span><span class="No-Break"><span class="koboSpan" id="kobo.1100.1">our canvas.</span></span></p>
<p><span class="koboSpan" id="kobo.1101.1">In this example, we use </span><strong class="source-inline"><span class="koboSpan" id="kobo.1102.1">QImage::save()</span></strong><span class="koboSpan" id="kobo.1103.1"> to save the image file, which is very straightforward. </span><span class="koboSpan" id="kobo.1103.2">We use the file dialog</span><a id="_idIndexMarker340"/><span class="koboSpan" id="kobo.1104.1"> to let the user decide where to save the image and its desired filename. </span><span class="koboSpan" id="kobo.1104.2">Then, we pass the information to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1105.1">QImage</span></strong><span class="koboSpan" id="kobo.1106.1">, and it will do the rest by itself. </span><span class="koboSpan" id="kobo.1106.2">If we don’t specify the file format to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1107.1">QImage::save()</span></strong><span class="koboSpan" id="kobo.1108.1"> function, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1109.1">QImage</span></strong><span class="koboSpan" id="kobo.1110.1"> will try to figure it out by looking at the extension of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1111.1">desired filename.</span></span></p>
<h1 id="_idParaDest-115"><a id="_idTextAnchor115"/><span class="koboSpan" id="kobo.1112.1">Rendering a 2D canvas in QML</span></h1>
<p><span class="koboSpan" id="kobo.1113.1">In all the previous examples </span><a id="_idIndexMarker341"/><span class="koboSpan" id="kobo.1114.1">of this chapter, we have discussed the methods and techniques </span><a id="_idIndexMarker342"/><span class="koboSpan" id="kobo.1115.1">used to render 2D graphics with Qt’s C++ API. </span><span class="koboSpan" id="kobo.1115.2">However, we have yet to learn how to achieve similar results using the powerful </span><span class="No-Break"><span class="koboSpan" id="kobo.1116.1">QML script.</span></span></p>
<h2 id="_idParaDest-116"><a id="_idTextAnchor116"/><span class="koboSpan" id="kobo.1117.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.1118.1">In this project, we’ll be doing something </span><span class="No-Break"><span class="koboSpan" id="kobo.1119.1">quite different:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1120.1">As usual, the first step is to create a new project by going to </span><strong class="bold"><span class="koboSpan" id="kobo.1121.1">File</span></strong><span class="koboSpan" id="kobo.1122.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.1123.1">New File or Project</span></strong><span class="koboSpan" id="kobo.1124.1"> and selecting </span><strong class="bold"><span class="koboSpan" id="kobo.1125.1">Qt Quick Application</span></strong><span class="koboSpan" id="kobo.1126.1"> as the </span><span class="No-Break"><span class="koboSpan" id="kobo.1127.1">project template:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer076">
<span class="koboSpan" id="kobo.1128.1"><img alt="Figure 4.19 – Creating a new Qt Quick Application project" src="image/B20976_04_019.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1129.1">Figure 4.19 – Creating a new Qt Quick Application project</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.1130.1">Once you are done creating </span><a id="_idIndexMarker343"/><span class="koboSpan" id="kobo.1131.1">the new project, open up </span><strong class="source-inline"><span class="koboSpan" id="kobo.1132.1">main.qml</span></strong><span class="koboSpan" id="kobo.1133.1">, which is</span><a id="_idIndexMarker344"/><span class="koboSpan" id="kobo.1134.1"> listed under </span><strong class="source-inline"><span class="koboSpan" id="kobo.1135.1">qml.qrc</span></strong><span class="koboSpan" id="kobo.1136.1"> in the project pane. </span><span class="koboSpan" id="kobo.1136.2">After that, set an ID for the window and adjust its </span><strong class="source-inline"><span class="koboSpan" id="kobo.1137.1">width</span></strong><span class="koboSpan" id="kobo.1138.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1139.1">height</span></strong><span class="koboSpan" id="kobo.1140.1"> values to larger values, </span><span class="No-Break"><span class="koboSpan" id="kobo.1141.1">like so:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1142.1">
import QtQuick
import QtQuick.Window
Window {
    </span><strong class="bold"><span class="koboSpan" id="kobo.1143.1">id: myWindow</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1144.1">    visible: true</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1145.1">    width: 640</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1146.1">    height: 480</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1147.1">    title: qsTr("Hello World")</span></strong><span class="koboSpan" id="kobo.1148.1">
}</span></pre></li> <li><span class="koboSpan" id="kobo.1149.1">Then, add a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1150.1">Canvas</span></strong><span class="koboSpan" id="kobo.1151.1"> object under </span><strong class="source-inline"><span class="koboSpan" id="kobo.1152.1">myWindow</span></strong><span class="koboSpan" id="kobo.1153.1"> and call it </span><strong class="source-inline"><span class="koboSpan" id="kobo.1154.1">myCanvas</span></strong><span class="koboSpan" id="kobo.1155.1">. </span><span class="koboSpan" id="kobo.1155.2">After that, we make its </span><strong class="source-inline"><span class="koboSpan" id="kobo.1156.1">width</span></strong><span class="koboSpan" id="kobo.1157.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1158.1">height</span></strong><span class="koboSpan" id="kobo.1159.1"> values the same </span><span class="No-Break"><span class="koboSpan" id="kobo.1160.1">as </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1161.1">myWindow</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1162.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1163.1">
Window {
    id: myWindow
    visible: true
    width: 640
    height: 480
    </span><strong class="bold"><span class="koboSpan" id="kobo.1164.1">Canvas {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1165.1">        id: myCanvas</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1166.1">        width: myWindow.width</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1167.1">        height: myWindow.height</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1168.1">    }</span></strong><span class="koboSpan" id="kobo.1169.1">
}</span></pre></li> <li><span class="koboSpan" id="kobo.1170.1">Next, we define what</span><a id="_idIndexMarker345"/><span class="koboSpan" id="kobo.1171.1"> will happen when the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1172.1">onPaint</span></strong><span class="koboSpan" id="kobo.1173.1"> event is triggered; in this </span><a id="_idIndexMarker346"/><span class="koboSpan" id="kobo.1174.1">case, we will draw a cross on </span><span class="No-Break"><span class="koboSpan" id="kobo.1175.1">the window:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1176.1">
Canvas {
    id: myCanvas
    width: myWindow.width
    height: myWindow.height
    </span><strong class="bold"><span class="koboSpan" id="kobo.1177.1">onPaint: {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1178.1">        var context = getContext('2d')</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1179.1">        </span></strong><strong class="bold"><span class="koboSpan" id="kobo.1180.1">context.fillStyle = 'white'</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1181.1">        context.fillRect(0, 0, width, height)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1182.1">        context.lineWidth = 2</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1183.1">        context.strokeStyle = 'black'</span></strong></pre></li> <li><span class="koboSpan" id="kobo.1184.1">Let’s continue to write</span><a id="_idIndexMarker347"/><span class="koboSpan" id="kobo.1185.1"> the code, </span><span class="No-Break"><span class="koboSpan" id="kobo.1186.1">like so:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1187.1">
// Draw cross
context.beginPath()
context.moveTo(50, 50)
context.lineTo(100, 100)
context.closePath()
context.stroke()
context.beginPath()
context.moveTo(100, 50)
context.lineTo(50, 100)
context.closePath()
context.stroke()
}
}</span></pre></li> <li><span class="koboSpan" id="kobo.1188.1">After that, we add the</span><a id="_idIndexMarker348"/><span class="koboSpan" id="kobo.1189.1"> following code to draw a tick beside </span><span class="No-Break"><span class="koboSpan" id="kobo.1190.1">the cross:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1191.1">
// Draw tick
context.beginPath()
context.moveTo(150, 90)
context.lineTo(158, 100)
context.closePath()
context.stroke()
context.beginPath()
context.moveTo(180, 100)
context.lineTo(210, 50)
context.closePath()
context.stroke()</span></pre></li> <li><span class="koboSpan" id="kobo.1192.1">Then, draw a triangle shape</span><a id="_idIndexMarker349"/><span class="koboSpan" id="kobo.1193.1"> by adding the </span><span class="No-Break"><span class="koboSpan" id="kobo.1194.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1195.1">
// Draw triangle
context.lineWidth = 4
context.strokeStyle = "red"
context.fillStyle = "salmon"
context.beginPath()
context.moveTo(50,150)
context.lineTo(150,150)
context.lineTo(50,250)
context.closePath()
context.fill()
context.stroke()</span></pre></li> <li><span class="koboSpan" id="kobo.1196.1">After that, draw a half</span><a id="_idIndexMarker350"/><span class="koboSpan" id="kobo.1197.1"> circle and a full circle with the </span><span class="No-Break"><span class="koboSpan" id="kobo.1198.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1199.1">
// Draw circle
context.lineWidth = 4
context.strokeStyle = "blue"
context.fillStyle = "steelblue"
var pi = 3.141592653589793
context.beginPath()
context.arc(220, 200, 60, 0, pi, true)
context.closePath()
context.fill()
context.stroke()</span></pre></li> <li><span class="koboSpan" id="kobo.1200.1">Then, we draw </span><span class="No-Break"><span class="koboSpan" id="kobo.1201.1">an</span></span><span class="No-Break"><a id="_idIndexMarker351"/></span><span class="No-Break"><span class="koboSpan" id="kobo.1202.1"> arc:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1203.1">
context.beginPath()
context.arc(220, 280, 60, 0, 2 * pi, true)
context.closePath()
context.fill()
context.stroke()</span></pre></li> <li><span class="koboSpan" id="kobo.1204.1">Finally, we draw a 2D</span><a id="_idIndexMarker352"/><span class="koboSpan" id="kobo.1205.1"> image from </span><span class="No-Break"><span class="koboSpan" id="kobo.1206.1">a file:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1207.1">
// Draw image
context.drawImage("tux.png", 280, 10, 150, 174)</span></pre></li> <li><span class="koboSpan" id="kobo.1208.1">However, the preceding code alone will not successfully render an image on screen because you must also load the image file beforehand. </span><span class="koboSpan" id="kobo.1208.2">Add the following code within the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1209.1">Canvas</span></strong><span class="koboSpan" id="kobo.1210.1"> object to ask QML to load the image file when the program is started, then call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1211.1">requestPaint()</span></strong><span class="koboSpan" id="kobo.1212.1"> signal when the image is loaded so that the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1213.1">onPaint()</span></strong><span class="koboSpan" id="kobo.1214.1"> event slot will </span><span class="No-Break"><span class="koboSpan" id="kobo.1215.1">be triggered:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1216.1">
onImageLoaded: requestPaint();
onPaint: {
    // The code we added previously
}</span></pre></li> <li><span class="koboSpan" id="kobo.1217.1">Then, open up </span><strong class="source-inline"><span class="koboSpan" id="kobo.1218.1">qml.qrc</span></strong><span class="koboSpan" id="kobo.1219.1"> by right-clicking it in the project panel and select </span><strong class="bold"><span class="koboSpan" id="kobo.1220.1">Open in Editor</span></strong><span class="koboSpan" id="kobo.1221.1">. </span><span class="koboSpan" id="kobo.1221.2">After that, add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1222.1">tux.png</span></strong><span class="koboSpan" id="kobo.1223.1"> image file to our </span><span class="No-Break"><span class="koboSpan" id="kobo.1224.1">project resource:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer077">
<span class="koboSpan" id="kobo.1225.1"><img alt="Figure 4.20 – The tux.png image file is now listed under qml.qrc" src="image/B20976_04_020.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1226.1">Figure 4.20 – The tux.png image file is now listed under qml.qrc</span></p>
<ol>
<li value="13"><span class="koboSpan" id="kobo.1227.1">Now, build and run the </span><a id="_idIndexMarker353"/><span class="koboSpan" id="kobo.1228.1">program and you should get </span><span class="No-Break"><span class="koboSpan" id="kobo.1229.1">the</span></span><span class="No-Break"><a id="_idIndexMarker354"/></span><span class="No-Break"><span class="koboSpan" id="kobo.1230.1"> following:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer078">
<span class="koboSpan" id="kobo.1231.1"><img alt="Figure 4.21 – Tux the penguin is amused by the geometrical shapes" src="image/B20976_04_021.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1232.1">Figure 4.21 – Tux the penguin is amused by the geometrical shapes</span></p>
<p><span class="koboSpan" id="kobo.1233.1">In the preceding example, we learned how to draw simple vector shapes on our screen using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1234.1">Canvas</span></strong><span class="koboSpan" id="kobo.1235.1"> element. </span><span class="koboSpan" id="kobo.1235.2">Qt’s built-in modules make the complex rendering process more straightforward </span><span class="No-Break"><span class="koboSpan" id="kobo.1236.1">for programmers.</span></span></p>
</div>
</body></html>