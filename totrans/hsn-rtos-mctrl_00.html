<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Preface</h1>
                </header>
            
            <article>
                
<p>This<span> hands-on guide will provide you with the most important functional knowledge for getting a <strong>Real-Time Operating System</strong> (<strong>RTOS</strong>) up and running on a <strong>microcontroller</strong> <strong>unit</strong> (<strong>MCU</strong>)<strong>.</strong> If you're interested in learning how to implement applications using an RTOS with hands-on examples using actual hardware and discussing common performance versus development-time trade-offs, you're in the right place! </span></p>
<p><span>We'll be implementing code using the FreeRTOS kernel, working with the popular STM32 ARM MCUs using a low-cost STM Nucleo development board, and debugging/analyzing code with SEGGER debug tools.  All of the tools used in this book have been selected because they are easily accessible for the hobbyist or professional just getting started, and also because of their popularity in real-world professional teams. The knowledge and experience you gain through reading this book and working through the examples will be directly applicable to actual development in a professional environment.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Who this book is for</h1>
                </header>
            
            <article>
                
<p><span>RTOS programming is not a beginner's topic and is definitely not the right starting point for learning about embedded systems. If MCUs or the C language is totally new to you, then you're better off starting by covering the basics and getting some hands-on experience before diving into this more advanced topic.</span></p>
<p>So, who stands to benefit the most from working through this book?</p>
<p><strong>Professional programmers</strong>: You've always programmed on <em>bare metal</em> (no OS) and are looking to increase your MCU programming skills by learning how to use an RTOS to meet tight timing requirements, balance concurrent operations, and create modular code.</p>
<p><strong>Students interested in "getting their hands dirty"</strong>: You've been covering theory, listening to lectures, and coding lab exercises, but now you're looking for a complete guide that helps you to get started with something you can physically touch and interact with.</p>
<p><strong>Makers moving onto more advanced topics</strong>: You've written some sketches or scripts, but you're looking for your next challenge. Maybe you'd like to create a full MCU-based system from scratch – the information here will help get you on track for the programming side. You'll even get some tips on what to look for when selecting an MCU for your project.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">What this book covers</h1>
                </header>
            
            <article>
                
<p><span>This book comprises 17 chapters in all, spread across four sections. It isn't necessary to read the book straight through if you're already comfortable with some of the material. For example, if you're already comfortable with basic RTOS concepts and real-time systems, feel free to skip to </span><a href="c52d7cdb-b6cb-41e8-8d75-72494bc9d4d3.xhtml" target="_blank">Chapter 4</a>, <em>Selecting the Right MCU</em>. The following are brief descriptions of the chapters that this book is made up of:</p>
<p><a href="39404421-bf7a-4283-bf78-c396818be4b4.xhtml">Chapter 1</a>,  <em>Introducing Real-Time Systems</em>, is a <span>simple introduction to what an RTOS is and when and why to use one. Hardware and software alternatives to an MCU-based RTOS are also discussed. </span></p>
<p><a href="84f04852-827d-4e79-99d7-6c954ba3e93c.xhtml">Chapter 2</a>, <em>Understanding RTOS Tasks</em>, provides a<span> comparison of super loops with RTOS tasks, including various ways parallel operations can be achieved using both.</span></p>
<p><a href="a410ddd6-10eb-4e97-965e-e390f4dc2890.xhtml">Chapter 3</a>,  <em>Task Signaling and Communication Mechanisms</em>, is a short introduction to more RTOS concepts with lots of diagrams.  This chapter, along with <a href="84f04852-827d-4e79-99d7-6c954ba3e93c.xhtml">Chapter 2</a><em>, Understanding RTOS Tasks,</em> should be useful as a reference and a quick refresher on <span>the</span><span> </span><span>concepts and terminology, should you ever need it.  </span></p>
<p><a href="c52d7cdb-b6cb-41e8-8d75-72494bc9d4d3.xhtml">Chapter 4</a>, <em>Selecting the Right MCU</em>, helps you understand what <span>considerations should be made when selecting an MCU. After gaining an appreciation of the inter-dependency between hardware and firmware, we look at why it is so important that hardware and firmware engineers both have a hand in system design.</span></p>
<p><a href="84a945dc-ff6c-4ec8-8b9c-84842db68a85.xhtml">Chapter 5</a>, <em>Selecting an IDE</em>, introduces and discusses<span> various types of <strong>Integrated Development Environments</strong> (<strong>IDEs</strong>), including reasons why you might decide to choose one over another (or none at all). Instructions on setting up STM32CubeIDE and importing the example code are covered here.</span></p>
<p><a href="699daa80-06ae-4acc-8b93-a81af2eb774b.xhtml">Chapter 6</a>, <em>Debugging Tools for Real-Time Systems</em>, covers t<span>ools for debugging embedded systems,</span><span> including the debugging tool we'll be using throughout the remainder of the book – SEGGER Ozone and SEGGER SystemView visualization software. Instructions on how to use Ozone and SystemView are covered here. Hardware-based test equipment and some other useful tools for your embedded system development workflow are also included.</span></p>
<p><a href="2fa909fe-91a6-48c1-8802-8aa767100b8f.xhtml">Chapter 7</a>, <em>The FreeRTOS Scheduler</em>, teaches you the various ways to create tasks using FreeRTOS and how to troubleshoot startup failures. You will gain an understanding of task states and the different ways performance can be optimized.</p>
<p><a href="c6d7a0c6-6f18-4e06-a372-cd1605942ecd.xhtml">Chapter 8</a>, <em>Protecting Data and Synchronizing Tasks</em>, covers task synchronization using semaphores and data protection using mutexes, as well as how to avoid race conditions and priority inversion. <span>Software timers are also covered.</span></p>
<p><a href="495bdcc0-2a86-4b22-9628-4c347e67e49e.xhtml">Chapter 9</a>, <em>Intertask Communication</em>, <span>examines different ways of passing information between tasks, with different examples of using queues for passing information by value and reference, discussing the advantages and considerations of both approaches. We'll also learn about a lightweight intertask communication mechanism, the direct task notification, including a comparison of task notifications and queues.</span></p>
<p><a href="dd741273-db9a-4e9a-a699-b4602e160b84.xhtml">Chapter 10</a>, <em>Drivers and ISRs</em>, d<span>ives deep into several detailed examples of how to implement efficient drivers with various FreeRTOS primitives including semaphores, queues, and stream buffers. We'll also look at how FreeRTOS can be used in conjunction with MCU hardware such as DMA to provide extremely CPU-efficient driver implementations. This chapter works both directly with the MCUs peripheral registers and also with STM32 HAL code. </span></p>
<p><a href="c76b2fa5-28ac-4467-bb7e-68593a27f9ce.xhtml">Chapter 11</a>, <em>Sharing Hardware Peripherals across Tasks</em>, teaches you how to create d<span>rivers that can be safely used across multiple tasks while sharing hardware resources. We'll adapt the STM-supplied USB CDC implementation to be more user-friendly and efficient, wrapping it with a mutex and queues so it is safe to use across multiple tasks.</span></p>
<p><a href="8e78a49a-1bcd-4cfe-a88f-fb86a821c9c7.xhtml">Chapter 12</a>, <em>Tips on Creating a Well-Abstracted Architecture</em>, covers c<span>ode reusability, flexibility, and hardware portability, with an eye on creating abstractions that make your job easier. Some suggestions for source code organization to help facilitate reuse are also covered. </span></p>
<p><a href="e728e173-c9b2-4bb8-91c8-ed348ccf9518.xhtml">Chapter 13</a>, <em>Creating Loose Coupling with Queues</em>, is a <span>culmination of all of the concepts covered in the book. It includes a fully fleshed-out example of a </span><span>loosely coupled architecture used to create </span><span>a properly abstracted, end-to-end application. We'll use the USB CDC virtual comm port developed earlier, as well as an LED abstraction, to create a loosely coupled, fully reusable LED sequencer using a command queue. This embedded application can be controlled from a PC with a cross-platform UI written in Python.</span></p>
<p><a href="6bd0a083-df74-4572-9889-75aa841d792c.xhtml">Chapter 14</a>, <em>Choosing an RTOS API</em>, continues o<span>ur high-level architecture discussion with a look at three different APIs available to use for accessing FreeRTOS functionality: the native FreeRTOS API, ARM's CMSIS-RTOS, and POSIX. Discussion topics include a comparison of the available features and why you might choose one of the others for different projects.</span></p>
<p><a href="0f98e454-9804-4589-9854-5c38c9d8d416.xhtml">Chapter 15</a>, <em>FreeRTOS Memory Management</em>, takes a close look at a few different options for memory management in FreeRTOS. We'll look at static versus dynamic allocation, as well as using a <strong>Memory Protection Unit</strong> (<strong>MPU</strong>).</p>
<p><a href="19872ca7-d0fe-44e7-a4fc-1bdbfda87e59.xhtml">Chapter 16</a>, <em>Multi-Processor and Multi-Core Systems</em>, teaches you how multi-processor and multi-core systems are used for a variety of reasons – learn what they are and how to get the different parts of a system to communicate. </p>
<p><a href="50d2b6c3-9a4e-45c3-9bfc-1c7f58de0b98.xhtml">Chapter 17</a>, <em>Troubleshooting Tips and Next Steps</em>, covers tips for troubleshooting systems, including tips on how to avoid stack overflows and how to troubleshoot a hung system. Some recommendations for the next steps are also covered.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">To get the most out of this book</h1>
                </header>
            
            <article>
                
<p>Every effort has been made to make working through the examples in this book as easy as possible for a very wide range of people.  To get the most out of the book (by working through the examples), you'll need the following hardware:</p>
<ul>
<li>A Windows, macOS, or Linux PC with internet access</li>
<li><span>An STM32 </span><span>Nucleo-F767ZI</span> development board</li>
<li>Two Micro-USB cables</li>
<li>Jumper wires—20 to 22 AWG (~0.65 mm) solid core wire</li>
</ul>
<p>Detailed setup instructions for the different tools used are included in the chapters.</p>
<p><strong>If you are using the digital version of this book, we advise you to type the code yourself or access the code via the GitHub repository (link available in the next section). Doing so will help you avoid any potential errors related to<span> </span><span>the copying and pasting of code</span>.</strong></p>
<p><span>Since this book targets programming low-level embedded systems, we'll be using C as the language of choice. Some knowledge of microcontrollers is assumed, as is the ability to read a datasheet. If you have a good understanding of the C language (or C++), then you should be comfortable reading this book – no previous RTOS knowledge is required. Since we'll be working with MCUs in an embedded system, there will be some occasional discussions on the hardware side as well, primarily dealing with features of MCUs and development boards. These topics will be covered in enough detail that someone with minimal hardware knowledge should be able to follow without too much difficulty. You should be comfortable interacting with and handling development hardware, although there isn't any actual assembly required.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Download the example code files</h1>
                </header>
            
            <article>
                
<p>You can download the example code files for this book from your account at<span> <a href="https://github.com/PacktPublishing/Hands-On-RTOS-with-Microcontrollers">https://github.com/PacktPublishing/Hands-On-RTOS-with-Microcontrollers</a></span>. If you purchased this book elsewhere, you can visit<span> </span><a href="https://www.packtpub.com/support" target="_blank">www.packtpub.com/support</a><span> </span>and register to have the files emailed directly to you.</p>
<p>You can download the code files by following these steps:</p>
<ol>
<li>Log in or register at<span> </span><a href="http://www.packt.com" target="_blank">www.packt.com</a>.</li>
<li>Select the<span> </span><span class="packt_screen">Support</span><span> </span>tab.</li>
<li>Click on<span> </span><span class="packt_screen">Code Downloads</span>.</li>
<li>Enter the name of the book in the<span> </span><span class="packt_screen">Search</span><span> </span>box and follow the onscreen instructions.</li>
</ol>
<p>Once the file is downloaded, please make sure that you unzip or extract the folder using the latest version of:</p>
<ul>
<li>WinRAR/7-Zip for Windows</li>
<li>Zipeg/iZip/UnRarX for Mac</li>
<li>7-Zip/PeaZip for Linux</li>
</ul>
<p><span>The code bundle for the book is also hosted on GitHub at</span><span> <a href="https://github.com/PacktPublishing/Hands-On-RTOS-with-Microcontrollers" target="_blank">https://github.com/PacktPublishing/Hands-On-RTOS-with-Microcontrollers</a></span><span>. </span><span>In case there's an update to the code, it will be updated on the existing GitHub repository.</span></p>
<p><span>We also have other code bundles from our rich catalog of books and videos available at</span><span> </span><strong><span class="Object"><a href="https://github.com/PacktPublishing/" target="_blank">https://github.com/PacktPublishing/</a></span></strong><span>. Check them out!</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Download the color images</h1>
                </header>
            
            <article>
                
<p>We also provide a PDF file that has color images of the screenshots/diagrams used in this book. You can download it here:<span> </span><a href="http://www.packtpub.com/sites/default/files/downloads/9781838826734_ColorImages.pdf" target="_blank">http://www.packtpub.com/sites/default/files/downloads/9781838826734_ColorImages.pdf</a>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Conventions used</h1>
                </header>
            
            <article>
                
<p>There are a number of text conventions used throughout this book.</p>
<p><kbd>CodeInText</kbd>:<span> </span><span>Indicates c</span>ode words in text, database table names, folder names, filenames, file extensions, pathnames, dummy URLs, user input, and Twitter handles.<span> </span><span>Here is an example:</span><span> "<kbd>func1()</kbd> is responsible for reading the value of a sensor and storing it in<br/>
the <kbd>sensorReadings</kbd> array"</span></p>
<p>A block of code is set as follows:</p>
<pre>void func1( int16_t calOffset)<br/>{<br/>int16_t tempValue;<br/>tempValue = readSensor();<br/>tempValue = tempValue + calOffset;<br/>sensorReadings[0] = tempValue;<br/>}</pre>
<p>When we wish to draw your attention to a particular part of a code block, the relevant lines or items are set in bold:</p>
<pre>/* ADC Config */<br/>hnucleo_Adc.Instance = NUCLEO_ADCx;<br/>/* (ClockPrescaler must not exceed 36MHz) */<br/>hnucleo_Adc.Init.ClockPrescaler = ADC_CLOCKPRESCALER_PCLK_DIV4;<br/>hnucleo_Adc.Init.Resolution = ADC_RESOLUTION12b;<br/>hnucleo_Adc.Init.DataAlign = ADC_DATAALIGN_RIGHT;<br/><strong>hnucleo_Adc.Init.ContinuousConvMode = DISABLE;</strong><br/>hnucleo_Adc.Init.DiscontinuousConvMode = DISABLE;</pre>
<p><strong>Bold</strong>: Indicates a new term, an important word, or w<span>ords that you see onscreen. For example, words in menus or dialog boxes appear in the text like this. Here is an example: "Select <span class="packt_screen">System info</span> from the <span class="packt_screen">Administration</span> panel.</span><span>"</span></p>
<div class="packt_infobox">Warnings or important notes appear like this.</div>
<div class="packt_tip">Tips and tricks appear like this.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Get in touch</h1>
                </header>
            
            <article>
                
<p>Feedback from our readers is always welcome.</p>
<p class="mce-root"><strong>General feedback</strong>: If you have questions about any aspect of this book,<span> </span><span>mention the book title in the subject of your message and</span> email us at<span> </span><kbd><span>customercare@packtpub.com</span></kbd>.</p>
<p><strong>Errata</strong>: Although we have taken every care to ensure the accuracy of our content, mistakes do happen. If you have found a mistake in this book, we would be grateful if you would report this to us. Please visit<span> </span><a href="https://www.packtpub.com/support/errata" target="_blank">www.packtpub.com/support/errata</a>, selecting your book, clicking on the Errata Submission Form link, and entering the details.</p>
<p><strong>Piracy</strong>: If you come across any illegal copies of our works in any form on the Internet, we would be grateful if you would provide us with the location address or website name. Please contact us at<span> </span><kbd>copyright@packt.com</kbd><span> </span>with a link to the material.</p>
<p class="mce-root"><strong>If you are interested in becoming an author</strong>: If there is a topic that you have expertise in and you are interested in either writing or contributing to a book, please visit<span> </span><a href="http://authors.packtpub.com/" target="_blank">authors.packtpub.com</a>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Reviews</h1>
                </header>
            
            <article>
                
<p>Please leave a review. Once you have read and used this book, why not leave a review on the site that you purchased it from? Potential readers can then see and use your unbiased opinion to make purchase decisions, we at Packt can understand what you think about our products, and our authors can see your feedback on their book. Thank you!</p>
<p>For more information about Packt, please visit <a href="http://www.packt.com/" target="_blank">packt.com</a>.</p>


            </article>

            
        </section>
    </body></html>