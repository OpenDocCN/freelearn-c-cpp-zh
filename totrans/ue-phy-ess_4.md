# 第四章 约束

# 约束是什么？

约束是 Unreal Engine 4 中的基本物理演员。想象一下，物理规则需要某种东西来展示，比如工具、开关、计算器或容器。它被称为**物理演员**，负责在两个对象之间模拟物理行为的物理演员被称为物理约束演员。

它的工作方式类似于小型计算机。您可以将两个输入连接到它，并计算这两个输入应该如何根据游戏中的物理规则进行交互。最后，它在游戏过程中实时处理时将更改应用到对象上。

# 第一次物理约束演员体验

在我们开始在 Unreal 编辑器中工作之前，我们需要有一个可以工作的项目。执行以下步骤：

1.  首先，通过点击 Unreal Engine 启动器中的**启动**按钮来打开 Unreal 编辑器。

1.  通过从**项目**浏览器中选择**新建项目**选项卡来启动一个新项目。选择**第一人称**并确保**包含启动内容**被选中，并为项目命名（`constraints_test`）。

1.  完成后，在视图中定位两个立方体。选择一个，然后点击视图中右上角的小图标：![第一次物理约束演员体验](img/image00277.jpeg)

1.  现在，您的屏幕上有四个视口。当您使用约束时，从四个视角检查您的舞台是一个好习惯。现在，选择一个立方体，在顶部视图中中间点击，然后按**F**键。这将自动导航所有视口，使它们都聚焦于您的实际选择。![第一次物理约束演员体验](img/image00278.jpeg)

1.  现在，我们需要将一个立方体移动到另一个立方体上。同时，旋转上面的立方体，使其与后面的立方体角度相同。使用移动和旋转工具创建您的舞台，如下面的截图所示。如您所见，上面的立方体大约是下面立方体的三倍远：![第一次物理约束演员体验](img/image00279.jpeg)

1.  让我们点击**透视**视图右上角的位置来展开它，并按**播放**。您会看到一个立方体直接落在下面的立方体上。这是由于重力造成的。您还可以通过向它们射击球来移动立方体。我们需要禁用上层立方体的这个物理规则。现在，点击**停止**退出播放模式。选择上层立方体，在编辑器右侧的**细节**中取消选中**模拟物理**。然后，再次点击**播放**。![第一次物理约束演员体验](img/image00280.jpeg)

1.  现在，上方的立方体不仅会下落，而且当你射击它时，它不会移动。这为将另一个立方体悬挂到这个立方体上提供了一个理想的位置。为此目的，Unreal Engine 定义了一些工具（称为**PhysX 约束**）。这些工具允许您根据物理行为和游戏世界的模式模拟现实。然后，切换回四视图，在**模式**中点击**所有类**，并在**所有类**附近找到**PhysicsConstraintActor**：![第一次物理约束演员体验](img/image00281.jpeg)

1.  将此演员拖放到立方体中间。从右侧列表中找到**约束**部分。每个物理约束演员需要两个对象来操作。这意味着我们需要给演员对象命名，然后这个演员在游戏过程中在游戏世界中呈现基于物理的动作。我们如何做到这一点？您将在**约束**部分找到两个类似的演员：**约束演员 1**和**约束演员 2**。在这里，我们可以定义对象。只需点击选择器图标，然后点击上方的立方体作为**约束演员 1**，再点击另一个立方体作为**约束演员 2**，如图所示：![第一次物理约束演员体验](img/image00282.jpeg)

1.  现在，切换到**透视**视图，将下方的立方体稍微向上移动，点击**播放**，并从不同的角度和位置射击下方的立方体，如图所示：![第一次物理约束演员体验](img/image00283.jpeg)

1.  如您所见，看起来好像有什么东西在抓着下方的立方体，并强迫它保持在那个位置并围绕那个点旋转。此外，立方体在重力作用下表现出正常的行为。![第一次物理约束演员体验](img/image00284.jpeg)

您在这里观察到的就是 Unreal Engine 中物理约束的工作方式。您可以更改与每个对象相关的物理参数，并获得不同的结果。让我们看看一些例子：

1.  对于上方的立方体，在**细节**窗口中检查**物理**。当您开始游戏时，似乎所有立方体都相互连接，而当你移动一个时，其他立方体会对你的交互做出反应。点击**停止**并取消勾选上方面立方体的**物理**。

1.  选择下方的立方体。然后，在**物理**中，将**质量比例**从`1.0`改为`1000`。现在，开始游戏并尝试移动立方体。看起来它很重，非常重。所以，点击**停止**并将**质量比例**改回`1.0`。![第一次物理约束演员体验](img/image00285.jpeg)

1.  选择下方的立方体，取消勾选**启用重力**，并点击**播放**。尝试射击立方体并观察差异。它保留了与其他对象的连接，但不会跟随游戏世界中的重力。![第一次物理约束演员体验](img/image00286.jpeg)

1.  然后，点击**停止**并检查**启用重力**。

# 自定义物理约束演员

现在我们知道这个演员通过支持每个物体的重力和物理特性将两个物体连接在一起。我们还知道它对玩家来说是不可见的。此外，**物理约束演员**有一些属性，这些属性强烈地塑造了物体的物理行为。让我们从位置开始。切换回四个视图，并将你的**物理约束演员**移动到上方的立方体附近，如图所示：

![自定义物理约束演员](img/image00287.jpeg)

现在，按**播放**并射击立方体。正如你所见，它甚至越过了上方的立方体。这似乎是旋转点变高的原因。这是正确的。确切的描述是，你将你的物理约束演员移动到顶部。这基本上改变了这两个物体根据物理规则的行为方式。

现在，点击**停止**。然后，点击你的物理约束演员并按*F*。在**角度限制**中，在右侧的**详细信息**部分，将**角度摆动 1 运动**设置为**锁定**，**角度扭曲运动**设置为**限制**，并将**扭曲限制角度**和**角度摆动 2 运动**设置为**60**：

![自定义物理约束演员](img/image00288.jpeg)

现在，点击**播放**。正如你所见，立方体在 60 度到其他地方之间像金字塔一样玩耍。然后，点击**停止**并将**角度摆动 1 运动**更改为**自由**。最后，点击**播放**。正如你所见，立方体在其*z*轴上有自由旋转。

# 使用蓝图的一个简单游戏

在你点击**停止**后，选择立方体和你的演员。然后，按住*Alt*并在*Y*轴上移动以创建所有物体的副本。现在，点击第二个演员并选择上下立方体。然后，从左侧的**模式**|**基本**中选择一个点光源对象并将其放置在两个立方体之间的舞台表面附近。我们的目标是当立方体发生碰撞并打破一个立方体的物理约束时打开灯光。

![使用蓝图的一个简单游戏](img/image00289.jpeg)

现在，点击点光源并导航到**渲染**在**详细信息**部分，取消勾选**可见**：

![使用蓝图的一个简单游戏](img/image00290.jpeg)

现在，点击**蓝图**并选择**打开级别蓝图**。导航回编辑器并选择你的点光源。现在，回到**蓝图**编辑器，右键单击它，并从列表中选择**创建对 PointLight 的引用**。你将在蓝图阶段看到一个带有**PointLight**标题的曲线框。现在，找到点光源框右上角的小蓝色空心圆。然后，点击并按住鼠标，将指针向右移动。你会找到一个像电线一样的线随着鼠标移动。当你离开鼠标时，会出现一个带有搜索区域的列表。输入切换并从列表中的名称中选择**切换可见性（PointLightComponent）**，如图所示：

![使用蓝图的一个简单游戏](img/image00291.jpeg)

现在，返回到编辑器并选择一个下方的立方体。然后，回到**蓝图**并使用相同的方法打开列表，但这次，为你的立方体名称打开**添加事件**。然后，打开**碰撞**并选择**添加演员击中事件**。现在，将一根线连接到之前制作的盒子，如下面的截图所示：

![使用蓝图的一个简单游戏](img/image00292.jpeg)

这意味着你首先定义了你的**点光源**的引用，然后添加了**切换**功能到灯光的可见性。然而，你需要通过为你的立方体选择**击中事件**来打开灯光。因此，我们可以为碰撞添加**事件**并设置事件以执行切换函数。点击**播放**并检查它的工作情况。正如你所看到的，**点光源**在每次击中选定的立方体时都会打开和关闭。

现在，我们需要为我们的游戏定义另一条规则。我们需要在击中事件上禁用物理演员。然后，选择你的演员覆盖在另一个立方体上。就像为灯创建引用一样，为它创建一个引用。然后，在搜索区域使用 break 关键字创建**断开约束**函数。现在，选择响应演员的立方体，然后创建另一个击中事件并将其连接到这个函数。结果应该看起来像这样：

![使用蓝图的一个简单游戏](img/image00293.jpeg)

现在，测试一下游戏。由于热效应，一个立方体可以打开/关闭灯光，而另一个则掉落在游戏舞台上。

# 摘要

游戏设计师和艺术家尝试将游戏中的物体模式和呈现方式投影出来，这符合逐帧动画，或者巧妙地利用虚幻引擎的物理特性。

二十年前，游戏设计师使用逐帧方法将简单门的开关动作动画化，作为图像序列文件（如 GIF）。现在，我们可以通过实时灯光效果、材质、物理规则和蓝图代码来实现同样的效果。虚幻引擎 4 为游戏世界中物体的运动和依赖关系提供了详细的属性和自定义选项。这就是创意如何与游戏设计中的艺术细节相遇。与约束一起工作是一种创意艺术。
