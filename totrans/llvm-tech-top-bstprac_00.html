<html><head></head><body>
		<div><h1 id="_idParaDest-5"><a id="_idTextAnchor004"/>Preface</h1>
			<p>A compiler is one of the most prevailing tools used by programmers. The majority of programmers have compilers – or some form of compilation technique – in their development flow. A modern compiler not only transforms high-level programming languages into low-level machine code, but also plays a key role in optimizing the speed, size, or even the memory footprint of the program it compiles. With these characteristics, building a production-ready compiler has always been a challenging task.</p>
			<p>LLVM is a framework for compiler optimization and code generation. It provides building blocks that significantly reduce the efforts of developers to create high-quality optimizing compilers and programming language tools. One of its most famous products is Clang – the C-family language compiler that builds thousands of pieces of widely-used software including the Google Chrome browser and iOS apps. LLVM is also used in compilers for many different programming languages, such as the famous Swift programming language. It is not an exaggeration to say that LLVM is one of the hottest topics when it comes to creating a new programming language.</p>
			<p>With hundreds of libraries and thousands of different APIs, LLVM provides a wide range of features, from key functionalities for optimizing a program to more general utilities. In this book, we provide a complete and thorough developer guide to two of the most important sub-systems in LLVM – Clang and the middle-end. We start with introductions to several components and development best practices that can benefit your general development experiences with LLVM. Then, we will show you how to develop with Clang. More specifically, we will focus on the topics that help you augment and customize the functionalities in Clang. In the last part of this book, you will learn crucial knowledge about LLVM IR development. This includes how to write an LLVM Pass with the latest syntax and mastering processing different IR constructions. We also show you several utilities that can greatly improve your productivity in LLVM development. Last but not least, we don't assume any particular LLVM version in this book – we try to keep up to date and include the latest features from the LLVM source tree.</p>
			<p>This book provides a handful of code snippets and sample projects in every chapter. You are encouraged to download them from the GitHub repository of this book and play around with your own customizations.</p>
			<h1 id="_idParaDest-6"><a id="_idTextAnchor005"/>Who this book is for</h1>
			<p>This book is for people of all LLVM experience levels, with a basic understanding of compilers. If you are a compiler engineer who uses LLVM in your daily work, this book provides concise development guidelines and references. If you are an academic researcher, this book will help you learn useful LLVM skills and build your prototypes and projects in a short time. Programming language enthusiasts will also find this book useful when it comes to building a new programming language with the help of LLVM.</p>
			<h1 id="_idParaDest-7"><a id="_idTextAnchor006"/>What this book covers</h1>
			<p><a href="B14590_01_Final_JC_ePub.xhtml#_idTextAnchor014"><em class="italic">Chapter 1</em></a>, <em class="italic">Saving Resources When Building LLVM</em>, gives a brief introduction to the LLVM project, before showing you how to build LLVM without draining your CPU, memory resources, and disk space. This paves the road to shorter development cycles and smoother experiences for later chapters. </p>
			<p><a href="B14590_02_Final_JC_ePub.xhtml#_idTextAnchor029"><em class="italic">Chapter 2</em></a>, <em class="italic">Exploring LLVM's Build System Features</em>, shows you how to write CMake build scripts for both in-tree and out-of-tree LLVM development. You will learn crucial skills to leverage LLVM's custom build system features to write more expressive and robust build scripts.</p>
			<p><a href="B14590_03_Final_JC_ePub.xhtml#_idTextAnchor037"><em class="italic">Chapter 3</em></a>, <em class="italic">Testing with LLVM LIT</em>, shows you the way to run testing with LLVM's LIT infrastructure. The chapter not only gives you a better understanding of how testing works in LLVM's source tree but also enables you to integrate this intuitive, scalable testing infrastructure into any project.</p>
			<p><a href="B14590_04_Final_JC_ePub.xhtml#_idTextAnchor052"><em class="italic">Chapter 4</em></a>, <em class="italic">TableGen Development</em>, shows you how to write TableGen – a special <strong class="bold">Domain Specific Language (DSL)</strong> invented by LLVM. We especially focus on using TableGen as a general tool for processing structural data, giving you flexible skills to use TableGen outside LLVM.</p>
			<p><a href="B14590_05_Final_JC_ePub.xhtml#_idTextAnchor067"><em class="italic">Chapter 5</em></a>, <em class="italic">Exploring Clang's Architecture</em>, marks the start of our topics on Clang. This chapter gives you an overview of Clang, especially its compilation flow, and presents to you the role of individual components in Clang's compilation flow. </p>
			<p><a href="B14590_06_Final_JC_ePub.xhtml#_idTextAnchor078"><em class="italic">Chapter 6</em></a>, <em class="italic">Extending the Preprocessor</em>, shows you the architecture of the preprocessor in Clang and, more importantly, shows you how to develop a plugin to extend its functionalities without modifying any code in the LLVM source tree.</p>
			<p><a href="B14590_07_Final_JC_ePub.xhtml#_idTextAnchor093"><em class="italic">Chapter 7</em></a>, <em class="italic">Handling AST</em>, shows you how to develop with an <strong class="bold">Abstract Syntax Tree (AST)</strong> in Clang. The content includes learning important topics to work with an AST's in-memory representation and a tutorial to create a plugin that inserts custom AST processing logic into the compilation flow.</p>
			<p><a href="B14590_08_Final_JC_ePub.xhtml#_idTextAnchor108"><em class="italic">Chapter 8</em></a>, <em class="italic">Working with Compiler Flags and Toolchains</em>, covers the steps to add custom compiler flags and toolchains to Clang. Both skills are especially crucial if you want to support new features or new platforms in Clang. </p>
			<p><a href="B14590_09_Final_JC_ePub.xhtml#_idTextAnchor127"><em class="italic">Chapter 9</em></a>, <em class="italic">Working with PassManager and AnalysisManager</em>, marks the start of our discussion on the LLVM middle-end. This chapter focuses on writing an LLVM pass – using the latest new PassManager syntax – and how to access program analysis data via AnalysisManager. </p>
			<p><a href="B14590_10_Final_JC_ePub.xhtml#_idTextAnchor141"><em class="italic">Chapter 10</em></a>, <em class="italic">Processing LLVM IR</em>, is a big chapter containing a variety of core knowledge regarding LLVM IR, including the structure of LLVM IR's in-memory representation and useful skills to work with different IR units such as functions, instructions, and loops.</p>
			<p><a href="B14590_11_Final_JC_ePub.xhtml#_idTextAnchor158"><em class="italic">Chapter 11</em></a>, <em class="italic">Gearing Up with Support Utilities</em>, introduces some utilities that can improve your productivity – such as having better debugging experiences – when working with LLVM IR.</p>
			<p><a href="B14590_12_Final_JC_ePub.xhtml#_idTextAnchor174"><em class="italic">Chapter 12</em></a>, <em class="italic">Learning LLVM IR Instrumentation</em>, shows you how instrumentation works on LLVM IR. It covers two primary use cases: Sanitizer and <strong class="bold">Profile-Guided Optimization (PGO)</strong>. For the former, you will learn how to create a custom sanitizer. For the latter, you will learn how to leverage PGO data in your LLVM Pass.</p>
			<h1 id="_idParaDest-8"><a id="_idTextAnchor007"/>To get the most out of this book</h1>
			<p>This book is designed to bring you the latest features of LLVM, so we encourage you to use LLVM after version 12.0, or even the development branch – that is, the main branch – throughout this book. </p>
			<p>We assume that you are working on Linux or Unix systems (including macOS). Tools and sample commands in this book are mostly run in the command-line interface, but you are free to use any code editors or IDEs to write your code.</p>
			<div><div><img src="img/table_1.jpg" alt=""/>
				</div>
			</div>
			<p>In <a href="B14590_01_Final_JC_ePub.xhtml#_idTextAnchor014"><em class="italic">Chapter 1</em></a><em class="italic">, </em><em class="italic">Saving Resources on Building LLVM</em>, we will provide details on how to build LLVM from source.</p>
			<p><strong class="bold">If you are using the digital version of this book, we advise you to type the code yourself or access the code via the GitHub repository (link available in the next section). Doing so will help you avoid any potential errors related to the copying and pasting of code.</strong></p>
			<h1 id="_idParaDest-9"><a id="_idTextAnchor008"/>Download the example code files</h1>
			<p>You can download the example code files for this book from GitHub at <a href="https://github.com/PacktPublishing/LLVM-Techniques-Tips-and-Best-Practices-Clang-and-Middle-End-Libraries">https://github.com/PacktPublishing/LLVM-Techniques-Tips-and-Best-Practices-Clang-and-Middle-End-Libraries</a>. In case there's an update to the code, it will be updated on the existing GitHub repository.</p>
			<p>We also have other code bundles from our rich catalog of books and videos available at <a href="https://github.com/PacktPublishing/">https://github.com/PacktPublishing/</a>. Check them out!</p>
			<h1 id="_idParaDest-10"><a id="_idTextAnchor009"/>Download the color images</h1>
			<p>We also provide a PDF file that has color images of the screenshots/diagrams used in this book. You can download it here: <a href="https://static.packt-cdn.com/downloads/9781838824952_ColorImages.pdf">https://static.packt-cdn.com/downloads/9781838824952_ColorImages.pdf</a>.</p>
			<h1 id="_idParaDest-11"><a id="_idTextAnchor010"/>Conventions used</h1>
			<p>There are a number of text conventions used throughout this book.</p>
			<p><code>Code in text</code>: Indicates code words in text, database table names, folder names, filenames, file extensions, pathnames, dummy URLs, user input, and Twitter handles. Here is an example: "To include Clang in the build list, please edit the value assigned to the <code>LLVM_ENABLE_PROJECTS</code> CMake variable."</p>
			<p>A block of code is set as follows:</p>
			<pre>TranslationUnitDecl 0x560f3929f5a8 &lt;&lt;invalid sloc&gt;&gt; &lt;invalid sloc&gt;
|…
`-FunctionDecl 0x560f392e1350 &lt;./test.c:2:1, col:30&gt; col:5 foo 'int (int)'</pre>
			<p>When we wish to draw your attention to a particular part of a code block, the relevant lines or items are set in bold:</p>
			<pre>  |-ParmVarDecl 0x560f392e1280 &lt;col:9, col:13&gt; col:13 used c 'int'
  `-CompoundStmt 0x560f392e14c8 &lt;col:16, col:30&gt;
    `-ReturnStmt 0x560f392e14b8 &lt;col:17, col:28&gt;
      `-BinaryOperator 0x560f392e1498 &lt;col:24, col:28&gt; 'int' '+'
        |-ImplicitCastExpr 0x560f392e1480 &lt;col:24&gt; 'int' &lt;LValueToRValue&gt;
        | `-<strong class="bold">DeclRefExpr 0x560f392e1440 &lt;col:24&gt; 'int' lvalue ParmVar 0x560f392e1280 'c' 'int'</strong>
        `-IntegerLiteral 0x560f392e1460 &lt;col:28&gt; 'int' 1</pre>
			<p>Any command-line input or output is written as follows:</p>
			<pre>$ clang <strong class="bold">-fplugin=/path/to/MyPlugin.so</strong> … foo.cpp</pre>
			<p><strong class="bold">Bold</strong>: Indicates a new term, an important word, or words that you see onscreen. For example, words in menus or dialog boxes appear in the text like this. Here is an example: "Select <strong class="bold">System info</strong> from the <strong class="bold">Administration</strong> panel."</p>
			<p class="callout-heading">Tips or important notes	</p>
			<p class="callout">Appear like this.</p>
			<h1 id="_idParaDest-12"><a id="_idTextAnchor011"/>Get in touch</h1>
			<p>Feedback from our readers is always welcome.</p>
			<p><strong class="bold">General feedback</strong>: If you have questions about any aspect of this book, mention the book title in the subject of your message and email us at <a href="mailto:customercare@packtpub.com">customercare@packtpub.com</a>.</p>
			<p><strong class="bold">Errata</strong>: Although we have taken every care to ensure the accuracy of our content, mistakes do happen. If you have found a mistake in this book, we would be grateful if you would report this to us. Please visit <a href="http://www.packtpub.com/support/errata">www.packtpub.com/support/errata</a>, selecting your book, clicking on the Errata Submission Form link, and entering the details.</p>
			<p><strong class="bold">Piracy</strong>: If you come across any illegal copies of our works in any form on the Internet, we would be grateful if you would provide us with the location address or website name. Please contact us at <a href="mailto:copyright@packt.com">copyright@packt.com</a> with a link to the material.</p>
			<p><strong class="bold">If you are interested in becoming an author</strong>: If there is a topic that you have expertise in and you are interested in either writing or contributing to a book, please visit <a href="http://authors.packtpub.com">authors.packtpub.com</a>.</p>
			<h1 id="_idParaDest-13"><a id="_idTextAnchor012"/>Reviews</h1>
			<p>Please leave a review. Once you have read and used this book, why not leave a review on the site that you purchased it from? Potential readers can then see and use your unbiased opinion to make purchase decisions, we at Packt can understand what you think about our products, and our authors can see your feedback on their book. Thank you!</p>
			<p>For more information about Packt, please visit <a href="http://packt.com">packt.com</a>.</p>
		</div>
	</body></html>