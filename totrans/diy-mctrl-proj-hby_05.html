<html><head></head><body>
		<div id="_idContainer062">
			<h1 id="_idParaDest-66"><em class="italic"><a id="_idTextAnchor069"/>Chapter 5</em>: Humidity and Temperature Measurement</h1>
			<p>This chapter describes how to practically measure humidity and temperature in an environment, as well as how to connect specialized sensors to a microcontroller board. You will find out how to use the commonly used sensors DHT11 and LM35. In this chapter, you will gain valuable information regarding gaining data acquisition from a temperature and humidity sensor and a sensor module and how to display it to a user.</p>
			<p>In this chapter, we are going to cover the following main topics:</p>
			<ul>
				<li>Introducing the DHT11 humidity and temperature sensor module</li>
				<li>Connecting the DHT11 and LM35 sensors to the microcontroller boards</li>
				<li>Coding to get data from the sensor module</li>
				<li>Showing the humidity and temperature data results on the serial port monitor</li>
			</ul>
			<p>By the end of this chapter, you will have learned how to properly connect a DHT11 humidity and temperature sensor and an LM35 temperature sensor to the Curiosity Nano and Blue Pill microcontroller boards. You will have also learned how to analyze and display the data obtained from these sensors.</p>
			<h1 id="_idParaDest-67"><a id="_idTextAnchor070"/>Technical requirements</h1>
			<p>The software tools that you will be using in this chapter are the <em class="italic">MPLAB X</em> and <em class="italic">Arduino</em> IDEs, for editing and uploading your programs to the Curiosity Nano and the Blue Pill microcontroller boards, respectively.</p>
			<p>The code that will be used in this chapter can be found in this book's GitHub repository: <a href="https://github.com/PacktPublishing/DIY-Microcontroller-Projects-for-Hobbyists/tree/master/Chapter05">https://github.com/PacktPublishing/DIY-Microcontroller-Projects-for-Hobbyists/tree/master/Chapter05</a></p>
			<p>The Code in Action video for this chapter can be found here: <a href="https://bit.ly/2UiRHVP">https://bit.ly/2UiRHVP</a></p>
			<p>In this chapter, we will be using the following pieces of hardware:</p>
			<ul>
				<li>A solderless breadboard.</li>
				<li>The Blue Pill and Curiosity Nano microcontroller boards.</li>
				<li>A Micro USB cable for connecting your microcontroller boards to a computer.</li>
				<li>The ST-LINK/V2 electronic interface needed for uploading the compiled code to the Blue Pill. Bear in mind that the ST-LINK/V2 requires four female-to-female DuPont wires.</li>
				<li>Green and yellow LEDs.</li>
				<li>Two 220-ohm resistors rated at one-quarter watt. These resistors are for the LEDs.</li>
				<li>One 4.7 kilo-ohm resistor rated as one-quarter watt. It is for the DHT11 sensor.</li>
				<li>One 2.2 kilo-ohm resistor rated as one-quarter watt. It is for the <strong class="bold">Liquid Crystal Display</strong> (<strong class="bold">LCD</strong>).</li>
				<li>One DHT11 humidity and temperature sensor module.</li>
				<li>One LM35 temperature sensor. </li>
				<li>Three male-to-female DuPont wires for connecting the sensor module to the solderless breadboard.</li>
				<li>A dozen male-to-male DuPont wires.</li>
				<li>A 1602 16x2 LCD display.</li>
			</ul>
			<p>The next section provides a brief introduction to the DHT11 sensor module, its electrical characteristics, and how this module is used in electronic projects.</p>
			<h1 id="_idParaDest-68"><a id="_idTextAnchor071"/>Introducing the DHT11 humidity and temperature sensor module</h1>
			<p>In this section, we'll review the <a id="_idIndexMarker282"/>DHT11 sensor module. This section also describes what the sensor pins are, and how to connect them to a microcontroller board. The DHT11 is an easy-to-use, practical, and low-cost sensor module that measures temperature within a range of 0 to 50 degrees Celsius, with an error rate of +-2%. It also measures <a id="_idIndexMarker283"/>environmental <strong class="bold">relative humidity</strong> (<strong class="bold">RH</strong>) within a range of 20% to 90%, with an accuracy of +-5%. These values can change a bit, depending on the sensor module's manufacturers. The next section describes what RH is, an environmental value that is read by the DHT11 sensor.</p>
			<h2 id="_idParaDest-69"><a id="_idTextAnchor072"/>What is relative humidity?</h2>
			<p><strong class="bold">Relative humidity</strong> is based <a id="_idIndexMarker284"/>on a combination of water vapor and the temperature of the environment. It is a ratio of the amount of water vapor present in the air at a certain temperature, expressed as a percentage. Generally, the amount of water vapor has a higher RH in cool air than hot or warm air. A related parameter is<a id="_idIndexMarker285"/> the <strong class="bold">dew point</strong>, which is the temperature that air from a place or environment must be cooled down to for it to become saturated with water vapor.</p>
			<p>Measuring RH is important because it is related to the degree of discomfort people feel in an environment, among other applications. RH measurements can have useful applications, such as in greenhouses, where some plants need a certain degree of RH to thrive.</p>
			<h2 id="_idParaDest-70"><a id="_idTextAnchor073"/>The DHT11 pins and their values</h2>
			<p>The following is<a id="_idIndexMarker286"/> a Fritzing diagram of the DHT11 sensor module. Please note that the DHT11 module may have a fourth pin, depending on its manufacturer. The fourth pin is not connected to anything (sometimes, it is labeled <strong class="bold">not connected</strong>, or <strong class="bold">NC</strong>):</p>
			<div>
				<div id="_idContainer048" class="IMG---Figure">
					<img src="image/Figure_5.1_B16413.jpg" alt="Figure 5.1 – The DHT11 sensor module"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.1 – The DHT11 sensor module</p>
			<p>As we<a id="_idIndexMarker287"/> can see, the DHT11's <strong class="bold">v</strong> pin (it can also be labeled <strong class="bold">VCC</strong> or <strong class="bold">+</strong>, depending on the manufacturer) can be connected to a voltage supply of 3 to 5.5 V of <strong class="bold">direct current</strong> (<strong class="bold">DC</strong>). In this chapter, we will connect the DHT11 to a voltage of 3.3 volts, which can be supplied by both the Curiosity Nano and the Blue Pill boards. Pin <strong class="bold">s</strong> is the signal<a id="_idIndexMarker288"/> that provides the temperature and humidity data generated by the sensor. It can also be labeled as <strong class="bold">OUT</strong> or <strong class="bold">DATA</strong>, depending on the DHT11 manufacturer. Pin <strong class="bold">g</strong> (sometimes labeled as <strong class="bold">G</strong>, <strong class="bold">GND</strong>, or <strong class="bold">-</strong>) will be connected to the microcontroller board's ground. Most of the DHT11 modules' operating current is 0.3mA when measuring temperature and humidity, and 60 microamperes when in standby, making it a very low power sensor.</p>
			<p>The following image shows two DHT11 sensor modules made by two different manufacturers:</p>
			<div>
				<div id="_idContainer049" class="IMG---Figure">
					<img src="image/Figure_5.2_B16413.jpg" alt="Figure 5.2 – DHT11 sensor modules"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.2 – DHT11 sensor modules</p>
			<p>Please note that the DHT11 modules have slight differences. For example, both DHT11 modules have a different pin order. The one on the left has ground (labeled as GND), signal (labeled as data), and voltage (labeled as VCC) pins in that order, whereas the right one has signal (data), voltage, and ground pins in that order. Also, the pins have different labels. However, both DHT11 modules work the same and can be used in the circuits shown in this <a id="_idIndexMarker289"/>chapter. The sensor itself is encased in the plastic blue<a id="_idIndexMarker290"/> box with a grid. The DHT11 modules have extra electronic components that facilitate the connections to the sensor.</p>
			<p>In this section, you learn about the DHT11 sensor module, its pins, and the similarities and differences among DHT11 sensors made by different manufacturers. You also reviewed what relative humidity is, an important environmental value that the DHT11 can read.</p>
			<p>The next section will show you how to connect the DHT11 module to a Blue Pill's digital port so that you can read its values.</p>
			<h1 id="_idParaDest-71"><a id="_idTextAnchor074"/>Connecting a DHT11 sensor module to the microcontroller boards</h1>
			<p>This section<a id="_idIndexMarker291"/> deals with all the <a id="_idIndexMarker292"/>hardware components in this chapter. We will begin by connecting the DHT11 to the Blue Pill board. Connecting the DHT11 to microcontroller boards is easy because it only requires three wires.</p>
			<h2 id="_idParaDest-72"><a id="_idTextAnchor075"/>Connecting the DHT11 to the Blue Pill board</h2>
			<p>In this <a id="_idIndexMarker293"/>section, we will connect the<a id="_idIndexMarker294"/> DHT11 to the Blue Pill, as shown here:</p>
			<div>
				<div id="_idContainer050" class="IMG---Figure">
					<img src="image/Figure_5.3_B16413.jpg" alt="Figure 5.3 – The DHT11 connected to a Blue Pill microcontroller board"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.3 – The DHT11 connected to a Blue Pill microcontroller board</p>
			<p>As we can see, the<a id="_idIndexMarker295"/> DHT11 connections are<a id="_idIndexMarker296"/> simple. In some DHT11 modules, their manufacturers recommend connecting a 5K-ohm pull-up resistor to the <strong class="bold">S</strong> (signal) pin. However, since 5K resistors are not commercially available, a resistor with a value of 4.7K-ohm is close enough to the recommended one. We did not need to connect a 4.7K-ohm to the DHT11 module that we used in our project because its electronic circuit already had a resistor like that.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">Depending on the manufacturer, many DHT11 modules already include a pull-up resistor, so the 4.7k-ohm pull up resistor is not necessary. It is worth checking it out. Just connect the DHT11 to the microcontroller board. If it gives erratic temperature measurements, or not getting measurements at all, you may need to connect the pull-up resistor to it.</p>
			<p>Follow these<a id="_idIndexMarker297"/> steps to connect the <a id="_idIndexMarker298"/>DHT11 to the Blue Pill:</p>
			<ol>
				<li>Connect the Blue Pill's <strong class="bold">GND</strong> (also labeled as <strong class="bold">G</strong>) pin to the solderless breadboard rail.</li>
				<li>Connect the Blue Pill's <strong class="bold">3.3</strong> pin labeled (providing 3.3 volts) to the upper breadboard rail. Please note that in some Blue Pill boards, this pin is labeled as <strong class="bold">3V3</strong>.</li>
				<li>Connect the DHT11's <strong class="bold">s</strong> pin to the Blue Pill's <strong class="bold">B12</strong> pin.</li>
				<li>Connect the DHT11's <strong class="bold">v</strong> pin to the upper breadboard rail that was connected to the <strong class="bold">3V3</strong> pin.</li>
				<li>Connect the HDT11's <strong class="bold">g</strong> pin to the ground pin (the lower breadboard rail).</li>
				<li>Connect the USB cable to the Blue Pill and then to your computer.</li>
			</ol>
			<p>The following image shows how everything should be connected:</p>
			<div>
				<div id="_idContainer051" class="IMG---Figure">
					<img src="image/Figure_5.4_B16413.jpg" alt="Figure 5.4 – The DHT11 connected to the Blue Pill"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.4 – The DHT11 connected to the Blue Pill</p>
			<p>Here, we can see that we need just a few DuPont wires to connect the DHT11 to the Blue Pill board. You will need to connect the ST-LINK/V2 interface to your computer to upload its code, as explained in <a href="B16413_01_Final_NM_ePub.xhtml#_idTextAnchor014"><em class="italic">Chapter 1</em></a>, <em class="italic">Introduction to Microcontrollers and Microcontroller Boards</em>. Don't forget to disconnect the USB cable first (shown on the left of the preceding image) before uploading a program to the Blue Pill. Please note that the order of the pins shown in the preceding image is <strong class="bold">GND</strong>, <strong class="bold">DATA</strong>, and <strong class="bold">VCC</strong>, which is different from the DHT11's pin order shown in <em class="italic">Figure 5.3</em>. Again, this is because some DHT11 manufacturers change the DHT11's pin order.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">All the Blue Pill's <strong class="bold">ground</strong> (<strong class="bold">GND</strong>) pins<a id="_idIndexMarker299"/> are the same; they are internally connected. This microcontroller board has more than one GND pin so that we can connect the electronic components to the board.</p>
			<p>The<a id="_idIndexMarker300"/> temperature and humidity <a id="_idIndexMarker301"/>values will be shown on the computer's serial port monitor from the IDE. This will be explained in the <em class="italic">Programming the DHT11 sensor for the Blue Pill board</em> section.</p>
			<p>The following image shows a Fritzing diagram with the DHT11 and a 4.7k-ohm pull-up resistor connected to the signal (<strong class="bold">S</strong>) pin. The DHT11 module used in this example does not have a built-in pull up resistor, so we need to connect one:</p>
			<div>
				<div id="_idContainer052" class="IMG---Figure">
					<img src="image/Figure_5.5_B16413.jpg" alt="Figure 5.5 – A DHT11 with a pull-up resistor"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.5 – A DHT11 with a pull-up resistor</p>
			<p>The preceding image shows the 4.7 k-ohm resistor working as a pull-up resistor. The next section describes how to connect an LCD to show the temperature and humidity data obtained from the DHT11.</p>
			<h2 id="_idParaDest-73"><a id="_idTextAnchor076"/>Connecting an LCD to the Blue Pill</h2>
			<p>This section shows an <a id="_idIndexMarker302"/>interesting and useful way of showing temperature and <a id="_idIndexMarker303"/>humidity data obtained from the DHT11 sensor, displaying it on a low-cost 1602 LCD. The following is a Fritzing diagram showing all the connections:</p>
			<div>
				<div id="_idContainer053" class="IMG---Figure">
					<img src="image/Figure_5.6_B16413.jpg" alt="Figure 5.6 – A 1602 LCD connected to the Blue Pill board"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.6 – A 1602 LCD connected to the Blue Pill board</p>
			<p>The preceding image depicts the 1602 LCD, which can display 16 alphanumeric and special characters (for example, %, $, and so on) in two rows (16x2). Each character is formed with a 5x8 dot matrix. The LCD has 16 pins, labeled from left to right as <strong class="bold">VSS</strong>, <strong class="bold">VDD</strong>, <strong class="bold">V0</strong>, <strong class="bold">RS</strong>, <strong class="bold">RW</strong>, <strong class="bold">E</strong>, <strong class="bold">D0</strong>, <strong class="bold">D1</strong>, <strong class="bold">D2</strong>, <strong class="bold">D3</strong>, <strong class="bold">D4</strong>, <strong class="bold">D5</strong>, <strong class="bold">D6</strong>,<strong class="bold"> D7</strong>, <strong class="bold">A</strong>, and <strong class="bold">K</strong>. This is a popular LCD that can also be used with Arduino microcontroller boards. The 2.2k-ohm resistor, which is connected to the <strong class="bold">V0</strong> LCD pin, adjusts the LCD's contrast. Pins <strong class="bold">VSS</strong> and <strong class="bold">VDD</strong> are connected to a power supply. Pins <strong class="bold">D0</strong> to <strong class="bold">D7</strong> are used to send data to the LCD to form characters, but here, we're only using 4 bits (pins <strong class="bold">D4</strong> to <strong class="bold">D7</strong>) to display the letters and numbers on the LCD. The 1602 LCD is connected to a <strong class="bold">5-volt</strong> (<strong class="bold">+5V</strong>) power supply, which is supplied by the Blue Pill's 5V pin.</p>
			<p>Bear in mind that the upper and lower breadboard voltage rails shown in the preceding image are connected to Blue Pill's 5V pin, providing 5 volts to the LCD. The DHT11 is connected to the Blue Pill's 3.3 pin because this sensor works with 3.3 volts. Its resulting data will be sent to the Blue Pill's input data pin, <strong class="bold">B12</strong>, using a digital voltage level with 3.3 volts.</p>
			<p>Follow these steps to<a id="_idIndexMarker304"/> connect the DHT11 and the LCD to the Blue Pill while<a id="_idIndexMarker305"/> following the preceding image:</p>
			<ol>
				<li value="1">Connect the Blue Pill's <strong class="bold">GND</strong> (also labeled as <strong class="bold">G</strong>) pins to the solderless breadboard rails. </li>
				<li>Connect the Blue Pill's <strong class="bold">5V</strong> pin (providing 5 volts) to the breadboard rails.</li>
				<li>Connect the DHT11's <strong class="bold">s</strong> pin to the Blue Pill's <strong class="bold">B12</strong> pin.</li>
				<li>Connect the DHT11's <strong class="bold">v</strong> pin to the Blue Pill's <strong class="bold">3V3</strong> pin.</li>
				<li>Connect the HDT11's <strong class="bold">g</strong> pin to the ground pin (the upper breadboard rail).</li>
				<li>Connect the USB cable to the Blue Pill and then to your computer or a USB power bank.</li>
				<li>Insert the LCD's 16 pins into the solderless breadboard.</li>
				<li>Connect the LCD's <strong class="bold">VSS</strong> pin to the ground pin (the lower breadboard rail).</li>
				<li>Connect the LCD's <strong class="bold">VDD</strong> pin to 5 volts (the lower breadboard rail).</li>
				<li>Connect the 2.2K-ohm resistor to the LCD's <strong class="bold">V0</strong> pin and to the ground pin (the upper breadboard rail).</li>
				<li>Connect the LCD's <strong class="bold">RS</strong> pin to the Blue Pill's <strong class="bold">B11</strong> pin.</li>
				<li>Connect the LCD's <strong class="bold">RW</strong> pin to the ground pin (lower breadboard rail).</li>
				<li>Connect the LCD's <strong class="bold">E</strong> pin to the Blue Pill's <strong class="bold">B10</strong> pin.</li>
				<li>Connect the LCD's <strong class="bold">D4</strong> pin to the Blue Pill's <strong class="bold">B0</strong> pin.</li>
				<li>Connect the LCD's <strong class="bold">D5</strong> pin to the Blue Pill's <strong class="bold">A7</strong> pin.</li>
				<li>Connect the LCD's <strong class="bold">D6</strong> pin to the Blue Pill's <strong class="bold">A6</strong> pin.</li>
				<li>Connect the LCD's <strong class="bold">D7</strong> pin to the Blue Pill's <strong class="bold">A5</strong> pin.</li>
				<li>Connect the LCD's <strong class="bold">A</strong> pin to 5 volts (upper breadboard rail).</li>
				<li>Connect the LCD's <strong class="bold">K</strong> pin to the ground pin (upper breadboard rail).</li>
				<li>The LCD's <strong class="bold">D0</strong>, <strong class="bold">D1</strong>, <strong class="bold">D2</strong>, and <strong class="bold">D3</strong> pins are not connected.</li>
			</ol>
			<p>The following image<a id="_idIndexMarker306"/> shows how <a id="_idIndexMarker307"/>everything is connected:</p>
			<div>
				<div id="_idContainer054" class="IMG---Figure">
					<img src="image/Figure_5.7_B16413.jpg" alt="Figure 5.7 – The 1602 LCD connected to the Blue Pill microcontroller board"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.7 – The 1602 LCD connected to the Blue Pill microcontroller board</p>
			<p>Here, you can see the LCD working because the Blue Pill is connected to a USB power bank (not shown in the preceding image). The LCD is displaying the local temperature in degrees Celsius, and the humidity is shown as a percentage. The code for programming the LCD and the DHT11 will be shown later in this chapter.</p>
			<p>The next section will show you how to connect an LM35 temperature sensor to the Curiosity Nano board, demonstrating how to read temperature values from that sensor and sending them to an analog input port from the Curiosity Nano.</p>
			<h2 id="_idParaDest-74"><a id="_idTextAnchor077"/>Connecting an LM35 temperature sensor to the Curiosity Nano board</h2>
			<p>In this <a id="_idIndexMarker308"/>section, we'll describe <a id="_idIndexMarker309"/>how to measure temperature values on a Curiosity Nano, obtained from an LM35 sensor. For demonstration purposes, the temperature will be analyzed when it falls within a thermal comfort zone of 23 to 26 degrees Celsius. The LM35 is a low-cost and easy-to-connect sensor that measures a wide temperature range, from -55 to 150 degrees Celsius. The following is a diagram of the LM35 sensor pinout:</p>
			<div>
				<div id="_idContainer055" class="IMG---Figure">
					<img src="image/Figure_5.8_B16413.jpg" alt="Figure 5.8 – The LM35 sensor showing pins 1, 2, and 3"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.8 – The LM35 sensor showing pins 1, 2, and 3</p>
			<p>As you can see, the LM35 has three pins: pin 1 (<strong class="bold">Vs</strong>), pin 2 (<strong class="bold">Vout</strong>), and pin 3 (<strong class="bold">GND</strong>). Pin 1 is the voltage coming from a power supply. The Curiosity Nano's <strong class="bold">VBUS</strong> pin provides 5 volts, so the LM35's pin 1 can be connected to it. Pin 2 is voltage out (<strong class="bold">Vout</strong>), providing the measured temperature value in terms of <strong class="bold">millivolts</strong> (<strong class="bold">mV</strong>) using a linear scale factor. This scale increases+10 mV for each degree Celsius (+10 mV/C). Pin 3 is connected to the microcontroller board's ground (<strong class="bold">GND</strong>).</p>
			<p>The LM35 sensor signal pin (pin 2) provides the temperature values in mV, which will be converted into digital values by the Curiosity Nano. To do this, we need to connect the LM35's pin 2 to an input analog port from the Curiosity Nano. The temperature value is calculated as <em class="italic">temperature=(5.0/1023)*millivolts_from_LM35</em>, where 5.0 is the 5 volts connected to the LM35's pin 1 and 1023 is the 10-bit ADC from the Curiosity Nano, which means that its ADC can detect (2^10) discrete analog levels. The formula converts the LM35's output, in mV, into an equivalent value in degrees Celsius. The following image shows the LM35 sensor:</p>
			<div>
				<div id="_idContainer056" class="IMG---Figure">
					<img src="image/Figure_5.9_B16413.jpg" alt="Figure 5.9 – The LM35 temperature sensor"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.9 – The LM35 temperature sensor</p>
			<p>The preceding<a id="_idIndexMarker310"/> image shows the <a id="_idIndexMarker311"/>LM35 temperature sensor with its three pins. It is the same size as a regular transistor since both have a TO-92 semiconductor package type. However, the LM35 is not a transistor – it's a temperature sensor.</p>
			<p>We must connect two LEDs to its output ports to show the temperature and humidity ranges, as shown here:</p>
			<div>
				<div id="_idContainer057" class="IMG---Figure">
					<img src="image/Figure_5.10_B16413.jpg" alt="Figure 5.10 – Connecting the LM35 sensor and the LEDs to the Curiosity Nano board"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.10 – Connecting the LM35 sensor and the LEDs to the Curiosity Nano board</p>
			<p>As you can see, we must connect a green LED to show that the environment temperature being read by the LM35 sensor is within the thermal comfort zone for an office with a range of 23 to 26 degrees Celsius; and a yellow LED will be turned on if the temperature is outside that range. The temperature values from the thermal comfort zone used in this chapter are determined by the Canadian Standards Association, which are similar to the values defined by other agencies from other countries. The thermal comfort zone values can be found here: <a href="https://www.ccohs.ca/oshanswers/phys_agents/thermal_comfort.html">https://www.ccohs.ca/oshanswers/phys_agents/thermal_comfort.html</a>.</p>
			<p>Follow these steps to <a id="_idIndexMarker312"/>connect the <a id="_idIndexMarker313"/>LM35 and the LEDs to the Curiosity Nano board:</p>
			<ol>
				<li value="1">Connect the Curiosity Nano's <strong class="bold">GND</strong> pin to the lower rail of the solderless breadboard rail.</li>
				<li>Connect the LM35's <strong class="bold">Vout</strong> (signal) pin (2) to the Curiosity Nano's <strong class="bold">RA0</strong> pin. It will be used as an analog input port.</li>
				<li>Connect the LM35's <strong class="bold">Vs</strong> pin (1) to the Curiosity Nano's <strong class="bold">VBUS</strong> pin. This pin provides 5 volts.</li>
				<li>Connect the LM35's <strong class="bold">g</strong> pin (3) to the Curiosity Nano's <strong class="bold">GND</strong> pin from its upper pin row.</li>
				<li>Now, connect the two 220-ohm resistors to the Curiosity Nano's <strong class="bold">RD2</strong> and <strong class="bold">RD3</strong> ports and to the anodes of the two LEDs, respectively.</li>
				<li>Connect the LEDs' cathodes to the ground pin.</li>
				<li>Finally, connect the USB cable to the Curiosity Nano and then to your computer or a USB power bank.</li>
			</ol>
			<p>The following image shows how everything should be connected:</p>
			<div>
				<div id="_idContainer058" class="IMG---Figure">
					<img src="image/Figure_5.11_B16413.jpg" alt="Figure 5.11 – The LM35 sensor connected to the Curiosity Nano board"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.11 – The LM35 sensor connected to the Curiosity Nano board</p>
			<p>The preceding image <a id="_idIndexMarker314"/>shows the LM35<a id="_idIndexMarker315"/> connected to the Curiosity Nano's RA0 at the upper pins row.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">All the Curiosity Nano's GND pins are the same; they are internally connected. This microcontroller board has more than one GND pin so that we can connect electronic components to the board.</p>
			<p>In this section, you learned about the LM35 temperature sensor, its pins, and how to connect it to a microcontroller board. You also learned how to show the temperature information with LEDs. The next section will show you how to write programs for reading humidity and temperature values from the DHT11 sensor.</p>
			<h1 id="_idParaDest-75"><a id="_idTextAnchor078"/>Coding to get data from the sensor module</h1>
			<p>This section <a id="_idIndexMarker316"/>describes how to code a program for both the Blue Pill and the Curiosity Nano boards so that they can read values from the DHT11. You will also learn how to program the LM35 temperature sensor with the Blue Pill. Let's start by programming the DHT11 sensor for the Blue Pill board.</p>
			<h2 id="_idParaDest-76"><a id="_idTextAnchor079"/>Programming the DHT11 sensor for the Blue Pill board</h2>
			<p>In this section, you will review the<a id="_idIndexMarker317"/> code that gets data from<a id="_idIndexMarker318"/> the DHT11 sensor using a special library. The code will also show you how to display the temperature and humidity data on the serial port, and thus on the Arduino IDE's serial monitor. The following code reads both the temperature and humidity from a DHT11 sensor module, which is connected to digital input port <strong class="source-inline">B12</strong> of the Blue Pill:</p>
			<p class="source-code">#include &lt;DHT.h&gt; </p>
			<p class="source-code">#define DHT11_data_pin PB12 </p>
			<p class="source-code">DHT dht(DHT11_data_pin, DHT11); </p>
			<p class="source-code">void setup() {</p>
			<p class="source-code">    Serial.begin(9600); </p>
			<p class="source-code">    while (!Serial);</p>
			<p class="source-code">    Serial.println("Opening serial comm.");</p>
			<p class="source-code">  </p>
			<p class="source-code">    dht.begin();</p>
			<p class="source-code">}</p>
			<p class="source-code">void loop() {</p>
			<p class="source-code">    float humidity = dht.readHumidity(); </p>
			<p class="source-code">    float temperature=dht.readTemperature(); </p>
			<p class="source-code">    Serial.println("Humidity: "+String(humidity)); </p>
			<p class="source-code">    Serial.println("Temperature: "+String(temperature)); </p>
			<p class="source-code">    delay(1000); </p>
			<p class="source-code">}</p>
			<p>In the preceding code, you can see that the first line includes a library called <strong class="source-inline">DHT.h</strong>. This is a very practical library for reading values from the DHT11. This code can be found in this book's GitHub repository, which contains useful comments explaining its main parts. To install the <strong class="source-inline">DHT.h</strong> library on the Arduino IDE, follow these steps:</p>
			<ol>
				<li value="1">Click on <strong class="bold">Tools</strong> | <strong class="bold">Manage Libraries</strong> from the IDE's main menu.</li>
				<li>Type <strong class="source-inline">DHT11</strong> in the Library Manager's search field.</li>
				<li>Several libraries will be listed. Select and install the highest version of the DHT sensor library, made by Adafruit.</li>
				<li>Wait until the library has been installed. Then, close the Library Manager. Now, the DHT11 library should be ready to use in your code.</li>
			</ol>
			<p>Please note <a id="_idIndexMarker319"/>that the <strong class="source-inline">dht.readTemperature()</strong> function<a id="_idIndexMarker320"/> returns temperature values in degrees Celsius, while the <strong class="source-inline">dht.readHumidity()</strong> function returns values as a percentage of RH.</p>
			<p>The following screenshot shows the Arduino IDE's <strong class="bold">Library Manager</strong> showing the library called <strong class="bold">DHT sensor library</strong> <strong class="bold">by Adafruit</strong>:</p>
			<div>
				<div id="_idContainer059" class="IMG---Figure">
					<img src="image/Figure_5.12_B16413.jpg" alt="Figure 5.12 – The Arduino IDE's Library Manager"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.12 – The Arduino IDE's Library Manager</p>
			<p>Here, you can see that by typing <strong class="source-inline">DHT11</strong> in the search field, you can find the DHT sensor library by Adafruit. Click on the <strong class="bold">Install</strong> button.</p>
			<p class="callout-heading">Tip</p>
			<p class="callout">You can also connect a DHT11 sensor to an Arduino Uno microcontroller board. Just connect the DHT11's <strong class="bold">s</strong> (signal) pin to any digital port from 2 to 13 from the Arduino Uno and change the pin number in the constant <strong class="source-inline">DHT11_data_pin</strong> shown in the preceding code. In addition, connect the DHT11's GND and VCC pins to the Arduino Uno's GND and 3V3 pins, respectively.</p>
			<p>The next section <a id="_idIndexMarker321"/>will show you how to display the humidity <a id="_idIndexMarker322"/>and temperature data on a 1602 LCD.</p>
			<h2 id="_idParaDest-77"><a id="_idTextAnchor080"/>Coding the sensor module and the 1602 LCD </h2>
			<p>The following code <a id="_idIndexMarker323"/>describes how to get the temperature and humidity data from the <a id="_idIndexMarker324"/>DHT11 sensor and how to display that data on the 1602 LCD:</p>
			<p class="source-code">#include &lt;DHT.h&gt;</p>
			<p class="source-code">#include &lt;math.h&gt;</p>
			<p class="source-code">#include &lt;LiquidCrystal.h&gt;</p>
			<p class="source-code">const int rs = PB11, en = PB10, d4 = PB0, d5 = PA7,    d6 = PA6, d7 = PA5;</p>
			<p class="source-code">LiquidCrystal lcd(rs, en, d4, d5, d6, d7); </p>
			<p class="source-code">#define DHT11_data_pin PB12</p>
			<p class="source-code">DHT dht(DHT11_data_pin, DHT11); </p>
			<p class="source-code">void setup() {</p>
			<p class="source-code">    dht.begin(); </p>
			<p class="source-code">    lcd.begin(16, 2); </p>
			<p class="source-code">}</p>
			<p class="source-code">void loop() {</p>
			<p class="source-code">    float humidity = dht.readHumidity(); </p>
			<p class="source-code">    float temperature=dht.readTemperature();</p>
			<p class="source-code">    lcd.setCursor(0, 0);</p>
			<p class="source-code">    lcd.print("Humidity: "+String(round(humidity))+"%   ");</p>
			<p class="source-code">    lcd.setCursor(0,1);</p>
			<p class="source-code">    lcd.print("Temp.: "+String(temperature)+"C   "); </p>
			<p class="source-code">    delay(1000); </p>
			<p class="source-code">}</p>
			<p>Bear in mind that the code that's been uploaded to this book's GitHub repository contains many comments explaining the main parts of the preceding code. <strong class="source-inline">LiquidCrystal.h</strong> is the library that's used for controlling the 1602 LCD. The <strong class="source-inline">math.h</strong> library contains the <strong class="source-inline">round()</strong> function, which is used for rounding the humidity value. Both <a id="_idIndexMarker325"/>libraries belong to the Arduino IDE's original installation files, so <a id="_idIndexMarker326"/>we don't need to download or install them separately. <strong class="source-inline">DHT.h</strong> is a library for reading DHT11 values; its installation was explained previously in this chapter.</p>
			<p>The next section describes how to code the LM35 temperature sensor to the Curiosity Nano microcontroller board.</p>
			<h2 id="_idParaDest-78"><a id="_idTextAnchor081"/>Programming the LM35 sensor on the Curiosity Nano board</h2>
			<p>The following <a id="_idIndexMarker327"/>code reads the temperature <a id="_idIndexMarker328"/>from an LM35 sensor connected to analog input port <strong class="source-inline">RA0</strong> of the Curiosity Nano:</p>
			<p class="source-code">#include "mcc_generated_files/mcc.h"</p>
			<p class="source-code">static uint16_t LM35read=0;</p>
			<p class="source-code">float temp=0.0;</p>
			<p class="source-code">void main(void)</p>
			<p class="source-code">{</p>
			<p class="source-code">    // initialize the device</p>
			<p class="source-code">    SYSTEM_Initialize();</p>
			<p class="source-code">    ADC_Initialize();</p>
			<p class="source-code">    while (1)</p>
			<p class="source-code">    {</p>
			<p class="source-code">        IO_RD2_SetLow();</p>
			<p class="source-code">        IO_RD3_SetLow();</p>
			<p class="source-code">        LM35read=ADC_GetConversion(channel_ANA0);</p>
			<p class="source-code">        temp=(5.0/1023)*LM35read;</p>
			<p class="source-code">        if (temp&gt;=23.0 &amp;&amp; temp&lt;=26.0)</p>
			<p class="source-code">        {</p>
			<p class="source-code">            IO_RD3_SetHigh();</p>
			<p class="source-code">        } else {</p>
			<p class="source-code">          IO_RD2_SetHigh();</p>
			<p class="source-code">        }</p>
			<p class="source-code">        __delay_ms(500);</p>
			<p class="source-code">    }</p>
			<p class="source-code">}</p>
			<p>As you can see, the<a id="_idIndexMarker329"/> Curiosity Nano performs<a id="_idIndexMarker330"/> an analog to digital conversion for the value that is read from the LM35 sensor using the <strong class="source-inline">ADC_GetConversion()</strong> function. We also used the formula for calculating the degrees Celsius according to the mV read from the LM35; that is, <strong class="source-inline">temp=(5.0/1023)*LM35read;</strong>.</p>
			<p>With that, you have learned how to get data from the DHT11 sensor module and the LM35 sensor by coding the Blue Pill and Curiosoty Nano. The next section will show you how to display the DHT11 data on the Arduino IDE's serial monitor.</p>
			<h1 id="_idParaDest-79"><a id="_idTextAnchor082"/>Showing the humidity and temperature data results on the serial port monitor</h1>
			<p>This section describes<a id="_idIndexMarker331"/> how the DHT11 data is displayed with the Blue Pill on the serial port monitor and the Curiosity Nano microcontroller boards, and also discusses what to do next with the data that's obtained from the DHT11 sensor module.</p>
			<p>Open and run the code for the Blue Pill on the Arduino IDE. You can read the data that was obtained from the DHT11 by clicking on <strong class="bold">Tools</strong> | <strong class="bold">Serial Monitor</strong> from the Arduino IDE's main menu. This can be seen in the following screenshot: </p>
			<div>
				<div id="_idContainer060" class="IMG---Figure">
					<img src="image/Figure_5.13_B16413.jpg" alt="Figure 5.13 – Screenshot of the Arduino IDE's serial monitor"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.13 – Screenshot of the Arduino IDE's serial monitor</p>
			<p>Here, you can see that the humidity and temperature values that were obtained from the DHT11 are shown with decimal points, thus showing a more accurate temperature. Remember that the variables storing these values were declared with the <strong class="source-inline">float</strong> type. </p>
			<p class="callout-heading">Tip</p>
			<p class="callout">If you can't open the IDE's serial monitor and if the IDE shows a message telling you that the USB port cannot be found, it may be that the USB cable that you connected to the Blue Pill and to your computer is faulty. In addition, some USB cables are not capable of transmitting data because those cables are only used for charging devices, which you should not use with the Blue Pill.</p>
			<p>Please note that the temperature shown in the preceding screenshot is in degrees Celsius and that the<a id="_idIndexMarker332"/> RH is displayed as a percentage.</p>
			<h2 id="_idParaDest-80"><a id="_idTextAnchor083"/>Plotting the data</h2>
			<p>The Arduino IDE's serial<a id="_idIndexMarker333"/> port monitor has an interesting option for plotting the values that are read from the DHT11 and sent to the serial port graphically. Those values are plotted in real time.</p>
			<p>Click on <strong class="bold">Tools</strong> | <strong class="bold">Serial Plotter</strong> from the Arduino IDE's main menu and see how the data is displayed graphically, as shown here:</p>
			<div>
				<div id="_idContainer061" class="IMG---Figure">
					<img src="image/Figure_5.14_B16413.jpg" alt="Figure 5.14 – Screenshot of the HDT11 serial plotter"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.14 – Screenshot of the HDT11 serial plotter</p>
			<p>Here, you can see how the DHT11 data is plotted graphically. The <em class="italic">y</em> axis represents the amount of humidity, while the <em class="italic">x</em> axis represents the time in seconds. The graph shows a peak because the environmental humidity changed at that time. To test how the DHT11 sensor's humidity measures change, just blow on the sensor.</p>
			<p>In this section, you learned how to open the Arduino IDE's serial monitor and how the DHT11 sensor module data is displayed on it, including how to plot that data graphically.</p>
			<h1 id="_idParaDest-81"><a id="_idTextAnchor084"/>Summary</h1>
			<p>In this chapter, we learned the basics of the DHT11 humidity and temperature sensor and the LM35 temperature sensor, including their operating ranges and how these sensors send data to a microcontroller board. These are practical and low-cost sensors that the Blue Pill and the Curiosity Nano can easily handle. This chapter showed two ways of showing humidity and temperature results. The Blue Pill showed the humidity and temperature values directly on the computer monitor and on an LCD, while the Curiosity Nano showed temperature and humidity ranges with LEDs. This chapter was beneficial because you learned how to get environmental data from sensors using microcontroller boards and how to display it effectively, using the microcontroller boards' input and output ports. This chapter also highlighted the use of an LCD to show the temperature and humidity data.</p>
			<p><a href="B16413_06_Final_NM_ePub.xhtml#_idTextAnchor087"><em class="italic">Chapter 6</em></a>, <em class="italic">Morse Code SOS Visual Alarm with a Bright LED</em>, will review how to create a practical visual alarm. </p>
			<h1 id="_idParaDest-82"><a id="_idTextAnchor085"/>Further reading</h1>
			<ul>
				<li>Horowitz, P., Hill, W. (2015). <em class="italic">The art of electronics</em>. [3rd ed.] Cambridge University Press: New York, NY.</li>
				<li>LM35 (2017). LM35 Precision Centigrade Temperature Sensor datasheet<a id="_idTextAnchor086"/>. Texas Instruments. Available from: <a href="https://www.ti.com/lit/ds/symlink/lm35.pdf">https://www.ti.com/lit/ds/symlink/lm35.pdf</a></li>
				<li>Microchip (2019). <em class="italic">PIC16F15376 Curiosity Nano hardware user guide</em>. Microchip Technology, Inc. Available from: <a href="http://ww1.microchip.com/downloads/en/DeviceDoc/50002900B.pdf">http://ww1.microchip.com/downloads/en/DeviceDoc/50002900B.pdf</a></li>
				<li>Mouser (2020). <em class="italic">DHT11 humidity and temperature sensor datasheet</em>. Mouser, Inc. Available from: <a href="https://www.mouser.com/datasheet/2/758/DHT11-Technical-Data-Sheet-Translated-Version-1143054.pdf">https://www.mouser.com/datasheet/2/758/DHT11-Technical-Data-Sheet-Translated-Version-1143054.pdf</a></li>
			</ul>
		</div>
	</body></html>