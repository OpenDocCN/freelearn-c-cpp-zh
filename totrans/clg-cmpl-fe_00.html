<html><head></head><body>
<div id="book-content" class="calibre2">
<div id="sbo-rt-content" class="calibre3"><section id="preface" class="level" data-number="0.3">
<h1 class="calibre5" data-number="0.3"><a id="x1-5000" class="pcalibre1 pcalibre2 pcalibre3 pcalibre calibre8"/>Preface</h1>
<p class="hidden"><a id="x1-5000doc" class="pcalibre1 pcalibre2 pcalibre3 pcalibre calibre8"/></p>
<p class="hidden"><strong class="calibre12">Low Level Virtual Machine </strong>(<strong class="calibre12">LLVM</strong>), is a collection of modular and reusable compiler and toolchain technologies used to develop compilers and compiler tools, such as linters and refactoring tools. LLVM is written in C++ and can be considered a good example of a well-structured project that uses interesting techniques aimed at making it reusable and efficient. The project can also be considered an excellent example of compiler architecture; diving into it will give you a sense of how compilers are organized and how they function. This should help to understand usage patterns and apply them accordingly.</p>
<p class="hidden">One of the key components of LLVM is the C/C++ compiler known as Clang. This compiler is widely used across various companies and has been designated as the default compiler for certain development environments, notably for macOS development. Clang will be the primary focus of our investigation in this book, with particular attention to its frontend—the part that is closest to the C/C++ programming language. Specifically, the book will include examples demonstrating how the C++ standard is implemented within the compiler.</p>
<p class="hidden">A pivotal aspect of LLVM’s design is its modularity, which facilitates the creation of custom tools that exploit the compiler’s comprehensive capabilities. A notable example covered in the book is the Clang-Tidy linter framework, designed to identify undesirable code patterns and recommend corrections. Although it includes several hundred checks, you may not find one specific to your project’s needs. However, the book will provide you with the foundation necessary to develop such a check from the beginning.</p>
<p class="hidden">LLVM is an actively evolving project with two major releases each year. At the time the book was written, the latest stable release was version 17. Meanwhile, a release candidate for version 18 was introduced in January 2024, with its official release anticipated to coincide with the publication of the book. The book’s content has been verified against the latest compiler version, 18, ensuring it provides insights based on the most current compiler implementation available.</p>
<section id="who-this-book-is-for" class="level" data-number="0.3.1">
<h3 class="likesectionhead" data-number="0.3.1" id="sigil_toc_id_1"><a id="x1-6000" class="pcalibre1 pcalibre2 pcalibre3 pcalibre calibre8"/>Who this book is for</h3>
<p class="hidden">The book is written for C++ engineers who don’t have prior knowledge of compilers but wish to gain this knowledge and apply it to their daily activities. It provides an overview of the Clang compiler frontend, an essential yet often underestimated part of LLVM. This section of the compiler, along with a collection of powerful tools, enables programmers to enhance code quality and the overall development process. For example, Clang-Tidy offers more than 500 different lint checks that detect anti-patterns in code (such as use after move) and help maintain code style and standards. Another notable tool is Clang-Format, which allows specifying various formatting rules suitable for your project. These tools can also be considered an integral part of the development process. For instance, the language server (Clangd) is a critical service providing navigation and refactoring support for your IDE.</p>
<p class="hidden">Understanding compiler internals might be crucial for anyone wanting to create and use such tools. The book provides the necessary foundation to begin this journey, covering basic LLVM architecture and offering a detailed description of Clang internals. It includes examples from LLVM source code and custom tools that extend the basic functionality provided by the compiler. Additionally, the book addresses compilation databases and various performance optimizations that can enhance the build speed of your projects. This knowledge should help C++ developers correctly apply the compiler to their work activities.</p>
</section>
<section id="what-this-book-covers" class="level" data-number="0.3.2">
<h3 class="likesectionhead" data-number="0.3.2" id="sigil_toc_id_2"><a id="x1-7000" class="pcalibre1 pcalibre2 pcalibre3 pcalibre calibre8"/>What this book covers</h3>
<p class="hidden"><a href="B19722_01.xhtml#x1-150001" class="pcalibre1 pcalibre2 pcalibre3 pcalibre calibre8"><em class="calibre11">Chapter</em><em class="calibre11"> 1</em></a><em class="calibre11">, Environment Setup</em>, describes the basic steps required to set up the environment for future experiments with Clang, suitable for Unix-based systems such as Linux and Darwin (macOS). In addition, readers will learn how to download, configure, and build LLVM source code. We will also create a simple Clang Tool to verify the syntax of the provided source code.</p>
<p class="hidden"><a href="B19722_02.xhtml#x1-330002" class="pcalibre1 pcalibre2 pcalibre3 pcalibre calibre8"><em class="calibre11">Chapter</em><em class="calibre11"> 2</em></a><em class="calibre11">, Clang Architecture</em>, examines the internal architecture of the Clang compiler. Starting with the basic concept of a compiler, we will explore how it is implemented in Clang. We will look at various parts of the compiler, including the driver, preprocessor (lexer), and parser. We will also examine examples that show how the C++ standard is implemented in Clang.</p>
<p class="hidden"><a href="B19722_03.xhtml#x1-530003" class="pcalibre1 pcalibre2 pcalibre3 pcalibre calibre8"><em class="calibre11">Chapter</em><em class="calibre11"> 3</em></a><em class="calibre11">, Clang AST</em>, talks about <strong class="calibre12">Clang Abstract Syntax Tree (AST)</strong>, which is the basic data structure produced by the parser. We will explore how the AST is organized in Clang and how it can be traversed. We will also delve into AST Matchers — a powerful tool provided by Clang for locating specific AST nodes.</p>
<p class="hidden"><a href="B19722_04.xhtml#x1-680004" class="pcalibre1 pcalibre2 pcalibre3 pcalibre calibre8"><em class="calibre11">Chapter</em><em class="calibre11"> 4</em></a><em class="calibre11">, Basic Libraries and Tools</em>, explores basic LLVM libraries and tools, including the LLVM <strong class="calibre12">Abstract Data Type (ADT) </strong>library, used across all LLVM code. We will investigate TableGen, a <strong class="calibre12">Domain-Specific</strong> <strong class="calibre12">Language (DSL) </strong>used to generate C++ code in various parts of LLVM. Additionally, we will explore <strong class="calibre12">LLVM Integrated Tester (LIT) </strong>tool used for creating powerful end-to-end tests. Using the knowledge gained, we will create a simple Clang plugin to estimate source code complexity.</p>
<p class="hidden"><a href="B19722_05.xhtml#x1-990005" class="pcalibre1 pcalibre2 pcalibre3 pcalibre calibre8"><em class="calibre11">Chapter</em><em class="calibre11"> 5</em></a><em class="calibre11">, Clang-Tidy Linter Framework</em>, covers Clang-Tidy, a linter framework based on Clang AST, and creates a simple Clang-Tidy check. We will also discuss how compilation errors affect the AST and the results provided by different Clang Tools, such as Clang-Tidy.</p>
<p class="hidden"><a href="B19722_06.xhtml#x1-1170006" class="pcalibre1 pcalibre2 pcalibre3 pcalibre calibre8"><em class="calibre11">Chapter</em><em class="calibre11"> 6</em></a><em class="calibre11">, Advanced Code Analysis</em>, goes further and considers another advanced data structure used for code analysis: <strong class="calibre12">Control Flow Graphs</strong> <strong class="calibre12">(CFG)</strong>. We will investigate typical cases for its application and create a simple Clang-Tidy check that utilizes this data structure.</p>
<p class="hidden"><a href="B19722_07.xhtml#x1-1320007" class="pcalibre1 pcalibre2 pcalibre3 pcalibre calibre8"><em class="calibre11">Chapter</em><em class="calibre11"> 7</em></a><em class="calibre11">, Refactoring Tools</em>, Clang provides advanced tools for code modification and refactoring. We will explore different ways to create a custom refactoring tool, including one based on the Clang-Tidy linter framework. We will also explore Clang-Format, an extremely fast utility for automatic code formatting.</p>
<p class="hidden"><a href="B19722_08.xhtml#x1-1520008" class="pcalibre1 pcalibre2 pcalibre3 pcalibre calibre8"><em class="calibre11">Chapter</em><em class="calibre11"> 8</em></a><em class="calibre11">, IDE Support and Clangd</em>, presents Clangd - a Language Server used in various IDEs, such as <strong class="calibre12">Visual Studio Code (VS Code)</strong>, to provide intelligent support, including navigation and code modification. Clangd exemplifies the utility of the powerful modular architecture of LLVM. It utilizes various Clang tools, such as Clang-Tidy and Clang-Format, to enhance the development experience in VS Code. Compiler performance is crucial for this tool, and we will explore several techniques Clangd employs to improve its performance, thereby offering the best experience to developers.</p>
<p class="hidden"><em class="calibre11">Appendix 1: Compilation Database</em>, describes the Compilation Database—a method for providing complex compilation commands to different Clang Tools. This functionality is crucial for integrating Clang Tools such as Clangd and Clang-Tidy into real C/C++ projects.</p>
<p class="hidden"><em class="calibre11">Appendix 2: Build Speed Optimizations</em>, covers several compiler performance optimizations that can be used to enhance compiler performance. We will cover Clang precompiled headers and Clang modules, which represent a serialized AST that can be loaded much faster than building it from scratch.</p>
</section>
<section id="to-get-the-most-out-of-this-book" class="level" data-number="0.3.3">
<h3 class="likesectionhead" data-number="0.3.3" id="sigil_toc_id_3"><a id="x1-8000" class="pcalibre1 pcalibre2 pcalibre3 pcalibre calibre8"/>To get the most out of this book</h3>
<p class="hidden">You will need to have an understanding of C++, especially C++17, which is used for LLVM and throughout the examples in the book. The provided examples are assumed to be run on a Unix-like operating system, with Linux and Darwin (Mac OS) being considered the operating system requirements for the book. We will use Git to clone the LLVM source tree and start working on it. Some tools also need to be installed, such as CMake and Ninja, which will be actively used to build the examples and the LLVM source code.</p>
<p class="hidden"><strong class="calibre12">If you are using the digital version of this book, we advise you to</strong> <strong class="calibre12">type the code yourself or access the code from the book’s GitHub</strong> <strong class="calibre12">repository (a link is available in the next section). Doing so will</strong> <strong class="calibre12">help you avoid any potential errors related to the copying and</strong> <strong class="calibre12">pasting of code.</strong></p>
</section>
<section id="download-the-example-code-files" class="level" data-number="0.3.4">
<h3 class="likesectionhead" data-number="0.3.4" id="sigil_toc_id_4"><a id="x1-9000" class="pcalibre1 pcalibre2 pcalibre3 pcalibre calibre8"/>Download the example code files</h3>
<p class="hidden">The code bundle for the book is also hosted on GitHub at <a href="https://github.com/PacktPublishing/Clang-Compiler-Frontend-Packt" class="pcalibre1 pcalibre2 pcalibre3 pcalibre calibre8">https://github.com/PacktPublishing/Clang-Compiler-Frontend-Packt</a>. In case there’s an update to the code, it will be updated on the existing GitHub repository.</p>
<p class="hidden">We also have other code bundles from our rich catalog of books and videos available at <a href="https://github.com/PacktPublishing/" class="pcalibre1 pcalibre2 pcalibre3 pcalibre calibre8">https://github.com/PacktPublishing/</a>. Check them out!</p>
</section>
<section id="conventions-used" class="level" data-number="0.3.5">
<h3 class="likesectionhead" data-number="0.3.5" id="sigil_toc_id_5"><a id="x1-10000" class="pcalibre1 pcalibre2 pcalibre3 pcalibre calibre8"/>Conventions used</h3>
<p class="hidden">There are a number of text conventions used throughout this book.</p>
<p class="hidden"><code class="calibre13">CodeInText</code>: Indicates code words in text, database table names, folder names, filenames, file extensions, pathnames, dummy URLs, and user input. Here is an example: ”The first two parameters specify the declaration <code class="calibre13">(clang::Decl) </code>and the statement for the declaration <code class="calibre13">(clang::Stmt)</code>.”</p>
<p class="hidden">A block of code is set as follows:</p>
<pre id="listing-1" class="source-code"><span>1 </span>int main() { 
<span>2 </span>  return 0; 
<span>3 </span>}</pre>
<p class="hidden">Any command-line input or output is written as follows:</p>
<pre id="verbatim-1" class="console">$ ninja clang</pre>
<p class="hidden">We use <code class="calibre13">&lt;...&gt; </code>as a placeholder for the folder where the LLVM source code was cloned.</p>
<p class="hidden">Some code examples will be representing input of shells. You can recognize them by specific prompt characters:</p>
<ul class="calibre6">
<li class="calibre14"><p class="calibre15"><span><code class="calibre13">(</code><code class="calibre13">lldb</code><code class="calibre13">)</code></span> for interactive LLDB shell</p></li>
<li class="calibre14"><p class="calibre15"><code class="calibre13">$ </code>for Bash shell (macOS and Linux)</p></li>
<li class="calibre14"><p class="calibre15"><code class="calibre13">&gt; </code>for interactive shell provided by different Clang Tools, such as Clang-Query</p></li>
</ul>

<p class="hidden"><span>Important note</span></p>

<p class="hidden">Warnings or important notes appear like this.</p>


<p class="hidden"><span>Tip</span></p>

<p class="hidden">Tips and tricks appear like this.</p>

</section>
<section id="get-in-touch" class="level" data-number="0.3.6">
<h3 class="likesectionhead" data-number="0.3.6" id="sigil_toc_id_6"><a id="x1-11000" class="pcalibre1 pcalibre2 pcalibre3 pcalibre calibre8"/>Get in touch</h3>
<p class="hidden">Feedback from our readers is always welcome.</p>
<p class="hidden"><strong class="calibre12">General feedback</strong>: If you have questions about any aspect of this book, mention the book title in the subject of your message and email us at <a href="mailto:customercare@packtpub.com" class="pcalibre1 pcalibre2 pcalibre3 pcalibre calibre8">customercare@packtpub.com</a>.</p>
<p class="hidden"><strong class="calibre12">Errata</strong>: Although we have taken every care to ensure the accuracy of our content, mistakes do happen. If you have found a mistake in this book, we would be grateful if you would report this to us. Please visit <a href="https://www.packtpub.com/support/errata" class="pcalibre1 pcalibre2 pcalibre3 pcalibre calibre8">https://www.packtpub.com/support/errata</a>, selecting your book, clicking on the Errata Submission Form link, and entering the details.</p>
<p class="hidden"><strong class="calibre12">Piracy</strong>: If you come across any illegal copies of our works in any form on the Internet, we would be grateful if you would provide us with the location address or website name. Please contact us at <a href="mailto:copyright@packt.com" class="pcalibre1 pcalibre2 pcalibre3 pcalibre calibre8">copyright@packt.com</a> with a link to the material.</p>
<p class="hidden"><strong class="calibre12">If you are interested in becoming an author</strong>: If there is a topic that you have expertise in and you are interested in either writing or contributing to a book, please visit <a href="https://partnerships.packt.com/contributors/" class="pcalibre1 pcalibre2 pcalibre3 pcalibre calibre8">https://partnerships.packt.com/contributors/</a>.</p>
</section>
<section id="share-your-thoughts" class="level" data-number="0.3.7">
<h3 class="likesectionhead" data-number="0.3.7" id="sigil_toc_id_7"><a id="x1-12000" class="pcalibre1 pcalibre2 pcalibre3 pcalibre calibre8"/>Share your thoughts</h3>
<p class="hidden">Once you’ve read <em class="calibre11">Clang Compiler Frontend</em>, we’d love to hear your thoughts! Please <a href="https://packt.link/r/1837630984" class="pcalibre1 pcalibre2 pcalibre3 pcalibre calibre8">click here to go straight to the Amazon review page</a> for this book and share your feedback.</p>
<p class="hidden">Your review is important to us and the tech community and will help us make sure we’re delivering excellent quality content.</p>
</section>
<section id="download-a-free-pdf-copy-of-this-book" class="level" data-number="0.3.8">
<h3 class="likesectionhead" data-number="0.3.8" id="sigil_toc_id_8"><a id="x1-13000" class="pcalibre1 pcalibre2 pcalibre3 pcalibre calibre8"/>Download a free PDF copy of this book</h3>
<p class="hidden">Thanks for purchasing this book!</p>
<p class="hidden">Do you like to read on the go but are unable to carry your print books everywhere? Is your eBook purchase not compatible with the device of your choice?</p>
<p class="hidden">Don’t worry, now with every Packt book you get a DRM-free PDF version of that book at no cost.</p>
<p class="hidden">Read anywhere, any place, on any device. Search, copy, and paste code from your favorite technical books directly into your application.</p>
<p class="hidden">The perks don’t stop there, you can get exclusive access to discounts, newsletters, and great free content in your inbox daily.</p>
<p class="hidden">Follow these simple steps to get the benefits:</p>
<ol class="calibre6">
<li class="calibre7"><div id="x1-13002x1" class="tableofcontents">
<p class="calibre15">Scan the QR code or visit the link below:</p>
<div class="tableofcontents">
<img src="../media/free_ebook_qr.png" alt="PIC" class="calibre16"/>
</div>
<p class="calibre15"><a href="https://download.packt.com/free-ebook/9781837630981" class="pcalibre1 pcalibre2 pcalibre3 pcalibre calibre8">https://download.packt.com/free-ebook/9781837630981</a></p>
</div>
</li>
<li class="calibre7"><div id="x1-13004x2" class="tableofcontents">
<p class="calibre15">Submit your proof of purchase.</p>
</div></li>
<li class="calibre7"><div id="x1-13006x3" class="tableofcontents">
<p class="calibre15">That’s it! We’ll send your free PDF and other benefits to your email directly.</p>
</div></li>
</ol>
<p class="hidden"><a id="x1-13007r1" class="pcalibre1 pcalibre2 pcalibre3 pcalibre calibre8"/></p>
</section>
</section>
</div>
</div>
</body></html>