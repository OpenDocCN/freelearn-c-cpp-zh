# 第四章. Wi-Fi 控制的移动机器人

在本书的最后一章，我们将使用 Arduino Yún 在完全不同的领域：机器人技术。你将学习如何接口直流电机，以及如何使用 Arduino Yún 作为机器人的大脑、距离传感器，以及使用 Wi-Fi 和简单的 Web 界面进行无线控制。你还将能够实时查看机器人所做的测量，例如，超声波传感器在机器人前方测量的距离。

# 构建移动机器人

Arduino 板在移动机器人中得到了广泛的应用，因为它们很容易与机器人的不同部分进行接口，如传感器、直流电机等执行器，以及其他如 LCD 屏幕等组件。Arduino 甚至最近发布了他们自己的机器人，让人们可以在一个共同的机器人平台上进行实验。这些机器人通常只编程一次，然后独立执行某些任务，例如移动而不撞到障碍物或捡起物体。

在这个项目中，我们将有所不同。我们想要的是构建一个以 Arduino Yún 作为“大脑”的移动机器人，并通过电脑或移动设备，如智能手机或平板电脑，完全通过 Wi-Fi 来控制它。为此，我们将为机器人编写一个 Arduino 草图，该草图将接收命令并回传数据，并在你的电脑上编写一个图形界面。这样，如果你想在将来构建更复杂的应用程序，你只需更改电脑上运行的软件，而无需触碰机器人。

我们首先将使用一些基本的机械和电气部件来构建机器人。我们不仅会向你展示如何使用特定的套件来构建机器人，还会给你很多关于使用其他等效组件来构建你自己的机器人的建议。为了给你一个我们打算构建的机器人的概念，以下是我们组装好的机器人的图片：

![构建移动机器人](img/8007_04_01.jpg)

在机器人的底部，你大部分的机械部件，如底盘、轮子、直流电机和超声波传感器。你还在机器人的底部中心位置有电池。然后，你可以看到顶部的不同 Arduino 板。从底部开始，你有 Arduino Yún 板、Arduino Uno 板、电机保护罩和一个原型板。

在这个项目中组装组件将略有不同，因为我们实际上将在项目中使用两个 Arduino 板：Yún 板，它将直接从外部世界接收命令，以及一个 Arduino Uno 板，它将连接到电机保护罩。

然后，我们将对机器人的各个部分进行常规测试，例如测试机器人的两个直流电机和位于机器人前端的超声波距离传感器。为了测试电机，我们将简单地让它们逐渐加速，以查看命令电路是否工作正常。从超声波距离传感器接收到的测量值将直接显示在串行监视器上。

下一步是构建 Arduino 软件，该软件将从计算机接收命令并将它们传输到移动机器人的电机。在此阶段，我们还将编写将距离信息传输回计算机的部分。因为我们希望标准化我们的代码并使其可用于其他项目，所以我们将从我们在第二章中使用的 Arduino Yún 板的 REST API 中汲取灵感，*创建远程能源监控和控制设备*。

最后，我们将在您的计算机上构建服务器端图形界面，这样您就可以轻松地从计算机或移动设备控制机器人，并接收一些关于机器人的数据，例如超声波传感器的读数。此服务器端软件将再次使用 HTML 来显示界面，JavaScript 来处理用户的操作，以及 PHP 通过`cURL`函数直接与您的 Arduino Yún 板通信。

# 所需的硬件和软件组件

除了 Arduino Yún 之外，您还需要一些机械和电气组件来完成此项目。第一套组件是为机器人本身准备的。您基本上需要三样东西：一个将支持所有组件的机器人底盘或机架，两个带轮子的直流电机，以便机器人可以移动，以及至少一个位于机器人前方的超声波传感器。我们使用了一个来自 DFRobot 的移动机器人套件([`www.dfrobot.com/`](http://www.dfrobot.com/))，您可以在下面的图片中看到：

![所需的硬件和软件组件](img/8007_04_02.jpg)

该套件被称为**2 轮 miniQ 平衡机器人底盘**，在撰写本书时售价为 32.20 美元。当然，您不需要这个套件来构建此项目。只要您有一个包含我们之前提到的三种组件的套件，您可能就可以开始这个项目了。

对于电机，请注意，我们使用的电机保护器电路可以处理高达 12V 的直流电压，因此请使用在 12V 以下电压下工作的电机。此外，请使用具有集成减速器的电机。这样，您将增加电机的可用扭矩（以便机器人更容易移动）。

对于超声波传感器，你有许多选择。我们使用了一个可以通过 Arduino 的`pulseIn()`函数进行接口的传感器，所以任何以这种方式工作的传感器都应该与我们在本章后面看到的代码兼容。这个传感器在 DFRobot 的参考是 URM37。如果你计划使用其他类型的距离传感器，例如使用 I2C 接口的传感器，你必须相应地修改代码。

然后，你需要一块 Arduino 板，它将通过电机保护罩直接与直流电机接口。在这个阶段，你可能会问为什么我们不直接将所有组件连接到 Arduino Yún，而不使用中间的另一个 Arduino 板。确实，使用机器人的传感器是可以做到的，但电机不行。

我们不能直接将电机连接到 Arduino 板；它们通常需要的电流比 Arduino 引脚能提供的要多。这就是为什么我们将使用专门为此任务设计的电机保护罩。通常，Arduino Yún 在没有损坏的情况下无法使用这些电机保护罩，至少在撰写这本书的时候是这样的。这是因为电机保护罩通常是为 Arduino Uno 板设计的，保护罩上的错误引脚可能会连接到 Yún 的错误引脚。当然，你也可以使用面包板上的外部组件来做这件事，但在这里使用保护罩确实简化了事情。

正因如此，我们将使用标准 Arduino 板将所有组件接口，然后让 Yún 板与标准 Arduino 板通信。我们在这个项目中使用了 DFRduino 板，这是 DFRobot 为这个 Arduino Uno 板的克隆版所取的名字。如下面的图片所示：

![所需的硬件和软件组件](img/8007_04_03.jpg)

当然，任何等效的板都可以工作，只要它与官方 Arduino Uno 板兼容。你也可以使用其他板，例如 Arduino Leonardo，但我们的代码在其他板上尚未经过测试。

然后，你需要一个电机保护罩来将两个直流电机与 Arduino Uno 板接口。我们在这个项目中也使用了 DFRobot 的电机保护罩。在 DFRobot 网站上的参考是**Arduino 1A 电机保护罩**，如下面的图片所示：

![所需的硬件和软件组件](img/8007_04_04.jpg)

再次强调，大多数电机保护罩都可以用于这个项目。你基本上需要一个可以控制至少两个电机的保护罩。保护罩还需要能够处理你想要控制的电机，包括电压和电流。在我们的例子中，我们需要一个可以处理机器人两个 6V 直流电机的保护罩，最大电流为 1A。

通常，您可以寻找包含 L293D 电机驱动 IC 的电机保护板。这个集成电路是一个专门用于控制直流电机的芯片。它可以处理高达两个 12V 直流电机，电流为 1A，这对于我们试图构建的移动机器人来说将适用。当然，如果你的保护板可以处理更多的电流或电压，那也可以。重要的是要找到如何设置机器人的速度：我提到的 IC 可以直接接收来自 Arduino 板的 PWM 命令，所以如果您想使用本章中规定的代码，您将需要使用使用类似类型命令设置电机速度的保护板。

最后，我们在机器人顶部添加了一个简单的原型板，以便更容易地进行电源连接，并且将来可以添加更多组件，如下面的图片所示：

![所需的硬件和软件组件](img/8007_04_05.jpg)

再次强调，您可以使用任何等效的原型板，例如 Arduino 的官方原型板。这主要是为了避免有很多电缆散落在周围，但您也可以用它来扩展您的机器人项目，添加更多组件，例如加速度计或陀螺仪。

您还需要为您的机器人提供电源。由于直流电机可能需要相当多的电流，我们强烈建议您在测试机器人时不要使用来自计算机 USB 端口的电源，否则您可能会损坏它。这就是为什么我们总是使用电池来处理机器人的电机。我们使用了一个带有直流插头连接器的 7.2V 电池，这样它可以很容易地插入到 Arduino Uno 板上。这个电池组也可以在 DFRobot 网站上找到。您也可以使用一些 AA 电池代替电池组。您必须确保这些电池的总电压大于您直流电机的标称电压。

至于软件本身，您只需要在您的计算机上安装 Arduino IDE 和一个网络服务器。

# 机器人组装

现在是组装机器人的时候了。我们将向您展示在这个项目中使用的机器人套件所需的步骤，但它们可以应用于任何其他等效的机器人套件。第一步是将电池放置在机器人的底部，如下面的图片所示：

![机器人组装](img/8007_04_06.jpg)

注意，一些金属间隔件也被用于机器人的底部，以保持电池的位置并为其他组件提供支撑。这些间隔件也可以在 DFRobot 网站上找到。然后，您可以在底盘顶部拧上两个更多的间隔件和 Arduino Yún 板，如下面的图片所示：

![机器人组装](img/8007_04_07.jpg)

然后，我们在两个金属间隔件上添加了 Arduino Uno 兼容板。在这个时候，您可以拧上 Arduino Uno 板；所有其他组件都将直接插入到这些板上，如下面的图片所示：

![机器人组装](img/8007_04_08.jpg)

然后，您可以直接将电机保护罩安装在 Arduino Uno 板上。此时，您还可以将来自直流电机的电缆连接到电机保护罩的螺丝端子。请注意这一步；很容易将直流电机的错误电缆插错。您需要将每个电机连接到电机保护罩板上的不同连接器，如下面的图片所示：

![机器人组装](img/8007_04_09.jpg)

最后，您可以将原型板安装在机器人上。到这一步，我们已经连接了超声波传感器：地线连接到 Arduino 的地线，VCC 连接到原型板上的 Arduino 5V 引脚，信号引脚连接到 Arduino 板的 A0 引脚。如果您的超声波传感器使用数字接口，例如，您可能需要使用不同的引脚。请阅读您超声波传感器的数据手册以获取更多信息。以下图片显示了这一步骤的机器人状态：

![机器人组装](img/8007_04_10.jpg)

# 连接 Arduino Yún 和 Uno 板

我们还没有完成！到目前为止，Arduino Yún 和 Arduino Uno 板之间还没有连接，因此 Yún 板将无法访问直流电机和机器人的传感器。为了解决这个问题，第一步是将 Arduino Uno 板的电源连接到 Yún 板。这样，当我们使用电池为项目供电时，Yún 板也会被供电。

要这样做，只需将地线引脚连接在一起，并将 Arduino Yún 上的 Vin 引脚连接到 Arduino Uno 的 5V 轨，如下面的图片所示：

![连接 Arduino Yún 和 Uno 板](img/8007_04_11.jpg)

要完成连接两块 Arduino 板，我们需要将它们连接起来，以便在项目运行时它们可以相互通信。为此，我们将使用 Arduino 板的 I2C 接口，这样它们就可以相互发送消息。I2C 代表**Inter Integrated Circuit**，是一种为电路间通信而开发的简单通信协议，在电子学中得到了广泛应用。为此需要连接两根线：SDA 和 SCL。要做到这一点，只需将 Yún 板的 2 号引脚连接到 Uno 板的 A4 号引脚，将 Yún 板的 3 号引脚连接到 Uno 板的 A5 号引脚，如下面的图片所示：

![连接 Arduino Yún 和 Uno 板](img/8007_04_12.jpg)

以下图片总结了两个板之间的连接：

![连接 Arduino Yún 和 Uno 板](img/8007OS_04_13.jpg)

最后，您可以通过将电池的直流插头连接到 Uno 板上的电源连接器来为项目供电，如下面的图片所示：

![连接 Arduino Yún 和 Uno 板](img/8007OS_04_14.jpg)

如果这一步操作都正确无误，你应该会看到两个板（Yún 和 Uno）都已上电，其中一些 LED 灯亮着。为了帮助你构建机器人，我们还包含了两个展示机器人不同连接的侧面图片。以下是一张展示机器人侧面电源连接到 Yún 的图片：

![连接 Arduino Yún 和 Uno 板](img/8007OS_04_15.jpg)

以下图片显示了从 I2C 接口到 Yún 的连接：

![连接 Arduino Yún 和 Uno 板](img/8007OS_04_16.jpg)

# 测试机器人的硬件连接

在构建项目的遥控部分之前，我们想确保硬件连接正确，尤其是在 Arduino Uno 板和不同的电机及传感器之间。这就是为什么我们首先将为 Arduino Uno 板构建一个简单的草图来测试不同的组件。

在这个阶段，我们将打开机器人的电机；因此请确保机器人站在一个小平台上，例如，以防你在用 USB 线连接到电脑测试不同的 Arduino 草图时，机器人四处移动。

草图首先声明了电机的引脚，如下面的代码所示。请注意，这些引脚专门用于我们使用的电机保护罩；如果你使用的是不同的保护罩，请参阅你的保护罩数据表。

```cpp
int speed_motor1 = 6;  
int speed_motor2 = 5;
int direction_motor1 = 7;
int direction_motor2 = 4;
```

按照以下方式声明超声波传感器使用的引脚：

```cpp
int distance_sensor = A0;
```

我们还希望电机在运行过程中速度变化，所以我们按照以下方式声明变量：

```cpp
int robot_speed;
```

在草图的`setup()`部分，我们需要指定电机引脚将作为输出引脚，如下面的代码所示：

```cpp
for(int i=4;i<=7;i++)
{  
  pinMode(i, OUTPUT);
}
```

我们还需要为机器人设置一个起始速度。请注意，每个电机的速度将由来自 Arduino 的 PWM 命令设置，因此我们必须指定一个介于 0（不对电机施加电压）和 255（对电机施加最大电压）之间的值。此外，由于电机上的机械阻力，PWM 命令的值和电机的速度之间没有线性关系。

我们使用 75 作为起始速度，这在我们的直流电机上是一个非常慢的速度。然而，根据你的设置，这个值将产生完全不同的效果。在这个阶段，你也可以进行实验，看看最大 PWM 值是多少，这将使你的直流电机达到正好零速度。请确保机器人还没有放在地板上，因为它会开始向前移动，可能会损坏东西。我们把它放在一个小支架上，这样轮子就不会碰到任何东西。

在`loop()`部分，所有操作都是由`send_motor_command`函数完成的，该函数将用于两个电机。例如：

```cpp
send_motor_command(speed_motor1,direction_motor1,robot_speed,1);
```

让我们看看这个函数的细节。它首先按照以下方式将电机的速度写入正确的引脚：

```cpp
analogWrite(speed_pin,pwm);
```

然后，我们需要将方向引脚设置为正确的方向。这是通过一个简单的`digitalWrite`函数完成的，如下所示：

```cpp
digitalWrite(direction_pin,dir);
```

仍然在`loop()`函数中，我们调用一个函数来测量机器人前面的距离，并将结果打印在`Serial`端口上：

```cpp
Serial.println(measure_distance(A0));
```

让我们看看这个函数的详细情况。它首先使用`pulseIn`函数从传感器获取原始测量值。基本上，传感器返回一个长度与测量距离成正比的脉冲。脉冲长度是通过以下 Arduino 专用函数测量的：

```cpp
unsigned long DistanceMeasured=pulseIn(pin,LOW);
```

然后，我们检查读取是否有效，如果是，我们使用以下公式将其转换为厘米：

```cpp
Distance=DistanceMeasured/50;
```

这是通过以下代码返回的：

```cpp
return Distance;
```

最后，我们在循环的每次迭代中更新速度，每次增加一个单位，如果它达到 255 则重置，如下所示：

```cpp
robot_speed++;
if (robot_speed > 255) {robot_speed = 75;}
```

该部分的代码可在本书的 GitHub 仓库中找到，存储在一个名为`robot_test`的文件中：[`github.com/openhomeautomation/geeky-projects-yun/tree/master/chapter4/robot_test`](https://github.com/openhomeautomation/geeky-projects-yun/tree/master/chapter4/robot_test)

现在是时候将代码上传到机器人上了。在这样做之前，请确保机器人由电池供电。机器人的两个电机应该在达到最大速度时逐渐加速，然后以较低的速度重新开始。

你也可以在这个时候打开串行监视器来检查距离传感器的读数。尝试将你的手或物体放在机器人前面；你应该在串行监视器上看到距离相应地变化。

# 构建 Arduino 草图

现在是时候构建我们项目的最终草图了。为了更精确，我们应该说草图，因为我们将不得不开发两个：一个用于 Uno 板，一个用于 Yún 板。现在你只需要对硬件进行一个简单的更改：将超声波传感器直接连接到 Yún 板，将信号引脚连接到 Yún 板的 A0 引脚。

让我们首先关注 Arduino Uno 草图。这个草图受到了我们之前编写的测试草图的启发，因此它已经包含了控制两个直流电机的函数。为了在两个板之间进行通信，我们必须包含负责处理 I2C 通信的 Wire 库：

```cpp
#include <Wire.h>
```

然后，在草图中的`setup()`部分，我们需要声明我们正在连接到 I2C 总线并开始监听传入的事件。Arduino 板将被配置为从机，接收来自充当主机的 Yún 板的命令。这是通过以下代码片段完成的：

```cpp
Wire.begin(4);
Wire.onReceive(receiveEvent);
```

让我们看看这个`receiveEvent`部分的细节，这实际上是一个作为参数传递给 Wire 库的`onReceive()`函数的函数。每当 I2C 总线上接收到事件时，这个函数将被调用。这个函数的基本操作是从 Yún 读取传入的数据，这些数据必须遵循特定的格式，如下面的示例所示：

```cpp
speed_motor_1,direction_motor_1,speed_motor_2,direction_motor_2
```

例如，上一条消息的前一部分是通过以下代码读取回的：

```cpp
int pwm1 = Wire.read();
Serial.print(pwm1);
char c = Wire.read();
Serial.print(c);
```

这些来自 Yún 的命令随后被应用于电机，如下所示：

```cpp
send_motor_command(speed_motor1,direction_motor1,pwm1,dir1); send_motor_command(speed_motor2,direction_motor2,pwm2,dir2);
```

现在，让我们专注于 Yún 草图。这个草图灵感来源于 Arduino IDE 中附带的自带 Bridge 草图，并基于 Arduino Yún 的 REST API。为了简化操作，我们将创建一种新的 REST 调用，命名为 robot。这样，我们就可以通过在浏览器中执行以下调用来控制机器人：

```cpp
myarduinoyun.local/arduino/robot/stop
```

首先，我们需要为草图包含正确的库，如下所示：

```cpp
#include <Wire.h>
#include <Bridge.h>
#include <YunServer.h>
#include <YunClient.h>
```

然后，在板上创建一个网络服务器：

```cpp
YunServer server;
```

在`setup()`函数中，我们还将 I2C 总线连接起来：

```cpp
Wire.begin();
```

然后，我们启动桥接：

```cpp
Bridge.begin();
```

`setup()`函数通过以下方式启动网络服务器结束：

```cpp
server.listenOnLocalhost();
server.begin();
```

然后，`loop()`函数通过以下方式监听传入的连接：

```cpp
YunClient client = server.accept();
```

来自这些客户端的请求可以通过以下命令进行处理：

```cpp
if (client) {
  // Process request
  process(client);

  // Close connection and free resources.
  client.stop();
  }
```

如果有客户端连接，我们将对其进行处理以检查是否收到了机器人命令，如下所示：

```cpp
String command = client.readStringUntil('/');

if (command == "robot") {   
  robotCommand(client);
}
```

这个函数处理 REST 调用，以查看我们需要对机器人的电机做些什么。例如，让我们考虑这样一个情况，我们想让机器人以全速向前行驶。我们需要向 Arduino Uno 板发送以下消息：

```cpp
255,0,255,0
```

这是通过以下代码段完成的：

```cpp
if (command == "fullfw") {
  Wire.beginTransmission(4);
  Wire.write(255);
  Wire.write(",");
  Wire.write(0);
  Wire.write(",");
  Wire.write(255);
  Wire.write(",");
  Wire.write(0);
  Wire.endTransmission();
}
```

我们为这个简单的 REST API 添加了三个其他命令：`stop`（显然是停止机器人），`turnleft`（以中等速度使机器人向左转），`turnright`（使机器人向右转），以及`getdistance`以返回超声波传感器的距离。我们还在这个草图中插入了`measure_distance`函数来读取来自超声波传感器的数据。

现在，我们已经准备好将代码上传到机器人上了。请记住，您必须在这里上传两个草图：一个用于 Uno 板，另一个用于 Yún 板。顺序并不那么重要，只需成功上传两个 Arduino 草图，并仔细确保您上传的是正确的代码到正确的板上。

以下 GitHub 仓库中提供了这两个草图：[`github.com/openhomeautomation/geeky-projects-yun/tree/master/chapter4/remote_control`](https://github.com/openhomeautomation/geeky-projects-yun/tree/master/chapter4/remote_control)。

您可以测试 Yún 板是否正确地将命令中继到 Uno 板上。在这个时候，您可以断开所有电缆，只用电池为机器人供电。然后，打开一个网页浏览器并输入以下代码：

```cpp
myarduinoyun.local/arduino/robot/turnright
```

机器人应该立即开始向右转。要停止机器人，您可以简单地输入以下代码：

```cpp
myarduinoyun.local/arduino/robot/stop
```

您也可以输入以下代码：

```cpp
myarduinoyun.local/arduino/robot/getdistance
```

这应该在您的网页浏览器上打印出机器人前面的距离值。如果您在网页浏览器上看到打印出的距离是真实的，这意味着命令正在正确工作。

# 构建计算机界面

我们现在将构建一个界面，让您可以从电脑或移动设备远程控制机器人。这实际上与我们为继电器控制项目所做的工作非常相似，主要区别在于我们还想从机器人（在本例中为超声波传感器的距离测量）读取一些数据。将有一个 HTML 文件来托管界面的不同元素，一些用于与 Yún 板通信的 PHP 代码，一些用于在 HTML 和 PHP 之间建立链接的 JavaScript，以及一些用于给界面添加样式的 CSS。

第一步是创建一个 HTML 文件，它将成为我们访问机器人控制的入口点。该文件基本上托管了四个按钮，我们将使用这些按钮来控制我们的机器人，并有一个字段来持续显示超声波传感器测量的距离。按钮是在一个表单内声明的；以下是一个按钮的代码：

```cpp
<input type="button" id="stop" class="commandButton" value="Stop" onClick="stopRobot()"/>
```

距离信息将通过以下代码行显示：

```cpp
<div id="distanceDisplay"></div>
```

以下字段将使用一些 JavaScript 进行更新：

```cpp
<script type="text/javascript">
  setInterval(function() {
    $("#distanceDisplay").load('get_distance.php');
  }, 1000);
</script>
```

让我们看看这个 PHP 文件的内容。它基本上是对 Yún 板的 REST API 进行调用，并将返回的答案显示在界面上。同样，它将使用 PHP 的`curl`函数。

它首先通过`cURL`调用您的 Yún 板，使用我们在之前的草图定义的`getdistance`参数：

```cpp
$service_url = 'http://myarduinoyun.local/arduino/robot/getdistance';
```

然后通过以下代码准备调用：

```cpp
$curl = curl_init($service_url);
```

我们使用以下代码获取答案：

```cpp
$curl_response = curl_exec($curl);
```

然后，我们使用 PHP 的`echo`函数将其打印出来：

```cpp
echo $curl_response;
```

控制电机的 PHP 脚本也非常相似，所以我们在这里不会详细说明。

让我们看看处理界面不同按钮的 JavaScript 文件。界面的每个按钮基本上都链接到一个 JavaScript 函数，该函数将正确的参数发送到 Arduino Yún，通过 PHP 文件。例如，`stop`按钮调用以下函数：

```cpp
function stopRobot(){
     $.get( "update_state.php", {command: "stop"} );
}
```

同样，我们使用使机器人全速向前的函数。要使机器人向左或向右转，我们可以实现更复杂的行为。我们通常想要的不是让机器人自己连续转动，而是例如，转动四分之一圈。这就是我们在本项目中采取的方法变得强大的地方。我们可以在服务器端直接这样做，而无需更改 Arduino 板上的草图。

因此，为了在给定的时间内向右转，例如，我们将在服务器端实现一系列命令，然后停止。这是通过以下代码完成的：

```cpp
function turnRight(){

  $.get( "update_state.php", { command: "turnright"} );
  sleep(350);
  $.get( "update_state.php", { command: "stop"} );
}
```

`sleep`函数本身是在同一文件中实现的，它通过比较自函数被调用以来经过的时间来工作，如下面的代码所示：

```cpp
function sleep(milliseconds) {
  var start = new Date().getTime();
  for (var i = 0; i < 1e7; i++) {
    if ((new Date().getTime() - start) > milliseconds){
      break;
    }
  }
}
```

当然，我们邀请您玩转这个睡眠功能，以获得期望的角度。例如，我们设置了睡眠函数，每次我们按下**向右转**按钮时，机器人大约会转动四分之一圈。

界面的代码可在项目的 GitHub 仓库中找到：[`github.com/openhomeautomation/geeky-projects-yun/tree/master/chapter4/remote_control`](https://github.com/openhomeautomation/geeky-projects-yun/tree/master/chapter4/remote_control)

现在，是时候开始这个项目了。确保将所有文件放置在您的网络服务器根目录下，并确保网络服务器正在运行。然后，在浏览器中打开您的网络服务器文件夹（通常通过输入`localhost`）并打开 HTML 文件。该项目还包含一个 CSS 样式表，用于使界面看起来更好。以下是在您的浏览器中应该看到的内容：

![构建计算机界面](img/8007OS_04_17.jpg)

显示超声波传感器距离读数的字段应该每秒自动更新，这样您可以立即看到它是否工作正常。尝试将您的手或物体放在机器人前面，数值应该相应地改变。

在让机器人移动之前，我们建议您在机器人仍然站在一个小支架上时测试不同的按钮，这样它就不能移动了。确实，如果您的服务器或 Arduino 草图中有错误编码，您的机器人将不再响应，并会在您的家中随机撞击物体。

您现在也可以测试不同的按钮。您可以特别关注使机器人向左或向右转动的按钮，并在 PHP 代码中调整`sleep()`函数，使它们正好做您想要的事情。请注意，当您的机器人移动时，机器人前方超声波传感器检测到的距离会相应更新。

# 摘要

让我们看看本章的主要收获是什么：

+   我们开始这个项目时，是从不同的组件构建机器人的，例如机器人底盘、直流电机、超声波传感器和不同的 Arduino 板。

+   然后，我们构建了一个简单的草图来测试直流电机和超声波距离传感器。

+   下一步是构建两个 Arduino 草图来远程控制机器人：一个用于 Arduino Uno 板，另一个用于 Yún 板。

+   在项目的最后，我们构建了一个简单的网络界面来远程控制机器人。该界面由几个按钮组成，用于使机器人移动，还有一个字段，持续显示机器人前方安装的超声波传感器的测量值。

现在我们来看看您还能做些什么来改进这个项目。例如，您可以使用超声波传感器数据使机器人相应地行动，例如避免撞墙。

最后，你还可以向机器人添加许多硬件组件。你可以做的第一件事是在机器人周围添加更多的超声波传感器，这样你就可以检测到机器人侧面的障碍物。你也可以想象给机器人添加一个加速度计和/或陀螺仪，这样你就可以确切地知道它要去哪里以及以什么速度行驶。

你甚至可以想象将这个项目与第三章中的项目“制作你自己的云连接摄像头”结合起来，并将一个 USB 摄像头连接到机器人上。这样，你就可以通过 Web 界面实时直播机器人所看到的画面，同时控制它！

我希望这本书能给你一个关于 Arduino Yún 可以为你的 Arduino 项目添加什么的良好概述。通过书中的四个项目，我们使用了 Arduino Yún 的三个主要功能：强大的嵌入式 Linux 机器、板载 Wi-Fi 连接以及 Temboo 库来将板子与网络服务接口。现在，你可以利用这本书中学到的知识来构建基于 Arduino Yún 的自己的应用程序！
