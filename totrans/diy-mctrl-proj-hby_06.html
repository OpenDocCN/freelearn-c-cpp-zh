<html><head></head><body>
		<div><h1 id="_idParaDest-83"><em class="italic"><a id="_idTextAnchor087"/>Chapter 6</em>: Morse Code SOS Visual Alarm with a Bright LED</h1>
			<p>This chapter describes how to build a very noticeable visual alarm with a <strong class="bold">super-bright LED</strong> connected to a microcontroller board. The LED will show an SOS message (this is used when someone or a group of people is in danger or in distress). In this chapter, you will learn how to control a super-bright LED with a microcontroller board. The reason we are using a super-bright LED in this chapter is to increase the visibility of the SOS message with it. This chapter will be beneficial for future electronic projects because you will learn how to control an LED with a transistor working as a switch. The application made in this chapter can be used by people in distress while they are hiking, at sea, and in similar scenarios.</p>
			<p>In this chapter, we are going to cover the following main topics:</p>
			<ul>
				<li>Understanding Morse code and the SOS message</li>
				<li>Introducing super-bright LEDs and calculating their necessary resistors</li>
				<li>Connecting the resistor and the super-bright LED to the microcontroller board</li>
				<li>Coding the SOS Morse code signal</li>
				<li>Testing the visual alarm</li>
			</ul>
			<p>By the end of this chapter, you will be able to properly connect a super-bright LED to the Curiosity Nano and Blue Pill microcontroller boards and to generate a Morse code message with a microcontroller board.</p>
			<h1 id="_idParaDest-84"><a id="_idTextAnchor088"/>Technical requirements</h1>
			<p>The software tools that you will be using in this chapter are the MPLAB-X and Arduino IDEs for editing and uploading your programs to the Curiosity Nano and the Blue Pill microcontroller boards, respectively.</p>
			<p>The code used in this chapter can be found at the book's GitHub repository:</p>
			<p><a href="https://github.com/PacktPublishing/DIY-Microcontroller-Projects-for-Hobbyists/tree/master/Chapter06">https://github.com/PacktPublishing/DIY-Microcontroller-Projects-for-Hobbyists/tree/master/Chapter06</a></p>
			<p>The Code in Action video for this chapter can be found here: <a href="https://bit.ly/3iXDlEP">https://bit.ly/3iXDlEP</a></p>
			<p>In this chapter, we will use the following pieces of hardware:</p>
			<ul>
				<li>A solderless breadboard.</li>
				<li>The Blue Pill and Curiosity Nano microcontroller boards.</li>
				<li>A micro USB cable for connecting your microcontroller boards to a computer.</li>
				<li>The ST-Link/V2 electronic interface needed to upload the compiled code to the Blue Pill. Bear in mind that the ST-Link/V2 requires four female-to-female DuPont wires.</li>
				<li>One 5 mm trough-hole 625 nm orange-red, super-bright LED, manufacturer number BL-BJU334V-1, made by American Bright Optoelectronics Corporation, or something similar.</li>
				<li>Two 1 k ohm resistors rated at one-quarter watt. These resistors are for the LED and the transistor.</li>
				<li>One 220-ohm resistor rated at one-quarter watt. This is for the LED.</li>
				<li>One <strong class="bold">2N2222</strong> transistor, TO-92 package.</li>
				<li>A dozen male-to-male DuPont wires.</li>
			</ul>
			<p>The following section describes what Morse code is and why we are using it in this project.</p>
			<h1 id="_idParaDest-85"><a id="_idTextAnchor089"/>Understanding Morse code and the SOS message</h1>
			<p><strong class="bold">Morse code</strong> is a<a id="_idIndexMarker334"/> telecommunication technique used for encoding, receiving, and sending <strong class="bold">alphanumeric</strong> and <strong class="bold">special characters</strong> by applying signal sequences with different duration. Morse code is named after Samuel Morse, a telegraph inventor. This code is important because it was commonly used for radio and wired communication over long distances, in particular, for sending and receiving telegrams. Nowadays, Morse code is still used in amateur (<em class="italic">ham</em>) radio communications because it can be reliably decoded by people when electromagnetic atmospheric conditions are unfavorable. More importantly, Morse code can be used in an emergency by sending SOS messages in the form of light, audio, or electromagnetic signals. Morse code is still sometimes used in aviation as a radio navigation aid. </p>
			<p>Each character in Morse code is made with <code>-</code> symbol) and <code>.</code> symbol). A dot<a id="_idIndexMarker335"/> is one signal unit, and a dash<a id="_idIndexMarker336"/> is three signal units. Each alphabet letter, numerals, and special characters are encoded using a combination of dots and/or dashes. A space between letters is one signal unit (a dot), and a space between words is seven signal units. This code is generally transmitted on an information-carrying medium, for example, visible light and <a id="_idIndexMarker337"/>electromagnetic radio waves. The following is a list with the letters and numbers encoded using international Morse code:</p>
			<ul>
				<li>A (<code>.-</code>)</li>
				<li>B (<code>-...</code>)</li>
				<li>C (<code>-.-.</code>)</li>
				<li>D (<code>-..</code>)</li>
				<li>E (<code>.</code>)</li>
				<li>F (<code>..-.</code>)</li>
				<li>G (<code>- -.</code>)</li>
				<li>H (<code>....</code>)</li>
				<li>I (<code>..</code>)</li>
				<li>J (<code>.---</code>)</li>
				<li>K (<code>-.-</code>)</li>
				<li>L (<code>.-..</code>)</li>
				<li>M (<code>- -</code>)</li>
				<li>N (<code>-.</code>)</li>
				<li>O (<code>- - -</code>)</li>
				<li>P (<code>.- -.</code>)</li>
				<li>Q (<code>- -.-</code>)</li>
				<li>R (<code>.-.</code>)</li>
				<li>S (<code>. . .</code>)</li>
				<li>T (<code>-</code>)</li>
				<li>U (<code>..-</code>)</li>
				<li>V (<code>...-</code>)</li>
				<li>W (<code>.- -</code>)</li>
				<li>X (<code>-..-</code>)</li>
				<li>Y (<code>-.--</code>)</li>
				<li>Z (<code>- -..</code>)</li>
				<li>1 (<code>.- - - -</code>)</li>
				<li>2 (<code>..- - -</code>)</li>
				<li>3 (<code>...- -</code>)</li>
				<li>4 (<code>. . . . -</code>)</li>
				<li>5 (<code>. . . . .</code>)</li>
				<li>6 (<code>-. . . .</code>)</li>
				<li>7 (<code>- - . . .</code>)</li>
				<li>8 (<code>- - - . .</code>)</li>
				<li>9 (<code>- - - -.</code>)</li>
				<li>0 (<code>- - - - -</code>)</li>
			</ul>
			<p>Special characters, such as <code>$</code> and <code>#</code> and other characters from languages other than English, have also been encoded with <a id="_idIndexMarker338"/>Morse code, but showing them is beyond the scope of this chapter. For example, this is how we encode the word PARIS in Morse code: .- -.   .-   .-.   ..   ...</p>
			<p>This is another example. The word HELP can be codified as ….   .   .-..   .--.</p>
			<p>Another longer example is the word ALIVE: .-      .-..     ..     ...-     .</p>
			<p>A commonly used distress message encoded with Morse code is made up of the letters SOS. It is formed by three dots, three dashes, and three dots (<code>. . .  ---  . . .</code>). This message has been internationally applied and <a id="_idIndexMarker339"/>recognized by treaties, originally used for maritime emergency situations. Its origin is uncertain, but popular usage associates SOS with phrases such as <em class="italic">Save Our Ship</em> or <em class="italic">Save Our Souls</em>. Nonetheless, SOS is easy to remember and used in an emergency and is shorter than coding other words, such as <em class="italic">HELP</em>, in Morse code.</p>
			<p>In this chapter, we will use the <a id="_idIndexMarker340"/>SOS message to make a visual alarm, showing that message making the dots and dashes by turning on and off a super-bright LED with the Blue Pill and the Curiosity Nano boards.</p>
			<p>The next section describes a brief introduction to super-bright LEDs, and what type of resistor can be connected to them for our Morse code purposes.</p>
			<h1 id="_idParaDest-86"><a id="_idTextAnchor090"/>Introducing super-bright LEDs and calculating their necessary resistors</h1>
			<p>A <strong class="bold">super-bright LED</strong> is a <strong class="bold">light-emitting diode</strong> (<strong class="bold">LED</strong>) that glows with high intensity, higher than regular <a id="_idIndexMarker341"/>LEDs. LED brightness (light intensity) is calculated in <strong class="bold">millicandelas</strong> (<strong class="bold">mcd</strong>). Bear in mind that 1,000 mcd equals 1 candela. Candelas typically <a id="_idIndexMarker342"/>measure how much light is generated at the light source, in this case, an LED, but candelas can be used to measure other light sources, such as light bulbs. The super-bright LED that we use in this chapter is rated as 6,000 mcd, emitting a nice and powerful orange glow, which is quite bright when connected to a proper current-limiting resistor. In comparison, typical LEDs are rated at a range of about 50 to 200 mcd. </p>
			<p>Super-bright LEDs have a special design to increase light diffusion by using a transparent glass coating and reflective material. However, some super-bright LEDs have a reduced <strong class="bold">viewing angle</strong> (the observation angle with the LED light looks more intense) of about 35 degrees, such as the one we are using in this chapter, whereas the viewing angle of other regular and super-bright LEDs is 120%. This viewing angle depends on their cost, efficiency, and applications.</p>
			<p>As with regular LEDs, super-bright LEDs require a certain voltage to power them, typically between 2 and 3 volts. That's why we need to connect a current-limiting resistor to an LED to reduce its voltage. We can use the<a id="_idIndexMarker343"/> formula R=(Vs-Vf)/If for calculating a current-limiting resistor for an LED in the following cases:</p>
			<ul>
				<li><strong class="bold">Vs</strong> = supplied voltage. The Blue Pill and Curiosity Nano output ports provide 3.3 V.</li>
				<li><strong class="bold">Vf</strong> = forward voltage, which is the voltage that drops through a resistor.</li>
				<li><strong class="bold">If</strong> is the forward <strong class="bold">amperage</strong> (<strong class="bold">amps</strong>).</li>
				<li><strong class="bold">R</strong> is the resistor value that we want to calculate. </li>
			</ul>
			<p>A commonly used resistor value for connecting to LEDs is 1 k ohm. The drop voltage with that resistor is 1.8 V when applying a supply voltage of 3.3 volts and a current drawing 1.5 milliamps (or 0.0015 amps). Let's apply the preceding formula to confirm this resistor value:</p>
			<p><img src="img/B16413_06_001.png" alt=""/></p>
			<p>The resistor connected to a<a id="_idIndexMarker344"/> super-bright LED will determine the number of amps it will draw. Typical resistor values that are used for connecting to LEDs are 220, 330, and 1 k ohms when using either 3.3 V or 5 V as the supply voltage that many microcontroller boards supply. The resistor value is not critical in the majority of LED applications (unless you are connecting an LED to a Blue Pill microcontroller board, as you will see in the next section), so we can use other resistors with similar values. First of all, you can determine whether the super-bright LED works. Go to the <em class="italic">Testing the visual alarm</em> section at the end of this chapter.</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">Do not stare at a super-bright LED directly on top of it when it is turned on (glowing), as this may hurt your eyes. You can momentarily look at it from the side.</p>
			<p><em class="italic">Figure 6.1</em> shows the super-bright LED used in this chapter:</p>
			<div><div><img src="img/Figure_6.1_B16413.jpg" alt="Figure 6.1 – The BL-BJU334V-1 super-bright LED"/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.1 – The BL-BJU334V-1 super-bright LED</p>
			<p><em class="italic">Figure 6.1</em> depicts a BL-BJU334V-1 5 mm through-hole LED that emits bright orange light in the 625 nm wavelength. Its left pin is the anode (positive lead), and the right pin is the cathode (negative lead) which is the short one. There are other types of super-bright LEDs with higher brightness and sizes. We decided to use this one in particular for this chapter because is low cost and suitable for inserting it in a solderless breadboard and connecting it to a microcontroller board. The next section deals with the connection of a super-bright LED to the Blue Pill and Curiosity Nano boards.</p>
			<h1 id="_idParaDest-87"><a id="_idTextAnchor091"/>Connecting the resistor and the super-bright LED to the microcontroller board</h1>
			<p>This section shows how<a id="_idIndexMarker345"/> to use a super-bright <a id="_idIndexMarker346"/>LED connected to a microcontroller board to <a id="_idIndexMarker347"/>display a Morse code message. We begin by explaining how to connect a super-bright LED to one of the input ports of the Blue Pill and how to use a transistor as a switch to control the super-bright LED. Then, we describe how to connect the super-bright LED to the Curiosity Nano board.</p>
			<p><em class="italic">Figure 6.2</em> shows a Fritzing diagram containing a super-bright LED:</p>
			<div><div><img src="img/Figure_6.2_B16413.jpg" alt="Figure 6.2 – A super-bright LED connected to a Blue Pill's I/O port"/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.2 – A super-bright LED connected to a Blue Pill's I/O port</p>
			<p>As you can see from <em class="italic">Figure 6.2</em>, the super-bright LED's anode is connected to a 1 k ohm current-limiting resistor. The resistor is connected to output port B12, providing 3.3 V to it every time a dot or dash from a Morse code character is sent to it. The following are the steps for connecting all the components shown in <em class="italic">Figure 6.2</em>:</p>
			<ol>
				<li>Connect the 1 k ohm resistor to the Blue Pill's B12 port.</li>
				<li>Connect the resistor to the super-bright LED's anode pin (its longest leg, which is the left one shown in <em class="italic">Figure 6.1</em>).</li>
				<li>Connect<a id="_idIndexMarker348"/> the super-bright <a id="_idIndexMarker349"/>LED's cathode pin (its shortest leg) to the<a id="_idIndexMarker350"/> lower solderless breadboard's row ground.</li>
				<li>Connect the Blue Pill's GND pin to the solderless breadboard's lower rail.</li>
			</ol>
			<p>When doing those steps, be sure to connect the right LED polarity.</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">Do <em class="italic">not</em> connect a super-bright LED directly to the power supply, as you will damage it. You should connect a current-limiting resistor to its anode (the long LED leg).</p>
			<p>Each Blue Pill I/O port can handle up to 6 mA (milliamps). Be careful, because in some cases and configurations, a super bright LED could consume more than 6 mA of current. That's why we connected a 1 k ohm resistor to its anode to limit the current (and its voltage) arriving at the LED. If anything connected to a Blue Pill port is drawing more than 6 mA, you will damage the Blue Pill board.</p>
			<p>Before we connect everything to a Blue Pill microcontroller board port, we need to know how many amps in the I/O <strong class="bold">B12</strong> port are consumed by the LED to see whether it is below the maximum amps that the port can handle. The amps (current) consumed by the LED from <em class="italic">Figure 6.2</em> is calculated using the following formula:</p>
			<p><img src="img/B16413_06_002.png" alt=""/></p>
			<p>The following are the descriptions for the symbols:</p>
			<ul>
				<li>Vs = 3.3 V, which is the supplied voltage given by the output port generated when making the Morse code's dots and dashes.</li>
				<li>Vf = 1.8 V, which is the forward voltage that drops across the 1 k resistor (we measured it with a multimeter).</li>
				<li>R is the resistor value (1 k ohm).</li>
			</ul>
			<p>Thus, <img src="img/B16413_06_003.png" alt=""/>, or 1.5 milliamps, well below the maximum 6 mA that each Blue Pill port can handle, so we can safely use a 1 k ohm resistor for our super-bright LED if we connect it to a port that produces 3.3 V.</p>
			<p>It is important <a id="_idIndexMarker351"/>to note that the resistor value<a id="_idIndexMarker352"/> and the voltage arriving at the resistor<a id="_idIndexMarker353"/> from the port will determine the LED brightness. We could use a resistor with a lower value for making the LED glow brighter. For example, we could use a 220-ohm resistor. Its dropping voltage is 1.9 V (we measured it with a multimeter). Let's calculate its amperage (amps) using Vs = 3.3 V: I=(Vs-Vf)/R=(3.3-1.9)/220=6 mA, which is the limit amps that a Blue Pill port can handle. If we use a 220-ohm (or a lower value) resistor for connecting it to a super-bright LED, we should use a transistor working as a switch for protecting the Blue Pill port by not drawing current directly from it. <em class="italic">Figure 6.3</em> shows a Fritzing diagram with a 2N2222 transistor. It will close its <em class="italic">switch</em>, that is, connect its collector and emitter internally, when it receives a voltage to its base (transistor pin number 2), and thus connect the LED's cathode to the ground: </p>
			<div><div><img src="img/Figure_6.3_B16413.jpg" alt="Figure 6.3 – The super-bright LED switched on/off by the 2N2222 transistor"/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.3 – The super-bright LED switched on/off by the 2N2222 transistor</p>
			<p>As you can see from <em class="italic">Figure 6.3</em>, the LED is connected to a 220-ohm resistor that is connected to the Blue Pill's 3.3 V pin. This resistor draws the current from the Blue Pill's 3.3 pin, which handles up to 300 mA, and not from the B12 port handling up to 6 mA. Thus, the transistor controls the power flow to another part of the circuit switching the LED's ground. Every time the transistor receives a certain voltage at its base, it saturates and creates the binary on/off switch effect between its collector and emitter pins. We need to connect a resistor to its base to reduce its voltage and thus properly saturate it. A typical value for saturating the transistor used in this chapter is 1 k<a id="_idIndexMarker354"/> ohm when applying 3.3 V <a id="_idIndexMarker355"/>to it. The low-cost and popular transistor <a id="_idIndexMarker356"/>used in <em class="italic">Figure 6.3</em> has the part number 2N2222 (in a TO-92 package). This transistor handles up to 600 mA, enough to drive our super-bright LED. The following are the steps for connecting all the components shown in <em class="italic">Figure 6.3</em>:</p>
			<ol>
				<li value="1">Connect the Blue Pill's GND pin to the breadboard's upper row.</li>
				<li>Connect the 1 k ohm resistor to the Blue Pill's B12 port. </li>
				<li>Connect the 1 k ohm resistor to the 2N2222 transistor's base (pin number <strong class="bold">2</strong>).</li>
				<li>Connect the 2N2222 transistor's emitter (pin number <strong class="bold">1</strong>) to the ground (the breadboard's upper row).</li>
				<li>Connect the LED's cathode pin (its shortest leg) to the 2N2222's collector (pin number <strong class="bold">3</strong>).</li>
				<li>Connect the 220-ohm resistor to the LED's anode pin (its longest leg).</li>
				<li>Connect the 220-ohm resistor to Blue Pill's 3V3 (3.3) pin.</li>
			</ol>
			<p><em class="italic">Figure 6.4</em> shows the 2N2222 pinout:</p>
			<div><div><img src="img/Figure_6.4_B16413.jpg" alt="Figure 6.4 – The 2N2222 transistor pin numbers"/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.4 – The 2N2222 transistor pin numbers</p>
			<p><em class="italic">Figure 6.4</em> shows a 2N2222 transistor in its TO-92 package, showing its three pins. Pin 1 is its emitter, pin 2 is its base, and pin 3 is its collector. The N shown on the transistor means that the 2N2222 is an <a id="_idIndexMarker357"/>NPN-type transistor, an<a id="_idIndexMarker358"/> internal configuration composed of <a id="_idIndexMarker359"/>negative-positive-negative layers. That big N letter is not actually shown on commercial transistors; it appears only on the Fritzing diagram shown in <em class="italic">Figure 6.4</em>. Instead, commercial transistors show their part number on them.</p>
			<p><em class="italic">Figure 6.5</em> shows the electronic symbol for the transistor: </p>
			<div><div><img src="img/B16413_Figure_6.5.jpg" alt="Figure 6.5 – The transistor's electronic diagram (NPN type)"/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.5 – The transistor's electronic diagram (NPN type) </p>
			<p>As you can see from <em class="italic">Figure 6.5</em>, the symbol shows the 2N2222's pin numbers. This pin order will change in other types of transistors.</p>
			<p><em class="italic">Figure 6.6</em> shows how everything is connected:</p>
			<div><div><img src="img/Figure_6.6_B16413.jpg" alt="Figure 6.6 – Connecting the super-bright LED to a 2N2222 transistor"/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.6 – Connecting the super-bright LED to a 2N2222 transistor</p>
			<p><em class="italic">Figure 6.6</em> shows<a id="_idIndexMarker360"/> the 2N2222 transistor <a id="_idIndexMarker361"/>connected to the BluePill's ground <a id="_idIndexMarker362"/>and 3.3 (3.3 V) pins. The transistor is connected at the left of the super-bright LED. The next section deals with connecting the super-bright LED to the Curiosity Nano board using a resistor and a transistor. </p>
			<h2 id="_idParaDest-88"><a id="_idTextAnchor092"/>Connecting the super-bright LED to the Curiosity Nano</h2>
			<p>This section explains<a id="_idIndexMarker363"/> how to control the super-bright LED from<a id="_idIndexMarker364"/> the Curiosity Nano board to display the SOS Morse code message.</p>
			<p><em class="italic">Figure 6.7</em> is a Fritzing diagram showing how to connect a super-bright LED to the Curiosity Nano:</p>
			<div><div><img src="img/Figure_6.7_B16413.jpg" alt="Figure 6.7 – A super-bright LED connected to a Curiosity Nano's I/O port"/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.7 – A super-bright LED connected to a Curiosity Nano's I/O port</p>
			<p>As you<a id="_idIndexMarker365"/> can see in <em class="italic">Figure 6.7</em>, we use a 1 k ohm<a id="_idIndexMarker366"/> resistor to connect the super-bright LED, which is a similar circuit for the Blue Pill microcontroller board explained in a previous section. Here are the steps for connecting the components shown in <em class="italic">Figure 6.7</em>:</p>
			<ol>
				<li value="1">Connect the Curiosity Nano's RD3 pin to a 1 k ohm resistor.</li>
				<li>Connect the resistor to the super-bright LED's anode pin (its longest leg).</li>
				<li>Connect the super-bright LED's cathode pin (its shortest leg) to the Curiosity Nano's GND pin.</li>
			</ol>
			<p>Be aware that in theory, each of the Curiosity Nano I/O ports can handle up to 12.8 milliamps (500 milliamps/39 ports), and the Curiosity Nano's voltage regulator (VBUS) can handle up to 500 milliamps. This may change a bit with the ambient temperature, according to its manufacturer. We could make the LED glow brighter by connecting a lower-value resistor, or we could connect more than one LED to a port, but this will draw more current, potentially damaging the microcontroller board. Since each port cannot support a lot of current, we need to connect a transistor to switch the LED's ground. <em class="italic">Figure 6.8</em> shows how all the components are connected:</p>
			<div><div><img src="img/Figure_6.8_B16413.jpg" alt="Figure 6.8 – The super-bright LED switched on/off by the transistor, connected to the Curiosity Nano board"/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.8 – The super-bright LED switched on/off by the transistor, connected to the Curiosity Nano board</p>
			<p>As you can see<a id="_idIndexMarker367"/> in <em class="italic">Figure 6.8</em>, the resistor <a id="_idIndexMarker368"/>connected to the LED's anode pin is connected to the Curiosity Nano's VTG port that provides 3.3 V. These are the steps for connecting all the components:</p>
			<ol>
				<li value="1">Insert the Curiosity Nano, the 2N2222 transistor, and the super-bright LED to the solderless breadboard. </li>
				<li>Connect the transistor's pin 1 to the Curiosity Nano's ground (GND) pin.</li>
				<li>Connect the 1 k ohm resistor to Curiosity Nano's RD3 port.</li>
				<li>Connect the 1 k ohm resistor to the transistor's pin 2. </li>
				<li>Connect the super-bright LED's cathode (its shortest pin) to the transistor's pin 3. </li>
				<li>Connect the 220-ohm resistor to the super-bright LED's anode (its longest pin). </li>
				<li>Connect the 220-ohm resistor to Curiosity Nano's VTG pin.</li>
			</ol>
			<p><em class="italic">Figure 6.9</em> shows how everything is connected:</p>
			<div><div><img src="img/Figure_6.9_B16413.jpg" alt="Figure 6.9 – The transistor and the LED connected to the Curiosity Nano"/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.9 – The transistor and the LED connected to the Curiosity Nano</p>
			<p>As you<a id="_idIndexMarker369"/> can see from <em class="italic">Figure 6.9</em>, the 2N2222 transistor is<a id="_idIndexMarker370"/> switching the super-bright LED's ground.</p>
			<p>The next section describes how the SOS signal can be programmed on the Blue Pill and the Curiosity Nano boards.</p>
			<h1 id="_idParaDest-89"><a id="_idTextAnchor093"/>Coding the SOS Morse code signal</h1>
			<p>This section describes the<a id="_idIndexMarker371"/> code necessary for turning the LED for showing the SOS Morse signal, which runs on the Blue Pill board, on and off. The following code shows the main functions used for defining the SOS Morse code message and for sending it to the board's output port. The next code segment defines the necessary dot, dash, and space values, as well as the port label:</p>
			<pre>int led=PB12;
int dot_duration=150; 
int dash_duration=dot_duration*3; 
int shortspace_duration=dot_duration; 
int space_duration=dot_duration*7;</pre>
			<p>The next function <a id="_idIndexMarker372"/>sets up the output port (<code>B12</code>) for turning the LED on and off:</p>
			<pre>void setup() {
       pinMode (led,OUTPUT);
} </pre>
			<p>These functions define the letter S and O to be used in the SOS message:</p>
			<pre>void S() {
          dot();
          dot();
          dot();
          shortspace();
}
         
void O() {
          dash();
          dash();
          dash();
          shortspace();
}</pre>
			<p>The following functions<a id="_idIndexMarker373"/> define the time spaces in between the letters and the space in between each SOS message sent to the output port: </p>
			<pre>void shortspace() {
          delay(shortspace_duration);
} 
void space() {
          delay (space_duration);
} 
void dot() {
          digitalWrite(led,HIGH); 
          delay (dot_duration); 
          digitalWrite(led,LOW); 
          delay(dot_duration); 
}
        
void dash() {
          digitalWrite(led,HIGH); 
          delay(dash_duration); 
          digitalWrite(led,LOW); 
          delay(dash_duration); 
}</pre>
			<p>The following is the main<a id="_idIndexMarker374"/> function, which defines the SOS message and its leading time space:</p>
			<pre>void loop() {
          S(); O(); S();  
          space();  
}</pre>
			<p>The preceding code shows that the Blue Pill's <code>B12</code> port is used as an output for turning the super-bright LED on and off. In this example code, each dot has a duration of 150 milliseconds (stored in the <code>dot_duration</code> variable), and each dash has a duration of three times that of each dot. There is a short space of time in between each letter, made by the <code>shortspace()</code> function. Also, there is a time space in between each SOS word, made by the <code>space()</code> function. The letters S and O from the SOS Morse message are encoded by the functions <code>S()</code> and <code>O()</code>, respectively.</p>
			<p>Bear in mind that the<a id="_idIndexMarker375"/> code uploaded to the GitHub repository has many comments explaining most of the instructions from the preceding code.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">You can run the preceding code on an Arduino microcontroller board. Just change the output port number <code>PB12</code> to any Arduino digital port. For example, the Arduino Uno microcontroller board has digital ports <code>2</code> to <code>13</code>.</p>
			<p>The following section shows how to code the SOS message example on the Curiosity Nano board.</p>
			<h2 id="_idParaDest-90"><a id="_idTextAnchor094"/>The SOS message code for the Curiosity Nano</h2>
			<p>The<a id="_idIndexMarker376"/> SOS message code for the Curiosity Nano microcontroller <a id="_idIndexMarker377"/>board is similar to the one that runs on the Blue Pill board. The next code segment defines the necessary dot, dash, and space values:</p>
			<pre>#include "mcc_generated_files/mcc.h"
const int dot_duration=150; 
const int dash_duration=dot_duration*3; 
const int shortspace_duration=150; 
const int space_duration=dot_duration*7;         </pre>
			<p>The following functions define the time spaces in between the letters and the space in between each SOS message sent to the output port:</p>
			<pre>void shortspace() {
          __delay_ms(shortspace_duration);
} 
void space() {
         __delay_ms(space_duration);
} 
void dot() { 
          IO_RD3_SetHigh(); 
          __delay_ms(dot_duration); 
          IO_RD3_SetLow(); 
          __delay_ms(dot_duration); 
}        
void dash() { 
          IO_RD3_SetHigh();  
          __delay_ms(dash_duration); 
          IO_RD3_SetLow();
          __delay_ms(dash_duration); 
}</pre>
			<p>These <a id="_idIndexMarker378"/>functions define <a id="_idIndexMarker379"/>the letters S and O to be used in the SOS message:</p>
			<pre>void S() { 
          dot();
          dot();
          dot();
          shortspace();
}
void O() { 
          dash();
          dash();
          dash();
          shortspace();
}</pre>
			<p>The <a id="_idIndexMarker380"/>following is the<a id="_idIndexMarker381"/> <code>main</code> function, which defines the SOS message and its leading time space:</p>
			<pre>void main(void)
{
    SYSTEM_Initialize();
    IO_RD3_SetLow(); 
    while (1) 
    {
      S(); O(); S(); 
      space();
    }
}</pre>
			<p>As you can see from the preceding code, <code>RD3</code> is used as an output port for driving the 2N2222 transistor and therefore switching the LED on and off.</p>
			<p>Bear in mind that the code uploaded to the GitHub repository contains many comments explaining its main parts.</p>
			<p>The next section describes how can we test out a super-bright LED to see whether it works correctly, as well as testing the speed of the SOS message shown by the LED.</p>
			<h1 id="_idParaDest-91"><a id="_idTextAnchor095"/>Testing the visual alarm</h1>
			<p>In this section, we will<a id="_idIndexMarker382"/> focus on how to test the super-bright LED, as well as how to test the speed of the SOS message shown by the LED.</p>
			<p>You can test the super-bright LED to establish whether it works OK with a power supply, as shown in <em class="italic">Figure 6.10</em>:</p>
			<div><div><img src="img/Figure_6.10_B16413.jpg" alt="Figure 6.10 – Connecting the super-bright LED to a battery set"/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.10 – Connecting the super-bright LED to a battery set</p>
			<p>The following are the steps for connecting everything according to <em class="italic">Figure 6.10</em>:</p>
			<ol>
				<li value="1">Connect the super-bright LED's anode (its longest leg) to a 1 k ohm resistor.</li>
				<li>Connect the resistor to the battery set's positive terminal. The battery set should provide around 3 V (supplied by two AA batteries), which are enough for testing our super-bright LED.</li>
				<li>Connect the battery set's negative terminal to the super-bright LED's cathode (its shortest leg).</li>
			</ol>
			<p>After connecting<a id="_idIndexMarker383"/> everything as per the preceding steps, the LED should glow. If not, check the LED polarity, and whether the batteries have enough energy. Also check the connections. If the LED doesn't glow, it doesn't work and needs to be discarded.</p>
			<p>If you compare the brightness of a regular LED against the super-bright LED that we used in this chapter, you will notice that the regular LED glows more uniformly and more <strong class="bold">omnidirectional</strong>, whereas<a id="_idIndexMarker384"/> the super-bright LED has a viewing angle of 35 degrees, meaning that it will be brighter from its top rather than from its sides. Try it! Observe very briefly both LEDs from the side. Remember that you shouldn't stare at the super-bright LED perpendicularly (top view), as it may hurt your eyes.</p>
			<p>You can also test the speed <a id="_idIndexMarker385"/>of the SOS message. Change the value originally declared in the <code>dot_duration</code> variable in the preceding code for both the Blue Pill and Curiosity Nano. A smaller value will make the SOS message glow faster on the super-bright LED.</p>
			<h1 id="_idParaDest-92"><a id="_idTextAnchor096"/>Summary</h1>
			<p>In this chapter, we learned what a super-bright LED is and how we can connect it to a microcontroller board. We also reviewed how to use the super-bright LED as a powerful visual alarm, since it glows much more intensely than conventional LEDs. We also summarized what Morse code is, how it is used worldwide, and how to show the SOS Morse code message, which is used in visual alarms as a distress message, by turning on and off the super-bright LED connected to the Blue Pill and Curiosity Nano microcontroller boards. Connecting a super-bright LED is not straightforward, since we will need to know how much current it will draw, because the microcontroller boards' output ports can handle a very limited amount of current, in the order of a few milliamps. This chapter will be beneficial for readers who would like to control an LED in other electronic projects. It also points out the importance of carefully calculating the amps that are drawn by a super-bright LED and using the right resistor or transistor to connect to it, so as to avoid damaging the microcontroller board.</p>
			<p>The next chapter will focus on using a small microphone connected to a microcontroller board to detect two clapping sounds in a row to activate a process on a microcontroller board.</p>
			<h1 id="_idParaDest-93"><a id="_idTextAnchor097"/>Further reading</h1>
			<ul>
				<li>Choudhuri, K. B. R. (2017). <em class="italic">Learn Arduino Prototyping in 10 days</em>. Birmingham, UK: Packt Publishing Ltd.</li>
				<li>Gay, W. (2018). <em class="italic">Beginning STM32: Developing with FreeRTOS, libopencm3, and GCC</em>. New York, NY: Apress.</li>
				<li>Horowitz, P., Hill, W. (2015). <em class="italic">The Art of Electronics</em>. [3rd ed.] Cambridge University Press: New York, NY.</li>
				<li>Microchip (2019). <em class="italic">PIC16F15376 Curiosity Nano Hardware User Guide</em>. Microchip Technology, Inc. Available from: <a href="http://ww1.microchip.com/downloads/en/DeviceDoc/50002900B.pdf">http://ww1.microchip.com/downloads/en/DeviceDoc/50002900B.pdf</a>.</li>
				<li>2N2222 (2013). P2N2222A transistor datasheet. Semiconductor Component Industries, LLC. <a id="_idTextAnchor098"/>Available from: <p><a href="https://www.onsemi.com/pub/Collateral/P2N2222A-D.PDF">https://www.onsemi.com/pub/Collateral/P2N2222A-D.PDF</a>.</p></li>
				<li>LED (n.d.) BL-BJ33V4V-1 super-bright LED datasheet. Bright LED Electronics Corp. Available from: http://www.maxim4u.com/download.php?id=1304920&amp;pdfid=446ED6935162B290D3BC0AF8E0E068B8&amp;file=0168\bl-bj33v4v-1_4138472.pdf.</li>
			</ul>
		</div>
	</body></html>