# 前言

异步编程是构建高效、响应迅速且高性能软件的必要实践，尤其是在当今多核处理器和实时数据处理的世界。本书深入探讨了掌握 C++异步编程的原则和实践技术，为你提供处理从线程管理到性能优化所需的知识。

开发异步软件有几个关键支柱：

+   线程管理和同步

+   异步编程的概念、模型和库

+   调试、测试和优化多线程和异步软件

尽管许多资源专注于并行编程的基础或通用软件开发，但本书旨在对这些支柱进行全面探索。它涵盖了管理并发、调试复杂系统和优化软件性能的基本技术，同时将这些概念建立在现实世界场景的基础上。

我们将通过以下基于实际案例的各个方面来引导你了解异步编程：

+   我们在开发高性能软件方面的丰富经验

+   从金融到研究中心等不同行业的工作中学到的最佳实践

随着多核处理器和并行计算架构在现代应用中变得越来越重要，对异步编程专家的需求正在迅速增长。掌握本书中涵盖的技术将帮助你不仅应对当今复杂的软件开发挑战，而且为性能关键型软件的未来进步做好准备。

无论你是处理低延迟金融系统、开发高吞吐量应用，还是仅仅想提高你的编程技能，本书都将为你提供成功所需的工具和知识。

# 本书面向的对象

本书是为寻求深化使用最新 C++版本理解异步编程并优化软件性能的软件工程师、开发人员和技术负责人而设计的。主要目标受众包括：

+   **软件工程师** *:* 希望提高 C++技能并获得多线程、异步编程、调试和性能优化实用见解的人。

+   **技术负责人** *:* 致力于实施高效异步系统的领导者将找到管理复杂软件开发和提升团队生产力的策略和最佳实践 *.*

+   **学生和爱好者** *:* 渴望了解高性能计算和异步编程的个人将受益于全面解释和示例，帮助他们提升在技术领域的职业生涯。

本书将赋予读者应对现实世界挑战和出色完成技术面试的能力，为他们提供在当今快速发展的软件领域中茁壮成长的知识。

# 本书涵盖的内容

*第一章* ，*并行编程范式*，探讨了构建并行系统的不同架构和模型，以及各种并行编程范式及其性能指标。

*第二章* ，*进程、线程和服务*，深入探讨了操作系统中的进程，考察了它们的生命周期、进程间通信以及线程的作用，包括守护进程和多线程。

*第三章* ，*如何在 C++中创建和管理线程*，指导如何创建和管理线程，传递参数，检索结果，并处理异常以确保在多线程环境中的高效执行。

*第四章* ，*使用锁进行线程同步*，解释了 C++标准库同步原语的使用，包括互斥锁和条件变量，同时解决竞态条件、死锁和活锁问题。

*第五章* ，*原子操作*，探讨了 C++原子类型、内存模型以及如何实现基本的 SPSC 无锁队列，为未来的性能提升做准备。

*第六章* ，*承诺和未来*，介绍了异步编程概念，包括承诺、未来和包装任务，并展示了如何使用这些工具解决现实生活中的问题。

*第七章* ，*异步函数*，探讨了**std::async**执行异步任务的功能，定义启动策略，处理异常，并优化性能。

*第八章* ，*使用协程进行异步编程*，描述了 C++协程、它们的基本要求以及如何实现生成器和解析器，同时处理协程内的异常。

*第九章* ，*使用 Boost.Asio 进行异步编程*，解释了如何使用 Boost.Asio 管理与外部资源相关的异步任务，重点关注 I/O 对象、执行上下文和事件处理。

*第十章* ，*使用 Boost.Cobalt 实现协程*，探讨了如何轻松地使用 Boost.Cobalt 库实现协程，避免低级复杂性，并专注于函数式编程需求。

*第十一章* ，*异步软件的日志记录和调试*，解释了如何有效地使用日志和调试工具来识别和解决异步应用程序中的问题，包括死锁和竞态条件。

*第十二章* ，*异步软件的清理和测试*，探讨了如何使用清理器对多线程代码进行清理，并探讨了使用 GoogleTest 库针对异步软件的定制测试技术。

*第十三章* ，*提高异步软件性能*，检查性能测量工具和技术，包括高分辨率计时器、缓存优化以及避免虚假和真实共享的策略。

# 要充分利用这本书

您需要具备使用 C++进行编程的先前经验以及如何使用调试器查找错误。由于我们使用 C++20 功能，在某些示例中使用 C++23，您需要安装 GCC 14 和 Clang 18。所有源代码示例已在 Ubuntu 和 macOS 上测试，但由于它们是平台无关的，它们应该可以在任何平台上编译和运行。

| **本书涵盖的软件/硬件** | **操作系统要求** |
| --- | --- |
| C++20 和 C++23 | Linux（在 Ubuntu 24.04 上测试） |
| GCC 14.2 | macOS（在 macOS Sonoma 14.x 上测试） |
| Clang 18 | Windows 11 |
| Boost 1.86 |  |
| GDB 15.1 |  |

每章都包含一个*技术要求*部分，突出显示安装编译章节示例所需工具和库的相关信息。

**如果您正在使用这本书的数字版，我们建议您亲自输入代码或从书的 GitHub 仓库（下一节中有一个链接）获取代码。这样做将帮助您避免与代码的复制和粘贴相关的任何潜在错误。**

# 下载示例代码文件

您可以从 GitHub（[`github.com/PacktPublishing/Asynchronous-Programming-with-CPP`](https://github.com/PacktPublishing/Asynchronous-Programming-with-CPP)）下载这本书的示例代码文件。如果代码有更新，它将在 GitHub 仓库中更新。

我们还有其他来自我们丰富的书籍和视频目录的代码包可供在[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)找到。查看它们吧！

# 使用的约定

本书使用了多种文本约定。

**文本中的代码**：表示文本中的代码单词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 昵称。以下是一个示例：“上面的代码生成一个正态分布的随机数向量，然后使用**std::sort()**和**std::stable_sort()**对向量进行排序。”

代码块设置如下：

```cpp
#include <iostream>
#include <thread>
int main() {
    std::thread t1([]() {
        for (int i = 0; i < 100; ++i) {
            std::cout << "1 " << "2 " << "3 " << "4 "
                      << std::endl;
        }
    });
```

任何命令行输入或输出都应如下编写：

```cpp
$ clang++ -O0 -g -fsanitize=address -fno-omit-frame-pointer test.cpp –o test
$ ASAN_OPTIONS=suppressions=myasan.supp ./test
```

提示或重要注意事项

看起来像这样。

# 联系我们

我们始终欢迎读者的反馈。

**一般反馈**：如果您对本书的任何方面有疑问，请通过电子邮件发送至 customercare@packtpub.com，并在邮件主题中提及书名。

**勘误**：尽管我们已经尽最大努力确保内容的准确性，但错误仍然可能发生。如果你在这本书中发现了错误，我们非常感谢你向我们报告。请访问[www.packtpub.com/support/errata](http://www.packtpub.com/support/errata)并填写表格。

**盗版**：如果你在互联网上以任何形式遇到我们作品的非法副本，我们非常感谢你提供位置地址或网站名称。请通过版权@packt.com 与我们联系，并提供材料的链接。

**如果你有兴趣成为作者**：如果你在某个领域有专业知识，并且你感兴趣的是撰写或为书籍做出贡献，请访问[authors.packtpub.com](http://authors.packtpub.com)。

# 分享你的想法

一旦你阅读了《使用 C++进行异步编程》，我们非常乐意听到你的想法！请[点击此处直接访问此书的亚马逊评论页面](https://packt.link/r/1835884253)并分享你的反馈。

你的评论对我们和科技社区非常重要，并将帮助我们确保我们提供高质量的内容。

# 下载此书的免费 PDF 副本

感谢购买此书！

你喜欢在旅途中阅读，但无法随身携带你的印刷书籍吗？

你的电子书购买是否与你的选择设备不兼容？

不要担心，现在，随着每本 Packt 书籍，你都可以免费获得该书的 DRM 免费 PDF 版本。

在任何地方、任何时间、任何设备上阅读。直接从你最喜欢的技术书籍中搜索、复制和粘贴代码到你的应用程序中。

优惠不会就此停止，你还可以获得独家折扣、时事通讯和每日收件箱中的精彩免费内容。

按照以下简单步骤获取好处：

1.  扫描下面的二维码或访问以下链接

![img](img/B22219_QR_Free_PDF.jpg)

[`packt.link/free-ebook/9781835884249`](https://packt.link/free-ebook/9781835884249)

1.  提交你的购买证明

1.  就这些！我们将直接将你的免费 PDF 和其他好处发送到你的电子邮件。

# 第一部分：并行编程和进程管理基础

在这部分，我们深入探讨构成并行编程和进程管理的基石性的基本概念和范式。你将深入理解用于构建并行系统的架构，并探索用于开发高效并行、多线程和异步软件的各种编程范式。此外，我们还将涵盖与进程、线程和服务相关的关键概念，强调它们在操作系统中的重要性，特别是在进程生命周期、性能和资源管理方面。

本部分包含以下章节：

+   *第一章* ，*并行编程范式*

+   *第二章* ，*进程、线程和服务*
