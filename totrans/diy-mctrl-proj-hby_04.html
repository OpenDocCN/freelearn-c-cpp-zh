<html><head></head><body>
		<div><h1 id="_idParaDest-52"><em class="italic"><a id="_idTextAnchor053"/>Chapter 4</em>: Measuring the Amount of Light with a Photoresistor</h1>
			<p>This chapter focuses on how to connect a <strong class="bold">photoresistor</strong>, an electronic component that measures the amount of light from the environment, to an input port of both the Blue Pill and Curiosity Nano microcontroller boards. In this chapter's exercise, we will analyze with a photoresistor whether a plant receives enough light.</p>
			<p>In this chapter, we are going to cover the following main topics:</p>
			<ul>
				<li>Understanding sensors</li>
				<li>Introducing photoresistors</li>
				<li>Connecting a photoresistor to a microcontroller board port</li>
				<li>Coding the photoresistor values and setting up ports</li>
				<li>Testing the photoresistor</li>
			</ul>
			<p>By the end of this chapter, you will have learned how to connect an analog sensor to a microcontroller board, and how to analyze analog data obtained from a photoresistor. The knowledge and experience learned in this chapter will be useful in other chapters that require the use of a sensor.</p>
			<h1 id="_idParaDest-53"><a id="_idTextAnchor054"/>Technical requirements</h1>
			<p>The software tools that you will be using in this chapter are the Arduino IDE and the MPLAB-X for editing and uploading your programs to the Blue Pill and the Curiosity Nano boards, respectively.</p>
			<p>The code used in this chapter can be found in the book's GitHub repository here:</p>
			<p><a href="https://github.com/PacktPublishing/DIY-Microcontroller-Projects-for-Hobbyists/tree/master/Chapter04">https://github.com/PacktPublishing/DIY-Microcontroller-Projects-for-Hobbyists/tree/master/Chapter04</a></p>
			<p>The Code in Action video for this chapter can be found here: <a href="https://bit.ly/3gNY4bt">https://bit.ly/3gNY4bt</a></p>
			<p>In this chapter, we will also use the following pieces of hardware:</p>
			<ul>
				<li>A solderless breadboard.</li>
				<li>The Blue Pill and Curiosity Nano microcontroller boards.</li>
				<li>A micro-USB cable for connecting your microcontroller boards to a computer.</li>
				<li>The ST-Link/V2 electronic interface needed for uploading the compiled code to the Blue Pill. Bear in mind that the ST-Link/V2 requires four female-to-female DuPont wires.</li>
				<li>A green, yellow, and red LED.</li>
				<li>Three 220-ohm resistors rated at one-quarter watt. These resistors are for the 3 LEDs.</li>
				<li>One 220-ohm resistor rated at one-quarter watt for the photoresistor connected to the Curiosity Nano.</li>
				<li>One 10 K ohm resistor, rated at one-quarter watt.</li>
				<li>A <strong class="bold">photoresistor sensor module</strong>.</li>
				<li>Three male-to-female DuPont wires for connecting the sensor module to the solderless breadboard.</li>
				<li>A dozen male-to-male DuPont wires for connecting the resistor and the push button to the breadboard and the microcontroller boards.</li>
			</ul>
			<p>The next section describes a brief introduction to photoresistors, their electrical characteristics, and how they are used in electronic projects.</p>
			<h1 id="_idParaDest-54"><a id="_idTextAnchor055"/>Understanding sensors</h1>
			<p>In this section, we <a id="_idIndexMarker231"/>explain what sensors are and the importance of sensor modules. It is important to understand first what sensors are and what their purpose is before you use them in practical microcontroller board applications, for example, using photoresistors, which are a useful type of sensor. This information about sensors is essential for further sections.</p>
			<h2 id="_idParaDest-55"><a id="_idTextAnchor056"/>Defining sensors</h2>
			<p>A <strong class="bold">sensor</strong> is an<a id="_idIndexMarker232"/> electronic component, device, or module that measures physical input from an environment or a particular situation (for example, a sensor measuring water temperature in a fish tank). Sensors are useful for detecting changes in physical variables, such as humidity, temperature, light, vibrations, and movement, among others. Those physical variations are manifested in the sensors by changing their electric/electronic properties, such as changes in resistance and conductivity in the sensors.</p>
			<p>There are different types <a id="_idIndexMarker233"/>of sensors with different applications. For example, motion sensors can detect human or pet movements when they pass across the sensor's field of view. If this sensor detects motion, it sends a signal to a computer or microcontroller board and then the board should do something about it, such as open an automatic door, set off an alarm, turn on a lightbulb, and so on. Other types of sensors include infrared, ultrasonic, temperature, pressure, and touch sensors.</p>
			<h2 id="_idParaDest-56"><a id="_idTextAnchor057"/>What are sensor modules?</h2>
			<p>A sensor can be part of a <a id="_idIndexMarker234"/>small electronic circuit called a <strong class="bold">sensor module</strong>. It contains other electronic components besides a sensor, such as resistors, transistors, LEDs, and integrated circuits, among others. The purpose of those extra components in a sensor module is to support and facilitate the reading, analysis, and transmission of signals coming from a sensor. Some sensor modules convert analog to digital data. Analog data are voltage variations, that is, analog to physical variables from an environment. For example, 0.5 volts obtained from a temperature sensor could be equivalent to 25 degrees Celsius. Digital data coming from a sensor module can contain either logical-level <em class="italic">HIGH</em> or logical-level <em class="italic">LOW</em> values.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">Voltages representing digital logic levels change depending on the microcontroller board that you are using. The I/O ports from both the Blue Pill and Curiosity Nano microcontroller boards use 3.3 volts, which is equivalent to logical-level HIGH. Logical-level LOW is equivalent to 0 volts.</p>
			<p>An analog signal from a sensor is sent electronically via a wire or a wireless communication medium (for example, Bluetooth) to a microcontroller board, which will process it, and then do something about it, as shown in <em class="italic">Figure 4.1</em>:</p>
			<div><div><img src="img/Figure_4.1_B16413.jpg" alt="Figure 4.1 – A temperature sensor connected to the microcontroller board's port"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.1 – A temperature sensor connected to the microcontroller board's port</p>
			<p>The data coming from the sensor (displayed in the diagram from <em class="italic">Figure 4.1</em>) is read by the microcontroller board's input port. This data can be adapted and shown to be human-readable (for example, showing the temperature numerically in a display as degrees Celsius or Fahrenheit). The same happens<a id="_idIndexMarker235"/> with analog and/or digital signals coming from a sensor module. Its data is sent to a microcontroller board port or ports via a wired or wireless medium.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">Microcontroller boards' ports can be set up as either input or output ports via coding. Please refer to <a href="B16413_02_Final_NM_ePub.xhtml#_idTextAnchor029"><em class="italic">Chapter 2</em></a>, <em class="italic">Software Setup and C Programming for Microcontroller Boards</em>, on how to program them.</p>
			<p>The next section focuses on photoresistors, a commonly used type of sensor, describing their function, representation, and applications.</p>
			<h1 id="_idParaDest-57"><a id="_idTextAnchor058"/>Introducing photoresistors</h1>
			<p>This section introduces you to photoresistors, which are very useful for many applications, for example, for measuring the amount of light. In this chapter, we will define what photoresistors are, their classification, and how they are connected to an electronic circuit.</p>
			<p>A <strong class="bold">photoresistor</strong> is an <a id="_idIndexMarker236"/>electronic component made with light-sensitive material, changing its resistance according to the amount of visible light that it detects. There are different types of photoresistors. Some of them detect <strong class="bold">ultraviolet</strong> (<strong class="bold">UV</strong>) light and others detect infrared light. The latter is used in TV sets, where its infrared light sensor receives data from a remote control. <em class="italic">Figure 4.2</em> shows a common photoresistor used in the examples of this chapter. The photoresistor used in this chapter detects regular light that humans can see. It does not detect infrared nor UV light.</p>
			<div><div><img src="img/Figure_4.2_B16413.jpg" alt="Figure 4.2 – A typical photoresistor"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.2 – A typical photoresistor</p>
			<p>From <em class="italic">Figure 4.2</em>, you can see that the photoresistor has two pins (also called legs). They are connected to an electronic circuit similar to regular resistors, so photoresistors do not have polarity. They work as a regular resistor that changes its resistance according to the amount of light it receives through its<a id="_idIndexMarker237"/> transparent cover. Here are some technical specifications of the photoresistor:</p>
			<ul>
				<li>Size: 5mm diameter (width)</li>
				<li>Range of resistance: 200 K ohms (dark) to typically 5 K to 10 K ohms and nearly 0 ohms when it receives full brightness.</li>
				<li>Power supply: Up to 100V, using less than 1 milliamp of current on average, depending on the power supply voltage. </li>
			</ul>
			<p><em class="italic">Figure 4.3</em> shows an electrical diagram containing a photoresistor and how it can be connected to a microcontroller board.</p>
			<div><div><img src="img/Figure_4.3_B16413.jpg" alt="Figure 4.3 – Electrical diagram with a photoresistor"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.3 – Electrical diagram with a photoresistor</p>
			<p>As you can <a id="_idIndexMarker238"/>see in <em class="italic">Figure 4.3</em>, a photoresistor's electrical symbol is represented with a circle and some incoming arrows indicating that light rays are hitting the photoresistor's surface. The photoresistor is connected to the power supply to a <strong class="bold">Ground</strong> pin from a microcontroller board and the other pin is connected to a voltage pin (<strong class="bold">Vcc</strong>) and an <strong class="bold">Input port</strong> from a microcontroller board. That is one way to connect a photoresistor. The <strong class="bold">10K ohm</strong> resistor works as a pull-down resistor. This is because the input port where the photoresistor is connected to at some point will receive zero volts when the photoresistor is not receiving any light. Remember that we should not leave an input pin without connecting to anything, otherwise its state will be floating (inputting random voltages).</p>
			<p class="callout-heading">Note</p>
			<p class="callout">The photoresistor should be connected to an analog input port from the microcontroller board since the port will receive a changing analog voltage from the photoresistor because the resistance presented at the photoresistor will change according to the amount of light received by the photoresistor.</p>
			<p>The next section explains how to connect and use photoresistors in both the Blue Pill and Curiosity Nano boards to measure the amount of light in an environment.</p>
			<h1 id="_idParaDest-58"><a id="_idTextAnchor059"/>Connecting a photoresistor to a microcontroller board port</h1>
			<p>This section <a id="_idIndexMarker239"/>shows how to connect a <a id="_idIndexMarker240"/>photoresistor to the Blue Pill and the Curiosity Nano boards to <em class="italic">read</em> the amount of light from an environment (for example, a living room).</p>
			<p>In this section, we also explain how to use three LEDs to indicate that a room is well illuminated by turning a green LED on, that the light is dim by turning a yellow LED on, or that it is dark by turning a red LED on. The electronic circuit with the photoresistor sensor can be placed close to a plant and the circuit can be useful to know whether a plant needs more light or not. The next section shows how to build the circuit with the Blue Pill board.</p>
			<h2 id="_idParaDest-59"><a id="_idTextAnchor060"/>Connecting a photoresistor to a Blue Pill board</h2>
			<p>The connection of<a id="_idIndexMarker241"/> a photoresistor sensor to a Blue Pill microcontroller <a id="_idIndexMarker242"/>board is simple. It can be directly connected to an input analog port, provided that you use a pull-down resistor. The circuit shown in <em class="italic">Figure 4.4</em> describes how to do it, and it is based on the electrical diagram from <em class="italic">Figure 4.3</em>.</p>
			<div><div><img src="img/Figure_4.4_B16413.jpg" alt="Figure 4.4 – The LEDs and photoresistor connected to a Blue Pill board"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.4 – The LEDs and photoresistor connected to a Blue Pill board</p>
			<p>As you can see in <em class="italic">Figure 4.4</em>, the three LEDs will show the amount of light detected by the photoresistor. The following are the steps for connecting the components to the Blue Pill board:</p>
			<ol>
				<li value="1">Connect the Curiosity Nano's GND pins to the upper and lower rails, of the solderless breadboard, as shown in <em class="italic">Figure 4.4</em>.</li>
				<li>Connect one pin of the photoresistor to the microcontroller board's ground pin labeled <strong class="bold">3V3</strong>.</li>
				<li>Connect the other pin of the photoresistor to the Blue Pill's pin labeled <strong class="bold">B1</strong>. <strong class="bold">B1</strong> will be used as an analog input port.</li>
				<li>Connect a <strong class="bold">10K ohm</strong> resistor to the ground and to the photoresistor's leg that is connected to input port <strong class="bold">B1</strong> of the Blue Pill.</li>
				<li>Now, connect the resistors to the output ports <strong class="bold">B12</strong>, <strong class="bold">B14</strong>, and <strong class="bold">B15</strong> of the Blue Pill.</li>
				<li>As the last step, connect the green, yellow, and red LEDs' anodes to the three resistors and then connect the LEDs' cathodes to the ground.</li>
			</ol>
			<p>The 3V3 pin from the <a id="_idIndexMarker243"/>Blue Pill provides 3.3 volts, which are enough <a id="_idIndexMarker244"/>for applying voltage (feeding) to the photoresistor.</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">Do not apply <strong class="bold">5 volts</strong> (<strong class="bold">5V</strong>) to the Blue Pill's input ports, because you may damage the Blue Pill. That's why you will connect the 3V3 voltage pin to the photoresistor, so it will provide up to 3.3 volts as an analog voltage output and the Blue Pill will use up that voltage to measure the amount of light. Remember that the voltage coming from the photoresistor will change according to its resistance.</p>
			<p>We are connecting a <strong class="bold">10K ohm</strong> pull-down resistor to the Blue Pill's input port <strong class="bold">B1</strong>, as shown in <em class="italic">Figure 4.4</em>, forcing the port to have a 0-volt input when there's no voltage coming from the photoresistor. Remember that the input ports should receive some voltage or even 0 volts to avoid random voltages.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">You may want to try a different value for the pull-down 10K ohm resistor connected to the Blue Pill, shown in<em class="italic"> Figure 4.4</em>, depending on the light level range that you would like to detect.</p>
			<p><em class="italic">Figure 4.5</em> shows how all the components are connected to the microcontroller board. This circuit is based on the Fritzing diagram shown in <em class="italic">Figure 4.4</em>.</p>
			<div><div><img src="img/Figure_4.5_B16413.jpg" alt="Figure 4.5 – Connecting the photoresistor and the LEDs to the Blue Pill"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.5 – Connecting the photoresistor and the LEDs to the Blue Pill</p>
			<p>As you can see<a id="_idIndexMarker245"/> in <em class="italic">Figure 4.5</em>, the photoresistor is connected<a id="_idIndexMarker246"/> to the Blue Pill's port B1. The green LED is turning on, meaning that the amount of light that the plant is receiving should be OK. Remember that you will need to connect the ST-Link/V2 electronic interface to the Blue Pill in order to upload the program to it from the Arduino IDE, as explained in <a href="B16413_01_Final_NM_ePub.xhtml#_idTextAnchor014"><em class="italic">Chapter 1</em></a>, <em class="italic">Introduction to Microcontrollers and Microcontroller Boards</em>.</p>
			<p>In this section, you learned how to connect an easy-to-use photoresistor to the Blue Pill board and how to show its values through LEDs.</p>
			<p>The next section describes how to code the photoresistor example shown in <em class="italic">Figure 4.4</em> and <em class="italic">Figure 4.5</em>.</p>
			<h1 id="_idParaDest-60"><a id="_idTextAnchor061"/>Coding the photoresistor values and setting up ports</h1>
			<p>This <a id="_idIndexMarker247"/>section shows<a id="_idIndexMarker248"/> how to code a Blue Pill application for reading data from a photoresistor.</p>
			<p>The following code should run on the microcontroller board circuit shown in <em class="italic">Figure 4.4</em> and <em class="italic">Figure 4.5</em>:</p>
			<pre>int photoresistorPin = PB1;
int photoresistorReading;
void setup(void) {
    pinMode(PB12, OUTPUT); 
    pinMode(PB14, OUTPUT); 
    pinMode(PB15, OUTPUT); 
}
void loop(void) {
    photoresistorReading = analogRead(photoresistorPin); 
    digitalWrite(PB12, LOW);
    digitalWrite(PB14, LOW);
    digitalWrite(PB15, LOW);
    if (photoresistorReading &lt; 600) { 
        digitalWrite(PB15, HIGH);
    } else if (photoresistorReading &lt; 1000) {  
        digitalWrite(PB14, HIGH);
    } else {
        digitalWrite(PB12, HIGH);  
  }
  delay(500);
}</pre>
			<p>As you can <a id="_idIndexMarker249"/>see from the code, one of<a id="_idIndexMarker250"/> its most important functions is this one: <code>analogRead(photoresistorPin);</code>. Internally, that function will perform an <code>pinMode()</code> function to declare the PB12, PB14, and PB15 ports as outputs.</p>
			<p>The code can be <a id="_idIndexMarker251"/>downloaded from the book's GitHub repository. Its filename is <code>photoresistor_bluepill.ino</code>. The code from the repository contains useful comments explaining the functions and variables used in it.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">You can run the same code for the Blue Pill on Arduino microcontroller boards such as the Arduino Uno. Just change the Blue Pill's input port PB1 for the Arduino's analog port 0 (it is labeled as A0 on the Arduino Uno), and change the Blue Pill's output ports PB12, PB14, and PB15 for the Arduino digital ports 8, 9, and 10. You may also need to change the values (thresholds) for the decisions from the code.</p>
			<p>The following section describes how to connect the LEDs and a photoresistor to the Curiosity Nano microcontroller board, following the example from the Blue Pill board.</p>
			<h2 id="_idParaDest-61"><a id="_idTextAnchor062"/>Connecting a photoresistor to a Curiosity Nano board</h2>
			<p>Following the Blue Pill <a id="_idIndexMarker252"/>example from the previous section, we<a id="_idIndexMarker253"/> can show the amount of light in an environment by turning on LED lights using the Curiosity Nano microcontroller board, as depicted in <em class="italic">Figure 4.6</em>.</p>
			<div><div><img src="img/Figure_4.6_B16413.jpg" alt="Figure 4.6 – The LEDs and photoresistor connected to a Blue Pill board"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.6 – The LEDs and photoresistor connected to a Blue Pill board</p>
			<p>As it is shown in <em class="italic">Figure 4.6</em>, the three LEDs will be used to show the amount of light detected by the photoresistor. The following are the steps for connecting the components to the Curio<a id="_idTextAnchor063"/>sity Nano board:</p>
			<ol>
				<li value="1">Connect the <a id="_idIndexMarker254"/>Curiosity Nano's GND pins to the <a id="_idIndexMarker255"/>upper and lower rails of the solderless breadboard, as shown in <em class="italic">Figure 4.6</em>.</li>
				<li>Connect one pin of the photoresistor to the Curiosity Nano's pin labeled VTG. This pin provides 3.3 volts.</li>
				<li>Connect the other pin of the photoresistor to the Curiosity Nano's pin labeled RA0. RA0 will be used as an analog input port.</li>
				<li>Connect a 220-ohm resistor to the ground and to the photoresistor's leg that is connected to port RA0. This will be a pull-down resistor.</li>
				<li>Now, connect the 220-ohm resistors to ports RD1, RD2, and RD3 and to the anodes of the 3 LEDs, respectively.</li>
				<li>As the last step, connect the LEDs' cathodes to the ground.</li>
			</ol>
			<p>We are connecting a 220-ohm pull-down resistor to the Curiosity Nano's input port, as shown in <em class="italic">Figure 4.6</em>, forcing the port to have a 0-volt input when there's no voltage coming from the photoresistor. Remember that the input ports should receive some voltage or even 0 volts to avoid random voltages.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">You may want to try a different value for the pull-down 220-ohm resistor shown in<em class="italic"> Figure 4.6</em>, depending on the light level range that you would like to detect.</p>
			<p>The photoresistor from <em class="italic">Figure 4.6</em> will change its resistance according to the amount of light that it receives from the environment, thus the voltage that passes through it will change. These voltage differences will be read by a microcontroller board's input port. Our code running on the microcontroller board will then compare the analog voltage values and determine whether the light is very low, normal, or too bright by turning on the yellow, green, or red LEDs respectively.</p>
			<p>The next code shows how <a id="_idIndexMarker256"/>to read the photoresistor values through<a id="_idIndexMarker257"/> the analog port RA0:</p>
			<pre>#include &lt;xc.h&gt;
#include &lt;stdio.h&gt;
#include "mcc_generated_files/mcc.h"
static uint16_t reading_photoresistor=0;
void main(void)
{
    SYSTEM_Initialize(); 
    ADC_Initialize();
    while (1)
    {
        IO_RD1_SetLow();
        IO_RD2_SetLow();
        IO_RD3_SetLow();
        reading_photoresistor =            ADC_GetConversion(channel_ANA0); 
        if (reading_photoresistor&gt;=0 &amp;&amp;                 reading_photoresistor &lt;=128)
        {
            IO_RD1_SetHigh();
        } else if (reading_photoresistor&gt;= 129 &amp;&amp;                    reading_photoresistor&lt;=512)
        {
            IO_RD2_SetHigh();
        } else
        {
            IO_RD3_SetHigh();
        }
        __delay_ms(200); 
    } 
}</pre>
			<p>Please bear in <a id="_idIndexMarker258"/>mind that the code uploaded to the book's<a id="_idIndexMarker259"/> GitHub online repository has many comments explaining almost all its instructions. In the preceding code, one of the most important functions is <code>ADC_GetConversion(channel_ANA0);</code>, which reads the voltage changes from the photoresistor and performs the analog to digital conversion of those values. <code>channel_ana0</code> is a label given to port RA0.</p>
			<p>The code can be downloaded from the book's GitHub repository. Its filename is <code>Chapter4_Curiosity_Nano_code_project.zip</code>. The code from the repository contains useful comments explaining the functions and variables used in it.</p>
			<p><em class="italic">Figure 4.7</em> shows how the photoresistor and the LEDs are connected to the Curiosity Nano's ports. The circuit shown in <em class="italic">Figure 4.7</em> is based on the Fritzing diagram shown in <em class="italic">Figure 4.6</em>.</p>
			<div><div><img src="img/Figure_4.7_B16413.jpg" alt="Figure 4.7 – Connecting the photoresistor and the LEDs to the Curiosity Nano"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.7 – Connecting the photoresistor and the LEDs to the Curiosity Nano</p>
			<p>As you can see<a id="_idIndexMarker260"/> in <em class="italic">Figure 4.7</em>, the photoresistor is connected to<a id="_idIndexMarker261"/> the Curiosity Nano's port RA0. The green LED is turning on in the figure, meaning that the amount of light that the plant is receiving should be OK.</p>
			<p>The next section shows how to obtain analog data about the amount of light from an environment using a photoresistor sensor module.</p>
			<h2 id="_idParaDest-62"><a id="_idTextAnchor064"/>Connecting a photoresistor sensor module to the microcontroller boards</h2>
			<p>This section explains <a id="_idIndexMarker262"/>how to use a photoresistor <a id="_idIndexMarker263"/>sensor module for measuring the amount of light from an environment. This module can be bought separately or as part of a sensors kit from many online sources. The photoresistor sensor module contains tiny electronic components that facilitate the connection to a microcontroller board and its photoresistor use. For example, the module that we are using in this section contains extra components such as resistors and a variable resistor that adjusts the threshold level of a digital <em class="italic">high</em> value, which is sent by the sensor module if it receives a certain amount of light. Of <a id="_idIndexMarker264"/>course, this digital value must be <a id="_idIndexMarker265"/>sent to a digital input port of the microcontroller board.</p>
			<p>The next section shows how to connect the photoresistor sens<a id="_idTextAnchor065"/>or module to the Blue Pill.</p>
			<h3>Connecting the photoresistor sensor module to the Blue Pill board</h3>
			<p>This section <a id="_idIndexMarker266"/>explains how to connect a<a id="_idIndexMarker267"/> photoresistor module to the microcontroller board using just three wires. The photoresistor sensor module shown in <em class="italic">Figure 4.8</em> has four connectors: <strong class="bold">GND</strong> (short for <strong class="bold">ground</strong>), <strong class="bold">A0</strong> (short for <strong class="bold">analog output</strong>), <strong class="bold">D0</strong> (short for <strong class="bold">digital output</strong>), and +5V. The order of these connectors may change if your sensor module is from a different brand, but their purpose is the same.</p>
			<div><div><img src="img/Figure_4.8_B16413.jpg" alt=" Figure 4.8 – A photoresistor sensor module connected to a Blue Pill board"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.8 – A photoresistor sensor module connected to a Blue Pill board</p>
			<p>Here are the steps on<a id="_idIndexMarker268"/> how to connect the sensor<a id="_idIndexMarker269"/> module to the Blue Pill:</p>
			<ol>
				<li value="1">Connect the sensor module's GND pin (in some sensor modules, it is labeled with the – symbol) to the microcontroller board's ground connector labeled GND.</li>
				<li>Connect the sensor module's +5V (in some modules, it is labeled with the + symbol) pin to the 3V3 voltage pin from the microcontroller board. Even though the 3V3 pin provides 3.3 volts, it is enough for applying voltage (feeding) to the sensor module.<p class="callout-heading">Important note</p><p class="callout">Do not apply <strong class="bold">5 volts</strong> (<strong class="bold">5V</strong>) to the Blue Pill's input ports, because you may damage the Blue Pill. That's why you will connect the 3V3 voltage pin to the sensor module's +5V pin, so the module will provide up to 3.3 Volts as an analog voltage output, and the Blue Pill will use up that voltage to measure the amount of light.</p></li>
				<li>Connect the module's A0 pin to the Blue Pill's B1 pin (which is an input port).</li>
				<li>Now, connect the resistors to Blue Pill ports B12, B14, and B15. They are output ports.</li>
				<li>As the<a id="_idIndexMarker270"/> last step, connect the <a id="_idIndexMarker271"/>green, yellow, and red LEDs' anodes to those resistors and then connect the LEDs' cathodes to the ground.</li>
			</ol>
			<p>As you can see in <em class="italic">Figure 4.8</em>, we are not connecting a pull-down resistor to the Blue Pill's input port because the sensor module already contains a pull-down resistor. This allows us to save some space in the circuit and time to connect extra components to it.</p>
			<p>The following section describes how to use the sensor module with the Curiosity Nano.</p>
			<h3>Connecting the photoresistor sensor module to the Curiosity Nano board</h3>
			<p>In this <a id="_idIndexMarker272"/>section, we will analyze how the sensor <a id="_idIndexMarker273"/>module's analog pin is connected to the Curiosity Nano, as is shown in <em class="italic">Figure 4.9</em>. Please remember that this circuit does not need the pull-down resistor. We are using the same input port that was used for connecting the single photoresistor, described in an earlier section of this chapter. <em class="italic">Figure 4.9</em> shows a Fritzing diagram that includes the photoresistor module connected to the Curiosity Nano board.</p>
			<div><div><img src="img/Figure_4.9_B16413.jpg" alt="Figure 4.9 – The photoresistor module connected to Curiosity Nano's RA5 input port"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.9 – The photoresistor module connected to Curiosity Nano's RA5 input port</p>
			<p>Following the Fritzing diagram from <em class="italic">Figure 4.9</em>, these are the steps for connecting the photoresistor sensor module to the Curiosity Nano:</p>
			<ol>
				<li value="1">Connect <a id="_idIndexMarker274"/>the module's GND<a id="_idIndexMarker275"/> pin (in some modules, it is labeled with the - symbol) to the microcontroller board's ground connector, labeled GND.</li>
				<li>Connect the module's +5V pin (in some modules, it is labeled with the + symbol) to the VTG pin from the microcontroller board. Even though the VTG pin provides 3.3 volts, it may be enough to apply voltage (feeding) to the sensor module.<p class="callout-heading">Important note</p><p class="callout">Do not apply 5V to the Curiosity Nano's input ports because you may damage the microcontroller board. That's why you will connect the Curiosity Nano's VTG voltage pin to the sensor module's +5V pin, so the sensor module will provide up to 3.3 Volts as an output and the Curiosity Nano will use up that voltage to measure the amount of light.</p></li>
				<li>Connect the sensor module's A0 pin to the Curiosity Nano's RA5 pin (which is an input port).</li>
				<li>Now, connect the resistors that will protect the 3 LEDs to ports RD1, RD2, and RD3. They are output ports.</li>
				<li>As the last step, connect the <a id="_idIndexMarker276"/>green, yellow, and red LEDs' anodes to those resistors and then connect the LEDs' cathodes to the ground.</li>
			</ol>
			<p>As you can see from <em class="italic">Figure 4.9</em>, similar to the example with the Blue Pill, we are not connecting a pull-down resistor to the Curiosity Nano's input port because the sensor module already contains a pull-down resistor.</p>
			<p>You can use the<a id="_idIndexMarker277"/> same code used for the photoresistor used in <em class="italic">Figure 4.6</em> and <em class="italic">Figure 4.7</em> to get analog values from the photoresistor sensor module shown in <em class="italic">Figure 4.9</em>. You may need to adjust the values in the code if necessary. You can experiment with a number of environments (for example, using the sensor in a living room or a bedroom) to see the analog values obtained by the microcontroller board from the sensor change and thus adjust the code accordingly.</p>
			<p>The next section describes how to test the photoresistor if something is wrong with it, for example, the LEDs are not turning on, as a way to troubleshoot it.</p>
			<p>In this section, you learned how to connect the photoresistor module and the LEDs to the Curiosity Nano's ports. This section is important because it shows how practical and easy to use the photoresistor modules are, which facilitate the connections in microcontroller board projects.</p>
			<h1 id="_idParaDest-63"><a id="_idTextAnchor066"/>Testing out the photoresistor</h1>
			<p>This section focuses on <a id="_idIndexMarker278"/>how to test out a photoresistor to see if it is working OK. First of all, remember that the photoresistor used in this chapter does not have polarity, so you can safely connect any of its pins (legs) to a microcontroller board's input port.</p>
			<p>You also need to make sure that the pull-down resistor connected to the photoresistor has the right value. For example, the pull-down resistor used in the Blue Pill example from <em class="italic">Figure 4.4</em> is 10K ohm, and we used a 220-ohm resistor for the Curiosity Nano example from <em class="italic">Figure 4.6</em>. We found those resistor values experimentally. You can try out different resistors connected to the photoresistor to see if the voltage passing through the photoresistor changes widely. Ideally, that voltage should be changing between 0 and 3.3 volts, or close to those values, because in our circuit examples from this chapter, we connected one pin of the photoresistor to 3.3 volts.</p>
			<p>In order to see if the photoresistor is working OK, you can use a multimeter. Follow the next steps for testing the photoresistor with a multimeter:</p>
			<ol>
				<li value="1">Connect the multimeter's red probe (test lead) to one pin of the photoresistor.</li>
				<li>Connect the multimeter's black probe to the other pin of the photoresistor.</li>
				<li>Turn on the multimeter and set it up for measuring resistance (ohms).</li>
				<li>Cover the photoresistor with your hand and uncover it. Its resistance should change in the multimeter because the light the photoresistor is receiving changes.</li>
			</ol>
			<p>If you don't have a multimeter, you can <a id="_idIndexMarker279"/>test out a photoresistor with just a voltage source, such as batteries, and an LED (any color will do). <em class="italic">Figure 4.10</em> shows how to connect the photoresistor to the LED:</p>
			<div><div><img src="img/Figure_4.10_B16413.jpg" alt="Figure 4.10 – Testing out the photoresistor"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.10 – Testing out the photoresistor</p>
			<p>As you can see from <em class="italic">Figure 4.10</em>, the light from the LED should change (for example, changing from dim to bright) when the photoresistor receives different amounts of light, so try to cover it with your hand and see what happens. If the LED light does not change, it is probable that the photoresistor is damaged, so you will <a id="_idIndexMarker280"/>need to replace it. Here are the steps for connecting the components:</p>
			<ol>
				<li value="1">Connect the positive (<code>+</code>) battery terminal to one pin of the photoresistor.</li>
				<li>Connect the other photoresistor pin to the LED's anode pin.</li>
				<li>Connect the LED's cathode pin <a id="_idIndexMarker281"/>to the negative (<code>-</code>) battery terminal.</li>
			</ol>
			<p>Be careful when connecting the LED's pins. If it is connected in reverse, the LED will not turn on.</p>
			<h1 id="_idParaDest-64"><a id="_idTextAnchor067"/>Summary</h1>
			<p>In this chapter, we learned what sensors are and their applications in electronic projects. This is important because we will continue applying sensors in other chapters from this book. We also defined photoresistors, and how they are classified. We also learned how to connect a photoresistor sensor module to the Blue Pill and Curiosity Nano boards' input ports, and how to analyze and use analog data from a photoresistor.</p>
			<p>In this chapter, you learned important pieces of information. We have defined what a sensor and a photosensor is. You can now read data from them using microcontroller boards. The chapter also described how to connect a photosensor module to a microcontroller board.</p>
			<p><a href="B16413_05_Final_NM_ePub.xhtml#_idTextAnchor069"><em class="italic">Chapter 5</em></a>, <em class="italic">Humidity and Temperature Measurement</em>, will explain what a humidity and temperature sensor is and how can we acquire and use its analog data with both the Blue Pill and Curiosity Nano microcontroller boards. This can have a number of applications, such as measuring the temperature and humidity of a greenhouse.</p>
			<h1 id="_idParaDest-65"><a id="_idTextAnchor068"/>Further reading</h1>
			<ul>
				<li>Horowitz, P., Hill, W. (2015), <em class="italic">The art of electronics</em> [3rd ed.], Cambridge University Press: New York, NY.</li>
				<li>Microchip (2019), <em class="italic">PIC16F15376 Curiosity Nano Hardware User Guide</em>, Microchip Technology, Inc. Available from: <a href="http://ww1.microchip.com/downloads/en/DeviceDoc/50002900B.pdf">http://ww1.microchip.com/downloads/en/DeviceDoc/50002900B.pdf</a></li>
				<li>Mims, F.M. (2000), <em class="italic">Getting started in electronics</em>, Lincolnwood, IL: Master Publishing, Inc.</li>
			</ul>
		</div>
	</body></html>