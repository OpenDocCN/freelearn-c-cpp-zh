<html><head></head><body>
<div><div><div><h1 id="_idParaDest-6"><a id="_idTextAnchor005"/>Preface</h1>
			<p>In a tech-driven world where embedded systems power nearly every modern device and innovation, the ability to develop efficient and reliable firmware is a prized skill. The journey from writing basic code to mastering low-level firmware development can be daunting, but the rewards are substantial. Whether it’s a home appliance, an industrial control system, or a sophisticated IoT device, embedded systems serve as the silent, hardworking engines behind modern technology.</p>
			<p>This book, <em class="italic">Bare-Metal Embedded C Programming</em>, was born out of a desire to help you not only write functional firmware but also to deeply understand the underlying mechanisms that govern how microcontrollers work at their core. My goal is to take you on an in-depth, technical journey into the heart of ARM-based microcontroller firmware development, specifically focusing on the STM32 family. This is not a book for the faint of heart, nor is it one for those looking for quick shortcuts. Instead, it is designed for individuals who are ready to step away from the comforts of pre-built libraries and tools to develop the skills necessary for writing efficient, bare-metal code from scratch.</p>
			<p>So, what exactly is <em class="italic">bare-metal</em> programming? Simply put, it’s the art of writing firmware that interacts directly with the hardware—without the abstraction layers provided by third-party libraries. This approach requires precision, a deep understanding of microcontroller architecture, and the ability to read and manipulate registers to achieve the exact behavior you want from your hardware.</p>
			<p><em class="italic">Why I Wrote </em><em class="italic">This Book</em></p>
			<p>As someone with years of experience in embedded systems development, I’ve often noticed a gap in the way firmware development is taught. Many texts and courses focus on high-level development, promoting the use of pre-built libraries that abstract away the complexities of hardware interaction. While this approach is undoubtedly convenient and practical in many cases, it leaves a void for those who truly wish to understand how things work at the lowest level. I believe that understanding the “bare-metal” aspect of embedded systems development is essential for becoming a truly skilled firmware engineer.</p>
			<p>This book is my effort to fill that gap. Through step-by-step guidance, I’ll show you how to build your own drivers, manipulate registers, and write code that takes full control of the microcontroller. This is not just about learning a new skill—it’s about achieving mastery.</p>
			<h1 id="_idParaDest-7"><a id="_idTextAnchor006"/>Who this book is for</h1>
			<p>If you’re a developer, engineer, or a student eager to dive deep into the world of microcontroller firmware development, this book is for you. You’ll find it especially valuable if you’re the kind of person who prefers to understand what’s happening under the hood, rather than relying on copy-paste solutions from online forums. Whether you’re transitioning from other platforms or seeking to build a strong foundation in bare-metal development, this book will give you the hands-on experience you need.</p>
			<h1 id="_idParaDest-8"><a id="_idTextAnchor007"/>What This Book Covers</h1>
			<p><a href="B21914_01.xhtml#_idTextAnchor015"><em class="italic">Chapter 1</em></a>, <em class="italic">Setting Up the Tools of </em><em class="italic">the Trade</em></p>
			<p>This chapter introduces the essential tools you’ll need for development. From navigating datasheets to setting up your Integrated Development Environment (IDE), this chapter lays the groundwork for everything that follows.</p>
			<p><a href="B21914_02.xhtml#_idTextAnchor039"><em class="italic">Chapter 2</em></a>, <em class="italic">Constructing Peripheral Registers from </em><em class="italic">Memory Addresses</em></p>
			<p>In this chapter, we dive into the core of bare-metal programming. You’ll learn how to define and access peripheral registers directly from memory addresses, using the official microcontroller documentation as your guide.</p>
			<p><a href="B21914_03.xhtml#_idTextAnchor080"><em class="italic">Chapter 3</em></a>, <em class="italic">Understanding the Build Process and Exploring the </em><em class="italic">GNU Toolchain</em></p>
			<p>In this chapter, we take a closer look at the embedded C build process. You’ll explore how to compile and link code manually using the GNU Toolchain, gaining complete control over how your firmware is created.</p>
			<p><a href="B21914_04.xhtml#_idTextAnchor118"><em class="italic">Chapter 4</em></a>, <em class="italic">Developing the Linker Script and </em><em class="italic">Startup File</em></p>
			<p>In this chapter, you will learn how to write a custom linker script to define how your firmware is placed in the <a id="_idTextAnchor008"/>microcontroller’s memory, including allocating sections like code, data, and stack. Additionally, you’ll develop a startup file that configures the microcontroller’s initial state, sets up the stack, initializes memory, and jumps to your main code.</p>
			<p><a href="B21914_05.xhtml#_idTextAnchor171"><em class="italic">Chapter 5</em></a>, <em class="italic">The “Make” </em><em class="italic">Build System</em></p>
			<p>Automating the build process is a critical part of embedded development. This chapter teaches you how to use the Make build system to streamline your workflow by creating custom Makefiles that automate repetitive tasks.</p>
			<p><a href="B21914_06.xhtml#_idTextAnchor192"><em class="italic">Chapter 6</em></a>, <em class="italic">The Common Microcontroller Software Interface </em><em class="italic">Standard (CMSIS)</em></p>
			<p>CMSIS simplifies development on ARM Cortex microcontrollers. In this chapter, you’ll learn how to leverage CMSIS to write efficient code that takes advantage of the microcontroller’s features while maintaining simplicity.</p>
			<p><a href="B21914_07.xhtml#_idTextAnchor217"><em class="italic">Chapter 7</em></a>, <em class="italic">The General-Purpose Input/Output (</em><em class="italic">GPIO) Peripheral</em></p>
			<p>GPIO allows your microcontroller to interact with external devices. This chapter guides you through developing both input and output drivers for GPIO, one of the most frequently used peripherals in embedded systems.</p>
			<p><a href="B21914_08.xhtml#_idTextAnchor241"><em class="italic">Chapter 8</em></a>, <em class="italic">System Tick (</em><em class="italic">SysTick) Timer</em></p>
			<p>Timing is essential in embedded systems, and the SysTick timer provides an easy way to generate precise time delays and system ticks. This chapter walks you through developing SysTick drivers for use in your embedded applications.</p>
			<p><a href="B21914_09.xhtml#_idTextAnchor262"><em class="italic">Chapter 9</em></a>, <em class="italic">General-Purpose </em><em class="italic">Timers (TIM)</em></p>
			<p>This chapter introduces you to the general-purpose timers (TIM) in STM32 microcontrollers, teaching you how to develop timer drivers for tasks that require precise timing.</p>
			<p><a href="B21914_10.xhtml#_idTextAnchor278"><em class="italic">Chapter 10</em></a>, <em class="italic">The Universal Asynchronous </em><em class="italic">Receiver/Transmitter Protocol</em></p>
			<p>Communication is a key aspect of embedded systems. This chapter focuses on the UART protocol, one of the most widely used communication protocols. You’ll learn how to develop UART drivers, enabling your microcontroller to send and receive data from external devices.</p>
			<p><a href="B21914_11.xhtml#_idTextAnchor303"><em class="italic">Chapter 11</em></a>, <em class="italic">Analog-to-Digital </em><em class="italic">Converter (ADC)</em></p>
			<p>Many embedded applications require converting analog signals into digital data that your microcontroller can process. This chapter covers how to configure the ADC peripheral, allowing you to read and convert analog inputs into meaningful digital values.</p>
			<p><a href="B21914_12.xhtml#_idTextAnchor335"><em class="italic">Chapter 12</em></a>, <em class="italic">S</em><em class="italic">erial Peripheral </em><em class="italic">Interface (SPI)</em></p>
			<p>SPI is a high-speed communication protocol commonly used in embedded systems. This chapter guides you through developing SPI drivers, enabling efficient communication between your microcontroller and other peripherals, such as sensors or memory devices.</p>
			<p><a href="B21914_13.xhtml#_idTextAnchor371"><em class="italic">Chapter 13</em></a>, <em class="italic">Inter-Integrated </em><em class="italic">Circuit (I2C)</em></p>
			<p>I2C is another popular communication protocol for connecting devices, it is often used for short-distance communication in embedded systems. This chapter covers the development of I2C drivers, allowing your microcontroller to communicate with multiple devices over a shared bus.</p>
			<p><a href="B21914_14.xhtml#_idTextAnchor392"><em class="italic">Chapter 14</em></a>, <em class="italic">External Interrupts and </em><em class="italic">Events (EXTI)</em></p>
			<p>Responsiveness is critical in embedded systems, and external interrupts allow your system to react to changes in its environment. This chapter covers how to configure and manage external interrupts and events (EXTI) for timely and efficient responses to external stimuli.</p>
			<p><a href="B21914_15.xhtml#_idTextAnchor417"><em class="italic">Chapter 15</em></a>, <em class="italic">The Real-Time </em><em class="italic">Clock (RTC)</em></p>
			<p>For systems that require accurate timekeeping, the RTC peripheral is indispensable. In this chapter, you’ll learn how to set up and use the RTC to track time in low-power systems, even when the microcontroller is in sleep mode.</p>
			<p><a href="B21914_16.xhtml#_idTextAnchor448"><em class="italic">Chapter 16</em></a>, <em class="italic">Independent </em><em class="italic">Watchdog (IWDG)</em></p>
			<p>Stability is crucial for embedded systems, and the Independent Watchdog Timer (IWDG) ensures that your system can recover from unexpected malfunctions. This chapter teaches you how to configure the IWDG to automatically reset your microcontroller if it stops responding, ensuring reliable operation.</p>
			<p><a href="B21914_17.xhtml#_idTextAnchor467"><em class="italic">Chapter 17</em></a>, <em class="italic">Direct Memory </em><em class="italic">Access (DMA)</em></p>
			<p>Direct Memory Access (DMA) allows data transfers to occur independently of the CPU, significantly improving system efficiency. This chapter covers how to configure and use DMA for memory-to-memory transfers, as well as for peripherals like ADC and UART, offloading the work from the CPU.</p>
			<p><a href="B21914_18.xhtml#_idTextAnchor490"><em class="italic">Chapter 18</em></a>, <em class="italic">Power Management and Energy Efficiency in </em><em class="italic">Embedded Systems</em></p>
			<p>Power management is essential for energy-efficient systems, especially in battery-powered devices. In this final chapter, you’ll learn techniques for reducing power consumption, including how to use sleep modes, wake-up sources, and optimize firmware to achieve the best balance between performance and energy efficiency.</p>
			<h1 id="_idParaDest-9"><a id="_idTextAnchor009"/>To get the most out of this book</h1>
			<p>To fully benefit from this book, it’s important to have a general familiarity with the C programming language. While we’ll cover the specifics of embedded systems programming in detail, having a basic understanding of how code operates will make the material easier to follow. Familiarity with microcontrollers is certainly helpful but not a strict requirement. Everything you need will be introduced as we progress. Whether you’re a beginner or an experienced developer, this book will guide you step-by-step through the fascinating world of bare-metal embedded programming.</p>
			<table id="table001" class="T---Table _idGenTablePara-1">
				<colgroup>
					<col/>
					<col/>
				</colgroup>
				<thead>
					<tr class="T---Table">
						<td class="T---Table T---Body T---Header">
							<p><strong class="bold">Software/hardware covered in </strong><strong class="bold">the book</strong></p>
						</td>
						<td class="T---Table T---Body T---Header">
							<p><strong class="bold">Operating </strong><strong class="bold">system requirements</strong></p>
						</td>
					</tr>
				</thead>
				<tbody>
					<tr class="T---Table">
						<td class="T---Table T---Body T---Body">
							<p>STM32CubeIDE</p>
						</td>
						<td class="T---Table T---Body T---Body">
							<p>Windows</p>
						</td>
					</tr>
					<tr class="T---Table">
						<td class="T---Table T---Body T---Body">
							<p>GNU Arm Embedded Toolchain</p>
						</td>
						<td class="T---Table T---Body T---Body"/>
					</tr>
					<tr class="T---Table">
						<td class="T---Table T---Body T---Body">
							<p>NUCLEO-411 Development Board</p>
						</td>
						<td class="T---Table T---Body T---Body"/>
					</tr>
					<tr class="T---Table">
						<td class="T---Table T---Body T---Body">
							<p>10k Potentiometer</p>
						</td>
						<td class="T---Table T---Body T---Body"/>
					</tr>
					<tr class="T---Table">
						<td class="T---Table T---Body T---Body">
							<p>OpenOCD</p>
						</td>
						<td class="T---Table T---Body T---Body"/>
					</tr>
					<tr class="T---Table">
						<td class="T---Table T---Body T---Body">
							<p>Notepad++</p>
						</td>
						<td class="T---Table T---Body T---Body"/>
					</tr>
					<tr class="T---Table">
						<td class="T---Table T---Body T---Body">
							<p>RealTerm</p>
						</td>
						<td class="T---Table T---Body T---Body"/>
					</tr>
				</tbody>
			</table>
			<p><strong class="bold">If you are using the digital version of this book, we advise you to type the code yourself or access the code from the book’s GitHub repository (a link is available in the next section). Doing so will help you avoid any potential errors related to the copying and pasting </strong><strong class="bold">of code.</strong></p>
			<h1 id="_idParaDest-10"><a id="_idTextAnchor010"/>Download the example code files</h1>
			<p>You can download the example code files for this book from GitHub at <a href="https://github.com/PacktPublishing/Bare-Metal-Embedded-C-Programming">https://github.com/PacktPublishing/Bare-Metal-Embedded-C-Programming</a>. If there’s an update to the code, it will be updated in the GitHub repository.</p>
			<p>We also have other code bundles from our rich catalog of books and videos available at <a href="https://github.com/PacktPublishing/">https://github.com/PacktPublishing/</a>. Check them out!</p>
			<h1 id="_idParaDest-11"><a id="_idTextAnchor011"/>Conventions used</h1>
			<p>There are a number of text conventions used throughout this book.</p>
			<p><code>Code in text</code>: Indicates code words in text, database table names, folder names, filenames, file extensions, pathnames, dummy URLs, user input, and Twitter handles. Here is an example: “Copy the path to the <code>openocd </code><code>bin</code> folder.”</p>
			<p>A block of code is set as follows:</p>
			<pre class="source-code">
// 22: Set PA5(LED_PIN) high 
GPIOA_OD_R |= LED_PIN; </pre>			<p>When we wish to draw your attention to a particular part of a code block, the relevant lines or items are set in bold:</p>
			<pre class="source-code">
//  1: Define base address for peripherals
<strong class="bold">#define</strong> PERIPH_BASE        (0x40000000UL)
//  2: Offset for AHB1 peripheral bus</pre>			<p>Any command-line input or output is written as follows:</p>
			<pre class="console">
monitor flash write_image erase 4_makefile_project.elf</pre>			<p><strong class="bold">Bold</strong>: Indicates a new term, an important word, or words that you see onscreen. For instance, words in menus or dialog boxes appear in <strong class="bold">bold</strong>. Here is an example: “Right-click on <strong class="bold">This PC</strong>, and then choose <strong class="bold">Properties</strong>.”</p>
			<p class="callout-heading">Tips or important notes</p>
			<p class="callout">Appear like this.</p>
			<h1 id="_idParaDest-12"><a id="_idTextAnchor012"/>Get in touch</h1>
			<p>Feedback from our readers is always welcome.</p>
			<p><strong class="bold">General feedback</strong>: If you have questions about any aspect of this book, email us at <a href="mailto:customercare@packtpub.com">customercare@packtpub.com</a> and mention the book title in the subject of your message.</p>
			<p><strong class="bold">Errata</strong>: Although we have taken every care to ensure the accuracy of our content, mistakes do happen. If you have found a mistake in this book, we would be grateful if you would report this to us. Please visit <a href="http://www.packtpub.com/support/errata">www.packtpub.com/support/errata</a> and fill in the form.</p>
			<p><strong class="bold">Piracy</strong>: If you come across any illegal copies of our works in any form on the internet, we would be grateful if you would provide us with the location address or website name. Please contact us at <a href="mailto:copyright@packt.com">copyright@packt.com</a> with a link to the material.</p>
			<p><strong class="bold">If you are interested in becoming an author</strong>: If there is a topic that you have expertise in and you are interested in either writing or contributing to a book, please visit <a href="http://authors.packtpub.com">authors.packtpub.com</a>.</p>
			<h1 id="_idParaDest-13"><a id="_idTextAnchor013"/>Share Your Thoughts</h1>
			<p>Once you’ve read <em class="italic">Bare-Metal Embedded C Programming</em>, we’d love to hear your thoughts! Please <a href="https://packt.link/r/183546081X">click here to go straight to the Amazon review page</a> for this book and share your feedback.</p>
			<p>Your review is important to us and the tech community and will help us make sure we’re delivering excellent quality content.</p>
			<h1 id="_idParaDest-14"><a id="_idTextAnchor014"/>Download a free PDF copy of this book</h1>
			<p>Thanks for purchasing this book!</p>
			<p>Do you like to read on the go but are unable to carry your print books everywhere?</p>
			<p>Is your eBook purchase not compatible with the device of your choice?</p>
			<p>Don’t worry, now with every Packt book you get a DRM-free PDF version of that book at no cost.</p>
			<p>Read anywhere, any place, on any device. Search, copy, and paste code from your favorite technical books directly into your application.</p>
			<p>The perks don’t stop there, you can get exclusive access to discounts, newsletters, and great free content in your inbox daily</p>
			<p>Follow these simple steps to get the benefits:</p>
			<ol>
				<li>Scan the QR code or visit the link below</li>
			</ol>
			<p class="IMG---Figure"> </p>
			<div><div><img src="img/B21914_QR_Free_PDF.jpg" alt="" role="presentation" width="200" height="200"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><a href="https://packt.link/free-ebook/9781835460818">https://packt.link/free-ebook/9781835460818</a></p>
			<ol>
				<li value="2">Submit your proof of purchase</li>
				<li>That’s it! We’ll send your free PDF and other benefits to your email directly</li>
			</ol>
		</div>
	</div>
</div>
</body></html>