- en: 1 Establishing a Build Environment
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Join our book community on Discord
  id: totrans-1
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '![](img/file40.png)'
  id: totrans-2
  prefs: []
  type: TYPE_IMG
- en: '[https://packt.link/unitydev](https://packt.link/unitydev)'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
- en: 'In this chapter, you will learn how to set up a 3D graphics development environment
    on your computer for Windows and Linux operating systems. You will learn which
    software tools are needed to run the demos from this book’s source code bundle:
    [https://github.com/PacktPublishing/3D-Graphics-Rendering-Cookbook-Second-Edition](https://github.com/PacktPublishing/3D-Graphics-Rendering-Cookbook-Second-Edition).
    We will cover the following topics:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
- en: Setting up our development environment on Microsoft Windows
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Setting up our development environment on Linux
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Installing the Vulkan SDK for Microsoft Windows and Linux
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Managing dependencies
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Getting the demo data
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Creating utilities for CMake projects
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Using the GLFW library
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Multithreading with Taskflow
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Setting up our development environment on Microsoft Windows
  id: totrans-13
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In this recipe, we will get started by setting up our development environment
    on Windows. We will go through the installation of each of the required tools
    individually and in detail.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-15
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: In order to start working with the examples from this book in a Microsoft Windows
    environment, you will need some essential tools to be installed in your system.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
- en: The most important one is Microsoft Visual Studio 2022\. Additional tools include
    the **Git** version control system, the **CMake** build tool, and the **Python**
    programming language. Throughout this book, we use these tools on the command
    line only, so no GUI add-ons will be required.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-18
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Let’s install each of the required tools individually.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
- en: Microsoft Visual Studio 2022
  id: totrans-20
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'Follow the given steps to install Microsoft Visual Studio 2022:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
- en: Open [https://visualstudio.microsoft.com](https://visualstudio.microsoft.com)
    and download the Visual Studio 2022 Community Edition installer.
  id: totrans-22
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Start the installer and follow the on-screen instructions. For the purposes
    of this book, you need to have a native C++ compiler for the 64-bit Intel platform.
    Other components of the Visual Studio development environment are not required
    to run this book’s bundled sample code.
  id: totrans-23
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Git
  id: totrans-24
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'Follow the given steps to install Git:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
- en: Download the latest Git installer from [https://git-scm.com/downloads](https://git-scm.com/downloads),
    run it, and follow the on-screen instructions.
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'We assume that Git is added to the system `PATH` variable. Enable the option
    shown in the following image during installation:'
  id: totrans-27
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Figure 1.1 – Git from the command line and also from third-party software](img/file1.png)'
  id: totrans-28
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: Figure 1.1 – Git from the command line and also from third-party software
  id: totrans-29
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Select **Use Windows’ default console window**, as shown in the next screenshot.
    This option will allow you to build the scripts in this book from any directory
    on your computer.
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Figure 1.2 – Use Windows’ default console window](img/file2.png)'
  id: totrans-31
  prefs: []
  type: TYPE_IMG
- en: Figure 1.2 – Use Windows’ default console window
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
- en: 'Git is complex software and a huge topic in itself. We recommend the book *Mastering
    Git* written by Jakub Narębski and published by Packt Publishing, [https://www.packtpub.com/application-development/mastering-git](https://www.packtpub.com/application-development/mastering-git),
    along with *Git Essentials: Developer’s Guide to Git* by François Dupire and the
    downloadable ebook *ProGit*, Second Edition, by Scott Chacon and Ben Straub, [https://git-scm.com/book/en/v2](https://git-scm.com/book/en/v2).'
  id: totrans-33
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: CMake
  id: totrans-34
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'To install CMake, please follow the given steps:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
- en: Download the latest 64-bit CMake installer from [https://cmake.org/download/](https://cmake.org/download/).
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Run it and follow the on-screen instructions. If you already have an earlier
    version of CMake installed, it is recommended to uninstall it first.
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Select the **Add CMake to the system PATH for all users** option, as shown
    here:'
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Figure 1.3: Add CMake to the system PATH for all users](img/file3.png)'
  id: totrans-39
  prefs: []
  type: TYPE_IMG
- en: 'Figure 1.3: Add CMake to the system PATH for all users'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
- en: Python
  id: totrans-41
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'To install Python, please follow the given steps:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
- en: Download the latest Python 3 installer for 64-bit systems from [https://www.python.org/downloads/](https://www.python.org/downloads/).
  id: totrans-43
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Run it and follow the on-screen instructions.
  id: totrans-44
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'During the installation, you also need to install the `pip` feature. Choose
    **Custom Installation** and make sure that the **pip** checkbox is checked, as
    shown:'
  id: totrans-45
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Figure 1.4 – Custom installation](img/file4.png)'
  id: totrans-46
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: Figure 1.4 – Custom installation
  id: totrans-47
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Once the installation has completed, make sure to add the folder containing
    `python.exe` to the PATH environment variable.
  id: totrans-48
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: There’s more...
  id: totrans-49
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Besides Git, there are other popular version control systems, like SVN and Mercurial.
    While developing large software systems, you will inevitably face the need to
    download some libraries from a non-Git repository. We recommend getting familiar
    with Mercurial.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
- en: While working in the command-line environment, it is useful to have some tools
    from the Unix environment, like `wget`, `grep`, `find`, etc. The **GnuWin32**
    project provides precompiled binaries of these tools, which can be downloaded
    from [http://gnuwin32.sourceforge.net](http://gnuwin32.sourceforge.net).
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
- en: 'Furthermore, in the Windows environment, orthodox file managers make file manipulation
    a lot easier. We definitely recommend giving the open-source Far Manager a try.
    You can download it from [https://farmanager.com](https://farmanager.com). It
    looks like this:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
- en: '![Figure 1.5 – The look and feel of Far Manager](img/file5.png)'
  id: totrans-53
  prefs: []
  type: TYPE_IMG
- en: Figure 1.5 – The look and feel of Far Manager
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
- en: Setting up our development environment on Linux
  id: totrans-55
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Linux is becoming more and more attractive for 3D graphics development, including
    gaming technology. Let’s go through a list of tools necessary to start working
    with this book on Linux.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-57
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: We assume you have a desktop computer with a Debian-based GNU/Linux operating
    system installed. We also assume you are familiar with the `apt` package manager.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
- en: To start developing modern graphics programs on Linux, you need to have up-to-date
    video card drivers installed that support Vulkan 1.3\. To build examples from
    this book, a C++ compiler with C++20 support is required. We tested our code with
    Clang and the GNU Compiler Collection.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-60
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'On a Debian-based system, the installation process is straightforward; however,
    before installing any of the required packages, we recommend running the following
    command to ensure your system is up to date:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Let us go through the list of essential software and install whatever is missing.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
- en: GCC Compiler
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Assuming you have a properly configured `apt` package manager, run the following
    command to install the GCC compiler and related tools. We tested GCC 12:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-66
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: CMake
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'The CMake build tool is also available in the standard repositories. To install
    CMake, type the following command:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: CMake 3.19 or above is sufficient for the code samples in this book.
  id: totrans-70
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Git
  id: totrans-71
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'To install the Git version control system, run the following command:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Python 3
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'To install the Python 3 package, run the following command:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: The exact version of Python may vary between Linux distributions. Any version
    of Python 3 will suffice for the scripts in this book.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
- en: Now we are done with the basic packages and can install graphics-related software.
    Let us move on to the next recipe to learn how to set up the Vulkan SDK.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
- en: Installing the Vulkan SDK for Windows and Linux
  id: totrans-79
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In this recipe, we will learn how to get started with the Vulkan SDK. We will
    describe the requirements and procedure for installing the LunarG Vulkan SDK for
    Windows and Linux.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
- en: 'In principle, it is possible to write Vulkan applications without the Vulkan
    SDK, using only C/C++ header files provided by Khronos. You can get these header
    files by cloning the Git repository: [https://github.com/KhronosGroup/Vulkan-Headers](https://github.com/KhronosGroup/Vulkan-Headers).
    However, it is advised to install the complete Vulkan SDK to be able to use Vulkan
    validation layers and a standalone GLSL compiler.'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-82
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Make sure you have the latest up-to-date video card drivers for your operating
    system. On Windows, you can download video drivers from your GPU vendor’s website.
    For Ubuntu, refer to the documentation: [https://ubuntu.com/server/docs/nvidia-drivers-installation](https://ubuntu.com/server/docs/nvidia-drivers-installation).'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-84
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'To install Vulkan 1.3 on Linux, follow these steps:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
- en: Open the [https://www.lunarg.com/vulkan-sdk/](https://www.lunarg.com/vulkan-sdk/)
    page in a browser and download the latest Vulkan SDK for Windows or Linux.
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'After the download has finished, run the Windows installer file and follow
    the on-screen instructions. If you have Ubuntu 22.04 installed, use the following
    commands provided on LunarG’s website:'
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE5]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'For other Linux distributions, you may need to download the `.tar.gz` SDK archive
    from [https://vulkan.lunarg.com/sdk/home#linux](https://vulkan.lunarg.com/sdk/home#linux)
    and unpack it manually. You need to set environment variables to locate the Vulkan
    SDK components. Use the `source` command to run a config script that will do it
    for you:'
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE6]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: There’s more...
  id: totrans-91
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: When developing cross-platform applications, it is good to use similar tools
    for each platform. Since Linux supports GCC and Clang compilers, using GCC or
    Clang on Windows ensures that you avoid the most common portability issues. A
    complete package of C and C++ compilers can be downloaded from [http://www.equation.com/servlet/equation.cmd?fa=fortran](http://www.equation.com/servlet/equation.cmd?fa=fortran).
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
- en: An alternative way to use GCC on Windows is to install the MSYS2 environment
    from [https://www.msys2.org](https://www.msys2.org). It features the package management
    system used in Arch Linux, **Pacman**.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
- en: Managing dependencies
  id: totrans-94
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: This book’s examples use multiple open-source libraries. To manage these dependencies,
    we use a free and open-source tool called **Bootstrap**. The tool is similar to
    Google’s repo tool and works on both Windows and Linux, as well as on macOS for
    that matter.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
- en: In this recipe, we will learn how to use Bootstrap to download libraries using
    the Vulkan Headers repository as an example.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-97
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Make sure you have Git and Python installed as described in the previous recipes.
    After that, clone the Bootstrap repository from GitHub:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  id: totrans-99
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: How to do it...
  id: totrans-100
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Let’s look into the source code bundle and run the `bootstrap.py` script:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: The script will start downloading all the third-party libraries required to
    compile and run the source code bundle for this book. On Windows, the tail of
    the output should look as follows.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  id: totrans-104
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Once the download process is complete, we are ready to build the project.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
- en: How it works...
  id: totrans-106
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Bootstrap** takes a JSON file as input, opening `bootstrap.json` from the
    current directory by default. It contains metadata of libraries we want to download;
    for example, their names, where to retrieve them from, a specific version to download,
    and so on. Besides that, each used library can have some additional instructions
    on how to build it. Those can be patches applied to the original library, unpacking
    instructions, SHA hashes to check archive integrity, and many others.'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
- en: The source code for each library can be represented by either a URL of a version
    control system repository or by an archive file with the library source files.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
- en: 'A typical JSON file entry corresponding to one library looks like this snippet:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'The field `type` can have one of these values: `archive`, `git`, `hg`, or `svn`.
    The first value corresponds to an archive file, such as `.zip`, `.tar.gz`, or
    `.tar.bz2`, while the last three types describe different version control system
    repositories. The `url` field contains a URL of the archive file to be downloaded
    or a URL of the repository. The `revision` field can specify a particular revision,
    tag, or branch to check out.'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
- en: The complete JSON file is a comma-separated list of such entries. For this recipe,
    we have only one library to download. We will add more libraries in the next chapters.
    The accompanying source code bundle contains a JSON file with all the libraries
    used in this book.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
- en: There’s more...
  id: totrans-113
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: There is comprehensive documentation for this tool that describes other command-line
    options and JSON fields in great detail. It can be downloaded from [https://github.com/corporateshark/bootstrapping](https://github.com/corporateshark/bootstrapping).
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
- en: The Bootstrap tool does not differentiate between source code and binary assets.
    All the textures, 3D models, and other resources for your application can also
    be downloaded and kept up to date and organized in an automated way.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
- en: Getting the demo data
  id: totrans-116
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: This book makes use of free 3D graphics datasets as much as possible. The comprehensive
    list of large 3D datasets is maintained by Morgan McGuire – Computer Graphics
    Archive, July 2017 ([https://casual-effects.com/data](https://casual-effects.com/data)).
    We will use some large 3D models from his archive for demonstration purposes in
    this book. Let us download and patch one of them.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
- en: How to do it…
  id: totrans-118
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'The bundled source code contains a Python script, `deploy_deps.py`, which will
    download all the required 3D models automatically. To download the entire Bistro
    dataset manually, follow these simple steps:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
- en: Open the [https://casual-effects.com/data/](https://casual-effects.com/data/)
    page in a browser and find the **Amazon Lumberyard Bistro** dataset.
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on the **Download** link and allow the browser to download all the data
    files. Below is a screenshot of Morgan McGuire’s site with the download link.
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Figure 1.6 – Amazon Lumberyard Bistro as pictured on casualeffects.com as
    a 2.4 GB download](img/file6.png)'
  id: totrans-122
  prefs: []
  type: TYPE_IMG
- en: Figure 1.6 – Amazon Lumberyard Bistro as pictured on casualeffects.com as a
    2.4 GB download
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
- en: Create utilities for CMake projects
  id: totrans-124
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In this recipe, we will see how CMake is used to configure all the code examples
    in this book and learn some small tricks along the way.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
- en: For those who are just starting with CMake, we recommend reading the books *CMake
    Cookbook* (Radovan Bast and Roberto Di Remigio) by Packt Publishing and *Mastering
    CMake* (Ken Martin and Bill Hoffman) by Kitware.
  id: totrans-126
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-127
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'For a start, let’s create a minimalistic C++ application with a trivial `main()`
    function and build it using CMake:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  id: totrans-129
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: How to do it...
  id: totrans-130
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Let’s introduce two helper macros for CMake. You can find them in the `CMake/CommonMacros.txt`
    file of our source code bundle at [https://github.com/PacktPublishing/3D-Graphics-Rendering-Cookbook-Second-Edition](https://github.com/PacktPublishing/3D-Graphics-Rendering-Cookbook-Second-Edition).
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
- en: The `SETUP_GROUPS` macro iterates over a space-delimited list of C and C++ files,
    whether it is a header or a source file, and assigns each of them to a separate
    group. The group name is constructed based on the path of each individual file.
    This way, we end up with a nice structure similar to a filesystem within a directory
    in the Visual Studio Solution Explorer window, as we can see on the right in the
    following figure.
  id: totrans-132
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Figure 1.7 – Without groups (left) and with groups (right)](img/file7.png)'
  id: totrans-133
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: Figure 1.7 – Without groups (left) and with groups (right)
  id: totrans-134
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'The macro starts by iterating over a list of files passed in the `src_files`
    parameter:'
  id: totrans-135
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE12]'
  id: totrans-136
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'We store the parent directory name as a default group name. For any OS, replace
    all the backslash characters with forward slashes:'
  id: totrans-137
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE13]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Then, we can tell CMake to assign the current file to a source group with this
    name.
  id: totrans-139
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE14]'
  id: totrans-140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: The second macro, `SETUP_APP`, is used as a shortcut to create a new CMake project
    with all the standard properties we want it to have. It is very convenient when
    having to deal with a number of very similar subprojects, for example, like in
    this book.
  id: totrans-141
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE15]'
  id: totrans-142
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: After setting the project name, this macro uses the `GLOB_RECURSE` function
    to collect all source and header files into the `SRC_FILES` and `HEADER_FILES`
    variables.
  id: totrans-143
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE16]'
  id: totrans-144
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: In all our code samples, we use the directory `src` containing the source files
    as an `include` directory, too.
  id: totrans-145
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE17]'
  id: totrans-146
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: All enumerated source and header files are added to an executable inside the
    current project.
  id: totrans-147
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE18]'
  id: totrans-148
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: We use the `SETUP_GROUP` macro from *Step 1* to place each source and header
    file into an appropriate group inside the project.
  id: totrans-149
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE19]'
  id: totrans-150
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: The next three properties set different executable file names for each supported
    build configuration. These lines are optional, yet they are really useful when
    using CMake with the Visual Studio IDE. The reason is that Visual Studio can change
    build configurations (or “build types”, as they are called in CMake) dynamically
    directly from the IDE, and each build configuration can have its own output file
    name. We add suffixes to these file names so that they can co-exist in a single
    output folder.
  id: totrans-151
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE20]'
  id: totrans-152
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: Since we use C++20 throughout this book, we require CMake to enable it.
  id: totrans-153
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE21]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: To ease the debugging with Visual Studio, we enable console output by changing
    the application type to `Console`. We also set the local debugger working directory
    to `CMAKE_SOURCE_DIR`, which will make finding assets a lot more straightforward
    and consistent. There are some Apple-specific properties to allow building the
    source code on Mac machines.
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE22]'
  id: totrans-156
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Finally, the top-level `CMakeLists.txt` file of our first project will look
    like this:'
  id: totrans-157
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE23]'
  id: totrans-158
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: You may notice that the line `project(Chapter01)` above is overridden by a call
    to `project()` inside the `SETUP_APP` macro. This is due to the following CMake
    warning, which will be emitted if we do not declare a new project right from the
    get-go.
  id: totrans-159
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[PRE24]'
  id: totrans-160
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'To build and test the executable, create the `build` subfolder, change the
    working directory to `build`, and run CMake as follows:'
  id: totrans-161
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: For Windows and Visual Studio 2022, run the following command to configure our
    project for the 64-bit target platform architecture.
  id: totrans-162
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE25]'
  id: totrans-163
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: For Linux, we can use the `Unix Makefiles` CMake generator as follows.
  id: totrans-164
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE26]'
  id: totrans-165
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: To build an executable for the `release` build type, you can use the following
    command on any platform. To build a debug version, use `--config Debug` or skip
    that parameter entirely.
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE27]'
  id: totrans-167
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: All the demo applications from the source code bundle should be run from the
    folder where the `data/` subfolder is located.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
- en: There’s more...
  id: totrans-169
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Alternatively, you can use the cross-platform build system Ninja along with
    CMake. It is possible to do so simply by changing the CMake project generator
    name.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE28]'
  id: totrans-171
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: Invoke Ninja from the command line to compile the project.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE29]'
  id: totrans-173
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: Notice how fast everything gets built now, compared to the classic `cmake --build`
    command. See [https://ninja-build.org](https://ninja-build.org) for more details.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
- en: Now let’s take a look at how to work with some basic open source libraries.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
- en: Using the GLFW library
  id: totrans-176
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The GLFW library hides all the complexity of creating windows, graphics contexts,
    and surfaces and getting input events from the operating system. In this recipe,
    we build a minimalistic application with GLFW and Vulkan to get some basic 3D
    graphics onto the screen.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-178
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'We build our examples with GLFW 3.4\. Here is a JSON snippet for the Bootstrap
    script so that you can download the proper library version:'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE30]'
  id: totrans-180
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: The complete source code for this recipe can be found in the source code bundle
    under the name of `Chapter01/02_GLFW`.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-182
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Let’s write a minimalistic application that creates a window and waits for
    an `exit` command from the user – pressing the Esc key. This functionality will
    be used in all of our subsequent demos, so we have wrapped it into a helper function
    `initWindow()` declared in `shared/HelpersGLFW.h`. Let’s take a look at how to
    use it to create an empty GLFW window:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
- en: 'Include all necessary headers and decide on the initial window dimensions:'
  id: totrans-184
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE31]'
  id: totrans-185
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: Invoke the `initWindow()` function to create a window. The `width` and `height`
    parameters are passed by reference and, after the call, will contain the actual
    working area of the created window. If we pass the initial values of `0`, the
    window will be created to span the entire desktop working area without an overlapping
    taskbar.
  id: totrans-186
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE32]'
  id: totrans-187
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'For this application, the main loop and cleanup are trivial:'
  id: totrans-188
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE33]'
  id: totrans-189
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: Now we will take a look at the internals of `initWindow()` for some interesting
    details.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
- en: How it works...
  id: totrans-191
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Let’s use this library to create an application that opens an empty window:'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
- en: 'First, we set the GLFW error callback via a lambda to catch potential errors
    and then initialize GLFW:'
  id: totrans-193
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE34]'
  id: totrans-194
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: Let’s decide if we want to make a desktop full-screen window. Set the resizable
    flag for windows that aren’t full-screen and retrieve the desired window dimensions.
    We are going to initialize Vulkan manually, so no graphics API initialization
    is required to be done by GLFW. The flag `wantsWholeArea` determines if we want
    a true full-screen window or a window that does not overlap the system taskbar.
  id: totrans-195
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE35]'
  id: totrans-196
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'Create a window and retrieve the actual window dimensions:'
  id: totrans-197
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE36]'
  id: totrans-198
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: Set a default keyboard callback to handle the Esc key. A simple lambda will
    do this job for us.
  id: totrans-199
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE37]'
  id: totrans-200
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'If you run this tiny application, it will create an empty window, as in the
    following screenshot:'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
- en: '![Figure 1.8 – Our first application](img/file8.png)'
  id: totrans-202
  prefs: []
  type: TYPE_IMG
- en: Figure 1.8 – Our first application
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
- en: There’s more...
  id: totrans-204
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Further details about how to use GLFW can be found at [https://www.glfw.org/documentation.xhtml](https://www.glfw.org/documentation.xhtml).
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
- en: Multithreading with Taskflow
  id: totrans-206
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Modern graphical applications require us to harness the power of multiple CPUs
    to be performant. **Taskflow** is a fast C++ header-only library that can help
    you write parallel programs with complex task dependencies quickly. This library
    is extremely useful as it allows you to jump into the development of multithreaded
    graphical applications that make use of advanced rendering concepts, such as frame
    graphs and multithreaded command buffer generation.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-208
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Here, we use Taskflow version 3.7.0\. You can download it using the following
    Bootstrap snippet:'
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE38]'
  id: totrans-210
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: To debug dependency graphs produced by Taskflow, it is recommended that you
    install the **GraphViz** tool from [https://www.graphviz.org](https://www.graphviz.org).
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
- en: The complete source code for this recipe can be found in `Chapter01/03_Taskflow`.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-213
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Let’s create and run a set of concurrent dependent tasks via the `for_each_index()`
    algorithm. Each task will print a single value from an array in a concurrent fashion.
    The processing order can vary between different runs of the program:'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
- en: Include the `taskflow.hpp` header file. The `tf::Taskflow` class is the main
    place to create a task dependency graph. Declare an instance and a data vector
    to process.
  id: totrans-215
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE39]'
  id: totrans-216
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'The `for_each_index()` member function returns a task that implements a parallel
    for loop algorithm. We specify the range `0..items.size()` and the step `1`. The
    returned `task` can be used for synchronization purposes:'
  id: totrans-217
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE40]'
  id: totrans-218
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'Let’s attach some work before and after the parallel for task so that we can
    view `Start` and `End` messages in the output. Let’s call the new `S` and `T`
    tasks accordingly:'
  id: totrans-219
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE41]'
  id: totrans-220
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'Save the generated tasks dependency graph in `.dot` format so that we can process
    it later with the GraphViz `dot` tool:'
  id: totrans-221
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE42]'
  id: totrans-222
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'Now we can create a `tf::executor` object and run the constructed Taskflow
    graph:'
  id: totrans-223
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE43]'
  id: totrans-224
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: One important part to mention here is that the dependency graph can only be
    constructed once. Then, it can be reused in every frame to run concurrent tasks
    efficiently.
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 这里要提到的一个重要部分是，依赖图只能构建一次。然后，它可以在每一帧中重复使用，以有效地运行并发任务。
- en: 'The output from the preceding program should look similar to the following
    listing:'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 前一个程序输出的内容应类似于以下列表：
- en: '[PRE44]'
  id: totrans-227
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: Here, we can see our `S` and `T` tasks. Between them, there are multiple threads
    with different IDs processing different elements of the `items[]` vector in parallel.
    Your output may vary due to concurrency.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们可以看到我们的 `S` 和 `T` 任务。它们之间有多个线程，具有不同的 ID，并行处理 `items[]` 向量的不同元素。由于并发性，你的输出可能会有所不同。
- en: There’s more...
  id: totrans-229
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 还有更多...
- en: 'The application saved the dependency graph inside the `taskflow.dot` file.
    It can be converted into a visual representation by GraphViz, [https://graphviz.org](https://graphviz.org),
    using the following command:'
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 应用程序将依赖图保存在 `taskflow.dot` 文件中。它可以通过 GraphViz，[https://graphviz.org](https://graphviz.org)，使用以下命令转换为可视表示：
- en: '[PRE45]'
  id: totrans-231
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: 'The resulting `.png` image should look similar to the following screenshot:'
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 生成的 `.png` 图片应类似于以下截图：
- en: '![Figure 1.9 – The Taskflow dependency graph for for_each_index()](img/file9.png)'
  id: totrans-233
  prefs: []
  type: TYPE_IMG
  zh: '![图 1.9 – for_each_index() 的 Taskflow 依赖图](img/file9.png)'
- en: Figure 1.9 – The Taskflow dependency graph for for_each_index()
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 图 1.9 – for_each_index() 的 Taskflow 依赖图
- en: This functionality is extremely useful when you are debugging complex dependency
    graphs (and producing complex-looking images for your books and papers).
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 当你调试复杂的依赖图（并为你的书籍和论文生成复杂外观的图片）时，此功能非常有用。
- en: The Taskflow library functionality is vast and provides implementations for
    numerous parallel algorithms and profiling capabilities. Please refer to the official
    documentation for in-depth coverage at [https://taskflow.github.io/taskflow/index.xhtml](https://taskflow.github.io/taskflow/index.xhtml).
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: Taskflow 库的功能非常丰富，提供了众多并行算法和性能分析功能的实现。请参阅官方文档以获取深入覆盖，链接为 [https://taskflow.github.io/taskflow/index.xhtml](https://taskflow.github.io/taskflow/index.xhtml)。
- en: Let’s move on to the next chapter and learn how to start working with Vulkan.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们继续进入下一章，学习如何开始使用 Vulkan。
