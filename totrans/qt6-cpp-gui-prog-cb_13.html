<html><head></head><body>
<div id="_idContainer240">
<h1 class="chapter-number" id="_idParaDest-265"><a id="_idTextAnchor265"/><span class="koboSpan" id="kobo.1.1">13</span></h1>
<h1 id="_idParaDest-266"><a id="_idTextAnchor266"/><span class="koboSpan" id="kobo.2.1">Developing Web Applications Using Qt WebEngine</span></h1>
<p><span class="koboSpan" id="kobo.3.1">Qt includes a module called </span><strong class="bold"><span class="koboSpan" id="kobo.4.1">Qt WebEngine</span></strong><span class="koboSpan" id="kobo.5.1"> that allows us to embed a web browser widget into our program and use it to display web pages or local HTML content. </span><span class="koboSpan" id="kobo.5.2">Prior to version 5.6, Qt used another similar module called </span><strong class="bold"><span class="koboSpan" id="kobo.6.1">Qt WebKit</span></strong><span class="koboSpan" id="kobo.7.1">, which is now deprecated and has since been replaced by the Chromium-based </span><strong class="bold"><span class="koboSpan" id="kobo.8.1">WebEngine</span></strong><span class="koboSpan" id="kobo.9.1"> module. </span><span class="koboSpan" id="kobo.9.2">Qt also allows communication between JavaScript and C++ code through </span><strong class="bold"><span class="koboSpan" id="kobo.10.1">Qt WebChannel</span></strong><span class="koboSpan" id="kobo.11.1">, which enables us to make use of this module in a much more </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">effective fashion.</span></span></p>
<p><span class="koboSpan" id="kobo.13.1">In this chapter, we will cover the </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">following recipes:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.15.1">Introducing </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.16.1">Qt WebEngine</span></strong></span></li>
<li><span class="koboSpan" id="kobo.17.1">Using </span><strong class="source-inline"><span class="koboSpan" id="kobo.18.1">webview</span></strong><span class="koboSpan" id="kobo.19.1"> and </span><span class="No-Break"><span class="koboSpan" id="kobo.20.1">web settings</span></span></li>
<li><span class="koboSpan" id="kobo.21.1">Embedding Google maps in </span><span class="No-Break"><span class="koboSpan" id="kobo.22.1">your project</span></span></li>
<li><span class="koboSpan" id="kobo.23.1">Calling C++ functions </span><span class="No-Break"><span class="koboSpan" id="kobo.24.1">from JavaScript</span></span></li>
<li><span class="koboSpan" id="kobo.25.1">Calling JavaScript functions </span><span class="No-Break"><span class="koboSpan" id="kobo.26.1">from C++</span></span></li>
</ul>
<h1 id="_idParaDest-267"><a id="_idTextAnchor267"/><span class="koboSpan" id="kobo.27.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.28.1">The technical requirements for this chapter include Qt 6.6.1 MSVC 2019 64 bit, Qt Creator 12.0.2, and Microsoft Visual Studio. </span><span class="koboSpan" id="kobo.28.2">All the code used in this chapter can be downloaded from the following GitHub </span><span class="No-Break"><span class="koboSpan" id="kobo.29.1">repository: </span></span><a href="https://github.com/PacktPublishing/QT6-C-GUI-Programming-Cookbook---Third-Edition-/tree/main/Chapter13"><span class="No-Break"><span class="koboSpan" id="kobo.30.1">https://github.com/PacktPublishing/QT6-C-GUI-Programming-Cookbook---Third-Edition-/tree/main/Chapter13</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.31.1">.</span></span></p>
<h1 id="_idParaDest-268"><a id="_idTextAnchor268"/><span class="koboSpan" id="kobo.32.1">Introducing Qt WebEngine</span></h1>
<p><span class="koboSpan" id="kobo.33.1">In this example project, we will explore the basic features of the </span><strong class="bold"><span class="koboSpan" id="kobo.34.1">WebEngine</span></strong><span class="koboSpan" id="kobo.35.1"> module in Qt and try building a simple working web browser. </span><span class="koboSpan" id="kobo.35.2">Since Qt 5.6, Qt’s </span><strong class="bold"><span class="koboSpan" id="kobo.36.1">WebKit</span></strong><span class="koboSpan" id="kobo.37.1"> module has been deprecated and </span><a id="_idIndexMarker832"/><span class="koboSpan" id="kobo.38.1">replaced by the </span><strong class="bold"><span class="koboSpan" id="kobo.39.1">WebEngine</span></strong><span class="koboSpan" id="kobo.40.1"> module, which is based on Google’s </span><span class="No-Break"><span class="koboSpan" id="kobo.41.1">Chromium engine.</span></span></p>
<h2 id="_idParaDest-269"><a id="_idTextAnchor269"/><span class="koboSpan" id="kobo.42.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.43.1">First, let’s set up our </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.44.1">WebEngine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.45.1"> project:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.46.1">At the moment, Qt’s </span><strong class="bold"><span class="koboSpan" id="kobo.47.1">WebEngine</span></strong><span class="koboSpan" id="kobo.48.1"> module only</span><a id="_idIndexMarker833"/><span class="koboSpan" id="kobo.49.1"> works with the Visual C++ compiler and not </span><a id="_idIndexMarker834"/><span class="koboSpan" id="kobo.50.1">others, such as </span><strong class="bold"><span class="koboSpan" id="kobo.51.1">MinGW</span></strong><span class="koboSpan" id="kobo.52.1"> or </span><strong class="bold"><span class="koboSpan" id="kobo.53.1">Cygwin</span></strong><span class="koboSpan" id="kobo.54.1">. </span><span class="koboSpan" id="kobo.54.2">This might change in the future, but it all depends </span><a id="_idIndexMarker835"/><span class="koboSpan" id="kobo.55.1">on whether Qt developers want to port it to other compilers or not. </span><span class="koboSpan" id="kobo.55.2">Make sure that the Qt version you installed on your computer supports the Visual C++ compiler. </span><span class="koboSpan" id="kobo.55.3">You can add the </span><strong class="bold"><span class="koboSpan" id="kobo.56.1">MSVC 2019 64-bit</span></strong><span class="koboSpan" id="kobo.57.1"> component to your Qt installation using Qt’s maintenance tool. </span><span class="koboSpan" id="kobo.57.2">Also, make sure that you have installed the </span><strong class="bold"><span class="koboSpan" id="kobo.58.1">Qt WebEngine</span></strong><span class="koboSpan" id="kobo.59.1"> component in your </span><span class="No-Break"><span class="koboSpan" id="kobo.60.1">Qt version:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer218">
<span class="koboSpan" id="kobo.61.1"><img alt="Figure 13.1 – Making sure MSVC 2019 and Qt WebEngine are installed" src="image/B20976_13_001.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.62.1">Figure 13.1 – Making sure MSVC 2019 and Qt WebEngine are installed</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.63.1">Open up Qt Creator and </span><a id="_idIndexMarker836"/><span class="koboSpan" id="kobo.64.1">create a new </span><strong class="bold"><span class="koboSpan" id="kobo.65.1">Qt Widgets Application</span></strong><span class="koboSpan" id="kobo.66.1"> project. </span><span class="koboSpan" id="kobo.66.2">Select a kit that uses the Visual </span><span class="No-Break"><span class="koboSpan" id="kobo.67.1">C++ compiler:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer219">
<span class="koboSpan" id="kobo.68.1"><img alt="Figure 13.2 – Only MSVC is officially supported by Qt WebEngine" src="image/B20976_13_002.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.69.1">Figure 13.2 – Only MSVC is officially supported by Qt WebEngine</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.70.1">Open up your project file (</span><strong class="source-inline"><span class="koboSpan" id="kobo.71.1">.pro</span></strong><span class="koboSpan" id="kobo.72.1">) and add the following modules to your project. </span><span class="koboSpan" id="kobo.72.2">After that, you must run </span><strong class="source-inline"><span class="koboSpan" id="kobo.73.1">qmake</span></strong><span class="koboSpan" id="kobo.74.1"> to apply </span><span class="No-Break"><span class="koboSpan" id="kobo.75.1">the changes:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.76.1">
QT += core gui </span><strong class="bold"><span class="koboSpan" id="kobo.77.1">webenginewidgets</span></strong></pre></li> <li><span class="koboSpan" id="kobo.78.1">Open up </span><strong class="source-inline"><span class="koboSpan" id="kobo.79.1">mainwindow.ui</span></strong><span class="koboSpan" id="kobo.80.1"> and </span><a id="_idIndexMarker837"/><span class="koboSpan" id="kobo.81.1">remove the </span><strong class="bold"><span class="koboSpan" id="kobo.82.1">menuBar</span></strong><span class="koboSpan" id="kobo.83.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.84.1">mainToolBar</span></strong><span class="koboSpan" id="kobo.85.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.86.1">statusBar</span></strong><span class="koboSpan" id="kobo.87.1"> objects, as we don’t need those in </span><span class="No-Break"><span class="koboSpan" id="kobo.88.1">this project:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer220">
<span class="koboSpan" id="kobo.89.1"><img alt="Figure 13.3 – Removing the menu bar, main toolbar, and status bar" src="image/B20976_13_003.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.90.1">Figure 13.3 – Removing the menu bar, main toolbar, and status bar</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.91.1">Place two horizontal layouts on the canvas, then place a </span><strong class="bold"><span class="koboSpan" id="kobo.92.1">Line Edit</span></strong><span class="koboSpan" id="kobo.93.1"> widget and a push button for the layout at </span><span class="No-Break"><span class="koboSpan" id="kobo.94.1">the top:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer221">
<span class="koboSpan" id="kobo.95.1"><img alt="Figure 13.4 – Placing the line edit widget and push button in a layout" src="image/B20976_13_004.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.96.1">Figure 13.4 – Placing the line edit widget and push button in a layout</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.97.1">Select the canvas and click on the </span><strong class="bold"><span class="koboSpan" id="kobo.98.1">Lay Out Vertically</span></strong><span class="koboSpan" id="kobo.99.1"> button located at the top of </span><span class="No-Break"><span class="koboSpan" id="kobo.100.1">the editor:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer222">
<span class="koboSpan" id="kobo.101.1"><img alt="Figure 13.5 – Clicking on the Lay Out Vertically button" src="image/B20976_13_005.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.102.1">Figure 13.5 – Clicking on the Lay Out Vertically button</span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.103.1">The layouts will expand and</span><a id="_idIndexMarker838"/><span class="koboSpan" id="kobo.104.1"> follow the size of the main window. </span><span class="koboSpan" id="kobo.104.2">The line edit will also expand horizontally, based on the width of the </span><span class="No-Break"><span class="koboSpan" id="kobo.105.1">horizontal layout:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer223">
<span class="koboSpan" id="kobo.106.1"><img alt="Figure 13.6 – The line edit is now expanding horizontally" src="image/B20976_13_006.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.107.1">Figure 13.6 – The line edit is now expanding horizontally</span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.108.1">Add two buttons to the left side of the line edit. </span><span class="koboSpan" id="kobo.108.2">We’ll use these two buttons to move backward and forward between page histories. </span><span class="koboSpan" id="kobo.108.3">Add a </span><strong class="bold"><span class="koboSpan" id="kobo.109.1">Progress Bar</span></strong><span class="koboSpan" id="kobo.110.1"> widget at the bottom of the main window so that we can find out whether the page has finished loading or is still in progress. </span><span class="koboSpan" id="kobo.110.2">We don’t have to worry about the horizontal layout in the middle at this point as we’ll be adding </span><strong class="source-inline"><span class="koboSpan" id="kobo.111.1">webview</span></strong><span class="koboSpan" id="kobo.112.1"> to it later at </span><em class="italic"><span class="koboSpan" id="kobo.113.1">step 15</span></em><span class="koboSpan" id="kobo.114.1"> using C++ code, and the space will </span><span class="No-Break"><span class="koboSpan" id="kobo.115.1">be occupied:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer224">
<span class="koboSpan" id="kobo.116.1"><img alt="Figure 13.7 – Adding two more buttons and a progress bar to the UI" src="image/B20976_13_007.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.117.1">Figure 13.7 – Adding two more buttons and a progress bar to the UI</span></p>
<ol>
<li value="9"><span class="koboSpan" id="kobo.118.1">Right-click on one of the buttons </span><a id="_idIndexMarker839"/><span class="koboSpan" id="kobo.119.1">and select </span><strong class="bold"><span class="koboSpan" id="kobo.120.1">Go to slot…</span></strong><span class="koboSpan" id="kobo.121.1">, then select </span><strong class="source-inline"><span class="koboSpan" id="kobo.122.1">clicked()</span></strong><span class="koboSpan" id="kobo.123.1"> and click </span><strong class="bold"><span class="koboSpan" id="kobo.124.1">OK</span></strong><span class="koboSpan" id="kobo.125.1">. </span><span class="koboSpan" id="kobo.125.2">A slot function will be automatically created for you in </span><strong class="source-inline"><span class="koboSpan" id="kobo.126.1">mainwindow.h</span></strong><span class="koboSpan" id="kobo.127.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.128.1">mainwindow.cpp</span></strong><span class="koboSpan" id="kobo.129.1">. </span><span class="koboSpan" id="kobo.129.2">Repeat this step for all the other buttons </span><span class="No-Break"><span class="koboSpan" id="kobo.130.1">as well.</span></span></li>
<li><span class="koboSpan" id="kobo.131.1">Right-click on the line edit and select </span><strong class="bold"><span class="koboSpan" id="kobo.132.1">Go to slot…</span></strong><span class="koboSpan" id="kobo.133.1">, then select </span><strong class="source-inline"><span class="koboSpan" id="kobo.134.1">returnPressed()</span></strong><span class="koboSpan" id="kobo.135.1"> and click </span><strong class="bold"><span class="koboSpan" id="kobo.136.1">OK</span></strong><span class="koboSpan" id="kobo.137.1">. </span><span class="koboSpan" id="kobo.137.2">Another slot function will now be automatically created for you in </span><strong class="source-inline"><span class="koboSpan" id="kobo.138.1">mainwindow.h</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.139.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.140.1">mainwindow.cpp</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.141.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.142.1">Let’s hop over to </span><strong class="source-inline"><span class="koboSpan" id="kobo.143.1">mainwindow.h</span></strong><span class="koboSpan" id="kobo.144.1">. </span><span class="koboSpan" id="kobo.144.2">The first thing we need to do is to add the following header </span><span class="No-Break"><span class="koboSpan" id="kobo.145.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.146.1">mainwindow.h</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.147.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.148.1">
#include &lt;QtWebEngineWidgets/QtWebEngineWidgets&gt;</span></pre></li> <li><span class="koboSpan" id="kobo.149.1">Declare a </span><strong class="source-inline"><span class="koboSpan" id="kobo.150.1">loadUrl()</span></strong><span class="koboSpan" id="kobo.151.1"> function under the </span><span class="No-Break"><span class="koboSpan" id="kobo.152.1">class destructor:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.153.1">
public:
    explicit MainWindow(QWidget *parent = 0);
    ~MainWindow();
    </span><strong class="bold"><span class="koboSpan" id="kobo.154.1">void loadUrl();</span></strong></pre></li> <li><span class="koboSpan" id="kobo.155.1">Add a custom slot function called </span><strong class="source-inline"><span class="koboSpan" id="kobo.156.1">loading()</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.157.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.158.1">mainwindow.h</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.159.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.160.1">
private slots:
    void on_goButton_clicked();
    void on_address_returnPressed();
    void on_backButton_clicked();
    void on_forwardButton_clicked();
    void loading(int progress);</span></pre></li> <li><span class="koboSpan" id="kobo.161.1">Declare a </span><strong class="source-inline"><span class="koboSpan" id="kobo.162.1">QWebEngineView</span></strong><span class="koboSpan" id="kobo.163.1"> object and call </span><span class="No-Break"><span class="koboSpan" id="kobo.164.1">it </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.165.1">webview</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.166.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.167.1">
private:
    Ui::MainWindow *ui;
    QWebEngineView* webview;</span></pre></li> <li><span class="koboSpan" id="kobo.168.1">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.169.1">mainwindow.cpp</span></strong><span class="koboSpan" id="kobo.170.1"> file and initiate the </span><strong class="source-inline"><span class="koboSpan" id="kobo.171.1">WebEngine</span></strong><span class="koboSpan" id="kobo.172.1"> view. </span><span class="koboSpan" id="kobo.172.2">Add it to the second horizontal layout and connect its </span><strong class="source-inline"><span class="koboSpan" id="kobo.173.1">loadProgress()</span></strong><span class="koboSpan" id="kobo.174.1"> signal to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.175.1">loading()</span></strong><span class="koboSpan" id="kobo.176.1"> slot function </span><a id="_idIndexMarker840"/><span class="koboSpan" id="kobo.177.1">we just added </span><span class="No-Break"><span class="koboSpan" id="kobo.178.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.179.1">mainwindow.h</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.180.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.181.1">
MainWindow::MainWindow(QWidget *parent) :
    QMainWindow(parent),
    ui(new Ui::MainWindow)
{
    ui-&gt;setupUi(this);
    </span><strong class="bold"><span class="koboSpan" id="kobo.182.1">webview = new QWebEngineView;</span></strong><span class="koboSpan" id="kobo.183.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.184.1">ui-&gt;horizontalLayout_2-&gt;addWidget(webview);</span></strong><span class="koboSpan" id="kobo.185.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.186.1">connect(webview, &amp;QWebEngineView::loadProgress, this,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.187.1">&amp;MainWindow::loading);</span></strong><span class="koboSpan" id="kobo.188.1">
}</span></pre></li> <li><span class="koboSpan" id="kobo.189.1">Declare what will happen when the </span><strong class="source-inline"><span class="koboSpan" id="kobo.190.1">loadUrl()</span></strong><span class="koboSpan" id="kobo.191.1"> function </span><span class="No-Break"><span class="koboSpan" id="kobo.192.1">is called:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.193.1">
void MainWindow::loadUrl() {
    QUrl url = QUrl(ui-&gt;address-&gt;text());
    url.setScheme("http");
    webview-&gt;page()-&gt;load(url);
}</span></pre></li> <li><span class="koboSpan" id="kobo.194.1">Call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.195.1">loadUrl()</span></strong><span class="koboSpan" id="kobo.196.1"> function </span><a id="_idIndexMarker841"/><span class="koboSpan" id="kobo.197.1">when the </span><strong class="bold"><span class="koboSpan" id="kobo.198.1">Go</span></strong><span class="koboSpan" id="kobo.199.1"> button is clicked or when the </span><em class="italic"><span class="koboSpan" id="kobo.200.1">Enter</span></em><span class="koboSpan" id="kobo.201.1"> key </span><span class="No-Break"><span class="koboSpan" id="kobo.202.1">is pressed:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.203.1">
void MainWindow::on_goButton_clicked() {
    loadUrl();
}
MainWindow::on_address_returnPressed() {
    loadUrl();
}</span></pre></li> <li><span class="koboSpan" id="kobo.204.1">As for the other two buttons, we’ll ask </span><strong class="source-inline"><span class="koboSpan" id="kobo.205.1">webview</span></strong><span class="koboSpan" id="kobo.206.1"> to load the previous page or the next page if it is available in the </span><span class="No-Break"><span class="koboSpan" id="kobo.207.1">history stack:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.208.1">
void MainWindow::on_backButton_clicked() {
    webview-&gt;back();
}
void MainWindow::on_forwardButton_clicked() {
    webview-&gt;forward();
}</span></pre></li> <li><span class="koboSpan" id="kobo.209.1">Change the value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.210.1">progressBar</span></strong><span class="koboSpan" id="kobo.211.1"> when the web page is </span><span class="No-Break"><span class="koboSpan" id="kobo.212.1">being loaded:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.213.1">
void MainWindow::loading(int progress) {
    ui-&gt;progressBar-&gt;setValue(progress);
}</span></pre></li> <li><span class="koboSpan" id="kobo.214.1">Build and run the program now, and you will get a very basic but functional </span><span class="No-Break"><span class="koboSpan" id="kobo.215.1">web browser:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer225">
<span class="koboSpan" id="kobo.216.1"><img alt="Figure 13.8 – We have created a simple web browser from scratch!" src="image/B20976_13_008.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.217.1">Figure 13.8 – We have created a simple web browser from scratch!</span></p>
<h2 id="_idParaDest-270"><a id="_idTextAnchor270"/><span class="koboSpan" id="kobo.218.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.219.1">The old </span><strong class="source-inline"><span class="koboSpan" id="kobo.220.1">webview</span></strong><span class="koboSpan" id="kobo.221.1"> system was </span><a id="_idIndexMarker842"/><span class="koboSpan" id="kobo.222.1">based on Apple’s </span><strong class="bold"><span class="koboSpan" id="kobo.223.1">WebKit</span></strong><span class="koboSpan" id="kobo.224.1"> engine and is only available in Qt 5.5 and its predecessor. </span><span class="koboSpan" id="kobo.224.2">Since 5.6, </span><strong class="bold"><span class="koboSpan" id="kobo.225.1">WebKit</span></strong><span class="koboSpan" id="kobo.226.1"> has been completely abandoned by Qt and replaced with Google’s </span><strong class="bold"><span class="koboSpan" id="kobo.227.1">Chromium</span></strong><span class="koboSpan" id="kobo.228.1"> engine. </span><span class="koboSpan" id="kobo.228.2">The API has been completely changed, and therefore all the code related to </span><strong class="bold"><span class="koboSpan" id="kobo.229.1">Qt WebKit</span></strong><span class="koboSpan" id="kobo.230.1"> will not work correctly once migrated to 5.6. </span><span class="koboSpan" id="kobo.230.2">If you’re new to Qt, it’s recommended you skip </span><strong class="bold"><span class="koboSpan" id="kobo.231.1">WebKit</span></strong><span class="koboSpan" id="kobo.232.1"> and learn the </span><strong class="bold"><span class="koboSpan" id="kobo.233.1">WebEngine</span></strong><span class="koboSpan" id="kobo.234.1"> API since it is becoming the new standard </span><span class="No-Break"><span class="koboSpan" id="kobo.235.1">in Qt.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.236.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.237.1">If you have used Qt’s </span><strong class="bold"><span class="koboSpan" id="kobo.238.1">WebKit</span></strong><span class="koboSpan" id="kobo.239.1"> in the past, this web page teaches you how to port your old code over to </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.240.1">WebEngine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.241.1">: </span></span><a href="https://wiki.qt.io/Porting_from_QtWebKit_to_QtWebEngine"><span class="No-Break"><span class="koboSpan" id="kobo.242.1">https://wiki.qt.io/Porting_from_QtWebKit_to_QtWebEngine</span></span></a></p>
<p><span class="koboSpan" id="kobo.243.1">In </span><em class="italic"><span class="koboSpan" id="kobo.244.1">step 15</span></em><span class="koboSpan" id="kobo.245.1"> in the previous section, we connected the </span><strong class="source-inline"><span class="koboSpan" id="kobo.246.1">loadProgress()</span></strong><span class="koboSpan" id="kobo.247.1"> signal that belongs to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.248.1">webview</span></strong><span class="koboSpan" id="kobo.249.1"> widget to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.250.1">loading()</span></strong><span class="koboSpan" id="kobo.251.1"> slot function. </span><span class="koboSpan" id="kobo.251.2">The signal will be called automatically when </span><strong class="source-inline"><span class="koboSpan" id="kobo.252.1">webview</span></strong><span class="koboSpan" id="kobo.253.1"> is loading the web page you requested by calling </span><strong class="source-inline"><span class="koboSpan" id="kobo.254.1">QWebEnginePage::load()</span></strong><span class="koboSpan" id="kobo.255.1"> in </span><em class="italic"><span class="koboSpan" id="kobo.256.1">step 17</span></em><span class="koboSpan" id="kobo.257.1">. </span><span class="koboSpan" id="kobo.257.2">You can also connect the </span><strong class="source-inline"><span class="koboSpan" id="kobo.258.1">loadStarted()</span></strong><span class="koboSpan" id="kobo.259.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.260.1">loadFinished()</span></strong><span class="koboSpan" id="kobo.261.1"> signals if you </span><span class="No-Break"><span class="koboSpan" id="kobo.262.1">need to.</span></span></p>
<p><span class="koboSpan" id="kobo.263.1">In </span><em class="italic"><span class="koboSpan" id="kobo.264.1">step 17</span></em><span class="koboSpan" id="kobo.265.1">, we used the </span><strong class="source-inline"><span class="koboSpan" id="kobo.266.1">QUrl</span></strong><span class="koboSpan" id="kobo.267.1"> class to convert the text obtained from the line edit to URL format. </span><span class="koboSpan" id="kobo.267.2">By default, the address we inserted will lead to the local path if we do not specify the URL scheme (HTTP, HTTPS, FTP, and so on). </span><span class="koboSpan" id="kobo.267.3">We may not be able to load the page if, say, we gave it </span><strong class="source-inline"><span class="koboSpan" id="kobo.268.1">google.com</span></strong><span class="koboSpan" id="kobo.269.1"> instead of </span><strong class="source-inline"><span class="koboSpan" id="kobo.270.1">http://google.com</span></strong><span class="koboSpan" id="kobo.271.1">. </span><span class="koboSpan" id="kobo.271.2">Therefore, we manually specified a URL scheme for it by calling </span><strong class="source-inline"><span class="koboSpan" id="kobo.272.1">QUrl::setScheme()</span></strong><span class="koboSpan" id="kobo.273.1">. </span><span class="koboSpan" id="kobo.273.2">This ensured the address is</span><a id="_idIndexMarker843"/><span class="koboSpan" id="kobo.274.1"> properly formatted before passing it </span><span class="No-Break"><span class="koboSpan" id="kobo.275.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.276.1">webview</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.277.1">.</span></span></p>
<h2 id="_idParaDest-271"><a id="_idTextAnchor271"/><span class="koboSpan" id="kobo.278.1">There’s more…</span></h2>
<p><span class="koboSpan" id="kobo.279.1">If for some reason you need the </span><strong class="bold"><span class="koboSpan" id="kobo.280.1">WebKit</span></strong><span class="koboSpan" id="kobo.281.1"> module for your project instead of </span><strong class="bold"><span class="koboSpan" id="kobo.282.1">WebEngine</span></strong><span class="koboSpan" id="kobo.283.1">, you can obtain the module code from GitHub and build it by </span><span class="No-Break"><span class="koboSpan" id="kobo.284.1">yourself: </span></span><a href="https://github.com/qt/qtwebkit"><span class="No-Break"><span class="koboSpan" id="kobo.285.1">https://github.com/qt/qtwebkit</span></span></a></p>
<h1 id="_idParaDest-272"><a id="_idTextAnchor272"/><span class="koboSpan" id="kobo.286.1">Using webview and web settings</span></h1>
<p><span class="koboSpan" id="kobo.287.1">In this recipe, we will dive deeper into the features available in Qt’s </span><strong class="bold"><span class="koboSpan" id="kobo.288.1">WebEngine</span></strong><span class="koboSpan" id="kobo.289.1"> module and explore the settings that we can use to customize our </span><strong class="source-inline"><span class="koboSpan" id="kobo.290.1">webview</span></strong><span class="koboSpan" id="kobo.291.1">. </span><span class="koboSpan" id="kobo.291.2">We will use the source files from the</span><a id="_idIndexMarker844"/><span class="koboSpan" id="kobo.292.1"> previous example and add more </span><a id="_idIndexMarker845"/><span class="koboSpan" id="kobo.293.1">code </span><span class="No-Break"><span class="koboSpan" id="kobo.294.1">to it.</span></span></p>
<h2 id="_idParaDest-273"><a id="_idTextAnchor273"/><span class="koboSpan" id="kobo.295.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.296.1">Let’s explore some of the</span><a id="_idIndexMarker846"/><span class="koboSpan" id="kobo.297.1"> basic features of the </span><strong class="bold"><span class="koboSpan" id="kobo.298.1">Qt </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.299.1">WebEngine</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.300.1"> module:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.301.1">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.302.1">mainwindow.ui</span></strong><span class="koboSpan" id="kobo.303.1"> and </span><a id="_idIndexMarker847"/><span class="koboSpan" id="kobo.304.1">add a vertical layout under the progress bar. </span><span class="koboSpan" id="kobo.304.2">Add a </span><strong class="bold"><span class="koboSpan" id="kobo.305.1">Plain Text Edit</span></strong><span class="koboSpan" id="kobo.306.1"> widget (under the </span><strong class="bold"><span class="koboSpan" id="kobo.307.1">Input Widgets</span></strong><span class="koboSpan" id="kobo.308.1"> category) and a push button to the vertical layout. </span><span class="koboSpan" id="kobo.308.2">Change the display of the push button to </span><strong class="bold"><span class="koboSpan" id="kobo.309.1">Load HTML</span></strong><span class="koboSpan" id="kobo.310.1"> and set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.311.1">plaintext</span></strong><span class="koboSpan" id="kobo.312.1"> property of the </span><strong class="bold"><span class="koboSpan" id="kobo.313.1">Plain Text Edit</span></strong><span class="koboSpan" id="kobo.314.1"> widget to </span><span class="No-Break"><span class="koboSpan" id="kobo.315.1">the following:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.316.1">
&lt;Img src="https://www.google.com/images/branding/googlelogo/1x/googlelogo_color_272x92dp.png"&gt;&lt;/img&gt;
&lt;h1&gt;Hello World!&lt;/h1&gt;
&lt;h3&gt;This is our custom HTML page.&lt;/h3&gt;
&lt;script&gt;alert("Hello!");&lt;/script&gt;</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.317.1">This is how it should look after </span><a id="_idIndexMarker848"/><span class="koboSpan" id="kobo.318.1">you have added the code</span><a id="_idIndexMarker849"/><span class="koboSpan" id="kobo.319.1"> on top of the </span><strong class="bold"><span class="koboSpan" id="kobo.320.1">Plain Text </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.321.1">Edit</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.322.1"> widget:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer226">
<span class="koboSpan" id="kobo.323.1"><img alt="Figure 13.9 – Adding a Plain Text Edit widget and a push button to the bottom" src="image/B20976_13_009.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.324.1">Figure 13.9 – Adding a Plain Text Edit widget and a push button to the bottom</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.325.1">Go to </span><strong class="bold"><span class="koboSpan" id="kobo.326.1">File</span></strong><span class="koboSpan" id="kobo.327.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.328.1">New File</span></strong><span class="koboSpan" id="kobo.329.1">. </span><span class="koboSpan" id="kobo.329.2">A </span><a id="_idIndexMarker850"/><span class="koboSpan" id="kobo.330.1">window will pop up and ask you to choose </span><a id="_idIndexMarker851"/><span class="koboSpan" id="kobo.331.1">a file template. </span><span class="koboSpan" id="kobo.331.2">Select </span><strong class="bold"><span class="koboSpan" id="kobo.332.1">Qt Resource File</span></strong><span class="koboSpan" id="kobo.333.1"> under the </span><strong class="bold"><span class="koboSpan" id="kobo.334.1">Qt</span></strong><span class="koboSpan" id="kobo.335.1"> category and click on the </span><strong class="bold"><span class="koboSpan" id="kobo.336.1">Choose…</span></strong><span class="koboSpan" id="kobo.337.1"> button. </span><span class="koboSpan" id="kobo.337.2">Type in your desired filename and click </span><strong class="bold"><span class="koboSpan" id="kobo.338.1">Next</span></strong><span class="koboSpan" id="kobo.339.1">, followed </span><span class="No-Break"><span class="koboSpan" id="kobo.340.1">by </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.341.1">Finish</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.342.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer227">
<span class="koboSpan" id="kobo.343.1"><img alt="Figure 13.10 – Creating a Qt resource file" src="image/B20976_13_010.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.344.1">Figure 13.10 – Creating a Qt resource file</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.345.1">Open the resource file </span><a id="_idIndexMarker852"/><span class="koboSpan" id="kobo.346.1">we just created by right-clicking on it in the </span><strong class="bold"><span class="koboSpan" id="kobo.347.1">Projects</span></strong><span class="koboSpan" id="kobo.348.1"> pane and selecting the </span><strong class="bold"><span class="koboSpan" id="kobo.349.1">Open in Editor</span></strong><span class="koboSpan" id="kobo.350.1"> option. </span><span class="koboSpan" id="kobo.350.2">Once the</span><a id="_idIndexMarker853"/><span class="koboSpan" id="kobo.351.1"> file is opened by the editor, click on the </span><strong class="bold"><span class="koboSpan" id="kobo.352.1">Add</span></strong><span class="koboSpan" id="kobo.353.1"> button, followed by </span><strong class="bold"><span class="koboSpan" id="kobo.354.1">Add Prefix</span></strong><span class="koboSpan" id="kobo.355.1">. </span><span class="koboSpan" id="kobo.355.2">Set the prefix as </span><strong class="source-inline"><span class="koboSpan" id="kobo.356.1">/</span></strong><span class="koboSpan" id="kobo.357.1"> and click </span><strong class="bold"><span class="koboSpan" id="kobo.358.1">Add</span></strong><span class="koboSpan" id="kobo.359.1">, followed </span><a id="_idIndexMarker854"/><span class="koboSpan" id="kobo.360.1">by </span><strong class="bold"><span class="koboSpan" id="kobo.361.1">Add Files</span></strong><span class="koboSpan" id="kobo.362.1">. </span><span class="koboSpan" id="kobo.362.2">A file browser window will </span><a id="_idIndexMarker855"/><span class="koboSpan" id="kobo.363.1">appear, and we will select the </span><strong class="source-inline"><span class="koboSpan" id="kobo.364.1">tux.png</span></strong><span class="koboSpan" id="kobo.365.1"> image file and click </span><strong class="bold"><span class="koboSpan" id="kobo.366.1">Open</span></strong><span class="koboSpan" id="kobo.367.1">. </span><span class="koboSpan" id="kobo.367.2">The image file is now added to our project, where it will be embedded into the executable file (</span><strong class="source-inline"><span class="koboSpan" id="kobo.368.1">.exe</span></strong><span class="koboSpan" id="kobo.369.1">) once </span><span class="No-Break"><span class="koboSpan" id="kobo.370.1">it’s compiled:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer228">
<span class="koboSpan" id="kobo.371.1"><img alt="Figure 13.11 – Adding the tux.png image file to our resource file" src="image/B20976_13_011.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.372.1">Figure 13.11 – Adding the tux.png image file to our resource file</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.373.1">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.374.1">mainwindow.h</span></strong><span class="koboSpan" id="kobo.375.1"> and add</span><a id="_idIndexMarker856"/><span class="koboSpan" id="kobo.376.1"> the following headers </span><a id="_idIndexMarker857"/><span class="No-Break"><span class="koboSpan" id="kobo.377.1">to it:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.378.1">
#include &lt;QMainWindow&gt;
</span><strong class="bold"><span class="koboSpan" id="kobo.379.1">#include &lt;QtWebEngineWidgets/QtWebEngineWidgets&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.380.1">#include &lt;QDebug&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.381.1">#include &lt;QFile&gt;</span></strong></pre></li> <li><span class="koboSpan" id="kobo.382.1">Make sure the following functions and </span><a id="_idIndexMarker858"/><span class="koboSpan" id="kobo.383.1">pointers have been</span><a id="_idIndexMarker859"/><span class="koboSpan" id="kobo.384.1"> declared </span><span class="No-Break"><span class="koboSpan" id="kobo.385.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.386.1">mainwindow.h</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.387.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.388.1">
public:
    explicit MainWindow(QWidget *parent = 0);
    ~MainWindow();
    </span><strong class="bold"><span class="koboSpan" id="kobo.389.1">void loadUrl();</span></strong><span class="koboSpan" id="kobo.390.1">
private slots:
    </span><strong class="bold"><span class="koboSpan" id="kobo.391.1">void on_goButton_clicked();</span></strong><span class="koboSpan" id="kobo.392.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.393.1">void on_address_returnPressed();</span></strong><span class="koboSpan" id="kobo.394.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.395.1">void on_backButton_clicked();</span></strong><span class="koboSpan" id="kobo.396.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.397.1">void on_forwardButton_clicked();</span></strong><span class="koboSpan" id="kobo.398.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.399.1">void startLoading();</span></strong><span class="koboSpan" id="kobo.400.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.401.1">void loading(int progress);</span></strong><span class="koboSpan" id="kobo.402.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.403.1">void loaded(bool ok);</span></strong><span class="koboSpan" id="kobo.404.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.405.1">void on_loadHtml_clicked();</span></strong><span class="koboSpan" id="kobo.406.1">
private:
    Ui::MainWindow *ui;
    </span><strong class="bold"><span class="koboSpan" id="kobo.407.1">QWebEngineView* webview;</span></strong></pre></li> <li><span class="koboSpan" id="kobo.408.1">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.409.1">mainwindow.cpp</span></strong><span class="koboSpan" id="kobo.410.1"> and </span><a id="_idIndexMarker860"/><span class="koboSpan" id="kobo.411.1">add the following </span><a id="_idIndexMarker861"/><span class="koboSpan" id="kobo.412.1">code to the </span><a id="_idIndexMarker862"/><span class="No-Break"><span class="koboSpan" id="kobo.413.1">class</span></span><span class="No-Break"><a id="_idIndexMarker863"/></span><span class="No-Break"><span class="koboSpan" id="kobo.414.1"> constructor:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.415.1">
MainWindow::MainWindow(QWidget *parent) :
    QMainWindow(parent),
    ui(new Ui::MainWindow)
{
    ui-&gt;setupUi(this);
    </span><strong class="bold"><span class="koboSpan" id="kobo.416.1">webview = new QWebEngineView;</span></strong><span class="koboSpan" id="kobo.417.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.418.1">ui-&gt;horizontalLayout_2-&gt;addWidget(webview);</span></strong><span class="koboSpan" id="kobo.419.1">
   </span><strong class="bold"><span class="koboSpan" id="kobo.420.1">//webview-&gt;page()-&gt;settings()-&gt;setAttribute(QWebEngineSettings::JavascriptEnabled, false);</span></strong><span class="koboSpan" id="kobo.421.1">
   </span><strong class="bold"><span class="koboSpan" id="kobo.422.1">//webview-&gt;page()-&gt;settings()-&gt;setAttribute(QWebEngineSettings::AutoLoadImages, false);</span></strong><span class="koboSpan" id="kobo.423.1">
   </span><strong class="bold"><span class="koboSpan" id="kobo.424.1">//QString fontFamily = webview-&gt;page()-&gt;settings()-&gt;fontFamily(QWebEngineSettings::SerifFont);</span></strong><span class="koboSpan" id="kobo.425.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.426.1">QString fontFamily = webview-&gt;page()-&gt;settings()-&gt;fontFamily(QWebEngineSettings::SansSerifFont);</span></strong><span class="koboSpan" id="kobo.427.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.428.1">int fontSize = webview-&gt;page()-&gt;settings()-&gt;fontSize(QWebEngineSettings::MinimumFontSize);</span></strong><span class="koboSpan" id="kobo.429.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.430.1">QFont myFont = QFont(fontFamily, fontSize);</span></strong><span class="koboSpan" id="kobo.431.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.432.1">webview-&gt;page()-&gt;settings()-&gt;setFontFamily(QWebEngineSettings::StandardFont, myFont.family());</span></strong></pre></li> <li><span class="koboSpan" id="kobo.433.1">Load the</span><a id="_idIndexMarker864"/><span class="koboSpan" id="kobo.434.1"> image file and</span><a id="_idIndexMarker865"/><span class="koboSpan" id="kobo.435.1"> place it </span><a id="_idIndexMarker866"/><span class="No-Break"><span class="koboSpan" id="kobo.436.1">on </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.437.1">webview</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.438.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.439.1">
    QFile file("://tux.png");
    if (file.open(QFile::ReadOnly)) {
        QByteArray data = file.readAll();
        webview-&gt;page()-&gt;setContent(data, "image/png");
    }
    else {
        qDebug() &lt;&lt; "File cannot be opened.";
    }
    connect(webview, &amp;QWebEngineView::loadStarted, this, &amp;MainWindow::startLoading()));
    connect(webview, &amp;QWebEngineView::loadProgress, this, &amp;MainWindow::loading(int)));
    connect(webview, &amp;QWebEngineView::loadFinished, this, &amp;MainWindow::loaded(bool)));
}</span></pre></li> <li><span class="koboSpan" id="kobo.440.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.441.1">MainWindow::loadUrl()</span></strong><span class="koboSpan" id="kobo.442.1"> function stays the same as in the previous example in the </span><em class="italic"><span class="koboSpan" id="kobo.443.1">Introducing Qt WebEngine</span></em><span class="koboSpan" id="kobo.444.1"> recipe, which sets the URL scheme to HTTP before loading </span><span class="No-Break"><span class="koboSpan" id="kobo.445.1">the </span></span><span class="No-Break"><a id="_idIndexMarker867"/></span><span class="No-Break"><span class="koboSpan" id="kobo.446.1">page:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.447.1">
void MainWindow::loadUrl() {
    QUrl url = QUrl(ui-&gt;address-&gt;text());
    url.setScheme("http");
    webview-&gt;page()-&gt;load(url);
}</span></pre></li> <li><span class="koboSpan" id="kobo.448.1">The same goes for the</span><a id="_idIndexMarker868"/><span class="koboSpan" id="kobo.449.1"> following functions, which also</span><a id="_idIndexMarker869"/><span class="koboSpan" id="kobo.450.1"> remain the same as the previous example </span><a id="_idIndexMarker870"/><span class="koboSpan" id="kobo.451.1">in the </span><em class="italic"><span class="koboSpan" id="kobo.452.1">Introducing Qt </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.453.1">WebEngine</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.454.1"> recipe:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.455.1">
void MainWindow::on_goButton_clicked() {
    loadUrl();
}
void MainWindow::on_address_returnPressed() {
    loadUrl();
}
void MainWindow::on_backButton_clicked() {
    webview-&gt;back();
}
void MainWindow::on_forwardButton_clicked() {
    webview-&gt;forward();
}</span></pre></li> <li><span class="koboSpan" id="kobo.456.1">Add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.457.1">MainWindow::startLoading()</span></strong><span class="koboSpan" id="kobo.458.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.459.1">MainWindow::loaded()</span></strong><span class="koboSpan" id="kobo.460.1"> slot functions, which will be called by the </span><strong class="source-inline"><span class="koboSpan" id="kobo.461.1">loadStarted()</span></strong><span class="koboSpan" id="kobo.462.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.463.1">loadFinished()</span></strong><span class="koboSpan" id="kobo.464.1"> signals. </span><span class="koboSpan" id="kobo.464.2">These two functions basically show a progress bar when </span><a id="_idIndexMarker871"/><span class="koboSpan" id="kobo.465.1">a page is starting to load and hide the progress bar </span><a id="_idIndexMarker872"/><span class="koboSpan" id="kobo.466.1">when the page has </span><span class="No-Break"><span class="koboSpan" id="kobo.467.1">finished loading:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.468.1">
void MainWindow::startLoading() {
    ui-&gt;progressBar-&gt;show();
}
void MainWindow::loading(int progress) {
    ui-&gt;progressBar-&gt;setValue(progress);
}
void MainWindow::loaded(bool ok) {
    ui-&gt;progressBar-&gt;hide();
}</span></pre></li> <li><span class="koboSpan" id="kobo.469.1">Call </span><strong class="source-inline"><span class="koboSpan" id="kobo.470.1">webview-&gt;loadHtml()</span></strong><span class="koboSpan" id="kobo.471.1"> to convert </span><a id="_idIndexMarker873"/><span class="koboSpan" id="kobo.472.1">the plain text to HTML </span><a id="_idIndexMarker874"/><span class="koboSpan" id="kobo.473.1">content when the </span><strong class="bold"><span class="koboSpan" id="kobo.474.1">Load HTML</span></strong><span class="koboSpan" id="kobo.475.1"> button </span><span class="No-Break"><span class="koboSpan" id="kobo.476.1">is clicked:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.477.1">
void MainWindow::on_loadHtml_clicked() {
    webview-&gt;setHtml(ui-&gt;source-&gt;toPlainText());
}</span></pre></li> <li><span class="koboSpan" id="kobo.478.1">Build and run the program, and you should see something like </span><span class="No-Break"><span class="koboSpan" id="kobo.479.1">the following:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer229">
<span class="koboSpan" id="kobo.480.1"><img alt="Figure 13.12 –webview will now display the result generated from your HTML code" src="image/B20976_13_012.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.481.1">Figure 13.12 –webview will now display the result generated from your HTML code</span></p>
<h2 id="_idParaDest-274"><a id="_idTextAnchor274"/><span class="koboSpan" id="kobo.482.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.483.1">In this example, we used C++ to load an image</span><a id="_idIndexMarker875"/><span class="koboSpan" id="kobo.484.1"> file and set it as </span><strong class="source-inline"><span class="koboSpan" id="kobo.485.1">webview</span></strong><span class="koboSpan" id="kobo.486.1"> default content (instead of a blank page). </span><span class="koboSpan" id="kobo.486.2">We</span><a id="_idIndexMarker876"/><span class="koboSpan" id="kobo.487.1"> could </span><a id="_idIndexMarker877"/><span class="koboSpan" id="kobo.488.1">achieve the same result by loading a default HTML file with an image </span><span class="No-Break"><span class="koboSpan" id="kobo.489.1">at startup.</span></span></p>
<p><span class="koboSpan" id="kobo.490.1">Some of the code in the class constructor has been commented out. </span><span class="koboSpan" id="kobo.490.2">You can remove the double slashes (</span><strong class="source-inline"><span class="koboSpan" id="kobo.491.1">//</span></strong><span class="koboSpan" id="kobo.492.1">) and see the difference it makes – the JavaScript alert will no longer appear (since JavaScript</span><a id="_idIndexMarker878"/><span class="koboSpan" id="kobo.493.1"> is disabled) and images will no longer appear in </span><span class="No-Break"><span class="koboSpan" id="kobo.494.1">your </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.495.1">webview</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.496.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.497.1">Another thing you can try is to change the font family from </span><strong class="source-inline"><span class="koboSpan" id="kobo.498.1">QWebEngineSettings::SansSerifFont</span></strong><span class="koboSpan" id="kobo.499.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.500.1">QWebEngineSettings::SerifFont</span></strong><span class="koboSpan" id="kobo.501.1">. </span><span class="koboSpan" id="kobo.501.2">You will notice a slight difference in the font as it appears </span><span class="No-Break"><span class="koboSpan" id="kobo.502.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.503.1">webview</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.504.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer230">
<span class="koboSpan" id="kobo.505.1"><img alt="Figure 13.13 – Different types of font showing in webview" src="image/B20976_13_013.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.506.1">Figure 13.13 – Different types of font showing in webview</span></p>
<p><span class="koboSpan" id="kobo.507.1">By clicking the </span><strong class="bold"><span class="koboSpan" id="kobo.508.1">Load HTML</span></strong><span class="koboSpan" id="kobo.509.1"> button, we </span><a id="_idIndexMarker879"/><span class="koboSpan" id="kobo.510.1">ask </span><strong class="source-inline"><span class="koboSpan" id="kobo.511.1">webview</span></strong><span class="koboSpan" id="kobo.512.1"> to treat the content of the </span><strong class="bold"><span class="koboSpan" id="kobo.513.1">Plain Text Edit</span></strong><span class="koboSpan" id="kobo.514.1"> widget as HTML code</span><a id="_idIndexMarker880"/><span class="koboSpan" id="kobo.515.1"> and load it as an HTML page. </span><span class="koboSpan" id="kobo.515.2">You can use this to make a simple HTML editor powered </span><span class="No-Break"><span class="koboSpan" id="kobo.516.1">by Qt!</span></span></p>
<h1 id="_idParaDest-275"><a id="_idTextAnchor275"/><span class="koboSpan" id="kobo.517.1">Embedding Google maps in your project</span></h1>
<p><span class="koboSpan" id="kobo.518.1">In this recipe, we will learn how to embed Google maps in our project through Qt’s </span><strong class="bold"><span class="koboSpan" id="kobo.519.1">WebEngine</span></strong><span class="koboSpan" id="kobo.520.1"> module. </span><span class="koboSpan" id="kobo.520.2">This </span><a id="_idIndexMarker881"/><span class="koboSpan" id="kobo.521.1">example doesn’t focus much on Qt and C++, but rather on the </span><strong class="bold"><span class="koboSpan" id="kobo.522.1">Google Maps</span></strong><span class="koboSpan" id="kobo.523.1"> API in </span><span class="No-Break"><span class="koboSpan" id="kobo.524.1">HTML code.</span></span></p>
<h2 id="_idParaDest-276"><a id="_idTextAnchor276"/><span class="koboSpan" id="kobo.525.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.526.1">Let’s create a program that displays Google maps by following </span><span class="No-Break"><span class="koboSpan" id="kobo.527.1">these steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.528.1">Create a new </span><strong class="bold"><span class="koboSpan" id="kobo.529.1">Qt Widgets Application</span></strong><span class="koboSpan" id="kobo.530.1"> project and remove the </span><strong class="bold"><span class="koboSpan" id="kobo.531.1">statusBar</span></strong><span class="koboSpan" id="kobo.532.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.533.1">menuBar</span></strong><span class="koboSpan" id="kobo.534.1">, and </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.535.1">mainToolBar</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.536.1"> objects.</span></span></li>
<li><span class="koboSpan" id="kobo.537.1">Open your project file (</span><strong class="source-inline"><span class="koboSpan" id="kobo.538.1">.pro</span></strong><span class="koboSpan" id="kobo.539.1">) and add the following modules to </span><span class="No-Break"><span class="koboSpan" id="kobo.540.1">your project:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.541.1">
QT += core gui webenginewidgets</span></pre></li> <li><span class="koboSpan" id="kobo.542.1">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.543.1">mainwindow.ui</span></strong><span class="koboSpan" id="kobo.544.1"> and add a vertical layout to the canvas. </span><span class="koboSpan" id="kobo.544.2">Then, select the canvas and click</span><a id="_idIndexMarker882"/><span class="koboSpan" id="kobo.545.1"> the </span><strong class="bold"><span class="koboSpan" id="kobo.546.1">Lay Out Vertically</span></strong><span class="koboSpan" id="kobo.547.1"> button on top of the canvas. </span><span class="koboSpan" id="kobo.547.2">You will get </span><span class="No-Break"><span class="koboSpan" id="kobo.548.1">the following:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer231">
<span class="koboSpan" id="kobo.549.1"><img alt="Figure 13.14 – Adding a vertical layout to the central widget" src="image/B20976_13_014.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.550.1">Figure 13.14 – Adding a vertical layout to the central widget</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.551.1">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.552.1">mainwindow.cpp</span></strong><span class="koboSpan" id="kobo.553.1"> and add the following header to the top of the </span><span class="No-Break"><span class="koboSpan" id="kobo.554.1">source code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.555.1">
#include &lt;QtWebEngineWidgets/QWebEngineView&gt;</span></pre></li> <li><span class="koboSpan" id="kobo.556.1">Add the following code to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.557.1">MainWindow</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.558.1"> constructor:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.559.1">
MainWindow::MainWindow(QWidget *parent) :
    QMainWindow(parent),
    ui(new Ui::MainWindow)
{
    ui-&gt;setupUi(this);
    </span><strong class="bold"><span class="koboSpan" id="kobo.560.1">QWebEngineView* webview = new QWebEngineView;</span></strong><span class="koboSpan" id="kobo.561.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.562.1">QUrl url = QUrl("qrc:/map.html");</span></strong><span class="koboSpan" id="kobo.563.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.564.1">webview-&gt;page()-&gt;load(url);</span></strong><span class="koboSpan" id="kobo.565.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.566.1">ui-&gt;verticalLayout-&gt;addWidget(webview);</span></strong><span class="koboSpan" id="kobo.567.1">
}</span></pre></li> <li><span class="koboSpan" id="kobo.568.1">Go to </span><strong class="bold"><span class="koboSpan" id="kobo.569.1">File</span></strong><span class="koboSpan" id="kobo.570.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.571.1">New File</span></strong><span class="koboSpan" id="kobo.572.1"> and create a Qt resource file (</span><strong class="source-inline"><span class="koboSpan" id="kobo.573.1">.qrc</span></strong><span class="koboSpan" id="kobo.574.1">). </span><span class="koboSpan" id="kobo.574.2">We will add an HTML file to our project, </span><span class="No-Break"><span class="koboSpan" id="kobo.575.1">called </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.576.1">map.html</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.577.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer232">
<span class="koboSpan" id="kobo.578.1"><img alt="Figure 13.15 – Adding map.html to the resource file" src="image/B20976_13_015.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.579.1">Figure 13.15 – Adding map.html to the resource file</span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.580.1">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.581.1">map.html</span></strong><span class="koboSpan" id="kobo.582.1"> with your favorite text editor. </span><span class="koboSpan" id="kobo.582.2">It’s not recommended to open an HTML file using Qt </span><a id="_idIndexMarker883"/><span class="koboSpan" id="kobo.583.1">Creator as it does not provide any color coding for </span><span class="No-Break"><span class="koboSpan" id="kobo.584.1">HTML syntax.</span></span></li>
<li><span class="koboSpan" id="kobo.585.1">Start writing the HTML code by declaring important tags, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.586.1">&lt;html&gt;</span></strong><span class="koboSpan" id="kobo.587.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.588.1">&lt;head&gt;</span></strong><span class="koboSpan" id="kobo.589.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.590.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.591.1">&lt;body&gt;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.592.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.593.1">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
  &lt;/head&gt;
  &lt;body ondragstart="return false"&gt;
  &lt;/body&gt;
&lt;/html&gt;</span></pre></li> <li><span class="koboSpan" id="kobo.594.1">Add a </span><strong class="source-inline"><span class="koboSpan" id="kobo.595.1">&lt;div&gt;</span></strong><span class="koboSpan" id="kobo.596.1"> tag to the body and set its ID </span><span class="No-Break"><span class="koboSpan" id="kobo.597.1">as </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.598.1">map-canvas</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.599.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.600.1">
  &lt;body ondragstart="return false"&gt;
    &lt;div id="map-canvas" /&gt;
  &lt;/body&gt;</span></pre></li> <li><span class="koboSpan" id="kobo.601.1">Add the following code to the head of the </span><span class="No-Break"><span class="koboSpan" id="kobo.602.1">HTML document:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.603.1">
    &lt;meta name="viewport" content="initial-scale=1.0, userscalable=no" /&gt;
    &lt;style type="text/css"&gt;
    html { height: 100% }
    body { height: 100%; margin: 0; padding: 0 }
    #map-canvas { height: 100% }
    &lt;/style&gt;
    &lt;script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY_HERE&amp;libraries=drawing"&gt;&lt;/script&gt;</span></pre></li> <li><span class="koboSpan" id="kobo.604.1">Add the following code, also</span><a id="_idIndexMarker884"/><span class="koboSpan" id="kobo.605.1"> to the head of the HTML document, beneath the code we inserted in the </span><span class="No-Break"><span class="koboSpan" id="kobo.606.1">previous step:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.607.1">
    &lt;script type="text/javascript"&gt;
        var map;
        function initialize() {
// Add map
            var mapOptions =
            {
                center: new google.maps.LatLng(40.705311, -74.2581939), zoom: 6
            };
            map = new google.maps.Map(document.getElementById("mapcanvas"),mapOptions);
// Add event listener
            google.maps.event.addListener(map, 'zoom_changed',
   function() {
       //alert(map.getZoom());
            });</span></pre></li> <li><span class="koboSpan" id="kobo.608.1">Create a marker and </span><a id="_idIndexMarker885"/><span class="koboSpan" id="kobo.609.1">place it on </span><span class="No-Break"><span class="koboSpan" id="kobo.610.1">the map:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.611.1">
// Add marker
            var marker = new google.maps.Marker({
                position: new google.maps.LatLng(40.705311, -74.2581939),
                map: map,
                title: "Marker A",
});
            google.maps.event.addListener (marker, 'click', function()
            {
                map.panTo(marker.getPosition());
            });
            marker.setMap(map);</span></pre></li> <li><span class="koboSpan" id="kobo.612.1">Add a polyline to </span><span class="No-Break"><span class="koboSpan" id="kobo.613.1">the map:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.614.1">
// Add polyline
            var points = [ new google.maps.LatLng(39.8543, -73.2183), new google.maps.LatLng(41.705311, -75.2581939), new google.maps.LatLng(40.62388, -75.5483) ];
            var polyOptions = {
            path: points,
            strokeColor: '#FF0000',
            strokeOpacity: 1.0,
            strokeWeight: 2
            };
            historyPolyline = new google.maps.Polyline(polyOptions);
            historyPolyline.setMap(map);</span></pre></li> <li><span class="koboSpan" id="kobo.615.1">Add a </span><span class="No-Break"><span class="koboSpan" id="kobo.616.1">polygon </span></span><span class="No-Break"><a id="_idIndexMarker886"/></span><span class="No-Break"><span class="koboSpan" id="kobo.617.1">shape:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.618.1">
// Add polygon
            var points = [ new google.maps.LatLng(37.314166, -75.432), new google.maps.LatLng(40.2653, -74.4325), new google.maps.LatLng(38.8288, -76.5483) ];
                var polygon = new google.maps.Polygon({
                paths: points,
                fillColor: '#000000',
                fillOpacity: 0.2,
                strokeWeight: 3,
                strokeColor: '#fff000',
            });
            polygon.setMap(map);</span></pre></li> <li><span class="koboSpan" id="kobo.619.1">Create a drawing manager and apply it to </span><span class="No-Break"><span class="koboSpan" id="kobo.620.1">the map:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.621.1">
// Setup drawing manager
            var drawingManager = new google.maps.drawing.DrawingManager();
            drawingManager.setMap(map);
        }
        google.maps.event.addDomListener(window, 'load', initialize);
    &lt;/script&gt;</span></pre></li> <li><span class="koboSpan" id="kobo.622.1">Compile and run the project. </span><span class="koboSpan" id="kobo.622.2">You should see </span><span class="No-Break"><span class="koboSpan" id="kobo.623.1">the following:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer233">
<span class="koboSpan" id="kobo.624.1"><img alt="Figure 13.16 – You should see a marker, a polyline, and a triangle on the Google map" src="image/B20976_13_016.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.625.1">Figure 13.16 – You should see a marker, a polyline, and a triangle on the Google map</span></p>
<h2 id="_idParaDest-277"><a id="_idTextAnchor277"/><span class="koboSpan" id="kobo.626.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.627.1">Google allows you to embed </span><a id="_idIndexMarker887"/><span class="koboSpan" id="kobo.628.1">Google maps in a web page using its JavaScript library, called the </span><strong class="bold"><span class="koboSpan" id="kobo.629.1">Google Maps</span></strong><span class="koboSpan" id="kobo.630.1"> API. </span><span class="koboSpan" id="kobo.630.2">Through Qt’s </span><strong class="bold"><span class="koboSpan" id="kobo.631.1">WebEngine</span></strong><span class="koboSpan" id="kobo.632.1"> module, we can embed Google maps in our C++ project by loading an HTML file to our </span><strong class="source-inline"><span class="koboSpan" id="kobo.633.1">webview</span></strong><span class="koboSpan" id="kobo.634.1"> widget, which uses the </span><strong class="bold"><span class="koboSpan" id="kobo.635.1">Google Maps</span></strong><span class="koboSpan" id="kobo.636.1"> API. </span><span class="koboSpan" id="kobo.636.2">The only downside of this method is that we cannot load maps when there is no </span><span class="No-Break"><span class="koboSpan" id="kobo.637.1">internet connection.</span></span></p>
<p><span class="koboSpan" id="kobo.638.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.639.1">Google Maps</span></strong><span class="koboSpan" id="kobo.640.1"> API can be called by your website as Google allows it. </span><span class="koboSpan" id="kobo.640.2">Choose </span><a href="https://console.developers.google.com"><span class="koboSpan" id="kobo.641.1">the free API if your plan is for </span><span class="No-Break"><span class="koboSpan" id="kobo.642.1">heav</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.643.1">ier traffic.</span></span></p>
<p><span class="koboSpan" id="kobo.644.1">Go to </span><a href="https://console.developers.google.com"><span class="koboSpan" id="kobo.645.1">https://console.developers.google.com</span></a><span class="koboSpan" id="kobo.646.1"> to get a free key and replace </span><strong class="source-inline"><span class="koboSpan" id="kobo.647.1">YOUR_KEY_HERE</span></strong><span class="koboSpan" id="kobo.648.1"> in the JavaScript source path with the API key you obtained </span><span class="No-Break"><span class="koboSpan" id="kobo.649.1">from Google.</span></span></p>
<p><span class="koboSpan" id="kobo.650.1">We must define a </span><strong class="source-inline"><span class="koboSpan" id="kobo.651.1">&lt;div&gt;</span></strong><span class="koboSpan" id="kobo.652.1"> object, which serves as a container for the map. </span><span class="koboSpan" id="kobo.652.2">Then, when we initialize the map, we specify the ID of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.653.1">&lt;div&gt;</span></strong><span class="koboSpan" id="kobo.654.1"> object so that the </span><strong class="bold"><span class="koboSpan" id="kobo.655.1">Google Maps</span></strong><span class="koboSpan" id="kobo.656.1"> API knows which HTML element to look for when embedding the map. </span><span class="koboSpan" id="kobo.656.2">By default, we set the center of the map to the coordinates of New York and set the default zoom level to 6. </span><span class="koboSpan" id="kobo.656.3">Then, we add an event listener that gets triggered when the zoom level of the </span><span class="No-Break"><span class="koboSpan" id="kobo.657.1">map changes.</span></span></p>
<p><span class="koboSpan" id="kobo.658.1">Remove the double</span><a id="_idIndexMarker888"/><span class="koboSpan" id="kobo.659.1"> slashes (</span><strong class="source-inline"><span class="koboSpan" id="kobo.660.1">//</span></strong><span class="koboSpan" id="kobo.661.1">) from the code to see it in action. </span><span class="koboSpan" id="kobo.661.2">After that, we add a marker to the map through JavaScript. </span><span class="koboSpan" id="kobo.661.3">The marker also has an event listener attached to it, which will trigger the </span><strong class="source-inline"><span class="koboSpan" id="kobo.662.1">panTo()</span></strong><span class="koboSpan" id="kobo.663.1"> function when the marker </span><span class="No-Break"><span class="koboSpan" id="kobo.664.1">is clicked.</span></span></p>
<p><span class="koboSpan" id="kobo.665.1">It basically pans the map view to the marker that has been clicked. </span><span class="koboSpan" id="kobo.665.2">Although we have added the drawing manager to the map (the icon buttons beside the </span><strong class="bold"><span class="koboSpan" id="kobo.666.1">Map</span></strong><span class="koboSpan" id="kobo.667.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.668.1">Satellite</span></strong><span class="koboSpan" id="kobo.669.1"> buttons), which allows users to draw any type of shape on top of the map, it’s also possible to add shapes manually using JavaScript, similar to how we added a marker in </span><em class="italic"><span class="koboSpan" id="kobo.670.1">step 12</span></em><span class="koboSpan" id="kobo.671.1">, in the </span><em class="italic"><span class="koboSpan" id="kobo.672.1">How to do </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.673.1">it...</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.674.1"> section.</span></span></p>
<p><span class="koboSpan" id="kobo.675.1">Lastly, you may have noticed that headers are added to </span><strong class="source-inline"><span class="koboSpan" id="kobo.676.1">mainwindow.cpp</span></strong><span class="koboSpan" id="kobo.677.1"> instead of </span><strong class="source-inline"><span class="koboSpan" id="kobo.678.1">mainwindow.h</span></strong><span class="koboSpan" id="kobo.679.1">. </span><span class="koboSpan" id="kobo.679.2">This is totally fine unless you are declaring class pointers in </span><strong class="source-inline"><span class="koboSpan" id="kobo.680.1">mainwindow.h</span></strong><span class="koboSpan" id="kobo.681.1">—then, you have to include those headers </span><span class="No-Break"><span class="koboSpan" id="kobo.682.1">in it.</span></span></p>
<h1 id="_idParaDest-278"><a id="_idTextAnchor278"/><span class="koboSpan" id="kobo.683.1">Calling C++ functions from JavaScript</span></h1>
<p><span class="koboSpan" id="kobo.684.1">In this recipe, we will learn</span><a id="_idIndexMarker889"/><span class="koboSpan" id="kobo.685.1"> how to put our knowledge to use and create a </span><a id="_idIndexMarker890"/><span class="koboSpan" id="kobo.686.1">functional login screen using Qt </span><span class="No-Break"><span class="koboSpan" id="kobo.687.1">and SQLite.</span></span></p>
<h2 id="_idParaDest-279"><a id="_idTextAnchor279"/><span class="koboSpan" id="kobo.688.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.689.1">Let’s learn how to call C++ functions from JavaScript using the </span><span class="No-Break"><span class="koboSpan" id="kobo.690.1">following steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.691.1">Create a </span><strong class="bold"><span class="koboSpan" id="kobo.692.1">Qt Widgets Application</span></strong><span class="koboSpan" id="kobo.693.1"> project. </span><span class="koboSpan" id="kobo.693.2">Open the project file (</span><strong class="source-inline"><span class="koboSpan" id="kobo.694.1">.pro</span></strong><span class="koboSpan" id="kobo.695.1">) and add the following modules to </span><span class="No-Break"><span class="koboSpan" id="kobo.696.1">the project:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.697.1">
QT += core gui </span><strong class="bold"><span class="koboSpan" id="kobo.698.1">webenginewidgets</span></strong></pre></li> <li><span class="koboSpan" id="kobo.699.1">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.700.1">mainwindow.ui</span></strong><span class="koboSpan" id="kobo.701.1"> and delete the </span><strong class="bold"><span class="koboSpan" id="kobo.702.1">mainToolBar</span></strong><span class="koboSpan" id="kobo.703.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.704.1">menuBar</span></strong><span class="koboSpan" id="kobo.705.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.706.1">statusBar</span></strong><span class="koboSpan" id="kobo.707.1"> objects, as we don’t need any of these in this </span><span class="No-Break"><span class="koboSpan" id="kobo.708.1">example program.</span></span></li>
<li><span class="koboSpan" id="kobo.709.1">Add a vertical layout to the canvas, then select the canvas and click on the </span><strong class="bold"><span class="koboSpan" id="kobo.710.1">Lay Out Vertically</span></strong><span class="koboSpan" id="kobo.711.1"> button on top of </span><a id="_idIndexMarker891"/><span class="koboSpan" id="kobo.712.1">the canvas. </span><span class="koboSpan" id="kobo.712.2">Add a text label to the top of the vertical layout and set its text to </span><strong class="source-inline"><span class="koboSpan" id="kobo.713.1">Hello!</span></strong><span class="koboSpan" id="kobo.714.1">. </span><span class="koboSpan" id="kobo.714.2">Make its font bigger by setting its </span><strong class="source-inline"><span class="koboSpan" id="kobo.715.1">styleSheet</span></strong><span class="koboSpan" id="kobo.716.1"> property </span><a id="_idIndexMarker892"/><span class="No-Break"><span class="koboSpan" id="kobo.717.1">as follows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.718.1">
font: 75 26pt "MS Shell Dlg 2";</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.719.1">This is what it looks like after we applied the font properties to our </span><span class="No-Break"><span class="koboSpan" id="kobo.720.1">style sheet:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer234">
<span class="koboSpan" id="kobo.721.1"><img alt="Figure 13.17 – Applying the font property to the “Hello!” text" src="image/B20976_13_017.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.722.1">Figure 13.17 – Applying the font property to the “Hello!” </span><span class="koboSpan" id="kobo.722.2">text</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.723.1">Go to </span><strong class="bold"><span class="koboSpan" id="kobo.724.1">File</span></strong><span class="koboSpan" id="kobo.725.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.726.1">New File…</span></strong><span class="koboSpan" id="kobo.727.1"> and create a resource file. </span><span class="koboSpan" id="kobo.727.2">Add an empty HTML file and all the JavaScript files, CSS files, font files, and so on that belong to </span><strong class="bold"><span class="koboSpan" id="kobo.728.1">jQuery</span></strong><span class="koboSpan" id="kobo.729.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.730.1">Bootstrap</span></strong><span class="koboSpan" id="kobo.731.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.732.1">Font Awesome</span></strong><span class="koboSpan" id="kobo.733.1"> to your </span><span class="No-Break"><span class="koboSpan" id="kobo.734.1">project resources:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer235">
<span class="koboSpan" id="kobo.735.1"><img alt="Figure 13.18 – Adding all the files to the project’s resource" src="image/B20976_13_018.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.736.1">Figure 13.18 – Adding all the files to the project’s resource</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.737.1">Open your HTML file, which in</span><a id="_idIndexMarker893"/><span class="koboSpan" id="kobo.738.1"> this case is called </span><strong class="source-inline"><span class="koboSpan" id="kobo.739.1">test.html</span></strong><span class="koboSpan" id="kobo.740.1">. </span><span class="koboSpan" id="kobo.740.2">Link all the necessary JavaScript </span><a id="_idIndexMarker894"/><span class="koboSpan" id="kobo.741.1">and CSS files to the HTML source code, between the </span><strong class="source-inline"><span class="koboSpan" id="kobo.742.1">&lt;</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.743.1">head&gt;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.744.1"> tags:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.745.1">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;script src="qrc:///qtwebchannel/qwebchannel.js"&gt;&lt;/script&gt;
    &lt;script src="js/jquery.min.js"&gt;&lt;/script&gt;
    &lt;script src="js/bootstrap.js"&gt;&lt;/script&gt;
    &lt;link rel="stylesheet" type="text/css" href="css/bootstrap.css"&gt;
    &lt;link rel="stylesheet" type="text/css" href="css/fontawesome.css"&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;/body&gt;
&lt;/html&gt;</span></pre></li> <li><span class="koboSpan" id="kobo.746.1">Add the following</span><a id="_idIndexMarker895"/><span class="koboSpan" id="kobo.747.1"> JavaScript to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.748.1">&lt;head&gt;</span></strong><span class="koboSpan" id="kobo.749.1"> element, wrapped between the </span><strong class="source-inline"><span class="koboSpan" id="kobo.750.1">&lt;</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.751.1">script&gt;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.752.1"> tags:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.753.1">
&lt;script&gt;
    $(document).ready(function()
    {
        new QWebChannel(qt.webChannelTransport,
function(channel)
        {
            mainWindow = channel.objects.mainWindow;
        });
        $("#login").click(function(e) {
            e.preventDefault();
            var user = $("#username").val();
            var pass = $("#password").val();
            mainWindow.showLoginInfo(user, pass);
        });</span></pre></li> <li><span class="koboSpan" id="kobo.754.1">Print </span><strong class="bold"><span class="koboSpan" id="kobo.755.1">Good bye! </span></strong><span class="koboSpan" id="kobo.756.1">when </span><a id="_idIndexMarker896"/><span class="koboSpan" id="kobo.757.1">clicking on the </span><strong class="bold"><span class="koboSpan" id="kobo.758.1">changeText</span></strong><span class="koboSpan" id="kobo.759.1"> button with the </span><span class="No-Break"><span class="koboSpan" id="kobo.760.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.761.1">
        $("#changeText").click(function(e)
        {
            e.preventDefault();
            mainWindow.changeQtText("Good bye!");
        });
    });
&lt;/script&gt;</span></pre></li> <li><span class="koboSpan" id="kobo.762.1">Add the following </span><a id="_idIndexMarker897"/><span class="koboSpan" id="kobo.763.1">code to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.764.1">&lt;</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.765.1">body&gt;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.766.1"> element:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.767.1">
    &lt;div class="container-fluid"&gt;
        &lt;form id="example-form" action="#" class="container-fluid"&gt;
            &lt;div class="form-group"&gt;
                &lt;div class="col-md-12"&gt;&lt;h3&gt;Call C++ Function from Javascript&lt;/h3&gt;&lt;/div&gt;
                &lt;div class="col-md-12"&gt;
                &lt;div class="alert alert-info" role="alert"&gt;&lt;i class="fa fa-info-circle"&gt;&lt;/i&gt;
            &lt;span id="infotext"&gt;Click "Login" to send username and password variables to C++. </span><span class="koboSpan" id="kobo.767.2">Click "Change Cpp Text" to change the text label on Qt GUI.&lt;/span&gt;
            &lt;/div&gt;
            &lt;/div&gt;</span></pre></li> <li><span class="koboSpan" id="kobo.768.1">Continuing from the previous code, this time, we create input fields for username and password, with</span><a id="_idIndexMarker898"/><span class="koboSpan" id="kobo.769.1"> two buttons at the bottom called </span><strong class="bold"><span class="koboSpan" id="kobo.770.1">Login</span></strong><span class="koboSpan" id="kobo.771.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.772.1">Change </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.773.1">Cpp Text</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.774.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.775.1">
            &lt;div class="col-md-12"&gt;&lt;label&gt;Username:&lt;/label&gt;&lt;input id="username" type="text"&gt;&lt;p /&gt;
            &lt;/div&gt;
            &lt;div class="col-md-12"&gt;
            &lt;label&gt;Password:&lt;/label&gt; &lt;input id="password" type="password"&gt;&lt;p /&gt;
            &lt;/div&gt;
            &lt;div class="col-md-12"&gt;
            &lt;button id="login" class="btn btn-success" type="button"&gt;&lt;i class="fa fa-check"&gt;&lt;/i&gt; Login&lt;/button&gt;
            &lt;button id="changeText" class="btn btn-primary" type="button"&gt;
            &lt;i class="fa fa-pencil"&gt;&lt;/i&gt; Change Cpp Text&lt;/button&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/form&gt;
&lt;/div&gt;</span></pre></li> <li><span class="koboSpan" id="kobo.776.1">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.777.1">mainwindow.h</span></strong><span class="koboSpan" id="kobo.778.1"> and </span><a id="_idIndexMarker899"/><span class="koboSpan" id="kobo.779.1">add the following public </span><a id="_idIndexMarker900"/><span class="koboSpan" id="kobo.780.1">functions to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.781.1">MainWindow</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.782.1"> class:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.783.1">
public:
    explicit MainWindow(QWidget *parent = 0);
    ~MainWindow();
    </span><strong class="bold"><span class="koboSpan" id="kobo.784.1">Q_INVOKABLE void changeQtText(QString newText);</span></strong><span class="koboSpan" id="kobo.785.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.786.1">Q_INVOKABLE void showLoginInfo(QString user, QString pass);</span></strong></pre></li> <li><span class="koboSpan" id="kobo.787.1">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.788.1">mainwindow.cpp</span></strong><span class="koboSpan" id="kobo.789.1"> and add the following headers to the top of the </span><span class="No-Break"><span class="koboSpan" id="kobo.790.1">source code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.791.1">
#include &lt;QtWebEngineWidgets/QWebEngineView&gt;
#include &lt;QtWebChannel/QWebChannel&gt;
#include &lt;QMessageBox&gt;</span></pre></li> <li><span class="koboSpan" id="kobo.792.1">Add the following code to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.793.1">MainWindow</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.794.1"> constructor:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.795.1">
MainWindow::MainWindow(QWidget *parent) :
    QMainWindow(parent),
    ui(new Ui::MainWindow)
{
    </span><strong class="bold"><span class="koboSpan" id="kobo.796.1">qputenv("QTWEBENGINE_REMOTE_DEBUGGING", "1234");</span></strong><span class="koboSpan" id="kobo.797.1">
    ui-&gt;setupUi(this);
    </span><strong class="bold"><span class="koboSpan" id="kobo.798.1">QWebEngineView* webview = new QWebEngineView();</span></strong><span class="koboSpan" id="kobo.799.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.800.1">ui-&gt;verticalLayout-&gt;addWidget(webview);</span></strong><span class="koboSpan" id="kobo.801.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.802.1">QWebChannel* webChannel = new QWebChannel();</span></strong><span class="koboSpan" id="kobo.803.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.804.1">webChannel-&gt;registerObject("mainWindow", this);</span></strong><span class="koboSpan" id="kobo.805.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.806.1">webview-&gt;page()-&gt;setWebChannel(webChannel);</span></strong><span class="koboSpan" id="kobo.807.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.808.1">webview-&gt;page()-&gt;load(QUrl("qrc:///html/test.html"));</span></strong><span class="koboSpan" id="kobo.809.1">
}</span></pre></li> <li><span class="koboSpan" id="kobo.810.1">Declare what</span><a id="_idIndexMarker901"/><span class="koboSpan" id="kobo.811.1"> happens when </span><strong class="source-inline"><span class="koboSpan" id="kobo.812.1">changeQtText()</span></strong><span class="koboSpan" id="kobo.813.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.814.1">showLoginInfo()</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.815.1">are called:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.816.1">
void MainWindow::changeQtText(QString newText) {
    ui-&gt;label-&gt;setText(newText);
}
void MainWindow::showLoginInfo(QString user, QString pass) {
    QMessageBox::information(this, "Login info", "Username is " + user + " and password is " + pass);
}</span></pre></li> <li><span class="koboSpan" id="kobo.817.1">Compile and run the program; you should see something similar to the following screenshot. </span><span class="koboSpan" id="kobo.817.2">If you </span><a id="_idIndexMarker902"/><span class="koboSpan" id="kobo.818.1">click on the </span><strong class="bold"><span class="koboSpan" id="kobo.819.1">Change Cpp Text</span></strong><span class="koboSpan" id="kobo.820.1"> button, the word </span><strong class="bold"><span class="koboSpan" id="kobo.821.1">Hello!</span></strong><span class="koboSpan" id="kobo.822.1"> at the top will change to </span><strong class="bold"><span class="koboSpan" id="kobo.823.1">Goodbye!</span></strong><span class="koboSpan" id="kobo.824.1"> If you click on the </span><strong class="bold"><span class="koboSpan" id="kobo.825.1">Login</span></strong><span class="koboSpan" id="kobo.826.1"> button, a message box will appear and show you exactly what you typed in the </span><strong class="bold"><span class="koboSpan" id="kobo.827.1">Username</span></strong><span class="koboSpan" id="kobo.828.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.829.1">Password</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.830.1">input fields:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer236">
<span class="koboSpan" id="kobo.831.1"><img alt="Figure 13.19 – Clicking on the buttons to call C++ functions" src="image/B20976_13_019.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.832.1">Figure 13.19 – Clicking on the buttons to call C++ functions</span></p>
<h2 id="_idParaDest-280"><a id="_idTextAnchor280"/><span class="koboSpan" id="kobo.833.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.834.1">In this example, we </span><a id="_idIndexMarker903"/><span class="koboSpan" id="kobo.835.1">used two JavaScript libraries: </span><strong class="bold"><span class="koboSpan" id="kobo.836.1">jQuery</span></strong><span class="koboSpan" id="kobo.837.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.838.1">Bootstrap</span></strong><span class="koboSpan" id="kobo.839.1">. </span><span class="koboSpan" id="kobo.839.2">We also used an iconic font package called </span><strong class="bold"><span class="koboSpan" id="kobo.840.1">Font Awesome</span></strong><span class="koboSpan" id="kobo.841.1">. </span><span class="koboSpan" id="kobo.841.2">These third-party add-ons were used to make the HTML UI more interesting and responsive to different </span><span class="No-Break"><span class="koboSpan" id="kobo.842.1">screen resolutions.</span></span></p>
<p><span class="koboSpan" id="kobo.843.1">We also used </span><strong class="bold"><span class="koboSpan" id="kobo.844.1">jQuery</span></strong><span class="koboSpan" id="kobo.845.1"> to detect</span><a id="_idIndexMarker904"/><span class="koboSpan" id="kobo.846.1"> the document’s ready status, as well as</span><a href="https://jquery.com/download"><span class="koboSpan" id="kobo.847.1"> to obtain the values of </span><span class="No-Break"><span class="koboSpan" id="kobo.848.1">in</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.849.1">put fields.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.850.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.851.1">You can</span><a id="_idIndexMarker905"/><span class="koboSpan" id="kobo.852.1"> download </span><strong class="bold"><span class="koboSpan" id="kobo.853.1">jQuery</span></strong><span class="koboSpan" id="kobo.854.1"> from </span><a href="https://jquery.com/download"><span class="koboSpan" id="kobo.855.1">https://jquery.com/download</span></a><span class="koboSpan" id="kobo.856.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.857.1">Bootstrap</span></strong><span class="koboSpan" id="kobo.858.1"> from </span><a href="http://getbootstrap.com/getting-started/#download"><span class="koboSpan" id="kobo.859.1">http://getbootstrap.com/getting-started/#download</span></a><span class="koboSpan" id="kobo.860.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.861.1">Font Awesome</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.862.1">from </span></span><a href="http://fontawesome.io"><span class="No-Break"><span class="koboSpan" id="kobo.863.1">http://fontawesome.io</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.864.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.865.1">Qt’s </span><strong class="bold"><span class="koboSpan" id="kobo.866.1">WebEngine</span></strong><span class="koboSpan" id="kobo.867.1"> module uses a mechanism called </span><strong class="bold"><span class="koboSpan" id="kobo.868.1">WebChannel</span></strong><span class="koboSpan" id="kobo.869.1">, which enables </span><strong class="bold"><span class="koboSpan" id="kobo.870.1">peer-to-peer</span></strong><span class="koboSpan" id="kobo.871.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.872.1">P2P</span></strong><span class="koboSpan" id="kobo.873.1">) communication</span><a id="_idIndexMarker906"/><span class="koboSpan" id="kobo.874.1"> between the C++ program and the HTML page. </span><span class="koboSpan" id="kobo.874.2">The </span><strong class="bold"><span class="koboSpan" id="kobo.875.1">WebEngine</span></strong><span class="koboSpan" id="kobo.876.1"> module provides</span><a id="_idIndexMarker907"/><span class="koboSpan" id="kobo.877.1"> a JavaScript library that makes integration a lot easier. </span><span class="koboSpan" id="kobo.877.2">The JavaScript is </span><a id="_idIndexMarker908"/><span class="koboSpan" id="kobo.878.1">embedded in your project’s resource by default, so you don’t need to import it into your project manually. </span><span class="koboSpan" id="kobo.878.2">You just have to include it in your HTML page by calling </span><span class="No-Break"><span class="koboSpan" id="kobo.879.1">the following:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.880.1">
&lt;script src="qrc:///qtwebchannel/qwebchannel.js"&gt;&lt;/script&gt;</span></pre> <p><span class="koboSpan" id="kobo.881.1">Once you have included </span><strong class="source-inline"><span class="koboSpan" id="kobo.882.1">qwebchannel.js</span></strong><span class="koboSpan" id="kobo.883.1">, you can initialize the </span><strong class="source-inline"><span class="koboSpan" id="kobo.884.1">QWebChannel</span></strong><span class="koboSpan" id="kobo.885.1"> class and assign the Qt object we registered earlier in C++ to a </span><span class="No-Break"><span class="koboSpan" id="kobo.886.1">JavaScript variable.</span></span></p>
<p><span class="koboSpan" id="kobo.887.1">In C++, this is done </span><span class="No-Break"><span class="koboSpan" id="kobo.888.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.889.1">
QWebChannel* webChannel = new QWebChannel();
webChannel-&gt;registerObject("mainWindow", this);
webview-&gt;page()-&gt;setWebChannel(webChannel);</span></pre> <p><span class="koboSpan" id="kobo.890.1">Then, in JavaScript, this is done </span><span class="No-Break"><span class="koboSpan" id="kobo.891.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.892.1">
new QWebChannel(qt.webChannelTransport, function(channel) {
mainWindow = channel.objects.mainWindow;
});</span></pre> <p><span class="koboSpan" id="kobo.893.1">You may be wondering what this </span><span class="No-Break"><span class="koboSpan" id="kobo.894.1">line means:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.895.1">
qputenv("QTWEBENGINE_REMOTE_DEBUGGING", "1234");</span></pre> <p><span class="koboSpan" id="kobo.896.1">Qt’s </span><strong class="bold"><span class="koboSpan" id="kobo.897.1">WebEngine</span></strong><span class="koboSpan" id="kobo.898.1"> module uses the remote debugging method to check for JavaScript errors and other problems. </span><span class="koboSpan" id="kobo.898.2">The number </span><strong class="source-inline"><span class="koboSpan" id="kobo.899.1">1234</span></strong><span class="koboSpan" id="kobo.900.1"> defines the port number you want to use for </span><span class="No-Break"><span class="koboSpan" id="kobo.901.1">remote debugging.</span></span></p>
<p><span class="koboSpan" id="kobo.902.1">Once you have enabled remote debugging, you can access the debugging page by opening up a Chromium-based web browser, such as Google Chrome (this will not work in Firefox and other browsers), and typing in </span><strong class="source-inline"><span class="koboSpan" id="kobo.903.1">http://127.0.0.1:1234</span></strong><span class="koboSpan" id="kobo.904.1">. </span><span class="koboSpan" id="kobo.904.2">You will then see a page that looks </span><span class="No-Break"><span class="koboSpan" id="kobo.905.1">like this:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer237">
<span class="koboSpan" id="kobo.906.1"><img alt="Figure 13.20 – Inspectable pages allow you to debug more easily" src="image/B20976_13_020.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.907.1">Figure 13.20 – Inspectable pages allow you to debug more easily</span></p>
<p><span class="koboSpan" id="kobo.908.1">The first page will display all HTML pages that are currently running in your program, which in this case is </span><strong class="source-inline"><span class="koboSpan" id="kobo.909.1">test.html</span></strong><span class="koboSpan" id="kobo.910.1">. </span><span class="koboSpan" id="kobo.910.2">Click on the</span><a id="_idIndexMarker909"/><span class="koboSpan" id="kobo.911.1"> page link, and it will take you to another page for inspection. </span><span class="koboSpan" id="kobo.911.2">You</span><a id="_idIndexMarker910"/><span class="koboSpan" id="kobo.912.1"> can use this to check for CSS errors, JavaScript errors, and </span><span class="No-Break"><span class="koboSpan" id="kobo.913.1">missing files.</span></span></p>
<p><span class="koboSpan" id="kobo.914.1">Note that you should disable remote debugging once your program is bug-free and ready for deployment. </span><span class="koboSpan" id="kobo.914.2">This is because remote debugging takes time to initialize and will increase your program’s </span><span class="No-Break"><span class="koboSpan" id="kobo.915.1">startup time.</span></span></p>
<p><span class="koboSpan" id="kobo.916.1">If you want to call a C++ function from JavaScript, you must place the </span><strong class="source-inline"><span class="koboSpan" id="kobo.917.1">Q_INVOKABLE</span></strong><span class="koboSpan" id="kobo.918.1"> macro in front of the function’s declaration; otherwise, it will </span><span class="No-Break"><span class="koboSpan" id="kobo.919.1">not work:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.920.1">
Q_INVOKABLE void changeQtText(QString newText);</span></pre> <h1 id="_idParaDest-281"><a id="_idTextAnchor281"/><span class="koboSpan" id="kobo.921.1">Calling Javascript functions from C++</span></h1>
<p><span class="koboSpan" id="kobo.922.1">In the previous recipe, we learned how to</span><a id="_idIndexMarker911"/><span class="koboSpan" id="kobo.923.1"> call C++ functions from JavaScript through Qt’s </span><strong class="bold"><span class="koboSpan" id="kobo.924.1">WebChannel</span></strong><span class="koboSpan" id="kobo.925.1"> system. </span><span class="koboSpan" id="kobo.925.2">In this example, we will try to do the reverse: call </span><a id="_idIndexMarker912"/><span class="koboSpan" id="kobo.926.1">JavaScript functions from </span><span class="No-Break"><span class="koboSpan" id="kobo.927.1">C++ code.</span></span></p>
<h2 id="_idParaDest-282"><a id="_idTextAnchor282"/><span class="koboSpan" id="kobo.928.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.929.1">We can call JavaScript functions from C++ through the </span><span class="No-Break"><span class="koboSpan" id="kobo.930.1">following steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.931.1">Create a new </span><strong class="bold"><span class="koboSpan" id="kobo.932.1">Qt Widgets Application</span></strong><span class="koboSpan" id="kobo.933.1"> project and add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.934.1">webenginewidgets</span></strong><span class="koboSpan" id="kobo.935.1"> module to </span><span class="No-Break"><span class="koboSpan" id="kobo.936.1">your project.</span></span></li>
<li><span class="koboSpan" id="kobo.937.1">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.938.1">mainwindow.ui</span></strong><span class="koboSpan" id="kobo.939.1"> and remove the </span><strong class="bold"><span class="koboSpan" id="kobo.940.1">mainToolBar</span></strong><span class="koboSpan" id="kobo.941.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.942.1">menuBar</span></strong><span class="koboSpan" id="kobo.943.1">, and </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.944.1">statusBar</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.945.1"> objects.</span></span></li>
<li><span class="koboSpan" id="kobo.946.1">Add a vertical layout and a horizontal layout to the canvas. </span><span class="koboSpan" id="kobo.946.2">Select the canvas and click </span><strong class="bold"><span class="koboSpan" id="kobo.947.1">Lay Out Vertically</span></strong><span class="koboSpan" id="kobo.948.1">. </span><span class="koboSpan" id="kobo.948.2">Make </span><a id="_idIndexMarker913"/><span class="koboSpan" id="kobo.949.1">sure the horizontal layout is located at the bottom of the </span><span class="No-Break"><span class="koboSpan" id="kobo.950.1">vertical layout.</span></span></li>
<li><span class="koboSpan" id="kobo.951.1">Add two push </span><a id="_idIndexMarker914"/><span class="koboSpan" id="kobo.952.1">buttons to the horizontal layout; one is called </span><strong class="bold"><span class="koboSpan" id="kobo.953.1">Change HTML Text</span></strong><span class="koboSpan" id="kobo.954.1"> and the other is called </span><strong class="bold"><span class="koboSpan" id="kobo.955.1">Play UI Animation</span></strong><span class="koboSpan" id="kobo.956.1">. </span><span class="koboSpan" id="kobo.956.2">Right-click on one of the buttons and click </span><strong class="bold"><span class="koboSpan" id="kobo.957.1">Go to slot…</span></strong><span class="koboSpan" id="kobo.958.1">. </span><span class="koboSpan" id="kobo.958.2">A window will pop up and ask you to pick a signal. </span><span class="koboSpan" id="kobo.958.3">Select the </span><strong class="source-inline"><span class="koboSpan" id="kobo.959.1">clicked()</span></strong><span class="koboSpan" id="kobo.960.1"> option and click </span><strong class="bold"><span class="koboSpan" id="kobo.961.1">OK</span></strong><span class="koboSpan" id="kobo.962.1">. </span><span class="koboSpan" id="kobo.962.2">Qt will automatically add a slot function to your source code. </span><span class="koboSpan" id="kobo.962.3">Repeat this step for the </span><span class="No-Break"><span class="koboSpan" id="kobo.963.1">other button:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer238">
<span class="koboSpan" id="kobo.964.1"><img alt="Figure 13.21 – Placing the buttons in the bottom layout" src="image/B20976_13_021.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.965.1">Figure 13.21 – Placing the buttons in the bottom layout</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.966.1">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.967.1">mainwindow.h</span></strong><span class="koboSpan" id="kobo.968.1"> and add the following headers </span><span class="No-Break"><span class="koboSpan" id="kobo.969.1">to it:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.970.1">
#include &lt;QtWebEngineWidgets/QWebEngineView&gt;
#include &lt;QtWebChannel/QWebChannel&gt;
#include &lt;QMessageBox&gt;</span></pre></li> <li><span class="koboSpan" id="kobo.971.1">Declare the class pointer of a </span><strong class="source-inline"><span class="koboSpan" id="kobo.972.1">QWebEngineView</span></strong><span class="koboSpan" id="kobo.973.1"> object </span><span class="No-Break"><span class="koboSpan" id="kobo.974.1">called </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.975.1">webview</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.976.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.977.1">
public:
    explicit MainWindow(QWidget *parent = 0);
    ~MainWindow();
    </span><strong class="bold"><span class="koboSpan" id="kobo.978.1">QWebEngineView* webview;</span></strong></pre></li> <li><span class="koboSpan" id="kobo.979.1">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.980.1">mainwindow.cpp</span></strong><span class="koboSpan" id="kobo.981.1"> and add the</span><a id="_idIndexMarker915"/><span class="koboSpan" id="kobo.982.1"> following code to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.983.1">MainWindow</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.984.1"> constructor:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.985.1">
MainWindow::MainWindow(QWidget *parent) :
    QMainWindow(parent),
    ui(new Ui::MainWindow)
{
    </span><strong class="bold"><span class="koboSpan" id="kobo.986.1">//qputenv("QTWEBENGINE_REMOTE_DEBUGGING", "1234");</span></strong><span class="koboSpan" id="kobo.987.1">
    ui-&gt;setupUi(this);
    </span><strong class="bold"><span class="koboSpan" id="kobo.988.1">webview = new QWebEngineView();</span></strong><span class="koboSpan" id="kobo.989.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.990.1">ui-&gt;verticalLayout-&gt;addWidget(webview);</span></strong><span class="koboSpan" id="kobo.991.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.992.1">QWebChannel* webChannel = new QWebChannel();</span></strong><span class="koboSpan" id="kobo.993.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.994.1">webChannel-&gt;registerObject("mainWindow", this);</span></strong><span class="koboSpan" id="kobo.995.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.996.1">webview-&gt;page()-&gt;setWebChannel(webChannel);</span></strong><span class="koboSpan" id="kobo.997.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.998.1">webview-&gt;page()-&gt;load(QUrl("qrc:///html/test.html"));</span></strong><span class="koboSpan" id="kobo.999.1">
}</span></pre></li> <li><span class="koboSpan" id="kobo.1000.1">Define what will happen when the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1001.1">changeHtmlText</span></strong><span class="koboSpan" id="kobo.1002.1"> button and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1003.1">playUIAnimation</span></strong><span class="koboSpan" id="kobo.1004.1"> button </span><a id="_idIndexMarker916"/><span class="No-Break"><span class="koboSpan" id="kobo.1005.1">are clicked:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1006.1">
void MainWindow::on_changeHtmlTextButton_clicked() {
    webview-&gt;page()-&gt;runJavaScript("changeHtmlText('Text has been replaced by C++!');");
}
void MainWindow::on_playUIAnimationButton_clicked() {
    webview-&gt;page()-&gt;runJavaScript("startAnim();");
}</span></pre></li> <li><span class="koboSpan" id="kobo.1007.1">Let’s create a resource file for our project by going to </span><strong class="bold"><span class="koboSpan" id="kobo.1008.1">File</span></strong><span class="koboSpan" id="kobo.1009.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.1010.1">New File...</span></strong><span class="koboSpan" id="kobo.1011.1">. </span><span class="koboSpan" id="kobo.1011.2">Select </span><strong class="bold"><span class="koboSpan" id="kobo.1012.1">Qt Resource File</span></strong><span class="koboSpan" id="kobo.1013.1"> under the </span><strong class="bold"><span class="koboSpan" id="kobo.1014.1">Qt</span></strong><span class="koboSpan" id="kobo.1015.1"> category and click </span><strong class="bold"><span class="koboSpan" id="kobo.1016.1">Choose...</span></strong><span class="koboSpan" id="kobo.1017.1">. </span><span class="koboSpan" id="kobo.1017.2">Insert your desired filename and click </span><strong class="bold"><span class="koboSpan" id="kobo.1018.1">Next</span></strong><span class="koboSpan" id="kobo.1019.1">, followed </span><span class="No-Break"><span class="koboSpan" id="kobo.1020.1">by </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.1021.1">Finish</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1022.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1023.1">Add an empty HTML file and </span><a id="_idIndexMarker917"/><span class="koboSpan" id="kobo.1024.1">all the required add-ons (</span><strong class="bold"><span class="koboSpan" id="kobo.1025.1">jQuery</span></strong><span class="koboSpan" id="kobo.1026.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.1027.1">Bootstrap</span></strong><span class="koboSpan" id="kobo.1028.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.1029.1">Font Awesome</span></strong><span class="koboSpan" id="kobo.1030.1">) to the</span><a id="_idIndexMarker918"/><span class="koboSpan" id="kobo.1031.1"> project resources. </span><span class="koboSpan" id="kobo.1031.2">Add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1032.1">tux.png</span></strong><span class="koboSpan" id="kobo.1033.1"> image file to the resources file as well, as we’ll be using it in a short while in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1034.1">step 14</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1035.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1036.1">Open the HTML file we just created and add it to the project resources; in our case, it’s called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1037.1">test.html</span></strong><span class="koboSpan" id="kobo.1038.1">. </span><span class="koboSpan" id="kobo.1038.2">Add the following HTML code to </span><span class="No-Break"><span class="koboSpan" id="kobo.1039.1">the file:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1040.1">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;script src="qrc:///qtwebchannel/qwebchannel.js"&gt;&lt;/script&gt;
    &lt;script src="js/jquery.min.js"&gt;&lt;/script&gt;
    &lt;script src="js/bootstrap.js"&gt;&lt;/script&gt;
    &lt;link rel="stylesheet" type="text/css" href="css/bootstrap.css"&gt;
    &lt;link rel="stylesheet" type="text/css" href="css/fontawesome.css"&gt;
  &lt;/head&gt;
&lt;body&gt;
&lt;/body&gt;
&lt;/html&gt;</span></pre></li> <li><span class="koboSpan" id="kobo.1041.1">Add the following JavaScript code, which</span><a id="_idIndexMarker919"/><span class="koboSpan" id="kobo.1042.1"> is wrapped within the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1043.1">&lt;script&gt;</span></strong><span class="koboSpan" id="kobo.1044.1"> tags, to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1045.1">&lt;head&gt;</span></strong><span class="koboSpan" id="kobo.1046.1"> element </span><a id="_idIndexMarker920"/><span class="koboSpan" id="kobo.1047.1">of our </span><span class="No-Break"><span class="koboSpan" id="kobo.1048.1">HTML file:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1049.1">
    &lt;script&gt;
      $(document).ready(function()
      {
        $("#tux").css({ opacity:0, width:"0%", height:"0%" });
        $("#listgroup").hide();
        $("#listgroup2").hide();
        new QWebChannel(qt.webChannelTransport,
  function(channel)
        {
          mainWindow = channel.objects.mainWindow;
        });
      });
      function changeHtmlText(newText)
      {
        $("#infotext").html(newText);
      }</span></pre></li> <li><span class="koboSpan" id="kobo.1050.1">Define a </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1051.1">startAnim()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1052.1"> function:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1053.1">
      function startAnim() {
      // Reset
        $("#tux").css({ opacity:0, width:"0%", height:"0%" });
        $("#listgroup").hide();
        $("#listgroup2").hide();
        $("#tux").animate({ opacity:1.0, width:"100%",
height:"100%" }, 1000, function()
        {
// tux animation complete
          $("#listgroup").slideDown(1000, function() {
          // listgroup animation complete
            $("#listgroup2").fadeIn(1500);
          });
        });
    }
&lt;/script&gt;</span></pre></li> <li><span class="koboSpan" id="kobo.1054.1">Add the following</span><a id="_idIndexMarker921"/><span class="koboSpan" id="kobo.1055.1"> code to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1056.1">&lt;body&gt;</span></strong><span class="koboSpan" id="kobo.1057.1"> element of our</span><a id="_idIndexMarker922"/> <span class="No-Break"><span class="koboSpan" id="kobo.1058.1">HTML file:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1059.1">
  &lt;div class="container-fluid"&gt;
    &lt;form id="example-form" action="#" class="container-fluid"&gt;
      &lt;div class="form-group"&gt;
      &lt;div class="col-md-12"&gt;&lt;h3&gt;Call Javascript Function from C++&lt;/h3&gt;&lt;/div&gt;
      &lt;div class="col-md-12"&gt;
      &lt;div class="alert alert-info" role="alert"&gt;&lt;i class="fa fa-info-circle"&gt;&lt;/i&gt; &lt;span id="infotext"&gt; Change this text using C++.&lt;/span&gt;&lt;/div&gt;
      &lt;/div&gt;
      &lt;div class="col-md-2"&gt;
        &lt;img id="tux" src="tux.png"&gt;&lt;/img&gt;
      &lt;/div&gt;</span></pre></li> <li><span class="koboSpan" id="kobo.1060.1">Continue writing the </span><a id="_idIndexMarker923"/><span class="koboSpan" id="kobo.1061.1">following code, to which we’ve </span><a id="_idIndexMarker924"/><span class="koboSpan" id="kobo.1062.1">added </span><span class="No-Break"><span class="koboSpan" id="kobo.1063.1">a list:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1064.1">
      &lt;div class="col-md-5"&gt;
        &lt;ul id="listgroup" class="list-group"&gt;
        &lt;li class="list-group-item"&gt;Cras justoodio&lt;/li&gt;
        &lt;li class="list-group-item"&gt;Dapibus acfacilisis in&lt;/li&gt;
        &lt;li class="list-group-item"&gt;Morbi leorisus&lt;/li&gt;
        &lt;li class="list-group-item"&gt;Porta acconsectetur ac&lt;/li&gt;
        &lt;li class="list-group-item"&gt;Vestibulum ateros&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/div&gt;
      &lt;div id="listgroup2" class="col-md-5"&gt;
        &lt;a href="#" class="list-group-item active"&gt;
        &lt;h4 class="list-group-item-heading"&gt;Item heading&lt;/h4&gt;
        &lt;p class="list-group-item-text"&gt;Cras justo odio&lt;/p&gt;
        &lt;/a&gt;</span></pre></li> <li><span class="koboSpan" id="kobo.1065.1">The code continues as </span><a id="_idIndexMarker925"/><span class="koboSpan" id="kobo.1066.1">we add the remaining items to a</span><a id="_idIndexMarker926"/> <span class="No-Break"><span class="koboSpan" id="kobo.1067.1">second list:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1068.1">
        &lt;a href="#" class="list-group-item"&gt;
          &lt;h4 class="list-group-item-heading"&gt;Item heading&lt;/h4&gt;
          &lt;p class="list-group-item-text"&gt;Dapibus ac facilisis in&lt;/p&gt;
        &lt;/a&gt;
        &lt;a href="#" class="list-group-item"&gt;
          &lt;h4 class="list-group-item-heading"&gt;Item heading&lt;/h4&gt;
          &lt;p class="list-group-item-text"&gt;Morbi leo risus&lt;/p&gt;
        &lt;/a&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/form&gt;
&lt;/div&gt;</span></pre></li> <li><span class="koboSpan" id="kobo.1069.1">Build and run the program; you should get a similar result to that in the following screenshot. </span><span class="koboSpan" id="kobo.1069.2">When you click on the </span><strong class="bold"><span class="koboSpan" id="kobo.1070.1">Change HTML Text</span></strong><span class="koboSpan" id="kobo.1071.1"> button, the information text is located within the top panel. </span><span class="koboSpan" id="kobo.1071.2">If you click on the </span><strong class="bold"><span class="koboSpan" id="kobo.1072.1">Play UI Animation</span></strong><span class="koboSpan" id="kobo.1073.1"> button, penguin images, alongside the two sets of widgets, will appear one after the other, with </span><span class="No-Break"><span class="koboSpan" id="kobo.1074.1">different animations:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer239">
<span class="koboSpan" id="kobo.1075.1"><img alt="Figure 13.22 – Clicking on the buttons at the bottom to see the results" src="image/B20976_13_022.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1076.1">Figure 13.22 – Clicking on the buttons at the bottom to see the results</span></p>
<h2 id="_idParaDest-283"><a id="_idTextAnchor283"/><span class="koboSpan" id="kobo.1077.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.1078.1">This example is similar to the</span><a id="_idIndexMarker927"/><span class="koboSpan" id="kobo.1079.1"> previous one in the </span><em class="italic"><span class="koboSpan" id="kobo.1080.1">Calling C++ functions from JavaScript</span></em><span class="koboSpan" id="kobo.1081.1"> recipe. </span><span class="koboSpan" id="kobo.1081.2">Once we have included the </span><strong class="bold"><span class="koboSpan" id="kobo.1082.1">WebChannel</span></strong><span class="koboSpan" id="kobo.1083.1"> JavaScript library and initiated the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1084.1">QWebChannel</span></strong><span class="koboSpan" id="kobo.1085.1"> class, we can call any of the JavaScript functions from C++ by calling </span><strong class="source-inline"><span class="koboSpan" id="kobo.1086.1">webview-&gt;page()-&gt;runJavascript("jsFunctionNameHere();")</span></strong><span class="koboSpan" id="kobo.1087.1">. </span><span class="koboSpan" id="kobo.1087.2">Don’t forget to apply the web channel created in C++ to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1088.1">webview</span></strong><span class="koboSpan" id="kobo.1089.1"> page as well; otherwise, it will not be able to communicate with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1090.1">QWebChannel</span></strong><span class="koboSpan" id="kobo.1091.1"> class in your </span><span class="No-Break"><span class="koboSpan" id="kobo.1092.1">HTML file.</span></span></p>
<p><span class="koboSpan" id="kobo.1093.1">By default, we change the CSS properties of the penguin image and set its opacity to 0, width to 0%, and height to 0%. </span><span class="koboSpan" id="kobo.1093.2">We also hide the two list groups by calling the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1094.1">hide()</span></strong> <strong class="bold"><span class="koboSpan" id="kobo.1095.1">jQuery</span></strong><span class="koboSpan" id="kobo.1096.1"> function. </span><span class="koboSpan" id="kobo.1096.2">When the </span><strong class="bold"><span class="koboSpan" id="kobo.1097.1">Play UI Animation</span></strong><span class="koboSpan" id="kobo.1098.1"> button is clicked, we repeat the steps just in case the animations have </span><a id="_idIndexMarker928"/><span class="koboSpan" id="kobo.1099.1">been played before (that is, the same button has been clicked before), and then we hide the list groups again in order for the animations to </span><span class="No-Break"><span class="koboSpan" id="kobo.1100.1">be replayed.</span></span></p>
<p><span class="koboSpan" id="kobo.1101.1">One powerful feature of </span><strong class="bold"><span class="koboSpan" id="kobo.1102.1">jQuery</span></strong><span class="koboSpan" id="kobo.1103.1"> is that you can define what happens after an animation finishes, which allows us to play animations in sequence. </span><span class="koboSpan" id="kobo.1103.2">In this example, we started with the penguin image and interpolated its CSS properties to a targeted setting within a second (1,000 milliseconds). </span><span class="koboSpan" id="kobo.1103.3">Once that was done, we started another animation, which made the first list group slide from top to bottom in 1 second. </span><span class="koboSpan" id="kobo.1103.4">After that, we ran the third animation, which made the second</span><a id="_idIndexMarker929"/><span class="koboSpan" id="kobo.1104.1"> list group fade in from nowhere within </span><span class="No-Break"><span class="koboSpan" id="kobo.1105.1">1.5 seconds.</span></span></p>
<p><span class="koboSpan" id="kobo.1106.1">To replace the information</span><a id="_idIndexMarker930"/><span class="koboSpan" id="kobo.1107.1"> text located in the top panel, we created a JavaScript function called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1108.1">changeHtmlText()</span></strong><span class="koboSpan" id="kobo.1109.1"> within the function itself, and we got the HTML element by referring to its ID and calling </span><strong class="source-inline"><span class="koboSpan" id="kobo.1110.1">html()</span></strong><span class="koboSpan" id="kobo.1111.1"> to change </span><span class="No-Break"><span class="koboSpan" id="kobo.1112.1">its contents.</span></span></p>
</div>
</body></html>