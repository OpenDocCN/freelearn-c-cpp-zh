<html><head></head><body>
<div><h1 class="chapter-number" id="_idParaDest-265"><a id="_idTextAnchor265"/>13</h1>
<h1 id="_idParaDest-266"><a id="_idTextAnchor266"/>Developing Web Applications Using Qt WebEngine</h1>
<p>Qt includes a module called <strong class="bold">Qt WebEngine</strong> that allows us to embed a web browser widget into our program and use it to display web pages or local HTML content. Prior to version 5.6, Qt used another similar module called <strong class="bold">Qt WebKit</strong>, which is now deprecated and has since been replaced by the Chromium-based <strong class="bold">WebEngine</strong> module. Qt also allows communication between JavaScript and C++ code through <strong class="bold">Qt WebChannel</strong>, which enables us to make use of this module in a much more effective fashion.</p>
<p>In this chapter, we will cover the following recipes:</p>
<ul>
<li>Introducing <strong class="bold">Qt WebEngine</strong></li>
<li>Using <code>webview</code> and web settings</li>
<li>Embedding Google maps in your project</li>
<li>Calling C++ functions from JavaScript</li>
<li>Calling JavaScript functions from C++</li>
</ul>
<h1 id="_idParaDest-267"><a id="_idTextAnchor267"/>Technical requirements</h1>
<p>The technical requirements for this chapter include Qt 6.6.1 MSVC 2019 64 bit, Qt Creator 12.0.2, and Microsoft Visual Studio. All the code used in this chapter can be downloaded from the following GitHub repository: <a href="https://github.com/PacktPublishing/QT6-C-GUI-Programming-Cookbook---Third-Edition-/tree/main/Chapter13">https://github.com/PacktPublishing/QT6-C-GUI-Programming-Cookbook---Third-Edition-/tree/main/Chapter13</a>.</p>
<h1 id="_idParaDest-268"><a id="_idTextAnchor268"/>Introducing Qt WebEngine</h1>
<p>In this example project, we will explore the basic features of the <strong class="bold">WebEngine</strong> module in Qt and try building a simple working web browser. Since Qt 5.6, Qt’s <strong class="bold">WebKit</strong> module has been deprecated and <a id="_idIndexMarker832"/>replaced by the <strong class="bold">WebEngine</strong> module, which is based on Google’s Chromium engine.</p>
<h2 id="_idParaDest-269"><a id="_idTextAnchor269"/>How to do it…</h2>
<p>First, let’s set up our <strong class="bold">WebEngine</strong> project:</p>
<ol>
<li>At the moment, Qt’s <strong class="bold">WebEngine</strong> module only<a id="_idIndexMarker833"/> works with the Visual C++ compiler and not <a id="_idIndexMarker834"/>others, such as <strong class="bold">MinGW</strong> or <strong class="bold">Cygwin</strong>. This might change in the future, but it all depends <a id="_idIndexMarker835"/>on whether Qt developers want to port it to other compilers or not. Make sure that the Qt version you installed on your computer supports the Visual C++ compiler. You can add the <strong class="bold">MSVC 2019 64-bit</strong> component to your Qt installation using Qt’s maintenance tool. Also, make sure that you have installed the <strong class="bold">Qt WebEngine</strong> component in your Qt version:</li>
</ol>
<div><div><img alt="Figure 13.1 – Making sure MSVC 2019 and Qt WebEngine are installed" src="img/B20976_13_001.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.1 – Making sure MSVC 2019 and Qt WebEngine are installed</p>
<ol>
<li value="2">Open up Qt Creator and <a id="_idIndexMarker836"/>create a new <strong class="bold">Qt Widgets Application</strong> project. Select a kit that uses the Visual C++ compiler:</li>
</ol>
<div><div><img alt="Figure 13.2 – Only MSVC is officially supported by Qt WebEngine" src="img/B20976_13_002.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.2 – Only MSVC is officially supported by Qt WebEngine</p>
<ol>
<li value="3">Open up your project file (<code>.pro</code>) and add the following modules to your project. After that, you must run <code>qmake</code> to apply the changes:<pre class="source-code">
QT += core gui <code>mainwindow.ui</code> and <a id="_idIndexMarker837"/>remove the <strong class="bold">menuBar</strong>, <strong class="bold">mainToolBar</strong>, and <strong class="bold">statusBar</strong> objects, as we don’t need those in this project:</li>
</ol>
<div><div><img alt="Figure 13.3 – Removing the menu bar, main toolbar, and status bar" src="img/B20976_13_003.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.3 – Removing the menu bar, main toolbar, and status bar</p>
<ol>
<li value="5">Place two horizontal layouts on the canvas, then place a <strong class="bold">Line Edit</strong> widget and a push button for the layout at the top:</li>
</ol>
<div><div><img alt="Figure 13.4 – Placing the line edit widget and push button in a layout" src="img/B20976_13_004.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.4 – Placing the line edit widget and push button in a layout</p>
<ol>
<li value="6">Select the canvas and click on the <strong class="bold">Lay Out Vertically</strong> button located at the top of the editor:</li>
</ol>
<div><div><img alt="Figure 13.5 – Clicking on the Lay Out Vertically button" src="img/B20976_13_005.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.5 – Clicking on the Lay Out Vertically button</p>
<ol>
<li value="7">The layouts will expand and<a id="_idIndexMarker838"/> follow the size of the main window. The line edit will also expand horizontally, based on the width of the horizontal layout:</li>
</ol>
<div><div><img alt="Figure 13.6 – The line edit is now expanding horizontally" src="img/B20976_13_006.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.6 – The line edit is now expanding horizontally</p>
<ol>
<li value="8">Add two buttons to the left side of the line edit. We’ll use these two buttons to move backward and forward between page histories. Add a <code>webview</code> to it later at <em class="italic">step 15</em> using C++ code, and the space will be occupied:</li>
</ol>
<div><div><img alt="Figure 13.7 – Adding two more buttons and a progress bar to the UI" src="img/B20976_13_007.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.7 – Adding two more buttons and a progress bar to the UI</p>
<ol>
<li value="9">Right-click on one of the buttons <a id="_idIndexMarker839"/>and select <code>clicked()</code> and click <code>mainwindow.h</code> and <code>mainwindow.cpp</code>. Repeat this step for all the other buttons as well.</li>
<li>Right-click on the line edit and select <code>returnPressed()</code> and click <code>mainwindow.h</code> and <code>mainwindow.cpp</code>.</li>
<li>Let’s hop over to <code>mainwindow.h</code>. The first thing we need to do is to add the following header to <code>mainwindow.h</code>:<pre class="source-code">
#include &lt;QtWebEngineWidgets/QtWebEngineWidgets&gt;</pre></li> <li>Declare a <code>loadUrl()</code> function under the class destructor:<pre class="source-code">
public:
    explicit MainWindow(QWidget *parent = 0);
    ~MainWindow();
    <code>loading()</code> to <code>mainwindow.h</code>:<pre class="source-code">
private slots:
    void on_goButton_clicked();
    void on_address_returnPressed();
    void on_backButton_clicked();
    void on_forwardButton_clicked();
    void loading(int progress);</pre></li> <li>Declare a <code>QWebEngineView</code> object and call it <code>webview</code>:<pre class="source-code">
private:
    Ui::MainWindow *ui;
    QWebEngineView* webview;</pre></li> <li>Open the <code>mainwindow.cpp</code> file and initiate the <code>WebEngine</code> view. Add it to the second horizontal layout and connect its <code>loadProgress()</code> signal to the <code>loading()</code> slot function <a id="_idIndexMarker840"/>we just added to <code>mainwindow.h</code>:<pre class="source-code">
MainWindow::MainWindow(QWidget *parent) :
    QMainWindow(parent),
    ui(new Ui::MainWindow)
{
    ui-&gt;setupUi(this);
    <strong class="bold">webview = new QWebEngineView;</strong>
    <strong class="bold">ui-&gt;horizontalLayout_2-&gt;addWidget(webview);</strong>
    <strong class="bold">connect(webview, &amp;QWebEngineView::loadProgress, this,</strong>
<strong class="bold">&amp;MainWindow::loading);</strong>
}</pre></li> <li>Declare what will happen when the <code>loadUrl()</code> function is called:<pre class="source-code">
void MainWindow::loadUrl() {
    QUrl url = QUrl(ui-&gt;address-&gt;text());
    url.setScheme("http");
    webview-&gt;page()-&gt;load(url);
}</pre></li> <li>Call the <code>loadUrl()</code> function <a id="_idIndexMarker841"/>when the <strong class="bold">Go</strong> button is clicked or when the <em class="italic">Enter</em> key is pressed:<pre class="source-code">
void MainWindow::on_goButton_clicked() {
    loadUrl();
}
MainWindow::on_address_returnPressed() {
    loadUrl();
}</pre></li> <li>As for the other two buttons, we’ll ask <code>webview</code> to load the previous page or the next page if it is available in the history stack:<pre class="source-code">
void MainWindow::on_backButton_clicked() {
    webview-&gt;back();
}
void MainWindow::on_forwardButton_clicked() {
    webview-&gt;forward();
}</pre></li> <li>Change the value of <code>progressBar</code> when the web page is being loaded:<pre class="source-code">
void MainWindow::loading(int progress) {
    ui-&gt;progressBar-&gt;setValue(progress);
}</pre></li> <li>Build and run the program now, and you will get a very basic but functional web browser:</li>
</ol>
<div><div><img alt="Figure 13.8 – We have created a simple web browser from scratch!" src="img/B20976_13_008.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.8 – We have created a simple web browser from scratch!</p>
<h2 id="_idParaDest-270"><a id="_idTextAnchor270"/>How it works…</h2>
<p>The old <code>webview</code> system was <a id="_idIndexMarker842"/>based on Apple’s <strong class="bold">WebKit</strong> engine and is only available in Qt 5.5 and its predecessor. Since 5.6, <strong class="bold">WebKit</strong> has been completely abandoned by Qt and replaced with Google’s <strong class="bold">Chromium</strong> engine. The API has been completely changed, and therefore all the code related to <strong class="bold">Qt WebKit</strong> will not work correctly once migrated to 5.6. If you’re new to Qt, it’s recommended you skip <strong class="bold">WebKit</strong> and learn the <strong class="bold">WebEngine</strong> API since it is becoming the new standard in Qt.</p>
<p class="callout-heading">Note</p>
<p class="callout">If you have used Qt’s <strong class="bold">WebKit</strong> in the past, this web page teaches you how to port your old code over to <strong class="bold">WebEngine</strong>: <a href="https://wiki.qt.io/Porting_from_QtWebKit_to_QtWebEngine">https://wiki.qt.io/Porting_from_QtWebKit_to_QtWebEngine</a></p>
<p>In <em class="italic">step 15</em> in the previous section, we connected the <code>loadProgress()</code> signal that belongs to the <code>webview</code> widget to the <code>loading()</code> slot function. The signal will be called automatically when <code>webview</code> is loading the web page you requested by calling <code>QWebEnginePage::load()</code> in <em class="italic">step 17</em>. You can also connect the <code>loadStarted()</code> and <code>loadFinished()</code> signals if you need to.</p>
<p>In <em class="italic">step 17</em>, we used the <code>QUrl</code> class to convert the text obtained from the line edit to URL format. By default, the address we inserted will lead to the local path if we do not specify the URL scheme (HTTP, HTTPS, FTP, and so on). We may not be able to load the page if, say, we gave it <code>google.com</code> instead of <code>http://google.com</code>. Therefore, we manually specified a URL scheme for it by calling <code>QUrl::setScheme()</code>. This ensured the address is<a id="_idIndexMarker843"/> properly formatted before passing it to <code>webview</code>.</p>
<h2 id="_idParaDest-271"><a id="_idTextAnchor271"/>There’s more…</h2>
<p>If for some reason you need the <strong class="bold">WebKit</strong> module for your project instead of <strong class="bold">WebEngine</strong>, you can obtain the module code from GitHub and build it by yourself: <a href="https://github.com/qt/qtwebkit">https://github.com/qt/qtwebkit</a></p>
<h1 id="_idParaDest-272"><a id="_idTextAnchor272"/>Using webview and web settings</h1>
<p>In this recipe, we will dive deeper into the features available in Qt’s <code>webview</code>. We will use the source files from the<a id="_idIndexMarker844"/> previous example and add more <a id="_idIndexMarker845"/>code to it.</p>
<h2 id="_idParaDest-273"><a id="_idTextAnchor273"/>How to do it…</h2>
<p>Let’s explore some of the<a id="_idIndexMarker846"/> basic features of the <strong class="bold">Qt </strong><strong class="bold">WebEngine</strong> module:</p>
<ol>
<li>Open <code>mainwindow.ui</code> and <a id="_idIndexMarker847"/>add a vertical layout under the progress bar. Add a <code>plaintext</code> property of the <strong class="bold">Plain Text Edit</strong> widget to the following:<pre class="source-code">
&lt;Img src="img/googlelogo_color_272x92dp.png"&gt;&lt;/img&gt;
&lt;h1&gt;Hello World!&lt;/h1&gt;
&lt;h3&gt;This is our custom HTML page.&lt;/h3&gt;
&lt;script&gt;alert("Hello!");&lt;/script&gt;</pre><p class="list-inset">This is how it should look after <a id="_idIndexMarker848"/>you have added the code<a id="_idIndexMarker849"/> on top of the <strong class="bold">Plain Text </strong><strong class="bold">Edit</strong> widget:</p></li> </ol>
<div><div><img alt="Figure 13.9 – Adding a Plain Text Edit widget and a push button to the bottom" src="img/B20976_13_009.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.9 – Adding a Plain Text Edit widget and a push button to the bottom</p>
<ol>
<li value="2">Go to <strong class="bold">File</strong> | <strong class="bold">New File</strong>. A <a id="_idIndexMarker850"/>window will pop up and ask you to choose <a id="_idIndexMarker851"/>a file template. Select <strong class="bold">Qt Resource File</strong> under the <strong class="bold">Qt</strong> category and click on the <strong class="bold">Choose…</strong> button. Type in your desired filename and click <strong class="bold">Next</strong>, followed by <strong class="bold">Finish</strong>:</li>
</ol>
<div><div><img alt="Figure 13.10 – Creating a Qt resource file" src="img/B20976_13_010.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.10 – Creating a Qt resource file</p>
<ol>
<li value="3">Open the resource file <a id="_idIndexMarker852"/>we just created by right-clicking on it in the <code>/</code> and click <code>tux.png</code> image file and click <code>.exe</code>) once it’s compiled:</li>
</ol>
<div><div><img alt="Figure 13.11 – Adding the tux.png image file to our resource file" src="img/B20976_13_011.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.11 – Adding the tux.png image file to our resource file</p>
<ol>
<li value="4">Open <code>mainwindow.h</code> and add<a id="_idIndexMarker856"/> the following headers <a id="_idIndexMarker857"/>to it:<pre class="source-code">
#include &lt;QMainWindow&gt;
<strong class="bold">#include &lt;QtWebEngineWidgets/QtWebEngineWidgets&gt;</strong>
<strong class="bold">#include &lt;QDebug&gt;</strong>
<code>mainwindow.h</code>:<pre class="source-code">
public:
    explicit MainWindow(QWidget *parent = 0);
    ~MainWindow();
    <strong class="bold">void loadUrl();</strong>
private slots:
    <strong class="bold">void on_goButton_clicked();</strong>
    <strong class="bold">void on_address_returnPressed();</strong>
    <strong class="bold">void on_backButton_clicked();</strong>
    <strong class="bold">void on_forwardButton_clicked();</strong>
    <strong class="bold">void startLoading();</strong>
    <strong class="bold">void loading(int progress);</strong>
    <strong class="bold">void loaded(bool ok);</strong>
    <strong class="bold">void on_loadHtml_clicked();</strong>
private:
    Ui::MainWindow *ui;
    <code>mainwindow.cpp</code> and <a id="_idIndexMarker860"/>add the following <a id="_idIndexMarker861"/>code to the <a id="_idIndexMarker862"/>class<a id="_idIndexMarker863"/> constructor:<pre class="source-code">
MainWindow::MainWindow(QWidget *parent) :
    QMainWindow(parent),
    ui(new Ui::MainWindow)
{
    ui-&gt;setupUi(this);
    <strong class="bold">webview = new QWebEngineView;</strong>
    <strong class="bold">ui-&gt;horizontalLayout_2-&gt;addWidget(webview);</strong>
   <strong class="bold">//webview-&gt;page()-&gt;settings()-&gt;setAttribute(QWebEngineSettings::JavascriptEnabled, false);</strong>
   <strong class="bold">//webview-&gt;page()-&gt;settings()-&gt;setAttribute(QWebEngineSettings::AutoLoadImages, false);</strong>
   <strong class="bold">//QString fontFamily = webview-&gt;page()-&gt;settings()-&gt;fontFamily(QWebEngineSettings::SerifFont);</strong>
    <strong class="bold">QString fontFamily = webview-&gt;page()-&gt;settings()-&gt;fontFamily(QWebEngineSettings::SansSerifFont);</strong>
    <strong class="bold">int fontSize = webview-&gt;page()-&gt;settings()-&gt;fontSize(QWebEngineSettings::MinimumFontSize);</strong>
    <strong class="bold">QFont myFont = QFont(fontFamily, fontSize);</strong>
    <code>webview</code>:<pre class="source-code">
    QFile file("://tux.png");
    if (file.open(QFile::ReadOnly)) {
        QByteArray data = file.readAll();
        webview-&gt;page()-&gt;setContent(data, "image/png");
    }
    else {
        qDebug() &lt;&lt; "File cannot be opened.";
    }
    connect(webview, &amp;QWebEngineView::loadStarted, this, &amp;MainWindow::startLoading()));
    connect(webview, &amp;QWebEngineView::loadProgress, this, &amp;MainWindow::loading(int)));
    connect(webview, &amp;QWebEngineView::loadFinished, this, &amp;MainWindow::loaded(bool)));
}</pre></li> <li>The <code>MainWindow::loadUrl()</code> function stays the same as in the previous example in the <em class="italic">Introducing Qt WebEngine</em> recipe, which sets the URL scheme to HTTP before loading the <a id="_idIndexMarker867"/>page:<pre class="source-code">
void MainWindow::loadUrl() {
    QUrl url = QUrl(ui-&gt;address-&gt;text());
    url.setScheme("http");
    webview-&gt;page()-&gt;load(url);
}</pre></li> <li>The same goes for the<a id="_idIndexMarker868"/> following functions, which also<a id="_idIndexMarker869"/> remain the same as the previous example <a id="_idIndexMarker870"/>in the <em class="italic">Introducing Qt </em><em class="italic">WebEngine</em> recipe:<pre class="source-code">
void MainWindow::on_goButton_clicked() {
    loadUrl();
}
void MainWindow::on_address_returnPressed() {
    loadUrl();
}
void MainWindow::on_backButton_clicked() {
    webview-&gt;back();
}
void MainWindow::on_forwardButton_clicked() {
    webview-&gt;forward();
}</pre></li> <li>Add the <code>MainWindow::startLoading()</code> and <code>MainWindow::loaded()</code> slot functions, which will be called by the <code>loadStarted()</code> and <code>loadFinished()</code> signals. These two functions basically show a progress bar when <a id="_idIndexMarker871"/>a page is starting to load and hide the progress bar <a id="_idIndexMarker872"/>when the page has finished loading:<pre class="source-code">
void MainWindow::startLoading() {
    ui-&gt;progressBar-&gt;show();
}
void MainWindow::loading(int progress) {
    ui-&gt;progressBar-&gt;setValue(progress);
}
void MainWindow::loaded(bool ok) {
    ui-&gt;progressBar-&gt;hide();
}</pre></li> <li>Call <code>webview-&gt;loadHtml()</code> to convert <a id="_idIndexMarker873"/>the plain text to HTML <a id="_idIndexMarker874"/>content when the <strong class="bold">Load HTML</strong> button is clicked:<pre class="source-code">
void MainWindow::on_loadHtml_clicked() {
    webview-&gt;setHtml(ui-&gt;source-&gt;toPlainText());
}</pre></li> <li>Build and run the program, and you should see something like the following:</li>
</ol>
<div><div><img alt="Figure 13.12 –webview will now display the result generated from your HTML code" src="img/B20976_13_012.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.12 –webview will now display the result generated from your HTML code</p>
<h2 id="_idParaDest-274"><a id="_idTextAnchor274"/>How it works…</h2>
<p>In this example, we used C++ to load an image<a id="_idIndexMarker875"/> file and set it as <code>webview</code> default content (instead of a blank page). We<a id="_idIndexMarker876"/> could <a id="_idIndexMarker877"/>achieve the same result by loading a default HTML file with an image at startup.</p>
<p>Some of the code in the class constructor has been commented out. You can remove the double slashes (<code>//</code>) and see the difference it makes – the JavaScript alert will no longer appear (since JavaScript<a id="_idIndexMarker878"/> is disabled) and images will no longer appear in your <code>webview</code>.</p>
<p>Another thing you can try is to change the font family from <code>QWebEngineSettings::SansSerifFont</code> to <code>QWebEngineSettings::SerifFont</code>. You will notice a slight difference in the font as it appears in <code>webview</code>:</p>
<div><div><img alt="Figure 13.13 – Different types of font showing in webview" src="img/B20976_13_013.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.13 – Different types of font showing in webview</p>
<p>By clicking the <code>webview</code> to treat the content of the <strong class="bold">Plain Text Edit</strong> widget as HTML code<a id="_idIndexMarker880"/> and load it as an HTML page. You can use this to make a simple HTML editor powered by Qt!</p>
<h1 id="_idParaDest-275"><a id="_idTextAnchor275"/>Embedding Google maps in your project</h1>
<p>In this recipe, we will learn how to embed Google maps in our project through Qt’s <strong class="bold">WebEngine</strong> module. This <a id="_idIndexMarker881"/>example doesn’t focus much on Qt and C++, but rather on the <strong class="bold">Google Maps</strong> API in HTML code.</p>
<h2 id="_idParaDest-276"><a id="_idTextAnchor276"/>How to do it…</h2>
<p>Let’s create a program that displays Google maps by following these steps:</p>
<ol>
<li>Create a new <strong class="bold">Qt Widgets Application</strong> project and remove the <strong class="bold">statusBar</strong>, <strong class="bold">menuBar</strong>, and <strong class="bold">mainToolBar</strong> objects.</li>
<li>Open your project file (<code>.pro</code>) and add the following modules to your project:<pre class="source-code">
QT += core gui webenginewidgets</pre></li> <li>Open <code>mainwindow.ui</code> and add a vertical layout to the canvas. Then, select the canvas and click<a id="_idIndexMarker882"/> the <strong class="bold">Lay Out Vertically</strong> button on top of the canvas. You will get the following:</li>
</ol>
<div><div><img alt="Figure 13.14 – Adding a vertical layout to the central widget" src="img/B20976_13_014.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.14 – Adding a vertical layout to the central widget</p>
<ol>
<li value="4">Open <code>mainwindow.cpp</code> and add the following header to the top of the source code:<pre class="source-code">
#include &lt;QtWebEngineWidgets/QWebEngineView&gt;</pre></li> <li>Add the following code to the <code>MainWindow</code> constructor:<pre class="source-code">
MainWindow::MainWindow(QWidget *parent) :
    QMainWindow(parent),
    ui(new Ui::MainWindow)
{
    ui-&gt;setupUi(this);
    <strong class="bold">QWebEngineView* webview = new QWebEngineView;</strong>
    <strong class="bold">QUrl url = QUrl("qrc:/map.html");</strong>
    <strong class="bold">webview-&gt;page()-&gt;load(url);</strong>
    <strong class="bold">ui-&gt;verticalLayout-&gt;addWidget(webview);</strong>
}</pre></li> <li>Go to <code>.qrc</code>). We will add an HTML file to our project, called <code>map.html</code>:</li>
</ol>
<div><div><img alt="Figure 13.15 – Adding map.html to the resource file" src="img/B20976_13_015.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.15 – Adding map.html to the resource file</p>
<ol>
<li value="7">Open <code>map.html</code> with your favorite text editor. It’s not recommended to open an HTML file using Qt <a id="_idIndexMarker883"/>Creator as it does not provide any color coding for HTML syntax.</li>
<li>Start writing the HTML code by declaring important tags, such as <code>&lt;html&gt;</code>, <code>&lt;head&gt;</code>, and <code>&lt;body&gt;</code>:<pre class="source-code">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
  &lt;/head&gt;
  &lt;body ondragstart="return false"&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre></li> <li>Add a <code>&lt;div&gt;</code> tag to the body and set its ID as <code>map-canvas</code>:<pre class="source-code">
  &lt;body ondragstart="return false"&gt;
    &lt;div id="map-canvas" /&gt;
  &lt;/body&gt;</pre></li> <li>Add the following code to the head of the HTML document:<pre class="source-code">
    &lt;meta name="viewport" content="initial-scale=1.0, userscalable=no" /&gt;
    &lt;style type="text/css"&gt;
    html { height: 100% }
    body { height: 100%; margin: 0; padding: 0 }
    #map-canvas { height: 100% }
    &lt;/style&gt;
    &lt;script type="text/javascript" src="img/js?key=YOUR_KEY_HERE&amp;libraries=drawing"&gt;&lt;/script&gt;</pre></li> <li>Add the following code, also<a id="_idIndexMarker884"/> to the head of the HTML document, beneath the code we inserted in the previous step:<pre class="source-code">
    &lt;script type="text/javascript"&gt;
        var map;
        function initialize() {
// Add map
            var mapOptions =
            {
                center: new google.maps.LatLng(40.705311, -74.2581939), zoom: 6
            };
            map = new google.maps.Map(document.getElementById("mapcanvas"),mapOptions);
// Add event listener
            google.maps.event.addListener(map, 'zoom_changed',
   function() {
       //alert(map.getZoom());
            });</pre></li> <li>Create a marker and <a id="_idIndexMarker885"/>place it on the map:<pre class="source-code">
// Add marker
            var marker = new google.maps.Marker({
                position: new google.maps.LatLng(40.705311, -74.2581939),
                map: map,
                title: "Marker A",
});
            google.maps.event.addListener (marker, 'click', function()
            {
                map.panTo(marker.getPosition());
            });
            marker.setMap(map);</pre></li> <li>Add a polyline to the map:<pre class="source-code">
// Add polyline
            var points = [ new google.maps.LatLng(39.8543, -73.2183), new google.maps.LatLng(41.705311, -75.2581939), new google.maps.LatLng(40.62388, -75.5483) ];
            var polyOptions = {
            path: points,
            strokeColor: '#FF0000',
            strokeOpacity: 1.0,
            strokeWeight: 2
            };
            historyPolyline = new google.maps.Polyline(polyOptions);
            historyPolyline.setMap(map);</pre></li> <li>Add a polygon <a id="_idIndexMarker886"/>shape:<pre class="source-code">
// Add polygon
            var points = [ new google.maps.LatLng(37.314166, -75.432), new google.maps.LatLng(40.2653, -74.4325), new google.maps.LatLng(38.8288, -76.5483) ];
                var polygon = new google.maps.Polygon({
                paths: points,
                fillColor: '#000000',
                fillOpacity: 0.2,
                strokeWeight: 3,
                strokeColor: '#fff000',
            });
            polygon.setMap(map);</pre></li> <li>Create a drawing manager and apply it to the map:<pre class="source-code">
// Setup drawing manager
            var drawingManager = new google.maps.drawing.DrawingManager();
            drawingManager.setMap(map);
        }
        google.maps.event.addDomListener(window, 'load', initialize);
    &lt;/script&gt;</pre></li> <li>Compile and run the project. You should see the following:</li>
</ol>
<div><div><img alt="Figure 13.16 – You should see a marker, a polyline, and a triangle on the Google map" src="img/B20976_13_016.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.16 – You should see a marker, a polyline, and a triangle on the Google map</p>
<h2 id="_idParaDest-277"><a id="_idTextAnchor277"/>How it works…</h2>
<p>Google allows you to embed <a id="_idIndexMarker887"/>Google maps in a web page using its JavaScript library, called the <code>webview</code> widget, which uses the <strong class="bold">Google Maps</strong> API. The only downside of this method is that we cannot load maps when there is no internet connection.</p>
<p>The <strong class="bold">Google Maps</strong> API can be called by your website as Google allows it. Choose <a href="https://console.developers.google.com">the free API if your plan is for heav</a>ier traffic.</p>
<p>Go to <a href="https://console.developers.google.com">https://console.developers.google.com</a> to get a free key and replace <code>YOUR_KEY_HERE</code> in the JavaScript source path with the API key you obtained from Google.</p>
<p>We must define a <code>&lt;div&gt;</code> object, which serves as a container for the map. Then, when we initialize the map, we specify the ID of the <code>&lt;div&gt;</code> object so that the <strong class="bold">Google Maps</strong> API knows which HTML element to look for when embedding the map. By default, we set the center of the map to the coordinates of New York and set the default zoom level to 6. Then, we add an event listener that gets triggered when the zoom level of the map changes.</p>
<p>Remove the double<a id="_idIndexMarker888"/> slashes (<code>//</code>) from the code to see it in action. After that, we add a marker to the map through JavaScript. The marker also has an event listener attached to it, which will trigger the <code>panTo()</code> function when the marker is clicked.</p>
<p>It basically pans the map view to the marker that has been clicked. Although we have added the drawing manager to the map (the icon buttons beside the <strong class="bold">Map</strong> and <strong class="bold">Satellite</strong> buttons), which allows users to draw any type of shape on top of the map, it’s also possible to add shapes manually using JavaScript, similar to how we added a marker in <em class="italic">step 12</em>, in the <em class="italic">How to do </em><em class="italic">it...</em> section.</p>
<p>Lastly, you may have noticed that headers are added to <code>mainwindow.cpp</code> instead of <code>mainwindow.h</code>. This is totally fine unless you are declaring class pointers in <code>mainwindow.h</code>—then, you have to include those headers in it.</p>
<h1 id="_idParaDest-278"><a id="_idTextAnchor278"/>Calling C++ functions from JavaScript</h1>
<p>In this recipe, we will learn<a id="_idIndexMarker889"/> how to put our knowledge to use and create a <a id="_idIndexMarker890"/>functional login screen using Qt and SQLite.</p>
<h2 id="_idParaDest-279"><a id="_idTextAnchor279"/>How to do it…</h2>
<p>Let’s learn how to call C++ functions from JavaScript using the following steps:</p>
<ol>
<li>Create a <code>.pro</code>) and add the following modules to the project:<pre class="source-code">
QT += core gui <code>mainwindow.ui</code> and delete the <strong class="bold">mainToolBar</strong>, <strong class="bold">menuBar</strong>, and <strong class="bold">statusBar</strong> objects, as we don’t need any of these in this example program.</li>
<li>Add a vertical layout to the canvas, then select the canvas and click on the <code>Hello!</code>. Make its font bigger by setting its <code>styleSheet</code> property <a id="_idIndexMarker892"/>as follows:<pre class="source-code">
font: 75 26pt "MS Shell Dlg 2";</pre><p class="list-inset">This is what it looks like after we applied the font properties to our style sheet:</p></li> </ol>
<div><div><img alt="Figure 13.17 – Applying the font property to the “Hello!” text" src="img/B20976_13_017.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.17 – Applying the font property to the “Hello!” text</p>
<ol>
<li value="4">Go to <strong class="bold">File</strong> | <strong class="bold">New File…</strong> and create a resource file. Add an empty HTML file and all the JavaScript files, CSS files, font files, and so on that belong to <strong class="bold">jQuery</strong>, <strong class="bold">Bootstrap</strong>, and <strong class="bold">Font Awesome</strong> to your project resources:</li>
</ol>
<div><div><img alt="Figure 13.18 – Adding all the files to the project’s resource" src="img/B20976_13_018.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.18 – Adding all the files to the project’s resource</p>
<ol>
<li value="5">Open your HTML file, which in<a id="_idIndexMarker893"/> this case is called <code>test.html</code>. Link all the necessary JavaScript <a id="_idIndexMarker894"/>and CSS files to the HTML source code, between the <code>&lt;</code><code>head&gt;</code> tags:<pre class="source-code">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;script src="img/qwebchannel.js"&gt;&lt;/script&gt;
    &lt;script src="img/jquery.min.js"&gt;&lt;/script&gt;
    &lt;script src="img/bootstrap.js"&gt;&lt;/script&gt;
    &lt;link rel="stylesheet" type="text/css" href="css/bootstrap.css"&gt;
    &lt;link rel="stylesheet" type="text/css" href="css/fontawesome.css"&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></li> <li>Add the following<a id="_idIndexMarker895"/> JavaScript to the <code>&lt;head&gt;</code> element, wrapped between the <code>&lt;</code><code>script&gt;</code> tags:<pre class="source-code">
&lt;script&gt;
    $(document).ready(function()
    {
        new QWebChannel(qt.webChannelTransport,
function(channel)
        {
            mainWindow = channel.objects.mainWindow;
        });
        $("#login").click(function(e) {
            e.preventDefault();
            var user = $("#username").val();
            var pass = $("#password").val();
            mainWindow.showLoginInfo(user, pass);
        });</pre></li> <li>Print <strong class="bold">Good bye! </strong>when <a id="_idIndexMarker896"/>clicking on the <strong class="bold">changeText</strong> button with the following code:<pre class="source-code">
        $("#changeText").click(function(e)
        {
            e.preventDefault();
            mainWindow.changeQtText("Good bye!");
        });
    });
&lt;/script&gt;</pre></li> <li>Add the following <a id="_idIndexMarker897"/>code to the <code>&lt;</code><code>body&gt;</code> element:<pre class="source-code">
    &lt;div class="container-fluid"&gt;
        &lt;form id="example-form" action="#" class="container-fluid"&gt;
            &lt;div class="form-group"&gt;
                &lt;div class="col-md-12"&gt;&lt;h3&gt;Call C++ Function from Javascript&lt;/h3&gt;&lt;/div&gt;
                &lt;div class="col-md-12"&gt;
                &lt;div class="alert alert-info" role="alert"&gt;&lt;i class="fa fa-info-circle"&gt;&lt;/i&gt;
            &lt;span id="infotext"&gt;Click "Login" to send username and password variables to C++. Click "Change Cpp Text" to change the text label on Qt GUI.&lt;/span&gt;
            &lt;/div&gt;
            &lt;/div&gt;</pre></li> <li>Continuing from the previous code, this time, we create input fields for username and password, with<a id="_idIndexMarker898"/> two buttons at the bottom called <strong class="bold">Login</strong> and <strong class="bold">Change </strong><strong class="bold">Cpp Text</strong>:<pre class="source-code">
            &lt;div class="col-md-12"&gt;&lt;label&gt;Username:&lt;/label&gt;&lt;input id="username" type="text"&gt;&lt;p /&gt;
            &lt;/div&gt;
            &lt;div class="col-md-12"&gt;
            &lt;label&gt;Password:&lt;/label&gt; &lt;input id="password" type="password"&gt;&lt;p /&gt;
            &lt;/div&gt;
            &lt;div class="col-md-12"&gt;
            &lt;button id="login" class="btn btn-success" type="button"&gt;&lt;i class="fa fa-check"&gt;&lt;/i&gt; Login&lt;/button&gt;
            &lt;button id="changeText" class="btn btn-primary" type="button"&gt;
            &lt;i class="fa fa-pencil"&gt;&lt;/i&gt; Change Cpp Text&lt;/button&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/form&gt;
&lt;/div&gt;</pre></li> <li>Open <code>mainwindow.h</code> and <a id="_idIndexMarker899"/>add the following public <a id="_idIndexMarker900"/>functions to the <code>MainWindow</code> class:<pre class="source-code">
public:
    explicit MainWindow(QWidget *parent = 0);
    ~MainWindow();
    <strong class="bold">Q_INVOKABLE void changeQtText(QString newText);</strong>
    <code>mainwindow.cpp</code> and add the following headers to the top of the source code:<pre class="source-code">
#include &lt;QtWebEngineWidgets/QWebEngineView&gt;
#include &lt;QtWebChannel/QWebChannel&gt;
#include &lt;QMessageBox&gt;</pre></li> <li>Add the following code to the <code>MainWindow</code> constructor:<pre class="source-code">
MainWindow::MainWindow(QWidget *parent) :
    QMainWindow(parent),
    ui(new Ui::MainWindow)
{
    <strong class="bold">qputenv("QTWEBENGINE_REMOTE_DEBUGGING", "1234");</strong>
    ui-&gt;setupUi(this);
    <strong class="bold">QWebEngineView* webview = new QWebEngineView();</strong>
    <strong class="bold">ui-&gt;verticalLayout-&gt;addWidget(webview);</strong>
    <strong class="bold">QWebChannel* webChannel = new QWebChannel();</strong>
    <strong class="bold">webChannel-&gt;registerObject("mainWindow", this);</strong>
    <strong class="bold">webview-&gt;page()-&gt;setWebChannel(webChannel);</strong>
    <strong class="bold">webview-&gt;page()-&gt;load(QUrl("qrc:///html/test.html"));</strong>
}</pre></li> <li>Declare what<a id="_idIndexMarker901"/> happens when <code>changeQtText()</code> and <code>showLoginInfo()</code> are called:<pre class="source-code">
void MainWindow::changeQtText(QString newText) {
    ui-&gt;label-&gt;setText(newText);
}
void MainWindow::showLoginInfo(QString user, QString pass) {
    QMessageBox::information(this, "Login info", "Username is " + user + " and password is " + pass);
}</pre></li> <li>Compile and run the program; you should see something similar to the following screenshot. If you <a id="_idIndexMarker902"/>click on the <strong class="bold">Change Cpp Text</strong> button, the word <strong class="bold">Hello!</strong> at the top will change to <strong class="bold">Goodbye!</strong> If you click on the <strong class="bold">Login</strong> button, a message box will appear and show you exactly what you typed in the <strong class="bold">Username</strong> and <strong class="bold">Password</strong> input fields:</li>
</ol>
<div><div><img alt="Figure 13.19 – Clicking on the buttons to call C++ functions" src="img/B20976_13_019.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.19 – Clicking on the buttons to call C++ functions</p>
<h2 id="_idParaDest-280"><a id="_idTextAnchor280"/>How it works…</h2>
<p>In this example, we <a id="_idIndexMarker903"/>used two JavaScript libraries: <strong class="bold">jQuery</strong> and <strong class="bold">Bootstrap</strong>. We also used an iconic font package called <strong class="bold">Font Awesome</strong>. These third-party add-ons were used to make the HTML UI more interesting and responsive to different screen resolutions.</p>
<p>We also used <strong class="bold">jQuery</strong> to detect<a id="_idIndexMarker904"/> the document’s ready status, as well as<a href="https://jquery.com/download"> to obtain the values of in</a>put fields.</p>
<p class="callout-heading">Note</p>
<p class="callout">You can<a id="_idIndexMarker905"/> download <strong class="bold">jQuery</strong> from <a href="https://jquery.com/download">https://jquery.com/download</a>, <strong class="bold">Bootstrap</strong> from <a href="http://getbootstrap.com/getting-started/#download">http://getbootstrap.com/getting-started/#download</a>, and <strong class="bold">Font Awesome</strong> from <a href="http://fontawesome.io">http://fontawesome.io</a>.</p>
<p>Qt’s <strong class="bold">WebEngine</strong> module uses a mechanism called <strong class="bold">WebChannel</strong>, which enables <strong class="bold">peer-to-peer</strong> (<strong class="bold">P2P</strong>) communication<a id="_idIndexMarker906"/> between the C++ program and the HTML page. The <strong class="bold">WebEngine</strong> module provides<a id="_idIndexMarker907"/> a JavaScript library that makes integration a lot easier. The JavaScript is <a id="_idIndexMarker908"/>embedded in your project’s resource by default, so you don’t need to import it into your project manually. You just have to include it in your HTML page by calling the following:</p>
<pre class="source-code">
&lt;script src="img/qwebchannel.js"&gt;&lt;/script&gt;</pre> <p>Once you have included <code>qwebchannel.js</code>, you can initialize the <code>QWebChannel</code> class and assign the Qt object we registered earlier in C++ to a JavaScript variable.</p>
<p>In C++, this is done as follows:</p>
<pre class="source-code">
QWebChannel* webChannel = new QWebChannel();
webChannel-&gt;registerObject("mainWindow", this);
webview-&gt;page()-&gt;setWebChannel(webChannel);</pre> <p>Then, in JavaScript, this is done as follows:</p>
<pre class="source-code">
new QWebChannel(qt.webChannelTransport, function(channel) {
mainWindow = channel.objects.mainWindow;
});</pre> <p>You may be wondering what this line means:</p>
<pre class="source-code">
qputenv("QTWEBENGINE_REMOTE_DEBUGGING", "1234");</pre> <p>Qt’s <code>1234</code> defines the port number you want to use for remote debugging.</p>
<p>Once you have enabled remote debugging, you can access the debugging page by opening up a Chromium-based web browser, such as Google Chrome (this will not work in Firefox and other browsers), and typing in <code>http://127.0.0.1:1234</code>. You will then see a page that looks like this:</p>
<div><div><img alt="Figure 13.20 – Inspectable pages allow you to debug more easily" src="img/B20976_13_020.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.20 – Inspectable pages allow you to debug more easily</p>
<p>The first page will display all HTML pages that are currently running in your program, which in this case is <code>test.html</code>. Click on the<a id="_idIndexMarker909"/> page link, and it will take you to another page for inspection. You<a id="_idIndexMarker910"/> can use this to check for CSS errors, JavaScript errors, and missing files.</p>
<p>Note that you should disable remote debugging once your program is bug-free and ready for deployment. This is because remote debugging takes time to initialize and will increase your program’s startup time.</p>
<p>If you want to call a C++ function from JavaScript, you must place the <code>Q_INVOKABLE</code> macro in front of the function’s declaration; otherwise, it will not work:</p>
<pre class="source-code">
Q_INVOKABLE void changeQtText(QString newText);</pre> <h1 id="_idParaDest-281"><a id="_idTextAnchor281"/>Calling Javascript functions from C++</h1>
<p>In the previous recipe, we learned how to<a id="_idIndexMarker911"/> call C++ functions from JavaScript through Qt’s <strong class="bold">WebChannel</strong> system. In this example, we will try to do the reverse: call <a id="_idIndexMarker912"/>JavaScript functions from C++ code.</p>
<h2 id="_idParaDest-282"><a id="_idTextAnchor282"/>How to do it…</h2>
<p>We can call JavaScript functions from C++ through the following steps:</p>
<ol>
<li>Create a new <code>webenginewidgets</code> module to your project.</li>
<li>Open <code>mainwindow.ui</code> and remove the <strong class="bold">mainToolBar</strong>, <strong class="bold">menuBar</strong>, and <strong class="bold">statusBar</strong> objects.</li>
<li>Add a vertical layout and a horizontal layout to the canvas. Select the canvas and click <strong class="bold">Lay Out Vertically</strong>. Make <a id="_idIndexMarker913"/>sure the horizontal layout is located at the bottom of the vertical layout.</li>
<li>Add two push <a id="_idIndexMarker914"/>buttons to the horizontal layout; one is called <code>clicked()</code> option and click <strong class="bold">OK</strong>. Qt will automatically add a slot function to your source code. Repeat this step for the other button:</li>
</ol>
<div><div><img alt="Figure 13.21 – Placing the buttons in the bottom layout" src="img/B20976_13_021.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.21 – Placing the buttons in the bottom layout</p>
<ol>
<li value="5">Open <code>mainwindow.h</code> and add the following headers to it:<pre class="source-code">
#include &lt;QtWebEngineWidgets/QWebEngineView&gt;
#include &lt;QtWebChannel/QWebChannel&gt;
#include &lt;QMessageBox&gt;</pre></li> <li>Declare the class pointer of a <code>QWebEngineView</code> object called <code>webview</code>:<pre class="source-code">
public:
    explicit MainWindow(QWidget *parent = 0);
    ~MainWindow();
    <code>mainwindow.cpp</code> and add the<a id="_idIndexMarker915"/> following code to the <code>MainWindow</code> constructor:<pre class="source-code">
MainWindow::MainWindow(QWidget *parent) :
    QMainWindow(parent),
    ui(new Ui::MainWindow)
{
    <strong class="bold">//qputenv("QTWEBENGINE_REMOTE_DEBUGGING", "1234");</strong>
    ui-&gt;setupUi(this);
    <strong class="bold">webview = new QWebEngineView();</strong>
    <strong class="bold">ui-&gt;verticalLayout-&gt;addWidget(webview);</strong>
    <strong class="bold">QWebChannel* webChannel = new QWebChannel();</strong>
    <strong class="bold">webChannel-&gt;registerObject("mainWindow", this);</strong>
    <strong class="bold">webview-&gt;page()-&gt;setWebChannel(webChannel);</strong>
    <strong class="bold">webview-&gt;page()-&gt;load(QUrl("qrc:///html/test.html"));</strong>
}</pre></li> <li>Define what will happen when the <code>changeHtmlText</code> button and the <code>playUIAnimation</code> button <a id="_idIndexMarker916"/>are clicked:<pre class="source-code">
void MainWindow::on_changeHtmlTextButton_clicked() {
    webview-&gt;page()-&gt;runJavaScript("changeHtmlText('Text has been replaced by C++!');");
}
void MainWindow::on_playUIAnimationButton_clicked() {
    webview-&gt;page()-&gt;runJavaScript("startAnim();");
}</pre></li> <li>Let’s create a resource file for our project by going to <strong class="bold">File</strong> | <strong class="bold">New File...</strong>. Select <strong class="bold">Qt Resource File</strong> under the <strong class="bold">Qt</strong> category and click <strong class="bold">Choose...</strong>. Insert your desired filename and click <strong class="bold">Next</strong>, followed by <strong class="bold">Finish</strong>.</li>
<li>Add an empty HTML file and <a id="_idIndexMarker917"/>all the required add-ons (<code>tux.png</code> image file to the resources file as well, as we’ll be using it in a short while in <em class="italic">step 14</em>.</li>
<li>Open the HTML file we just created and add it to the project resources; in our case, it’s called <code>test.html</code>. Add the following HTML code to the file:<pre class="source-code">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;script src="img/qwebchannel.js"&gt;&lt;/script&gt;
    &lt;script src="img/jquery.min.js"&gt;&lt;/script&gt;
    &lt;script src="img/bootstrap.js"&gt;&lt;/script&gt;
    &lt;link rel="stylesheet" type="text/css" href="css/bootstrap.css"&gt;
    &lt;link rel="stylesheet" type="text/css" href="css/fontawesome.css"&gt;
  &lt;/head&gt;
&lt;body&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></li> <li>Add the following JavaScript code, which<a id="_idIndexMarker919"/> is wrapped within the <code>&lt;script&gt;</code> tags, to the <code>&lt;head&gt;</code> element <a id="_idIndexMarker920"/>of our HTML file:<pre class="source-code">
    &lt;script&gt;
      $(document).ready(function()
      {
        $("#tux").css({ opacity:0, width:"0%", height:"0%" });
        $("#listgroup").hide();
        $("#listgroup2").hide();
        new QWebChannel(qt.webChannelTransport,
  function(channel)
        {
          mainWindow = channel.objects.mainWindow;
        });
      });
      function changeHtmlText(newText)
      {
        $("#infotext").html(newText);
      }</pre></li> <li>Define a <code>startAnim()</code> function:<pre class="source-code">
      function startAnim() {
      // Reset
        $("#tux").css({ opacity:0, width:"0%", height:"0%" });
        $("#listgroup").hide();
        $("#listgroup2").hide();
        $("#tux").animate({ opacity:1.0, width:"100%",
height:"100%" }, 1000, function()
        {
// tux animation complete
          $("#listgroup").slideDown(1000, function() {
          // listgroup animation complete
            $("#listgroup2").fadeIn(1500);
          });
        });
    }
&lt;/script&gt;</pre></li> <li>Add the following<a id="_idIndexMarker921"/> code to the <code>&lt;body&gt;</code> element of our<a id="_idIndexMarker922"/> HTML file:<pre class="source-code">
  &lt;div class="container-fluid"&gt;
    &lt;form id="example-form" action="#" class="container-fluid"&gt;
      &lt;div class="form-group"&gt;
      &lt;div class="col-md-12"&gt;&lt;h3&gt;Call Javascript Function from C++&lt;/h3&gt;&lt;/div&gt;
      &lt;div class="col-md-12"&gt;
      &lt;div class="alert alert-info" role="alert"&gt;&lt;i class="fa fa-info-circle"&gt;&lt;/i&gt; &lt;span id="infotext"&gt; Change this text using C++.&lt;/span&gt;&lt;/div&gt;
      &lt;/div&gt;
      &lt;div class="col-md-2"&gt;
        &lt;img id="tux" src="img/tux.png"&gt;&lt;/img&gt;
      &lt;/div&gt;</pre></li> <li>Continue writing the <a id="_idIndexMarker923"/>following code, to which we’ve <a id="_idIndexMarker924"/>added a list:<pre class="source-code">
      &lt;div class="col-md-5"&gt;
        &lt;ul id="listgroup" class="list-group"&gt;
        &lt;li class="list-group-item"&gt;Cras justoodio&lt;/li&gt;
        &lt;li class="list-group-item"&gt;Dapibus acfacilisis in&lt;/li&gt;
        &lt;li class="list-group-item"&gt;Morbi leorisus&lt;/li&gt;
        &lt;li class="list-group-item"&gt;Porta acconsectetur ac&lt;/li&gt;
        &lt;li class="list-group-item"&gt;Vestibulum ateros&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/div&gt;
      &lt;div id="listgroup2" class="col-md-5"&gt;
        &lt;a href="#" class="list-group-item active"&gt;
        &lt;h4 class="list-group-item-heading"&gt;Item heading&lt;/h4&gt;
        &lt;p class="list-group-item-text"&gt;Cras justo odio&lt;/p&gt;
        &lt;/a&gt;</pre></li> <li>The code continues as <a id="_idIndexMarker925"/>we add the remaining items to a<a id="_idIndexMarker926"/> second list:<pre class="source-code">
        &lt;a href="#" class="list-group-item"&gt;
          &lt;h4 class="list-group-item-heading"&gt;Item heading&lt;/h4&gt;
          &lt;p class="list-group-item-text"&gt;Dapibus ac facilisis in&lt;/p&gt;
        &lt;/a&gt;
        &lt;a href="#" class="list-group-item"&gt;
          &lt;h4 class="list-group-item-heading"&gt;Item heading&lt;/h4&gt;
          &lt;p class="list-group-item-text"&gt;Morbi leo risus&lt;/p&gt;
        &lt;/a&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/form&gt;
&lt;/div&gt;</pre></li> <li>Build and run the program; you should get a similar result to that in the following screenshot. When you click on the <strong class="bold">Change HTML Text</strong> button, the information text is located within the top panel. If you click on the <strong class="bold">Play UI Animation</strong> button, penguin images, alongside the two sets of widgets, will appear one after the other, with different animations:</li>
</ol>
<div><div><img alt="Figure 13.22 – Clicking on the buttons at the bottom to see the results" src="img/B20976_13_022.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.22 – Clicking on the buttons at the bottom to see the results</p>
<h2 id="_idParaDest-283"><a id="_idTextAnchor283"/>How it works…</h2>
<p>This example is similar to the<a id="_idIndexMarker927"/> previous one in the <em class="italic">Calling C++ functions from JavaScript</em> recipe. Once we have included the <code>QWebChannel</code> class, we can call any of the JavaScript functions from C++ by calling <code>webview-&gt;page()-&gt;runJavascript("jsFunctionNameHere();")</code>. Don’t forget to apply the web channel created in C++ to <code>webview</code> page as well; otherwise, it will not be able to communicate with the <code>QWebChannel</code> class in your HTML file.</p>
<p>By default, we change the CSS properties of the penguin image and set its opacity to 0, width to 0%, and height to 0%. We also hide the two list groups by calling the <code>hide()</code> <strong class="bold">jQuery</strong> function. When the <strong class="bold">Play UI Animation</strong> button is clicked, we repeat the steps just in case the animations have <a id="_idIndexMarker928"/>been played before (that is, the same button has been clicked before), and then we hide the list groups again in order for the animations to be replayed.</p>
<p>One powerful feature of <strong class="bold">jQuery</strong> is that you can define what happens after an animation finishes, which allows us to play animations in sequence. In this example, we started with the penguin image and interpolated its CSS properties to a targeted setting within a second (1,000 milliseconds). Once that was done, we started another animation, which made the first list group slide from top to bottom in 1 second. After that, we ran the third animation, which made the second<a id="_idIndexMarker929"/> list group fade in from nowhere within 1.5 seconds.</p>
<p>To replace the information<a id="_idIndexMarker930"/> text located in the top panel, we created a JavaScript function called <code>changeHtmlText()</code> within the function itself, and we got the HTML element by referring to its ID and calling <code>html()</code> to change its contents.</p>
</div>
</body></html>