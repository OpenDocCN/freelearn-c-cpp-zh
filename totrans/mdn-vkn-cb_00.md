# 前言

这本书是为经验丰富的计算机图形软件工程师设计的，他们可能对较旧的图形 API，如 OpenGL 和 DirectX 10 非常熟悉，但对现代图形 API 相对较新。就像你一样，我们发现我们需要学习 Vulkan，但因为我们不理解 Vulkan 的基本概念，这是一个复杂且庞大的 API，所以我们很难实现实用的解决方案。本书的目标是向您介绍 API 的基本概念，然后通过精选的、经过验证的算法引导您了解 Vulkan 在每个配方中的新和细微之处。

本书分为五部分，按以下顺序涵盖以下内容：

+   基本 Vulkan 概念，如何以及为什么使用它们，以及它们如何融入使用 Vulkan API 编写应用程序的更大图景中

+   使用 Vulkan 实现的通用图形算法，包括它们的特性以及它们如何被用来完成与图形应用程序相关的各种任务

+   使用 Vulkan 构建 GPU 光线追踪器和混合渲染器

+   如何使用 Vulkan 和 OpenXR 编写适用于令人难以置信的新世界 VR、MR 和 AR 的应用程序

+   调试和性能分析你的 Vulkan 实现的方法

有许多资源涵盖了本书探讨的第一部分，但在这本书中，我们提供了一个两部分的叙事，逐步通过提供简单实用的示例帮助你理解基本 Vulkan 概念。随后的部分展示了可行的实现，可以作为你自己的图形引擎实现的参考。

本书附带存储库的主要目标不是实现最高性能，找到巧妙的方法来实现事物，甚至实现去年 GDC 或 SIGGRAPH 展示的最闪亮的新算法。我们的目标是简单和完整。我们提供了一些 Vulkan 功能如何以及必须使用的技巧和窍门，并且大多数配方都已经过测试和调试，为你提供了一个自包含的工作解决方案，你可以改进并在自己的代码库中使用。每个配方都是一个可执行的程序，可以独立于其他配方进行检查，这使得它们易于阅读。这也使得理解每个算法从开始到结束的所有细节变得容易。

Vulkan 是所有设备和类型应用程序的未来事实上的图形 API。它是一个成熟、功能丰富且得到维护的 API，得到了所有 GPU 供应商、操作系统、框架和语言的支持。如果你打算编写图形应用程序或编写仅使用 Vulkan 计算设施的程序，了解这个 API 是必须的，而且你需要立即学习它！

# 本书面向的对象

本书是为那些希望了解更多关于 Vulkan 的资深图形软件工程师所写。建议至少了解一个其他图形 API，如 OpenGL，以及其变体之一，如 WebGL、OpenGL ES 或 DirectX（版本 9 或 10），但这不是严格必要的。了解图形原理，如变换、图形管线、着色器、光照、光线追踪的基础以及深度和模板缓冲区等，是很重要的。更高级的话题，如 PBR 及其所有概念，不是必需的，但可能会有所帮助。

最后，代码完全使用 C++编写，因为它是编写图形应用程序最广泛使用的编程语言。尽管书中使用了 C++20 的一些特性，因为它们有助于减少 Vulkan 的冗长，但你不需要对最新的 C++特性有深入了解。

# 本书涵盖的内容

*第一章*，*Vulkan 核心概念*，提供了对最基本的 Vulkan 概念和对象的概述，以及如何创建和使用它们。本章涵盖了如何使用和初始化 Vulkan，以及其对象如何与应用程序交互和管理。在章节末尾，我们提供了一个如何使用这些概念在 Vulkan 中创建最简单图形应用程序的配方。

*第二章*，*使用现代 Vulkan*，介绍了更高级的 Vulkan 概念和对象，例如屏障、描述符和管线，这些都可以让你开始使用除了直接在着色器代码中提供的数据之外的其他资源。本章还简要概述了现代渲染技术，如**可编程顶点提取**（**PVP**）和**多绘制间接**（**MDI**）。

*第三章*，*实现 GPU 驱动渲染*，提供了实现所谓的 GPU 驱动渲染的配方：直接从着色器生成数据，而几乎不需要 CPU 输入的技术。生成后的数据保留在 GPU 中，可以用来指导如何渲染场景；或者，这些数据可以直接在屏幕上作为调试信息显示。

*第四章*，*探索光照、着色和阴影的技术*，从 Vulkan 的角度探讨了已知的图形技术。配方包括延迟渲染、屏幕空间反射、阴影贴图和屏幕空间环境遮挡的实现，展示了如何在导航 Vulkan 的复杂性同时实现实际效果。

*第五章*, *解码顺序无关透明度*，包含了使用 Vulkan 实现透明度的配方，从简单的算法（如深度剥离和双深度剥离）到更高级且符合物理的实现在内，这些实现仅运行在 GPU 上。虽然其中一些配方可能看起来过时，但它们实际上展示了 Vulkan API 的强大功能。

*第六章*, *抗锯齿技术*，提供了可用于 Vulkan 的全面抗锯齿技术列表。第一个配方使用了 Vulkan 提供的多采样抗锯齿功能，而其他配方则提供了不使用 API 提供的功能来实现抗锯齿的替代方法。

*第七章*, *光线追踪和混合渲染*，是使用 Vulkan 进行光线追踪的介绍，并使用了新的 Vulkan 光线追踪扩展。本章的大部分内容将指导您如何在应用程序中实现路径追踪器，并使用它来渲染光线追踪场景并在屏幕上显示。本章的最后几页展示了如何使用混合方法在现有的光栅化引擎中添加一些光线追踪特性，使其更加生动。

*第八章*, *使用 OpenXR 的扩展现实*，介绍了扩展现实领域，包括虚拟现实、混合现实和增强现实。本章介绍了 OpenXR，包括其主要特性和使用方法。然后本章解释了如何使用 Vulkan 和 OpenXR 功能（如多视图渲染和动态视野）来提高渲染引擎的性能。

*第九章*, *调试和性能测量技术*，通过指导您了解一些调试 Vulkan 应用程序和测量其性能的方法来结束本书。

# 要充分利用本书

您需要一个配备最新显卡的计算机（例如，为了使用一些较新的扩展，如光线追踪，您需要一个与 NVIDIA 3050 相当的显卡）。仓库中和本书中的代码已使用 Visual Studio 2022 和 Vulkan SDK 1.3.268 编译和测试。

| **本书涵盖的软件/硬件** | **操作系统要求** |
| --- | --- |
| Vulkan SDK | Windows; Quest 设备上的 Android |
| CMake 和 Visual Studio 2022 | Windows |
| Android Studio Hedgehog 2023.1.1 | Windows |
| RenderDoc | Windows |
| Tracy Profiler 0.9.1 | Windows |

**我们建议您从本书的 GitHub 仓库克隆代码（下一节中提供了链接）。这样做将帮助您避免与代码复制粘贴相关的任何潜在错误**。

重要提示：

本书包含许多水平较长的截图。这些截图是为了向您展示各种 Vulkan 概念的执行计划概览。因此，在这些图像中，100%缩放时文本可能看起来很小。

# 下载示例代码文件

您可以从 GitHub（[`github.com/PacktPublishing/The-Modern-Vulkan-Cookbook`](https://github.com/PacktPublishing/The-Modern-Vulkan-Cookbook)）克隆本书的示例代码文件。如果代码有更新，它将在 GitHub 仓库中更新。

我们还有来自我们丰富的图书和视频目录的其他代码包，可在[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)找到。查看它们吧！

使用的约定

本书使用了多种文本约定。

`文本中的代码`：表示文本中的代码单词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 昵称。以下是一个示例：“对于主机可见内存，使用`vmaMapMemory`检索目标指针并使用`memcpy`复制数据就足够了。”

代码块设置如下：

```cpp
const VmaAllocationCreateInfo allocCreateInfo = {
    .flags = VMA_ALLOCATION_CREATE_DEDICATED_MEMORY_BIT,
    .usage = VMA_MEMORY_USAGE_AUTO_PREFER_DEVICE,
    .priority = 1.0f,
};
```

当我们希望您注意代码块中的特定部分时，相关的行或项目将以粗体显示：

```cpp
samplerShadowMap_ = context.createSampler(
    VK_FILTER_NEAREST, VK_FILTER_NEAREST,
    VK_SAMPLER_ADDRESS_MODE_CLAMP_TO_EDGE,
    VK_SAMPLER_ADDRESS_MODE_CLAMP_TO_EDGE,
    VK_SAMPLER_ADDRESS_MODE_CLAMP_TO_EDGE, 1.0f,
    true, VK_COMPARE_OP_LESS_OR_EQUAL,
    "lighting pass shadow");
```

**粗体**：表示新术语、重要单词或屏幕上看到的单词。例如，菜单或对话框中的单词以粗体显示。以下是一个示例：“为了保证部分更新能正常工作，我们需要首先将最后一个活动的缓冲区**Buffer 0**复制到**Buffer 1**，然后更新**视口矩阵**。”

小贴士或重要提示

看起来像这样。

# 章节

在本书中，您将找到一些频繁出现的标题（*准备就绪*、*如何操作...*、*它是如何工作的...*、*更多内容...*和*参见*）。

为了清楚地说明如何完成食谱，请按照以下方式使用这些部分：

## 准备就绪

本节告诉您在食谱中可以期待什么，并描述了如何设置任何软件或任何为食谱所需的初步设置。

## 如何操作……

本节包含遵循食谱所需的步骤。

## 它是如何工作的……

本节通常包含对前节发生事件的详细解释。

## 更多内容……

本节包含有关食谱的附加信息，以便您对食谱有更深入的了解。

## 参见

本节提供了指向其他有用信息的链接，这些信息对食谱很有帮助。

# 联系我们

欢迎读者反馈。

**一般反馈**：如果您对本书的任何方面有疑问，请在邮件主题中提及书名，并通过 customercare@packtpub.com 给我们发邮件。

**勘误表**：尽管我们已经尽最大努力确保内容的准确性，但错误仍然可能发生。如果您在这本书中发现了错误，我们将不胜感激，如果您能向我们报告，我们将不胜感激。请访问 [www.packtpub.com/support/errata](http://www.packtpub.com/support/errata)，选择您的书籍，点击勘误提交表单链接，并输入详细信息。

**盗版**：如果您在互联网上以任何形式发现我们作品的非法副本，我们将不胜感激，如果您能提供位置地址或网站名称，我们将不胜感激。请通过 mailto:copyright@packt.com 与我们联系，并提供材料的链接。

**如果您想成为一名作者**：如果您在某个领域有专业知识，并且对撰写或参与一本书籍感兴趣，请访问 [authors.packtpub.com](http://authors.packtpub.com)。

# 评论

请留下评论。一旦您阅读并使用过这本书，为什么不在此购买网站上发表评论呢？潜在读者可以查看并使用您的客观意见来做出购买决定，Packt 可以了解您对我们产品的看法，我们的作者也可以看到他们对书籍的反馈。谢谢！

想了解更多关于 Packt 的信息，请访问 [packtpub.com](http://packtpub.com)。

# 分享您的想法

一旦您阅读过《现代 Vulkan 食谱》，我们很乐意听听您的想法！请[点击此处直接进入此书的亚马逊评论页面](https://packt.link/r/1-803-23998-0)并分享您的反馈。

您的评论对我们和科技社区非常重要，并将帮助我们确保我们提供高质量的内容。

# 下载此书的免费 PDF 副本

感谢您购买这本书！

您喜欢在路上阅读，但无法携带您的印刷书籍到处走？

您的电子书购买是否与您选择的设备不兼容？

别担心！现在，每购买一本 Packt 书籍，您都可以免费获得该书的 DRM 免费 PDF 版本。

在任何地方、任何地方、任何设备上阅读。直接从您最喜欢的技术书籍中搜索、复制和粘贴代码到您的应用程序中。

优惠远不止这些，您还可以获得独家折扣、时事通讯和每日免费内容的每日电子邮件。

按照以下简单步骤获取优惠：

1.  扫描二维码或访问以下链接：

![](img/B18491_QR_Free_PDF.jpg)

[`packt.link/free-ebook/9781803239989`](https://packt.link/free-ebook/9781803239989)

1.  提交您的购买证明。

1.  就这些！我们将直接将您的免费 PDF 和其他优惠发送到您的电子邮件。
