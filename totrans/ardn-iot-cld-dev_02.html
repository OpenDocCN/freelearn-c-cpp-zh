<html><head></head><body>
<div><h1 class="chapter-number" id="_idParaDest-38"><a id="_idTextAnchor038"/>2</h1>
<h1 id="_idParaDest-39"><a id="_idTextAnchor039"/>First Look at the Arduino IoT Cloud</h1>
<p>Every developer/programmer/cloud engineer, when they start their coding/cloud journey, is very curious to get started with the platform immediately. Well, guys, your wait is over, and we welcome you to this chapter with a <em class="italic">Hello World</em> greeting. This chapter not only provides you with a <em class="italic">Hello World</em> example but also comes with many important core concepts of how the <strong class="bold">Arduino IoT Cloud</strong> works. This is the most important chapter for all readers, as this chapter will give you an overview of how to get started with the Arduino IoT Cloud, as the Arduino IoT Cloud platform has significant differences compared to other platforms. This chapter is divided into two parts; in the first part, you will learn how to use the <strong class="bold">Arduino MKR Wi-Fi 1010</strong> board to interact with the Arduino IoT Cloud platform, and in the second part, you will learn how to use an <strong class="bold">API</strong> with <strong class="bold">Node-RED</strong> for communication with the cloud platform.</p>
<p>Along with these examples, you will learn the difference between a <strong class="bold">Thing</strong> and a <strong class="bold">device</strong>, what a <strong class="bold">variable</strong> is, and different properties of Thing. You will also get a taste of the <strong class="bold">Arduino Web Editor</strong>, which is an awesome feature with interesting stuff. After that, we will move on to the dashboard, which helps a user control a Thing and visualize sensor data. So, guys, buckle up for this interesting journey.</p>
<p>The following topics will be covered in this chapter:</p>
<ul>
<li>Understanding how the Arduino IoT Cloud works</li>
<li>The Arduino IoT Cloud and an MKR1010 Hello World example</li>
<li>An introduction to Node-RED</li>
<li>The Arduino IoT Cloud and a Node-RED Hello World example</li>
</ul>
<h1 id="_idParaDest-40"><a id="_idTextAnchor040"/>Technical requirements</h1>
<p>Before we start, we first need to set up an Arduino IoT Cloud-compatible board. I recommend the Arduino MKR Wi-Fi 1010, but there is a complete list of compatible boards at <a href="https://docs.arduino.cc/arduino-cloud/getting-started/technical-reference#compatible-hardware">https://docs.arduino.cc/arduino-cloud/getting-started/technical-reference#compatible-hardware</a>, which you can choose according to your requirements.</p>
<p>Second, you should have an Arduino IoT Cloud account. If you don’t, then sign up at <a href="https://cloud.arduino.cc/">https://cloud.arduino.cc/</a> and select a plan according to your requirements.</p>
<p>Third, we need to download and install the <strong class="bold">Arduino Create Agent</strong>. Arduino has created a beautiful web-based guide for installation at <a href="https://create.arduino.cc/getting-started/plugin/welcome">https://create.arduino.cc/getting-started/plugin/welcome</a>.</p>
<p>The second part of the chapter is related to Node-RED, which will be used for devices that are not officially supported by the Arduino IoT Cloud such as Raspberry Pi and older versions of Arduino development boards. Download and install Node-RED according to your operating system from <a href="https://nodered.org/docs/getting-started/local">https://nodered.org/docs/getting-started/local</a>.</p>
<p class="callout-heading">Important note</p>
<p class="callout">All the Arduino IoT Cloud plans are available on the Arduino IoT Cloud website. You can visit the following link for updated plans, pricing, and features: <a href="https://cloud.arduino.cc/plans/">https://cloud.arduino.cc/plans/</a>. If you are from an educational institute, then there are plenty of good plans for students and faculties. Arduino also offers customized plans to business organizations according to their requirements.</p>
<h1 id="_idParaDest-41"><a id="_idTextAnchor041"/>Understanding how the Arduino IoT Cloud works</h1>
<p>So, before we start our <a id="_idIndexMarker133"/>Arduino IoT Cloud journey, we need to understand how it operates because it’s a little bit different from traditional IoT cloud platforms. As a result, the Arduino IoT Cloud is a more flexible, secure, and industry-deployment-ready IoT solution. Firstly, we will understand the design of the Arduino IoT Cloud with the following diagram, which will help you to understand the key pillars of the Arduino IoT Cloud:</p>
<div><div><img alt="Figure 2.1 – ﻿The ﻿Arduino IoT Cloud architecture" src="img/B19752_02_01.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.1 – The Arduino IoT Cloud architecture</p>
<p>Most cloud platforms work with the <a id="_idIndexMarker134"/>concept of devices and sensors, but in the Arduino IoT Cloud, we have the concept of the Thing, which includes devices and <a id="_idIndexMarker135"/>variables known as <strong class="bold">sensors</strong>/<strong class="bold">actuators</strong>. You may be thinking that a <em class="italic">Thing</em> and a <em class="italic">Device</em> are both<a id="_idIndexMarker136"/> the same; actually, they’re not. It’s important to make this distinction because if we do not understand it, then it will create more complications going forward.</p>
<p>To understand the difference between a Thing and a device, I am going to take an example from real life. Let’s say we have an empty box. If we put some stuff in that box, it will be a filled box. However, what if we put the shipping label on that box? Will it still be a box? No, now it’s a parcel. So, we can understand that a parcel is just a logical container that consists of the box, the stuff in the box, and the shipping label.</p>
<p>Like the preceding example, a Thing is a logical container that consists of a development board, variables that act as a bridge between the cloud and sensors/actuators for read/write operations, and network connectivity that makes the Thing live in an ecosystem (which is like the shipping label in the box analogy).</p>
<p>Next, we need to understand how device configuration works in relation to the Arduino IoT Cloud. Here, we are not talking about <strong class="bold">network connectivity</strong> but <strong class="bold">device configuration</strong>. Some cloud platforms<a id="_idIndexMarker137"/> provide <strong class="bold">Arduino IDE</strong> libraries or <strong class="bold">Software Development Kits</strong> (<strong class="bold">SDKs</strong>) for device configuration, but Arduino has a different, more restrictive system. Firstly, the Arduino IoT Cloud has two ways for device configuration; the first one uses compatible boards via the Arduino Create Agent (in the upcoming section, you will dive deep into the Arduino Create Agent) and the second way is through an API, which is used for non-compatible devices.</p>
<p>So, why does <a id="_idIndexMarker138"/>Arduino have this restriction for device connectivity? Arduino cares about security for IoT devices, and security is as vital in an IoT infrastructure as water is for living beings. Also, not all the official Arduino development boards are compatible with the Arduino IoT Cloud. You can find the complete list of Arduino IoT Cloud-compatible devices at <a href="https://docs.arduino.cc/arduino-cloud/getting-started/technical-reference#compatible-hardware">https://docs.arduino.cc/arduino-cloud/getting-started/technical-reference#compatible-hardware</a>. The Arduino IoT Cloud directly supports some famous boards besides the Arduino official compatible boards, which include <strong class="bold">ESP8266 Series</strong>, <strong class="bold">ESP32 Series</strong>, and <strong class="bold">LoRaWAN Nodes</strong>. An API is available for other development boards, which can be used via any programming language. Later on in this chapter, we will explain how to use APIs with Node-RED to communicate with the Arduino IoT Cloud.</p>
<p>Finally, which options are available for <strong class="bold">data visualization</strong> and <strong class="bold">data extraction</strong>? The Arduino IoT Cloud platform <a id="_idIndexMarker139"/>provides a variety of options. For data visualization, the platform provides a flexible dashboard option for both web and mobile, with huge widget features as well as sharing features. For third-party application integrations, a <strong class="bold">Representational State Transfer</strong> (<strong class="bold">REST</strong>) <strong class="bold">API</strong> and <strong class="bold">w</strong><strong class="bold">ebhooks</strong> are available. For custom application development<a id="_idIndexMarker140"/> or custom integrations, Arduino provides <strong class="bold">JavaScript</strong> and <strong class="bold">Python SDKs</strong>, which enrich the platform’s extensibility. An organization can create custom dashboard visualization and control panels by using these SDKs.</p>
<p>We have discussed the Arduino IoT Cloud’s main pillars; now it’s time to explore the Arduino IoT Cloud by implementing basic examples, which will get you started with the Arduino MKR Wi-Fi 1010 development board and the Arduino IoT Cloud.</p>
<h1 id="_idParaDest-42"><a id="_idTextAnchor042"/>The Arduino IoT Cloud and the MKR1010 Hello World example</h1>
<p>A <strong class="bold">Hello World program</strong> is the first <a id="_idIndexMarker141"/>program that every programmer uses when they start learning any programming technology to get a taste<a id="_idIndexMarker142"/> for a platform. However, when it comes to the IoT side, things are different; you will be working with hardware and software, which means the <em class="italic">Hello World</em> example will be different from its traditional onscreen appearance. In this section, we will demonstrate how to turn on/off a built-in LED of an Arduino MKR Wi-Fi 1010 development board using the Arduino IoT Cloud dashboard, which is a <em class="italic">Hello World</em> example for the Arduino IoT Cloud.</p>
<p>In a series of steps, you will learn how to work with Arduino IoT Cloud-compatible boards. This part is very important to understand how a Thing works on the Arduino IoT Cloud platform. First, you need to get the required hardware, software, and accounts, as mentioned in the <em class="italic">Technical </em><em class="italic">requirements</em> section.</p>
<p>So, in this section, we are <a id="_idIndexMarker143"/>going to start the <em class="italic">Hello World</em> project for the Arduino IoT Cloud using MKR Wi-Fi 1010. In the next sub-section, we will <a id="_idIndexMarker144"/>cover the Arduino Create Agent. Next, we will create a Thing and cloud variables, associate the MKR Wi-Fi 1010 device with the Thing, and provide the network configuration for the Thing. Later, we will discuss the sketch/coding for the development board.</p>
<h2 id="_idParaDest-43"><a id="_idTextAnchor043"/>What is the Arduino Create Agent?</h2>
<p>The Arduino IoT Cloud provides <a id="_idIndexMarker145"/>a different way to connect a device to its cloud. Arduino does not publicly reveal its cloud connectivity technique for security reasons. That’s why we only have two options to connect devices with the Arduino IoT Cloud – using the Arduino Cloud IDE or the API. Also, for the Arduino Cloud IDE, it’s mandatory to have the Arduino Create Agent on your machine. <em class="italic">Figure 2</em><em class="italic">.2</em> shows the complete process of how the Create Agent helps devices to interact with the Arduino Web Editor.</p>
<div><div><img alt="Figure 2.2 – The Arduino Create Agent process flow" src="img/B19752_02_02.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.2 – The Arduino Create Agent process flow</p>
<p>As the Arduino Web Editor is a web-based tool, there is no way to talk to development boards via a browser. That’s why the Arduino team developed software for all major operating systems, including Windows, Linux, and macOS, called the Arduino Create Agent. The Create Agent acts like a bridge between a device and the Arduino Web Editor. The preceding<a id="_idIndexMarker146"/> diagram explains the process in detail.</p>
<p>To get the Create Agent on your machine, visit <a href="https://create.arduino.cc/getting-started/plugin/welcome">https://create.arduino.cc/getting-started/plugin/welcome</a> and <a id="_idIndexMarker147"/>follow the steps. After installation, start the Create Agent, as just installing it is not enough for connectivity. The Create Agent will run as a background process to provide continuous integration between a device and a browser. The following is a figure that describes all the options of the Arduino Create Agent:</p>
<div><div><img alt="Figure 2.3 – The Arduino Create Agent menu" src="img/B19752_02_03.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.3 – The Arduino Create Agent menu</p>
<p>When we click on the Create<a id="_idIndexMarker148"/> Agent icon, it shows the Create Agent version, a <strong class="bold">Go to Arduino Create</strong> option, and an <strong class="bold">Open Debug Console</strong> option, which is like a serial monitor, where you can execute different commands to get the status and information about the current process, devices, and ports. Also from this menu, you can pause/resume the Create Agent, or if you want to close it down properly, then click on <strong class="bold">Quit Agent</strong>.</p>
<h2 id="_idParaDest-44"><a id="_idTextAnchor044"/>Setting up the Thing, device, and variable</h2>
<p>In this section, we will create a Thing and name it. We will also learn how to add a device, along with network configuration and cloud variables.</p>
<h3>Creating a Thing</h3>
<p>When you first <a id="_idIndexMarker149"/>open the dashboard in the Arduino IoT Cloud (<em class="italic">Figure 2</em><em class="italic">.4</em>), you will see menu links such as <strong class="bold">Things</strong>, <strong class="bold">Dashboards</strong>, <strong class="bold">Devices</strong>, <strong class="bold">Integrations</strong>, and <strong class="bold">Templates</strong>, and the <strong class="bold">Create your first Thing</strong> message. Just click on the <strong class="bold">CREATE THING</strong> button and your journey will start.</p>
<div><div><img alt="Figure 2.4 – The Thing dashboard" src="img/B19752_02_04.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.4 – The Thing dashboard</p>
<p>Adding a Thing is<a id="_idIndexMarker150"/> totally different compared to other IoT cloud platforms, as the Thing is a combination of multiple ingredients. The following figure describes all the ingredients of the Thing, such as the name, cloud variables, device, network settings, code, and Thing metadata:</p>
<p class="IMG---Figure"> </p>
<div><div><img alt="Figure 2.5 – Thing creation" src="img/B19752_02_05.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.5 – Thing creation</p>
<p>All the aspects indicated in the preceding screenshot are explained, step by step, as follows:</p>
<ol>
<li>Assign a name to the Thing; the name should relate to the location and functionality of the device, which will help you to find the Thing easily in the following wizards.</li>
<li>Clicking on <strong class="bold">Select Device</strong> will show you a popup, where you can select the old device or set up a new device, as discussed in detail in a moment.</li>
<li>After attaching the device, we need to make the device network-ready by providing a Wi-Fi SSID and a password. Just click on the <strong class="bold">Configure</strong> button and you will see the popup for network settings.</li>
<li>Finally, we need to add a variable for the sensors/actuators to perform read/write operations. The Arduino IoT Cloud provides different types of variables, like the Arduino IDE; the only difference is that in the Arduino IDE, we declare the variables, whereas here, we need to create variables via the interface.</li>
</ol>
<p>In this section, we have created the Thing and named it. Three further steps are required adding a device, network configuration, and adding cloud variables. We are going to cover the remaining steps in<a id="_idIndexMarker151"/> the following subsections.</p>
<h3>Adding a device</h3>
<p>After assigning a name to the<a id="_idIndexMarker152"/> Thing, we need to attach a device to it. When you click on the <strong class="bold">Select Device</strong> button, you will see a popup that shows you an available device and the option to add a new device. If there is no device, then you will see the following figure to set up a new device:</p>
<div><div><img alt="Figure 2.6 – Associating a device" src="img/B19752_02_06.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.6 – Associating a device</p>
<p>In our case, we don’t have any device in the portal, so we will just click on <strong class="bold">SET UP NEW DEVICE</strong> to configure a new device in the account.</p>
<p>Next, you will see the two options in the popup. The first option is<strong class="bold"> Arduino board</strong>, and the second option is <strong class="bold">Third party device</strong>. Here, you will see an icon in front of both names, which means you need to use compatible devices with the Arduino IoT Cloud. Next, you will see two options: one for the Arduino official development boards and a second option for the third-party <a id="_idIndexMarker153"/>development boards.</p>
<div><div><img alt="Figure 2.7 – Choosing a development device" src="img/B19752_02_07.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.7 – Choosing a development device</p>
<p>Select one option from the popup according to the available device. For this chapter, we will click on <strong class="bold">Arduino board</strong>, as in this chapter, we will use the MKR Wi-Fi 1010 board. Before adding the device, make sure that the Arduino Create Agent is running on your machine.</p>
<p class="callout-heading">Important note</p>
<p class="callout">You can find the Arduino IoT Cloud-compatible boards at <a href="https://store-usa.arduino.cc/pages/cloud-compatible-boards">https://store-usa.arduino.cc/pages/cloud-compatible-boards</a>, and for third-party devices, we have three options, which are <strong class="bold">ESP8266</strong>, <strong class="bold">ESP32</strong>, and <strong class="bold">LoRaWAN</strong> devices. For some devices, we have API access, which will be discussed in the second part of this chapter.</p>
<p>Next, you will <a id="_idIndexMarker154"/>see the <strong class="bold">Setup Device</strong> popup, which will start searching for your device. So, make sure the device is properly connected to your machine. When the Arduino Create Agent detects the compatible development board device, the following popup will be shown:</p>
<div><div><img alt="Figure 2.8 – Setup Device" src="img/B19752_02_08.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.8 – Setup Device</p>
<p>The wizard will find and list all the connected boards with their name and port details. Click on the <strong class="bold">CONFIGURE</strong> button to move forward. If the wizard doesn’t show the device after searching, try to plug in a different port and click on the <strong class="bold">refresh</strong> link, located at the bottom. After development board configuration has been taken care of by the Arduino IoT Cloud, you will see a popup where you need to provide the name of your device:</p>
<p>In the next configuration wizard, provide the device’s name (note that spaces and special characters are not allowed in the device name) and then click on the <strong class="bold">NEXT</strong> button.</p>
<div><div><img alt="Figure 2.9 – The device configuration name" src="img/B19752_02_09.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.9 – The device configuration name</p>
<p>After that, the wizard<a id="_idIndexMarker155"/> will start the device configuration process, which will take up to five minutes. But in most cases, it only takes one minute to configure the device.</p>
<p>Eventually, you will see a popup with a <strong class="bold">Congratulations! You are all set</strong> message. Click on the <strong class="bold">Done</strong> button, and the device will be attached to your Thing.</p>
<p>On the Thing page, you will see the device details, which are marked in the red box in the following figure:</p>
<div><div><img alt="Figure 2.10 – The device attached to the Thing" src="img/B19752_02_10.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.10 – The device attached to the Thing</p>
<p>The page shows the <a id="_idIndexMarker156"/>device name, the device ID, its type, its status (which is either <strong class="bold">Online</strong> or <strong class="bold">Offline</strong>), and two buttons, <strong class="bold">Change</strong> and <strong class="bold">Detach</strong>:</p>
<ul>
<li><strong class="bold">Change</strong> is used to switch between devices – for example, if you have chosen the wrong device, then you can select a different one via this option.</li>
<li><strong class="bold">Detach</strong> means removing the device from the Thing. Why might we need to detach? For example, you may have created a Thing and associated the device with it, but you are now not using that Thing. If you want to set up a new Thing with that device, the platform will not allow you to do so if it’s already associated with the old Thing.</li>
</ul>
<p class="callout-heading">Important note</p>
<p class="callout">The device and the Thing have a one-to-one relationship. If you want to use a device with a new Thing, then make sure it’s not associated with another one.</p>
<p>As we have added the<a id="_idIndexMarker157"/> device, let us move toward network configuration.</p>
<h3>Configuring the network</h3>
<p>After attaching the device to the <a id="_idIndexMarker158"/>Thing, we can see that the device is offline. To bring it online, we need to provide Wi-Fi details. The following figure represents the network configuration popup, which only consists of two fields:</p>
<div><div><img alt="Figure 2.11 – Network configuration" src="img/B19752_02_11.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.11 – Network configuration</p>
<p>On the Thing page shown in <em class="italic">Figure 2</em><em class="italic">.5</em>, under the <strong class="bold">Network</strong> tab, click on the <strong class="bold">CONFIGURE</strong> button, which will take you to the <strong class="bold">Configure network</strong> popup with two fields, <strong class="bold">Wi-Fi Name</strong> and <strong class="bold">Password</strong>. Type the Wi-Fi SSID and password, and then click on the <strong class="bold">SAVE</strong> button.</p>
<p>In this section, we <a id="_idIndexMarker159"/>have configured the network for our device, which is MKR Wi-Fi 1010, and in the next sub section, we will create the cloud variable.</p>
<h3>Adding a cloud variable</h3>
<p>The final part is adding a<a id="_idIndexMarker160"/> cloud variable. Before adding a variable, you have to have an idea of what type of variables you need for your project, including the <strong class="bold">variable type</strong>, the <strong class="bold">variable permission</strong>, and the <strong class="bold">variable </strong><strong class="bold">update policy</strong>.</p>
<p>For the current example, we need one variable to control the built-in LED, so the variable type will be <strong class="bold">Boolean</strong> (either on/off):</p>
<div><div><img alt="Figure 2.12 – Adding a variable" src="img/B19752_02_12.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.12 – Adding a variable</p>
<p>This way, we will<a id="_idIndexMarker161"/> control the LED via the dashboard:</p>
<ol>
<li>Assign a meaningful name to the variable, related to the sensor/actuator type. Remember that spaces and special characters are not allowed in the name.</li>
<li>If you want to sync the variable with other Things’ variables, then click on the <strong class="bold">Sync with other Things option</strong>. The sync option is very beneficial if you want to share data across other Things. Sync will be explained in later chapters alongside a practical demonstration.</li>
<li>Select the variable type from the dropdown; the platform provides dozens of variable types. For this example, we need a <strong class="bold">Boolean</strong> variable type for LED control.</li>
<li>After selecting the <a id="_idIndexMarker162"/>variable type, you will see the variable <code>LED</code>, but the system has converted the first letter to lowercase and the rest of the characters are left as is, making the name <strong class="bold">lED</strong>. This declaration part is very important; you can change the declaration according to your requirements, but keep the declaration in mind, as it will be used in coding.</li>
<li>The variable permission provides two options, <strong class="bold">Read &amp; Write</strong> and <strong class="bold">Read Only</strong>. The permission provides an extra layer of security for the Thing’s control. If a sensor only senses data such as temperature/humidity, then choose the <strong class="bold">Read Only</strong> option. If you want to control actuators such as the relay and the LED, then choose the <strong class="bold">Read &amp; Write</strong> option. For our example, we need to write data to the variable to control the LED, so we will simply choose <strong class="bold">Read &amp; </strong><strong class="bold">Write</strong>.</li>
<li>Finally, we need to choose an update policy according to our requirements. One option is event-driven (shown onscreen as <strong class="bold">On change</strong>), which only works when there is a change. It works when prompted by commands such as turning on/off a relay or LED. The second option is <strong class="bold">Periodically</strong>, which means taking data from a variable, such as temperature, humidity, air pressure, or a <strong class="bold">Light Dependent Resistor</strong> (<strong class="bold">LDR</strong>) value after <a id="_idIndexMarker163"/>a specific time. When you change the option to <strong class="bold">Periodically</strong>, it will ask you for a time measured in seconds, whereas for <strong class="bold">On change</strong>, there is a threshold option.</li>
</ol>
<p>After adding the variable, our Thing now has all the mandatory ingredients. The following figure describes all the settings and configurations when we are done with the cloud variable, device, and network settings. Next, we need to jump to the <strong class="bold">Sketch</strong> tab for coding:</p>
<div><div><img alt="Figure 2.13 – The Thing after configuration" src="img/B19752_02_13.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.13 – The Thing after configuration</p>
<p>The preceding screenshot<a id="_idIndexMarker164"/> illustrates the device association, network configuration, and variable settings, which are essential components of the Thing. Next, click the <strong class="bold">Sketch</strong> tab, where you will open the Arduino Web Editor for coding. Here, we will add the code that will be associated with the LED variable. In this section, we have completed all the tasks via drag and drop, but now it’s time to do some work by putting some coding into our development board. In the next section, we will explore sketches.</p>
<h2 id="_idParaDest-45"><a id="_idTextAnchor045"/>Writing a sketch</h2>
<p>Most Things are <a id="_idIndexMarker165"/>set up in the <a id="_idIndexMarker166"/>cloud via a <strong class="bold">graphical user interface</strong> (<strong class="bold">GUI</strong>), but we still need to do some coding. The following figure describes all the options of the mini web editor, such as verifying and uploading the code, selecting the development board on specific ports, and the code area for writing and editing.</p>
<div><div><img alt="Figure 2.14 – Mini web editor" src="img/B19752_02_14.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.14 – Mini web editor</p>
<p>The code will<a id="_idIndexMarker167"/> associate a variable with physical sensors/actuators to make it work properly. Please see the following steps:</p>
<ol>
<li>Here, you will see two buttons, like with the Arduino IDE. The tick button is used to verify code, while the arrow icon button is used to upload the code to the development board.</li>
<li>This part shows whether your device is connected to your machine or not. If the development board is connected, then it will show the device name with the port.</li>
<li>The Arduino Cloud Editor has two variants – one is basic and the other is full. In the <strong class="bold">Thing </strong>tab shown in <em class="italic">Figure 2</em><em class="italic">.14</em>, we can see the mini version of the editor, but if you want to move to the full editor for the installation of libraries or other stuff, then click on the <strong class="bold">&lt;/&gt;</strong> button.</li>
<li>Scroll down the editor, and at the bottom, you will see the <code>OnLEDChange()</code> function, which is associated with the <strong class="bold">LED</strong> variable. In this function, we need to write the code that will provide connectivity to the sensor/physical pins of the development board.</li>
</ol>
<p>According to our <a id="_idIndexMarker168"/>current example project, we just want a turned-on/turned-off, built-in LED for the development board. The following is the code that will be used in the function:</p>
<pre class="source-code">
if(lED==1)
  {
    digitalWrite(LED_BUILTIN,1);
  }else{
    digitalWrite(LED_BUILTIN,0);
  }</pre> <p>First, let’s recall the declaration used during variable creation, which is shown in <em class="italic">Figure 2</em><em class="italic">.12</em>. What the code does is turn the built-in LED on if the <code>lED</code> variable contains a true value; otherwise, it turns the built-in LED off.</p>
<p>To write Boolean values on development board pins, we have a method called <code>digitalWrite</code>, which takes two parameters. The first parameter is a pin number and in the second parameter we will place <code>true</code>/<code>false</code> or <code>1</code>/<code>0</code>, while we are using <code>LED_BUILTIN</code>, which is a constant and contains <em class="italic">PIN #13</em>. The second parameter is a value, which is either <code>1</code> or <code>0</code>. This parameter changes according to the <code>lED</code> variable state. Here we are done with our coding exercise. Now it’s time to create a graphical user interface from where we turn on/off the LED. In the following section, we will set up the dashboard to control the LED.</p>
<h2 id="_idParaDest-46"><a id="_idTextAnchor046"/>Creating a dashboard for web and mobile with an interactive widget</h2>
<p>After setting up a<a id="_idIndexMarker169"/> complete Thing, we are done with device setup, network settings, the variable, and coding the variable. The next question is, how can we turn the LED on/off? For that, we need to create a dashboard. <em class="italic">Figure 2</em><em class="italic">.15</em> illustrates a dashboard. Click on the <strong class="bold">Dashboards</strong> link in the top menu. After loading the dashboard page for the first time, you will see an empty page with one green button at the bottom of the page – <strong class="bold">Build Dashboard</strong>.</p>
<div><div><img alt="Figure 2.15 – The Things dashboard" src="img/B19752_02_15.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.15 – The Things dashboard</p>
<p>Click on the button, and you will be taken to the dashboard builder page to create a new stunning dashboard for your device control, as follows:</p>
<ol>
<li>The dashboard has two modes, view and editing. By default, it’s on editing mode, which is denoted by an edit icon, and we can switch to view mode by clicking on the eye icon. In view mode, we can’t modify the widget’s settings and alignment.</li>
<li>To add controls on the dashboard, click on the green <strong class="bold">ADD</strong> button, and a drop-down menu will appear with a variety of widgets. Here, you can select a widget by scrolling or searching.</li>
<li>This button is used to arrange the widgets. During editing, you are not able to navigate, resize, or move the widget controls.</li>
<li>As mobile icon is representing it’s working from its icon, this means by click on this icon you can adjust your dashboard for mobile devices. Arduino provides both views of the dashboard for desktop and mobile. You can switch between them by clicking on the mobile/desktop icon.</li>
<li>In the textbox, type the dashboard name.</li>
</ol>
<p>Now that we have <a id="_idIndexMarker170"/>created the dashboard, it’s time to put a widget on it. Widgets will help us to control/view the sensors/actuators. When you click on the <strong class="bold">Add</strong> button, you will see the list of widgets. Here you can select a widget by scrolling through the list or by searching the widgets via the search bar, as shown in the following figure:</p>
<div><div><img alt="Figure 2.16 – The widgets list" src="img/B19752_02_16.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.16 – The widgets list</p>
<p>Select the <strong class="bold">Switch</strong> widget control for the current example project. After selecting the widget control, a popup will appear, where we need to link the Thing variable with the widget control to read/write the data to the device sensors. This is because the variable is the bridge between the <a id="_idIndexMarker171"/>dashboard widget controls and the Thing sensors to read and write data.</p>
<p>In the widget popup, we have different settings, as shown in the following figure:</p>
<div><div><img alt="Figure 2.17 – Widget settings" src="img/B19752_02_17.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.17 – Widget settings</p>
<p>The widget settings are detailed as follows:</p>
<ol>
<li>Firstly, we need to assign a name to our widget. Make sure to give it a proper name that represents the sensor’s name. Here, I used the name <strong class="bold">LED-Switch</strong>.</li>
<li>Hide or show the widget frame content, which is at the top and bottom of the widget.</li>
<li>Click on <strong class="bold">Link Variable</strong> to attach the Thing variable to the widget control, which will be explained in the next figure.</li>
<li>Hide/show the <a id="_idIndexMarker172"/>widget label to hide the text that overlays the widget control. In the preceding figure, it switches the <strong class="bold">ON</strong>/<strong class="bold">OFF</strong> button text.</li>
</ol>
<p>It’s time to attach the widget control to the variables. Note that we can add multiple controls on the same dashboard that are linked to different Things’ variables, which shows the versatility of Arduino IoT Cloud dashboards, as shown in the following figure:</p>
<p class="IMG---Figure"> </p>
<div><div><img alt="Figure 2.18 – Linking a Thing variable with a widget control" src="img/B19752_02_18.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.18 – Linking a Thing variable with a widget control</p>
<p>As shown in <em class="italic">Figure 2</em><em class="italic">.18</em>, we have the following steps to assign the cloud variable to the widget control:</p>
<ol>
<li>Select a Thing from the <strong class="bold">Things</strong> list. After selecting the Thing, it will show you the variables that are associated with that Thing.</li>
<li>Select a variable from the <strong class="bold">Variables</strong> list.</li>
<li>Here, you will see all the details of the variables, such as the Thing name, <strong class="bold">Type</strong>, <strong class="bold">Last value</strong>, <strong class="bold">Permission</strong>, <strong class="bold">Update policy</strong>, and <strong class="bold">Last update</strong>. The purpose of this detailed summary is to make sure to verify that you have attached the right variable to the widget control.</li>
</ol>
<p>After selecting the variable from the specific Thing, click on the <strong class="bold">LINK VARIABLE</strong> button, and you will see the variable details in the widget control popup. From there, you can change or detach the variable. Finally, click on the <strong class="bold">DONE</strong> button; now, our dashboard is ready, with a widget control to send commands to the Thing. Just click on the eye icon on the dashboard to make it operational. After that, start testing the dashboard controls.</p>
<p>Here we are done with our first example project with Arduino MKR1010 and the Arduino IoT Cloud. Next, you need to solve <em class="italic">Assignment 1</em> of this section. After that, you will jump into the second<a id="_idIndexMarker173"/> section of this chapter, where you will learn how to use the Arduino IoT Cloud with non-compatible devices, such as Arduino Uno, Raspberry Pi, and so on via Node-RED.</p>
<h2 id="_idParaDest-47"><a id="_idTextAnchor047"/>Assignment 1</h2>
<p>Congratulations! You have completed the first part of this chapter successfully, and I hope you enjoyed that journey. Now, it’s time to verify what you have learned so far by giving you a small assignment:</p>
<ol>
<li>Attach three differently colored LEDs of any color (preferably, red, yellow, and green) to the Arduino MKR1010 development board on pin numbers 1, 2, and 3, respectively.</li>
<li>Set up a new Thing with the name <code>IoT-Based Traffic </code><code>Lights Control</code>.</li>
<li>Associate the device, configure its network settings, and create variables according to the number of LEDs. Variable names should be based on LED colors such as <code>LED_Red</code>.</li>
<li>Write the code that will turn the LED on/off according to the variable value. After writing the code for each LED, verify and upload the code to the development board.</li>
<li>Finally, set up the dashboard with the name <code>Traffic Light </code><code>Control Dashboard</code>.</li>
<li>Add the <strong class="bold">Switch</strong> buttons according to the number of LEDs, and link them with their associated variables.</li>
<li>Test the LEDs by switching them on/off via a dashboard.</li>
</ol>
<p class="callout-heading">Important note</p>
<p class="callout">Try the <strong class="bold">Push Button</strong> widget control along with the <strong class="bold">Switch</strong> button widget control. Verify whether one variable allows you to connect with more than one widget. Also, verify the behavior of the <strong class="bold">Push Button</strong> widget control by turning the <strong class="bold">Switch</strong> button on/off.</p>
<p>Our world is full of different types of technologies. Whenever a new innovation comes on the market, it always provides compatibility with older devices. In the Arduino IoT Cloud, we have a list of devices that are currently supported, but there are millions of devices that are not compatible with the Arduino IoT Cloud. So, while in the previous section of the chapter, we practiced an example with Arduino IoT Cloud-compatible development boards, next, we are going to look at how we can connect/use non-compatible devices with the Arduino IoT Cloud, such as Arduino UNO, Raspberry Pi, BeagleBone, and so on.</p>
<h1 id="_idParaDest-48"><a id="_idTextAnchor048"/>Introducing Node-RED</h1>
<p>Node-RED is a free, open <a id="_idIndexMarker174"/>source visual programming tool for IoT and other applications. It was developed by IBM Emerging Technology and was first released in 2013. Node-RED provides a web-based interface to wire together hardware devices, APIs, and online services in new and<a id="_idIndexMarker175"/> interesting ways. The tool uses a <strong class="bold">graphical flow-based programming language</strong>, making it easy for users with little or no programming experience to build complex IoT systems. Node-RED has become popular in the IoT and smart home communities for its ease of use and ability to integrate with a wide range of devices and services.</p>
<p>Node-RED is a flow-based development tool for IoT and other applications. It provides a visual, drag-and-drop interface to connect different devices, APIs, and online services. With Node-RED, users can wire together inputs, outputs, and functions to create sophisticated IoT solutions. As well as being open source and free to use, Node-RED has a large user community and a library of pre-built components.</p>
<p>With all Node-RED’s aforementioned benefits, the following question arises: why do we need to use the Arduino IoT Cloud? At the start of the chapter, I mentioned that the Arduino IoT Cloud only supports a few development boards natively. Even Arduino doesn’t support all of their development boards, especially Arduino UNO, Arduino Mega, and Raspberry Pi from the Raspberry Pi Foundation, which are very famous among makers and hobbyists and used by industry. The solution to this is Node-RED, which is compatible with most development boards and has an Arduino IoT Cloud module, making it easier for developers to<a id="_idIndexMarker176"/> integrate non-compatible devices with the Arduino IoT Cloud.</p>
<p>Node-RED can be used with the Arduino IoT <a id="_idIndexMarker177"/>Cloud with several benefits:</p>
<ul>
<li><strong class="bold">Ease of development</strong>: Node-RED’s visual, drag-and-drop interface makes it easy for users to connect Arduino boards to the cloud and build IoT applications quickly</li>
<li><strong class="bold">Integration with the Arduino IoT Cloud</strong>: Node-RED has built-in support for the Arduino IoT Cloud, allowing users to easily connect their Arduino boards, as well as other development boards, and send data to the cloud</li>
<li><strong class="bold">Flexibility</strong>: The flow-based programming model of Node-RED makes it easy to build and modify complex systems</li>
<li><strong class="bold">Flow-based programming</strong>: Node-RED’s flow-based programming model is well suited to building IoT applications, as it allows users to quickly connect inputs, outputs, and functions to create sophisticated systems</li>
<li><strong class="bold">Open source</strong>: Node-RED is open source, allowing users to access the source code and make modifications if necessary</li>
<li><strong class="bold">Large user community</strong>: Node-RED has a large and active user community, providing access to a wealth of information and pre-built components</li>
</ul>
<p>These benefits make Node-RED a good choice for developing Arduino-based IoT applications and connecting them to the cloud. By using Node-RED, users can leverage the power of the cloud to store, analyze, and visualize data from their IoT systems. In this section, we have discussed the features and benefits of Node-RED. Now it’s time to take a practical look by implementing the example project. The following sections will take you through the implementation of the project step by step.</p>
<h1 id="_idParaDest-49"><a id="_idTextAnchor049"/>The Arduino IoT Cloud and a Node-RED Hello World example</h1>
<p>In this section, we will build <a id="_idIndexMarker178"/>on our project by adding some extra functionality to our system via Node-RED. This will help you to understand how you can use Node-RED to integrate non-compatible devices with <a id="_idIndexMarker179"/>the Arduino IoT Cloud.</p>
<p>Node-RED will monitor the LED status based on a value that is either <code>LEDStatus</code>, which will be linked to the <strong class="bold">Status</strong> widget, which shows the LED as being either on or off. Using this example, you will learn how to read data from a Thing property/variable and how to write data to a Thing property/variable.</p>
<p>Node-RED has a module that was officially developed by Arduino for connectivity with the Arduino IoT Cloud. It provides five nodes to carry out different types of operations. For further details, visit <a href="https://flows.nodered.org/node/@arduino/node-red-contrib-arduino-iot-cloud">https://flows.nodered.org/node/@arduino/node-red-contrib-arduino-iot-cloud</a>.</p>
<h2 id="_idParaDest-50"><a id="_idTextAnchor050"/>A tour of the Node-RED editor</h2>
<p>Before moving on, I want <a id="_idIndexMarker180"/>to first remind you that you need to set up Node-RED on your machine. If you already have, that’s great; otherwise, you need to set up on a local machine by going to <a href="https://nodered.org/docs/getting-started/local">https://nodered.org/docs/getting-started/local</a>. If you are looking for more cloud/development board options, then go to <a href="https://nodered.org/docs/getting-started/">https://nodered.org/docs/getting-started/</a>.</p>
<p>After installation, start Node-RED and type <code>127.0.0.1:1880</code> or <code>localhost:1880</code> in your browser URL bar. After that, you will see an interface, with a white space area and several different colored boxes on the left sidebar; here I have marked the following figure with different numbered boxes, which are explained in detail after the figure:</p>
<div><div><img alt=" Figure 2.19 – A Node-RED interface overview" src="img/B19752_02_19.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"> Figure 2.19 – A Node-RED interface overview</p>
<p>The various parts<a id="_idIndexMarker181"/> of the preceding figure are explained as follows:</p>
<ol>
<li>These colorful boxes are called <strong class="bold">nodes</strong>. Node-RED <a id="_idIndexMarker182"/>divides different types of nodes into different groups, such as <strong class="bold">common</strong> and <strong class="bold">function</strong>.</li>
<li>This is the working area, or canvas area, where you will drag and place the nodes.</li>
<li>The <strong class="bold">debug</strong> area is used to debug the output and input of different operations to verify that everything is working fine.</li>
<li>Just like in other development environments, we can execute/run a program using the <strong class="bold">Deploy</strong> option. <strong class="bold">Deploy</strong> has different options; if you click on the small downward arrow icon, you will get a list of options, such as <strong class="bold">Full</strong>, <strong class="bold">Modified Flows</strong>, <strong class="bold">Modified Nodes</strong>, and <strong class="bold">Restart Flows</strong>.</li>
<li>The hamburger icon at the top right is the main navigation button, where you can find all the options to control the Node-RED configuration, especially for the installation <a id="_idIndexMarker183"/>of modules. In our case, we will install the Arduino IoT Cloud module.</li>
</ol>
<p>Here we have discussed the interface of Node-RED with all the main options. In the following section, we will look at how to install the Arduino IoT Cloud module for Node-RED, and in the subsequent sections, we will see its implementation.</p>
<h2 id="_idParaDest-51"><a id="_idTextAnchor051"/>Installing the Arduino IoT Cloud module for Node-RED</h2>
<p>For Node-RED to<a id="_idIndexMarker184"/> communicate with the Arduino<a id="_idIndexMarker185"/> IoT Cloud, we need to install the Arduino IoT Cloud module, which was officially developed by the Arduino team.</p>
<p>Click on the navigation icon in the top-right corner of the app and then click on <strong class="bold">Manage palette</strong>. After that, you will see a popup like the one in the following figure:</p>
<div><div><img alt="Figure 2.20 – Arduino IoT Cloud module installation" src="img/B19752_02_20.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.20 – Arduino IoT Cloud module installation</p>
<p>From that<a id="_idIndexMarker186"/> popup, we will install a<a id="_idIndexMarker187"/> module:</p>
<ol>
<li>To install a module, click on <strong class="bold">Palette</strong>.</li>
<li>Next, select the <strong class="bold">Install</strong> tab.</li>
<li>Initially, you will see a blank area. Type <code>Arduino</code> in the search bar, which will display different modules.</li>
<li>Find the <strong class="bold">@arduino/node-red-contrib-arduinio-iot-cloud</strong> module and click on <strong class="bold">install</strong>. In the previous figure, you can see that I already have that module.</li>
</ol>
<p>Now that we have installed the<a id="_idIndexMarker188"/> module, it’s time to have a look at what type of nodes are available in the <a id="_idIndexMarker189"/>Arduino IoT Cloud module. Close the installation palette, scroll down through the nodes to the bottom, and you will arrive at the <strong class="bold">Arduino IoT Cloud</strong> section, as shown in the following figure:</p>
<div><div><img alt="Figure 2.21 – Arduino IoT Cloud nodes" src="img/B19752_02_21.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.21 – Arduino IoT Cloud nodes</p>
<p>Here is a breakdown of the nodes shown in <em class="italic">Figure 2</em><em class="italic">.21</em>:</p>
<ol>
<li>The first one is an <em class="italic">IN</em> node (in Node-RED, we have nodes; that’s why I used the word node instead of property to get the value from the Thing property/variable).</li>
<li>The second is an <em class="italic">OUT</em> node, used to write the value to the Thing property/variable.</li>
<li>The third is the <strong class="bold">historic</strong> node, which is used to get data from a specific property until a specific time. This node is useful when you want to get the set of values for a specific sensor, such as temperature/humidity.</li>
<li>The <a id="_idIndexMarker190"/>fourth is <strong class="bold">periodic</strong> and is useful when<a id="_idIndexMarker191"/> you want to get the value of a specific property after a specific period of time, such as getting the value of soil moisture after a specific time interval.</li>
<li>The fifth, which is our last node, is <strong class="bold">inject</strong>. This is used to add value to the flow of the Arduino IoT Cloud variables after receiving some sort of input. <em class="italic">OUT</em> is different, as it only sends out data, but this node will inject the value into the Arduino IoT Cloud variable.</li>
</ol>
<p>In this section, we have discussed the nodes to work with the Arduino IoT Cloud, that are available to developers from the Arduino IoT Cloud module. Next, we will set up the API, cloud variables, and dashboard to proceed further.</p>
<h2 id="_idParaDest-52"><a id="_idTextAnchor052"/>Setting up an API, variable, and dashboard widget</h2>
<p>After installing the Arduino IoT Cloud module, it’s time to set up an API in the Arduino IoT Cloud. In the Arduino IoT Cloud’s older interface, there<a id="_idIndexMarker192"/> were API options under the <strong class="bold">Integrations</strong> tab, but now, the Arduino team has moved the API option to the Arduino IoT Cloud, which is available at <a href="https://cloud.arduino.cc/home/">https://cloud.arduino.cc/home/</a>.</p>
<p>Click on <strong class="bold">API Keys</strong>. After that, you will be taken to the API page; click on <strong class="bold">CREATE API KEY</strong>. A popup will appear; type the name for API and click on the <strong class="bold">CONTINUE</strong> button. The following wizard will take some seconds to generate the keys, and then a new popup will appear displaying them:</p>
<div><div><img alt="" role="presentation" src="img/B19752_02_22.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"> </p>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.22 – The API keys</p>
<p>Copy the client ID and<a id="_idIndexMarker193"/> client secret by clicking on the copy icons; never try to copy the secret name by selecting it, as it is too long. Save both the client ID and client secret to secure the location, and after that, click on the checkbox beside <strong class="bold">I saved my Client ID and Secret</strong> to confirm that you have saved your keys. Finally, click on the <strong class="bold">DONE</strong> button, and you will see your API key in the panel, ready for use.</p>
<p class="callout-heading">Important note</p>
<p class="callout">One API key has access to all the Things and their variables. So, it’s good to use one API key to gain access to all Things instead of creating separate API keys for each one. On the other hand, take care of your keys, as losing them can be a big security risk.</p>
<p>After API key generation, we need to set up an<a id="_idIndexMarker194"/> extra variable that will receive the value from Node-RED, and a <strong class="bold">Status</strong> widget that will act according to the variable value.</p>
<p>For variable creation, go back to the IoT Cloud dashboard shown in <em class="italic">Figure 2</em><em class="italic">.12</em>, select the desired Thing, create a new variable named <code>LEDStatus</code>, and choose the Boolean type that we previously created for the LED. Then, navigate back to the dashboard and select the dashboard that we developed for the previous exercise. Click on the <code>LEDStatus</code> variable with the <strong class="bold">Status</strong> widget.</p>
<p>Here we have created the API keys in the Arduino IoT Cloud for Node-RED, as well as a new Thing with cloud variables and a dashboard. Next, we are going to configure the API keys in Node-RED for proper communication with the Arduino IoT Cloud.</p>
<h2 id="_idParaDest-53"><a id="_idTextAnchor053"/>Creating a first project with Node-RED</h2>
<p>We have <a id="_idIndexMarker195"/>done all the mandatory stuff that is required in our journey so far. Return to the Node-RED dashboard shown in <em class="italic">Figure 2</em><em class="italic">.19</em>, scroll down the left side, and move your node to the Arduino IoT Cloud.</p>
<p>Click on the first node, which is <em class="italic">IN</em>, and drag it to the flow area. Double-click on the node, and you will see the following popup for node configuration:</p>
<div><div><img alt="Figure 2.23 – Arduino IN node configuration" src="img/B19752_02_23.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.23 – Arduino IN node configuration</p>
<p>To edit the property node, follow these steps:</p>
<ol>
<li>Select the Arduino connection from the dropdown (the dropdown is only there if you have multiple Arduino IoT Cloud connections).</li>
<li>If you don’t have a <a id="_idIndexMarker196"/>connection, click on the pencil icon, and it will take you to a new popup where you will need to provide the name of the connection, along with the client ID and client secret that were generated in the previous section in <em class="italic">Figure 2</em><em class="italic">.22</em>. When you save the connection, it will appear under the <strong class="bold">Connection</strong> dropdown.</li>
<li>After successfully creating and selecting a connection, a list of Things that are associated with that connection will appear. From the <strong class="bold">Thing</strong> dropdown, select the target Thing that you will use in your flow. If you do not see anything in the dropdown, it means there is an issue with the connection.</li>
<li>After the selection of Thing, the <strong class="bold">Property</strong> dropdown will list all the variables that are associated with the selected Thing. Select one variable that you want to sense; in our exercise, I chose the <strong class="bold">LED</strong> variable to get its status.</li>
<li>Assign a name to the node, click on the <strong class="bold">Done</strong> button, and then you are done with the configuration.</li>
</ol>
<p>The following is a complete flow of nodes. It shows the entire workflow, from getting variable values to the final node, which sends a value to the cloud based on input:</p>
<div><div><img alt="Figure 2.24 – A complete flow of the Node-RED project" src="img/B19752_02_24.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.24 – A complete flow of the Node-RED project</p>
<p>The node workflow is<a id="_idIndexMarker197"/> broken down as follows:</p>
<ol>
<li>The first node is the <em class="italic">IN</em> node. Select the variable that you want to read; I selected the <strong class="bold">LED</strong> variable.</li>
<li>Add the <em class="italic">switch</em> node (node <code>Functions</code><em class="italic"> </em>tab on the left sidebar of the page. This node is responsible for taking the value from node <strong class="bold">1</strong> and selecting the specific node from <strong class="bold">3</strong> or <strong class="bold">4</strong>, according to the value. Link the Arduino <em class="italic">IN</em> node to the <em class="italic">switch</em> node. After linking, double-click on the <em class="italic">switch</em> node, where we need to specify the switch cases.</li>
</ol>
<div><div><img alt="Figure 2.25 – Switch node options" src="img/B19752_02_25.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.25 – Switch node options</p>
<p>To edit the <em class="italic">switch</em> node, follow<a id="_idIndexMarker198"/> these steps:</p>
<ol>
<li>Firstly, assign a name to the node and then add the switch cases.</li>
<li>In our current exercise, we have two switch statements: the LED is either <em class="italic">true</em> or <em class="italic">false</em>, which means on or off. By default, there is only one option – click on the small <code>1</code> and <code>0</code>, and we will then have two flows.</li>
</ol>
<p>The <em class="italic">change</em> nodes (<code>True</code>/<code>1</code>/<code>On</code> value. Double-click on this node. Now, click on the drop-down icon, which is marked by a red box in the following figure, select the <strong class="bold">Boolean</strong> type, and then select <strong class="bold">true</strong>.</p>
<div><div><img alt="Figure 2.26 – Changing the node configuration" src="img/B19752_02_26.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 2.26 – Changing the node configuration</p>
<p>To edit the change <a id="_idIndexMarker199"/>node, follow these steps:</p>
<ol>
<li>Again, insert the <em class="italic">change</em> node and link it with the <em class="italic">switch</em> node (node <code>False</code>/<code>0</code>/<code>Off</code> value. Double-click the <em class="italic">change</em> node, select the Boolean data type, and select the <strong class="bold">false</strong> value.</li>
<li>Everything is ready now. We just need to add a node that will send data to a specific Arduino IoT Cloud Thing variable. To send the data, we need the Arduino <em class="italic">OUT</em> node, which is the second node under the Arduino IoT Cloud tab shown in <em class="italic">Figure 2</em><em class="italic">.21</em>. Drag this node, and connect both <em class="italic">change</em> nodes (<code>LEDStatus</code> variable.</li>
</ol>
<p>Finally, we are done with all the node configurations and linkage. Click on the <code>LEDStatus</code> Arduino IoT Cloud variable according to the Node-RED <strong class="bold">LED</strong> variable, and the status widget will be <a id="_idIndexMarker200"/>changed accordingly.</p>
<p>In the second part of the chapter, we have explored how to connect non-compatible IoT development boards with the Arduino IoT Cloud using Node-RED. Next up is <em class="italic">Assignment 2</em>, which is specially designed for you to practice with different experiments.</p>
<h2 id="_idParaDest-54"><a id="_idTextAnchor054"/>Assignment 2</h2>
<p>Continue the previous assignment, where you connected three LEDs to MKR Wi-Fi 1010 and the Arduino IoT Cloud setup:</p>
<ol>
<li>Create three status variables in the Thing, according to the LED name such as Red, Yellow and Green, to the previously-set-up Thing.</li>
<li>Add three status widgets to the previously-set-up dashboard and attach newly created status variables to them.</li>
<li>Set up three different flows for each LED and deploy the flows.</li>
<li>Verify the status widgets by turning the LEDs on/off with the <strong class="bold">Switch</strong> button widget.</li>
</ol>
<h1 id="_idParaDest-55"><a id="_idTextAnchor055"/>Summary</h1>
<p>This chapter is the first chapter where we explored how to connect devices with the Arduino IoT Cloud using a basic LED on/off example. In the first part, we used an Arduino IoT Cloud-compatible development board, which was the MKR Wi-Fi 1010 board, where we learned how to create Things and cloud variables, how to associate devices, how to configure networks, and how to create sketches. At the end of that section, there was an assignment for you to practice on.</p>
<p>In the second part of this chapter, we explored how to connect non-compatible development boards, such as Arduino UNO, Arduino Mega, and Raspberry Pi, with the Arduino IoT Cloud, using Node-RED and the Arduino API interface. Here we have explored Node-RED, the Node-RED module for the Arduino IoT Cloud, and generating API keys in the cloud. This part of the chapter helped teach you how to use non-compatible existing technologies with the Arduino IoT Cloud.</p>
<p>Arduino has a lot of options in the Arduino IoT Cloud, such as Things, devices, dashboards, and a lot of widgets for dashboards and the Arduino Web Editor. So, in the next chapter, we will explore all those options in detail before moving on. <a href="B19752_03.xhtml#_idTextAnchor056"><em class="italic">Chapter 3</em></a> is very important for you to better understand all of the Arduino IoT Cloud options.</p>
</div>
</body></html>