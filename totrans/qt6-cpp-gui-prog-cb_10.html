<html><head></head><body>
<div id="_idContainer168">
<h1 class="chapter-number" id="_idParaDest-207"><a id="_idTextAnchor207"/><span class="koboSpan" id="kobo.1.1">10</span></h1>
<h1 id="_idParaDest-208"><a id="_idTextAnchor208"/><span class="koboSpan" id="kobo.2.1">JSON Parsing Made Easy</span></h1>
<p><span class="koboSpan" id="kobo.3.1">JSON is the file </span><a id="_idIndexMarker671"/><span class="koboSpan" id="kobo.4.1">extension of a data format called </span><strong class="bold"><span class="koboSpan" id="kobo.5.1">JavaScript Object Notation</span></strong><span class="koboSpan" id="kobo.6.1">, which is used to store and transport information in a structured format. </span><span class="koboSpan" id="kobo.6.2">The </span><a id="_idIndexMarker672"/><span class="koboSpan" id="kobo.7.1">JSON format is used extensively for the web. </span><span class="koboSpan" id="kobo.7.2">Most modern web </span><strong class="bold"><span class="koboSpan" id="kobo.8.1">Application Programming Interfaces</span></strong><span class="koboSpan" id="kobo.9.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.10.1">APIs</span></strong><span class="koboSpan" id="kobo.11.1">) use JSON format to transfer data to their </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">web clients.</span></span></p>
<p><span class="koboSpan" id="kobo.13.1">This chapter will cover the </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">following recipes:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.15.1">JSON format in </span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">a nutshell</span></span></li>
<li><span class="koboSpan" id="kobo.17.1">Processing JSON data from a </span><span class="No-Break"><span class="koboSpan" id="kobo.18.1">text file</span></span></li>
<li><span class="koboSpan" id="kobo.19.1">Writing JSON data to a </span><span class="No-Break"><span class="koboSpan" id="kobo.20.1">text file</span></span></li>
<li><span class="koboSpan" id="kobo.21.1">Using Google’s </span><span class="No-Break"><span class="koboSpan" id="kobo.22.1">Geocoding API</span></span></li>
</ul>
<h1 id="_idParaDest-209"><a id="_idTextAnchor209"/><span class="koboSpan" id="kobo.23.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.24.1">The technical requirements for this chapter include Qt 6.6.1 MinGW 64-bit and Qt Creator 12.0.2. </span><span class="koboSpan" id="kobo.24.2">All the code used in this chapter can be downloaded from the following GitHub </span><span class="No-Break"><span class="koboSpan" id="kobo.25.1">repository: </span></span><a href="https://github.com/PacktPublishing/QT6-C-GUI-Programming-Cookbook---Third-Edition-/tree/main/Chapter10"><span class="No-Break"><span class="koboSpan" id="kobo.26.1">https://github.com/PacktPublishing/QT6-C-GUI-Programming-Cookbook---Third-Edition-/tree/main/Chapter10</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.27.1">.</span></span></p>
<h1 id="_idParaDest-210"><a id="_idTextAnchor210"/><span class="koboSpan" id="kobo.28.1">JSON format in a nutshell</span></h1>
<p><span class="koboSpan" id="kobo.29.1">JSON is a </span><a id="_idIndexMarker673"/><span class="koboSpan" id="kobo.30.1">human-readable text format commonly used for data transmission in web </span><a id="_idIndexMarker674"/><span class="koboSpan" id="kobo.31.1">applications, especially </span><strong class="bold"><span class="koboSpan" id="kobo.32.1">JavaScript</span></strong><span class="koboSpan" id="kobo.33.1"> applications. </span><span class="koboSpan" id="kobo.33.2">However, it is also used for many other purposes, hence it is independent of JavaScript and can be used for any programming language or platform, despite </span><span class="No-Break"><span class="koboSpan" id="kobo.34.1">its name.</span></span></p>
<p><span class="koboSpan" id="kobo.35.1">In this example, we will learn about JSON format and how to verify whether your JSON data is in a valid format </span><span class="No-Break"><span class="koboSpan" id="kobo.36.1">or not.</span></span></p>
<h2 id="_idParaDest-211"><a id="_idTextAnchor211"/><span class="koboSpan" id="kobo.37.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.38.1">Let’s get </span><a id="_idIndexMarker675"/><span class="koboSpan" id="kobo.39.1">started and learn how to write your own JSON data and verify </span><span class="No-Break"><span class="koboSpan" id="kobo.40.1">its format:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.41.1">Open up your web browser and go to the </span><strong class="bold"><span class="koboSpan" id="kobo.42.1">JSONLint Online Validator and Formatter</span></strong><span class="koboSpan" id="kobo.43.1"> website </span><span class="No-Break"><span class="koboSpan" id="kobo.44.1">at </span></span><a href="https://jsonlint.com"><span class="No-Break"><span class="koboSpan" id="kobo.45.1">https://jsonlint.com</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.46.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.47.1">Write the following JSON data in the text editor on </span><span class="No-Break"><span class="koboSpan" id="kobo.48.1">the website:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.49.1">
{
    "members": [
        {
            "name": "John",
            "age": 29,
            "gender": "male"
        },
        {
            "name": "Alice",
            "age": 24,
            "gender": "female"
        },
        {
            "name": "",
            "age": 26,
            "gender": "male"
        }
    ]
}</span></pre></li> <li><span class="koboSpan" id="kobo.50.1">After that, press the </span><strong class="bold"><span class="koboSpan" id="kobo.51.1">Validate JSON</span></strong><span class="koboSpan" id="kobo.52.1"> button. </span><span class="koboSpan" id="kobo.52.2">You should get the </span><span class="No-Break"><span class="koboSpan" id="kobo.53.1">following result:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.54.1">
JSON is valid!</span></pre></li> <li><span class="koboSpan" id="kobo.55.1">Now, try to </span><a id="_idIndexMarker676"/><span class="koboSpan" id="kobo.56.1">remove the double quote symbols from the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.57.1">members</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.58.1"> variable:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.59.1">
{
    </span><strong class="bold"><span class="koboSpan" id="kobo.60.1">members</span></strong><span class="koboSpan" id="kobo.61.1">: [
        {
            "name": "John",
            "age": 29,
            "gender": "male"
        },</span></pre></li> <li><span class="koboSpan" id="kobo.62.1">Press the </span><strong class="bold"><span class="koboSpan" id="kobo.63.1">Validate JSON</span></strong><span class="koboSpan" id="kobo.64.1"> button again and you should get an error </span><span class="No-Break"><span class="koboSpan" id="kobo.65.1">like this:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.66.1">
Invalid JSON!
</span><span class="koboSpan" id="kobo.66.2">Error: Parse error on line 1:
{    members: [        {
-----^
Expecting 'STRING', '}', got 'undefined'</span></pre></li> <li><span class="koboSpan" id="kobo.67.1">Now, revert to the valid JSON format by adding the double quote symbols back to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.68.1">members</span></strong><span class="koboSpan" id="kobo.69.1"> variable. </span><span class="koboSpan" id="kobo.69.2">Then, press the </span><strong class="bold"><span class="koboSpan" id="kobo.70.1">Compress</span></strong><span class="koboSpan" id="kobo.71.1"> button. </span><span class="koboSpan" id="kobo.71.2">You should get the following result, which has no empty space and </span><span class="No-Break"><span class="koboSpan" id="kobo.72.1">next lines:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.73.1">
{"members":[{"name":"John","age":29,"gender":"male"},
{"name":"Alice","age":24,"gender":"female"},
{"name":"","age":26,"gender":"male"}]}</span></pre></li> <li><span class="koboSpan" id="kobo.74.1">You can now press the </span><strong class="bold"><span class="koboSpan" id="kobo.75.1">Prettify</span></strong><span class="koboSpan" id="kobo.76.1"> button to revert it to the </span><span class="No-Break"><span class="koboSpan" id="kobo.77.1">previous structure.</span></span></li>
</ol>
<h2 id="_idParaDest-212"><a id="_idTextAnchor212"/><span class="koboSpan" id="kobo.78.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.79.1">The curly braces, </span><strong class="source-inline"><span class="koboSpan" id="kobo.80.1">{</span></strong><span class="koboSpan" id="kobo.81.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.82.1">}</span></strong><span class="koboSpan" id="kobo.83.1">, contain </span><a id="_idIndexMarker677"/><span class="koboSpan" id="kobo.84.1">a set of data as an object. </span><span class="koboSpan" id="kobo.84.2">An </span><strong class="bold"><span class="koboSpan" id="kobo.85.1">object</span></strong><span class="koboSpan" id="kobo.86.1"> is an individual data structure </span><a id="_idIndexMarker678"/><span class="koboSpan" id="kobo.87.1">that contains its own properties or variables </span><a id="_idIndexMarker679"/><span class="koboSpan" id="kobo.88.1">in the form of </span><strong class="bold"><span class="koboSpan" id="kobo.89.1">key-value pairs</span></strong><span class="koboSpan" id="kobo.90.1">. </span><span class="koboSpan" id="kobo.90.2">Keys are unique strings that act as human-readable variable names, and values are represented by either a string, integer, floating-point number, Boolean, or even an entire object or array. </span><span class="koboSpan" id="kobo.90.3">JSON supports recursive objects, which is very handy for many different </span><span class="No-Break"><span class="koboSpan" id="kobo.91.1">use cases.</span></span></p>
<p><span class="koboSpan" id="kobo.92.1">The square </span><a id="_idIndexMarker680"/><span class="koboSpan" id="kobo.93.1">brackets, </span><strong class="source-inline"><span class="koboSpan" id="kobo.94.1">[</span></strong><span class="koboSpan" id="kobo.95.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.96.1">]</span></strong><span class="koboSpan" id="kobo.97.1">, indicate that the data is contained in an array. </span><span class="koboSpan" id="kobo.97.2">An </span><strong class="bold"><span class="koboSpan" id="kobo.98.1">array</span></strong><span class="koboSpan" id="kobo.99.1"> simply stores a list of values of the same type, which can be manipulated, sorted, or removed from the array by iterating over its content using a standard iterator pattern in any programming language you use for </span><span class="No-Break"><span class="koboSpan" id="kobo.100.1">your project.</span></span></p>
<p><span class="koboSpan" id="kobo.101.1">In the previous example, we first created a nameless object as the main object of the data. </span><span class="koboSpan" id="kobo.101.2">You must create either a main object or a main array as a starting point. </span><span class="koboSpan" id="kobo.101.3">Then, we added an array called </span><strong class="source-inline"><span class="koboSpan" id="kobo.102.1">members</span></strong><span class="koboSpan" id="kobo.103.1">, which contains individual objects with variables such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.104.1">name</span></strong><span class="koboSpan" id="kobo.105.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.106.1">age</span></strong><span class="koboSpan" id="kobo.107.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.108.1">gender</span></strong><span class="koboSpan" id="kobo.109.1">. </span><span class="koboSpan" id="kobo.109.2">Do note that if you add double quotes (</span><strong class="source-inline"><span class="koboSpan" id="kobo.110.1">"</span></strong><span class="koboSpan" id="kobo.111.1">) around an integer or floating-point number, the variable will be treated as a string instead of </span><span class="No-Break"><span class="koboSpan" id="kobo.112.1">a number.</span></span></p>
<p><span class="koboSpan" id="kobo.113.1">The previous example demonstrated the simplest form of JSON data that can be sent through the network and processed by any modern </span><span class="No-Break"><span class="koboSpan" id="kobo.114.1">programming language.</span></span></p>
<h1 id="_idParaDest-213"><a id="_idTextAnchor213"/><span class="koboSpan" id="kobo.115.1">Processing JSON data from a text file</span></h1>
<p><span class="koboSpan" id="kobo.116.1">In this </span><a id="_idIndexMarker681"/><span class="koboSpan" id="kobo.117.1">recipe, we will learn how to process JSON </span><a id="_idIndexMarker682"/><span class="koboSpan" id="kobo.118.1">data taken from a text file and extract it using the </span><span class="No-Break"><span class="koboSpan" id="kobo.119.1">stream reader.</span></span></p>
<h2 id="_idParaDest-214"><a id="_idTextAnchor214"/><span class="koboSpan" id="kobo.120.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.121.1">Let’s create a simple program that reads and processes XML files by following </span><span class="No-Break"><span class="koboSpan" id="kobo.122.1">these steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.123.1">Create a new </span><strong class="bold"><span class="koboSpan" id="kobo.124.1">Qt Widgets Application</span></strong><span class="koboSpan" id="kobo.125.1"> project at your </span><span class="No-Break"><span class="koboSpan" id="kobo.126.1">desired location.</span></span></li>
<li><span class="koboSpan" id="kobo.127.1">Open any </span><a id="_idIndexMarker683"/><span class="koboSpan" id="kobo.128.1">text editor and create a JSON </span><a id="_idIndexMarker684"/><span class="koboSpan" id="kobo.129.1">file that looks like the following, then save it </span><span class="No-Break"><span class="koboSpan" id="kobo.130.1">as </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.131.1">scene.json</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.132.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.133.1">
[
    {
        "name": "Library",
        "tag": "building",
        "position": [120.0, 0.0, 50.68],
        "rotation": [0.0, 0.0, 0.0],
        "scale": [1.0, 1.0, 1.0]
    }
]</span></pre></li> <li><span class="koboSpan" id="kobo.134.1">Continue to write the JSON code by adding more objects after the </span><strong class="source-inline"><span class="koboSpan" id="kobo.135.1">Library</span></strong><span class="koboSpan" id="kobo.136.1"> object, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.137.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.138.1">
{
    "name": "Town Hall",
    "tag": "building",
    "position": [80.2, 0.0, 20.5],
    "rotation": [0.0, 0.0, 0.0],
    "scale": [1.0, 1.0, 1.0]
},
{
    "name": "Tree",
    "tag": "prop",
    "position": [10.46, -0.2, 80.2],
    "rotation": [0.0, 0.0, 0.0],
    "scale": [1.0, 1.0, 1.0]
}</span></pre></li> <li><span class="koboSpan" id="kobo.139.1">Go </span><a id="_idIndexMarker685"/><span class="koboSpan" id="kobo.140.1">back to Qt Creator and open </span><strong class="source-inline"><span class="koboSpan" id="kobo.141.1">mainwindow.h</span></strong><span class="koboSpan" id="kobo.142.1">. </span><span class="koboSpan" id="kobo.142.2">Add the following headers at the top </span><a id="_idIndexMarker686"/><span class="koboSpan" id="kobo.143.1">of the script, right after </span><strong class="source-inline"><span class="koboSpan" id="kobo.144.1">#</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.145.1">include &lt;QMainWindow&gt;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.146.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.147.1">
#include &lt;QJsonDocument&gt;
#include &lt;QJsonArray&gt;
#include &lt;QJsonObject&gt;
#include &lt;QDebug&gt;
#include &lt;QFile&gt;
#include &lt;QFileDialog&gt;</span></pre></li> <li><span class="koboSpan" id="kobo.148.1">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.149.1">mainwindow.ui</span></strong><span class="koboSpan" id="kobo.150.1"> and drag a push button from the widget box on the left side to the UI editor. </span><span class="koboSpan" id="kobo.150.2">Change the object name of the button to </span><strong class="source-inline"><span class="koboSpan" id="kobo.151.1">loadJsonButton</span></strong><span class="koboSpan" id="kobo.152.1"> and its display text to </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.153.1">Load JSON</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.154.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer160">
<span class="koboSpan" id="kobo.155.1"><img alt="Figure 10.1 – Adding the Load JSON push button" src="image/B20976_10_001.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.156.1">Figure 10.1 – Adding the Load JSON push button</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.157.1">Right-click on the button and select </span><strong class="bold"><span class="koboSpan" id="kobo.158.1">Go to slot…</span></strong><span class="koboSpan" id="kobo.159.1">. </span><span class="koboSpan" id="kobo.159.2">A window will pop up with a list of signals available </span><span class="No-Break"><span class="koboSpan" id="kobo.160.1">for selection.</span></span></li>
<li><span class="koboSpan" id="kobo.161.1">Choose </span><a id="_idIndexMarker687"/><span class="koboSpan" id="kobo.162.1">the default </span><strong class="source-inline"><span class="koboSpan" id="kobo.163.1">clicked()</span></strong><span class="koboSpan" id="kobo.164.1"> option </span><a id="_idIndexMarker688"/><span class="koboSpan" id="kobo.165.1">and press the </span><strong class="bold"><span class="koboSpan" id="kobo.166.1">OK</span></strong><span class="koboSpan" id="kobo.167.1"> button. </span><span class="koboSpan" id="kobo.167.2">Qt will now insert a slot function in your header and source files </span><span class="No-Break"><span class="koboSpan" id="kobo.168.1">called </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.169.1">on_loadJsonButton_clicked()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.170.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.171.1">Add the following code to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.172.1">on_loadJsonButton_clicked()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.173.1"> function:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.174.1">
void MainWindow::on_loadJsonButton_clicked()
{
    QString filename = QFileDialog::getOpenFileName(this, "Open JSON", ".", "JSON files (*.json)");
    QFile file(filename);
    if (!file.open(QFile::ReadOnly | QFile::Text))
        qDebug() &lt;&lt; "Error loading JSON file.";
    QByteArray data = file.readAll();
    file.close();
    QJsonDocument json = QJsonDocument::fromJson(data);</span></pre></li> <li><span class="koboSpan" id="kobo.175.1">We continue to write the code. </span><span class="koboSpan" id="kobo.175.2">The following code loops through the JSON file and prints out each attribute’s name </span><span class="No-Break"><span class="koboSpan" id="kobo.176.1">and value:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.177.1">
if (json.isArray())
{
    QJsonArray array = json.array();
    if (array.size() &gt; 0)
    {
        for (int i = 0; i &lt; array.size(); ++i)
        {
            qDebug() &lt;&lt; "[Object]=================================";
            QJsonObject object = json[i].toObject();
            QStringList keys = object.keys();
            for (int j = 0; j &lt; keys.size(); ++j)
            {
                qDebug() &lt;&lt; keys.at(j) &lt;&lt; object.value(keys.at(j));
            }
            qDebug() &lt;&lt; "=========================================";
        }
    }
}</span></pre></li> <li><span class="koboSpan" id="kobo.178.1">Build </span><a id="_idIndexMarker689"/><span class="koboSpan" id="kobo.179.1">and run the project and you will see </span><a id="_idIndexMarker690"/><span class="koboSpan" id="kobo.180.1">a window pop up that looks like the one you made in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.181.1">step 5</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.182.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer161">
<span class="koboSpan" id="kobo.183.1"><img alt="Figure 10.2 – Building and launching the program" src="image/B20976_10_002.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.184.1">Figure 10.2 – Building and launching the program</span></p>
<ol>
<li value="11"><span class="koboSpan" id="kobo.185.1">Click on the </span><strong class="bold"><span class="koboSpan" id="kobo.186.1">Load JSON</span></strong><span class="koboSpan" id="kobo.187.1"> button and you should see the </span><em class="italic"><span class="koboSpan" id="kobo.188.1">file selector</span></em><span class="koboSpan" id="kobo.189.1"> window pop up on the screen. </span><span class="koboSpan" id="kobo.189.2">Select the JSON file you created in </span><em class="italic"><span class="koboSpan" id="kobo.190.1">step 2</span></em><span class="koboSpan" id="kobo.191.1"> and press the </span><strong class="bold"><span class="koboSpan" id="kobo.192.1">Select</span></strong><span class="koboSpan" id="kobo.193.1"> button. </span><span class="koboSpan" id="kobo.193.2">You </span><a id="_idIndexMarker691"/><span class="koboSpan" id="kobo.194.1">should see the following </span><a id="_idIndexMarker692"/><span class="koboSpan" id="kobo.195.1">debug text appear in the </span><em class="italic"><span class="koboSpan" id="kobo.196.1">Application Output</span></em><span class="koboSpan" id="kobo.197.1"> window in Qt Creator, which indicates that the program has successfully loaded the data from the JSON file you </span><span class="No-Break"><span class="koboSpan" id="kobo.198.1">just selected:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer162">
<span class="koboSpan" id="kobo.199.1"><img alt="Figure 10.3 – The results printed in the Application Output window" src="image/B20976_10_003.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.200.1">Figure 10.3 – The results printed in the Application Output window</span></p>
<h2 id="_idParaDest-215"><a id="_idTextAnchor215"/><span class="koboSpan" id="kobo.201.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.202.1">In this example, we’re trying to extract and process data from a JSON file using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.203.1">QJsonDocument</span></strong><span class="koboSpan" id="kobo.204.1"> class. </span><span class="koboSpan" id="kobo.204.2">Imagine you’re making a computer game and you’re using JSON files to </span><a id="_idIndexMarker693"/><span class="koboSpan" id="kobo.205.1">store the attributes of all the objects in your game scene. </span><span class="koboSpan" id="kobo.205.2">In this case, the JSON format plays an important role in storing the data in a structured way, which allows for </span><span class="No-Break"><span class="koboSpan" id="kobo.206.1">easy extraction.</span></span></p>
<p><span class="koboSpan" id="kobo.207.1">We need to add the header of the class related to JSON to our source file, which, in this case, is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.208.1">QJsonDocument</span></strong><span class="koboSpan" id="kobo.209.1"> class. </span><span class="koboSpan" id="kobo.209.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.210.1">QJsonDocument</span></strong><span class="koboSpan" id="kobo.211.1"> class is built into Qt’s core library, so there is no need to include any additional modules with it, which also means that it’s the recommended class to use to process JSON data in Qt. </span><span class="koboSpan" id="kobo.211.2">Once we click on the </span><strong class="bold"><span class="koboSpan" id="kobo.212.1">Load JSON</span></strong><span class="koboSpan" id="kobo.213.1"> button, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.214.1">on_loadJsonButton_clicked()</span></strong><span class="koboSpan" id="kobo.215.1"> slot will be called; this is where we write the code to process the </span><span class="No-Break"><span class="koboSpan" id="kobo.216.1">JSON data.</span></span></p>
<p><span class="koboSpan" id="kobo.217.1">We use a file dialog to select the JSON file we want to process. </span><span class="koboSpan" id="kobo.217.2">Then, we send the selected file’s filename, together with its path, to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.218.1">QFile</span></strong><span class="koboSpan" id="kobo.219.1"> class to open and read the text data of the JSON file. </span><span class="koboSpan" id="kobo.219.2">After that, the file’s data is sent to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.220.1">QJsonDocument</span></strong><span class="koboSpan" id="kobo.221.1"> class </span><span class="No-Break"><span class="koboSpan" id="kobo.222.1">for processing.</span></span></p>
<p><span class="koboSpan" id="kobo.223.1">We first </span><a id="_idIndexMarker694"/><span class="koboSpan" id="kobo.224.1">check whether the main JSON structure </span><a id="_idIndexMarker695"/><span class="koboSpan" id="kobo.225.1">is an array. </span><span class="koboSpan" id="kobo.225.2">If it is an array, we then check whether the array has any data in it. </span><span class="koboSpan" id="kobo.225.3">After that, use a </span><strong class="source-inline"><span class="koboSpan" id="kobo.226.1">for</span></strong><span class="koboSpan" id="kobo.227.1"> loop to read through the entire array and extract the individual objects stored in </span><span class="No-Break"><span class="koboSpan" id="kobo.228.1">the array.</span></span></p>
<p><span class="koboSpan" id="kobo.229.1">Then, we extract the key-pair data from the objects and print out both the key </span><span class="No-Break"><span class="koboSpan" id="kobo.230.1">and value.</span></span></p>
<h2 id="_idParaDest-216"><a id="_idTextAnchor216"/><span class="koboSpan" id="kobo.231.1">There’s more…</span></h2>
<p><span class="koboSpan" id="kobo.232.1">Besides the web applications, many commercial game engines and interactive applications use the JSON format to store information for in-game scenes, meshes, and other forms of assets used in their products. </span><span class="koboSpan" id="kobo.232.2">This is because the JSON format provides many benefits over other file formats, such as compact file size, high flexibility and extendibility, easy file recovery, and a relational tree structure that allows it to be used for highly efficient and performance-critical applications, such as search engines, intelligent data mining servers, and </span><span class="No-Break"><span class="koboSpan" id="kobo.233.1">scientific simulations.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.234.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.235.1">To learn </span><a id="_idIndexMarker696"/><span class="koboSpan" id="kobo.236.1">more about the XML format, </span><span class="No-Break"><span class="koboSpan" id="kobo.237.1">visit </span></span><a href="https://www.w3schools.com/js/js_json_intro.asp"><span class="No-Break"><span class="koboSpan" id="kobo.238.1">https://www.w3schools.com/js/js_json_intro.asp</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.239.1">.</span></span></p>
<h1 id="_idParaDest-217"><a id="_idTextAnchor217"/><span class="koboSpan" id="kobo.240.1">Writing JSON data to a text file</span></h1>
<p><span class="koboSpan" id="kobo.241.1">Since we </span><a id="_idIndexMarker697"/><span class="koboSpan" id="kobo.242.1">have learned how to process data obtained </span><a id="_idIndexMarker698"/><span class="koboSpan" id="kobo.243.1">from a JSON file in the previous recipe, we will move on to learning how to save data to a JSON file. </span><span class="koboSpan" id="kobo.243.2">We will continue with the previous example and add </span><span class="No-Break"><span class="koboSpan" id="kobo.244.1">to it.</span></span></p>
<h2 id="_idParaDest-218"><a id="_idTextAnchor218"/><span class="koboSpan" id="kobo.245.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.246.1">We will learn how to save data in a JSON file through the </span><span class="No-Break"><span class="koboSpan" id="kobo.247.1">following steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.248.1">Add another button to </span><strong class="source-inline"><span class="koboSpan" id="kobo.249.1">mainwindow.ui</span></strong><span class="koboSpan" id="kobo.250.1">, then set its object name as </span><strong class="source-inline"><span class="koboSpan" id="kobo.251.1">saveJsonButton</span></strong><span class="koboSpan" id="kobo.252.1"> and its label as </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.253.1">Save JSON</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.254.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer163">
<span class="koboSpan" id="kobo.255.1"><img alt="Figure 10.4 – Adding the Save JSON button" src="image/B20976_10_004.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.256.1">Figure 10.4 – Adding the Save JSON button</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.257.1">Right-click </span><a id="_idIndexMarker699"/><span class="koboSpan" id="kobo.258.1">on the button and select </span><strong class="bold"><span class="koboSpan" id="kobo.259.1">Go to slot…</span></strong><span class="koboSpan" id="kobo.260.1">. </span><span class="koboSpan" id="kobo.260.2">A window </span><a id="_idIndexMarker700"/><span class="koboSpan" id="kobo.261.1">will pop up with a list of signals available for selection. </span><span class="koboSpan" id="kobo.261.2">Select the </span><strong class="source-inline"><span class="koboSpan" id="kobo.262.1">clicked()</span></strong><span class="koboSpan" id="kobo.263.1"> option and click </span><strong class="bold"><span class="koboSpan" id="kobo.264.1">OK</span></strong><span class="koboSpan" id="kobo.265.1">. </span><span class="koboSpan" id="kobo.265.2">A signal function called </span><strong class="source-inline"><span class="koboSpan" id="kobo.266.1">on_saveJsonButton_clicked()</span></strong><span class="koboSpan" id="kobo.267.1"> will now be automatically added to both your </span><strong class="source-inline"><span class="koboSpan" id="kobo.268.1">mainwindow.h</span></strong><span class="koboSpan" id="kobo.269.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.270.1">mainwindow.cpp</span></strong><span class="koboSpan" id="kobo.271.1"> files </span><span class="No-Break"><span class="koboSpan" id="kobo.272.1">by Qt:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer164">
<span class="koboSpan" id="kobo.273.1"><img alt="Figure 10.5 – Selecting the clicked() signal and pressing OK" src="image/B20976_10_005.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.274.1">Figure 10.5 – Selecting the clicked() signal and pressing OK</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.275.1">Add the following code to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.276.1">on_saveJsonButton_clicked()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.277.1"> function:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.278.1">
QQString filename = QFileDialog::getSaveFileName(this, "Save JSON", ".", "JSON files (*.json)");
QFile file(filename);
if (!file.open(QFile::WriteOnly | QFile::Text))
    qDebug() &lt;&lt; "Error saving JSON file.";
QJsonDocument json;
QJsonArray array;</span></pre></li> <li><span class="koboSpan" id="kobo.279.1">Let’s </span><a id="_idIndexMarker701"/><span class="koboSpan" id="kobo.280.1">also write the first </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.281.1">contact</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.282.1"> element:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.283.1">
QJsonObject contact1;
contact1["category"] = "Friend";
contact1["name"] = "John Doe";
contact1["age"] = 32;
contact1["address"] = "114B, 2nd Floor, Sterling Apartment, Morrison Town";
contact1["phone"] = "0221743566";
array.append(contact1);</span></pre></li> <li><span class="koboSpan" id="kobo.284.1">Write </span><a id="_idIndexMarker702"/><span class="koboSpan" id="kobo.285.1">the second </span><strong class="source-inline"><span class="koboSpan" id="kobo.286.1">contact</span></strong><span class="koboSpan" id="kobo.287.1"> element </span><span class="No-Break"><span class="koboSpan" id="kobo.288.1">as follows:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.289.1">
QJsonObject contact2;
contact2["category"] = "Family";
contact2["name"] = "Jane Smith";
contact2["age"] = 24;
contact2["address"] = "13, Ave Park, Alexandria";
contact2["phone"] = "0025728396";
array.append(contact2);</span></pre></li> <li><span class="koboSpan" id="kobo.290.1">Finally, save the data into the </span><span class="No-Break"><span class="koboSpan" id="kobo.291.1">text file:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.292.1">
json.setArray(array);
    file.write(json.toJson());
    file.close();
}</span></pre></li> <li><span class="koboSpan" id="kobo.293.1">Build and </span><a id="_idIndexMarker703"/><span class="koboSpan" id="kobo.294.1">run the program and you should see an </span><a id="_idIndexMarker704"/><span class="koboSpan" id="kobo.295.1">additional button on the </span><span class="No-Break"><span class="koboSpan" id="kobo.296.1">program UI:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer165">
<span class="koboSpan" id="kobo.297.1"><img alt="Figure 10.6 – Your application should now look like this" src="image/B20976_10_006.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.298.1">Figure 10.6 – Your application should now look like this</span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.299.1">Click on the </span><strong class="bold"><span class="koboSpan" id="kobo.300.1">Save JSON</span></strong><span class="koboSpan" id="kobo.301.1"> button and a save file dialog will appear on the screen. </span><span class="koboSpan" id="kobo.301.2">Type the filename you require and click the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.302.1">Save</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.303.1"> button.</span></span></li>
<li><span class="koboSpan" id="kobo.304.1">Open up the JSON file you just saved with any text editor. </span><span class="koboSpan" id="kobo.304.2">The first part of the file should look </span><span class="No-Break"><span class="koboSpan" id="kobo.305.1">like this:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.306.1">
[
    {
        "address": "114B, 2nd Floor, Sterling Apartment, Morrison Town",
        "age": 32,
        "category": "Friend",
        "name": "John Doe",
        "phone": "0221743566"
    },
    {
        "address": "13, Ave Park, Alexandria",
        "age": 24,
        "category": "Family",
        "name": "Jane Smith",
        "phone": "0025728396"
    }
]</span></pre></li> </ol>
<h2 id="_idParaDest-219"><a id="_idTextAnchor219"/><span class="koboSpan" id="kobo.307.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.308.1">The saving </span><a id="_idIndexMarker705"/><span class="koboSpan" id="kobo.309.1">process is similar to loading a JSON file in the </span><a id="_idIndexMarker706"/><span class="koboSpan" id="kobo.310.1">previous example. </span><span class="koboSpan" id="kobo.310.2">The only difference is instead of using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.311.1">QJsonDocument::fromJson()</span></strong><span class="koboSpan" id="kobo.312.1"> function, we switched to using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.313.1">QJsonDocument::toJson()</span></strong><span class="koboSpan" id="kobo.314.1"> function. </span><span class="koboSpan" id="kobo.314.2">We still used the file dialog and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.315.1">QFile</span></strong><span class="koboSpan" id="kobo.316.1"> class to save the XML file. </span><span class="koboSpan" id="kobo.316.2">This time, we had to change the open mode from </span><strong class="source-inline"><span class="koboSpan" id="kobo.317.1">QFile::ReadOnly</span></strong><span class="koboSpan" id="kobo.318.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.319.1">QFile::WriteOnly</span></strong><span class="koboSpan" id="kobo.320.1"> before passing the byte array data to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.321.1">QFile</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.322.1"> class.</span></span></p>
<p><span class="koboSpan" id="kobo.323.1">Next, we started writing the JSON file by creating </span><strong class="source-inline"><span class="koboSpan" id="kobo.324.1">QJsonDocument</span></strong><span class="koboSpan" id="kobo.325.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.326.1">QJsonArray</span></strong><span class="koboSpan" id="kobo.327.1"> variables followed by creating a </span><strong class="source-inline"><span class="koboSpan" id="kobo.328.1">QJsonObject</span></strong><span class="koboSpan" id="kobo.329.1"> object for each contact. </span><span class="koboSpan" id="kobo.329.2">Then, we filled in the information for each contact and appended it to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.330.1">QJsonArray</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.331.1"> array.</span></span></p>
<p><span class="koboSpan" id="kobo.332.1">Finally, we used </span><strong class="source-inline"><span class="koboSpan" id="kobo.333.1">QJsonDocument::setArray()</span></strong><span class="koboSpan" id="kobo.334.1"> to apply the </span><strong class="source-inline"><span class="koboSpan" id="kobo.335.1">QJsonArray</span></strong><span class="koboSpan" id="kobo.336.1"> array we created previously as the main array of the JSON data before passing it to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.337.1">QFile</span></strong><span class="koboSpan" id="kobo.338.1"> class as a byte array data using the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.339.1">QJsonDocument::toJson()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.340.1"> function.</span></span></p>
<h1 id="_idParaDest-220"><a id="_idTextAnchor220"/><span class="koboSpan" id="kobo.341.1">Using Google’s Geocoding API</span></h1>
<p><span class="koboSpan" id="kobo.342.1">In this </span><a id="_idIndexMarker707"/><span class="koboSpan" id="kobo.343.1">example, we will learn how to obtain the full address of a specific location by using Google’s </span><span class="No-Break"><span class="koboSpan" id="kobo.344.1">Geocoding API.</span></span></p>
<h2 id="_idParaDest-221"><a id="_idTextAnchor221"/><span class="koboSpan" id="kobo.345.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.346.1">Let’s create a program that utilizes the Geocoding API by following </span><span class="No-Break"><span class="koboSpan" id="kobo.347.1">these steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.348.1">Create a new </span><strong class="bold"><span class="koboSpan" id="kobo.349.1">Qt Widgets </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.350.1">Application</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.351.1"> project.</span></span></li>
<li><span class="koboSpan" id="kobo.352.1">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.353.1">mainwindow.ui</span></strong><span class="koboSpan" id="kobo.354.1"> and add a couple of text labels, input fields, and a button to make your UI look similar </span><span class="No-Break"><span class="koboSpan" id="kobo.355.1">to this:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer166">
<span class="koboSpan" id="kobo.356.1"><img alt="Figure 10.7 – Setting up your UI" src="image/B20976_10_007.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.357.1">Figure 10.7 – Setting up your UI</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.358.1">Open your project (</span><strong class="source-inline"><span class="koboSpan" id="kobo.359.1">.pro</span></strong><span class="koboSpan" id="kobo.360.1">) file and add the network module to your project. </span><span class="koboSpan" id="kobo.360.2">You can do that by simply adding the word </span><strong class="source-inline"><span class="koboSpan" id="kobo.361.1">network</span></strong><span class="koboSpan" id="kobo.362.1"> after </span><strong class="source-inline"><span class="koboSpan" id="kobo.363.1">core</span></strong><span class="koboSpan" id="kobo.364.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.365.1">gui</span></strong><span class="koboSpan" id="kobo.366.1">, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.367.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.368.1">
QT += core gui </span><strong class="bold"><span class="koboSpan" id="kobo.369.1">network</span></strong></pre></li> <li><span class="koboSpan" id="kobo.370.1">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.371.1">mainwindow.h</span></strong><span class="koboSpan" id="kobo.372.1"> and add the following headers to the </span><span class="No-Break"><span class="koboSpan" id="kobo.373.1">source code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.374.1">
#include &lt;QMainWindow&gt;
#include &lt;QDebug&gt;
#include &lt;QtNetwork/QNetworkAccessManager&gt;
#include &lt;QtNetwork/QNetworkReply&gt;
#include &lt;QJsonDocument&gt;
#include &lt;QJsonArray&gt;
#include &lt;QJsonObject&gt;</span></pre></li> <li><span class="koboSpan" id="kobo.375.1">Declare a slot function manually and call </span><span class="No-Break"><span class="koboSpan" id="kobo.376.1">it </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.377.1">getAddressFinished()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.378.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.379.1">
private slots:
void getAddressFinished(QNetworkReply* reply);</span></pre></li> <li><span class="koboSpan" id="kobo.380.1">Declare a </span><strong class="source-inline"><span class="koboSpan" id="kobo.381.1">private</span></strong><span class="koboSpan" id="kobo.382.1"> variable </span><span class="No-Break"><span class="koboSpan" id="kobo.383.1">called </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.384.1">addressRequest</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.385.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.386.1">
private:
QNetworkAccessManager* addressRequest;</span></pre></li> <li><span class="koboSpan" id="kobo.387.1">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.388.1">mainwindow.ui</span></strong><span class="koboSpan" id="kobo.389.1"> again, right-click on the </span><strong class="bold"><span class="koboSpan" id="kobo.390.1">Get Address</span></strong><span class="koboSpan" id="kobo.391.1"> button, and select </span><strong class="bold"><span class="koboSpan" id="kobo.392.1">Go to slot…</span></strong><span class="koboSpan" id="kobo.393.1">. </span><span class="koboSpan" id="kobo.393.2">Then, choose the </span><strong class="source-inline"><span class="koboSpan" id="kobo.394.1">clicked()</span></strong><span class="koboSpan" id="kobo.395.1"> option and press </span><strong class="bold"><span class="koboSpan" id="kobo.396.1">OK</span></strong><span class="koboSpan" id="kobo.397.1">. </span><span class="koboSpan" id="kobo.397.2">A slot function </span><a id="_idIndexMarker708"/><span class="koboSpan" id="kobo.398.1">will now be added to both the </span><strong class="source-inline"><span class="koboSpan" id="kobo.399.1">mainwindow.h</span></strong><span class="koboSpan" id="kobo.400.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.401.1">mainwindow.cpp</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.402.1">source files.</span></span></li>
<li><span class="koboSpan" id="kobo.403.1">Open </span><strong class="source-inline"><span class="koboSpan" id="kobo.404.1">mainwindow.cpp</span></strong><span class="koboSpan" id="kobo.405.1"> and add the following code to the </span><span class="No-Break"><span class="koboSpan" id="kobo.406.1">class constructor:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.407.1">
MainWindow::MainWindow(QWidget *parent) :
QMainWindow(parent),
ui(new Ui::MainWindow) {
ui-&gt;setupUi(this);
</span><strong class="bold"><span class="koboSpan" id="kobo.408.1">addressRequest = new QNetworkAccessManager();</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.409.1">connect(addressRequest, &amp;QNetworkAccessManager::finished, this, &amp;MainWindow::getAddressFinished);</span></strong><span class="koboSpan" id="kobo.410.1">
}</span></pre></li> <li><span class="koboSpan" id="kobo.411.1">Add the following code to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.412.1">getAddressFinished()</span></strong><span class="koboSpan" id="kobo.413.1"> slot function we just </span><span class="No-Break"><span class="koboSpan" id="kobo.414.1">declared manually:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.415.1">
void MainWindow::getAddressFinished(QNetworkReply* reply) {
QByteArray bytes = reply-&gt;readAll();
//qDebug() &lt;&lt; QString::fromUtf8(bytes.data(), bytes.size());
QJsonDocument json = QJsonDocument::fromJson(bytes);</span></pre></li> <li><span class="koboSpan" id="kobo.416.1">Continue to get the first set of results from the JSON array to obtain the </span><span class="No-Break"><span class="koboSpan" id="kobo.417.1">formatted address:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.418.1">
QJsonObject object = json.object();
QJsonArray results = object["results"].toArray();
QJsonObject first = results.at(0).toObject();
QString address = first["formatted_address"].toString();
qDebug() &lt;&lt; "Address:" &lt;&lt; address;
}</span></pre></li> <li><span class="koboSpan" id="kobo.419.1">Add the </span><a id="_idIndexMarker709"/><span class="koboSpan" id="kobo.420.1">following code to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.421.1">clicked()</span></strong><span class="koboSpan" id="kobo.422.1"> slot function created </span><span class="No-Break"><span class="koboSpan" id="kobo.423.1">by Qt:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.424.1">
void MainWindow::on_getAddressButton_clicked() {
QString latitude = ui-&gt;latitude-&gt;text();
QString longitude = ui-&gt;longitude-&gt;text();
QNetworkRequest request;
request.setUrl(QUrl("https://maps.googleapis.com/maps/api/geocode/json?latlng=" + latitude + "," + longitude + "&amp;key=YOUR_KEY"));
addressRequest-&gt;get(request);
}</span></pre></li> <li><span class="koboSpan" id="kobo.425.1">Build and run the program and you should be able to obtain the address by inserting the </span><strong class="bold"><span class="koboSpan" id="kobo.426.1">Longitude</span></strong><span class="koboSpan" id="kobo.427.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.428.1">Latitude</span></strong><span class="koboSpan" id="kobo.429.1"> values and clicking the </span><strong class="bold"><span class="koboSpan" id="kobo.430.1">Get </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.431.1">Address</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.432.1"> button:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer167">
<span class="koboSpan" id="kobo.433.1"><img alt="Figure 10.8 – Inserting the coordinates and pressing the Get Address button" src="image/B20976_10_008.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.434.1">Figure 10.8 – Inserting the coordinates and pressing the Get Address button</span></p>
<ol>
<li value="13"><span class="koboSpan" id="kobo.435.1">Let’s try with a longitude of </span><strong class="source-inline"><span class="koboSpan" id="kobo.436.1">-73.9780838</span></strong><span class="koboSpan" id="kobo.437.1"> and a latitude of </span><strong class="source-inline"><span class="koboSpan" id="kobo.438.1">40.6712957</span></strong><span class="koboSpan" id="kobo.439.1">. </span><span class="koboSpan" id="kobo.439.2">Click the </span><strong class="bold"><span class="koboSpan" id="kobo.440.1">Get Address</span></strong><span class="koboSpan" id="kobo.441.1"> button and you will see the following result in the application </span><span class="No-Break"><span class="koboSpan" id="kobo.442.1">output window:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.443.1">
Address: "185 7th Ave, Brooklyn, NY 11215, USA"</span></pre></li> </ol>
<h2 id="_idParaDest-222"><a id="_idTextAnchor222"/><span class="koboSpan" id="kobo.444.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.445.1">I won’t be able to tell you exactly how Google obtains the address from its backend system but I can teach you how to request data from Google by using </span><strong class="source-inline"><span class="koboSpan" id="kobo.446.1">QNetworkRequest</span></strong><span class="koboSpan" id="kobo.447.1">. </span><span class="koboSpan" id="kobo.447.2">All you need to do is to set the URL of the network request to the URL I used in the previous source code and append both the latitude and longitude information to </span><span class="No-Break"><span class="koboSpan" id="kobo.448.1">the URL.</span></span></p>
<p><span class="koboSpan" id="kobo.449.1">After that, all we </span><a id="_idIndexMarker710"/><span class="koboSpan" id="kobo.450.1">can do is wait for the response from the Google API server. </span><span class="koboSpan" id="kobo.450.2">We need to specify JSON as the desired format when sending the request to Google; otherwise, it may return the results in JSON format. </span><span class="koboSpan" id="kobo.450.3">This can be done by adding the </span><strong class="source-inline"><span class="koboSpan" id="kobo.451.1">json</span></strong><span class="koboSpan" id="kobo.452.1"> keyword within the network request URL, as </span><span class="No-Break"><span class="koboSpan" id="kobo.453.1">highlighted here:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.454.1">
request.setUrl(QUrl("https://maps.googleapis.com/maps/api/geocode/xml?keylatlng=" + latitude + "," + longitude + "&amp;key=YOUR_CODE"));</span></pre> <p><span class="koboSpan" id="kobo.455.1">When the program receives the response from Google, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.456.1">getAddressFinished()</span></strong><span class="koboSpan" id="kobo.457.1"> slot function will be called and we will be able to obtain the data sent by Google </span><span class="No-Break"><span class="koboSpan" id="kobo.458.1">through </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.459.1">QNetworkReply</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.460.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.461.1">Google usually replies with a long text in JSON format, which contains a ton of data we don’t need. </span><span class="koboSpan" id="kobo.461.2">All we need is the text stored in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.462.1">formatted_address</span></strong><span class="koboSpan" id="kobo.463.1"> element in the JSON data. </span><span class="koboSpan" id="kobo.463.2">Since there is more than one element by the name of </span><strong class="source-inline"><span class="koboSpan" id="kobo.464.1">formatted_address</span></strong><span class="koboSpan" id="kobo.465.1">, we just need to find the first one and ignore the rest. </span><span class="koboSpan" id="kobo.465.2">You can also do the </span><a id="_idIndexMarker711"/><span class="koboSpan" id="kobo.466.1">reverse by providing an address to Google and obtaining the location’s coordinates from its </span><span class="No-Break"><span class="koboSpan" id="kobo.467.1">network response.</span></span></p>
<h2 id="_idParaDest-223"><a id="_idTextAnchor223"/><span class="koboSpan" id="kobo.468.1">There’s more…</span></h2>
<p><span class="koboSpan" id="kobo.469.1">Google’s </span><strong class="bold"><span class="koboSpan" id="kobo.470.1">Geocoding API</span></strong><span class="koboSpan" id="kobo.471.1"> is part </span><a id="_idIndexMarker712"/><span class="koboSpan" id="kobo.472.1">of the </span><strong class="bold"><span class="koboSpan" id="kobo.473.1">Google Maps APIs</span></strong><span class="koboSpan" id="kobo.474.1"> web services, which provide geographical data for your map applications. </span><span class="koboSpan" id="kobo.474.2">Besides the Geocoding </span><a id="_idIndexMarker713"/><span class="koboSpan" id="kobo.475.1">API, you can </span><a id="_idIndexMarker714"/><span class="koboSpan" id="kobo.476.1">also use their </span><strong class="bold"><span class="koboSpan" id="kobo.477.1">Location API</span></strong><span class="koboSpan" id="kobo.478.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.479.1">Geolocation API</span></strong><span class="koboSpan" id="kobo.480.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.481.1">Time Zone API</span></strong><span class="koboSpan" id="kobo.482.1"> to </span><a id="_idIndexMarker715"/><span class="koboSpan" id="kobo.483.1">achieve your </span><span class="No-Break"><span class="koboSpan" id="kobo.484.1">desired results.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.485.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.486.1">For more </span><a id="_idIndexMarker716"/><span class="koboSpan" id="kobo.487.1">information regarding the Google Maps APIs web services, </span><span class="No-Break"><span class="koboSpan" id="kobo.488.1">visit </span></span><a href="https://developers.google.com/maps/web-services"><span class="No-Break"><span class="koboSpan" id="kobo.489.1">https://developers.google.com/maps/web-services</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.490.1">.</span></span></p>
</div>
</body></html>