- en: '*Chapter 14*: COVID-19 20-Second Hand Washing Timer'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '*第14章*：COVID-19 20秒洗手计时器'
- en: This chapter describes a useful project where you will make a touchless timer
    by waving at an ultrasonic sensor. This timer will count the minimum time of 20
    seconds recommended by health authorities for properly washing our hands for preventing
    contamination from viruses such as SARS-CoV-2 that produces COVID-19 symptoms.
    The project involves an inexpensive ultrasonic sensor that detects when a user
    waves at the sensor by measuring the distance between the user and the circuit,
    triggering the counting. This application must be enclosed in a waterproof container
    to avoid soaking the circuit while the user washes their hands and damaging it.
    We explain at the end of the chapter how to do this.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章描述了一个有用的项目，您将通过在超声波传感器前挥手来制作一个非接触式计时器。这个计时器将计算卫生部门推荐的至少20秒的洗手时间，以防止由SARS-CoV-2病毒引起的COVID-19症状。该项目涉及一个价格低廉的超声波传感器，该传感器通过测量用户与电路之间的距离来检测用户是否在挥手，从而触发计数。此应用必须封装在一个防水容器中，以避免用户洗手时电路进水并损坏。我们在本章末尾解释了如何做到这一点。
- en: 'In this chapter, we will cover the following main topics:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖以下主要主题：
- en: Programming the counter (timer)
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 编程计数器（计时器）
- en: Showing the timer on an LCD
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在LCD上显示计时器
- en: Connecting an ultrasonic sensor to the microcontroller board
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将超声波传感器连接到微控制器板
- en: Putting everything together – think of a protective case for the project!
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将所有部件组装在一起——想想为这个项目设计一个保护壳！
- en: Testing the timer
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 测试计时器
- en: By the end of this chapter, you will have learned how to properly connect an
    ultrasonic sensor and an LCD to a microcontroller board. In addition, you will
    learn how to read input values from a sensor to activate the 20-second counting.
    You will also learn how to code an efficient and effective timer that runs on
    a microcontroller board.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 到本章结束时，您将学会如何正确地将超声波传感器和LCD连接到微控制器板上。此外，您还将学习如何从传感器读取输入值以激活20秒倒计时。您还将学习如何编写在微控制器板上运行的效率高且有效的计时器代码。
- en: Technical requirements
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: The software tool that you will be using in this chapter is the Arduino IDE
    for editing and uploading your programs to the Blue Pill microcontroller board.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 本章中您将使用的软件工具是Arduino IDE，用于编辑并将程序上传到Blue Pill微控制器板。
- en: 'The code used in this chapter can be found in the book''s GitHub repository:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 本章中使用的代码可以在本书的GitHub仓库中找到：
- en: '[https://github.com/PacktPublishing/DIY-Microcontroller-Projects-for-Hobbyists/tree/master/Chapter14](https://github.com/PacktPublishing/DIY-Microcontroller-Projects-for-Hobbyists/tree/master/Chapter14)'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://github.com/PacktPublishing/DIY-Microcontroller-Projects-for-Hobbyists/tree/master/Chapter14](https://github.com/PacktPublishing/DIY-Microcontroller-Projects-for-Hobbyists/tree/master/Chapter14)'
- en: 'The Code in Action video for this chapter can be found here: [https://bit.ly/3gQZdPf](https://bit.ly/3gQZdPf)'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的“代码在行动”视频可以在这里找到：[https://bit.ly/3gQZdPf](https://bit.ly/3gQZdPf)
- en: 'In this chapter, we will use the following pieces of hardware:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将使用以下硬件设备：
- en: One solderless breadboard.
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个无焊面包板。
- en: One Blue Pill microcontroller board.
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个Blue Pill微控制器板。
- en: One micro-USB cable for connecting your microcontroller board to a computer
    and a power bank.
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一根微USB线，用于将微控制器板连接到计算机和移动电源。
- en: One USB power bank.
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个USB移动电源。
- en: One ST-INK/V2 electronic interface, needed for uploading the compiled code to
    the Blue Pill. Bear in mind that the ST-LINK/V2 requires four female-to-female
    DuPont wires.
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个ST-INK/V2电子接口，用于将编译后的代码上传到Blue Pill。请注意，ST-LINK/V2需要四根公对公的杜邦线。
- en: One HC-SR04 ultrasonic sensor.
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个HC-SR04超声波传感器。
- en: One 1602 16x2 LCD.
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个1602 16x2 LCD。
- en: One 2.2k ohm resistor, 1/4 watt. This is for the LCD.
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个2.2k欧姆、1/4瓦的电阻。这是用于LCD的。
- en: A dozen male-to-male and a dozen male-to-female DuPont wires.
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一打公对公和一打公对母的杜邦线。
- en: The next section explains how to code the 20-second timer that runs on the Blue
    Pill microcontroller board.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个部分将解释如何编写在Blue Pill微控制器板上运行的20秒计时器代码。
- en: Programming the counter (timer)
  id: totrans-25
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 编程计数器（计时器）
- en: This section shows you how to code the 20-second timer. Programming a timer
    like this one is not trivial, since a user could activate the timer many times
    by waving at the ultrasonic sensor more than once while the counter is on. The
    program should not take into account those multiple activations if the 20-second
    counting is going on; otherwise, the counter will re-start multiple times and
    the counting will not be accurate. We also need to consider saving energy by turning
    off the LCD when not in use.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 本节展示了如何编写20秒计时器的代码。编写这样的计时器程序并不简单，因为用户可能会在计数器开启时通过超声波传感器多次挥手来激活计时器。如果20秒的计数正在进行，程序不应考虑这些多次激活；否则，计数器将多次重新启动，计数将不准确。我们还需要考虑在不使用时关闭LCD以节省能源。
- en: 'We should code our 20-second timer application by following these steps:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 我们应该按照以下步骤编写我们的20秒计时器应用程序：
- en: Read values from the ultrasonic sensor.
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从超声波传感器读取值。
- en: 'Check whether the user is waving at the sensor within 15 centimeters of the
    sensor. If this happens, do this:'
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查用户是否在距离传感器15厘米内挥手。如果发生这种情况，执行以下操作：
- en: a) Turn on the LCD light.
  id: totrans-30
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: a) 打开LCD背光。
- en: b) Show the **Lather hands** message and show the 20-second counting on the
    LCD.
  id: totrans-31
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: b) 显示**打湿双手**的消息，并在LCD上显示20秒的计数。
- en: 'c) When the counter finishes, show this message on the LCD: **Rinse your hands**.'
  id: totrans-32
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: c) 当计数器完成时，在LCD上显示此消息：**洗手**。
- en: d) Wait for 4 seconds and then turn off the LCD to conserve energy.
  id: totrans-33
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: d) 等待4秒后关闭LCD以节省能源。
- en: e) Return to *step 1*.
  id: totrans-34
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: e) 返回到**步骤1**。
- en: 'The following is the Arduino IDE code that runs on the Blue Pill, programmed
    following the preceding steps. The following code snippet shows how the variables
    and constants are defined. The HC-SR04''s echo digital value is obtained from
    port `A9` (labeled `PA9`) and stored in the `echo` variable. Similarly, the trigger
    value is sent to the ultrasonic sensor through port `A8` (`PA8`) and stored in
    the `trigger` variable. Please note that the `dist_read` variable stores the distance
    between an object (for example, a waving hand) and the ultrasonic sensor, measured
    in centimeters:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是在Blue Pill上运行的Arduino IDE代码，按照前面的步骤编程。以下代码片段显示了变量和常量的定义。HC-SR04的回声数字值从端口`A9`（标记为`PA9`）获取并存储在`echo`变量中。同样，触发值通过端口`A8`（`PA8`）发送到超声波传感器，并存储在`trigger`变量中。请注意，`dist_read`变量存储了物体（例如，挥手的手）与超声波传感器之间的距离，单位为厘米：
- en: '[PRE0]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: As you can see from the preceding code, it uses a library called `elapsedMillis.h`
    to calculate the time in milliseconds that has elapsed on the counting. This library
    can also be obtained from [https://www.arduino.cc/reference/en/libraries/elapsedmillis/](https://www.arduino.cc/reference/en/libraries/elapsedmillis/).
    You can find this library in the code folder uploaded to the book's GitHub repository.
    It is useful because by using this library we avoid using the `delay()` function
    in the 20-second counting. If we use the `delay()` function, the Blue Pill's counting
    and reading sensor values from the ports could mess up. Note that the library
    is written between double quotes because in C++ this means that the library is
    in the same folder as the source code, which is a library that does not belong
    to the original Arduino IDE installation. The code also uses the `LiquidCrystal.h`
    library, used for controlling the 1602 LCD. This library already comes with the
    standard Arduino IDE installation so there is no need for installing it separately.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 如您从前面的代码中可以看到，它使用了一个名为`elapsedMillis.h`的库来计算计数过程中经过的毫秒数。这个库也可以从[https://www.arduino.cc/reference/en/libraries/elapsedmillis/](https://www.arduino.cc/reference/en/libraries/elapsedmillis/)获取。您可以在上传到书籍GitHub仓库的代码文件夹中找到这个库。它很有用，因为通过使用这个库，我们避免了在20秒计数中使用`delay()`函数。如果我们使用`delay()`函数，Blue
    Pill的计数和从端口读取传感器值可能会出错。请注意，库被写在了双引号中，因为在C++中这意味着库与源代码在同一文件夹中，这是一个不属于原始Arduino
    IDE安装的库。代码还使用了`LiquidCrystal.h`库，用于控制1602 LCD。这个库已经包含在标准的Arduino IDE安装中，因此不需要单独安装。
- en: 'This code snippet sets up the LCD and the Blue Pill ports:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 此代码片段设置了LCD和Blue Pill端口：
- en: '[PRE1]'
  id: totrans-39
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'The following code segment shows the code''s main loop, which reads the ultrasonic
    sensor values and calculates the distance between the user''s waving hand and
    the sensor:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 以下代码段显示了代码的主循环，它读取超声波传感器的值并计算用户挥手的手与传感器之间的距离：
- en: '[PRE2]'
  id: totrans-41
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'The following code segment from the main loop function calculates whether the
    distance between the user and the sensor is equal to or less than 15 centimeters,
    then activates the 20-second counter and shows it on the LCD:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 以下代码段来自主循环函数，用于计算用户与传感器之间的距离是否等于或小于15厘米，然后激活20秒计数器并在LCD上显示：
- en: '[PRE3]'
  id: totrans-43
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Tip
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 小贴士
- en: 'You can also run the previous code on Arduino microcontroller boards. You just
    need to change the port numbers used for the LCD and sensor connections. For example,
    if you are using an Arduino Uno board, change this line to `const int rs=12,en=11,d4=5,d5=4,d6=3,d7=2;`
    using Arduino board digital ports `12`, `11`, `5`, `4`, `3`, and `2`, respectively.
    You will also need to change these lines to the following:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 您也可以在Arduino微控制器板上运行前面的代码。您只需更改用于LCD和传感器连接的端口编号。例如，如果您使用Arduino Uno板，将此行更改为`const
    int rs=12,en=11,d4=5,d5=4,d6=3,d7=2;`，分别使用Arduino板数字端口`12`、`11`、`5`、`4`、`3`和`2`。您还需要将这些行更改为以下内容：
- en: '`#define backLight 6`'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: '`#define backLight 6`'
- en: '`#define trigger 7`'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: '`#define trigger 7`'
- en: '`#define echo 8`'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: '`#define echo 8`'
- en: So, you will use Arduino digital ports 6, 7 and 8 for the ultrasonic sensor.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，您将使用Arduino数字端口6、7和8来连接超声波传感器。
- en: Bear in mind that the code uploaded to the GitHub repository contains many comments
    explaining its most important parts.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 请记住，上传到GitHub仓库的代码包含许多注释，解释了其最重要的部分。
- en: The next section explains how to connect the 1602 LCD to the Blue Pill to show
    the 20-second count on it.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个部分将解释如何将1602 LCD连接到Blue Pill，以显示20秒计数：
- en: Showing the timer on an LCD
  id: totrans-52
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在LCD上显示计时器
- en: 'In this section, we explain how to connect and use the 1602 LCD to show the
    timer on it. *Figure 14.1* shows the Fritzing diagram similar to the one explained
    in [*Chapter 5*](B16413_05_Final_NM_ePub.xhtml#_idTextAnchor069), *Humidity and
    Temperature Measurement*:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们解释如何连接和使用1602 LCD来显示计时器。*图14.1*显示了类似于在[*第5章*](B16413_05_Final_NM_ePub.xhtml#_idTextAnchor069)中解释的Fritzing图，*湿度和温度测量*：
- en: '![Figure 14.1 – The LCD connected to the Blue Pill microcontroller board](img/Figure_14.1_B16413.jpg)'
  id: totrans-54
  prefs: []
  type: TYPE_IMG
  zh: '![图14.1 – 连接到Blue Pill微控制器板的LCD](img/Figure_14.1_B16413.jpg)'
- en: Figure 14.1 – The LCD connected to the Blue Pill microcontroller board
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.1 – 连接到Blue Pill微控制器板的LCD
- en: 'The following are the steps for connecting the LCD to the Blue Pill, following
    the diagram from *Figure 14.1*:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是将LCD连接到Blue Pill的步骤，按照*图14.1*中的图解进行：
- en: Connect the Blue Pill's **GND** (also labeled as **G**) pins to the solderless
    breadboard rails.
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将Blue Pill的**GND**（也标记为**G**）引脚连接到无焊面包板轨道。
- en: Connect the Blue Pill's **5V** pin (providing 5 volts) to the breadboard rails.
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将Blue Pill的**5V**引脚（提供5伏）连接到面包板轨道。
- en: Connect the USB cable to the Blue Pill and then to your computer or a USB power
    bank.
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将USB线连接到Blue Pill，然后连接到您的电脑或USB移动电源。
- en: Insert the LCD's 16 pins into the solderless breadboard.
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将LCD的16个引脚插入无焊面包板。
- en: Connect the LCD's **VSS** pin to ground (the lower breadboard rail).
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将LCD的**VSS**引脚连接到地（下方的面包板轨道）。
- en: Connect the LCD's **VDD** pin to 5 volts (the lower breadboard rail).
  id: totrans-62
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将LCD的**VDD**引脚连接到5伏（下方的面包板轨道）。
- en: Connect the 2.2k ohm resistor to the LCD's **V0** pin and to ground (the lower
    breadboard rail).
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将2.2k欧姆电阻连接到LCD的**V0**引脚和地（下方的面包板轨道）。
- en: Connect the LCD's **RS** pin to the Blue Pill's **B11** pin.
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将LCD的**RS**引脚连接到Blue Pill的**B11**引脚。
- en: Connect the LCD's **RW** pin to ground (lower breadboard rail).
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将LCD的**RW**引脚连接到地（下方的面包板轨道）。
- en: Connect the LCD's **E** pin to the Blue Pill's **B10** pin.
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将LCD的**E**引脚连接到Blue Pill的**B10**引脚。
- en: Connect the LCD's **D4** pin to the Blue Pill's **B0** pin.
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将LCD的**D4**引脚连接到Blue Pill的**B0**引脚。
- en: Connect the LCD's **D5** pin to the Blue Pill's **A7** pin.
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将LCD的**D5**引脚连接到Blue Pill的**A7**引脚。
- en: Connect the LCD's **D6** pin to the Blue Pill's **A6** pin.
  id: totrans-69
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将LCD的**D6**引脚连接到Blue Pill的**A6**引脚。
- en: Connect the LCD's **D7** pin to the Blue Pill's **A5** pin.
  id: totrans-70
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将LCD的**D7**引脚连接到Blue Pill的**A5**引脚。
- en: Connect the LCD's **A** pin to the Blue Pill's port **B12**.
  id: totrans-71
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将LCD的**A**引脚连接到Blue Pill的端口**B12**。
- en: Connect the LCD's **K** pin to ground (lower breadboard rail).
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将LCD的**K**引脚连接到地（下方的面包板轨道）。
- en: The LCD's **D0**, **D1**, **D2**, and **D3** pins are not connected.
  id: totrans-73
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: LCD的**D0**、**D1**、**D2**和**D3**引脚未连接。
- en: After doing the preceding steps, you have accomplished connecting the LCD to
    the Blue Pill board. The LCD will be useful for showing the 20-second count. Well
    done!
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 完成前面的步骤后，您已经完成了将LCD连接到Blue Pill板的工作。LCD将用于显示20秒计数。做得好！
- en: '*Figure 14.2* shows how everything is connected:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: '*图14.2*显示了所有连接方式：'
- en: '![Figure 14.2 – The Blue Pill microcontroller board connected to the LCD ](img/Figure_14.2_B16413.jpg)'
  id: totrans-76
  prefs: []
  type: TYPE_IMG
  zh: '![图14.2 – 连接到LCD的Blue Pill微控制器板](img/Figure_14.2_B16413.jpg)'
- en: Figure 14.2 – The Blue Pill microcontroller board connected to the LCD
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.2 – 连接到LCD的Blue Pill微控制器板
- en: As you can see from *Figure 14.2*, the 1602A LCD is easy to connect to the Blue
    Pill. The 2.2k ohm connected to the LCD's pin **V0** sets up the LCD's contrast.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 如您从*图14.2*中可以看到，1602A液晶显示屏很容易连接到Blue Pill。连接到LCD的引脚**V0**的2.2k欧姆电阻设置了LCD的对比度。
- en: Tip
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 小贴士
- en: You can use a 50k ohm variable resistor (also known as a **potentiometer**)
    instead of the 2.2k ohm resistor connected to the LCD's pin **V0** to adjust the
    display contrast. Just connect the potentiometer's middle pin to **V0**, one pin
    to ground, and the other pin to **5V**.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用50k欧姆可变电阻器（也称为**电位器**）代替连接到LCD引脚**V0**的2.2k欧姆电阻，以调整显示对比度。只需将电位器的中间引脚连接到**V0**，一个引脚连接到地，另一个引脚连接到**5V**。
- en: Please note that the LCD pin **A** (pin no. 15) is connected to the Blue Pill's
    **B12** port, which controls the LCD by turning its back light on or off via coding.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，LCD引脚**A**（引脚编号15）连接到Blue Pill的**B12**端口，通过编码通过打开或关闭背光来控制LCD。
- en: Tip
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 小贴士
- en: Allow enough space on the solderless breadboard between the Blue Pill and the
    rest of the electronic components (LCD, ultrasonic sensor, and so on) to facilitate
    the connection of the ST-Link/V2 interface to the Blue Pill.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 在Blue Pill和其余电子组件（LCD、超声波传感器等）之间在无焊面包板上留出足够的空间，以便于将ST-Link/V2接口连接到Blue Pill。
- en: The next section explains how to use the ultrasonic sensor to see whether a
    user is waving at the sensor to trigger the 20-second timer.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个部分将解释如何使用超声波传感器来判断用户是否在向传感器挥手以触发20秒定时器。
- en: Connecting an ultrasonic sensor to the microcontroller board
  id: totrans-85
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将超声波传感器连接到微控制器板
- en: This section explains how an ultrasonic sensor works, and it describes how to
    connect the HC-SR04 sensor to the Blue Pill microcontroller board, describing
    how to use its four-pin functions. The ultrasonic sensor will be used to check
    whether the user waves at it to initiate the 20-second counting.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 本节解释超声波传感器的工作原理，并描述如何将HC-SR04传感器连接到Blue Pill微控制器板，描述如何使用其四引脚功能。超声波传感器将用于检查用户是否向其挥手以启动20秒计数。
- en: What is an ultrasonic sensor?
  id: totrans-87
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 什么是超声波传感器？
- en: Ultrasonic waves are sound waves that have a frequency that is higher than the
    frequencies that most human beings can hear, which is above 20,000 Hz. Ultrasonic
    sounds, or ultrasound, can have different applications, including something called
    **echolocation**, used by animals such as bats for identifying how far their prey
    is using reflected sounds. The same principle is applied in ultrasonic sensors.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 超声波是频率高于大多数人类能听到的频率（即高于20,000 Hz）的声波。超声波或超声波可以有不同的应用，包括被称为**回声定位**的技术，这种技术被诸如蝙蝠等动物使用，通过反射声波来确定猎物距离。同样的原理也应用于超声波传感器。
- en: An **ultrasonic sensor** is a dedicated electronic component that generally
    contains a number of electronic parts such as resistors, transistors, diodes,
    a crystal clock, a special microphone, and a speaker. Many ultrasonic sensors
    are technically modules, because they integrate a number of electronic parts,
    and this integration as a module facilitates the connection with other devices
    such as microcontroller boards. An ultrasonic sensor measures the distance between
    an object (for example, a waving hand) and the sensor by using ultrasonic sound
    waves. The sensor emits ultrasonic sound waves through a speaker and receives
    through a microphone the reflected ultrasonic waves that hit the object. The sensor
    measures the time it takes between the sound wave emission and reception.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: '**超声波传感器**是一种专用电子组件，通常包含多个电子部件，如电阻器、晶体管、二极管、晶振时钟、特殊麦克风和扬声器。许多超声波传感器在技术上属于模块，因为它们集成了多个电子部件，这种集成作为模块有助于与其他设备（如微控制器板）的连接。超声波传感器通过使用超声波测量物体（例如，挥动的手）与传感器之间的距离。传感器通过扬声器发射超声波，并通过麦克风接收撞击物体的反射超声波。传感器测量声波发射和接收之间的时间。'
- en: How does an ultrasonic sensor work?
  id: totrans-90
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 超声波传感器是如何工作的？
- en: An ultrasonic sensor (such as the **HC-SR04**) emits and receives ultrasonic
    sound waves (working like **sonar**) to determine the distance to an object. Sonar
    is an echolocation device used for detecting objects underwater, emitting sound
    pulses (generally using ultrasound frequencies), measuring the time it takes for
    the reflection of those pulses, and calculating the distance between the object
    and the sonar device. The ultrasonic sensor used in this chapter is not meant
    to be used underwater, as we can see later.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 超声波传感器（如**HC-SR04**）通过发射和接收超声波（类似于声纳）来确定物体距离。声纳是一种回声定位设备，用于水下检测物体，发射声脉冲（通常使用超声波频率），测量这些脉冲的反射时间，并计算物体与声纳设备之间的距离。本章中使用的超声波传感器不是为了水下使用，我们稍后会看到。
- en: Some ultrasonic sensors (such as the HC-SR04 used in this chapter) use sound
    waves with a frequency of 40 kHz, well above the range of sound frequencies that
    the human ear can perceive on average, which is 20 Hz to 20 kHz.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 一些超声波传感器（如本章中使用的HC-SR04）使用频率为40 kHz的声波，这远高于人类耳朵平均能感知的声音频率范围，即20 Hz到20 kHz。
- en: 'This is how the HC-SR04 ultrasonic sensor works:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 这就是HC-SR04超声波传感器的工作原理：
- en: A microcontroller board sends a digital signal to the sensor's `Trig` pin, triggering
    (initiating) the ultrasonic wave emission through the sensor's speaker.
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 微控制器板向传感器的`Trig`引脚发送数字信号，通过传感器的扬声器触发（启动）超声波发射。
- en: When a high-frequency sound wave hits an object, it is reflected back to the
    sensor and this reflection is picked up by the sensor's microphone.
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当高频声波击中物体时，它会反射回传感器，并被传感器的麦克风捕捉到。
- en: The sensor sends out a digital signal to the microcontroller board through its
    `Echo` pin.
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 传感器通过其`Echo`引脚向微控制器板发送数字信号。
- en: A microcontroller board receives that digital signal from the `Echo` pin, encoding
    the duration between the sound wave emission and reception.
  id: totrans-97
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 微控制器板从`Echo`引脚接收该数字信号，编码声波发射和接收之间的持续时间。
- en: 'The distance between the sensor and the object is calculated as follows:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 传感器与物体之间的距离计算如下：
- en: D=(T*C) ⁄ 2
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: D=(T*C) / 2
- en: 'The symbols denote the following:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 符号表示以下内容：
- en: '**D**: Distance'
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**D**：距离'
- en: '**T**: Time it takes between ultrasonic wave emission and reception (duration)'
  id: totrans-102
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**T**：超声波发射和接收之间的时间（持续时间）'
- en: '**C**: General speed of sound (343 m/s in dry air)'
  id: totrans-103
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**C**：空气中的声速（干燥空气中的声速为343 m/s）'
- en: The distance is divided by 2 because we need just the sound wave's return distance.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 距离被除以2，因为我们只需要声波的返回距离。
- en: '*Figure 14.3* shows a Fritzing diagram of the ultrasonic sensor:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: '*图14.3*展示了超声波传感器的Fritzing图：'
- en: '![Figure 14.3 – The HC-SR04 ultrasonic sensor pinout](img/Figure_14.3_B16413.jpg)'
  id: totrans-106
  prefs: []
  type: TYPE_IMG
  zh: '![图14.3 – HC-SR04超声波传感器引脚图](img/Figure_14.3_B16413.jpg)'
- en: Figure 14.3 – The HC-SR04 ultrasonic sensor pinout
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.3 – HC-SR04超声波传感器引脚图
- en: From *Figure 14.3*, you can see the sensor pinout. The **VCC** pin is connected
    to a 5-volt power supply. The **Trig** and **Echo** pins are connected to the
    microcontroller board's digital ports. The **GND** pin is connected to ground.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 从*图14.3*中，你可以看到传感器的引脚图。**VCC**引脚连接到5伏电源。**Trig**和**Echo**引脚连接到微控制器板的数字端口。**GND**引脚连接到地。
- en: 'Here are the technical characteristics of the HC-SR04 sensor:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是HC-SR04传感器的技术特性：
- en: '**Operating voltage**: DC 5 volts'
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**工作电压**：直流5伏'
- en: '**Operating frequency**: 40 kHz'
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**工作频率**：40 kHz'
- en: '**Operating current**: 15 mA'
  id: totrans-112
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**工作电流**：15 mA'
- en: '**Maximum operational range**: 4 meters'
  id: totrans-113
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**最大工作范围**：4米'
- en: '**Minimum operational range**: 2 centimeters'
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**最小工作范围**：2厘米'
- en: '**Resolution**: 0.3 centimeters'
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**分辨率**：0.3厘米'
- en: '**Measuring angle**: 30 degrees (sensor''s field of view)'
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**测量角度**：30度（传感器的视野）'
- en: '*Figure 14.4* shows the HC-SR04 ultrasonic sensor used in this chapter:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: '*图14.4*展示了本章中使用的HC-SR04超声波传感器：'
- en: '![Figure 14.4 – The HC-SR04 ultrasonic sensor](img/Figure_14.4_B16413.jpg)'
  id: totrans-118
  prefs: []
  type: TYPE_IMG
  zh: '![图14.4 – HC-SR04超声波传感器](img/Figure_14.4_B16413.jpg)'
- en: Figure 14.4 – The HC-SR04 ultrasonic sensor
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.4 – HC-SR04超声波传感器
- en: 'From *Figure 14.4*, you can see that the sensor has two speaker-like components.
    One of them is actually a small speaker emitting ultrasonic sound signals and
    the other one is a microphone that captures those signals back after they bounce
    on an object. *Figure 14.5* shows the back of the HC-SR04 ultrasonic sensor:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 从*图14.4*中，你可以看到该传感器有两个类似扬声器的组件。其中一个是实际上发出超声波信号的小扬声器，另一个是捕捉这些信号在物体上反射后的麦克风。*图14.5*展示了HC-SR04超声波传感器的背面：
- en: '![Figure 14.5 – The back side of the HC-SR04 sensor](img/Figure_14.5_B16413.jpg)'
  id: totrans-121
  prefs: []
  type: TYPE_IMG
  zh: '![图14.5 – HC-SR04传感器的背面](img/Figure_14.5_B16413.jpg)'
- en: Figure 14.5 – The back side of the HC-SR04 sensor
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.5 – HC-SR04传感器的背面
- en: As you can see from *Figure 14.5*, the back of the sensor contains electronic
    components such as resistors, transistors, and integrated circuits that support
    the generation and reception of ultrasonic signals.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 如*图14.5*所示，传感器的背面包含支持超声波信号生成和接收的电子组件，如电阻器、晶体管和集成电路。
- en: 'There are other types of ultrasonic sensors, such as the Maxbotix MaxSonar
    ultrasonic sensor. Its Fritzing diagram is shown in *Figure 14.6*:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 还有其他类型的超声波传感器，例如Maxbotix MaxSonar超声波传感器。其Fritzing图示在*图14.6*中显示：
- en: '![Figure 14.6 – The Maxbotix MaxSonar ultrasonic sensor](img/Figure_14.6_B16413.jpg)'
  id: totrans-125
  prefs: []
  type: TYPE_IMG
  zh: '![图14.6 – Maxbotix MaxSonar超声波传感器](img/Figure_14.6_B16413.jpg)'
- en: Figure 14.6 – The Maxbotix MaxSonar ultrasonic sensor
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.6 – Maxbotix MaxSonar超声波传感器
- en: The sensor shown in *Figure 14.6* can be used with microcontroller boards. The
    Maxbotix MaxSonar is an accurate and long-range ultrasonic sensor (it can measure
    distances up to 6.45 meters), but it is expensive and requires connecting seven
    wires to its seven pins. The HC-SR04 sensor will suffice for our 20-second timer
    application. It is low cost and easy to connect to, requiring only four wires.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: '*图14.6*中所示的传感器可以用于微控制器板。Maxbotix MaxSonar是一个准确且长距离的超声波传感器（它可以测量高达6.45米的距离），但它很昂贵，需要连接七根线到它的七个引脚。HC-SR04传感器足以满足我们20秒计时器的应用。它成本低，易于连接，只需四根线。'
- en: The timer starts when the ultrasonic sensor detects a user waving at it, so
    the sensor will trigger the timer.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 当超声波传感器检测到用户向其挥手时，计时器开始，因此传感器将触发计时器。
- en: '*Figure 14.7* shows how to connect the HC-SR04 ultrasonic sensor to the Blue
    Pill:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: '*图14.7*展示了如何将HC-SR04超声波传感器连接到Blue Pill：'
- en: '![Figure 14.7 – The ultrasonic sensor connected to the Blue Pill microcontroller
    board](img/Figure_14.7_B16413.jpg)'
  id: totrans-130
  prefs: []
  type: TYPE_IMG
  zh: '![图14.7 – 超声波传感器连接到Blue Pill微控制器板](img/Figure_14.7_B16413.jpg)'
- en: Figure 14.7 – The ultrasonic sensor connected to the Blue Pill microcontroller
    board
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.7 – 超声波传感器连接到Blue Pill微控制器板
- en: 'From *Figure 14.7*, you can see that one of the breadboard''s lower rails is
    connected to the Blue Pill''s **5V** pin. The other rail is connected to Blue
    Pill''s ground. The following are the steps for connecting the HC-SR04 sensor
    to the Blue Pill in addition to the steps followed in *Figure 14.1*, following
    the diagram from *Figure 14.7*:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 从*图14.7*中，你可以看到面包板的一个低轨连接到Blue Pill的**5V**引脚。另一个轨连接到Blue Pill的地。以下是将HC-SR04传感器连接到Blue
    Pill的步骤，除了遵循*图14.1*中的步骤外，还需要按照*图14.7*中的图示进行以下步骤：
- en: Connect the sensor's **VCC** pin to the breadboard's low rail that is connected
    to **5V**.
  id: totrans-133
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将传感器的**VCC**引脚连接到面包板的低轨，该低轨连接到**5V**。
- en: Connect the sensor's **Trig** pin to the Blue Pill's **A8** pin.
  id: totrans-134
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将传感器的**Trig**引脚连接到Blue Pill的**A8**引脚。
- en: Connect the sensor's **Echo** pin to the Blue Pill's **A9** pin.
  id: totrans-135
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将传感器的**Echo**引脚连接到Blue Pill的**A9**引脚。
- en: Connect the sensor's **GND** pin to the breadboard's lower rail that is connected
    to ground.
  id: totrans-136
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将传感器的**GND**引脚连接到面包板的低轨，该低轨连接到地。
- en: '*Figure 14.8* shows how everything is connected:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: '*图14.8*展示了所有连接方式：'
- en: '![Figure 14.8 – The Blue Pill connected to the LCD and the ultrasonic sensor](img/Figure_14.8_B16413.jpg)'
  id: totrans-138
  prefs: []
  type: TYPE_IMG
  zh: '![图14.8 – Blue Pill连接到LCD和超声波传感器](img/Figure_14.8_B16413.jpg)'
- en: Figure 14.8 – The Blue Pill connected to the LCD and the ultrasonic sensor
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.8 – Blue Pill连接到LCD和超声波传感器
- en: Please note from *Figure 14.8* that all the connections from the ultrasonic
    sensor are done on its back side. This is to avoid any cable obstructing the ultrasonic
    signals sent and received on the front of the sensor. Also note that the 1602
    LCD's power (pin **VDD**) is connected to Blue Pill's pin **5V**. If you feed
    the LCD with 3.3 volts, it may not work.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意从*图14.8*中，所有从超声波传感器来的连接都是在它的背面完成的。这是为了避免任何电缆阻碍传感器前部的发送和接收超声波信号。另外，注意1602
    LCD的电源（引脚**VDD**）连接到Blue Pill的**5V**引脚。如果你用3.3伏供电LCD，它可能无法工作。
- en: Tip
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 小贴士
- en: Make sure that there are no wires obstructing the field of view of HC-SR04 ultrasonic
    sensor; otherwise, they will produce erratic or false measurements and results
    with the 20-second counting.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 确保没有电线阻碍HC-SR04超声波传感器的视野；否则，它们将产生不规律或错误的测量和结果，以及20秒计数。
- en: Also note from *Figure 14.8* that the breadboard's upper rail is connected to
    the Blue Pill's **G** pin (in some Blue Pills it is labeled as **GND**), which
    serves to connect the LCD's ground and its 2.2k ohm resistor that is used to preset
    the LCD's contrast.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 还请注意，从 *图 14.8* 可以看出，面包板的上方轨道连接到 Blue Pill 的 **G** 引脚（在某些 Blue Pill 上标记为 **GND**），它用于连接液晶显示屏的地线和用于预置液晶显示屏对比度的
    2.2k 欧姆电阻。
- en: The next section explains how to encase the whole project to protect it from
    dust, water, and so on, and to facilitate its use in a place for washing hands.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个部分将解释如何将整个项目封装起来，以保护其免受灰尘、水等侵害，并便于在洗手的地方使用。
- en: Putting everything together – think of a protective case for the project!
  id: totrans-145
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将所有东西组合在一起——想想为项目做一个保护壳吧！
- en: This section shows how you can place the electronic circuit with the ultrasonic
    sensor inside a protective case. The section also shows some suggestions on how
    to fit everything in a plastic or glass container, because if you use the 20-second
    counter in a bathroom or in a place close to a hand washing sink, you will need
    to protect the circuit against water spilling and soap stains that can damage
    the electronic components used in this 20-second counter project. We do not recommend
    you connect the Blue Pill board to a wall USB adapter for security reasons. It
    is best to connect the Blue Pill to a USB power bank.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 本部分展示了如何将带有超声波传感器的电子电路放置在保护壳内。本部分还提供了一些如何在塑料或玻璃容器中放置所有部件的建议，因为如果您在浴室或靠近洗手池的地方使用
    20 秒计数器，您将需要保护电路免受水溅和肥皂斑点的损害，这些斑点可能会损坏本 20 秒计数器项目中使用的电子组件。出于安全考虑，我们不推荐您将 Blue
    Pill 板连接到墙壁 USB 适配器。最好将 Blue Pill 连接到 USB 移动电源。
- en: 'If you can''t fit the whole 20-second counter circuit (including its solderless
    breadboard) in a plastic or glass container, try connecting the Blue Pill on a
    smaller solderless breadboard such as a half breadboard. Detach the ultrasonic
    sensor and the LCD from the breadboard and position and attach them inside the
    container with strong adhesive tape. A Fritzing diagram about this smaller circuit
    is shown in *Figure 14.9*:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您无法将整个 20 秒倒计时电路（包括其无焊面包板）放入塑料或玻璃容器中，请尝试将 Blue Pill 连接到一个更小的无焊面包板，例如半面包板。从面包板上拆下超声波传感器和液晶显示屏，并用强力胶带将它们定位并固定在容器内部。关于这个较小电路的
    Fritzing 图表显示在 *图 14.9* 中：
- en: '![Figure 14.9 – Connecting everything on a small solderless breadboard](img/Figure_14.9_B16413.jpg)'
  id: totrans-148
  prefs: []
  type: TYPE_IMG
  zh: '![图 14.9 – 在小型无焊面包板上连接所有部件](img/Figure_14.9_B16413.jpg)'
- en: Figure 14.9 – Connecting everything on a small solderless breadboard
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 图 14.9 – 在小型无焊面包板上连接所有部件
- en: As you can see from *Figure 14.9*, by using a half-breadboard you can make all
    the connections more compact so you can use a small container such as an empty
    instant coffee jar or any plastic container that has a lid. You could mount the
    ultrasonic sensor on the lid and place the rest inside of the container or jar.
    You will need to use female-to-male DuPont wires to connect the LCD and the ultrasonic
    sensor to the half breadboard.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 如您从 *图 14.9* 所见，通过使用半面包板，您可以使所有连接更加紧凑，这样您就可以使用一个小的容器，如空速溶咖啡罐或任何带盖的塑料容器。您可以将超声波传感器安装在盖子上，并将其余部分放在容器或罐子内部。您需要使用公对母杜邦线将液晶显示屏和超声波传感器连接到半面包板。
- en: '*Figure 14.10* shows a prototype design with a custom-made case giving you
    an idea of how you could encase all the components and protect the electronics
    from water spilling:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 14.10* 展示了一个带有定制外壳的原型设计，这为您提供了如何封装所有组件并保护电子设备免受水溅的思路：'
- en: '![Figure 14.10 – A 3D prototype design containing the whole project](img/Figure_14.10_B16413.jpg)'
  id: totrans-152
  prefs: []
  type: TYPE_IMG
  zh: '![图 14.10 – 包含整个项目的 3D 原型设计](img/Figure_14.10_B16413.jpg)'
- en: Figure 14.10 – A 3D prototype design containing the whole project
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 图 14.10 – 包含整个项目的 3D 原型设计
- en: As you can see from *Figure 14.10*, that case could be a plastic box where the
    1602A LCD is placed on top of it. The HC-SR04 sensor is placed at the front of
    the case. The interior of the case could contain the small breadboard, wires,
    the Blue Pill, the resistor, the power bank, and the USB cable. Don't place the
    whole project very close to a hand wash sink, just in case.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 如您从 *图 14.10* 所见，该外壳可能是一个放置 1602A 液晶显示屏的塑料盒。HC-SR04 传感器放置在盒子的前面。盒子的内部可以包含小型面包板、电线、Blue
    Pill、电阻、移动电源和 USB 线。不要将整个项目放置在洗手池附近，以防万一。
- en: Testing the timer
  id: totrans-155
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 测试计时器
- en: This section shows how to test out the 20-second timer.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 本部分展示了如何测试 20 秒计时器。
- en: Once you insert the electronic circuit with the sensor, the Blue Pill, and the
    LCD in a protective case, try it in a bathroom. Carefully place it close to a
    hand washing sink if you can, to facilitate activating it and seeing the counting
    while you wash your hands. See whether you can fix it to a wall or a surface so
    it won't move and that no one accidentally knocks it over while waving at it.
    Safety first!
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦将带有传感器的电子电路、Blue Pill和LCD放入保护壳中，尝试在浴室中使用它。如果可能，小心地将它放置在洗手池附近，以便在洗手时激活它并看到计数。看看你是否能将其固定在墙上或表面上，这样它就不会移动，也不会有人在挥手时意外将其碰倒。安全第一！
- en: 'You should connect the Blue Pill to a portable power bank that has a USB socket.
    This is to avoid connecting the Blue Pill to a wall USB adapter to make it safer
    to use in an environment such as a bathroom, as shown in *Figure 14.11*:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 你应该将Blue Pill连接到一个带有USB接口的便携式充电宝。这是为了避免将Blue Pill连接到墙壁USB适配器，使其在如浴室等环境中使用更安全，如图14.11所示：
- en: '![Figure 14.11 – A power bank connected to the Blue Pill microcontroller board](img/Figure_14.11_B16413.jpg)'
  id: totrans-159
  prefs: []
  type: TYPE_IMG
  zh: '![图14.11 – 连接到Blue Pill微控制器板的充电宝](img/Figure_14.11_B16413.jpg)'
- en: Figure 14.11 – A power bank connected to the Blue Pill microcontroller board
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 图14.11 – 连接到Blue Pill微控制器板的充电宝
- en: You can test out everything with a small power bank, such as the one shown in
    *Figure 14.11*.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以用一个小型充电宝测试所有这些，如图14.11所示。
- en: 'Try activating the timer by waving at the sensor numerous times. You will see
    that sometimes the circuit counts up to 21\. This is because most microcontroller
    boards (including the Blue Pill) do not calculate the time very accurately. Try
    adding a variable and a decision to the code to show the count up to number 20\.
    Hint: Stop showing the counting when it reaches 20\. It is not critical if it
    counts up to 21 when you wash your hands for trying to *destroy* the virus that
    causes COVID-19\. The longer the counting the better.'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 通过多次在传感器前挥手来尝试激活计时器。你会发现有时电路会计数到21。这是因为大多数微控制器板（包括Blue Pill）计算时间并不非常准确。尝试在代码中添加一个变量和决策，以显示计数到20。提示：当计数达到20时停止显示计数。当你洗手试图*破坏*导致COVID-19的病毒时，计数到21并不关键。计数时间越长越好。
- en: 'You can adjust the detected distance if you feel that the user needs to wave
    at the sensor at a different distance. Try changing the value from this line of
    code:'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你觉得用户需要在不同的距离挥手来检测传感器，你可以调整检测的距离。尝试更改此行代码中的值：
- en: '`if ((dist_read<=15) & (dist_read>0))`'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: '`if ((dist_read<=15) & (dist_read>0))`'
- en: The `15` value means that the LCD will activate and show the counting if you
    are waving at the sensor at a distance of 15 centimeters or less from the sensor.
    Try to change the value to a greater number, perhaps 20 centimeters.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: '`15`这个值意味着如果你在距离传感器15厘米或更近的地方挥手，LCD会激活并显示计数。尝试将这个值改为更大的数字，比如20厘米。'
- en: If you think that the text and numbers shown on the LCD need more contrast,
    try changing the 2.2k ohm resistor to a smaller one, such as 1 k ohm. This may
    happen if your bathroom or the place where you will use the counter is too bright.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你认为LCD上显示的文本和数字需要更高的对比度，尝试将2.2k欧姆电阻更换为更小的电阻，例如1k欧姆。这可能发生在你的浴室或你打算使用计数器的场所过于明亮的情况下。
- en: 'This is an interesting test: try the 20-second counter with people of different
    ages, to see whether the ultrasonic sensor can detect different hand sizes. For
    example, see whether the sensor detects the waving hands of small children and
    adults.'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个有趣的测试：尝试用不同年龄段的人进行20秒计数器的测试，看看超声波传感器是否能检测到不同大小的手。例如，看看传感器是否能检测到小孩和成人的挥手动作。
- en: Summary
  id: totrans-168
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we learned the basics of coding an easy-to-read 20-second counter.
    This count is recommended by many health authorities for properly washing our
    hands during that time in an attempt to destroy some viruses such as the one that
    causes COVID-19\. The chapter also explained how the HC-SR04 ultrasonic sensor
    works for activating the counter. One major skill that you gained on completing
    the project from this chapter is that you learned how to connect a practical LCD
    to a microcontroller board, and how we could show the counting on an LCD. You
    can use the LCD in other projects that require showing numeric or text data from
    a microcontroller board.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们学习了编写易于阅读的20秒计数器的基础知识。许多卫生机构推荐使用这个计数来正确洗手，以试图消灭一些病毒，例如导致COVID-19的病毒。本章还解释了HC-SR04超声波传感器是如何激活计数器的。在完成本章的项目后，你获得的一项主要技能是学会了如何将实用的LCD连接到微控制器板上，以及如何在LCD上显示计数。你可以在其他需要从微控制器板上显示数字或文本数据的项目中使用LCD。
- en: We have covered in this chapter a practical way to obtain data from a sensor,
    process it on the microcontroller board, and do something about it such as showing
    results on an LCD. Obtaining data from sensors and processing it is one of the
    main applications of microcontrollers, leveraging their simplicity for connecting
    sensors to their input/output ports.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们介绍了一种从传感器获取数据、在微控制器板上处理数据以及对其进行操作（如显示在LCD上）的实用方法。从传感器获取数据并处理是微控制器的主要应用之一，利用其简单性将传感器连接到其输入/输出端口。
- en: Further reading
  id: totrans-171
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 进一步阅读
- en: 'Choudhuri, K. B. R. (2017), *Learn Arduino Prototyping in 10 Days*, Birmingham,
    UK: Packt Publishing Ltd'
  id: totrans-172
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Choudhuri, K. B. R. (2017)，*10天内学习Arduino原型设计*，英国伯明翰：Packt出版社有限公司
- en: 'Gay, W. (2018), *Beginning STM32: Developing with FreeRTOS, libopencm3 and
    GCC*, New York, NY: Apress'
  id: totrans-173
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Gay, W. (2018)，*STM32入门：使用FreeRTOS、libopencm3和GCC进行开发*，纽约，纽约：Apress出版社
- en: HC-SR04 (2013), *HC-SR04 user's manual V1.0\. Cytron Technologies*, available
    from [https://docs.google.com/document/d/1Y-yZnNhMYy7rwhAgyL_pfa39RsB-x2qR4vP8saG73rE/edit?usp=sharing](https://docs.google.com/document/d/1Y-yZnNhMYy7rwhAgyL_pfa39RsB-x2qR4vP8saG73rE/edit?usp=sharing)
  id: totrans-174
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: HC-SR04（2013），*HC-SR04用户手册V1.0*，Cytron技术公司，可在[https://docs.google.com/document/d/1Y-yZnNhMYy7rwhAgyL_pfa39RsB-x2qR4vP8saG73rE/edit?usp=sharing](https://docs.google.com/document/d/1Y-yZnNhMYy7rwhAgyL_pfa39RsB-x2qR4vP8saG73rE/edit?usp=sharing)获取
- en: 'Horowitz, P. and Hill, W. (2015), *The Art of Electronics*, [3rd ed.] Cambridge
    University Press: New York, NY'
  id: totrans-175
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Horowitz, P. 和 Hill, W. (2015)，*电子艺术*，[第3版]，剑桥大学出版社：纽约，纽约
- en: LCD1602 (2009), *LCM module data sheet TC1602A-01T*, Tinsharp Industrial Co.,
    Ltd. available from [https://cdn-shop.adafruit.com/datasheets/TC1602A-01T.pdf](https://cdn-shop.adafruit.com/datasheets/TC1602A-01T.pdf)
  id: totrans-176
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: LCD1602（2009），*LCM模块数据表TC1602A-01T*，Tinsharp工业有限公司，可在[https://cdn-shop.adafruit.com/datasheets/TC1602A-01T.pdf](https://cdn-shop.adafruit.com/datasheets/TC1602A-01T.pdf)获取
- en: Microchip (2019), *PIC16F15376 Curiosity Nano hardware user guide*, Microchip
    Technology, Inc. available from [http://ww1.microchip.com/downloads/en/DeviceDoc/50002900B.pdf](http://ww1.microchip.com/downloads/en/DeviceDoc/50002900B.pdf)
  id: totrans-177
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Microchip (2019)，*PIC16F15376 Curiosity Nano硬件用户指南*，Microchip技术公司，可在[http://ww1.microchip.com/downloads/en/DeviceDoc/50002900B.pdf](http://ww1.microchip.com/downloads/en/DeviceDoc/50002900B.pdf)获取
