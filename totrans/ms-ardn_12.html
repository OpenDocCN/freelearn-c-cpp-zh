<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Fun with Sound</h1>
                </header>
            
            <article>
                
<p>Adding sound to your robotic project can be the difference between a good robot and an awesome robot. Just think about how cute R2-D2, from the movie <em>Star Wars</em>, would have been if he did not make any sound. We can use sound for more than just robots. For example, we may want to add a loud alarm if a motion sensor detects motion or maybe we just want to play a melody when the temperature is just right outside.</p>
<p>In this chapter, you will learn:</p>
<ul>
<li>How to connect a piezo buzzer to the Arduino</li>
<li>How to connect a speaker to the Arduino</li>
<li>How to use the <kbd>tone()</kbd> function to generate a sound</li>
<li>How to play music with the Arduino</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Introduction</h1>
                </header>
            
            <article>
                
<p>In this chapter, we will be doing several projects that can use either a <strong>piezo buzzer</strong> or a small 8-ohm speaker. By using both the buzzer and the speaker, you will be able to hear the difference between the two to help determine which is right for our project.</p>
<p>A piezo buzzer is compact, reliable and very inexpensive. They are easier to mount and use than a normal speaker in most electronic projects. These buzzers can emit a wide range of sounds, from soft hums to loud alerts.</p>
<p>A piezo buzzer, sometimes known as a piezo speaker, creates sounds a little differently than a normal speaker. The working component of these buzzers is a thin disc of piezoelectric material usually bonded to a metal diaphragm. As the voltage is applied to the piezoelectric material, it deforms. This causes the metal diaphragm to bend forward or backward. This deformation happens very rapidly, causing the ceramic/metal bending element to vibrate at the frequency of the applied voltage, which produces the audible sound.</p>
<p>The following photograph shows what a piezo buzzer looks like:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/dbeb2ce2-5221-4c97-a829-662b7cd10b06.png" style="width:18.92em;height:21.42em;"/></p>
<p>The shorter pin should be connected to ground while the longer pin should be connected to power.</p>
<p>The 8 ohm speaker is a typical speaker that contains an electromagnet, which is a metal coil that creates a magnetic field when electricity is applied. By reversing the direction of the coil, the poles of the magnet reverse. This electromagnet is placed in front of a normal magnet where the poles cannot be reversed. The current direction that is applied to the electromagnet is changed rapidly, causing the magnets to attract and repel each other creating sound from a cone that is connected to the electromagnet.</p>
<p>The following diagram shows what an 8 ohm speaker could look like:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/03dc3298-c9cf-4ef0-bf6f-7e48dc2926c4.png" style="width:19.92em;height:20.67em;"/></p>
<p>Now let's look at the components needed for this project.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Components needed</h1>
                </header>
            
            <article>
                
<p>We will need the following components for this chapter's project:</p>
<ul>
<li>One Arduino Uno or compatible board</li>
<li>One piezo buzzer</li>
<li>One 8 ohm speaker</li>
<li>Jumper wires</li>
<li>One breadboard</li>
</ul>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Circuit diagrams</h1>
                </header>
            
            <article>
                
<p>Here is the circuit diagram that we will use for all code samples in this chapter:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/fed1957f-9b99-4436-9a35-4edff0df9096.png" style="width:43.42em;height:33.17em;"/></p>
<p>This diagram shows that the ground pins on both the speaker and piezo buzzer are connected to the ground rail on the breadboard. The power pin on the piezo buzzer is connected to pin 8 on the Arduino, and the power wire on the speaker is connected to pin 7 on the Arduino.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Code</h1>
                </header>
            
            <article>
                
<p>Let's start off by using the <kbd>tone()</kbd>Â function.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using the tone function</h1>
                </header>
            
            <article>
                
<p>For the first few examples in this chapter, we will be using the Arduino <kbd>tone()</kbd> function. This function comes in two varieties. The first variety takes two arguments, where the first is the pin number that the buzzer or speaker is connected to and the second is the frequency in hertz to play the sound at. The function looks like this:</p>
<pre>tone(pinNumber, frequency);</pre>
<p>When this function is used with only two parameters, the sound is played indefinitely. The following code shows how we could use this function to play a note using the previous circuit diagram:</p>
<pre>#define PIEZOPIN 7
#define SPEAKERPIN 8

int soundPin = PIEZOPIN;

void setup() {
  tone(soundPin, 1000);
}</pre>
<p>With this code, the <kbd>tone()</kbd> function is used within the <kbd>setup()</kbd> function to play at 1000 Hz. We can set the sound pin to either the piezo buzzer or the speaker pin depending on which one you wish to play the sound. We would use this version of the <kbd>tone()</kbd> function if we wanted to play a sound continuously until some user interaction happens. An example of this would be playing an alert sound until the user acknowledged it.</p>
<p>The second variety of this function takes a third argument, which is the duration in milliseconds to play the sound. This function looks like this:</p>
<pre>tone(pinNumber, frequency, duration);</pre>
<p>This version of the <kbd>tone()</kbd> function can be used like this:</p>
<pre>#define PIEZOPIN 7
#define SPEAKERPIN 8

int soundPin = PIEZOPIN;

void setup() {
  tone(soundPin, 1000, 1000);
}</pre>
<p class="mce-root"/>
<p>This code is exactly like the previous code except the sound is only played for one second. We would use this version of the tone function if we wanted to play short notes with specific durations. An example of this would be playing a song, which we will see in the next example.</p>
<p>Before we can play a song with the Arduino, we need to define what frequency to play for different notes. The list of frequencies is quite large and can be downloaded with the downloadable code for this book. The file with the frequencies is called <kbd>pitches.h</kbd>, and the frequencies are defined like this:</p>
<pre>#define NOTE_G6  1568
#define NOTE_GS6 1661
#define NOTE_A6  1760
#define NOTE_AS6 1865
#define NOTE_B6  1976
#define NOTE_C7  2093</pre>
<p>Now let's look at how we can use these frequencies to play a song. The first thing we will need to do is to create a pitches header tab, named <kbd>pitches.h</kbd>, which will contain the frequencies and then include it in the main tab with the following line:</p>
<pre>#include "pitches.h"</pre>
<p>Now we need to define the notes or melody that makes up the song. These notes will be stored in an array named <kbd>melody</kbd>:</p>
<pre>int melody[] = {
  NOTE_E5, NOTE_E5, NOTE_E5, NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_E5,
  NOTE_G5,
  NOTE_C5,
  NOTE_D5,
  NOTE_E5,
  NOTE_F5, NOTE_F5, NOTE_F5, NOTE_F5, NOTE_F5,
  NOTE_E5, NOTE_E5, NOTE_E5, NOTE_E5, NOTE_E5,
  NOTE_D5, NOTE_D5,
  NOTE_E5,
  NOTE_D5,
  NOTE_G5
};</pre>
<p class="mce-root"/>
<p>Each note in the song should play for a certain duration. We can create another array that contains the duration of each note, and we will call that array <kbd>tempo</kbd>:</p>
<pre>int tempo[] = {
  4, 4, 2, 4, 4, 2,
  4,
  4,
  4,
  4,
  1,
  4, 4, 4, 4, 4,
  4, 4, 8, 8, 4,
  4, 4,
  4,
  2,
  2
};</pre>
<p>We will be using the <kbd>tone()</kbd> function to create the notes. With this function, we will not need to set up anything in the <kbd>setup()</kbd> function. The following code can be put in the <kbd>loop()</kbd> function to play the song defined by the <kbd>melody</kbd> and <kbd>tempo</kbd> arrays:</p>
<pre>// Get the number of notes in the song
int songSize = sizeof(melody) / sizeof(melody[0]);

//Loop through each note
for (int note = 0; note &lt; songSize; note++) {

  //Calculate how long to play the note
  int noteDuration = 1000 / tempo[note];
<br/>  //Play the note
  tone(soundPin, melody[note], noteDuration);

  //Calculate how long to pause before playing next note
  int pauseBetweenNotes = noteDuration * 1.20;
  delay(pauseBetweenNotes);
}
delay(3000);</pre>
<p>This code starts off by calculating the number of notes in the <kbd>melody</kbd> array by dividing the size of the <kbd>melody</kbd> array by the size of the first element in the array. We use this logic to calculate the number of elements in an array because the <kbd>sizeof(melody)</kbd> code returns the number of bytes occupied by the array and the <kbd>sizeof(melody[0])</kbd> returns the number of bytes occupied by the first element in the array. It takes two bytes to store a single integer, and there are 26 notes in the melody array. Therefore, the <kbd>size of (melody)</kbd> code will return <kbd>52</kbd>, and the <kbd>sizeof(melody[0])</kbd> code will return <kbd>2</kbd>.</p>
<p>A <kbd>for</kbd> loop is used to loop throughÂ the <kbd>melody</kbd> and <kbd>temp</kbd> arrays. Within the <kbd>for</kbd> loop, the note duration is calculated by taking one second and dividing it by the note type (the elements in the <kbd>tempo</kbd> array) where a quarter note is equal to 1000 divided by 4 and an eighth note is equal to 1000 divided by 8.</p>
<p>The <kbd>tone</kbd> function is used to play the note from the <kbd>melody</kbd> array for the calculated duration. The <kbd>tone</kbd> function will not cause the application to pause while the note is playing. Therefore, we need to create our own pause. We will also want to pause slightly longer than the duration of the note to have a slight pause between the notes. For this, we multiply the note duration by 1.2 and then use the <kbd>delay()</kbd> function. After the <kbd>for</kbd> loop has completed, there is another delay for three seconds before starting over.</p>
<p>This last example shows how we can play a song using the <kbd>tone()</kbd> function with two arrays, one for the notes and one for the tempo. Now let's look at how we can use a library that will enable us to play music that is in the <strong>RTTTL</strong> (<strong>Ring Tone Text Transfer Language</strong>) format. The RTTTL format was developed by Nokia to transfer ringtones to cellphones.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Playing a ringtone in the RTTTL format</h1>
                </header>
            
            <article>
                
<p>The Arduino library manager does not have a library that we can download to play RTTTL files at this time. Therefore, we will need to download and manually install a library. We will be using Arduino-rtttl-player that can be downloaded here: <a href="https://github.com/ponty/arduino-rtttl-player">https://github.com/ponty/arduino-rtttl-player</a>. We will need to create a ZIP file of the library to load it into the IDE. If you do not have access to a utility that can zip up the files, the downloadable code for this book contains the library already zipped.</p>
<p>When we create the ZIP file to load into the Arduino IDE, we do not want to zip up everything that is downloaded from the GitHub repository because the Arduino IDE will not recognize the ZIP file as a library file. We only want to zip up the directory that contains the code for the library, and in the case of the Arduino-rtttl-player library that would be the <kbd>rtttl</kbd> folder.</p>
<p>After we download the library and create a ZIP file that contains the <kbd>rtttl</kbd> folder from the library, we will want to load the library into the Arduino IDE. To do this, we will want to select <span class="packt_screen">Sketch</span> | <span class="packt_screen">Include Library</span> | <span class="packt_screen">Add .ZIP Library...</span> from the main menu as shown in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/f6dd9a78-0b9c-4988-b77d-41675508590a.png" style="width:37.50em;height:15.17em;"/></p>
<p class="mce-root"/>
<p class="mce-root"/>
<p>After you select the <span class="packt_screen">Add .ZIP Library</span> option, you will be presented with a file picker where you can browse to the location of the ZIP file you created and select it. If the library was successfully imported, you will see a message in the message bar as shown in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/8b417a3f-5d50-47be-8f1d-a96c837a8267.png" style="width:44.58em;height:34.08em;"/></p>
<p>Now we are ready to play an RTTTL melody. The first thing we need to do is to include the library with the project by adding the following <kbd>include</kbd> statement to the sketch:</p>
<pre>#include &lt;rtttl.h&gt;</pre>
<p>We will want to include both the piezo buzzer and the speaker as we did in the earlier projects with the following code:</p>
<pre>#define PIEZOPIN 7
#define SPEAKERPIN 8

int soundPin = PIEZOPIN; </pre>
<p>We will need to define the song to play. There are plenty of RTTTL codes on the internet. To find some, do a search for <kbd>rtttl songs</kbd> and you should see plenty of RTTTL codes for a wide variety of songs. For this example, we will play the <em>Star Wars</em> theme. The following code contains the RTTTL code for this:</p>
<pre>char *song = "Star Wars:d=8,o=5,b=180:f5,f5,f5,2a#5.,2f.,d#,d,c,2a#.,4f.,d#,d,c,2a#.,4f.,d#,d,d#,2c,4p,f5,f5,f5,2a#5.,2f.,d#,d,c,2a#.,4f.,d#,d,c,2a#.,4f.,d#,d,d#,2c";</pre>
<p>To play this song, add the following code to the <kbd>setup()</kbd> function:</p>
<pre>Rtttl player;
player.begin(soundPin);
player.play(song, 0);</pre>
<p>We use the <kbd>begin</kbd> function from the Arduino-rtttl-player library to initiate the library, and define what pin the speaker is connected to and then the <kbd>play</kbd> function to play the song. The second parameter in the <kbd>play</kbd> function is the octave. The higher the octave is set to the higher pitch the song will play at. I usually leave this at zero.</p>
<p>When this code is run, you should recognize the <em>Star Wars</em> theme.</p>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Challenge</h1>
                </header>
            
            <article>
                
<p>For the challenge, we will stay with the <em>Star Wars</em> theme. Let's say that we wanted to build a robot that looks like R2-D2 from <em>Star Wars</em>. One of the features that we would put in would be to have it sound like R2-D2. How would you make the robot sound like R2-D2?</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we saw how to connect both a speaker and a piezo buzzer to an Arduino. We then learned how to use the <kbd>tone()</kbd> function to create sounds and also play a song. We also saw how we could install and use a third-party library so we could play RTTTL files.</p>
<p>In the next chapter, we will look at how we can use LCD displays to display messages.</p>


            </article>

            
        </section>
    </body></html>